<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\commands\foreigncmds.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\commands\foreigncmds.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:34 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * foreigncmds.c 
 *    foreign-data wrapper/server creation/manipulation commands 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/commands/foreigncmds.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/heapam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/reloptions.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xact.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/dependency.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/indexing.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/objectaccess.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_foreign_data_wrapper.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_foreign_server.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_foreign_table.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_proc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_user_mapping.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/defrem.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"foreign/fdwapi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"foreign/foreign.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_func.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"tcop/utility.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/acl.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
 
 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN43"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>tablename</span><span class='Delimiter'>; 
</span><a name="LN44"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>cmd</span><span class='Delimiter'>; 
</span><a name="LN45"></a>} <span class='Declare_Typedef'>import_error_callback_arg</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* Internal functions */ 
</span><a name="LN48"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>import_error_callback</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Convert a DefElem list to the text array format that is used in 
 * pg_foreign_data_wrapper, pg_foreign_server, pg_user_mapping, and 
 * pg_foreign_table. 
 * 
 * Returns the array in the form of a Datum, or PointerGetDatum(NULL) 
 * if the list is empty. 
 * 
 * Note: The array is usually stored to database without further 
 * processing, hence any validation should be done before this 
 * conversion. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN64"></a><span class='Declare_Function'>optionListToArray</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>options</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN66"></a>    <a href="../../include/utils/array.h.html#LN167"><span class='Ref_to_Struct'>ArrayBuildState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>astate</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN67"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN67"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN64"><span class='Ref_to_Parameter'>options</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN71"></a>        <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>def</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN67"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN72"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>value</span><span class='Delimiter'>; 
</span><a name="LN73"></a>        <a href="../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN74"></a>        <a href="../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>t</span><span class='Delimiter'>; 
</span> 
        <span class='Keyword'>value </span><span class='Operator'>= </span><a href="define.c.html#LN47"><span class='Ref_to_Func'>defGetString</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN71"><span class='Ref_To_Local'>def</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="foreigncmds.c.html#LN73"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a> <span class='Operator'>+ </span>strlen<span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN71"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>+ </span>strlen<span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="foreigncmds.c.html#LN74"><span class='Ref_To_Local'>t</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN73"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN74"><span class='Ref_To_Local'>t</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN73"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN74"><span class='Ref_To_Local'>t</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%s=%s"</span><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN71"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="foreigncmds.c.html#LN66"><span class='Ref_To_Local'>astate</span></a> <span class='Operator'>= </span><a href="../../include/utils/array.h.html#LN390"><span class='Ref_to_Proto'>accumArrayResult</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN66"><span class='Ref_To_Local'>astate</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN74"><span class='Ref_To_Local'>t</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, 
</span>                                  <a href="../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN66"><span class='Ref_To_Local'>astate</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../include/utils/array.h.html#LN394"><span class='Ref_to_Proto'>makeArrayResult</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN66"><span class='Ref_To_Local'>astate</span></a><span class='Delimiter'>, </span><a href="../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end optionListToArray &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Transform a list of DefElem into text array format.  This is substantially 
 * the same thing as optionListToArray(), except we recognize SET/ADD/DROP 
 * actions for modifying an existing list of options, which is passed in 
 * Datum form as oldOptions.  Also, if fdwvalidator isn't InvalidOid 
 * it specifies a validator function to call on the result. 
 * 
 * Returns the array in the form of a Datum, or PointerGetDatum(NULL) 
 * if the list is empty. 
 * 
 * This is used by CREATE/ALTER of FOREIGN DATA WRAPPER/SERVER/USER MAPPING/ 
 * FOREIGN TABLE. 
 */ 
</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN108"></a><span class='Declare_Function'>transformGenericOptions</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>catalogId</span><span class='Delimiter'>, 
</span><a name="LN109"></a>                        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>oldOptions</span><span class='Delimiter'>, 
</span><a name="LN110"></a>                        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>options</span><span class='Delimiter'>, 
</span><a name="LN111"></a>                        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>fdwvalidator</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN113"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>resultOptions</span> <span class='Operator'>= </span><a href="../../include/access/reloptions.h.html#LN260"><span class='Ref_to_Proto'>untransformRelOptions</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN109"><span class='Ref_to_Parameter'>oldOptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN114"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>optcell</span><span class='Delimiter'>; 
</span><a name="LN115"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN114"><span class='Ref_To_Local'>optcell</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN110"><span class='Ref_to_Parameter'>options</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN119"></a>        <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>od</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN114"><span class='Ref_To_Local'>optcell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN120"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span><a name="LN121"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>prev</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Find the element in resultOptions.  We need this for validation in 
         * all cases.  Also identify the previous element. 
         */ 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN120"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN113"><span class='Ref_To_Local'>resultOptions</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN129"></a>            <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>def</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN120"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN129"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN119"><span class='Ref_To_Local'>od</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="foreigncmds.c.html#LN121"><span class='Ref_To_Local'>prev</span></a> <span class='Operator'>= </span><a href="foreigncmds.c.html#LN120"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * It is possible to perform multiple SET/DROP actions on the same 
         * option.  The standard permits this, as long as the options to be 
         * added are unique.  Note that an unspecified action is taken to be 
         * ADD. 
         */ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN119"><span class='Ref_To_Local'>od</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN721"><span class='Ref_to_Member'>defaction</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN712"><span class='Ref_to_EnumConst'>DEFELEM_DROP</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="foreigncmds.c.html#LN120"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"option \"%s\" not found"</span><span class='Delimiter'>, 
</span>                                    <a href="foreigncmds.c.html#LN119"><span class='Ref_To_Local'>od</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <a href="foreigncmds.c.html#LN113"><span class='Ref_To_Local'>resultOptions</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN238"><span class='Ref_to_Proto'>list_delete_cell</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN113"><span class='Ref_To_Local'>resultOptions</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN120"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN121"><span class='Ref_To_Local'>prev</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN710"><span class='Ref_to_EnumConst'>DEFELEM_SET</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="foreigncmds.c.html#LN120"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"option \"%s\" not found"</span><span class='Delimiter'>, 
</span>                                    <a href="foreigncmds.c.html#LN119"><span class='Ref_To_Local'>od</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN120"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>) </span><span class='Operator'>= </span><a href="foreigncmds.c.html#LN119"><span class='Ref_To_Local'>od</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN711"><span class='Ref_to_EnumConst'>DEFELEM_ADD</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN709"><span class='Ref_to_EnumConst'>DEFELEM_UNSPEC</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN120"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/pg_basebackup/streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"option \"%s\" provided more than once"</span><span class='Delimiter'>, 
</span>                                    <a href="foreigncmds.c.html#LN119"><span class='Ref_To_Local'>od</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <a href="foreigncmds.c.html#LN113"><span class='Ref_To_Local'>resultOptions</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN113"><span class='Ref_To_Local'>resultOptions</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN119"><span class='Ref_To_Local'>od</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized action %d on option \"%s\""</span><span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="foreigncmds.c.html#LN119"><span class='Ref_To_Local'>od</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN721"><span class='Ref_to_Member'>defaction</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN119"><span class='Ref_To_Local'>od</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch od-&GT;defaction &raquo; </span> 
    <span class='Delimiter'>} 
</span> 
    <a href="foreigncmds.c.html#LN115"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="foreigncmds.c.html#LN63"><span class='Ref_to_Func'>optionListToArray</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN113"><span class='Ref_To_Local'>resultOptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN111"><span class='Ref_to_Parameter'>fdwvalidator</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN184"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>valarg</span> <span class='Operator'>= </span><a href="foreigncmds.c.html#LN115"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Pass a null options list as an empty array, so that validators 
         * don't have to be declared non-strict to handle the case. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN184"><span class='Ref_To_Local'>valarg</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
            <a href="foreigncmds.c.html#LN184"><span class='Ref_To_Local'>valarg</span></a> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/utils/array.h.html#LN378"><span class='Ref_to_Proto'>construct_empty_array</span></a><span class='Parentheses'>(</span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../include/fmgr.h.html#LN623"><span class='Ref_to_Macro'>OidFunctionCall2</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN111"><span class='Ref_to_Parameter'>fdwvalidator</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN184"><span class='Ref_To_Local'>valarg</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN108"><span class='Ref_to_Parameter'>catalogId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="foreigncmds.c.html#LN115"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end transformGenericOptions &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Internal workhorse for changing a data wrapper's owner. 
 * 
 * Allow this only for superusers; also the new owner must be a 
 * superuser. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN206"></a><span class='Declare_Function'>AlterForeignDataWrapperOwner_internal</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tup</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>newOwnerId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN208"></a>    <a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN48"><span class='Ref_to_Typedef'>Form_pg_foreign_data_wrapper</span></a> <span class='Declare_Local'>form</span><span class='Delimiter'>; 
</span><a name="LN209"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>repl_val</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN55"><span class='Ref_to_Const'>Natts_pg_foreign_data_wrapper</span></a><span class='Delimiter'>]; 
</span><a name="LN210"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>repl_null</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN55"><span class='Ref_to_Const'>Natts_pg_foreign_data_wrapper</span></a><span class='Delimiter'>]; 
</span><a name="LN211"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>repl_repl</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN55"><span class='Ref_to_Const'>Natts_pg_foreign_data_wrapper</span></a><span class='Delimiter'>]; 
</span><a name="LN212"></a>    <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>newAcl</span><span class='Delimiter'>; 
</span><a name="LN213"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN214"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN208"><span class='Ref_To_Local'>form</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN48"><span class='Ref_to_Typedef'>Form_pg_foreign_data_wrapper</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN206"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Must be a superuser to change a FDW owner */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>())</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied to change owner of foreign-data wrapper \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN208"><span class='Ref_To_Local'>form</span></a><span class='Operator'>-&GT;</span>fdwname<span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Must be superuser to change owner of a foreign-data wrapper."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* New owner must also be a superuser */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN206"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied to change owner of foreign-data wrapper \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN208"><span class='Ref_To_Local'>form</span></a><span class='Operator'>-&GT;</span>fdwname<span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>        <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"The owner of a foreign-data wrapper must be a superuser."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN208"><span class='Ref_To_Local'>form</span></a><span class='Operator'>-&GT;</span>fdwowner <span class='Operator'>!= </span><a href="foreigncmds.c.html#LN206"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        memset<span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN210"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN210"><span class='Ref_To_Local'>repl_null</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memset<span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN211"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN211"><span class='Ref_To_Local'>repl_repl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="foreigncmds.c.html#LN211"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN57"><span class='Ref_to_Const'>Anum_pg_foreign_data_wrapper_fdwowner</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="foreigncmds.c.html#LN209"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN57"><span class='Ref_to_Const'>Anum_pg_foreign_data_wrapper_fdwowner</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN206"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="foreigncmds.c.html#LN213"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN768"><span class='Ref_to_Macro'>heap_getattr</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN206"><span class='Ref_to_Parameter'>tup</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN60"><span class='Ref_to_Const'>Anum_pg_foreign_data_wrapper_fdwacl</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN206"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="foreigncmds.c.html#LN214"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Null ACLs do not require changes */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="foreigncmds.c.html#LN214"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="foreigncmds.c.html#LN212"><span class='Ref_To_Local'>newAcl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN217"><span class='Ref_to_Proto'>aclnewowner</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN112"><span class='Ref_to_Macro'>DatumGetAclP</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN213"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="foreigncmds.c.html#LN208"><span class='Ref_To_Local'>form</span></a><span class='Operator'>-&GT;</span>fdwowner<span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN206"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="foreigncmds.c.html#LN211"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN60"><span class='Ref_to_Const'>Anum_pg_foreign_data_wrapper_fdwacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="foreigncmds.c.html#LN209"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN60"><span class='Ref_to_Const'>Anum_pg_foreign_data_wrapper_fdwacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN212"><span class='Ref_To_Local'>newAcl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="foreigncmds.c.html#LN206"><span class='Ref_to_Parameter'>tup</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN206"><span class='Ref_to_Parameter'>tup</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN206"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN209"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN210"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>, 
</span>                                <a href="foreigncmds.c.html#LN211"><span class='Ref_To_Local'>repl_repl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN206"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="foreigncmds.c.html#LN206"><span class='Ref_to_Parameter'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN206"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Update owner dependency reference */ 
</span>        <a href="../../include/catalog/dependency.h.html#LN259"><span class='Ref_to_Proto'>changeDependencyOnOwner</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN28"><span class='Ref_to_Const'>ForeignDataWrapperRelationId</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN206"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="foreigncmds.c.html#LN206"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if form-&GT;fdwowner!=newOw... &raquo; </span> 
 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN28"><span class='Ref_to_Const'>ForeignDataWrapperRelationId</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN206"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterForeignDataWrapperOwner_internal &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Change foreign-data wrapper owner -- by name 
 * 
 * Note restrictions in the "_internal" function, above. 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN276"></a><span class='Declare_Function'>AlterForeignDataWrapperOwner</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>newOwnerId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN278"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>fdwId</span><span class='Delimiter'>; 
</span><a name="LN279"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN280"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN281"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN280"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN28"><span class='Ref_to_Const'>ForeignDataWrapperRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN279"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN60"><span class='Ref_to_EnumConst'>FOREIGNDATAWRAPPERNAME</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN276"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN279"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"foreign-data wrapper \"%s\" does not exist"</span><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN276"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN278"><span class='Ref_To_Local'>fdwId</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN279"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN205"><span class='Ref_to_Func'>AlterForeignDataWrapperOwner_internal</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN280"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN279"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN276"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN281"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN28"><span class='Ref_to_Const'>ForeignDataWrapperRelationId</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN278"><span class='Ref_To_Local'>fdwId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN279"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN280"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="foreigncmds.c.html#LN281"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterForeignDataWrapperOwner &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Change foreign-data wrapper owner -- by OID 
 * 
 * Note restrictions in the "_internal" function, above. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN311"></a><span class='Declare_Function'>AlterForeignDataWrapperOwner_oid</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>fwdId</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>newOwnerId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN313"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN314"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN314"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN28"><span class='Ref_to_Const'>ForeignDataWrapperRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN313"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN61"><span class='Ref_to_EnumConst'>FOREIGNDATAWRAPPEROID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN311"><span class='Ref_to_Parameter'>fwdId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN313"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>          <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"foreign-data wrapper with OID %u does not exist"</span><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN311"><span class='Ref_to_Parameter'>fwdId</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN205"><span class='Ref_to_Func'>AlterForeignDataWrapperOwner_internal</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN314"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN313"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN311"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN313"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN314"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterForeignDataWrapperOwner_oid &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Internal workhorse for changing a foreign server's owner 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN336"></a><span class='Declare_Function'>AlterForeignServerOwner_internal</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tup</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>newOwnerId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN338"></a>    <a href="../../include/catalog/pg_foreign_server.h.html#LN47"><span class='Ref_to_Typedef'>Form_pg_foreign_server</span></a> <span class='Declare_Local'>form</span><span class='Delimiter'>; 
</span><a name="LN339"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>repl_val</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_server.h.html#LN54"><span class='Ref_to_Const'>Natts_pg_foreign_server</span></a><span class='Delimiter'>]; 
</span><a name="LN340"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>repl_null</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_server.h.html#LN54"><span class='Ref_to_Const'>Natts_pg_foreign_server</span></a><span class='Delimiter'>]; 
</span><a name="LN341"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>repl_repl</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_server.h.html#LN54"><span class='Ref_to_Const'>Natts_pg_foreign_server</span></a><span class='Delimiter'>]; 
</span><a name="LN342"></a>    <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>newAcl</span><span class='Delimiter'>; 
</span><a name="LN343"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN344"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN338"><span class='Ref_To_Local'>form</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_server.h.html#LN47"><span class='Ref_to_Typedef'>Form_pg_foreign_server</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN336"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN338"><span class='Ref_To_Local'>form</span></a><span class='Operator'>-&GT;</span>srvowner <span class='Operator'>!= </span><a href="foreigncmds.c.html#LN336"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Superusers can always do it */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>())</span> 
        <span class='Delimiter'>{ 
</span><a name="LN353"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>srvId</span><span class='Delimiter'>; 
</span><a name="LN354"></a>            <a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
            <a href="foreigncmds.c.html#LN353"><span class='Ref_To_Local'>srvId</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN336"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Must be owner */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN324"><span class='Ref_to_Proto'>pg_foreign_server_ownercheck</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN353"><span class='Ref_To_Local'>srvId</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
                <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN199"><span class='Ref_to_EnumConst'>ACL_KIND_FOREIGN_SERVER</span></a><span class='Delimiter'>, 
</span>                               <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN338"><span class='Ref_To_Local'>form</span></a><span class='Operator'>-&GT;</span>srvname<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Must be able to become new owner */ 
</span>            <a href="../../include/utils/acl.h.html#LN233"><span class='Ref_to_Proto'>check_is_member_of_role</span></a><span class='Parentheses'>(</span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN336"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* New owner must have USAGE privilege on foreign-data wrapper */ 
</span>            <a href="foreigncmds.c.html#LN354"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN291"><span class='Ref_to_Proto'>pg_foreign_data_wrapper_aclcheck</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN338"><span class='Ref_To_Local'>form</span></a><span class='Operator'>-&GT;</span>srvfdw<span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN336"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN354"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN370"></a>                <a href="../../include/foreign/foreign.h.html#LN34"><span class='Ref_to_Struct'>ForeignDataWrapper</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fdw</span> <span class='Operator'>= </span><a href="../foreign/foreign.c.html#LN33"><span class='Ref_to_Func'>GetForeignDataWrapper</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN338"><span class='Ref_To_Local'>form</span></a><span class='Operator'>-&GT;</span>srvfdw<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN354"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN198"><span class='Ref_to_EnumConst'>ACL_KIND_FDW</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN370"><span class='Ref_To_Local'>fdw</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN38"><span class='Ref_to_Member'>fdwname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !superuser() &raquo; </span> 
 
        memset<span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN340"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN340"><span class='Ref_To_Local'>repl_null</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memset<span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN341"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN341"><span class='Ref_To_Local'>repl_repl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="foreigncmds.c.html#LN341"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_server.h.html#LN56"><span class='Ref_to_Const'>Anum_pg_foreign_server_srvowner</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="foreigncmds.c.html#LN339"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_server.h.html#LN56"><span class='Ref_to_Const'>Anum_pg_foreign_server_srvowner</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN336"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="foreigncmds.c.html#LN343"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN768"><span class='Ref_to_Macro'>heap_getattr</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN336"><span class='Ref_to_Parameter'>tup</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/catalog/pg_foreign_server.h.html#LN60"><span class='Ref_to_Const'>Anum_pg_foreign_server_srvacl</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN336"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="foreigncmds.c.html#LN344"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Null ACLs do not require changes */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="foreigncmds.c.html#LN344"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="foreigncmds.c.html#LN342"><span class='Ref_To_Local'>newAcl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN217"><span class='Ref_to_Proto'>aclnewowner</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN112"><span class='Ref_to_Macro'>DatumGetAclP</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN343"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="foreigncmds.c.html#LN338"><span class='Ref_To_Local'>form</span></a><span class='Operator'>-&GT;</span>srvowner<span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN336"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="foreigncmds.c.html#LN341"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_server.h.html#LN60"><span class='Ref_to_Const'>Anum_pg_foreign_server_srvacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="foreigncmds.c.html#LN339"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_server.h.html#LN60"><span class='Ref_to_Const'>Anum_pg_foreign_server_srvacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN342"><span class='Ref_To_Local'>newAcl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="foreigncmds.c.html#LN336"><span class='Ref_to_Parameter'>tup</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN336"><span class='Ref_to_Parameter'>tup</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN336"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN339"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN340"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>, 
</span>                                <a href="foreigncmds.c.html#LN341"><span class='Ref_To_Local'>repl_repl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN336"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="foreigncmds.c.html#LN336"><span class='Ref_to_Parameter'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN336"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Update owner dependency reference */ 
</span>        <a href="../../include/catalog/dependency.h.html#LN259"><span class='Ref_to_Proto'>changeDependencyOnOwner</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_server.h.html#LN26"><span class='Ref_to_Const'>ForeignServerRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN336"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="foreigncmds.c.html#LN336"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if form-&GT;srvowner!=newOw... &raquo; </span> 
 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_server.h.html#LN26"><span class='Ref_to_Const'>ForeignServerRelationId</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN336"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterForeignServerOwner_internal &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Change foreign server owner -- by name 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN413"></a><span class='Declare_Function'>AlterForeignServerOwner</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>newOwnerId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN415"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>servOid</span><span class='Delimiter'>; 
</span><a name="LN416"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN417"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN418"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN417"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_server.h.html#LN26"><span class='Ref_to_Const'>ForeignServerRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN416"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN62"><span class='Ref_to_EnumConst'>FOREIGNSERVERNAME</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN413"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN416"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"server \"%s\" does not exist"</span><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN413"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN415"><span class='Ref_To_Local'>servOid</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN416"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN335"><span class='Ref_to_Func'>AlterForeignServerOwner_internal</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN417"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN416"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN413"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN418"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_foreign_server.h.html#LN26"><span class='Ref_to_Const'>ForeignServerRelationId</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN415"><span class='Ref_To_Local'>servOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN416"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN417"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="foreigncmds.c.html#LN418"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterForeignServerOwner &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Change foreign server owner -- by OID 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN446"></a><span class='Declare_Function'>AlterForeignServerOwner_oid</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>srvId</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>newOwnerId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN448"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN449"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN449"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_server.h.html#LN26"><span class='Ref_to_Const'>ForeignServerRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN448"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN63"><span class='Ref_to_EnumConst'>FOREIGNSERVEROID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN446"><span class='Ref_to_Parameter'>srvId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN448"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"foreign server with OID %u does not exist"</span><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN446"><span class='Ref_to_Parameter'>srvId</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN335"><span class='Ref_to_Func'>AlterForeignServerOwner_internal</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN449"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN448"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN446"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN448"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN449"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterForeignServerOwner_oid &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Convert a handler function name passed from the parser to an Oid. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN471"></a><span class='Declare_Function'>lookup_fdw_handler_func</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>handler</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN473"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>handlerOid</span><span class='Delimiter'>; 
</span><a name="LN474"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>funcargtypes</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>];</span>    <span class='Comment_Single_Line'>/* dummy */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN471"><span class='Ref_to_Parameter'>handler</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="foreigncmds.c.html#LN471"><span class='Ref_to_Parameter'>handler</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* handlers have no arguments */ 
</span>    <a href="foreigncmds.c.html#LN473"><span class='Ref_To_Local'>handlerOid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_func.h.html#LN62"><span class='Ref_to_Proto'>LookupFuncName</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="foreigncmds.c.html#LN471"><span class='Ref_to_Parameter'>handler</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN474"><span class='Ref_To_Local'>funcargtypes</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* check that handler has correct return type */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/lsyscache.h.html#LN112"><span class='Ref_to_Proto'>get_func_rettype</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN473"><span class='Ref_To_Local'>handlerOid</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../include/catalog/pg_type.h.html#LN707"><span class='Ref_to_Const'>FDW_HANDLEROID</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"function %s must return type %s"</span><span class='Delimiter'>, 
</span>                   <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="foreigncmds.c.html#LN471"><span class='Ref_to_Parameter'>handler</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"fdw_handler"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="foreigncmds.c.html#LN473"><span class='Ref_To_Local'>handlerOid</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end lookup_fdw_handler_func &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Convert a validator function name passed from the parser to an Oid. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN496"></a><span class='Declare_Function'>lookup_fdw_validator_func</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>validator</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN498"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>funcargtypes</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN496"><span class='Ref_to_Parameter'>validator</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="foreigncmds.c.html#LN496"><span class='Ref_to_Parameter'>validator</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* validators take text[], oid */ 
</span>    <a href="foreigncmds.c.html#LN498"><span class='Ref_To_Local'>funcargtypes</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/catalog/pg_type.h.html#LN469"><span class='Ref_to_Const'>TEXTARRAYOID</span></a><span class='Delimiter'>; 
</span>    <a href="foreigncmds.c.html#LN498"><span class='Ref_To_Local'>funcargtypes</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN27"><span class='Ref_to_Const'>OIDOID</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/parser/parse_func.h.html#LN62"><span class='Ref_to_Proto'>LookupFuncName</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="foreigncmds.c.html#LN496"><span class='Ref_to_Parameter'>validator</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN498"><span class='Ref_To_Local'>funcargtypes</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* validator's return value is ignored, so we don't check the type */ 
</span><span class='Delimiter'>} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Process function options of CREATE/ALTER FDW 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN515"></a><span class='Declare_Function'>parse_func_options</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>func_options</span><span class='Delimiter'>, 
</span><a name="LN516"></a>                   <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>handler_given</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fdwhandler</span><span class='Delimiter'>, 
</span><a name="LN517"></a>                   <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>validator_given</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fdwvalidator</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN519"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="foreigncmds.c.html#LN516"><span class='Ref_to_Parameter'>handler_given</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="foreigncmds.c.html#LN517"><span class='Ref_to_Parameter'>validator_given</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* return InvalidOid if not given */ 
</span>    <span class='Operator'>*</span><a href="foreigncmds.c.html#LN516"><span class='Ref_to_Parameter'>fdwhandler</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="foreigncmds.c.html#LN517"><span class='Ref_to_Parameter'>fdwvalidator</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN519"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN515"><span class='Ref_to_Parameter'>func_options</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN529"></a>        <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>def</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN519"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN529"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"handler"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="foreigncmds.c.html#LN516"><span class='Ref_to_Parameter'>handler_given</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="foreigncmds.c.html#LN516"><span class='Ref_to_Parameter'>handler_given</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="foreigncmds.c.html#LN516"><span class='Ref_to_Parameter'>fdwhandler</span></a> <span class='Operator'>= </span><a href="foreigncmds.c.html#LN470"><span class='Ref_to_Func'>lookup_fdw_handler_func</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN529"><span class='Ref_To_Local'>def</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN529"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"validator"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="foreigncmds.c.html#LN517"><span class='Ref_to_Parameter'>validator_given</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="foreigncmds.c.html#LN517"><span class='Ref_to_Parameter'>validator_given</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="foreigncmds.c.html#LN517"><span class='Ref_to_Parameter'>fdwvalidator</span></a> <span class='Operator'>= </span><a href="foreigncmds.c.html#LN495"><span class='Ref_to_Func'>lookup_fdw_validator_func</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN529"><span class='Ref_To_Local'>def</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"option \"%s\" not recognized"</span><span class='Delimiter'>, 
</span>                 <a href="foreigncmds.c.html#LN529"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end parse_func_options &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Create a foreign-data wrapper 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN559"></a><span class='Declare_Function'>CreateForeignDataWrapper</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2170"><span class='Ref_to_Struct'>CreateFdwStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN561"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN562"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN55"><span class='Ref_to_Const'>Natts_pg_foreign_data_wrapper</span></a><span class='Delimiter'>]; 
</span><a name="LN563"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN55"><span class='Ref_to_Const'>Natts_pg_foreign_data_wrapper</span></a><span class='Delimiter'>]; 
</span><a name="LN564"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN565"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>fdwId</span><span class='Delimiter'>; 
</span><a name="LN566"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>handler_given</span><span class='Delimiter'>; 
</span><a name="LN567"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>validator_given</span><span class='Delimiter'>; 
</span><a name="LN568"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>fdwhandler</span><span class='Delimiter'>; 
</span><a name="LN569"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>fdwvalidator</span><span class='Delimiter'>; 
</span><a name="LN570"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>fdwoptions</span><span class='Delimiter'>; 
</span><a name="LN571"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span><a name="LN572"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>myself</span><span class='Delimiter'>; 
</span><a name="LN573"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>referenced</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN561"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN28"><span class='Ref_to_Const'>ForeignDataWrapperRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Must be super user */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>())</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied to create foreign-data wrapper \"%s\""</span><span class='Delimiter'>, 
</span>                   <a href="foreigncmds.c.html#LN559"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2173"><span class='Ref_to_Member'>fdwname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Must be superuser to create a foreign-data wrapper."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* For now the owner cannot be specified on create. Use effective user ID. */ 
</span>    <a href="foreigncmds.c.html#LN571"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check that there is no other foreign-data wrapper by this name. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/foreign/foreign.h.html#LN75"><span class='Ref_to_Proto'>GetForeignDataWrapperByName</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN559"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2173"><span class='Ref_to_Member'>fdwname</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/pg_basebackup/streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"foreign-data wrapper \"%s\" already exists"</span><span class='Delimiter'>, 
</span>                        <a href="foreigncmds.c.html#LN559"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2173"><span class='Ref_to_Member'>fdwname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Insert tuple into pg_foreign_data_wrapper. 
     */ 
</span>    memset<span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN562"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN562"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN563"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN563"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN562"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN56"><span class='Ref_to_Const'>Anum_pg_foreign_data_wrapper_fdwname</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>        <a href="../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../utils/adt/name.c.html#LN44"><span class='Ref_to_Func'>namein</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN559"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2173"><span class='Ref_to_Member'>fdwname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="foreigncmds.c.html#LN562"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN57"><span class='Ref_to_Const'>Anum_pg_foreign_data_wrapper_fdwowner</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN571"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Lookup handler and validator functions, if given */ 
</span>    <a href="foreigncmds.c.html#LN514"><span class='Ref_to_Func'>parse_func_options</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN559"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2174"><span class='Ref_to_Member'>func_options</span></a><span class='Delimiter'>, 
</span>                       <span class='Operator'>&</span><a href="foreigncmds.c.html#LN566"><span class='Ref_To_Local'>handler_given</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="foreigncmds.c.html#LN568"><span class='Ref_To_Local'>fdwhandler</span></a><span class='Delimiter'>, 
</span>                       <span class='Operator'>&</span><a href="foreigncmds.c.html#LN567"><span class='Ref_To_Local'>validator_given</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="foreigncmds.c.html#LN569"><span class='Ref_To_Local'>fdwvalidator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN562"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN58"><span class='Ref_to_Const'>Anum_pg_foreign_data_wrapper_fdwhandler</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN568"><span class='Ref_To_Local'>fdwhandler</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="foreigncmds.c.html#LN562"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN59"><span class='Ref_to_Const'>Anum_pg_foreign_data_wrapper_fdwvalidator</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN569"><span class='Ref_To_Local'>fdwvalidator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN563"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN60"><span class='Ref_to_Const'>Anum_pg_foreign_data_wrapper_fdwacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN570"><span class='Ref_To_Local'>fdwoptions</span></a> <span class='Operator'>= </span><a href="foreigncmds.c.html#LN107"><span class='Ref_to_Func'>transformGenericOptions</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN28"><span class='Ref_to_Const'>ForeignDataWrapperRelationId</span></a><span class='Delimiter'>, 
</span>                                         <a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <a href="foreigncmds.c.html#LN559"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2175"><span class='Ref_to_Member'>options</span></a><span class='Delimiter'>, 
</span>                                         <a href="foreigncmds.c.html#LN569"><span class='Ref_To_Local'>fdwvalidator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN525"><span class='Ref_to_Macro'>PointerIsValid</span></a><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN570"><span class='Ref_To_Local'>fdwoptions</span></a><span class='Parentheses'>)))</span> 
        <a href="foreigncmds.c.html#LN562"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN61"><span class='Ref_to_Const'>Anum_pg_foreign_data_wrapper_fdwoptions</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="foreigncmds.c.html#LN570"><span class='Ref_To_Local'>fdwoptions</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="foreigncmds.c.html#LN563"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN61"><span class='Ref_to_Const'>Anum_pg_foreign_data_wrapper_fdwoptions</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN564"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN561"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN562"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN563"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN565"><span class='Ref_To_Local'>fdwId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/indexing.h.html#LN32"><span class='Ref_to_Proto'>CatalogTupleInsert</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN561"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN564"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN564"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* record dependencies */ 
</span>    <a href="foreigncmds.c.html#LN572"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN28"><span class='Ref_to_Const'>ForeignDataWrapperRelationId</span></a><span class='Delimiter'>; 
</span>    <a href="foreigncmds.c.html#LN572"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="foreigncmds.c.html#LN565"><span class='Ref_To_Local'>fdwId</span></a><span class='Delimiter'>; 
</span>    <a href="foreigncmds.c.html#LN572"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN568"><span class='Ref_To_Local'>fdwhandler</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="foreigncmds.c.html#LN573"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_proc.h.html#LN32"><span class='Ref_to_Const'>ProcedureRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="foreigncmds.c.html#LN573"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="foreigncmds.c.html#LN568"><span class='Ref_To_Local'>fdwhandler</span></a><span class='Delimiter'>; 
</span>        <a href="foreigncmds.c.html#LN573"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="foreigncmds.c.html#LN572"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="foreigncmds.c.html#LN573"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN569"><span class='Ref_To_Local'>fdwvalidator</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="foreigncmds.c.html#LN573"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_proc.h.html#LN32"><span class='Ref_to_Const'>ProcedureRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="foreigncmds.c.html#LN573"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="foreigncmds.c.html#LN569"><span class='Ref_To_Local'>fdwvalidator</span></a><span class='Delimiter'>; 
</span>        <a href="foreigncmds.c.html#LN573"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="foreigncmds.c.html#LN572"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="foreigncmds.c.html#LN573"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../catalog/pg_shdepend.c.html#LN157"><span class='Ref_to_Func'>recordDependencyOnOwner</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN28"><span class='Ref_to_Const'>ForeignDataWrapperRelationId</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN565"><span class='Ref_To_Local'>fdwId</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN571"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* dependency on extension */ 
</span>    <a href="../catalog/pg_depend.c.html#LN137"><span class='Ref_to_Func'>recordDependencyOnCurrentExtension</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="foreigncmds.c.html#LN572"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Post creation hook for new foreign data wrapper */ 
</span>    <a href="../../include/catalog/objectaccess.h.html#LN144"><span class='Ref_to_Macro'>InvokeObjectPostCreateHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN28"><span class='Ref_to_Const'>ForeignDataWrapperRelationId</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN565"><span class='Ref_To_Local'>fdwId</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN561"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="foreigncmds.c.html#LN572"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CreateForeignDataWrapper &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Alter foreign-data wrapper 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN672"></a><span class='Declare_Function'>AlterForeignDataWrapper</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2178"><span class='Ref_to_Struct'>AlterFdwStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN674"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN675"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tp</span><span class='Delimiter'>; 
</span><a name="LN676"></a>    <a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN48"><span class='Ref_to_Typedef'>Form_pg_foreign_data_wrapper</span></a> <span class='Declare_Local'>fdwForm</span><span class='Delimiter'>; 
</span><a name="LN677"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>repl_val</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN55"><span class='Ref_to_Const'>Natts_pg_foreign_data_wrapper</span></a><span class='Delimiter'>]; 
</span><a name="LN678"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>repl_null</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN55"><span class='Ref_to_Const'>Natts_pg_foreign_data_wrapper</span></a><span class='Delimiter'>]; 
</span><a name="LN679"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>repl_repl</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN55"><span class='Ref_to_Const'>Natts_pg_foreign_data_wrapper</span></a><span class='Delimiter'>]; 
</span><a name="LN680"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>fdwId</span><span class='Delimiter'>; 
</span><a name="LN681"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN682"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>datum</span><span class='Delimiter'>; 
</span><a name="LN683"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>handler_given</span><span class='Delimiter'>; 
</span><a name="LN684"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>validator_given</span><span class='Delimiter'>; 
</span><a name="LN685"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>fdwhandler</span><span class='Delimiter'>; 
</span><a name="LN686"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>fdwvalidator</span><span class='Delimiter'>; 
</span><a name="LN687"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>myself</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN674"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN28"><span class='Ref_to_Const'>ForeignDataWrapperRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Must be super user */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>())</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied to alter foreign-data wrapper \"%s\""</span><span class='Delimiter'>, 
</span>                    <a href="foreigncmds.c.html#LN672"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2181"><span class='Ref_to_Member'>fdwname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Must be superuser to alter a foreign-data wrapper."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN675"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN60"><span class='Ref_to_EnumConst'>FOREIGNDATAWRAPPERNAME</span></a><span class='Delimiter'>, 
</span>                             <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN672"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2181"><span class='Ref_to_Member'>fdwname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN675"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"foreign-data wrapper \"%s\" does not exist"</span><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN672"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2181"><span class='Ref_to_Member'>fdwname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN676"><span class='Ref_To_Local'>fdwForm</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN48"><span class='Ref_to_Typedef'>Form_pg_foreign_data_wrapper</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN675"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="foreigncmds.c.html#LN680"><span class='Ref_To_Local'>fdwId</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN675"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    memset<span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN677"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN677"><span class='Ref_To_Local'>repl_val</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN678"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN678"><span class='Ref_To_Local'>repl_null</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN679"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN679"><span class='Ref_To_Local'>repl_repl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN514"><span class='Ref_to_Func'>parse_func_options</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN672"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2182"><span class='Ref_to_Member'>func_options</span></a><span class='Delimiter'>, 
</span>                       <span class='Operator'>&</span><a href="foreigncmds.c.html#LN683"><span class='Ref_To_Local'>handler_given</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="foreigncmds.c.html#LN685"><span class='Ref_To_Local'>fdwhandler</span></a><span class='Delimiter'>, 
</span>                       <span class='Operator'>&</span><a href="foreigncmds.c.html#LN684"><span class='Ref_To_Local'>validator_given</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="foreigncmds.c.html#LN686"><span class='Ref_To_Local'>fdwvalidator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN683"><span class='Ref_To_Local'>handler_given</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="foreigncmds.c.html#LN677"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN58"><span class='Ref_to_Const'>Anum_pg_foreign_data_wrapper_fdwhandler</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN685"><span class='Ref_To_Local'>fdwhandler</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="foreigncmds.c.html#LN679"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN58"><span class='Ref_to_Const'>Anum_pg_foreign_data_wrapper_fdwhandler</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * It could be that the behavior of accessing foreign table changes 
         * with the new handler.  Warn about this. 
         */ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"changing the foreign-data wrapper handler can change behavior of existing foreign tables"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN684"><span class='Ref_To_Local'>validator_given</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="foreigncmds.c.html#LN677"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN59"><span class='Ref_to_Const'>Anum_pg_foreign_data_wrapper_fdwvalidator</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN686"><span class='Ref_To_Local'>fdwvalidator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="foreigncmds.c.html#LN679"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN59"><span class='Ref_to_Const'>Anum_pg_foreign_data_wrapper_fdwvalidator</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * It could be that existing options for the FDW or dependent SERVER, 
         * USER MAPPING or FOREIGN TABLE objects are no longer valid according 
         * to the new validator.  Warn about this. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN686"><span class='Ref_To_Local'>fdwvalidator</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>             <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"changing the foreign-data wrapper validator can cause "</span> 
                     <span class='String'>"the options for dependent objects to become invalid"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Validator is not changed, but we need it for validating options. 
         */ 
</span>        <a href="foreigncmds.c.html#LN686"><span class='Ref_To_Local'>fdwvalidator</span></a> <span class='Operator'>= </span><a href="foreigncmds.c.html#LN676"><span class='Ref_To_Local'>fdwForm</span></a><span class='Operator'>-&GT;</span>fdwvalidator<span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If options specified, validate and update. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN672"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2183"><span class='Ref_to_Member'>options</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Extract the current options */ 
</span>        <a href="foreigncmds.c.html#LN682"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN61"><span class='Ref_to_EnumConst'>FOREIGNDATAWRAPPEROID</span></a><span class='Delimiter'>, 
</span>                                <a href="foreigncmds.c.html#LN675"><span class='Ref_To_Local'>tp</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN61"><span class='Ref_to_Const'>Anum_pg_foreign_data_wrapper_fdwoptions</span></a><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="foreigncmds.c.html#LN681"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN681"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>            <a href="foreigncmds.c.html#LN682"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Transform the options */ 
</span>        <a href="foreigncmds.c.html#LN682"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="foreigncmds.c.html#LN107"><span class='Ref_to_Func'>transformGenericOptions</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN28"><span class='Ref_to_Const'>ForeignDataWrapperRelationId</span></a><span class='Delimiter'>, 
</span>                                        <a href="foreigncmds.c.html#LN682"><span class='Ref_To_Local'>datum</span></a><span class='Delimiter'>, 
</span>                                        <a href="foreigncmds.c.html#LN672"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2183"><span class='Ref_to_Member'>options</span></a><span class='Delimiter'>, 
</span>                                        <a href="foreigncmds.c.html#LN686"><span class='Ref_To_Local'>fdwvalidator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN525"><span class='Ref_to_Macro'>PointerIsValid</span></a><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN682"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>)))</span> 
            <a href="foreigncmds.c.html#LN677"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN61"><span class='Ref_to_Const'>Anum_pg_foreign_data_wrapper_fdwoptions</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="foreigncmds.c.html#LN682"><span class='Ref_To_Local'>datum</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="foreigncmds.c.html#LN678"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN61"><span class='Ref_to_Const'>Anum_pg_foreign_data_wrapper_fdwoptions</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <a href="foreigncmds.c.html#LN679"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN61"><span class='Ref_to_Const'>Anum_pg_foreign_data_wrapper_fdwoptions</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if stmt-&GT;options &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Everything looks good - update the tuple */ 
</span>    <a href="foreigncmds.c.html#LN675"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN675"><span class='Ref_To_Local'>tp</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN674"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="foreigncmds.c.html#LN677"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN678"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN679"><span class='Ref_To_Local'>repl_repl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN674"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="foreigncmds.c.html#LN675"><span class='Ref_To_Local'>tp</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN675"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN675"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN687"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN28"><span class='Ref_to_Const'>ForeignDataWrapperRelationId</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN680"><span class='Ref_To_Local'>fdwId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Update function dependencies if we changed them */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN683"><span class='Ref_To_Local'>handler_given</span></a> <span class='Operator'>|| </span><a href="foreigncmds.c.html#LN684"><span class='Ref_To_Local'>validator_given</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN794"></a>        <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>referenced</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Flush all existing dependency records of this FDW on functions; we 
         * assume there can be none other than the ones we are fixing. 
         */ 
</span>        <a href="../../include/catalog/dependency.h.html#LN231"><span class='Ref_to_Proto'>deleteDependencyRecordsForClass</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN28"><span class='Ref_to_Const'>ForeignDataWrapperRelationId</span></a><span class='Delimiter'>, 
</span>                                        <a href="foreigncmds.c.html#LN680"><span class='Ref_To_Local'>fdwId</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../include/catalog/pg_proc.h.html#LN32"><span class='Ref_to_Const'>ProcedureRelationId</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* And build new ones. */ 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN685"><span class='Ref_To_Local'>fdwhandler</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="foreigncmds.c.html#LN794"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_proc.h.html#LN32"><span class='Ref_to_Const'>ProcedureRelationId</span></a><span class='Delimiter'>; 
</span>            <a href="foreigncmds.c.html#LN794"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="foreigncmds.c.html#LN685"><span class='Ref_To_Local'>fdwhandler</span></a><span class='Delimiter'>; 
</span>            <a href="foreigncmds.c.html#LN794"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="foreigncmds.c.html#LN687"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="foreigncmds.c.html#LN794"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN686"><span class='Ref_To_Local'>fdwvalidator</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="foreigncmds.c.html#LN794"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_proc.h.html#LN32"><span class='Ref_to_Const'>ProcedureRelationId</span></a><span class='Delimiter'>; 
</span>            <a href="foreigncmds.c.html#LN794"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="foreigncmds.c.html#LN686"><span class='Ref_To_Local'>fdwvalidator</span></a><span class='Delimiter'>; 
</span>            <a href="foreigncmds.c.html#LN794"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="foreigncmds.c.html#LN687"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="foreigncmds.c.html#LN794"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if handler_given||valida... &raquo; </span> 
 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN28"><span class='Ref_to_Const'>ForeignDataWrapperRelationId</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN680"><span class='Ref_To_Local'>fdwId</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN674"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="foreigncmds.c.html#LN687"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterForeignDataWrapper &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Drop foreign-data wrapper by OID 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN836"></a><span class='Declare_Function'>RemoveForeignDataWrapperById</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>fdwId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN838"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tp</span><span class='Delimiter'>; 
</span><a name="LN839"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN839"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN28"><span class='Ref_to_Const'>ForeignDataWrapperRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN838"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN61"><span class='Ref_to_EnumConst'>FOREIGNDATAWRAPPEROID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN836"><span class='Ref_to_Parameter'>fdwId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN838"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for foreign-data wrapper %u"</span><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN836"><span class='Ref_to_Parameter'>fdwId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN40"><span class='Ref_to_Proto'>CatalogTupleDelete</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN839"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="foreigncmds.c.html#LN838"><span class='Ref_To_Local'>tp</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN838"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN839"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Create a foreign server 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN860"></a><span class='Declare_Function'>CreateForeignServer</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2191"><span class='Ref_to_Struct'>CreateForeignServerStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN862"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN863"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>srvoptions</span><span class='Delimiter'>; 
</span><a name="LN864"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_server.h.html#LN54"><span class='Ref_to_Const'>Natts_pg_foreign_server</span></a><span class='Delimiter'>]; 
</span><a name="LN865"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_server.h.html#LN54"><span class='Ref_to_Const'>Natts_pg_foreign_server</span></a><span class='Delimiter'>]; 
</span><a name="LN866"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN867"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>srvId</span><span class='Delimiter'>; 
</span><a name="LN868"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span><a name="LN869"></a>    <a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span><a name="LN870"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>myself</span><span class='Delimiter'>; 
</span><a name="LN871"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>referenced</span><span class='Delimiter'>; 
</span><a name="LN872"></a>    <a href="../../include/foreign/foreign.h.html#LN34"><span class='Ref_to_Struct'>ForeignDataWrapper</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fdw</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN862"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_server.h.html#LN26"><span class='Ref_to_Const'>ForeignServerRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* For now the owner cannot be specified on create. Use effective user ID. */ 
</span>    <a href="foreigncmds.c.html#LN868"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check that there is no other foreign server by this name. Do nothing if 
     * IF NOT EXISTS was enforced. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/foreign/foreign.h.html#LN72"><span class='Ref_to_Proto'>GetForeignServerByName</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN860"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2194"><span class='Ref_to_Member'>servername</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN860"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2198"><span class='Ref_to_Member'>if_not_exists</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/pg_basebackup/streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"server \"%s\" already exists, skipping"</span><span class='Delimiter'>, 
</span>                            <a href="foreigncmds.c.html#LN860"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2194"><span class='Ref_to_Member'>servername</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN862"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="../catalog/objectaddress.c.html#LN718"><span class='Ref_to_Global_Var'>InvalidObjectAddress</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/pg_basebackup/streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"server \"%s\" already exists"</span><span class='Delimiter'>, 
</span>                            <a href="foreigncmds.c.html#LN860"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2194"><span class='Ref_to_Member'>servername</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check that the FDW exists and that we have USAGE on it. Also get the 
     * actual FDW for option validation etc. 
     */ 
</span>    <a href="foreigncmds.c.html#LN872"><span class='Ref_To_Local'>fdw</span></a> <span class='Operator'>= </span><a href="../../include/foreign/foreign.h.html#LN75"><span class='Ref_to_Proto'>GetForeignDataWrapperByName</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN860"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2197"><span class='Ref_to_Member'>fdwname</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN869"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN291"><span class='Ref_to_Proto'>pg_foreign_data_wrapper_aclcheck</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN872"><span class='Ref_To_Local'>fdw</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN36"><span class='Ref_to_Member'>fdwid</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN868"><span class='Ref_To_Local'>ownerId</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN869"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN869"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN198"><span class='Ref_to_EnumConst'>ACL_KIND_FDW</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN872"><span class='Ref_To_Local'>fdw</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN38"><span class='Ref_to_Member'>fdwname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Insert tuple into pg_foreign_server. 
     */ 
</span>    memset<span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN864"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN864"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN865"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN865"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN864"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_server.h.html#LN55"><span class='Ref_to_Const'>Anum_pg_foreign_server_srvname</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>        <a href="../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../utils/adt/name.c.html#LN44"><span class='Ref_to_Func'>namein</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN860"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2194"><span class='Ref_to_Member'>servername</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="foreigncmds.c.html#LN864"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_server.h.html#LN56"><span class='Ref_to_Const'>Anum_pg_foreign_server_srvowner</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN868"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="foreigncmds.c.html#LN864"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_server.h.html#LN57"><span class='Ref_to_Const'>Anum_pg_foreign_server_srvfdw</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN872"><span class='Ref_To_Local'>fdw</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN36"><span class='Ref_to_Member'>fdwid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Add server type if supplied */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN860"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2195"><span class='Ref_to_Member'>servertype</span></a><span class='Parentheses'>) 
</span>        <a href="foreigncmds.c.html#LN864"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_server.h.html#LN58"><span class='Ref_to_Const'>Anum_pg_foreign_server_srvtype</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>            <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN860"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2195"><span class='Ref_to_Member'>servertype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="foreigncmds.c.html#LN865"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_server.h.html#LN58"><span class='Ref_to_Const'>Anum_pg_foreign_server_srvtype</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Add server version if supplied */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN860"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2196"><span class='Ref_to_Member'>version</span></a><span class='Parentheses'>) 
</span>        <a href="foreigncmds.c.html#LN864"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_server.h.html#LN59"><span class='Ref_to_Const'>Anum_pg_foreign_server_srvversion</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>            <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN860"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2196"><span class='Ref_to_Member'>version</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="foreigncmds.c.html#LN865"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_server.h.html#LN59"><span class='Ref_to_Const'>Anum_pg_foreign_server_srvversion</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Start with a blank acl */ 
</span>    <a href="foreigncmds.c.html#LN865"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_server.h.html#LN60"><span class='Ref_to_Const'>Anum_pg_foreign_server_srvacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Add server options */ 
</span>    <a href="foreigncmds.c.html#LN863"><span class='Ref_To_Local'>srvoptions</span></a> <span class='Operator'>= </span><a href="foreigncmds.c.html#LN107"><span class='Ref_to_Func'>transformGenericOptions</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_server.h.html#LN26"><span class='Ref_to_Const'>ForeignServerRelationId</span></a><span class='Delimiter'>, 
</span>                                         <a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <a href="foreigncmds.c.html#LN860"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2199"><span class='Ref_to_Member'>options</span></a><span class='Delimiter'>, 
</span>                                         <a href="foreigncmds.c.html#LN872"><span class='Ref_To_Local'>fdw</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN40"><span class='Ref_to_Member'>fdwvalidator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN525"><span class='Ref_to_Macro'>PointerIsValid</span></a><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN863"><span class='Ref_To_Local'>srvoptions</span></a><span class='Parentheses'>)))</span> 
        <a href="foreigncmds.c.html#LN864"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_server.h.html#LN61"><span class='Ref_to_Const'>Anum_pg_foreign_server_srvoptions</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="foreigncmds.c.html#LN863"><span class='Ref_To_Local'>srvoptions</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="foreigncmds.c.html#LN865"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_server.h.html#LN61"><span class='Ref_to_Const'>Anum_pg_foreign_server_srvoptions</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN866"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN862"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN864"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN865"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN867"><span class='Ref_To_Local'>srvId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/indexing.h.html#LN32"><span class='Ref_to_Proto'>CatalogTupleInsert</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN862"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN866"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN866"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* record dependencies */ 
</span>    <a href="foreigncmds.c.html#LN870"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_foreign_server.h.html#LN26"><span class='Ref_to_Const'>ForeignServerRelationId</span></a><span class='Delimiter'>; 
</span>    <a href="foreigncmds.c.html#LN870"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="foreigncmds.c.html#LN867"><span class='Ref_To_Local'>srvId</span></a><span class='Delimiter'>; 
</span>    <a href="foreigncmds.c.html#LN870"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN871"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN28"><span class='Ref_to_Const'>ForeignDataWrapperRelationId</span></a><span class='Delimiter'>; 
</span>    <a href="foreigncmds.c.html#LN871"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="foreigncmds.c.html#LN872"><span class='Ref_To_Local'>fdw</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN36"><span class='Ref_to_Member'>fdwid</span></a><span class='Delimiter'>; 
</span>    <a href="foreigncmds.c.html#LN871"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="foreigncmds.c.html#LN870"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="foreigncmds.c.html#LN871"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../catalog/pg_shdepend.c.html#LN157"><span class='Ref_to_Func'>recordDependencyOnOwner</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_server.h.html#LN26"><span class='Ref_to_Const'>ForeignServerRelationId</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN867"><span class='Ref_To_Local'>srvId</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN868"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* dependency on extension */ 
</span>    <a href="../catalog/pg_depend.c.html#LN137"><span class='Ref_to_Func'>recordDependencyOnCurrentExtension</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="foreigncmds.c.html#LN870"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Post creation hook for new foreign server */ 
</span>    <a href="../../include/catalog/objectaccess.h.html#LN144"><span class='Ref_to_Macro'>InvokeObjectPostCreateHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_server.h.html#LN26"><span class='Ref_to_Const'>ForeignServerRelationId</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN867"><span class='Ref_To_Local'>srvId</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN862"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="foreigncmds.c.html#LN870"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CreateForeignServer &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Alter foreign server 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN984"></a><span class='Declare_Function'>AlterForeignServer</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2202"><span class='Ref_to_Struct'>AlterForeignServerStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN986"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN987"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tp</span><span class='Delimiter'>; 
</span><a name="LN988"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>repl_val</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_server.h.html#LN54"><span class='Ref_to_Const'>Natts_pg_foreign_server</span></a><span class='Delimiter'>]; 
</span><a name="LN989"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>repl_null</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_server.h.html#LN54"><span class='Ref_to_Const'>Natts_pg_foreign_server</span></a><span class='Delimiter'>]; 
</span><a name="LN990"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>repl_repl</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_server.h.html#LN54"><span class='Ref_to_Const'>Natts_pg_foreign_server</span></a><span class='Delimiter'>]; 
</span><a name="LN991"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>srvId</span><span class='Delimiter'>; 
</span><a name="LN992"></a>    <a href="../../include/catalog/pg_foreign_server.h.html#LN47"><span class='Ref_to_Typedef'>Form_pg_foreign_server</span></a> <span class='Declare_Local'>srvForm</span><span class='Delimiter'>; 
</span><a name="LN993"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN986"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_server.h.html#LN26"><span class='Ref_to_Const'>ForeignServerRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN987"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN62"><span class='Ref_to_EnumConst'>FOREIGNSERVERNAME</span></a><span class='Delimiter'>, 
</span>                             <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN984"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2205"><span class='Ref_to_Member'>servername</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN987"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"server \"%s\" does not exist"</span><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN984"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2205"><span class='Ref_to_Member'>servername</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN991"><span class='Ref_To_Local'>srvId</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN987"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="foreigncmds.c.html#LN992"><span class='Ref_To_Local'>srvForm</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_server.h.html#LN47"><span class='Ref_to_Typedef'>Form_pg_foreign_server</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN987"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Only owner or a superuser can ALTER a SERVER. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN324"><span class='Ref_to_Proto'>pg_foreign_server_ownercheck</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN991"><span class='Ref_To_Local'>srvId</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN199"><span class='Ref_to_EnumConst'>ACL_KIND_FOREIGN_SERVER</span></a><span class='Delimiter'>, 
</span>                       <a href="foreigncmds.c.html#LN984"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2205"><span class='Ref_to_Member'>servername</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    memset<span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN988"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN988"><span class='Ref_To_Local'>repl_val</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN989"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN989"><span class='Ref_To_Local'>repl_null</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN990"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN990"><span class='Ref_To_Local'>repl_repl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN984"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2208"><span class='Ref_to_Member'>has_version</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Change the server VERSION string. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN984"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2206"><span class='Ref_to_Member'>version</span></a><span class='Parentheses'>) 
</span>            <a href="foreigncmds.c.html#LN988"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_server.h.html#LN59"><span class='Ref_to_Const'>Anum_pg_foreign_server_srvversion</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN984"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2206"><span class='Ref_to_Member'>version</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="foreigncmds.c.html#LN989"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_server.h.html#LN59"><span class='Ref_to_Const'>Anum_pg_foreign_server_srvversion</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <a href="foreigncmds.c.html#LN990"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_server.h.html#LN59"><span class='Ref_to_Const'>Anum_pg_foreign_server_srvversion</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN984"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2207"><span class='Ref_to_Member'>options</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1035"></a>        <a href="../../include/foreign/foreign.h.html#LN34"><span class='Ref_to_Struct'>ForeignDataWrapper</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fdw</span> <span class='Operator'>= </span><a href="../foreign/foreign.c.html#LN33"><span class='Ref_to_Func'>GetForeignDataWrapper</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN992"><span class='Ref_To_Local'>srvForm</span></a><span class='Operator'>-&GT;</span>srvfdw<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1036"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>datum</span><span class='Delimiter'>; 
</span><a name="LN1037"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Extract the current srvoptions */ 
</span>        <a href="foreigncmds.c.html#LN1036"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN63"><span class='Ref_to_EnumConst'>FOREIGNSERVEROID</span></a><span class='Delimiter'>, 
</span>                                <a href="foreigncmds.c.html#LN987"><span class='Ref_To_Local'>tp</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/catalog/pg_foreign_server.h.html#LN61"><span class='Ref_to_Const'>Anum_pg_foreign_server_srvoptions</span></a><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="foreigncmds.c.html#LN1037"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1037"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>            <a href="foreigncmds.c.html#LN1036"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Prepare the options array */ 
</span>        <a href="foreigncmds.c.html#LN1036"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="foreigncmds.c.html#LN107"><span class='Ref_to_Func'>transformGenericOptions</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_server.h.html#LN26"><span class='Ref_to_Const'>ForeignServerRelationId</span></a><span class='Delimiter'>, 
</span>                                        <a href="foreigncmds.c.html#LN1036"><span class='Ref_To_Local'>datum</span></a><span class='Delimiter'>, 
</span>                                        <a href="foreigncmds.c.html#LN984"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2207"><span class='Ref_to_Member'>options</span></a><span class='Delimiter'>, 
</span>                                        <a href="foreigncmds.c.html#LN1035"><span class='Ref_To_Local'>fdw</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN40"><span class='Ref_to_Member'>fdwvalidator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN525"><span class='Ref_to_Macro'>PointerIsValid</span></a><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1036"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>)))</span> 
            <a href="foreigncmds.c.html#LN988"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_server.h.html#LN61"><span class='Ref_to_Const'>Anum_pg_foreign_server_srvoptions</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="foreigncmds.c.html#LN1036"><span class='Ref_To_Local'>datum</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="foreigncmds.c.html#LN989"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_server.h.html#LN61"><span class='Ref_to_Const'>Anum_pg_foreign_server_srvoptions</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <a href="foreigncmds.c.html#LN990"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_server.h.html#LN61"><span class='Ref_to_Const'>Anum_pg_foreign_server_srvoptions</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if stmt-&GT;options &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Everything looks good - update the tuple */ 
</span>    <a href="foreigncmds.c.html#LN987"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN987"><span class='Ref_To_Local'>tp</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN986"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="foreigncmds.c.html#LN988"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN989"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN990"><span class='Ref_To_Local'>repl_repl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN986"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="foreigncmds.c.html#LN987"><span class='Ref_To_Local'>tp</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN987"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_server.h.html#LN26"><span class='Ref_to_Const'>ForeignServerRelationId</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN991"><span class='Ref_To_Local'>srvId</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN993"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_foreign_server.h.html#LN26"><span class='Ref_to_Const'>ForeignServerRelationId</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN991"><span class='Ref_To_Local'>srvId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN987"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN986"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="foreigncmds.c.html#LN993"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterForeignServer &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Drop foreign server by OID 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1083"></a><span class='Declare_Function'>RemoveForeignServerById</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>srvId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1085"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tp</span><span class='Delimiter'>; 
</span><a name="LN1086"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN1086"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_server.h.html#LN26"><span class='Ref_to_Const'>ForeignServerRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN1085"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN63"><span class='Ref_to_EnumConst'>FOREIGNSERVEROID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1083"><span class='Ref_to_Parameter'>srvId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1085"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for foreign server %u"</span><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN1083"><span class='Ref_to_Parameter'>srvId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN40"><span class='Ref_to_Proto'>CatalogTupleDelete</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1086"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="foreigncmds.c.html#LN1085"><span class='Ref_To_Local'>tp</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1085"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1086"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Common routine to check permission for user-mapping-related DDL 
 * commands.  We allow server owners to operate on any mapping, and 
 * users to operate on their own mapping. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1109"></a><span class='Declare_Function'>user_mapping_ddl_aclcheck</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>umuserid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>serverid</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>servername</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1111"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>curuserid</span> <span class='Operator'>= </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN324"><span class='Ref_to_Proto'>pg_foreign_server_ownercheck</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1109"><span class='Ref_to_Parameter'>serverid</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN1111"><span class='Ref_To_Local'>curuserid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1109"><span class='Ref_to_Parameter'>umuserid</span></a> <span class='Operator'>== </span><a href="foreigncmds.c.html#LN1111"><span class='Ref_To_Local'>curuserid</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1117"></a>            <a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
            <a href="foreigncmds.c.html#LN1117"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN292"><span class='Ref_to_Proto'>pg_foreign_server_aclcheck</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1109"><span class='Ref_to_Parameter'>serverid</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN1111"><span class='Ref_To_Local'>curuserid</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1117"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1117"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN199"><span class='Ref_to_EnumConst'>ACL_KIND_FOREIGN_SERVER</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN1109"><span class='Ref_to_Parameter'>servername</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN199"><span class='Ref_to_EnumConst'>ACL_KIND_FOREIGN_SERVER</span></a><span class='Delimiter'>, 
</span>                           <a href="foreigncmds.c.html#LN1109"><span class='Ref_to_Parameter'>servername</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end user_mapping_ddl_aclcheck &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Create user mapping 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN1134"></a><span class='Declare_Function'>CreateUserMapping</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2228"><span class='Ref_to_Struct'>CreateUserMappingStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1136"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN1137"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>useoptions</span><span class='Delimiter'>; 
</span><a name="LN1138"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_user_mapping.h.html#LN51"><span class='Ref_to_Const'>Natts_pg_user_mapping</span></a><span class='Delimiter'>]; 
</span><a name="LN1139"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_user_mapping.h.html#LN51"><span class='Ref_to_Const'>Natts_pg_user_mapping</span></a><span class='Delimiter'>]; 
</span><a name="LN1140"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN1141"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>useId</span><span class='Delimiter'>; 
</span><a name="LN1142"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>umId</span><span class='Delimiter'>; 
</span><a name="LN1143"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>myself</span><span class='Delimiter'>; 
</span><a name="LN1144"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>referenced</span><span class='Delimiter'>; 
</span><a name="LN1145"></a>    <a href="../../include/foreign/foreign.h.html#LN44"><span class='Ref_to_Struct'>ForeignServer</span></a> <span class='Operator'>*</span><span class='Declare_Local'>srv</span><span class='Delimiter'>; 
</span><a name="LN1146"></a>    <a href="../../include/foreign/foreign.h.html#LN34"><span class='Ref_to_Struct'>ForeignDataWrapper</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fdw</span><span class='Delimiter'>; 
</span><a name="LN1147"></a>    <a href="../../include/nodes/parsenodes.h.html#LN324"><span class='Ref_to_Struct'>RoleSpec</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>role</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN324"><span class='Ref_to_Struct'>RoleSpec</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="foreigncmds.c.html#LN1134"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2231"><span class='Ref_to_Member'>user</span></a><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN1136"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_user_mapping.h.html#LN26"><span class='Ref_to_Const'>UserMappingRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1147"><span class='Ref_To_Local'>role</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN327"><span class='Ref_to_Member'>roletype</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN321"><span class='Ref_to_EnumConst'>ROLESPEC_PUBLIC</span></a><span class='Parentheses'>) 
</span>        <a href="foreigncmds.c.html#LN1141"><span class='Ref_To_Local'>useId</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN38"><span class='Ref_to_Const'>ACL_ID_PUBLIC</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="foreigncmds.c.html#LN1141"><span class='Ref_To_Local'>useId</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN236"><span class='Ref_to_Proto'>get_rolespec_oid</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1134"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2231"><span class='Ref_to_Member'>user</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check that the server exists. */ 
</span>    <a href="foreigncmds.c.html#LN1145"><span class='Ref_To_Local'>srv</span></a> <span class='Operator'>= </span><a href="../../include/foreign/foreign.h.html#LN72"><span class='Ref_to_Proto'>GetForeignServerByName</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1134"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2232"><span class='Ref_to_Member'>servername</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN1108"><span class='Ref_to_Func'>user_mapping_ddl_aclcheck</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1141"><span class='Ref_To_Local'>useId</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN1145"><span class='Ref_To_Local'>srv</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN46"><span class='Ref_to_Member'>serverid</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN1134"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2232"><span class='Ref_to_Member'>servername</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check that the user mapping is unique within server. 
     */ 
</span>    <a href="foreigncmds.c.html#LN1142"><span class='Ref_To_Local'>umId</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN184"><span class='Ref_to_Macro'>GetSysCacheOid2</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN109"><span class='Ref_to_EnumConst'>USERMAPPINGUSERSERVER</span></a><span class='Delimiter'>, 
</span>                           <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1141"><span class='Ref_To_Local'>useId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1145"><span class='Ref_To_Local'>srv</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN46"><span class='Ref_to_Member'>serverid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1142"><span class='Ref_To_Local'>umId</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1134"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2233"><span class='Ref_to_Member'>if_not_exists</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/pg_basebackup/streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"user mapping for \"%s\" already exists for server %s, skipping"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/foreign/foreign.h.html#LN19"><span class='Ref_to_Macro'>MappingUserName</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1141"><span class='Ref_To_Local'>useId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="foreigncmds.c.html#LN1134"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2232"><span class='Ref_to_Member'>servername</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1136"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="../catalog/objectaddress.c.html#LN718"><span class='Ref_to_Global_Var'>InvalidObjectAddress</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/pg_basebackup/streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"user mapping for \"%s\" already exists for server %s"</span><span class='Delimiter'>, 
</span>                      <a href="../../include/foreign/foreign.h.html#LN19"><span class='Ref_to_Macro'>MappingUserName</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1141"><span class='Ref_To_Local'>useId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                      <a href="foreigncmds.c.html#LN1134"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2232"><span class='Ref_to_Member'>servername</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if OidIsValid(umId) &raquo; </span> 
 
    <a href="foreigncmds.c.html#LN1146"><span class='Ref_To_Local'>fdw</span></a> <span class='Operator'>= </span><a href="../foreign/foreign.c.html#LN33"><span class='Ref_to_Func'>GetForeignDataWrapper</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1145"><span class='Ref_To_Local'>srv</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN47"><span class='Ref_to_Member'>fdwid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Insert tuple into pg_user_mapping. 
     */ 
</span>    memset<span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1138"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1138"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1139"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1139"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN1138"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_user_mapping.h.html#LN52"><span class='Ref_to_Const'>Anum_pg_user_mapping_umuser</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1141"><span class='Ref_To_Local'>useId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="foreigncmds.c.html#LN1138"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_user_mapping.h.html#LN53"><span class='Ref_to_Const'>Anum_pg_user_mapping_umserver</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1145"><span class='Ref_To_Local'>srv</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN46"><span class='Ref_to_Member'>serverid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Add user options */ 
</span>    <a href="foreigncmds.c.html#LN1137"><span class='Ref_To_Local'>useoptions</span></a> <span class='Operator'>= </span><a href="foreigncmds.c.html#LN107"><span class='Ref_to_Func'>transformGenericOptions</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_user_mapping.h.html#LN26"><span class='Ref_to_Const'>UserMappingRelationId</span></a><span class='Delimiter'>, 
</span>                                         <a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <a href="foreigncmds.c.html#LN1134"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2234"><span class='Ref_to_Member'>options</span></a><span class='Delimiter'>, 
</span>                                         <a href="foreigncmds.c.html#LN1146"><span class='Ref_To_Local'>fdw</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN40"><span class='Ref_to_Member'>fdwvalidator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN525"><span class='Ref_to_Macro'>PointerIsValid</span></a><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1137"><span class='Ref_To_Local'>useoptions</span></a><span class='Parentheses'>)))</span> 
        <a href="foreigncmds.c.html#LN1138"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_user_mapping.h.html#LN54"><span class='Ref_to_Const'>Anum_pg_user_mapping_umoptions</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="foreigncmds.c.html#LN1137"><span class='Ref_To_Local'>useoptions</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="foreigncmds.c.html#LN1139"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_user_mapping.h.html#LN54"><span class='Ref_to_Const'>Anum_pg_user_mapping_umoptions</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN1140"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1136"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN1138"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN1139"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN1142"><span class='Ref_To_Local'>umId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/indexing.h.html#LN32"><span class='Ref_to_Proto'>CatalogTupleInsert</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1136"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN1140"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1140"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Add dependency on the server */ 
</span>    <a href="foreigncmds.c.html#LN1143"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_user_mapping.h.html#LN26"><span class='Ref_to_Const'>UserMappingRelationId</span></a><span class='Delimiter'>; 
</span>    <a href="foreigncmds.c.html#LN1143"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="foreigncmds.c.html#LN1142"><span class='Ref_To_Local'>umId</span></a><span class='Delimiter'>; 
</span>    <a href="foreigncmds.c.html#LN1143"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN1144"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_foreign_server.h.html#LN26"><span class='Ref_to_Const'>ForeignServerRelationId</span></a><span class='Delimiter'>; 
</span>    <a href="foreigncmds.c.html#LN1144"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="foreigncmds.c.html#LN1145"><span class='Ref_To_Local'>srv</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN46"><span class='Ref_to_Member'>serverid</span></a><span class='Delimiter'>; 
</span>    <a href="foreigncmds.c.html#LN1144"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="foreigncmds.c.html#LN1143"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="foreigncmds.c.html#LN1144"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1141"><span class='Ref_To_Local'>useId</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Record the mapped user dependency */ 
</span>        <a href="../catalog/pg_shdepend.c.html#LN157"><span class='Ref_to_Func'>recordDependencyOnOwner</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_user_mapping.h.html#LN26"><span class='Ref_to_Const'>UserMappingRelationId</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN1142"><span class='Ref_To_Local'>umId</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN1141"><span class='Ref_To_Local'>useId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* dependency on extension */ 
</span>    <a href="../catalog/pg_depend.c.html#LN137"><span class='Ref_to_Func'>recordDependencyOnCurrentExtension</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="foreigncmds.c.html#LN1143"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Post creation hook for new user mapping */ 
</span>    <a href="../../include/catalog/objectaccess.h.html#LN144"><span class='Ref_to_Macro'>InvokeObjectPostCreateHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_user_mapping.h.html#LN26"><span class='Ref_to_Const'>UserMappingRelationId</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN1142"><span class='Ref_To_Local'>umId</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1136"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="foreigncmds.c.html#LN1143"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CreateUserMapping &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Alter user mapping 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN1249"></a><span class='Declare_Function'>AlterUserMapping</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2237"><span class='Ref_to_Struct'>AlterUserMappingStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1251"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN1252"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tp</span><span class='Delimiter'>; 
</span><a name="LN1253"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>repl_val</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_user_mapping.h.html#LN51"><span class='Ref_to_Const'>Natts_pg_user_mapping</span></a><span class='Delimiter'>]; 
</span><a name="LN1254"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>repl_null</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_user_mapping.h.html#LN51"><span class='Ref_to_Const'>Natts_pg_user_mapping</span></a><span class='Delimiter'>]; 
</span><a name="LN1255"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>repl_repl</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_user_mapping.h.html#LN51"><span class='Ref_to_Const'>Natts_pg_user_mapping</span></a><span class='Delimiter'>]; 
</span><a name="LN1256"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>useId</span><span class='Delimiter'>; 
</span><a name="LN1257"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>umId</span><span class='Delimiter'>; 
</span><a name="LN1258"></a>    <a href="../../include/foreign/foreign.h.html#LN44"><span class='Ref_to_Struct'>ForeignServer</span></a> <span class='Operator'>*</span><span class='Declare_Local'>srv</span><span class='Delimiter'>; 
</span><a name="LN1259"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span><a name="LN1260"></a>    <a href="../../include/nodes/parsenodes.h.html#LN324"><span class='Ref_to_Struct'>RoleSpec</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>role</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN324"><span class='Ref_to_Struct'>RoleSpec</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="foreigncmds.c.html#LN1249"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2240"><span class='Ref_to_Member'>user</span></a><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN1251"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_user_mapping.h.html#LN26"><span class='Ref_to_Const'>UserMappingRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1260"><span class='Ref_To_Local'>role</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN327"><span class='Ref_to_Member'>roletype</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN321"><span class='Ref_to_EnumConst'>ROLESPEC_PUBLIC</span></a><span class='Parentheses'>) 
</span>        <a href="foreigncmds.c.html#LN1256"><span class='Ref_To_Local'>useId</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN38"><span class='Ref_to_Const'>ACL_ID_PUBLIC</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="foreigncmds.c.html#LN1256"><span class='Ref_To_Local'>useId</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN236"><span class='Ref_to_Proto'>get_rolespec_oid</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1249"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2240"><span class='Ref_to_Member'>user</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN1258"><span class='Ref_To_Local'>srv</span></a> <span class='Operator'>= </span><a href="../../include/foreign/foreign.h.html#LN72"><span class='Ref_to_Proto'>GetForeignServerByName</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1249"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2241"><span class='Ref_to_Member'>servername</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN1257"><span class='Ref_To_Local'>umId</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN184"><span class='Ref_to_Macro'>GetSysCacheOid2</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN109"><span class='Ref_to_EnumConst'>USERMAPPINGUSERSERVER</span></a><span class='Delimiter'>, 
</span>                           <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1256"><span class='Ref_To_Local'>useId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1258"><span class='Ref_To_Local'>srv</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN46"><span class='Ref_to_Member'>serverid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1257"><span class='Ref_To_Local'>umId</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"user mapping for \"%s\" does not exist for the server"</span><span class='Delimiter'>, 
</span>                     <a href="../../include/foreign/foreign.h.html#LN19"><span class='Ref_to_Macro'>MappingUserName</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1256"><span class='Ref_To_Local'>useId</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN1108"><span class='Ref_to_Func'>user_mapping_ddl_aclcheck</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1256"><span class='Ref_To_Local'>useId</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN1258"><span class='Ref_To_Local'>srv</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN46"><span class='Ref_to_Member'>serverid</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN1249"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2241"><span class='Ref_to_Member'>servername</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN1252"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN108"><span class='Ref_to_EnumConst'>USERMAPPINGOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1257"><span class='Ref_To_Local'>umId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1252"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for user mapping %u"</span><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN1257"><span class='Ref_To_Local'>umId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    memset<span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1253"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1253"><span class='Ref_To_Local'>repl_val</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1254"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1254"><span class='Ref_To_Local'>repl_null</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1255"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1255"><span class='Ref_To_Local'>repl_repl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1249"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2242"><span class='Ref_to_Member'>options</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1293"></a>        <a href="../../include/foreign/foreign.h.html#LN34"><span class='Ref_to_Struct'>ForeignDataWrapper</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fdw</span><span class='Delimiter'>; 
</span><a name="LN1294"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>datum</span><span class='Delimiter'>; 
</span><a name="LN1295"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Process the options. 
         */ 
</span> 
        <a href="foreigncmds.c.html#LN1293"><span class='Ref_To_Local'>fdw</span></a> <span class='Operator'>= </span><a href="../foreign/foreign.c.html#LN33"><span class='Ref_to_Func'>GetForeignDataWrapper</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1258"><span class='Ref_To_Local'>srv</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN47"><span class='Ref_to_Member'>fdwid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="foreigncmds.c.html#LN1294"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN109"><span class='Ref_to_EnumConst'>USERMAPPINGUSERSERVER</span></a><span class='Delimiter'>, 
</span>                                <a href="foreigncmds.c.html#LN1252"><span class='Ref_To_Local'>tp</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/catalog/pg_user_mapping.h.html#LN54"><span class='Ref_to_Const'>Anum_pg_user_mapping_umoptions</span></a><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="foreigncmds.c.html#LN1295"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1295"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>            <a href="foreigncmds.c.html#LN1294"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Prepare the options array */ 
</span>        <a href="foreigncmds.c.html#LN1294"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="foreigncmds.c.html#LN107"><span class='Ref_to_Func'>transformGenericOptions</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_user_mapping.h.html#LN26"><span class='Ref_to_Const'>UserMappingRelationId</span></a><span class='Delimiter'>, 
</span>                                        <a href="foreigncmds.c.html#LN1294"><span class='Ref_To_Local'>datum</span></a><span class='Delimiter'>, 
</span>                                        <a href="foreigncmds.c.html#LN1249"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2242"><span class='Ref_to_Member'>options</span></a><span class='Delimiter'>, 
</span>                                        <a href="foreigncmds.c.html#LN1293"><span class='Ref_To_Local'>fdw</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN40"><span class='Ref_to_Member'>fdwvalidator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN525"><span class='Ref_to_Macro'>PointerIsValid</span></a><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1294"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>)))</span> 
            <a href="foreigncmds.c.html#LN1253"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_user_mapping.h.html#LN54"><span class='Ref_to_Const'>Anum_pg_user_mapping_umoptions</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="foreigncmds.c.html#LN1294"><span class='Ref_To_Local'>datum</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="foreigncmds.c.html#LN1254"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_user_mapping.h.html#LN54"><span class='Ref_to_Const'>Anum_pg_user_mapping_umoptions</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <a href="foreigncmds.c.html#LN1255"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_user_mapping.h.html#LN54"><span class='Ref_to_Const'>Anum_pg_user_mapping_umoptions</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if stmt-&GT;options &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Everything looks good - update the tuple */ 
</span>    <a href="foreigncmds.c.html#LN1252"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1252"><span class='Ref_To_Local'>tp</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1251"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="foreigncmds.c.html#LN1253"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN1254"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN1255"><span class='Ref_To_Local'>repl_repl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1251"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="foreigncmds.c.html#LN1252"><span class='Ref_To_Local'>tp</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN1252"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1259"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_user_mapping.h.html#LN26"><span class='Ref_to_Const'>UserMappingRelationId</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN1257"><span class='Ref_To_Local'>umId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1252"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1251"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="foreigncmds.c.html#LN1259"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterUserMapping &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Drop user mapping 
 */ 
</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN1344"></a><span class='Declare_Function'>RemoveUserMapping</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2245"><span class='Ref_to_Struct'>DropUserMappingStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1346"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>object</span><span class='Delimiter'>; 
</span><a name="LN1347"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>useId</span><span class='Delimiter'>; 
</span><a name="LN1348"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>umId</span><span class='Delimiter'>; 
</span><a name="LN1349"></a>    <a href="../../include/foreign/foreign.h.html#LN44"><span class='Ref_to_Struct'>ForeignServer</span></a> <span class='Operator'>*</span><span class='Declare_Local'>srv</span><span class='Delimiter'>; 
</span><a name="LN1350"></a>    <a href="../../include/nodes/parsenodes.h.html#LN324"><span class='Ref_to_Struct'>RoleSpec</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>role</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN324"><span class='Ref_to_Struct'>RoleSpec</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="foreigncmds.c.html#LN1344"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2248"><span class='Ref_to_Member'>user</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1350"><span class='Ref_To_Local'>role</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN327"><span class='Ref_to_Member'>roletype</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN321"><span class='Ref_to_EnumConst'>ROLESPEC_PUBLIC</span></a><span class='Parentheses'>) 
</span>        <a href="foreigncmds.c.html#LN1347"><span class='Ref_To_Local'>useId</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN38"><span class='Ref_to_Const'>ACL_ID_PUBLIC</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="foreigncmds.c.html#LN1347"><span class='Ref_To_Local'>useId</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN236"><span class='Ref_to_Proto'>get_rolespec_oid</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1344"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2248"><span class='Ref_to_Member'>user</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN1344"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2250"><span class='Ref_to_Member'>missing_ok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1347"><span class='Ref_To_Local'>useId</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * IF EXISTS specified, role not found and not public. Notice this 
             * and leave. 
             */ 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, </span><span class='String'>"role \"%s\" does not exist, skipping"</span><span class='Delimiter'>, 
</span>                 <a href="foreigncmds.c.html#LN1350"><span class='Ref_To_Local'>role</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN328"><span class='Ref_to_Member'>rolename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="foreigncmds.c.html#LN1349"><span class='Ref_To_Local'>srv</span></a> <span class='Operator'>= </span><a href="../../include/foreign/foreign.h.html#LN72"><span class='Ref_to_Proto'>GetForeignServerByName</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1344"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2249"><span class='Ref_to_Member'>servername</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="foreigncmds.c.html#LN1349"><span class='Ref_To_Local'>srv</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="foreigncmds.c.html#LN1344"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2250"><span class='Ref_to_Member'>missing_ok</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"server \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                            <a href="foreigncmds.c.html#LN1344"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2249"><span class='Ref_to_Member'>servername</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* IF EXISTS, just note it */ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"server does not exist, skipping"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="foreigncmds.c.html#LN1348"><span class='Ref_To_Local'>umId</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN184"><span class='Ref_to_Macro'>GetSysCacheOid2</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN109"><span class='Ref_to_EnumConst'>USERMAPPINGUSERSERVER</span></a><span class='Delimiter'>, 
</span>                           <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1347"><span class='Ref_To_Local'>useId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1349"><span class='Ref_To_Local'>srv</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN46"><span class='Ref_to_Member'>serverid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1348"><span class='Ref_To_Local'>umId</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="foreigncmds.c.html#LN1344"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2250"><span class='Ref_to_Member'>missing_ok</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"user mapping for \"%s\" does not exist for the server"</span><span class='Delimiter'>, 
</span>                     <a href="../../include/foreign/foreign.h.html#LN19"><span class='Ref_to_Macro'>MappingUserName</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1347"><span class='Ref_To_Local'>useId</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* IF EXISTS specified, just note it */ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"user mapping for \"%s\" does not exist for the server, skipping"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/foreign/foreign.h.html#LN19"><span class='Ref_to_Macro'>MappingUserName</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1347"><span class='Ref_To_Local'>useId</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="foreigncmds.c.html#LN1108"><span class='Ref_to_Func'>user_mapping_ddl_aclcheck</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1347"><span class='Ref_To_Local'>useId</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN1349"><span class='Ref_To_Local'>srv</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN46"><span class='Ref_to_Member'>serverid</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN1349"><span class='Ref_To_Local'>srv</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN49"><span class='Ref_to_Member'>servername</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Do the deletion 
     */ 
</span>    <a href="foreigncmds.c.html#LN1346"><span class='Ref_To_Local'>object</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_user_mapping.h.html#LN26"><span class='Ref_to_Const'>UserMappingRelationId</span></a><span class='Delimiter'>; 
</span>    <a href="foreigncmds.c.html#LN1346"><span class='Ref_To_Local'>object</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="foreigncmds.c.html#LN1348"><span class='Ref_To_Local'>umId</span></a><span class='Delimiter'>; 
</span>    <a href="foreigncmds.c.html#LN1346"><span class='Ref_To_Local'>object</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/dependency.h.html#LN182"><span class='Ref_to_Proto'>performDeletion</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="foreigncmds.c.html#LN1346"><span class='Ref_To_Local'>object</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1655"><span class='Ref_to_EnumConst'>DROP_CASCADE</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="foreigncmds.c.html#LN1348"><span class='Ref_To_Local'>umId</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RemoveUserMapping &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Drop user mapping by OID.  This is called to clean up dependencies. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1421"></a><span class='Declare_Function'>RemoveUserMappingById</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>umId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1423"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tp</span><span class='Delimiter'>; 
</span><a name="LN1424"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN1424"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_user_mapping.h.html#LN26"><span class='Ref_to_Const'>UserMappingRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN1423"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN108"><span class='Ref_to_EnumConst'>USERMAPPINGOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1421"><span class='Ref_to_Parameter'>umId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1423"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for user mapping %u"</span><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN1421"><span class='Ref_to_Parameter'>umId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN40"><span class='Ref_to_Proto'>CatalogTupleDelete</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1424"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="foreigncmds.c.html#LN1423"><span class='Ref_To_Local'>tp</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1423"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1424"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Create a foreign table 
 * call after DefineRelation(). 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1445"></a><span class='Declare_Function'>CreateForeignTable</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2216"><span class='Ref_to_Struct'>CreateForeignTableStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1447"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>ftrel</span><span class='Delimiter'>; 
</span><a name="LN1448"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>ftoptions</span><span class='Delimiter'>; 
</span><a name="LN1449"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_table.h.html#LN50"><span class='Ref_to_Const'>Natts_pg_foreign_table</span></a><span class='Delimiter'>]; 
</span><a name="LN1450"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_table.h.html#LN50"><span class='Ref_to_Const'>Natts_pg_foreign_table</span></a><span class='Delimiter'>]; 
</span><a name="LN1451"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN1452"></a>    <a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span><a name="LN1453"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>myself</span><span class='Delimiter'>; 
</span><a name="LN1454"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>referenced</span><span class='Delimiter'>; 
</span><a name="LN1455"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span><a name="LN1456"></a>    <a href="../../include/foreign/foreign.h.html#LN34"><span class='Ref_to_Struct'>ForeignDataWrapper</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fdw</span><span class='Delimiter'>; 
</span><a name="LN1457"></a>    <a href="../../include/foreign/foreign.h.html#LN44"><span class='Ref_to_Struct'>ForeignServer</span></a> <span class='Operator'>*</span><span class='Declare_Local'>server</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Advance command counter to ensure the pg_attribute tuple is visible; 
     * the tuple might be updated to add constraints in previous step. 
     */ 
</span>    <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN1447"><span class='Ref_To_Local'>ftrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_table.h.html#LN26"><span class='Ref_to_Const'>ForeignTableRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * For now the owner cannot be specified on create. Use effective user ID. 
     */ 
</span>    <a href="foreigncmds.c.html#LN1455"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check that the foreign server exists and that we have USAGE on it. Also 
     * get the actual FDW for option validation etc. 
     */ 
</span>    <a href="foreigncmds.c.html#LN1457"><span class='Ref_To_Local'>server</span></a> <span class='Operator'>= </span><a href="../../include/foreign/foreign.h.html#LN72"><span class='Ref_to_Proto'>GetForeignServerByName</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1445"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2219"><span class='Ref_to_Member'>servername</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="foreigncmds.c.html#LN1452"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN292"><span class='Ref_to_Proto'>pg_foreign_server_aclcheck</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1457"><span class='Ref_To_Local'>server</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN46"><span class='Ref_to_Member'>serverid</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN1455"><span class='Ref_To_Local'>ownerId</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1452"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1452"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN199"><span class='Ref_to_EnumConst'>ACL_KIND_FOREIGN_SERVER</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN1457"><span class='Ref_To_Local'>server</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN49"><span class='Ref_to_Member'>servername</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN1456"><span class='Ref_To_Local'>fdw</span></a> <span class='Operator'>= </span><a href="../foreign/foreign.c.html#LN33"><span class='Ref_to_Func'>GetForeignDataWrapper</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1457"><span class='Ref_To_Local'>server</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN47"><span class='Ref_to_Member'>fdwid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Insert tuple into pg_foreign_table. 
     */ 
</span>    memset<span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1449"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1449"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1450"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1450"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN1449"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_table.h.html#LN51"><span class='Ref_to_Const'>Anum_pg_foreign_table_ftrelid</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1445"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="foreigncmds.c.html#LN1449"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_table.h.html#LN52"><span class='Ref_to_Const'>Anum_pg_foreign_table_ftserver</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1457"><span class='Ref_To_Local'>server</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN46"><span class='Ref_to_Member'>serverid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Add table generic options */ 
</span>    <a href="foreigncmds.c.html#LN1448"><span class='Ref_To_Local'>ftoptions</span></a> <span class='Operator'>= </span><a href="foreigncmds.c.html#LN107"><span class='Ref_to_Func'>transformGenericOptions</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_table.h.html#LN26"><span class='Ref_to_Const'>ForeignTableRelationId</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                        <a href="foreigncmds.c.html#LN1445"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2220"><span class='Ref_to_Member'>options</span></a><span class='Delimiter'>, 
</span>                                        <a href="foreigncmds.c.html#LN1456"><span class='Ref_To_Local'>fdw</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN40"><span class='Ref_to_Member'>fdwvalidator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN525"><span class='Ref_to_Macro'>PointerIsValid</span></a><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1448"><span class='Ref_To_Local'>ftoptions</span></a><span class='Parentheses'>)))</span> 
        <a href="foreigncmds.c.html#LN1449"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_table.h.html#LN53"><span class='Ref_to_Const'>Anum_pg_foreign_table_ftoptions</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="foreigncmds.c.html#LN1448"><span class='Ref_To_Local'>ftoptions</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="foreigncmds.c.html#LN1450"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_table.h.html#LN53"><span class='Ref_to_Const'>Anum_pg_foreign_table_ftoptions</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN1451"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1447"><span class='Ref_To_Local'>ftrel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN1449"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN1450"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN32"><span class='Ref_to_Proto'>CatalogTupleInsert</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1447"><span class='Ref_To_Local'>ftrel</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN1451"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1451"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Add pg_class dependency on the server */ 
</span>    <a href="foreigncmds.c.html#LN1453"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>; 
</span>    <a href="foreigncmds.c.html#LN1453"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="foreigncmds.c.html#LN1445"><span class='Ref_to_Parameter'>relid</span></a><span class='Delimiter'>; 
</span>    <a href="foreigncmds.c.html#LN1453"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="foreigncmds.c.html#LN1454"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_foreign_server.h.html#LN26"><span class='Ref_to_Const'>ForeignServerRelationId</span></a><span class='Delimiter'>; 
</span>    <a href="foreigncmds.c.html#LN1454"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="foreigncmds.c.html#LN1457"><span class='Ref_To_Local'>server</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN46"><span class='Ref_to_Member'>serverid</span></a><span class='Delimiter'>; 
</span>    <a href="foreigncmds.c.html#LN1454"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="foreigncmds.c.html#LN1453"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="foreigncmds.c.html#LN1454"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1447"><span class='Ref_To_Local'>ftrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CreateForeignTable &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Import a foreign schema 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1525"></a><span class='Declare_Function'>ImportForeignSchema</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2265"><span class='Ref_to_Struct'>ImportForeignSchemaStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1527"></a>    <a href="../../include/foreign/foreign.h.html#LN44"><span class='Ref_to_Struct'>ForeignServer</span></a> <span class='Operator'>*</span><span class='Declare_Local'>server</span><span class='Delimiter'>; 
</span><a name="LN1528"></a>    <a href="../../include/foreign/foreign.h.html#LN34"><span class='Ref_to_Struct'>ForeignDataWrapper</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fdw</span><span class='Delimiter'>; 
</span><a name="LN1529"></a>    <a href="../../include/foreign/fdwapi.h.html#LN168"><span class='Ref_to_Struct'>FdwRoutine</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fdw_routine</span><span class='Delimiter'>; 
</span><a name="LN1530"></a>    <a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span><a name="LN1531"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>cmd_list</span><span class='Delimiter'>; 
</span><a name="LN1532"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check that the foreign server exists and that we have USAGE on it */ 
</span>    <a href="foreigncmds.c.html#LN1527"><span class='Ref_To_Local'>server</span></a> <span class='Operator'>= </span><a href="../../include/foreign/foreign.h.html#LN72"><span class='Ref_to_Proto'>GetForeignServerByName</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1525"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2268"><span class='Ref_to_Member'>server_name</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="foreigncmds.c.html#LN1530"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN292"><span class='Ref_to_Proto'>pg_foreign_server_aclcheck</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1527"><span class='Ref_To_Local'>server</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN46"><span class='Ref_to_Member'>serverid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1530"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1530"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN199"><span class='Ref_to_EnumConst'>ACL_KIND_FOREIGN_SERVER</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN1527"><span class='Ref_To_Local'>server</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN49"><span class='Ref_to_Member'>servername</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check that the schema exists and we have CREATE permissions on it */ 
</span>    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../include/catalog/namespace.h.html#LN116"><span class='Ref_to_Proto'>LookupCreationNamespace</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1525"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2270"><span class='Ref_to_Member'>local_schema</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get the FDW and check it supports IMPORT */ 
</span>    <a href="foreigncmds.c.html#LN1528"><span class='Ref_To_Local'>fdw</span></a> <span class='Operator'>= </span><a href="../foreign/foreign.c.html#LN33"><span class='Ref_to_Func'>GetForeignDataWrapper</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1527"><span class='Ref_To_Local'>server</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN47"><span class='Ref_to_Member'>fdwid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1528"><span class='Ref_To_Local'>fdw</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN39"><span class='Ref_to_Member'>fdwhandler</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"foreign-data wrapper \"%s\" has no handler"</span><span class='Delimiter'>, 
</span>                        <a href="foreigncmds.c.html#LN1528"><span class='Ref_To_Local'>fdw</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN38"><span class='Ref_to_Member'>fdwname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="foreigncmds.c.html#LN1529"><span class='Ref_To_Local'>fdw_routine</span></a> <span class='Operator'>= </span><a href="../../include/foreign/fdwapi.h.html#LN232"><span class='Ref_to_Proto'>GetFdwRoutine</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1528"><span class='Ref_To_Local'>fdw</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN39"><span class='Ref_to_Member'>fdwhandler</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1529"><span class='Ref_To_Local'>fdw_routine</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/fdwapi.h.html#LN220"><span class='Ref_to_Member'>ImportForeignSchema</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FDW_NO_SCHEMAS<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"foreign-data wrapper \"%s\" does not support IMPORT FOREIGN SCHEMA"</span><span class='Delimiter'>, 
</span>                        <a href="foreigncmds.c.html#LN1528"><span class='Ref_To_Local'>fdw</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN38"><span class='Ref_to_Member'>fdwname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Call FDW to get a list of commands */ 
</span>    <a href="foreigncmds.c.html#LN1531"><span class='Ref_To_Local'>cmd_list</span></a> <span class='Operator'>= </span><a href="foreigncmds.c.html#LN1529"><span class='Ref_To_Local'>fdw_routine</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/fdwapi.h.html#LN220"><span class='Ref_to_Member'>ImportForeignSchema</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1525"><span class='Ref_to_Parameter'>stmt</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN1527"><span class='Ref_To_Local'>server</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN46"><span class='Ref_to_Member'>serverid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Parse and execute each command */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1532"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN1531"><span class='Ref_To_Local'>cmd_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1563"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>cmd</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1532"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1564"></a>        <a href="foreigncmds.c.html#LN41"><span class='Ref_to_Typedef'>import_error_callback_arg</span></a> <span class='Declare_Local'>callback_arg</span><span class='Delimiter'>; 
</span><a name="LN1565"></a>        ErrorContextCallback <span class='Declare_Local'>sqlerrcontext</span><span class='Delimiter'>; 
</span><a name="LN1566"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>raw_parsetree_list</span><span class='Delimiter'>; 
</span><a name="LN1567"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc2</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Setup error traceback support for ereport().  This is so that any 
         * error in the generated SQL will be displayed nicely. 
         */ 
</span>        <a href="foreigncmds.c.html#LN1564"><span class='Ref_To_Local'>callback_arg</span></a><span class='Operator'>.</span><a href="foreigncmds.c.html#LN43"><span class='Ref_to_Member'>tablename</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* not known yet */ 
</span>        <a href="foreigncmds.c.html#LN1564"><span class='Ref_To_Local'>callback_arg</span></a><span class='Operator'>.</span><a href="foreigncmds.c.html#LN44"><span class='Ref_to_Member'>cmd</span></a> <span class='Operator'>= </span><a href="foreigncmds.c.html#LN1563"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>; 
</span>        <a href="foreigncmds.c.html#LN1565"><span class='Ref_To_Local'>sqlerrcontext</span></a><span class='Operator'>.</span>callback <span class='Operator'>= </span><a href="foreigncmds.c.html#LN48"><span class='Ref_to_Proto'>import_error_callback</span></a><span class='Delimiter'>; 
</span>        <a href="foreigncmds.c.html#LN1565"><span class='Ref_To_Local'>sqlerrcontext</span></a><span class='Operator'>.</span>arg <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="foreigncmds.c.html#LN1564"><span class='Ref_To_Local'>callback_arg</span></a><span class='Delimiter'>; 
</span>        <a href="foreigncmds.c.html#LN1565"><span class='Ref_To_Local'>sqlerrcontext</span></a><span class='Operator'>.</span>previous <span class='Operator'>= </span><a href="../utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a><span class='Delimiter'>; 
</span>        <a href="../utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a> <span class='Operator'>= &</span><a href="foreigncmds.c.html#LN1565"><span class='Ref_To_Local'>sqlerrcontext</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Parse the SQL string into a list of raw parse trees. 
         */ 
</span>        <a href="foreigncmds.c.html#LN1566"><span class='Ref_To_Local'>raw_parsetree_list</span></a> <span class='Operator'>= </span><a href="../../include/tcop/tcopprot.h.html#LN49"><span class='Ref_to_Proto'>pg_parse_query</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1563"><span class='Ref_To_Local'>cmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Process each parse tree (we allow the FDW to put more than one 
         * command per string, though this isn't really advised). 
         */ 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1567"><span class='Ref_To_Local'>lc2</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN1566"><span class='Ref_To_Local'>raw_parsetree_list</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1591"></a>            <a href="../../include/nodes/parsenodes.h.html#LN1396"><span class='Ref_to_Struct'>RawStmt</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>rs</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1396"><span class='Ref_to_Struct'>RawStmt</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN1567"><span class='Ref_To_Local'>lc2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1592"></a>            <a href="../../include/nodes/parsenodes.h.html#LN2216"><span class='Ref_to_Struct'>CreateForeignTableStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cstmt</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2216"><span class='Ref_to_Struct'>CreateForeignTableStmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="foreigncmds.c.html#LN1591"><span class='Ref_To_Local'>rs</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1399"><span class='Ref_to_Member'>stmt</span></a><span class='Delimiter'>; 
</span><a name="LN1593"></a>            <a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pstmt</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Because we only allow CreateForeignTableStmt, we can skip parse 
             * analysis, rewrite, and planning steps here. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1592"><span class='Ref_To_Local'>cstmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2216"><span class='Ref_to_Struct'>CreateForeignTableStmt</span></a><span class='Parentheses'>))</span> 
                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                     <span class='String'>"foreign-data wrapper \"%s\" returned incorrect statement type %d"</span><span class='Delimiter'>, 
</span>                     <a href="foreigncmds.c.html#LN1528"><span class='Ref_To_Local'>fdw</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN38"><span class='Ref_to_Member'>fdwname</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="../../include/nodes/nodes.h.html#LN513"><span class='Ref_to_Macro'>nodeTag</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1592"><span class='Ref_To_Local'>cstmt</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Ignore commands for tables excluded by filter options */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/foreign/fdwapi.h.html#LN237"><span class='Ref_to_Proto'>IsImportableForeignTable</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1592"><span class='Ref_To_Local'>cstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2218"><span class='Ref_to_Member'>base</span></a><span class='Operator'>.</span><a href="../../include/nodes/parsenodes.h.html#LN1975"><span class='Ref_to_Member'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Delimiter'>, </span><a href="foreigncmds.c.html#LN1525"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Enable reporting of current table's name on error */ 
</span>            <a href="foreigncmds.c.html#LN1564"><span class='Ref_To_Local'>callback_arg</span></a><span class='Operator'>.</span><a href="foreigncmds.c.html#LN43"><span class='Ref_to_Member'>tablename</span></a> <span class='Operator'>= </span><a href="foreigncmds.c.html#LN1592"><span class='Ref_To_Local'>cstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2218"><span class='Ref_to_Member'>base</span></a><span class='Operator'>.</span><a href="../../include/nodes/parsenodes.h.html#LN1975"><span class='Ref_to_Member'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Ensure creation schema is the one given in IMPORT statement */ 
</span>            <a href="foreigncmds.c.html#LN1592"><span class='Ref_To_Local'>cstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2218"><span class='Ref_to_Member'>base</span></a><span class='Operator'>.</span><a href="../../include/nodes/parsenodes.h.html#LN1975"><span class='Ref_to_Member'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN66"><span class='Ref_to_Member'>schemaname</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1525"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2270"><span class='Ref_to_Member'>local_schema</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* No planning needed, just make a wrapper PlannedStmt */ 
</span>            <a href="foreigncmds.c.html#LN1593"><span class='Ref_To_Local'>pstmt</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="foreigncmds.c.html#LN1593"><span class='Ref_To_Local'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN44"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN654"><span class='Ref_to_EnumConst'>CMD_UTILITY</span></a><span class='Delimiter'>; 
</span>            <a href="foreigncmds.c.html#LN1593"><span class='Ref_To_Local'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN52"><span class='Ref_to_Member'>canSetTag</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="foreigncmds.c.html#LN1593"><span class='Ref_To_Local'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN93"><span class='Ref_to_Member'>utilityStmt</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="foreigncmds.c.html#LN1592"><span class='Ref_To_Local'>cstmt</span></a><span class='Delimiter'>; 
</span>            <a href="foreigncmds.c.html#LN1593"><span class='Ref_To_Local'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN96"><span class='Ref_to_Member'>stmt_location</span></a> <span class='Operator'>= </span><a href="foreigncmds.c.html#LN1591"><span class='Ref_To_Local'>rs</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1400"><span class='Ref_to_Member'>stmt_location</span></a><span class='Delimiter'>; 
</span>            <a href="foreigncmds.c.html#LN1593"><span class='Ref_To_Local'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN97"><span class='Ref_to_Member'>stmt_len</span></a> <span class='Operator'>= </span><a href="foreigncmds.c.html#LN1591"><span class='Ref_To_Local'>rs</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1401"><span class='Ref_to_Member'>stmt_len</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Execute statement */ 
</span>            <a href="../../include/tcop/utility.h.html#LN33"><span class='Ref_to_Proto'>ProcessUtility</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1593"><span class='Ref_To_Local'>pstmt</span></a><span class='Delimiter'>, 
</span>                           <a href="foreigncmds.c.html#LN1563"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, 
</span>                           <a href="../../include/tcop/utility.h.html#LN22"><span class='Ref_to_EnumConst'>PROCESS_UTILITY_SUBCOMMAND</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                           <a href="../tcop/dest.c.html#LN90"><span class='Ref_to_Global_Var'>None_Receiver</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Be sure to advance the command counter between subcommands */ 
</span>            <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
            <a href="foreigncmds.c.html#LN1564"><span class='Ref_To_Local'>callback_arg</span></a><span class='Operator'>.</span><a href="foreigncmds.c.html#LN43"><span class='Ref_to_Member'>tablename</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a> <span class='Operator'>= </span><a href="foreigncmds.c.html#LN1565"><span class='Ref_To_Local'>sqlerrcontext</span></a><span class='Operator'>.</span>previous<span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end ImportForeignSchema &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * error context callback to let us supply the failing SQL statement's text 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1642"></a><span class='Declare_Function'>import_error_callback</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1644"></a>    <a href="foreigncmds.c.html#LN41"><span class='Ref_to_Typedef'>import_error_callback_arg</span></a> <span class='Operator'>*</span><span class='Declare_Local'>callback_arg</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN41"><span class='Ref_to_Typedef'>import_error_callback_arg</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="foreigncmds.c.html#LN1642"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>; 
</span><a name="LN1645"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>syntaxerrposition</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If it's a syntax error, convert to internal syntax error report */ 
</span>    <a href="foreigncmds.c.html#LN1645"><span class='Ref_To_Local'>syntaxerrposition</span></a> <span class='Operator'>= </span><a href="../utils/error/elog.c.html#LN1255"><span class='Ref_to_Func'>geterrposition</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1645"><span class='Ref_To_Local'>syntaxerrposition</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../utils/error/elog.c.html#LN1123"><span class='Ref_to_Func'>errposition</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../utils/error/elog.c.html#LN1139"><span class='Ref_to_Func'>internalerrposition</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1645"><span class='Ref_To_Local'>syntaxerrposition</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../utils/error/elog.c.html#LN1159"><span class='Ref_to_Func'>internalerrquery</span></a><span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1644"><span class='Ref_To_Local'>callback_arg</span></a><span class='Operator'>-&GT;</span><a href="foreigncmds.c.html#LN44"><span class='Ref_to_Member'>cmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="foreigncmds.c.html#LN1644"><span class='Ref_To_Local'>callback_arg</span></a><span class='Operator'>-&GT;</span><a href="foreigncmds.c.html#LN43"><span class='Ref_to_Member'>tablename</span></a><span class='Parentheses'>) 
</span>        errcontext<span class='Parentheses'>(</span><span class='String'>"importing foreign table \"%s\""</span><span class='Delimiter'>, 
</span>                   <a href="foreigncmds.c.html#LN1644"><span class='Ref_To_Local'>callback_arg</span></a><span class='Operator'>-&GT;</span><a href="foreigncmds.c.html#LN43"><span class='Ref_to_Member'>tablename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>