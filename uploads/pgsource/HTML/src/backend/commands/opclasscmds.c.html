<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\commands\opclasscmds.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\commands\opclasscmds.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:35 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * opclasscmds.c 
 * 
 *    Routines for opclass (and opfamily) manipulation commands 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/commands/opclasscmds.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;limits.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/genam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/heapam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/nbtree.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/sysattr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/dependency.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/indexing.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/objectaccess.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/opfam_internal.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_am.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_amop.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_amproc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_namespace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_opclass.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_operator.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_opfamily.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_proc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/alter.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/defrem.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/event_trigger.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_func.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_oper.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/fmgroids.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/tqual.h"</span> 
 
 
<a name="LN52"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>AlterOpFamilyAdd</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2532"><span class='Ref_to_Struct'>AlterOpFamilyStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Delimiter'>, 
</span><a name="LN53"></a>                 <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>amoid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opfamilyoid</span><span class='Delimiter'>, 
</span><a name="LN54"></a>                 <span class='Keyword'>int </span><span class='Declare_Parameter'>maxOpNumber</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>maxProcNumber</span><span class='Delimiter'>, 
</span><a name="LN55"></a>                 <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>items</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN56"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>AlterOpFamilyDrop</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2532"><span class='Ref_to_Struct'>AlterOpFamilyStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Delimiter'>, 
</span><a name="LN57"></a>                  <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>amoid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opfamilyoid</span><span class='Delimiter'>, 
</span><a name="LN58"></a>                  <span class='Keyword'>int </span><span class='Declare_Parameter'>maxOpNumber</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>maxProcNumber</span><span class='Delimiter'>, 
</span><a name="LN59"></a>                  <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>items</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN60"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>processTypesSpec</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>args</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lefttype</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>righttype</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN61"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>assignOperTypes</span><span class='Parentheses'>(</span><a href="../../include/catalog/opfam_internal.h.html#LN18"><span class='Ref_to_Typedef'>OpFamilyMember</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>member</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>amoid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeoid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN62"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>assignProcTypes</span><span class='Parentheses'>(</span><a href="../../include/catalog/opfam_internal.h.html#LN18"><span class='Ref_to_Typedef'>OpFamilyMember</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>member</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>amoid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeoid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN63"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>addFamilyMember</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>list</span><span class='Delimiter'>, </span><a href="../../include/catalog/opfam_internal.h.html#LN18"><span class='Ref_to_Typedef'>OpFamilyMember</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>member</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isProc</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN64"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>storeOperators</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>opfamilyname</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>amoid</span><span class='Delimiter'>, 
</span><a name="LN65"></a>               <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opfamilyoid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opclassoid</span><span class='Delimiter'>, 
</span><a name="LN66"></a>               <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>operators</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isAdd</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN67"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>storeProcedures</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>opfamilyname</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>amoid</span><span class='Delimiter'>, 
</span><a name="LN68"></a>                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opfamilyoid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opclassoid</span><span class='Delimiter'>, 
</span><a name="LN69"></a>                <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>procedures</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isAdd</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN70"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>dropOperators</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>opfamilyname</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>amoid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opfamilyoid</span><span class='Delimiter'>, 
</span><a name="LN71"></a>              <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>operators</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN72"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>dropProcedures</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>opfamilyname</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>amoid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opfamilyoid</span><span class='Delimiter'>, 
</span><a name="LN73"></a>               <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>procedures</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * OpFamilyCacheLookup 
 *      Look up an existing opfamily by name. 
 * 
 * Returns a syscache tuple reference, or NULL if not found. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> 
<a name="LN82"></a><span class='Declare_Function'>OpFamilyCacheLookup</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>amID</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>opfamilyname</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>missing_ok</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN84"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>schemaname</span><span class='Delimiter'>; 
</span><a name="LN85"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>opfname</span><span class='Delimiter'>; 
</span><a name="LN86"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>htup</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* deconstruct the name list */ 
</span>    <a href="../../include/catalog/namespace.h.html#LN109"><span class='Ref_to_Proto'>DeconstructQualifiedName</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN82"><span class='Ref_to_Parameter'>opfamilyname</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN84"><span class='Ref_To_Local'>schemaname</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN85"><span class='Ref_To_Local'>opfname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN84"><span class='Ref_To_Local'>schemaname</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Look in specific schema only */ 
</span><a name="LN94"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>namespaceId</span><span class='Delimiter'>; 
</span> 
        <a href="opclasscmds.c.html#LN94"><span class='Ref_To_Local'>namespaceId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN113"><span class='Ref_to_Proto'>LookupExplicitNamespace</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN84"><span class='Ref_To_Local'>schemaname</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN82"><span class='Ref_to_Parameter'>missing_ok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN94"><span class='Ref_To_Local'>namespaceId</span></a><span class='Parentheses'>))</span> 
            <a href="opclasscmds.c.html#LN86"><span class='Ref_To_Local'>htup</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="opclasscmds.c.html#LN86"><span class='Ref_To_Local'>htup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN159"><span class='Ref_to_Macro'>SearchSysCache3</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN72"><span class='Ref_to_EnumConst'>OPFAMILYAMNAMENSP</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN82"><span class='Ref_to_Parameter'>amID</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN85"><span class='Ref_To_Local'>opfname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN94"><span class='Ref_To_Local'>namespaceId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Unqualified opfamily name, so search the search path */ 
</span><a name="LN108"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>opfID</span> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN85"><span class='Ref_to_Proto'>OpfamilynameGetOpfid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN82"><span class='Ref_to_Parameter'>amID</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN85"><span class='Ref_To_Local'>opfname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN108"><span class='Ref_To_Local'>opfID</span></a><span class='Parentheses'>))</span> 
            <a href="opclasscmds.c.html#LN86"><span class='Ref_To_Local'>htup</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="opclasscmds.c.html#LN86"><span class='Ref_To_Local'>htup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN73"><span class='Ref_to_EnumConst'>OPFAMILYOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN108"><span class='Ref_To_Local'>opfID</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN86"><span class='Ref_To_Local'>htup</span></a><span class='Parentheses'>) </span><span class='Operator'>&& !</span><a href="opclasscmds.c.html#LN82"><span class='Ref_to_Parameter'>missing_ok</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN118"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>amtup</span><span class='Delimiter'>; 
</span> 
        <a href="opclasscmds.c.html#LN118"><span class='Ref_To_Local'>amtup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN35"><span class='Ref_to_EnumConst'>AMOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN82"><span class='Ref_to_Parameter'>amID</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN118"><span class='Ref_To_Local'>amtup</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for access method %u"</span><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN82"><span class='Ref_to_Parameter'>amID</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"operator family \"%s\" does not exist for access method \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN82"><span class='Ref_to_Parameter'>opfamilyname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(((</span><a href="../../include/catalog/pg_am.h.html#LN45"><span class='Ref_to_Typedef'>Form_pg_am</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN118"><span class='Ref_To_Local'>amtup</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>amname<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="opclasscmds.c.html#LN86"><span class='Ref_To_Local'>htup</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end OpFamilyCacheLookup &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * get_opfamily_oid 
 *    find an opfamily OID by possibly qualified name 
 * 
 * If not found, returns InvalidOid if missing_ok, else throws error. 
 */ 
</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN140"></a><span class='Declare_Function'>get_opfamily_oid</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>amID</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>opfamilyname</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>missing_ok</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN142"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>htup</span><span class='Delimiter'>; 
</span><a name="LN143"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>opfID</span><span class='Delimiter'>; 
</span> 
    <a href="opclasscmds.c.html#LN142"><span class='Ref_To_Local'>htup</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN81"><span class='Ref_to_Func'>OpFamilyCacheLookup</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN140"><span class='Ref_to_Parameter'>amID</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN140"><span class='Ref_to_Parameter'>opfamilyname</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN140"><span class='Ref_to_Parameter'>missing_ok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN142"><span class='Ref_To_Local'>htup</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN143"><span class='Ref_To_Local'>opfID</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN142"><span class='Ref_To_Local'>htup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN142"><span class='Ref_To_Local'>htup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="opclasscmds.c.html#LN143"><span class='Ref_To_Local'>opfID</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * OpClassCacheLookup 
 *      Look up an existing opclass by name. 
 * 
 * Returns a syscache tuple reference, or NULL if not found. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> 
<a name="LN161"></a><span class='Declare_Function'>OpClassCacheLookup</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>amID</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>opclassname</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>missing_ok</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN163"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>schemaname</span><span class='Delimiter'>; 
</span><a name="LN164"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>opcname</span><span class='Delimiter'>; 
</span><a name="LN165"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>htup</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* deconstruct the name list */ 
</span>    <a href="../../include/catalog/namespace.h.html#LN109"><span class='Ref_to_Proto'>DeconstructQualifiedName</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN161"><span class='Ref_to_Parameter'>opclassname</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN163"><span class='Ref_To_Local'>schemaname</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN164"><span class='Ref_To_Local'>opcname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN163"><span class='Ref_To_Local'>schemaname</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Look in specific schema only */ 
</span><a name="LN173"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>namespaceId</span><span class='Delimiter'>; 
</span> 
        <a href="opclasscmds.c.html#LN173"><span class='Ref_To_Local'>namespaceId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN113"><span class='Ref_to_Proto'>LookupExplicitNamespace</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN163"><span class='Ref_To_Local'>schemaname</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN161"><span class='Ref_to_Parameter'>missing_ok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN173"><span class='Ref_To_Local'>namespaceId</span></a><span class='Parentheses'>))</span> 
            <a href="opclasscmds.c.html#LN165"><span class='Ref_To_Local'>htup</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="opclasscmds.c.html#LN165"><span class='Ref_To_Local'>htup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN159"><span class='Ref_to_Macro'>SearchSysCache3</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN46"><span class='Ref_to_EnumConst'>CLAAMNAMENSP</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN161"><span class='Ref_to_Parameter'>amID</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN164"><span class='Ref_To_Local'>opcname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN173"><span class='Ref_To_Local'>namespaceId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Unqualified opclass name, so search the search path */ 
</span><a name="LN187"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>opcID</span> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN82"><span class='Ref_to_Proto'>OpclassnameGetOpcid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN161"><span class='Ref_to_Parameter'>amID</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN164"><span class='Ref_To_Local'>opcname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN187"><span class='Ref_To_Local'>opcID</span></a><span class='Parentheses'>))</span> 
            <a href="opclasscmds.c.html#LN165"><span class='Ref_To_Local'>htup</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="opclasscmds.c.html#LN165"><span class='Ref_To_Local'>htup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN47"><span class='Ref_to_EnumConst'>CLAOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN187"><span class='Ref_To_Local'>opcID</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN165"><span class='Ref_To_Local'>htup</span></a><span class='Parentheses'>) </span><span class='Operator'>&& !</span><a href="opclasscmds.c.html#LN161"><span class='Ref_to_Parameter'>missing_ok</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN197"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>amtup</span><span class='Delimiter'>; 
</span> 
        <a href="opclasscmds.c.html#LN197"><span class='Ref_To_Local'>amtup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN35"><span class='Ref_to_EnumConst'>AMOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN161"><span class='Ref_to_Parameter'>amID</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN197"><span class='Ref_To_Local'>amtup</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for access method %u"</span><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN161"><span class='Ref_to_Parameter'>amID</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"operator class \"%s\" does not exist for access method \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN161"><span class='Ref_to_Parameter'>opclassname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(((</span><a href="../../include/catalog/pg_am.h.html#LN45"><span class='Ref_to_Typedef'>Form_pg_am</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN197"><span class='Ref_To_Local'>amtup</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>amname<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="opclasscmds.c.html#LN165"><span class='Ref_To_Local'>htup</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end OpClassCacheLookup &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * get_opclass_oid 
 *    find an opclass OID by possibly qualified name 
 * 
 * If not found, returns InvalidOid if missing_ok, else throws error. 
 */ 
</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN219"></a><span class='Declare_Function'>get_opclass_oid</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>amID</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>opclassname</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>missing_ok</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN221"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>htup</span><span class='Delimiter'>; 
</span><a name="LN222"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>opcID</span><span class='Delimiter'>; 
</span> 
    <a href="opclasscmds.c.html#LN221"><span class='Ref_To_Local'>htup</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN160"><span class='Ref_to_Func'>OpClassCacheLookup</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN219"><span class='Ref_to_Parameter'>amID</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN219"><span class='Ref_to_Parameter'>opclassname</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN219"><span class='Ref_to_Parameter'>missing_ok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN221"><span class='Ref_To_Local'>htup</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN222"><span class='Ref_To_Local'>opcID</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN221"><span class='Ref_To_Local'>htup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN221"><span class='Ref_To_Local'>htup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="opclasscmds.c.html#LN222"><span class='Ref_To_Local'>opcID</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * CreateOpFamily 
 *      Internal routine to make the catalog entry for a new operator family. 
 * 
 * Caller must have done permissions checks etc. already. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN240"></a><span class='Declare_Function'>CreateOpFamily</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>amname</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>opfname</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>namespaceoid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>amoid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN242"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>opfamilyoid</span><span class='Delimiter'>; 
</span><a name="LN243"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN244"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN245"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_opfamily.h.html#LN49"><span class='Ref_to_Const'>Natts_pg_opfamily</span></a><span class='Delimiter'>]; 
</span><a name="LN246"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_opfamily.h.html#LN49"><span class='Ref_to_Const'>Natts_pg_opfamily</span></a><span class='Delimiter'>]; 
</span><a name="LN247"></a>    <a href="../../include/c.h.html#LN492"><span class='Ref_to_Typedef'>NameData</span></a>    <span class='Declare_Local'>opfName</span><span class='Delimiter'>; 
</span><a name="LN248"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>myself</span><span class='Delimiter'>, 
</span><a name="LN249"></a>                <span class='Declare_Local'>referenced</span><span class='Delimiter'>; 
</span> 
    <a href="opclasscmds.c.html#LN243"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_opfamily.h.html#LN28"><span class='Ref_to_Const'>OperatorFamilyRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make sure there is no existing opfamily of this name (this is just to 
     * give a more friendly error message than "duplicate key"). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN177"><span class='Ref_to_Macro'>SearchSysCacheExists3</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN72"><span class='Ref_to_EnumConst'>OPFAMILYAMNAMENSP</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN240"><span class='Ref_to_Parameter'>amoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN240"><span class='Ref_to_Parameter'>opfname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN240"><span class='Ref_to_Parameter'>namespaceoid</span></a><span class='Parentheses'>)))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/pg_basebackup/streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"operator family \"%s\" for access method \"%s\" already exists"</span><span class='Delimiter'>, 
</span>                        <a href="opclasscmds.c.html#LN240"><span class='Ref_to_Parameter'>opfname</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN240"><span class='Ref_to_Parameter'>amname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Okay, let's create the pg_opfamily entry. 
     */ 
</span>    memset<span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN245"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN245"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN246"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN246"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="opclasscmds.c.html#LN245"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_opfamily.h.html#LN50"><span class='Ref_to_Const'>Anum_pg_opfamily_opfmethod</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN240"><span class='Ref_to_Parameter'>amoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/builtins.h.html#LN40"><span class='Ref_to_Proto'>namestrcpy</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN247"><span class='Ref_To_Local'>opfName</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN240"><span class='Ref_to_Parameter'>opfname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN245"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_opfamily.h.html#LN51"><span class='Ref_to_Const'>Anum_pg_opfamily_opfname</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN600"><span class='Ref_to_Macro'>NameGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN247"><span class='Ref_To_Local'>opfName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN245"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_opfamily.h.html#LN52"><span class='Ref_to_Const'>Anum_pg_opfamily_opfnamespace</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN240"><span class='Ref_to_Parameter'>namespaceoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN245"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_opfamily.h.html#LN53"><span class='Ref_to_Const'>Anum_pg_opfamily_opfowner</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span> 
    <a href="opclasscmds.c.html#LN244"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN243"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN245"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN246"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="opclasscmds.c.html#LN242"><span class='Ref_To_Local'>opfamilyoid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/indexing.h.html#LN32"><span class='Ref_to_Proto'>CatalogTupleInsert</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN243"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN244"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN244"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create dependencies for the opfamily proper. 
     */ 
</span>    <a href="opclasscmds.c.html#LN248"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_opfamily.h.html#LN28"><span class='Ref_to_Const'>OperatorFamilyRelationId</span></a><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN248"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN242"><span class='Ref_To_Local'>opfamilyoid</span></a><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN248"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* dependency on access method */ 
</span>    <a href="opclasscmds.c.html#LN249"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_am.h.html#LN31"><span class='Ref_to_Const'>AccessMethodRelationId</span></a><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN249"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN240"><span class='Ref_to_Parameter'>amoid</span></a><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN249"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN248"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN249"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN75"><span class='Ref_to_EnumConst'>DEPENDENCY_AUTO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* dependency on namespace */ 
</span>    <a href="opclasscmds.c.html#LN249"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_namespace.h.html#LN33"><span class='Ref_to_Const'>NamespaceRelationId</span></a><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN249"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN240"><span class='Ref_to_Parameter'>namespaceoid</span></a><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN249"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN248"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN249"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* dependency on owner */ 
</span>    <a href="../catalog/pg_shdepend.c.html#LN157"><span class='Ref_to_Func'>recordDependencyOnOwner</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_opfamily.h.html#LN28"><span class='Ref_to_Const'>OperatorFamilyRelationId</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN242"><span class='Ref_To_Local'>opfamilyoid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* dependency on extension */ 
</span>    <a href="../catalog/pg_depend.c.html#LN137"><span class='Ref_to_Func'>recordDependencyOnCurrentExtension</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN248"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Post creation hook for new operator family */ 
</span>    <a href="../../include/catalog/objectaccess.h.html#LN144"><span class='Ref_to_Macro'>InvokeObjectPostCreateHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_opfamily.h.html#LN28"><span class='Ref_to_Const'>OperatorFamilyRelationId</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN242"><span class='Ref_To_Local'>opfamilyoid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN243"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="opclasscmds.c.html#LN248"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CreateOpFamily &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * DefineOpClass 
 *      Define a new index operator class. 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN322"></a><span class='Declare_Function'>DefineOpClass</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2489"><span class='Ref_to_Struct'>CreateOpClassStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN324"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>opcname</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* name of opclass we're creating */ 
</span><a name="LN325"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>amoid</span><span class='Delimiter'>,</span>          <span class='Comment_Single_Line'>/* our AM's oid */ 
</span><a name="LN326"></a>                <span class='Declare_Local'>typeoid</span><span class='Delimiter'>,</span>        <span class='Comment_Single_Line'>/* indexable datatype oid */ 
</span><a name="LN327"></a>                <span class='Declare_Local'>storageoid</span><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* storage datatype oid, if any */ 
</span><a name="LN328"></a>                <span class='Declare_Local'>namespaceoid</span><span class='Delimiter'>,</span>   <span class='Comment_Single_Line'>/* namespace to create opclass in */ 
</span><a name="LN329"></a>                <span class='Declare_Local'>opfamilyoid</span><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* oid of containing opfamily */ 
</span><a name="LN330"></a>                <span class='Declare_Local'>opclassoid</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* oid of opclass we create */ 
</span><a name="LN331"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>maxOpNumber</span><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* amstrategies value */ 
</span><a name="LN332"></a>                <span class='Declare_Local'>maxProcNumber</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* amsupport value */ 
</span><a name="LN333"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>amstorage</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* amstorage flag */ 
</span><a name="LN334"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>operators</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* OpFamilyMember list for operators */ 
</span><a name="LN335"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>procedures</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* OpFamilyMember list for support procs */ 
</span><a name="LN336"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span><a name="LN337"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN338"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN339"></a>    <a href="../../include/access/amapi.h.html#LN158"><span class='Ref_to_Struct'>IndexAmRoutine</span></a> <span class='Operator'>*</span><span class='Declare_Local'>amroutine</span><span class='Delimiter'>; 
</span><a name="LN340"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_opclass.h.html#LN73"><span class='Ref_to_Const'>Natts_pg_opclass</span></a><span class='Delimiter'>]; 
</span><a name="LN341"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_opclass.h.html#LN73"><span class='Ref_to_Const'>Natts_pg_opclass</span></a><span class='Delimiter'>]; 
</span><a name="LN342"></a>    <a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span><a name="LN343"></a>    <a href="../../include/c.h.html#LN492"><span class='Ref_to_Typedef'>NameData</span></a>    <span class='Declare_Local'>opcName</span><span class='Delimiter'>; 
</span><a name="LN344"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>myself</span><span class='Delimiter'>, 
</span><a name="LN345"></a>                <span class='Declare_Local'>referenced</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Convert list of names to a name and namespace */ 
</span>    <a href="opclasscmds.c.html#LN328"><span class='Ref_To_Local'>namespaceoid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN118"><span class='Ref_to_Proto'>QualifiedNameGetCreationNamespace</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN322"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2492"><span class='Ref_to_Member'>opclassname</span></a><span class='Delimiter'>, 
</span>                                                     <span class='Operator'>&</span><a href="opclasscmds.c.html#LN324"><span class='Ref_To_Local'>opcname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check we have creation rights in target namespace */ 
</span>    <a href="opclasscmds.c.html#LN342"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN289"><span class='Ref_to_Proto'>pg_namespace_aclcheck</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN328"><span class='Ref_To_Local'>namespaceoid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN81"><span class='Ref_to_Const'>ACL_CREATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN342"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN342"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN189"><span class='Ref_to_EnumConst'>ACL_KIND_NAMESPACE</span></a><span class='Delimiter'>, 
</span>                       <a href="../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN328"><span class='Ref_To_Local'>namespaceoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get necessary info about access method */ 
</span>    <a href="opclasscmds.c.html#LN338"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN34"><span class='Ref_to_EnumConst'>AMNAME</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN322"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2494"><span class='Ref_to_Member'>amname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN338"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"access method \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="opclasscmds.c.html#LN322"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2494"><span class='Ref_to_Member'>amname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="opclasscmds.c.html#LN325"><span class='Ref_To_Local'>amoid</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN338"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN339"><span class='Ref_To_Local'>amroutine</span></a> <span class='Operator'>= </span><a href="../access/index/amapi.c.html#LN54"><span class='Ref_to_Func'>GetIndexAmRoutineByAmId</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN325"><span class='Ref_To_Local'>amoid</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN338"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="opclasscmds.c.html#LN331"><span class='Ref_To_Local'>maxOpNumber</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN339"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/amapi.h.html#LN166"><span class='Ref_to_Member'>amstrategies</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* if amstrategies is zero, just enforce that op numbers fit in int16 */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN331"><span class='Ref_To_Local'>maxOpNumber</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="opclasscmds.c.html#LN331"><span class='Ref_To_Local'>maxOpNumber</span></a> <span class='Operator'>= </span>SHRT_MAX<span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN332"><span class='Ref_To_Local'>maxProcNumber</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN339"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/amapi.h.html#LN168"><span class='Ref_to_Member'>amsupport</span></a><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN333"><span class='Ref_To_Local'>amstorage</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN339"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/amapi.h.html#LN186"><span class='Ref_to_Member'>amstorage</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* XXX Should we make any privilege check against the AM? */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The question of appropriate permissions for CREATE OPERATOR CLASS is 
     * interesting.  Creating an opclass is tantamount to granting public 
     * execute access on the functions involved, since the index machinery 
     * generally does not check access permission before using the functions. 
     * A minimum expectation therefore is that the caller have execute 
     * privilege with grant option.  Since we don't have a way to make the 
     * opclass go away if the grant option is revoked, we choose instead to 
     * require ownership of the functions.  It's also not entirely clear what 
     * permissions should be required on the datatype, but ownership seems 
     * like a safe choice. 
     * 
     * Currently, we require superuser privileges to create an opclass. This 
     * seems necessary because we have no way to validate that the offered set 
     * of operators and functions are consistent with the AM's expectations. 
     * It would be nice to provide such a check someday, if it can be done 
     * without solving the halting problem :-( 
     * 
     * XXX re-enable NOT_USED code sections below if you remove this test. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>())</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"must be superuser to create an operator class"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Look up the datatype */ 
</span>    <a href="opclasscmds.c.html#LN326"><span class='Ref_To_Local'>typeoid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN27"><span class='Ref_to_Proto'>typenameTypeId</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN322"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2495"><span class='Ref_to_Member'>datatype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> NOT_USED 
    <span class='Comment_Multi_Line'>/* XXX this is unnecessary given the superuser check above */ 
</span>    <span class='Comment_Multi_Line'>/* Check we have ownership of the datatype */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN309"><span class='Ref_to_Proto'>pg_type_ownercheck</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN326"><span class='Ref_To_Local'>typeoid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
        <a href="../../include/utils/acl.h.html#LN301"><span class='Ref_to_Proto'>aclcheck_error_type</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN326"><span class='Ref_To_Local'>typeoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Look up the containing operator family, or create one if FAMILY option 
     * was omitted and there's not a match already. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN322"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2493"><span class='Ref_to_Member'>opfamilyname</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="opclasscmds.c.html#LN329"><span class='Ref_To_Local'>opfamilyoid</span></a> <span class='Operator'>= </span><a href="../../include/commands/defrem.h.html#LN104"><span class='Ref_to_Proto'>get_opfamily_oid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN325"><span class='Ref_To_Local'>amoid</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN322"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2493"><span class='Ref_to_Member'>opfamilyname</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Lookup existing family of same name and namespace */ 
</span>        <a href="opclasscmds.c.html#LN338"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN159"><span class='Ref_to_Macro'>SearchSysCache3</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN72"><span class='Ref_to_EnumConst'>OPFAMILYAMNAMENSP</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN325"><span class='Ref_To_Local'>amoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN324"><span class='Ref_To_Local'>opcname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN328"><span class='Ref_To_Local'>namespaceoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN338"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="opclasscmds.c.html#LN329"><span class='Ref_To_Local'>opfamilyoid</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN338"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * XXX given the superuser check above, there's no need for an 
             * ownership check here 
             */ 
</span>            <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN338"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span><a name="LN440"></a>            <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>tmpAddr</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Create it ... again no need for more permissions ... 
             */ 
</span>            <a href="opclasscmds.c.html#LN440"><span class='Ref_To_Local'>tmpAddr</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN239"><span class='Ref_to_Func'>CreateOpFamily</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN322"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2494"><span class='Ref_to_Member'>amname</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN324"><span class='Ref_To_Local'>opcname</span></a><span class='Delimiter'>, 
</span>                                     <a href="opclasscmds.c.html#LN328"><span class='Ref_To_Local'>namespaceoid</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN325"><span class='Ref_To_Local'>amoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="opclasscmds.c.html#LN329"><span class='Ref_To_Local'>opfamilyoid</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN440"><span class='Ref_To_Local'>tmpAddr</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <a href="opclasscmds.c.html#LN334"><span class='Ref_To_Local'>operators</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN335"><span class='Ref_To_Local'>procedures</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Storage datatype is optional */ 
</span>    <a href="opclasscmds.c.html#LN327"><span class='Ref_To_Local'>storageoid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Scan the "items" list to obtain additional info. 
     */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN336"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN322"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2496"><span class='Ref_to_Member'>items</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN462"></a>        <a href="../../include/nodes/parsenodes.h.html#LN2504"><span class='Ref_to_Struct'>CreateOpClassItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>item</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2504"><span class='Ref_to_Struct'>CreateOpClassItem</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN336"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN463"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>operOid</span><span class='Delimiter'>; 
</span><a name="LN464"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>funcOid</span><span class='Delimiter'>; 
</span><a name="LN465"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>sortfamilyOid</span><span class='Delimiter'>; 
</span><a name="LN466"></a>        <a href="../../include/catalog/opfam_internal.h.html#LN18"><span class='Ref_to_Typedef'>OpFamilyMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>member</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN462"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2507"><span class='Ref_to_Member'>itemtype</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2500"><span class='Ref_to_Const'>OPCLASS_ITEM_OPERATOR</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN462"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2509"><span class='Ref_to_Member'>number</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="opclasscmds.c.html#LN462"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2509"><span class='Ref_to_Member'>number</span></a> <span class='Operator'>&GT; </span><a href="opclasscmds.c.html#LN331"><span class='Ref_To_Local'>maxOpNumber</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid operator number %d,"</span> 
                                    <span class='String'>" must be between 1 and %d"</span><span class='Delimiter'>, 
</span>                                    <a href="opclasscmds.c.html#LN462"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2509"><span class='Ref_to_Member'>number</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN331"><span class='Ref_To_Local'>maxOpNumber</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN462"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2508"><span class='Ref_to_Member'>name</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1852"><span class='Ref_to_Member'>objargs</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>                    <a href="opclasscmds.c.html#LN463"><span class='Ref_To_Local'>operOid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_oper.h.html#LN27"><span class='Ref_to_Proto'>LookupOperWithArgs</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN462"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2508"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* Default to binary op on input datatype */ 
</span>                    <a href="opclasscmds.c.html#LN463"><span class='Ref_To_Local'>operOid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_oper.h.html#LN24"><span class='Ref_to_Proto'>LookupOperName</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN462"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2508"><span class='Ref_to_Member'>name</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1851"><span class='Ref_to_Member'>objname</span></a><span class='Delimiter'>, 
</span>                                             <a href="opclasscmds.c.html#LN326"><span class='Ref_To_Local'>typeoid</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN326"><span class='Ref_To_Local'>typeoid</span></a><span class='Delimiter'>, 
</span>                                             <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN462"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2510"><span class='Ref_to_Member'>order_family</span></a><span class='Parentheses'>) 
</span>                    <a href="opclasscmds.c.html#LN465"><span class='Ref_To_Local'>sortfamilyOid</span></a> <span class='Operator'>= </span><a href="../../include/commands/defrem.h.html#LN104"><span class='Ref_to_Proto'>get_opfamily_oid</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_am.h.html#LN69"><span class='Ref_to_Const'>BTREE_AM_OID</span></a><span class='Delimiter'>, 
</span>                                                     <a href="opclasscmds.c.html#LN462"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2510"><span class='Ref_to_Member'>order_family</span></a><span class='Delimiter'>, 
</span>                                                     <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="opclasscmds.c.html#LN465"><span class='Ref_To_Local'>sortfamilyOid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> NOT_USED 
                <span class='Comment_Multi_Line'>/* XXX this is unnecessary given the superuser check above */ 
</span>                <span class='Comment_Multi_Line'>/* Caller must own operator and its underlying function */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN310"><span class='Ref_to_Proto'>pg_oper_ownercheck</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN463"><span class='Ref_To_Local'>operOid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
                    <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN185"><span class='Ref_to_EnumConst'>ACL_KIND_OPER</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../include/utils/lsyscache.h.html#LN99"><span class='Ref_to_Proto'>get_opname</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN463"><span class='Ref_To_Local'>operOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="opclasscmds.c.html#LN464"><span class='Ref_To_Local'>funcOid</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN98"><span class='Ref_to_Proto'>get_opcode</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN463"><span class='Ref_To_Local'>operOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN311"><span class='Ref_to_Proto'>pg_proc_ownercheck</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN464"><span class='Ref_To_Local'>funcOid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
                    <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN184"><span class='Ref_to_EnumConst'>ACL_KIND_PROC</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../include/utils/lsyscache.h.html#LN110"><span class='Ref_to_Proto'>get_func_name</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN464"><span class='Ref_To_Local'>funcOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
                <span class='Comment_Multi_Line'>/* Save the info */ 
</span>                <a href="opclasscmds.c.html#LN466"><span class='Ref_To_Local'>member</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/opfam_internal.h.html#LN18"><span class='Ref_to_Typedef'>OpFamilyMember</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/catalog/opfam_internal.h.html#LN18"><span class='Ref_to_Typedef'>OpFamilyMember</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="opclasscmds.c.html#LN466"><span class='Ref_To_Local'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN20"><span class='Ref_to_Member'>object</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN463"><span class='Ref_To_Local'>operOid</span></a><span class='Delimiter'>; 
</span>                <a href="opclasscmds.c.html#LN466"><span class='Ref_To_Local'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN21"><span class='Ref_to_Member'>number</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN462"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2509"><span class='Ref_to_Member'>number</span></a><span class='Delimiter'>; 
</span>                <a href="opclasscmds.c.html#LN466"><span class='Ref_To_Local'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN24"><span class='Ref_to_Member'>sortfamily</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN465"><span class='Ref_To_Local'>sortfamilyOid</span></a><span class='Delimiter'>; 
</span>                <a href="opclasscmds.c.html#LN61"><span class='Ref_to_Proto'>assignOperTypes</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN466"><span class='Ref_To_Local'>member</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN325"><span class='Ref_To_Local'>amoid</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN326"><span class='Ref_To_Local'>typeoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="opclasscmds.c.html#LN63"><span class='Ref_to_Proto'>addFamilyMember</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN334"><span class='Ref_To_Local'>operators</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN466"><span class='Ref_To_Local'>member</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2501"><span class='Ref_to_Const'>OPCLASS_ITEM_FUNCTION</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN462"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2509"><span class='Ref_to_Member'>number</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="opclasscmds.c.html#LN462"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2509"><span class='Ref_to_Member'>number</span></a> <span class='Operator'>&GT; </span><a href="opclasscmds.c.html#LN332"><span class='Ref_To_Local'>maxProcNumber</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid procedure number %d,"</span> 
                                    <span class='String'>" must be between 1 and %d"</span><span class='Delimiter'>, 
</span>                                    <a href="opclasscmds.c.html#LN462"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2509"><span class='Ref_to_Member'>number</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN332"><span class='Ref_To_Local'>maxProcNumber</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <a href="opclasscmds.c.html#LN464"><span class='Ref_To_Local'>funcOid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_func.h.html#LN64"><span class='Ref_to_Proto'>LookupFuncWithArgs</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN462"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2508"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> NOT_USED 
                <span class='Comment_Multi_Line'>/* XXX this is unnecessary given the superuser check above */ 
</span>                <span class='Comment_Multi_Line'>/* Caller must own function */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN311"><span class='Ref_to_Proto'>pg_proc_ownercheck</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN464"><span class='Ref_To_Local'>funcOid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
                    <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN184"><span class='Ref_to_EnumConst'>ACL_KIND_PROC</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../include/utils/lsyscache.h.html#LN110"><span class='Ref_to_Proto'>get_func_name</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN464"><span class='Ref_To_Local'>funcOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
                <span class='Comment_Multi_Line'>/* Save the info */ 
</span>                <a href="opclasscmds.c.html#LN466"><span class='Ref_To_Local'>member</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/opfam_internal.h.html#LN18"><span class='Ref_to_Typedef'>OpFamilyMember</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/catalog/opfam_internal.h.html#LN18"><span class='Ref_to_Typedef'>OpFamilyMember</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="opclasscmds.c.html#LN466"><span class='Ref_To_Local'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN20"><span class='Ref_to_Member'>object</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN464"><span class='Ref_To_Local'>funcOid</span></a><span class='Delimiter'>; 
</span>                <a href="opclasscmds.c.html#LN466"><span class='Ref_To_Local'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN21"><span class='Ref_to_Member'>number</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN462"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2509"><span class='Ref_to_Member'>number</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* allow overriding of the function's actual arg types */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN462"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2511"><span class='Ref_to_Member'>class_args</span></a><span class='Parentheses'>) 
</span>                    <a href="opclasscmds.c.html#LN60"><span class='Ref_to_Proto'>processTypesSpec</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN462"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2511"><span class='Ref_to_Member'>class_args</span></a><span class='Delimiter'>, 
</span>                                     <span class='Operator'>&</span><a href="opclasscmds.c.html#LN466"><span class='Ref_To_Local'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN22"><span class='Ref_to_Member'>lefttype</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN466"><span class='Ref_To_Local'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN23"><span class='Ref_to_Member'>righttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="opclasscmds.c.html#LN62"><span class='Ref_to_Proto'>assignProcTypes</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN466"><span class='Ref_To_Local'>member</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN325"><span class='Ref_To_Local'>amoid</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN326"><span class='Ref_To_Local'>typeoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="opclasscmds.c.html#LN63"><span class='Ref_to_Proto'>addFamilyMember</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN335"><span class='Ref_To_Local'>procedures</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN466"><span class='Ref_To_Local'>member</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2502"><span class='Ref_to_Const'>OPCLASS_ITEM_STORAGETYPE</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN327"><span class='Ref_To_Local'>storageoid</span></a><span class='Parentheses'>))</span> 
                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"storage type specified more than once"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <a href="opclasscmds.c.html#LN327"><span class='Ref_To_Local'>storageoid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN27"><span class='Ref_to_Proto'>typenameTypeId</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN462"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2514"><span class='Ref_to_Member'>storedtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> NOT_USED 
                <span class='Comment_Multi_Line'>/* XXX this is unnecessary given the superuser check above */ 
</span>                <span class='Comment_Multi_Line'>/* Check we have ownership of the datatype */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN309"><span class='Ref_to_Proto'>pg_type_ownercheck</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN327"><span class='Ref_To_Local'>storageoid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
                    <a href="../../include/utils/acl.h.html#LN301"><span class='Ref_to_Proto'>aclcheck_error_type</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN327"><span class='Ref_To_Local'>storageoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized item type: %d"</span><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN462"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2507"><span class='Ref_to_Member'>itemtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch item-&GT;itemtype &raquo; </span> 
    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If storagetype is specified, make sure it's legal. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN327"><span class='Ref_To_Local'>storageoid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Just drop the spec if same as column datatype */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN327"><span class='Ref_To_Local'>storageoid</span></a> <span class='Operator'>== </span><a href="opclasscmds.c.html#LN326"><span class='Ref_To_Local'>typeoid</span></a><span class='Parentheses'>) 
</span>            <a href="opclasscmds.c.html#LN327"><span class='Ref_To_Local'>storageoid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="opclasscmds.c.html#LN333"><span class='Ref_To_Local'>amstorage</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"storage type cannot be different from data type for access method \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="opclasscmds.c.html#LN322"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2494"><span class='Ref_to_Member'>amname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="opclasscmds.c.html#LN337"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_opclass.h.html#LN48"><span class='Ref_to_Const'>OperatorClassRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make sure there is no existing opclass of this name (this is just to 
     * give a more friendly error message than "duplicate key"). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN177"><span class='Ref_to_Macro'>SearchSysCacheExists3</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN46"><span class='Ref_to_EnumConst'>CLAAMNAMENSP</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN325"><span class='Ref_To_Local'>amoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN324"><span class='Ref_To_Local'>opcname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN328"><span class='Ref_To_Local'>namespaceoid</span></a><span class='Parentheses'>)))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/pg_basebackup/streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"operator class \"%s\" for access method \"%s\" already exists"</span><span class='Delimiter'>, 
</span>                        <a href="opclasscmds.c.html#LN324"><span class='Ref_To_Local'>opcname</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN322"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2494"><span class='Ref_to_Member'>amname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we are creating a default opclass, check there isn't one already. 
     * (Note we do not restrict this test to visible opclasses; this ensures 
     * that typcache.c can find unique solutions to its questions.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN322"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2497"><span class='Ref_to_Member'>isDefault</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN600"></a>        <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>skey</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN601"></a>        <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span> 
        <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN600"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                    <a href="../../include/catalog/pg_opclass.h.html#LN74"><span class='Ref_to_Const'>Anum_pg_opclass_opcmethod</span></a><span class='Delimiter'>, 
</span>                    <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                    <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN325"><span class='Ref_To_Local'>amoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="opclasscmds.c.html#LN601"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN337"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN197"><span class='Ref_to_Const'>OpclassAmNameNspIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                  <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN600"><span class='Ref_To_Local'>skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN338"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN601"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN613"></a>            <a href="../../include/catalog/pg_opclass.h.html#LN67"><span class='Ref_to_Typedef'>Form_pg_opclass</span></a> <span class='Declare_Local'>opclass</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_opclass.h.html#LN67"><span class='Ref_to_Typedef'>Form_pg_opclass</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN338"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN613"><span class='Ref_To_Local'>opclass</span></a><span class='Operator'>-&GT;</span>opcintype <span class='Operator'>== </span><a href="opclasscmds.c.html#LN326"><span class='Ref_To_Local'>typeoid</span></a> <span class='Operator'>&& </span><a href="opclasscmds.c.html#LN613"><span class='Ref_To_Local'>opclass</span></a><span class='Operator'>-&GT;</span>opcdefault<span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/pg_basebackup/streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not make operator class \"%s\" be default for type %s"</span><span class='Delimiter'>, 
</span>                                <a href="opclasscmds.c.html#LN324"><span class='Ref_To_Local'>opcname</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/parser/parse_type.h.html#LN31"><span class='Ref_to_Proto'>TypeNameToString</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN322"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2495"><span class='Ref_to_Member'>datatype</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                   <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Operator class \"%s\" already is the default."</span><span class='Delimiter'>, 
</span>                             <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN613"><span class='Ref_To_Local'>opclass</span></a><span class='Operator'>-&GT;</span>opcname<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN601"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if stmt-&GT;isDefault &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Okay, let's create the pg_opclass entry. 
     */ 
</span>    memset<span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN340"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN340"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN341"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN341"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="opclasscmds.c.html#LN340"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_opclass.h.html#LN74"><span class='Ref_to_Const'>Anum_pg_opclass_opcmethod</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN325"><span class='Ref_To_Local'>amoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/builtins.h.html#LN40"><span class='Ref_to_Proto'>namestrcpy</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN343"><span class='Ref_To_Local'>opcName</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN324"><span class='Ref_To_Local'>opcname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN340"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_opclass.h.html#LN75"><span class='Ref_to_Const'>Anum_pg_opclass_opcname</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN600"><span class='Ref_to_Macro'>NameGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN343"><span class='Ref_To_Local'>opcName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN340"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_opclass.h.html#LN76"><span class='Ref_to_Const'>Anum_pg_opclass_opcnamespace</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN328"><span class='Ref_To_Local'>namespaceoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN340"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_opclass.h.html#LN77"><span class='Ref_to_Const'>Anum_pg_opclass_opcowner</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN340"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_opclass.h.html#LN78"><span class='Ref_to_Const'>Anum_pg_opclass_opcfamily</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN329"><span class='Ref_To_Local'>opfamilyoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN340"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_opclass.h.html#LN79"><span class='Ref_to_Const'>Anum_pg_opclass_opcintype</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN326"><span class='Ref_To_Local'>typeoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN340"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_opclass.h.html#LN80"><span class='Ref_to_Const'>Anum_pg_opclass_opcdefault</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN322"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2497"><span class='Ref_to_Member'>isDefault</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN340"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_opclass.h.html#LN81"><span class='Ref_to_Const'>Anum_pg_opclass_opckeytype</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN327"><span class='Ref_To_Local'>storageoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="opclasscmds.c.html#LN338"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN337"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN340"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN341"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="opclasscmds.c.html#LN330"><span class='Ref_To_Local'>opclassoid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/indexing.h.html#LN32"><span class='Ref_to_Proto'>CatalogTupleInsert</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN337"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN338"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN338"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now add tuples to pg_amop and pg_amproc tying in the operators and 
     * functions.  Dependencies on them are inserted, too. 
     */ 
</span>    <a href="opclasscmds.c.html#LN64"><span class='Ref_to_Proto'>storeOperators</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN322"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2493"><span class='Ref_to_Member'>opfamilyname</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN325"><span class='Ref_To_Local'>amoid</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN329"><span class='Ref_To_Local'>opfamilyoid</span></a><span class='Delimiter'>, 
</span>                   <a href="opclasscmds.c.html#LN330"><span class='Ref_To_Local'>opclassoid</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN334"><span class='Ref_To_Local'>operators</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN67"><span class='Ref_to_Proto'>storeProcedures</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN322"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2493"><span class='Ref_to_Member'>opfamilyname</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN325"><span class='Ref_To_Local'>amoid</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN329"><span class='Ref_To_Local'>opfamilyoid</span></a><span class='Delimiter'>, 
</span>                    <a href="opclasscmds.c.html#LN330"><span class='Ref_To_Local'>opclassoid</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN335"><span class='Ref_To_Local'>procedures</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* let event triggers know what happened */ 
</span>    <a href="../../include/commands/event_trigger.h.html#LN81"><span class='Ref_to_Proto'>EventTriggerCollectCreateOpClass</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN322"><span class='Ref_to_Parameter'>stmt</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN330"><span class='Ref_To_Local'>opclassoid</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN334"><span class='Ref_To_Local'>operators</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN335"><span class='Ref_To_Local'>procedures</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create dependencies for the opclass proper.  Note: we do not need a 
     * dependency link to the AM, because that exists through the opfamily. 
     */ 
</span>    <a href="opclasscmds.c.html#LN344"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_opclass.h.html#LN48"><span class='Ref_to_Const'>OperatorClassRelationId</span></a><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN344"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN330"><span class='Ref_To_Local'>opclassoid</span></a><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN344"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* dependency on namespace */ 
</span>    <a href="opclasscmds.c.html#LN345"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_namespace.h.html#LN33"><span class='Ref_to_Const'>NamespaceRelationId</span></a><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN345"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN328"><span class='Ref_To_Local'>namespaceoid</span></a><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN345"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN344"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN345"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* dependency on opfamily */ 
</span>    <a href="opclasscmds.c.html#LN345"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_opfamily.h.html#LN28"><span class='Ref_to_Const'>OperatorFamilyRelationId</span></a><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN345"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN329"><span class='Ref_To_Local'>opfamilyoid</span></a><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN345"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN344"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN345"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN75"><span class='Ref_to_EnumConst'>DEPENDENCY_AUTO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* dependency on indexed datatype */ 
</span>    <a href="opclasscmds.c.html#LN345"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN345"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN326"><span class='Ref_To_Local'>typeoid</span></a><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN345"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN344"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN345"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* dependency on storage datatype */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN327"><span class='Ref_To_Local'>storageoid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="opclasscmds.c.html#LN345"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="opclasscmds.c.html#LN345"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN327"><span class='Ref_To_Local'>storageoid</span></a><span class='Delimiter'>; 
</span>        <a href="opclasscmds.c.html#LN345"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN344"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN345"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* dependency on owner */ 
</span>    <a href="../catalog/pg_shdepend.c.html#LN157"><span class='Ref_to_Func'>recordDependencyOnOwner</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_opclass.h.html#LN48"><span class='Ref_to_Const'>OperatorClassRelationId</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN330"><span class='Ref_To_Local'>opclassoid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* dependency on extension */ 
</span>    <a href="../catalog/pg_depend.c.html#LN137"><span class='Ref_to_Func'>recordDependencyOnCurrentExtension</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN344"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Post creation hook for new operator class */ 
</span>    <a href="../../include/catalog/objectaccess.h.html#LN144"><span class='Ref_to_Macro'>InvokeObjectPostCreateHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_opclass.h.html#LN48"><span class='Ref_to_Const'>OperatorClassRelationId</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN330"><span class='Ref_To_Local'>opclassoid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN337"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="opclasscmds.c.html#LN344"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DefineOpClass &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * DefineOpFamily 
 *      Define a new index operator family. 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN717"></a><span class='Declare_Function'>DefineOpFamily</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2521"><span class='Ref_to_Struct'>CreateOpFamilyStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN719"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>opfname</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* name of opfamily we're creating */ 
</span><a name="LN720"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>amoid</span><span class='Delimiter'>,</span>          <span class='Comment_Single_Line'>/* our AM's oid */ 
</span><a name="LN721"></a>                <span class='Declare_Local'>namespaceoid</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* namespace to create opfamily in */ 
</span><a name="LN722"></a>    <a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Convert list of names to a name and namespace */ 
</span>    <a href="opclasscmds.c.html#LN721"><span class='Ref_To_Local'>namespaceoid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN118"><span class='Ref_to_Proto'>QualifiedNameGetCreationNamespace</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN717"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2524"><span class='Ref_to_Member'>opfamilyname</span></a><span class='Delimiter'>, 
</span>                                                     <span class='Operator'>&</span><a href="opclasscmds.c.html#LN719"><span class='Ref_To_Local'>opfname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check we have creation rights in target namespace */ 
</span>    <a href="opclasscmds.c.html#LN722"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN289"><span class='Ref_to_Proto'>pg_namespace_aclcheck</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN721"><span class='Ref_To_Local'>namespaceoid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN81"><span class='Ref_to_Const'>ACL_CREATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN722"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN722"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN189"><span class='Ref_to_EnumConst'>ACL_KIND_NAMESPACE</span></a><span class='Delimiter'>, 
</span>                       <a href="../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN721"><span class='Ref_To_Local'>namespaceoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get access method OID, throwing an error if it doesn't exist. */ 
</span>    <a href="opclasscmds.c.html#LN720"><span class='Ref_To_Local'>amoid</span></a> <span class='Operator'>= </span><a href="../../include/commands/defrem.h.html#LN150"><span class='Ref_to_Proto'>get_index_am_oid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN717"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2525"><span class='Ref_to_Member'>amname</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* XXX Should we make any privilege check against the AM? */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Currently, we require superuser privileges to create an opfamily. See 
     * comments in DefineOpClass. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>())</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"must be superuser to create an operator family"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Insert pg_opfamily catalog entry */ 
</span>    <span class='Control'>return</span> <a href="opclasscmds.c.html#LN239"><span class='Ref_to_Func'>CreateOpFamily</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN717"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2525"><span class='Ref_to_Member'>amname</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN719"><span class='Ref_To_Local'>opfname</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN721"><span class='Ref_To_Local'>namespaceoid</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN720"><span class='Ref_To_Local'>amoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DefineOpFamily &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * AlterOpFamily 
 *      Add or remove operators/procedures within an existing operator family. 
 * 
 * Note: this implements only ALTER OPERATOR FAMILY ... ADD/DROP.  Some 
 * other commands called ALTER OPERATOR FAMILY exist, but go through 
 * different code paths. 
 */ 
</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN762"></a><span class='Declare_Function'>AlterOpFamily</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2532"><span class='Ref_to_Struct'>AlterOpFamilyStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN764"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>amoid</span><span class='Delimiter'>,</span>          <span class='Comment_Single_Line'>/* our AM's oid */ 
</span><a name="LN765"></a>                <span class='Declare_Local'>opfamilyoid</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* oid of opfamily */ 
</span><a name="LN766"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>maxOpNumber</span><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* amstrategies value */ 
</span><a name="LN767"></a>                <span class='Declare_Local'>maxProcNumber</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* amsupport value */ 
</span><a name="LN768"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN769"></a>    <a href="../../include/access/amapi.h.html#LN158"><span class='Ref_to_Struct'>IndexAmRoutine</span></a> <span class='Operator'>*</span><span class='Declare_Local'>amroutine</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get necessary info about access method */ 
</span>    <a href="opclasscmds.c.html#LN768"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN34"><span class='Ref_to_EnumConst'>AMNAME</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN762"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2536"><span class='Ref_to_Member'>amname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN768"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"access method \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="opclasscmds.c.html#LN762"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2536"><span class='Ref_to_Member'>amname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="opclasscmds.c.html#LN764"><span class='Ref_To_Local'>amoid</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN768"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN769"><span class='Ref_To_Local'>amroutine</span></a> <span class='Operator'>= </span><a href="../access/index/amapi.c.html#LN54"><span class='Ref_to_Func'>GetIndexAmRoutineByAmId</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN764"><span class='Ref_To_Local'>amoid</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN768"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="opclasscmds.c.html#LN766"><span class='Ref_To_Local'>maxOpNumber</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN769"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/amapi.h.html#LN166"><span class='Ref_to_Member'>amstrategies</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* if amstrategies is zero, just enforce that op numbers fit in int16 */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN766"><span class='Ref_To_Local'>maxOpNumber</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="opclasscmds.c.html#LN766"><span class='Ref_To_Local'>maxOpNumber</span></a> <span class='Operator'>= </span>SHRT_MAX<span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN767"><span class='Ref_To_Local'>maxProcNumber</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN769"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/amapi.h.html#LN168"><span class='Ref_to_Member'>amsupport</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* XXX Should we make any privilege check against the AM? */ 
</span> 
    <span class='Comment_Multi_Line'>/* Look up the opfamily */ 
</span>    <a href="opclasscmds.c.html#LN765"><span class='Ref_To_Local'>opfamilyoid</span></a> <span class='Operator'>= </span><a href="../../include/commands/defrem.h.html#LN104"><span class='Ref_to_Proto'>get_opfamily_oid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN764"><span class='Ref_To_Local'>amoid</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN762"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2535"><span class='Ref_to_Member'>opfamilyname</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Currently, we require superuser privileges to alter an opfamily. 
     * 
     * XXX re-enable NOT_USED code sections below if you remove this test. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>())</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"must be superuser to alter an operator family"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * ADD and DROP cases need separate code from here on down. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN762"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2537"><span class='Ref_to_Member'>isDrop</span></a><span class='Parentheses'>) 
</span>        <a href="opclasscmds.c.html#LN56"><span class='Ref_to_Proto'>AlterOpFamilyDrop</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN762"><span class='Ref_to_Parameter'>stmt</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN764"><span class='Ref_To_Local'>amoid</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN765"><span class='Ref_To_Local'>opfamilyoid</span></a><span class='Delimiter'>, 
</span>                          <a href="opclasscmds.c.html#LN766"><span class='Ref_To_Local'>maxOpNumber</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN767"><span class='Ref_To_Local'>maxProcNumber</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN762"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2538"><span class='Ref_to_Member'>items</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="opclasscmds.c.html#LN52"><span class='Ref_to_Proto'>AlterOpFamilyAdd</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN762"><span class='Ref_to_Parameter'>stmt</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN764"><span class='Ref_To_Local'>amoid</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN765"><span class='Ref_To_Local'>opfamilyoid</span></a><span class='Delimiter'>, 
</span>                         <a href="opclasscmds.c.html#LN766"><span class='Ref_To_Local'>maxOpNumber</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN767"><span class='Ref_To_Local'>maxProcNumber</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN762"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2538"><span class='Ref_to_Member'>items</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="opclasscmds.c.html#LN765"><span class='Ref_To_Local'>opfamilyoid</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterOpFamily &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ADD part of ALTER OP FAMILY 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN821"></a><span class='Declare_Function'>AlterOpFamilyAdd</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2532"><span class='Ref_to_Struct'>AlterOpFamilyStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>amoid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opfamilyoid</span><span class='Delimiter'>, 
</span><a name="LN822"></a>                 <span class='Keyword'>int </span><span class='Declare_Parameter'>maxOpNumber</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>maxProcNumber</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>items</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN824"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>operators</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* OpFamilyMember list for operators */ 
</span><a name="LN825"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>procedures</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* OpFamilyMember list for support procs */ 
</span><a name="LN826"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <a href="opclasscmds.c.html#LN824"><span class='Ref_To_Local'>operators</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN825"><span class='Ref_To_Local'>procedures</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Scan the "items" list to obtain additional info. 
     */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN826"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN822"><span class='Ref_to_Parameter'>items</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN836"></a>        <a href="../../include/nodes/parsenodes.h.html#LN2504"><span class='Ref_to_Struct'>CreateOpClassItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>item</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2504"><span class='Ref_to_Struct'>CreateOpClassItem</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN826"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN837"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>operOid</span><span class='Delimiter'>; 
</span><a name="LN838"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>funcOid</span><span class='Delimiter'>; 
</span><a name="LN839"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>sortfamilyOid</span><span class='Delimiter'>; 
</span><a name="LN840"></a>        <a href="../../include/catalog/opfam_internal.h.html#LN18"><span class='Ref_to_Typedef'>OpFamilyMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>member</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN836"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2507"><span class='Ref_to_Member'>itemtype</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2500"><span class='Ref_to_Const'>OPCLASS_ITEM_OPERATOR</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN836"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2509"><span class='Ref_to_Member'>number</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="opclasscmds.c.html#LN836"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2509"><span class='Ref_to_Member'>number</span></a> <span class='Operator'>&GT; </span><a href="opclasscmds.c.html#LN822"><span class='Ref_to_Parameter'>maxOpNumber</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid operator number %d,"</span> 
                                    <span class='String'>" must be between 1 and %d"</span><span class='Delimiter'>, 
</span>                                    <a href="opclasscmds.c.html#LN836"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2509"><span class='Ref_to_Member'>number</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN822"><span class='Ref_to_Parameter'>maxOpNumber</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN836"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2508"><span class='Ref_to_Member'>name</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1852"><span class='Ref_to_Member'>objargs</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>                    <a href="opclasscmds.c.html#LN837"><span class='Ref_To_Local'>operOid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_oper.h.html#LN27"><span class='Ref_to_Proto'>LookupOperWithArgs</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN836"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2508"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"operator argument types must be specified in ALTER OPERATOR FAMILY"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <a href="opclasscmds.c.html#LN837"><span class='Ref_To_Local'>operOid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN836"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2510"><span class='Ref_to_Member'>order_family</span></a><span class='Parentheses'>) 
</span>                    <a href="opclasscmds.c.html#LN839"><span class='Ref_To_Local'>sortfamilyOid</span></a> <span class='Operator'>= </span><a href="../../include/commands/defrem.h.html#LN104"><span class='Ref_to_Proto'>get_opfamily_oid</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_am.h.html#LN69"><span class='Ref_to_Const'>BTREE_AM_OID</span></a><span class='Delimiter'>, 
</span>                                                     <a href="opclasscmds.c.html#LN836"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2510"><span class='Ref_to_Member'>order_family</span></a><span class='Delimiter'>, 
</span>                                                     <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="opclasscmds.c.html#LN839"><span class='Ref_To_Local'>sortfamilyOid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> NOT_USED 
                <span class='Comment_Multi_Line'>/* XXX this is unnecessary given the superuser check above */ 
</span>                <span class='Comment_Multi_Line'>/* Caller must own operator and its underlying function */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN310"><span class='Ref_to_Proto'>pg_oper_ownercheck</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN837"><span class='Ref_To_Local'>operOid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
                    <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN185"><span class='Ref_to_EnumConst'>ACL_KIND_OPER</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../include/utils/lsyscache.h.html#LN99"><span class='Ref_to_Proto'>get_opname</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN837"><span class='Ref_To_Local'>operOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="opclasscmds.c.html#LN838"><span class='Ref_To_Local'>funcOid</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN98"><span class='Ref_to_Proto'>get_opcode</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN837"><span class='Ref_To_Local'>operOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN311"><span class='Ref_to_Proto'>pg_proc_ownercheck</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN838"><span class='Ref_To_Local'>funcOid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
                    <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN184"><span class='Ref_to_EnumConst'>ACL_KIND_PROC</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../include/utils/lsyscache.h.html#LN110"><span class='Ref_to_Proto'>get_func_name</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN838"><span class='Ref_To_Local'>funcOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
                <span class='Comment_Multi_Line'>/* Save the info */ 
</span>                <a href="opclasscmds.c.html#LN840"><span class='Ref_To_Local'>member</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/opfam_internal.h.html#LN18"><span class='Ref_to_Typedef'>OpFamilyMember</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/catalog/opfam_internal.h.html#LN18"><span class='Ref_to_Typedef'>OpFamilyMember</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="opclasscmds.c.html#LN840"><span class='Ref_To_Local'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN20"><span class='Ref_to_Member'>object</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN837"><span class='Ref_To_Local'>operOid</span></a><span class='Delimiter'>; 
</span>                <a href="opclasscmds.c.html#LN840"><span class='Ref_To_Local'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN21"><span class='Ref_to_Member'>number</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN836"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2509"><span class='Ref_to_Member'>number</span></a><span class='Delimiter'>; 
</span>                <a href="opclasscmds.c.html#LN840"><span class='Ref_To_Local'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN24"><span class='Ref_to_Member'>sortfamily</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN839"><span class='Ref_To_Local'>sortfamilyOid</span></a><span class='Delimiter'>; 
</span>                <a href="opclasscmds.c.html#LN61"><span class='Ref_to_Proto'>assignOperTypes</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN840"><span class='Ref_To_Local'>member</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN821"><span class='Ref_to_Parameter'>amoid</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="opclasscmds.c.html#LN63"><span class='Ref_to_Proto'>addFamilyMember</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN824"><span class='Ref_To_Local'>operators</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN840"><span class='Ref_To_Local'>member</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2501"><span class='Ref_to_Const'>OPCLASS_ITEM_FUNCTION</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN836"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2509"><span class='Ref_to_Member'>number</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="opclasscmds.c.html#LN836"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2509"><span class='Ref_to_Member'>number</span></a> <span class='Operator'>&GT; </span><a href="opclasscmds.c.html#LN822"><span class='Ref_to_Parameter'>maxProcNumber</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid procedure number %d,"</span> 
                                    <span class='String'>" must be between 1 and %d"</span><span class='Delimiter'>, 
</span>                                    <a href="opclasscmds.c.html#LN836"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2509"><span class='Ref_to_Member'>number</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN822"><span class='Ref_to_Parameter'>maxProcNumber</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <a href="opclasscmds.c.html#LN838"><span class='Ref_To_Local'>funcOid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_func.h.html#LN64"><span class='Ref_to_Proto'>LookupFuncWithArgs</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN836"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2508"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> NOT_USED 
                <span class='Comment_Multi_Line'>/* XXX this is unnecessary given the superuser check above */ 
</span>                <span class='Comment_Multi_Line'>/* Caller must own function */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN311"><span class='Ref_to_Proto'>pg_proc_ownercheck</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN838"><span class='Ref_To_Local'>funcOid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
                    <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN184"><span class='Ref_to_EnumConst'>ACL_KIND_PROC</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../include/utils/lsyscache.h.html#LN110"><span class='Ref_to_Proto'>get_func_name</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN838"><span class='Ref_To_Local'>funcOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
                <span class='Comment_Multi_Line'>/* Save the info */ 
</span>                <a href="opclasscmds.c.html#LN840"><span class='Ref_To_Local'>member</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/opfam_internal.h.html#LN18"><span class='Ref_to_Typedef'>OpFamilyMember</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/catalog/opfam_internal.h.html#LN18"><span class='Ref_to_Typedef'>OpFamilyMember</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="opclasscmds.c.html#LN840"><span class='Ref_To_Local'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN20"><span class='Ref_to_Member'>object</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN838"><span class='Ref_To_Local'>funcOid</span></a><span class='Delimiter'>; 
</span>                <a href="opclasscmds.c.html#LN840"><span class='Ref_To_Local'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN21"><span class='Ref_to_Member'>number</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN836"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2509"><span class='Ref_to_Member'>number</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* allow overriding of the function's actual arg types */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN836"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2511"><span class='Ref_to_Member'>class_args</span></a><span class='Parentheses'>) 
</span>                    <a href="opclasscmds.c.html#LN60"><span class='Ref_to_Proto'>processTypesSpec</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN836"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2511"><span class='Ref_to_Member'>class_args</span></a><span class='Delimiter'>, 
</span>                                     <span class='Operator'>&</span><a href="opclasscmds.c.html#LN840"><span class='Ref_To_Local'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN22"><span class='Ref_to_Member'>lefttype</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN840"><span class='Ref_To_Local'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN23"><span class='Ref_to_Member'>righttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="opclasscmds.c.html#LN62"><span class='Ref_to_Proto'>assignProcTypes</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN840"><span class='Ref_To_Local'>member</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN821"><span class='Ref_to_Parameter'>amoid</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="opclasscmds.c.html#LN63"><span class='Ref_to_Proto'>addFamilyMember</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN825"><span class='Ref_To_Local'>procedures</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN840"><span class='Ref_To_Local'>member</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2502"><span class='Ref_to_Const'>OPCLASS_ITEM_STORAGETYPE</span></a><span class='Operator'>: 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"STORAGE cannot be specified in ALTER OPERATOR FAMILY"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized item type: %d"</span><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN836"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2507"><span class='Ref_to_Member'>itemtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch item-&GT;itemtype &raquo; </span> 
    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Add tuples to pg_amop and pg_amproc tying in the operators and 
     * functions.  Dependencies on them are inserted, too. 
     */ 
</span>    <a href="opclasscmds.c.html#LN64"><span class='Ref_to_Proto'>storeOperators</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN821"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2535"><span class='Ref_to_Member'>opfamilyname</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN821"><span class='Ref_to_Parameter'>amoid</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN821"><span class='Ref_to_Parameter'>opfamilyoid</span></a><span class='Delimiter'>, 
</span>                   <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN824"><span class='Ref_To_Local'>operators</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN67"><span class='Ref_to_Proto'>storeProcedures</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN821"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2535"><span class='Ref_to_Member'>opfamilyname</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN821"><span class='Ref_to_Parameter'>amoid</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN821"><span class='Ref_to_Parameter'>opfamilyoid</span></a><span class='Delimiter'>, 
</span>                    <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN825"><span class='Ref_To_Local'>procedures</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* make information available to event triggers */ 
</span>    <a href="../../include/commands/event_trigger.h.html#LN78"><span class='Ref_to_Proto'>EventTriggerCollectAlterOpFam</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN821"><span class='Ref_to_Parameter'>stmt</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN821"><span class='Ref_to_Parameter'>opfamilyoid</span></a><span class='Delimiter'>, 
</span>                                  <a href="opclasscmds.c.html#LN824"><span class='Ref_To_Local'>operators</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN825"><span class='Ref_To_Local'>procedures</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterOpFamilyAdd &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * DROP part of ALTER OP FAMILY 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN946"></a><span class='Declare_Function'>AlterOpFamilyDrop</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2532"><span class='Ref_to_Struct'>AlterOpFamilyStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>amoid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opfamilyoid</span><span class='Delimiter'>, 
</span><a name="LN947"></a>                  <span class='Keyword'>int </span><span class='Declare_Parameter'>maxOpNumber</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>maxProcNumber</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>items</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN949"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>operators</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* OpFamilyMember list for operators */ 
</span><a name="LN950"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>procedures</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* OpFamilyMember list for support procs */ 
</span><a name="LN951"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <a href="opclasscmds.c.html#LN949"><span class='Ref_To_Local'>operators</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN950"><span class='Ref_To_Local'>procedures</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Scan the "items" list to obtain additional info. 
     */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN951"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN947"><span class='Ref_to_Parameter'>items</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN961"></a>        <a href="../../include/nodes/parsenodes.h.html#LN2504"><span class='Ref_to_Struct'>CreateOpClassItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>item</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2504"><span class='Ref_to_Struct'>CreateOpClassItem</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN951"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN962"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>lefttype</span><span class='Delimiter'>, 
</span><a name="LN963"></a>                    <span class='Declare_Local'>righttype</span><span class='Delimiter'>; 
</span><a name="LN964"></a>        <a href="../../include/catalog/opfam_internal.h.html#LN18"><span class='Ref_to_Typedef'>OpFamilyMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>member</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN961"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2507"><span class='Ref_to_Member'>itemtype</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2500"><span class='Ref_to_Const'>OPCLASS_ITEM_OPERATOR</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN961"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2509"><span class='Ref_to_Member'>number</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="opclasscmds.c.html#LN961"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2509"><span class='Ref_to_Member'>number</span></a> <span class='Operator'>&GT; </span><a href="opclasscmds.c.html#LN947"><span class='Ref_to_Parameter'>maxOpNumber</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid operator number %d,"</span> 
                                    <span class='String'>" must be between 1 and %d"</span><span class='Delimiter'>, 
</span>                                    <a href="opclasscmds.c.html#LN961"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2509"><span class='Ref_to_Member'>number</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN947"><span class='Ref_to_Parameter'>maxOpNumber</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <a href="opclasscmds.c.html#LN60"><span class='Ref_to_Proto'>processTypesSpec</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN961"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2511"><span class='Ref_to_Member'>class_args</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN962"><span class='Ref_To_Local'>lefttype</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN963"><span class='Ref_To_Local'>righttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Save the info */ 
</span>                <a href="opclasscmds.c.html#LN964"><span class='Ref_To_Local'>member</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/opfam_internal.h.html#LN18"><span class='Ref_to_Typedef'>OpFamilyMember</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/catalog/opfam_internal.h.html#LN18"><span class='Ref_to_Typedef'>OpFamilyMember</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="opclasscmds.c.html#LN964"><span class='Ref_To_Local'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN21"><span class='Ref_to_Member'>number</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN961"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2509"><span class='Ref_to_Member'>number</span></a><span class='Delimiter'>; 
</span>                <a href="opclasscmds.c.html#LN964"><span class='Ref_To_Local'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN22"><span class='Ref_to_Member'>lefttype</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN962"><span class='Ref_To_Local'>lefttype</span></a><span class='Delimiter'>; 
</span>                <a href="opclasscmds.c.html#LN964"><span class='Ref_To_Local'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN23"><span class='Ref_to_Member'>righttype</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN963"><span class='Ref_To_Local'>righttype</span></a><span class='Delimiter'>; 
</span>                <a href="opclasscmds.c.html#LN63"><span class='Ref_to_Proto'>addFamilyMember</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN949"><span class='Ref_To_Local'>operators</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN964"><span class='Ref_To_Local'>member</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2501"><span class='Ref_to_Const'>OPCLASS_ITEM_FUNCTION</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN961"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2509"><span class='Ref_to_Member'>number</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="opclasscmds.c.html#LN961"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2509"><span class='Ref_to_Member'>number</span></a> <span class='Operator'>&GT; </span><a href="opclasscmds.c.html#LN947"><span class='Ref_to_Parameter'>maxProcNumber</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid procedure number %d,"</span> 
                                    <span class='String'>" must be between 1 and %d"</span><span class='Delimiter'>, 
</span>                                    <a href="opclasscmds.c.html#LN961"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2509"><span class='Ref_to_Member'>number</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN947"><span class='Ref_to_Parameter'>maxProcNumber</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <a href="opclasscmds.c.html#LN60"><span class='Ref_to_Proto'>processTypesSpec</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN961"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2511"><span class='Ref_to_Member'>class_args</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN962"><span class='Ref_To_Local'>lefttype</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN963"><span class='Ref_To_Local'>righttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Save the info */ 
</span>                <a href="opclasscmds.c.html#LN964"><span class='Ref_To_Local'>member</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/opfam_internal.h.html#LN18"><span class='Ref_to_Typedef'>OpFamilyMember</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/catalog/opfam_internal.h.html#LN18"><span class='Ref_to_Typedef'>OpFamilyMember</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="opclasscmds.c.html#LN964"><span class='Ref_To_Local'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN21"><span class='Ref_to_Member'>number</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN961"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2509"><span class='Ref_to_Member'>number</span></a><span class='Delimiter'>; 
</span>                <a href="opclasscmds.c.html#LN964"><span class='Ref_To_Local'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN22"><span class='Ref_to_Member'>lefttype</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN962"><span class='Ref_To_Local'>lefttype</span></a><span class='Delimiter'>; 
</span>                <a href="opclasscmds.c.html#LN964"><span class='Ref_To_Local'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN23"><span class='Ref_to_Member'>righttype</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN963"><span class='Ref_To_Local'>righttype</span></a><span class='Delimiter'>; 
</span>                <a href="opclasscmds.c.html#LN63"><span class='Ref_to_Proto'>addFamilyMember</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN950"><span class='Ref_To_Local'>procedures</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN964"><span class='Ref_To_Local'>member</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2502"><span class='Ref_to_Const'>OPCLASS_ITEM_STORAGETYPE</span></a><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* grammar prevents this from appearing */ 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized item type: %d"</span><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN961"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2507"><span class='Ref_to_Member'>itemtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch item-&GT;itemtype &raquo; </span> 
    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Remove tuples from pg_amop and pg_amproc. 
     */ 
</span>    <a href="opclasscmds.c.html#LN70"><span class='Ref_to_Proto'>dropOperators</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN946"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2535"><span class='Ref_to_Member'>opfamilyname</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN946"><span class='Ref_to_Parameter'>amoid</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN946"><span class='Ref_to_Parameter'>opfamilyoid</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN949"><span class='Ref_To_Local'>operators</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN72"><span class='Ref_to_Proto'>dropProcedures</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN946"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2535"><span class='Ref_to_Member'>opfamilyname</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN946"><span class='Ref_to_Parameter'>amoid</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN946"><span class='Ref_to_Parameter'>opfamilyoid</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN950"><span class='Ref_To_Local'>procedures</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* make information available to event triggers */ 
</span>    <a href="../../include/commands/event_trigger.h.html#LN78"><span class='Ref_to_Proto'>EventTriggerCollectAlterOpFam</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN946"><span class='Ref_to_Parameter'>stmt</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN946"><span class='Ref_to_Parameter'>opfamilyoid</span></a><span class='Delimiter'>, 
</span>                                  <a href="opclasscmds.c.html#LN949"><span class='Ref_To_Local'>operators</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN950"><span class='Ref_To_Local'>procedures</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterOpFamilyDrop &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Deal with explicit arg types used in ALTER ADD/DROP 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1022"></a><span class='Declare_Function'>processTypesSpec</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>args</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lefttype</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>righttype</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1024"></a>    <a href="../../include/nodes/parsenodes.h.html#LN205"><span class='Ref_to_Struct'>TypeName</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>typeName</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1022"><span class='Ref_to_Parameter'>args</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="opclasscmds.c.html#LN1024"><span class='Ref_To_Local'>typeName</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN205"><span class='Ref_to_Struct'>TypeName</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1022"><span class='Ref_to_Parameter'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="opclasscmds.c.html#LN1022"><span class='Ref_to_Parameter'>lefttype</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN27"><span class='Ref_to_Proto'>typenameTypeId</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN1024"><span class='Ref_To_Local'>typeName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1022"><span class='Ref_to_Parameter'>args</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="opclasscmds.c.html#LN1024"><span class='Ref_To_Local'>typeName</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN205"><span class='Ref_to_Struct'>TypeName</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN115"><span class='Ref_to_Macro'>lsecond</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1022"><span class='Ref_to_Parameter'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="opclasscmds.c.html#LN1022"><span class='Ref_to_Parameter'>righttype</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN27"><span class='Ref_to_Proto'>typenameTypeId</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN1024"><span class='Ref_To_Local'>typeName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <span class='Operator'>*</span><a href="opclasscmds.c.html#LN1022"><span class='Ref_to_Parameter'>righttype</span></a> <span class='Operator'>= *</span><a href="opclasscmds.c.html#LN1022"><span class='Ref_to_Parameter'>lefttype</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1022"><span class='Ref_to_Parameter'>args</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"one or two argument types must be specified"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end processTypesSpec &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Determine the lefttype/righttype to assign to an operator, 
 * and do any validity checking we can manage. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1051"></a><span class='Declare_Function'>assignOperTypes</span><span class='Parentheses'>(</span><a href="../../include/catalog/opfam_internal.h.html#LN18"><span class='Ref_to_Typedef'>OpFamilyMember</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>member</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>amoid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeoid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1053"></a>    <a href="../../include/parser/parse_oper.h.html#LN21"><span class='Ref_to_Typedef'>Operator</span></a>    <span class='Declare_Local'>optup</span><span class='Delimiter'>; 
</span><a name="LN1054"></a>    <a href="../../include/catalog/pg_operator.h.html#LN56"><span class='Ref_to_Typedef'>Form_pg_operator</span></a> <span class='Declare_Local'>opform</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Fetch the operator definition */ 
</span>    <a href="opclasscmds.c.html#LN1053"><span class='Ref_To_Local'>optup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN71"><span class='Ref_to_EnumConst'>OPEROID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1051"><span class='Ref_to_Parameter'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN20"><span class='Ref_to_Member'>object</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1053"><span class='Ref_To_Local'>optup</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for operator %u"</span><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN1051"><span class='Ref_to_Parameter'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN20"><span class='Ref_to_Member'>object</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN1054"><span class='Ref_To_Local'>opform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_operator.h.html#LN56"><span class='Ref_to_Typedef'>Form_pg_operator</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1053"><span class='Ref_To_Local'>optup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Opfamily operators must be binary. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1054"><span class='Ref_To_Local'>opform</span></a><span class='Operator'>-&GT;</span>oprkind <span class='Operator'>!= </span><span class='String'>'b'</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"index operators must be binary"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1051"><span class='Ref_to_Parameter'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN24"><span class='Ref_to_Member'>sortfamily</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Ordering op, check index supports that.  (We could perhaps also 
         * check that the operator returns a type supported by the sortfamily, 
         * but that seems more trouble than it's worth here.  If it does not, 
         * the operator will never be matchable to any ORDER BY clause, but no 
         * worse consequences can ensue.  Also, trying to check that would 
         * create an ordering hazard during dump/reload: it's possible that 
         * the family has been created but not yet populated with the required 
         * operators.) 
         */ 
</span><a name="LN1082"></a>        <a href="../../include/access/amapi.h.html#LN158"><span class='Ref_to_Struct'>IndexAmRoutine</span></a> <span class='Operator'>*</span><span class='Declare_Local'>amroutine</span> <span class='Operator'>= </span><a href="../access/index/amapi.c.html#LN54"><span class='Ref_to_Func'>GetIndexAmRoutineByAmId</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1051"><span class='Ref_to_Parameter'>amoid</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="opclasscmds.c.html#LN1082"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/amapi.h.html#LN172"><span class='Ref_to_Member'>amcanorderbyop</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"access method \"%s\" does not support ordering operators"</span><span class='Delimiter'>, 
</span>                   <a href="../../include/commands/defrem.h.html#LN152"><span class='Ref_to_Proto'>get_am_name</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1051"><span class='Ref_to_Parameter'>amoid</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if OidIsValid(member-&GT;so... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Search operators must return boolean. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1054"><span class='Ref_To_Local'>opform</span></a><span class='Operator'>-&GT;</span>oprresult <span class='Operator'>!= </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN17"><span class='Ref_to_Const'>BOOLOID</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"index search operators must return boolean"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If lefttype/righttype isn't specified, use the operator's input types 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1051"><span class='Ref_to_Parameter'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN22"><span class='Ref_to_Member'>lefttype</span></a><span class='Parentheses'>))</span> 
        <a href="opclasscmds.c.html#LN1051"><span class='Ref_to_Parameter'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN22"><span class='Ref_to_Member'>lefttype</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN1054"><span class='Ref_To_Local'>opform</span></a><span class='Operator'>-&GT;</span>oprleft<span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1051"><span class='Ref_to_Parameter'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN23"><span class='Ref_to_Member'>righttype</span></a><span class='Parentheses'>))</span> 
        <a href="opclasscmds.c.html#LN1051"><span class='Ref_to_Parameter'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN23"><span class='Ref_to_Member'>righttype</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN1054"><span class='Ref_To_Local'>opform</span></a><span class='Operator'>-&GT;</span>oprright<span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1053"><span class='Ref_To_Local'>optup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end assignOperTypes &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Determine the lefttype/righttype to assign to a support procedure, 
 * and do any validity checking we can manage. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1117"></a><span class='Declare_Function'>assignProcTypes</span><span class='Parentheses'>(</span><a href="../../include/catalog/opfam_internal.h.html#LN18"><span class='Ref_to_Typedef'>OpFamilyMember</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>member</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>amoid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeoid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1119"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>proctup</span><span class='Delimiter'>; 
</span><a name="LN1120"></a>    <a href="../../include/catalog/pg_proc.h.html#LN82"><span class='Ref_to_Typedef'>Form_pg_proc</span></a> <span class='Declare_Local'>procform</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Fetch the procedure definition */ 
</span>    <a href="opclasscmds.c.html#LN1119"><span class='Ref_To_Local'>proctup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN76"><span class='Ref_to_EnumConst'>PROCOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1117"><span class='Ref_to_Parameter'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN20"><span class='Ref_to_Member'>object</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1119"><span class='Ref_To_Local'>proctup</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for function %u"</span><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN1117"><span class='Ref_to_Parameter'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN20"><span class='Ref_to_Member'>object</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="opclasscmds.c.html#LN1120"><span class='Ref_To_Local'>procform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_proc.h.html#LN82"><span class='Ref_to_Typedef'>Form_pg_proc</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1119"><span class='Ref_To_Local'>proctup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * btree comparison procs must be 2-arg procs returning int4, while btree 
     * sortsupport procs must take internal and return void.  hash support 
     * procs must be 1-arg procs returning int4.  Otherwise we don't know. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1117"><span class='Ref_to_Parameter'>amoid</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_am.h.html#LN69"><span class='Ref_to_Const'>BTREE_AM_OID</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1117"><span class='Ref_to_Parameter'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN21"><span class='Ref_to_Member'>number</span></a> <span class='Operator'>== </span><a href="../../include/access/nbtree.h.html#LN228"><span class='Ref_to_Const'>BTORDER_PROC</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1120"><span class='Ref_To_Local'>procform</span></a><span class='Operator'>-&GT;</span>pronargs <span class='Operator'>!= </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"btree comparison procedures must have two arguments"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1120"><span class='Ref_To_Local'>procform</span></a><span class='Operator'>-&GT;</span>prorettype <span class='Operator'>!= </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN24"><span class='Ref_to_Const'>INT4OID</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"btree comparison procedures must return integer"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If lefttype/righttype isn't specified, use the proc's input 
             * types 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1117"><span class='Ref_to_Parameter'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN22"><span class='Ref_to_Member'>lefttype</span></a><span class='Parentheses'>))</span> 
                <a href="opclasscmds.c.html#LN1117"><span class='Ref_to_Parameter'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN22"><span class='Ref_to_Member'>lefttype</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN1120"><span class='Ref_To_Local'>procform</span></a><span class='Operator'>-&GT;</span>proargtypes<span class='Operator'>.</span>values<span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1117"><span class='Ref_to_Parameter'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN23"><span class='Ref_to_Member'>righttype</span></a><span class='Parentheses'>))</span> 
                <a href="opclasscmds.c.html#LN1117"><span class='Ref_to_Parameter'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN23"><span class='Ref_to_Member'>righttype</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN1120"><span class='Ref_To_Local'>procform</span></a><span class='Operator'>-&GT;</span>proargtypes<span class='Operator'>.</span>values<span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if member-&GT;number==BTORD... &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1117"><span class='Ref_to_Parameter'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN21"><span class='Ref_to_Member'>number</span></a> <span class='Operator'>== </span><a href="../../include/access/nbtree.h.html#LN229"><span class='Ref_to_Const'>BTSORTSUPPORT_PROC</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1120"><span class='Ref_To_Local'>procform</span></a><span class='Operator'>-&GT;</span>pronargs <span class='Operator'>!= </span><span class='Number'>1</span> <span class='Operator'>|| 
</span>                <a href="opclasscmds.c.html#LN1120"><span class='Ref_To_Local'>procform</span></a><span class='Operator'>-&GT;</span>proargtypes<span class='Operator'>.</span>values<span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="../../include/catalog/pg_type.h.html#LN697"><span class='Ref_to_Const'>INTERNALOID</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"btree sort support procedures must accept type \"internal\""</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1120"><span class='Ref_To_Local'>procform</span></a><span class='Operator'>-&GT;</span>prorettype <span class='Operator'>!= </span><a href="../../include/catalog/pg_type.h.html#LN689"><span class='Ref_to_Const'>VOIDOID</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                  <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"btree sort support procedures must return void"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Can't infer lefttype/righttype from proc, so use default rule 
             */ 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if amoid==BTREE_AM_OID &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1117"><span class='Ref_to_Parameter'>amoid</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_am.h.html#LN72"><span class='Ref_to_Const'>HASH_AM_OID</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1120"><span class='Ref_To_Local'>procform</span></a><span class='Operator'>-&GT;</span>pronargs <span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"hash procedures must have one argument"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1120"><span class='Ref_To_Local'>procform</span></a><span class='Operator'>-&GT;</span>prorettype <span class='Operator'>!= </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN24"><span class='Ref_to_Const'>INT4OID</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"hash procedures must return integer"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If lefttype/righttype isn't specified, use the proc's input type 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1117"><span class='Ref_to_Parameter'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN22"><span class='Ref_to_Member'>lefttype</span></a><span class='Parentheses'>))</span> 
            <a href="opclasscmds.c.html#LN1117"><span class='Ref_to_Parameter'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN22"><span class='Ref_to_Member'>lefttype</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN1120"><span class='Ref_To_Local'>procform</span></a><span class='Operator'>-&GT;</span>proargtypes<span class='Operator'>.</span>values<span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1117"><span class='Ref_to_Parameter'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN23"><span class='Ref_to_Member'>righttype</span></a><span class='Parentheses'>))</span> 
            <a href="opclasscmds.c.html#LN1117"><span class='Ref_to_Parameter'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN23"><span class='Ref_to_Member'>righttype</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN1120"><span class='Ref_To_Local'>procform</span></a><span class='Operator'>-&GT;</span>proargtypes<span class='Operator'>.</span>values<span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The default in CREATE OPERATOR CLASS is to use the class' opcintype as 
     * lefttype and righttype.  In CREATE or ALTER OPERATOR FAMILY, opcintype 
     * isn't available, so make the user specify the types. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1117"><span class='Ref_to_Parameter'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN22"><span class='Ref_to_Member'>lefttype</span></a><span class='Parentheses'>))</span> 
        <a href="opclasscmds.c.html#LN1117"><span class='Ref_to_Parameter'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN22"><span class='Ref_to_Member'>lefttype</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN1117"><span class='Ref_to_Parameter'>typeoid</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1117"><span class='Ref_to_Parameter'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN23"><span class='Ref_to_Member'>righttype</span></a><span class='Parentheses'>))</span> 
        <a href="opclasscmds.c.html#LN1117"><span class='Ref_to_Parameter'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN23"><span class='Ref_to_Member'>righttype</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN1117"><span class='Ref_to_Parameter'>typeoid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1117"><span class='Ref_to_Parameter'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN22"><span class='Ref_to_Member'>lefttype</span></a><span class='Parentheses'>) </span><span class='Operator'>|| !</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1117"><span class='Ref_to_Parameter'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN23"><span class='Ref_to_Member'>righttype</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"associated data types must be specified for index support procedure"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1119"><span class='Ref_To_Local'>proctup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end assignProcTypes &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Add a new family member to the appropriate list, after checking for 
 * duplicated strategy or proc number. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1215"></a><span class='Declare_Function'>addFamilyMember</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>list</span><span class='Delimiter'>, </span><a href="../../include/catalog/opfam_internal.h.html#LN18"><span class='Ref_to_Typedef'>OpFamilyMember</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>member</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isProc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1217"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1217"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="opclasscmds.c.html#LN1215"><span class='Ref_to_Parameter'>list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1221"></a>        <a href="../../include/catalog/opfam_internal.h.html#LN18"><span class='Ref_to_Typedef'>OpFamilyMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>old</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/opfam_internal.h.html#LN18"><span class='Ref_to_Typedef'>OpFamilyMember</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1217"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1221"><span class='Ref_To_Local'>old</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN21"><span class='Ref_to_Member'>number</span></a> <span class='Operator'>== </span><a href="opclasscmds.c.html#LN1215"><span class='Ref_to_Parameter'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN21"><span class='Ref_to_Member'>number</span></a> <span class='Operator'>&& 
</span>            <a href="opclasscmds.c.html#LN1221"><span class='Ref_To_Local'>old</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN22"><span class='Ref_to_Member'>lefttype</span></a> <span class='Operator'>== </span><a href="opclasscmds.c.html#LN1215"><span class='Ref_to_Parameter'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN22"><span class='Ref_to_Member'>lefttype</span></a> <span class='Operator'>&& 
</span>            <a href="opclasscmds.c.html#LN1221"><span class='Ref_To_Local'>old</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN23"><span class='Ref_to_Member'>righttype</span></a> <span class='Operator'>== </span><a href="opclasscmds.c.html#LN1215"><span class='Ref_to_Parameter'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN23"><span class='Ref_to_Member'>righttype</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1215"><span class='Ref_to_Parameter'>isProc</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"procedure number %d for (%s,%s) appears more than once"</span><span class='Delimiter'>, 
</span>                                <a href="opclasscmds.c.html#LN1215"><span class='Ref_to_Parameter'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN21"><span class='Ref_to_Member'>number</span></a><span class='Delimiter'>, 
</span>                                <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1215"><span class='Ref_to_Parameter'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN22"><span class='Ref_to_Member'>lefttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1215"><span class='Ref_to_Parameter'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN23"><span class='Ref_to_Member'>righttype</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"operator number %d for (%s,%s) appears more than once"</span><span class='Delimiter'>, 
</span>                                <a href="opclasscmds.c.html#LN1215"><span class='Ref_to_Parameter'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN21"><span class='Ref_to_Member'>number</span></a><span class='Delimiter'>, 
</span>                                <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1215"><span class='Ref_to_Parameter'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN22"><span class='Ref_to_Member'>lefttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1215"><span class='Ref_to_Parameter'>member</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN23"><span class='Ref_to_Member'>righttype</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Operator'>*</span><a href="opclasscmds.c.html#LN1215"><span class='Ref_to_Parameter'>list</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="opclasscmds.c.html#LN1215"><span class='Ref_to_Parameter'>list</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN1215"><span class='Ref_to_Parameter'>member</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end addFamilyMember &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Dump the operators to pg_amop 
 * 
 * We also make dependency entries in pg_depend for the opfamily entries. 
 * If opclassoid is valid then make an INTERNAL dependency on that opclass, 
 * else make an AUTO dependency on the opfamily. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1254"></a><span class='Declare_Function'>storeOperators</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>opfamilyname</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>amoid</span><span class='Delimiter'>, 
</span><a name="LN1255"></a>               <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opfamilyoid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opclassoid</span><span class='Delimiter'>, 
</span><a name="LN1256"></a>               <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>operators</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isAdd</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1258"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN1259"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_amop.h.html#LN82"><span class='Ref_to_Const'>Natts_pg_amop</span></a><span class='Delimiter'>]; 
</span><a name="LN1260"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_amop.h.html#LN82"><span class='Ref_to_Const'>Natts_pg_amop</span></a><span class='Delimiter'>]; 
</span><a name="LN1261"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN1262"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>entryoid</span><span class='Delimiter'>; 
</span><a name="LN1263"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>myself</span><span class='Delimiter'>, 
</span><a name="LN1264"></a>                <span class='Declare_Local'>referenced</span><span class='Delimiter'>; 
</span><a name="LN1265"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <a href="opclasscmds.c.html#LN1258"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_amop.h.html#LN53"><span class='Ref_to_Const'>AccessMethodOperatorRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1265"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN1256"><span class='Ref_to_Parameter'>operators</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1271"></a>        <a href="../../include/catalog/opfam_internal.h.html#LN18"><span class='Ref_to_Typedef'>OpFamilyMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>op</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/opfam_internal.h.html#LN18"><span class='Ref_to_Typedef'>OpFamilyMember</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1265"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1272"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>oppurpose</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If adding to an existing family, check for conflict with an 
         * existing pg_amop entry (just to give a nicer error message) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1256"><span class='Ref_to_Parameter'>isAdd</span></a> <span class='Operator'>&& 
</span>            <a href="../../include/utils/syscache.h.html#LN179"><span class='Ref_to_Macro'>SearchSysCacheExists4</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN37"><span class='Ref_to_EnumConst'>AMOPSTRATEGY</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1255"><span class='Ref_to_Parameter'>opfamilyoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1271"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN22"><span class='Ref_to_Member'>lefttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1271"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN23"><span class='Ref_to_Member'>righttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <a href="../../include/postgres.h.html#LN456"><span class='Ref_to_Macro'>Int16GetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1271"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN21"><span class='Ref_to_Member'>number</span></a><span class='Parentheses'>)))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/pg_basebackup/streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"operator %d(%s,%s) already exists in operator family \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="opclasscmds.c.html#LN1271"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN21"><span class='Ref_to_Member'>number</span></a><span class='Delimiter'>, 
</span>                            <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1271"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN22"><span class='Ref_to_Member'>lefttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1271"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN23"><span class='Ref_to_Member'>righttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1254"><span class='Ref_to_Parameter'>opfamilyname</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
        <a href="opclasscmds.c.html#LN1272"><span class='Ref_To_Local'>oppurpose</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1271"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN24"><span class='Ref_to_Member'>sortfamily</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="../../include/catalog/pg_amop.h.html#LN69"><span class='Ref_to_Const'>AMOP_ORDER</span></a> <span class='Operator'>: </span><a href="../../include/catalog/pg_amop.h.html#LN68"><span class='Ref_to_Const'>AMOP_SEARCH</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Create the pg_amop entry */ 
</span>        memset<span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1259"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1259"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memset<span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1260"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1260"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="opclasscmds.c.html#LN1259"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_amop.h.html#LN83"><span class='Ref_to_Const'>Anum_pg_amop_amopfamily</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1255"><span class='Ref_to_Parameter'>opfamilyoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="opclasscmds.c.html#LN1259"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_amop.h.html#LN84"><span class='Ref_to_Const'>Anum_pg_amop_amoplefttype</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1271"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN22"><span class='Ref_to_Member'>lefttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="opclasscmds.c.html#LN1259"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_amop.h.html#LN85"><span class='Ref_to_Const'>Anum_pg_amop_amoprighttype</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1271"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN23"><span class='Ref_to_Member'>righttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="opclasscmds.c.html#LN1259"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_amop.h.html#LN86"><span class='Ref_to_Const'>Anum_pg_amop_amopstrategy</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN456"><span class='Ref_to_Macro'>Int16GetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1271"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN21"><span class='Ref_to_Member'>number</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="opclasscmds.c.html#LN1259"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_amop.h.html#LN87"><span class='Ref_to_Const'>Anum_pg_amop_amoppurpose</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN421"><span class='Ref_to_Macro'>CharGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1272"><span class='Ref_To_Local'>oppurpose</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="opclasscmds.c.html#LN1259"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_amop.h.html#LN88"><span class='Ref_to_Const'>Anum_pg_amop_amopopr</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1271"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN20"><span class='Ref_to_Member'>object</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="opclasscmds.c.html#LN1259"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_amop.h.html#LN89"><span class='Ref_to_Const'>Anum_pg_amop_amopmethod</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1254"><span class='Ref_to_Parameter'>amoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="opclasscmds.c.html#LN1259"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_amop.h.html#LN90"><span class='Ref_to_Const'>Anum_pg_amop_amopsortfamily</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1271"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN24"><span class='Ref_to_Member'>sortfamily</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="opclasscmds.c.html#LN1261"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1258"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN1259"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN1260"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="opclasscmds.c.html#LN1262"><span class='Ref_To_Local'>entryoid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/indexing.h.html#LN32"><span class='Ref_to_Proto'>CatalogTupleInsert</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1258"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN1261"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1261"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Make its dependencies */ 
</span>        <a href="opclasscmds.c.html#LN1263"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_amop.h.html#LN53"><span class='Ref_to_Const'>AccessMethodOperatorRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="opclasscmds.c.html#LN1263"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN1262"><span class='Ref_To_Local'>entryoid</span></a><span class='Delimiter'>; 
</span>        <a href="opclasscmds.c.html#LN1263"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <a href="opclasscmds.c.html#LN1264"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_operator.h.html#LN31"><span class='Ref_to_Const'>OperatorRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="opclasscmds.c.html#LN1264"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN1271"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN20"><span class='Ref_to_Member'>object</span></a><span class='Delimiter'>; 
</span>        <a href="opclasscmds.c.html#LN1264"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1255"><span class='Ref_to_Parameter'>opclassoid</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* if contained in an opclass, use a NORMAL dep on operator */ 
</span>            <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN1263"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN1264"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* ... and an INTERNAL dep on the opclass */ 
</span>            <a href="opclasscmds.c.html#LN1264"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_opclass.h.html#LN48"><span class='Ref_to_Const'>OperatorClassRelationId</span></a><span class='Delimiter'>; 
</span>            <a href="opclasscmds.c.html#LN1264"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN1255"><span class='Ref_to_Parameter'>opclassoid</span></a><span class='Delimiter'>; 
</span>            <a href="opclasscmds.c.html#LN1264"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN1263"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN1264"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN76"><span class='Ref_to_EnumConst'>DEPENDENCY_INTERNAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* if "loose" in the opfamily, use a AUTO dep on operator */ 
</span>            <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN1263"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN1264"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN75"><span class='Ref_to_EnumConst'>DEPENDENCY_AUTO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* ... and an AUTO dep on the opfamily */ 
</span>            <a href="opclasscmds.c.html#LN1264"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_opfamily.h.html#LN28"><span class='Ref_to_Const'>OperatorFamilyRelationId</span></a><span class='Delimiter'>; 
</span>            <a href="opclasscmds.c.html#LN1264"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN1255"><span class='Ref_to_Parameter'>opfamilyoid</span></a><span class='Delimiter'>; 
</span>            <a href="opclasscmds.c.html#LN1264"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN1263"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN1264"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN75"><span class='Ref_to_EnumConst'>DEPENDENCY_AUTO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* A search operator also needs a dep on the referenced opfamily */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1271"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN24"><span class='Ref_to_Member'>sortfamily</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="opclasscmds.c.html#LN1264"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_opfamily.h.html#LN28"><span class='Ref_to_Const'>OperatorFamilyRelationId</span></a><span class='Delimiter'>; 
</span>            <a href="opclasscmds.c.html#LN1264"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN1271"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN24"><span class='Ref_to_Member'>sortfamily</span></a><span class='Delimiter'>; 
</span>            <a href="opclasscmds.c.html#LN1264"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN1263"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN1264"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* Post create hook of this access method operator */ 
</span>        <a href="../../include/catalog/objectaccess.h.html#LN144"><span class='Ref_to_Macro'>InvokeObjectPostCreateHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_amop.h.html#LN53"><span class='Ref_to_Const'>AccessMethodOperatorRelationId</span></a><span class='Delimiter'>, 
</span>                                   <a href="opclasscmds.c.html#LN1262"><span class='Ref_To_Local'>entryoid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1258"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end storeOperators &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Dump the procedures (support routines) to pg_amproc 
 * 
 * We also make dependency entries in pg_depend for the opfamily entries. 
 * If opclassoid is valid then make an INTERNAL dependency on that opclass, 
 * else make an AUTO dependency on the opfamily. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1369"></a><span class='Declare_Function'>storeProcedures</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>opfamilyname</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>amoid</span><span class='Delimiter'>, 
</span><a name="LN1370"></a>                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opfamilyoid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opclassoid</span><span class='Delimiter'>, 
</span><a name="LN1371"></a>                <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>procedures</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isAdd</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1373"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN1374"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_amproc.h.html#LN64"><span class='Ref_to_Const'>Natts_pg_amproc</span></a><span class='Delimiter'>]; 
</span><a name="LN1375"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_amproc.h.html#LN64"><span class='Ref_to_Const'>Natts_pg_amproc</span></a><span class='Delimiter'>]; 
</span><a name="LN1376"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN1377"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>entryoid</span><span class='Delimiter'>; 
</span><a name="LN1378"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>myself</span><span class='Delimiter'>, 
</span><a name="LN1379"></a>                <span class='Declare_Local'>referenced</span><span class='Delimiter'>; 
</span><a name="LN1380"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <a href="opclasscmds.c.html#LN1373"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_amproc.h.html#LN42"><span class='Ref_to_Const'>AccessMethodProcedureRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1380"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN1371"><span class='Ref_to_Parameter'>procedures</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1386"></a>        <a href="../../include/catalog/opfam_internal.h.html#LN18"><span class='Ref_to_Typedef'>OpFamilyMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>proc</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/opfam_internal.h.html#LN18"><span class='Ref_to_Typedef'>OpFamilyMember</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1380"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If adding to an existing family, check for conflict with an 
         * existing pg_amproc entry (just to give a nicer error message) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1371"><span class='Ref_to_Parameter'>isAdd</span></a> <span class='Operator'>&& 
</span>            <a href="../../include/utils/syscache.h.html#LN179"><span class='Ref_to_Macro'>SearchSysCacheExists4</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN38"><span class='Ref_to_EnumConst'>AMPROCNUM</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1370"><span class='Ref_to_Parameter'>opfamilyoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1386"><span class='Ref_To_Local'>proc</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN22"><span class='Ref_to_Member'>lefttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1386"><span class='Ref_To_Local'>proc</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN23"><span class='Ref_to_Member'>righttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <a href="../../include/postgres.h.html#LN456"><span class='Ref_to_Macro'>Int16GetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1386"><span class='Ref_To_Local'>proc</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN21"><span class='Ref_to_Member'>number</span></a><span class='Parentheses'>)))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/pg_basebackup/streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"function %d(%s,%s) already exists in operator family \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="opclasscmds.c.html#LN1386"><span class='Ref_To_Local'>proc</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN21"><span class='Ref_to_Member'>number</span></a><span class='Delimiter'>, 
</span>                            <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1386"><span class='Ref_To_Local'>proc</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN22"><span class='Ref_to_Member'>lefttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1386"><span class='Ref_To_Local'>proc</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN23"><span class='Ref_to_Member'>righttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1369"><span class='Ref_to_Parameter'>opfamilyname</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Create the pg_amproc entry */ 
</span>        memset<span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1374"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1374"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memset<span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1375"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1375"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="opclasscmds.c.html#LN1374"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_amproc.h.html#LN65"><span class='Ref_to_Const'>Anum_pg_amproc_amprocfamily</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1370"><span class='Ref_to_Parameter'>opfamilyoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="opclasscmds.c.html#LN1374"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_amproc.h.html#LN66"><span class='Ref_to_Const'>Anum_pg_amproc_amproclefttype</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1386"><span class='Ref_To_Local'>proc</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN22"><span class='Ref_to_Member'>lefttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="opclasscmds.c.html#LN1374"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_amproc.h.html#LN67"><span class='Ref_to_Const'>Anum_pg_amproc_amprocrighttype</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1386"><span class='Ref_To_Local'>proc</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN23"><span class='Ref_to_Member'>righttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="opclasscmds.c.html#LN1374"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_amproc.h.html#LN68"><span class='Ref_to_Const'>Anum_pg_amproc_amprocnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN456"><span class='Ref_to_Macro'>Int16GetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1386"><span class='Ref_To_Local'>proc</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN21"><span class='Ref_to_Member'>number</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="opclasscmds.c.html#LN1374"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_amproc.h.html#LN69"><span class='Ref_to_Const'>Anum_pg_amproc_amproc</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1386"><span class='Ref_To_Local'>proc</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN20"><span class='Ref_to_Member'>object</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="opclasscmds.c.html#LN1376"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1373"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN1374"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN1375"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="opclasscmds.c.html#LN1377"><span class='Ref_To_Local'>entryoid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/indexing.h.html#LN32"><span class='Ref_to_Proto'>CatalogTupleInsert</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1373"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN1376"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1376"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Make its dependencies */ 
</span>        <a href="opclasscmds.c.html#LN1378"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_amproc.h.html#LN42"><span class='Ref_to_Const'>AccessMethodProcedureRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="opclasscmds.c.html#LN1378"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN1377"><span class='Ref_To_Local'>entryoid</span></a><span class='Delimiter'>; 
</span>        <a href="opclasscmds.c.html#LN1378"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <a href="opclasscmds.c.html#LN1379"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_proc.h.html#LN32"><span class='Ref_to_Const'>ProcedureRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="opclasscmds.c.html#LN1379"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN1386"><span class='Ref_To_Local'>proc</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN20"><span class='Ref_to_Member'>object</span></a><span class='Delimiter'>; 
</span>        <a href="opclasscmds.c.html#LN1379"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1370"><span class='Ref_to_Parameter'>opclassoid</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* if contained in an opclass, use a NORMAL dep on procedure */ 
</span>            <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN1378"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN1379"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* ... and an INTERNAL dep on the opclass */ 
</span>            <a href="opclasscmds.c.html#LN1379"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_opclass.h.html#LN48"><span class='Ref_to_Const'>OperatorClassRelationId</span></a><span class='Delimiter'>; 
</span>            <a href="opclasscmds.c.html#LN1379"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN1370"><span class='Ref_to_Parameter'>opclassoid</span></a><span class='Delimiter'>; 
</span>            <a href="opclasscmds.c.html#LN1379"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN1378"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN1379"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN76"><span class='Ref_to_EnumConst'>DEPENDENCY_INTERNAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* if "loose" in the opfamily, use a AUTO dep on procedure */ 
</span>            <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN1378"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN1379"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN75"><span class='Ref_to_EnumConst'>DEPENDENCY_AUTO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* ... and an AUTO dep on the opfamily */ 
</span>            <a href="opclasscmds.c.html#LN1379"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_opfamily.h.html#LN28"><span class='Ref_to_Const'>OperatorFamilyRelationId</span></a><span class='Delimiter'>; 
</span>            <a href="opclasscmds.c.html#LN1379"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN1370"><span class='Ref_to_Parameter'>opfamilyoid</span></a><span class='Delimiter'>; 
</span>            <a href="opclasscmds.c.html#LN1379"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN1378"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN1379"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN75"><span class='Ref_to_EnumConst'>DEPENDENCY_AUTO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* Post create hook of access method procedure */ 
</span>        <a href="../../include/catalog/objectaccess.h.html#LN144"><span class='Ref_to_Macro'>InvokeObjectPostCreateHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_amproc.h.html#LN42"><span class='Ref_to_Const'>AccessMethodProcedureRelationId</span></a><span class='Delimiter'>, 
</span>                                   <a href="opclasscmds.c.html#LN1377"><span class='Ref_To_Local'>entryoid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1373"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end storeProcedures &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Remove operator entries from an opfamily. 
 * 
 * Note: this is only allowed for "loose" members of an opfamily, hence 
 * behavior is always RESTRICT. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1469"></a><span class='Declare_Function'>dropOperators</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>opfamilyname</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>amoid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opfamilyoid</span><span class='Delimiter'>, 
</span><a name="LN1470"></a>              <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>operators</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1472"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1472"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN1470"><span class='Ref_to_Parameter'>operators</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1476"></a>        <a href="../../include/catalog/opfam_internal.h.html#LN18"><span class='Ref_to_Typedef'>OpFamilyMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>op</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/opfam_internal.h.html#LN18"><span class='Ref_to_Typedef'>OpFamilyMember</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1472"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1477"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>amopid</span><span class='Delimiter'>; 
</span><a name="LN1478"></a>        <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>object</span><span class='Delimiter'>; 
</span> 
        <a href="opclasscmds.c.html#LN1477"><span class='Ref_To_Local'>amopid</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN188"><span class='Ref_to_Macro'>GetSysCacheOid4</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN37"><span class='Ref_to_EnumConst'>AMOPSTRATEGY</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1469"><span class='Ref_to_Parameter'>opfamilyoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1476"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN22"><span class='Ref_to_Member'>lefttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1476"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN23"><span class='Ref_to_Member'>righttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../../include/postgres.h.html#LN456"><span class='Ref_to_Macro'>Int16GetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1476"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN21"><span class='Ref_to_Member'>number</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1477"><span class='Ref_To_Local'>amopid</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"operator %d(%s,%s) does not exist in operator family \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="opclasscmds.c.html#LN1476"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN21"><span class='Ref_to_Member'>number</span></a><span class='Delimiter'>, 
</span>                            <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1476"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN22"><span class='Ref_to_Member'>lefttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1476"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN23"><span class='Ref_to_Member'>righttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1469"><span class='Ref_to_Parameter'>opfamilyname</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
        <a href="opclasscmds.c.html#LN1478"><span class='Ref_To_Local'>object</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_amop.h.html#LN53"><span class='Ref_to_Const'>AccessMethodOperatorRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="opclasscmds.c.html#LN1478"><span class='Ref_To_Local'>object</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN1477"><span class='Ref_To_Local'>amopid</span></a><span class='Delimiter'>; 
</span>        <a href="opclasscmds.c.html#LN1478"><span class='Ref_To_Local'>object</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/dependency.h.html#LN182"><span class='Ref_to_Proto'>performDeletion</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN1478"><span class='Ref_To_Local'>object</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1654"><span class='Ref_to_EnumConst'>DROP_RESTRICT</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end dropOperators &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Remove procedure entries from an opfamily. 
 * 
 * Note: this is only allowed for "loose" members of an opfamily, hence 
 * behavior is always RESTRICT. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1509"></a><span class='Declare_Function'>dropProcedures</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>opfamilyname</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>amoid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opfamilyoid</span><span class='Delimiter'>, 
</span><a name="LN1510"></a>               <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>procedures</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1512"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1512"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN1510"><span class='Ref_to_Parameter'>procedures</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1516"></a>        <a href="../../include/catalog/opfam_internal.h.html#LN18"><span class='Ref_to_Typedef'>OpFamilyMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>op</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/opfam_internal.h.html#LN18"><span class='Ref_to_Typedef'>OpFamilyMember</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1512"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1517"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>amprocid</span><span class='Delimiter'>; 
</span><a name="LN1518"></a>        <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>object</span><span class='Delimiter'>; 
</span> 
        <a href="opclasscmds.c.html#LN1517"><span class='Ref_To_Local'>amprocid</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN188"><span class='Ref_to_Macro'>GetSysCacheOid4</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN38"><span class='Ref_to_EnumConst'>AMPROCNUM</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1509"><span class='Ref_to_Parameter'>opfamilyoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1516"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN22"><span class='Ref_to_Member'>lefttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1516"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN23"><span class='Ref_to_Member'>righttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="../../include/postgres.h.html#LN456"><span class='Ref_to_Macro'>Int16GetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1516"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN21"><span class='Ref_to_Member'>number</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1517"><span class='Ref_To_Local'>amprocid</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"function %d(%s,%s) does not exist in operator family \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="opclasscmds.c.html#LN1516"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN21"><span class='Ref_to_Member'>number</span></a><span class='Delimiter'>, 
</span>                            <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1516"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN22"><span class='Ref_to_Member'>lefttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1516"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/opfam_internal.h.html#LN23"><span class='Ref_to_Member'>righttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1509"><span class='Ref_to_Parameter'>opfamilyname</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
        <a href="opclasscmds.c.html#LN1518"><span class='Ref_To_Local'>object</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_amproc.h.html#LN42"><span class='Ref_to_Const'>AccessMethodProcedureRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="opclasscmds.c.html#LN1518"><span class='Ref_To_Local'>object</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="opclasscmds.c.html#LN1517"><span class='Ref_To_Local'>amprocid</span></a><span class='Delimiter'>; 
</span>        <a href="opclasscmds.c.html#LN1518"><span class='Ref_To_Local'>object</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/dependency.h.html#LN182"><span class='Ref_to_Proto'>performDeletion</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN1518"><span class='Ref_To_Local'>object</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1654"><span class='Ref_to_EnumConst'>DROP_RESTRICT</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end dropProcedures &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Deletion subroutines for use by dependency.c. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1546"></a><span class='Declare_Function'>RemoveOpFamilyById</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opfamilyOid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1548"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN1549"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span> 
    <a href="opclasscmds.c.html#LN1548"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_opfamily.h.html#LN28"><span class='Ref_to_Const'>OperatorFamilyRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="opclasscmds.c.html#LN1549"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN73"><span class='Ref_to_EnumConst'>OPFAMILYOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1546"><span class='Ref_to_Parameter'>opfamilyOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1549"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> <span class='Comment_Single_Line'>/* should not happen */ 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for opfamily %u"</span><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN1546"><span class='Ref_to_Parameter'>opfamilyOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN40"><span class='Ref_to_Proto'>CatalogTupleDelete</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1548"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN1549"><span class='Ref_To_Local'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1549"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1548"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>void 
</span><a name="LN1565"></a><span class='Declare_Function'>RemoveOpClassById</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opclassOid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1567"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN1568"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span> 
    <a href="opclasscmds.c.html#LN1567"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_opclass.h.html#LN48"><span class='Ref_to_Const'>OperatorClassRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="opclasscmds.c.html#LN1568"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN47"><span class='Ref_to_EnumConst'>CLAOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1565"><span class='Ref_to_Parameter'>opclassOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1568"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> <span class='Comment_Single_Line'>/* should not happen */ 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for opclass %u"</span><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN1565"><span class='Ref_to_Parameter'>opclassOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN40"><span class='Ref_to_Proto'>CatalogTupleDelete</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1567"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN1568"><span class='Ref_To_Local'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1568"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1567"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>void 
</span><a name="LN1584"></a><span class='Declare_Function'>RemoveAmOpEntryById</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>entryOid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1586"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN1587"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN1588"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>skey</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN1589"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN1588"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1584"><span class='Ref_to_Parameter'>entryOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="opclasscmds.c.html#LN1586"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_amop.h.html#LN53"><span class='Ref_to_Const'>AccessMethodOperatorRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="opclasscmds.c.html#LN1589"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1586"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN78"><span class='Ref_to_Const'>AccessMethodOperatorOidIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN1588"><span class='Ref_To_Local'>skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* we expect exactly one match */ 
</span>    <a href="opclasscmds.c.html#LN1587"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1589"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1587"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not find tuple for amop entry %u"</span><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN1584"><span class='Ref_to_Parameter'>entryOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN40"><span class='Ref_to_Proto'>CatalogTupleDelete</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1586"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN1587"><span class='Ref_To_Local'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1589"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1586"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RemoveAmOpEntryById &raquo; </span> 
 
<span class='Keyword'>void 
</span><a name="LN1613"></a><span class='Declare_Function'>RemoveAmProcEntryById</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>entryOid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1615"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN1616"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN1617"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>skey</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN1618"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN1617"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1613"><span class='Ref_to_Parameter'>entryOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="opclasscmds.c.html#LN1615"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_amproc.h.html#LN42"><span class='Ref_to_Const'>AccessMethodProcedureRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="opclasscmds.c.html#LN1618"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1615"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN83"><span class='Ref_to_Const'>AccessMethodProcedureOidIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN1617"><span class='Ref_To_Local'>skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* we expect exactly one match */ 
</span>    <a href="opclasscmds.c.html#LN1616"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1618"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1616"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not find tuple for amproc entry %u"</span><span class='Delimiter'>, </span><a href="opclasscmds.c.html#LN1613"><span class='Ref_to_Parameter'>entryOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN40"><span class='Ref_to_Proto'>CatalogTupleDelete</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1615"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="opclasscmds.c.html#LN1616"><span class='Ref_To_Local'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1618"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1615"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RemoveAmProcEntryById &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Subroutine for ALTER OPERATOR CLASS SET SCHEMA/RENAME 
 * 
 * Is there an operator class with the given name and signature already 
 * in the given namespace?  If so, raise an appropriate error message. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1648"></a><span class='Declare_Function'>IsThereOpClassInNamespace</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>opcname</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opcmethod</span><span class='Delimiter'>, 
</span><a name="LN1649"></a>                          <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opcnamespace</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* make sure the new name doesn't exist */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN177"><span class='Ref_to_Macro'>SearchSysCacheExists3</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN46"><span class='Ref_to_EnumConst'>CLAAMNAMENSP</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1648"><span class='Ref_to_Parameter'>opcmethod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1648"><span class='Ref_to_Parameter'>opcname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1649"><span class='Ref_to_Parameter'>opcnamespace</span></a><span class='Parentheses'>)))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/pg_basebackup/streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"operator class \"%s\" for access method \"%s\" already exists in schema \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="opclasscmds.c.html#LN1648"><span class='Ref_to_Parameter'>opcname</span></a><span class='Delimiter'>, 
</span>                        <a href="../../include/commands/defrem.h.html#LN152"><span class='Ref_to_Proto'>get_am_name</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1648"><span class='Ref_to_Parameter'>opcmethod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1649"><span class='Ref_to_Parameter'>opcnamespace</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Subroutine for ALTER OPERATOR FAMILY SET SCHEMA/RENAME 
 * 
 * Is there an operator family with the given name and signature already 
 * in the given namespace?  If so, raise an appropriate error message. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1671"></a><span class='Declare_Function'>IsThereOpFamilyInNamespace</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>opfname</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opfmethod</span><span class='Delimiter'>, 
</span><a name="LN1672"></a>                           <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opfnamespace</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* make sure the new name doesn't exist */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN177"><span class='Ref_to_Macro'>SearchSysCacheExists3</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN72"><span class='Ref_to_EnumConst'>OPFAMILYAMNAMENSP</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1671"><span class='Ref_to_Parameter'>opfmethod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1671"><span class='Ref_to_Parameter'>opfname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1672"><span class='Ref_to_Parameter'>opfnamespace</span></a><span class='Parentheses'>)))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/pg_basebackup/streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"operator family \"%s\" for access method \"%s\" already exists in schema \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="opclasscmds.c.html#LN1671"><span class='Ref_to_Parameter'>opfname</span></a><span class='Delimiter'>, 
</span>                        <a href="../../include/commands/defrem.h.html#LN152"><span class='Ref_to_Proto'>get_am_name</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1671"><span class='Ref_to_Parameter'>opfmethod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="opclasscmds.c.html#LN1672"><span class='Ref_to_Parameter'>opfnamespace</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>