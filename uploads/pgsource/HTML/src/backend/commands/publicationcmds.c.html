<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\commands\publicationcmds.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\commands\publicationcmds.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:36 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * publicationcmds.c 
 *      publication manipulation 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * IDENTIFICATION 
 *      publicationcmds.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"funcapi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/genam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/hash.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/heapam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xact.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"catalog/catalog.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/indexing.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/namespace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/objectaccess.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/objectaddress.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_inherits_fn.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_publication.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_publication_rel.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"commands/dbcommands.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/defrem.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/event_trigger.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/publicationcmds.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"utils/array.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/catcache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/fmgroids.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/inval.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/varlena.h"</span> 
 
<span class='Comment_Multi_Line'>/* Same as MAXNUMMESSAGES in sinvaladt.c */ 
</span><a name="LN51"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MAX_RELCACHE_INVAL_MSGS</span> <span class='Number'>4096</span> 
 
<a name="LN53"></a><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>OpenTableList</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tables</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN54"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>CloseTableList</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rels</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN55"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>PublicationAddTables</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>pubid</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rels</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>if_not_exists</span><span class='Delimiter'>, 
</span><a name="LN56"></a>                     <a href="../../include/nodes/parsenodes.h.html#LN3356"><span class='Ref_to_Struct'>AlterPublicationStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN57"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>PublicationDropTables</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>pubid</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rels</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>missing_ok</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Keyword'>static void 
</span><a name="LN60"></a><span class='Declare_Function'>parse_publication_options</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>options</span><span class='Delimiter'>, 
</span><a name="LN61"></a>                          <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>publish_given</span><span class='Delimiter'>, 
</span><a name="LN62"></a>                          <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>publish_insert</span><span class='Delimiter'>, 
</span><a name="LN63"></a>                          <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>publish_update</span><span class='Delimiter'>, 
</span><a name="LN64"></a>                          <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>publish_delete</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN66"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="publicationcmds.c.html#LN61"><span class='Ref_to_Parameter'>publish_given</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Defaults are true */ 
</span>    <span class='Operator'>*</span><a href="publicationcmds.c.html#LN62"><span class='Ref_to_Parameter'>publish_insert</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="publicationcmds.c.html#LN63"><span class='Ref_to_Parameter'>publish_update</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="publicationcmds.c.html#LN64"><span class='Ref_to_Parameter'>publish_delete</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Parse options */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN66"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN60"><span class='Ref_to_Parameter'>options</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN78"></a>        <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>defel</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN66"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN78"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"publish"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN82"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>publish</span><span class='Delimiter'>; 
</span><a name="LN83"></a>            <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>publish_list</span><span class='Delimiter'>; 
</span><a name="LN84"></a>            <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="publicationcmds.c.html#LN61"><span class='Ref_to_Parameter'>publish_given</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If publish option was given only the explicitly listed actions 
             * should be published. 
             */ 
</span>            <span class='Operator'>*</span><a href="publicationcmds.c.html#LN62"><span class='Ref_to_Parameter'>publish_insert</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="publicationcmds.c.html#LN63"><span class='Ref_to_Parameter'>publish_update</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="publicationcmds.c.html#LN64"><span class='Ref_to_Parameter'>publish_delete</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
            <span class='Operator'>*</span><a href="publicationcmds.c.html#LN61"><span class='Ref_to_Parameter'>publish_given</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="publicationcmds.c.html#LN82"><span class='Ref_To_Local'>publish</span></a> <span class='Operator'>= </span><a href="define.c.html#LN47"><span class='Ref_to_Func'>defGetString</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN78"><span class='Ref_To_Local'>defel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/varlena.h.html#LN29"><span class='Ref_to_Proto'>SplitIdentifierString</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN82"><span class='Ref_To_Local'>publish</span></a><span class='Delimiter'>, </span><span class='String'>','</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="publicationcmds.c.html#LN83"><span class='Ref_To_Local'>publish_list</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid publish list"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Process the option list. */ 
</span>            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN84"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN83"><span class='Ref_To_Local'>publish_list</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN110"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>publish_opt</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN84"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN110"><span class='Ref_To_Local'>publish_opt</span></a><span class='Delimiter'>, </span><span class='String'>"insert"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Operator'>*</span><a href="publicationcmds.c.html#LN62"><span class='Ref_to_Parameter'>publish_insert</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN110"><span class='Ref_To_Local'>publish_opt</span></a><span class='Delimiter'>, </span><span class='String'>"update"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Operator'>*</span><a href="publicationcmds.c.html#LN63"><span class='Ref_to_Parameter'>publish_update</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN110"><span class='Ref_To_Local'>publish_opt</span></a><span class='Delimiter'>, </span><span class='String'>"delete"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Operator'>*</span><a href="publicationcmds.c.html#LN64"><span class='Ref_to_Parameter'>publish_delete</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unrecognized \"publish\" value: \"%s\""</span><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN110"><span class='Ref_To_Local'>publish_opt</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if strcmp(defel-&GT;defname... &raquo; </span> 
        <span class='Control'>else</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unrecognized publication parameter: %s"</span><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN78"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end parse_publication_options &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Create new publication. 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN135"></a><span class='Declare_Function'>CreatePublication</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN3347"><span class='Ref_to_Struct'>CreatePublicationStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN137"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN138"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>myself</span><span class='Delimiter'>; 
</span><a name="LN139"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>puboid</span><span class='Delimiter'>; 
</span><a name="LN140"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_publication.h.html#LN65"><span class='Ref_to_Const'>Natts_pg_publication</span></a><span class='Delimiter'>]; 
</span><a name="LN141"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_publication.h.html#LN65"><span class='Ref_to_Const'>Natts_pg_publication</span></a><span class='Delimiter'>]; 
</span><a name="LN142"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN143"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>publish_given</span><span class='Delimiter'>; 
</span><a name="LN144"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>publish_insert</span><span class='Delimiter'>; 
</span><a name="LN145"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>publish_update</span><span class='Delimiter'>; 
</span><a name="LN146"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>publish_delete</span><span class='Delimiter'>; 
</span><a name="LN147"></a>    <a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* must have CREATE privilege on database */ 
</span>    <a href="publicationcmds.c.html#LN147"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN284"><span class='Ref_to_Proto'>pg_database_aclcheck</span></a><span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN81"><span class='Ref_to_Const'>ACL_CREATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN147"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN147"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN183"><span class='Ref_to_EnumConst'>ACL_KIND_DATABASE</span></a><span class='Delimiter'>, 
</span>                       <a href="../../include/commands/dbcommands.h.html#LN29"><span class='Ref_to_Proto'>get_database_name</span></a><span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* FOR ALL TABLES requires superuser */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN135"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3353"><span class='Ref_to_Member'>for_all_tables</span></a> <span class='Operator'>&& !</span><a href="../utils/misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>())</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"must be superuser to create FOR ALL TABLES publication"</span><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <a href="publicationcmds.c.html#LN137"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_publication.h.html#LN28"><span class='Ref_to_Const'>PublicationRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check if name is used */ 
</span>    <a href="publicationcmds.c.html#LN139"><span class='Ref_To_Local'>puboid</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN182"><span class='Ref_to_Macro'>GetSysCacheOid1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN77"><span class='Ref_to_EnumConst'>PUBLICATIONNAME</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN135"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3350"><span class='Ref_to_Member'>pubname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN139"><span class='Ref_To_Local'>puboid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/pg_basebackup/streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"publication \"%s\" already exists"</span><span class='Delimiter'>, 
</span>                        <a href="publicationcmds.c.html#LN135"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3350"><span class='Ref_to_Member'>pubname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Form a tuple. */ 
</span>    memset<span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN141"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN141"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN140"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN140"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="publicationcmds.c.html#LN141"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_publication.h.html#LN66"><span class='Ref_to_Const'>Anum_pg_publication_pubname</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>        <a href="../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../utils/adt/name.c.html#LN44"><span class='Ref_to_Func'>namein</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN135"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3350"><span class='Ref_to_Member'>pubname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="publicationcmds.c.html#LN141"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_publication.h.html#LN67"><span class='Ref_to_Const'>Anum_pg_publication_pubowner</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span> 
    <a href="publicationcmds.c.html#LN59"><span class='Ref_to_Func'>parse_publication_options</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN135"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3351"><span class='Ref_to_Member'>options</span></a><span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="publicationcmds.c.html#LN143"><span class='Ref_To_Local'>publish_given</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="publicationcmds.c.html#LN144"><span class='Ref_To_Local'>publish_insert</span></a><span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="publicationcmds.c.html#LN145"><span class='Ref_To_Local'>publish_update</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="publicationcmds.c.html#LN146"><span class='Ref_To_Local'>publish_delete</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="publicationcmds.c.html#LN141"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_publication.h.html#LN68"><span class='Ref_to_Const'>Anum_pg_publication_puballtables</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>        <a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN135"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3353"><span class='Ref_to_Member'>for_all_tables</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="publicationcmds.c.html#LN141"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_publication.h.html#LN69"><span class='Ref_to_Const'>Anum_pg_publication_pubinsert</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>        <a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN144"><span class='Ref_To_Local'>publish_insert</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="publicationcmds.c.html#LN141"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_publication.h.html#LN70"><span class='Ref_to_Const'>Anum_pg_publication_pubupdate</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>        <a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN145"><span class='Ref_To_Local'>publish_update</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="publicationcmds.c.html#LN141"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_publication.h.html#LN71"><span class='Ref_to_Const'>Anum_pg_publication_pubdelete</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>        <a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN146"><span class='Ref_To_Local'>publish_delete</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="publicationcmds.c.html#LN142"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN137"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN141"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN140"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Insert tuple into catalog. */ 
</span>    <a href="publicationcmds.c.html#LN139"><span class='Ref_To_Local'>puboid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/indexing.h.html#LN32"><span class='Ref_to_Proto'>CatalogTupleInsert</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN137"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN142"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN142"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../catalog/pg_shdepend.c.html#LN157"><span class='Ref_to_Func'>recordDependencyOnOwner</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_publication.h.html#LN28"><span class='Ref_to_Const'>PublicationRelationId</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN139"><span class='Ref_To_Local'>puboid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN138"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_publication.h.html#LN28"><span class='Ref_to_Const'>PublicationRelationId</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN139"><span class='Ref_To_Local'>puboid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make the changes visible. */ 
</span>    <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN135"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3352"><span class='Ref_to_Member'>tables</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN209"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>rels</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN135"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3352"><span class='Ref_to_Member'>tables</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="publicationcmds.c.html#LN209"><span class='Ref_To_Local'>rels</span></a> <span class='Operator'>= </span><a href="publicationcmds.c.html#LN53"><span class='Ref_to_Proto'>OpenTableList</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN135"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3352"><span class='Ref_to_Member'>tables</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="publicationcmds.c.html#LN55"><span class='Ref_to_Proto'>PublicationAddTables</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN139"><span class='Ref_To_Local'>puboid</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN209"><span class='Ref_To_Local'>rels</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="publicationcmds.c.html#LN54"><span class='Ref_to_Proto'>CloseTableList</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN209"><span class='Ref_To_Local'>rels</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN137"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN144"><span class='Ref_to_Macro'>InvokeObjectPostCreateHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_publication.h.html#LN28"><span class='Ref_to_Const'>PublicationRelationId</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN139"><span class='Ref_To_Local'>puboid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="publicationcmds.c.html#LN138"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CreatePublication &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Change options of a publication. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN229"></a><span class='Declare_Function'>AlterPublicationOptions</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN3356"><span class='Ref_to_Struct'>AlterPublicationStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN230"></a>                        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tup</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN232"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_publication.h.html#LN65"><span class='Ref_to_Const'>Natts_pg_publication</span></a><span class='Delimiter'>]; 
</span><a name="LN233"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>replaces</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_publication.h.html#LN65"><span class='Ref_to_Const'>Natts_pg_publication</span></a><span class='Delimiter'>]; 
</span><a name="LN234"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_publication.h.html#LN65"><span class='Ref_to_Const'>Natts_pg_publication</span></a><span class='Delimiter'>]; 
</span><a name="LN235"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>publish_given</span><span class='Delimiter'>; 
</span><a name="LN236"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>publish_insert</span><span class='Delimiter'>; 
</span><a name="LN237"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>publish_update</span><span class='Delimiter'>; 
</span><a name="LN238"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>publish_delete</span><span class='Delimiter'>; 
</span><a name="LN239"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>obj</span><span class='Delimiter'>; 
</span> 
    <a href="publicationcmds.c.html#LN59"><span class='Ref_to_Func'>parse_publication_options</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN229"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3362"><span class='Ref_to_Member'>options</span></a><span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="publicationcmds.c.html#LN235"><span class='Ref_To_Local'>publish_given</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="publicationcmds.c.html#LN236"><span class='Ref_To_Local'>publish_insert</span></a><span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="publicationcmds.c.html#LN237"><span class='Ref_To_Local'>publish_update</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="publicationcmds.c.html#LN238"><span class='Ref_To_Local'>publish_delete</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Everything ok, form a new tuple. */ 
</span>    memset<span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN234"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN234"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN232"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN232"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN233"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN233"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN235"><span class='Ref_To_Local'>publish_given</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="publicationcmds.c.html#LN234"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_publication.h.html#LN69"><span class='Ref_to_Const'>Anum_pg_publication_pubinsert</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN236"><span class='Ref_To_Local'>publish_insert</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="publicationcmds.c.html#LN233"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_publication.h.html#LN69"><span class='Ref_to_Const'>Anum_pg_publication_pubinsert</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <a href="publicationcmds.c.html#LN234"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_publication.h.html#LN70"><span class='Ref_to_Const'>Anum_pg_publication_pubupdate</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN237"><span class='Ref_To_Local'>publish_update</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="publicationcmds.c.html#LN233"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_publication.h.html#LN70"><span class='Ref_to_Const'>Anum_pg_publication_pubupdate</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <a href="publicationcmds.c.html#LN234"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_publication.h.html#LN71"><span class='Ref_to_Const'>Anum_pg_publication_pubdelete</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN238"><span class='Ref_To_Local'>publish_delete</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="publicationcmds.c.html#LN233"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_publication.h.html#LN71"><span class='Ref_to_Const'>Anum_pg_publication_pubdelete</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="publicationcmds.c.html#LN230"><span class='Ref_to_Parameter'>tup</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN230"><span class='Ref_to_Parameter'>tup</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN229"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN234"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN232"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, 
</span>                            <a href="publicationcmds.c.html#LN233"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Update the catalog. */ 
</span>    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN229"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="publicationcmds.c.html#LN230"><span class='Ref_to_Parameter'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN230"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Invalidate the relcache. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="../../include/catalog/pg_publication.h.html#LN58"><span class='Ref_to_Typedef'>Form_pg_publication</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN230"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>puballtables<span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/inval.h.html#LN45"><span class='Ref_to_Proto'>CacheInvalidateRelcacheAll</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN277"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>relids</span> <span class='Operator'>= </span><a href="../../include/catalog/pg_publication.h.html#LN91"><span class='Ref_to_Proto'>GetPublicationRelations</span></a><span class='Parentheses'>(</span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN230"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We don't want to send too many individual messages, at some point 
         * it's cheaper to just reset whole relcache. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN277"><span class='Ref_To_Local'>relids</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><a href="publicationcmds.c.html#LN51"><span class='Ref_to_Const'>MAX_RELCACHE_INVAL_MSGS</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN285"></a>            <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN285"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN277"><span class='Ref_To_Local'>relids</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN289"></a>                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN285"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="../../include/utils/inval.h.html#LN49"><span class='Ref_to_Proto'>CacheInvalidateRelcacheByRelid</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN289"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/inval.h.html#LN45"><span class='Ref_to_Proto'>CacheInvalidateRelcacheAll</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN239"><span class='Ref_To_Local'>obj</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_publication.h.html#LN28"><span class='Ref_to_Const'>PublicationRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN230"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/commands/event_trigger.h.html#LN67"><span class='Ref_to_Proto'>EventTriggerCollectSimpleCommand</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN239"><span class='Ref_To_Local'>obj</span></a><span class='Delimiter'>, </span><a href="../catalog/objectaddress.c.html#LN718"><span class='Ref_to_Global_Var'>InvalidObjectAddress</span></a><span class='Delimiter'>, 
</span>                                     <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="publicationcmds.c.html#LN229"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_publication.h.html#LN28"><span class='Ref_to_Const'>PublicationRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN230"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterPublicationOptions &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Add or remove table to/from publication. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN309"></a><span class='Declare_Function'>AlterPublicationTables</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN3356"><span class='Ref_to_Struct'>AlterPublicationStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN310"></a>                       <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tup</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN312"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>pubid</span> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN310"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN313"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>rels</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN314"></a>    <a href="../../include/catalog/pg_publication.h.html#LN58"><span class='Ref_to_Typedef'>Form_pg_publication</span></a> <span class='Declare_Local'>pubform</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_publication.h.html#LN58"><span class='Ref_to_Typedef'>Form_pg_publication</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN310"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check that user is allowed to manipulate the publication tables. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN314"><span class='Ref_To_Local'>pubform</span></a><span class='Operator'>-&GT;</span>puballtables<span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"publication \"%s\" is defined as FOR ALL TABLES"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN314"><span class='Ref_To_Local'>pubform</span></a><span class='Operator'>-&GT;</span>pubname<span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Tables cannot be added to or dropped from FOR ALL TABLES publications."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN309"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3365"><span class='Ref_to_Member'>tables</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="publicationcmds.c.html#LN313"><span class='Ref_To_Local'>rels</span></a> <span class='Operator'>= </span><a href="publicationcmds.c.html#LN53"><span class='Ref_to_Proto'>OpenTableList</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN309"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3365"><span class='Ref_to_Member'>tables</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN309"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3367"><span class='Ref_to_Member'>tableAction</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN711"><span class='Ref_to_EnumConst'>DEFELEM_ADD</span></a><span class='Parentheses'>) 
</span>        <a href="publicationcmds.c.html#LN55"><span class='Ref_to_Proto'>PublicationAddTables</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN312"><span class='Ref_To_Local'>pubid</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN313"><span class='Ref_To_Local'>rels</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN309"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN309"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3367"><span class='Ref_to_Member'>tableAction</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN712"><span class='Ref_to_EnumConst'>DEFELEM_DROP</span></a><span class='Parentheses'>) 
</span>        <a href="publicationcmds.c.html#LN57"><span class='Ref_to_Proto'>PublicationDropTables</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN312"><span class='Ref_To_Local'>pubid</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN313"><span class='Ref_To_Local'>rels</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span>    <span class='Comment_Single_Line'>/* DEFELEM_SET */ 
</span>    <span class='Delimiter'>{ 
</span><a name="LN334"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>oldrelids</span> <span class='Operator'>= </span><a href="../../include/catalog/pg_publication.h.html#LN91"><span class='Ref_to_Proto'>GetPublicationRelations</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN312"><span class='Ref_To_Local'>pubid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN335"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>delrels</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN336"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>oldlc</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Calculate which relations to drop. */ 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN336"><span class='Ref_To_Local'>oldlc</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN334"><span class='Ref_To_Local'>oldrelids</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN341"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>oldrelid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN336"><span class='Ref_To_Local'>oldlc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN342"></a>            <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>newlc</span><span class='Delimiter'>; 
</span><a name="LN343"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN342"><span class='Ref_To_Local'>newlc</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN313"><span class='Ref_To_Local'>rels</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN347"></a>                <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>newrel</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN342"><span class='Ref_To_Local'>newlc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN347"><span class='Ref_To_Local'>newrel</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="publicationcmds.c.html#LN341"><span class='Ref_To_Local'>oldrelid</span></a><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="publicationcmds.c.html#LN343"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="publicationcmds.c.html#LN343"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN358"></a>                <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>oldrel</span> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN341"><span class='Ref_To_Local'>oldrelid</span></a><span class='Delimiter'>, 
</span>                                               <a href="../../include/storage/lockdefs.h.html#LN38"><span class='Ref_to_Const'>ShareUpdateExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="publicationcmds.c.html#LN335"><span class='Ref_To_Local'>delrels</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN335"><span class='Ref_To_Local'>delrels</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN358"><span class='Ref_To_Local'>oldrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* And drop them. */ 
</span>        <a href="publicationcmds.c.html#LN57"><span class='Ref_to_Proto'>PublicationDropTables</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN312"><span class='Ref_To_Local'>pubid</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN335"><span class='Ref_To_Local'>delrels</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Don't bother calculating the difference for adding, we'll catch and 
         * skip existing ones when doing catalog update. 
         */ 
</span>        <a href="publicationcmds.c.html#LN55"><span class='Ref_to_Proto'>PublicationAddTables</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN312"><span class='Ref_To_Local'>pubid</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN313"><span class='Ref_To_Local'>rels</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN309"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="publicationcmds.c.html#LN54"><span class='Ref_to_Proto'>CloseTableList</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN335"><span class='Ref_To_Local'>delrels</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <a href="publicationcmds.c.html#LN54"><span class='Ref_to_Proto'>CloseTableList</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN313"><span class='Ref_To_Local'>rels</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterPublicationTables &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Alter the existing publication. 
 * 
 * This is dispatcher function for AlterPublicationOptions and 
 * AlterPublicationTables. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN387"></a><span class='Declare_Function'>AlterPublication</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN3356"><span class='Ref_to_Struct'>AlterPublicationStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN389"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN390"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span> 
    <a href="publicationcmds.c.html#LN389"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_publication.h.html#LN28"><span class='Ref_to_Const'>PublicationRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="publicationcmds.c.html#LN390"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN77"><span class='Ref_to_EnumConst'>PUBLICATIONNAME</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN387"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3359"><span class='Ref_to_Member'>pubname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN390"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"publication \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="publicationcmds.c.html#LN387"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3359"><span class='Ref_to_Member'>pubname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* must be owner */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN327"><span class='Ref_to_Proto'>pg_publication_ownercheck</span></a><span class='Parentheses'>(</span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN390"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN202"><span class='Ref_to_EnumConst'>ACL_KIND_PUBLICATION</span></a><span class='Delimiter'>, 
</span>                       <a href="publicationcmds.c.html#LN387"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3359"><span class='Ref_to_Member'>pubname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN387"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3362"><span class='Ref_to_Member'>options</span></a><span class='Parentheses'>) 
</span>        <a href="publicationcmds.c.html#LN228"><span class='Ref_to_Func'>AlterPublicationOptions</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN387"><span class='Ref_to_Parameter'>stmt</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN389"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN390"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="publicationcmds.c.html#LN308"><span class='Ref_to_Func'>AlterPublicationTables</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN387"><span class='Ref_to_Parameter'>stmt</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN389"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN390"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Cleanup. */ 
</span>    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN390"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN389"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterPublication &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Drop publication by OID 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN422"></a><span class='Declare_Function'>RemovePublicationById</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>pubid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN424"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN425"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span> 
    <a href="publicationcmds.c.html#LN424"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_publication.h.html#LN28"><span class='Ref_to_Const'>PublicationRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="publicationcmds.c.html#LN425"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN78"><span class='Ref_to_EnumConst'>PUBLICATIONOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN422"><span class='Ref_to_Parameter'>pubid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN425"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for publication %u"</span><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN422"><span class='Ref_to_Parameter'>pubid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN40"><span class='Ref_to_Proto'>CatalogTupleDelete</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN424"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="publicationcmds.c.html#LN425"><span class='Ref_To_Local'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN425"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN424"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Remove relation from publication by mapping OID. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN445"></a><span class='Declare_Function'>RemovePublicationRelById</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>proid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN447"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN448"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN449"></a>    <a href="../../include/catalog/pg_publication_rel.h.html#LN40"><span class='Ref_to_Typedef'>Form_pg_publication_rel</span></a> <span class='Declare_Local'>pubrel</span><span class='Delimiter'>; 
</span> 
    <a href="publicationcmds.c.html#LN447"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_publication_rel.h.html#LN27"><span class='Ref_to_Const'>PublicationRelRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="publicationcmds.c.html#LN448"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN79"><span class='Ref_to_EnumConst'>PUBLICATIONREL</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN445"><span class='Ref_to_Parameter'>proid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN448"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for publication table %u"</span><span class='Delimiter'>, 
</span>             <a href="publicationcmds.c.html#LN445"><span class='Ref_to_Parameter'>proid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="publicationcmds.c.html#LN449"><span class='Ref_To_Local'>pubrel</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_publication_rel.h.html#LN40"><span class='Ref_to_Typedef'>Form_pg_publication_rel</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN448"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Invalidate relcache so that publication info is rebuilt. */ 
</span>    <a href="../../include/utils/inval.h.html#LN49"><span class='Ref_to_Proto'>CacheInvalidateRelcacheByRelid</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN449"><span class='Ref_To_Local'>pubrel</span></a><span class='Operator'>-&GT;</span>prrelid<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN40"><span class='Ref_to_Proto'>CatalogTupleDelete</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN447"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="publicationcmds.c.html#LN448"><span class='Ref_To_Local'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN448"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN447"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RemovePublicationRelById &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Open relations based on provided by RangeVar list. 
 * The returned tables are locked in ShareUpdateExclusiveLock mode. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN476"></a><span class='Declare_Function'>OpenTableList</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tables</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN478"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>relids</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN479"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>rels</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN480"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Open, share-lock, and check all the explicitly-specified relations 
     */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN480"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN476"><span class='Ref_to_Parameter'>tables</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN487"></a>        <a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>rv</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN480"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN488"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN489"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>recurse</span> <span class='Operator'>= </span><a href="publicationcmds.c.html#LN487"><span class='Ref_To_Local'>rv</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN68"><span class='Ref_to_Member'>inh</span></a><span class='Delimiter'>; 
</span><a name="LN490"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>myrelid</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <a href="publicationcmds.c.html#LN488"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN92"><span class='Ref_to_Proto'>heap_openrv</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN487"><span class='Ref_To_Local'>rv</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN38"><span class='Ref_to_Const'>ShareUpdateExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="publicationcmds.c.html#LN490"><span class='Ref_To_Local'>myrelid</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN488"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Filter out duplicates if user specifies "foo, foo". 
         * 
         * Note that this algorithm is known to not be very efficient (O(N^2)) 
         * but given that it only works on list of tables given to us by user 
         * it's deemed acceptable. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN231"><span class='Ref_to_Proto'>list_member_oid</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN478"><span class='Ref_To_Local'>relids</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN490"><span class='Ref_To_Local'>myrelid</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN488"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN38"><span class='Ref_to_Const'>ShareUpdateExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="publicationcmds.c.html#LN479"><span class='Ref_To_Local'>rels</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN479"><span class='Ref_To_Local'>rels</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN488"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="publicationcmds.c.html#LN478"><span class='Ref_To_Local'>relids</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN478"><span class='Ref_To_Local'>relids</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN490"><span class='Ref_To_Local'>myrelid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN489"><span class='Ref_To_Local'>recurse</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN514"></a>            <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>child</span><span class='Delimiter'>; 
</span><a name="LN515"></a>            <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>children</span><span class='Delimiter'>; 
</span> 
            <a href="publicationcmds.c.html#LN515"><span class='Ref_To_Local'>children</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_inherits_fn.h.html#LN20"><span class='Ref_to_Proto'>find_all_inheritors</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN490"><span class='Ref_To_Local'>myrelid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN38"><span class='Ref_to_Const'>ShareUpdateExclusiveLock</span></a><span class='Delimiter'>, 
</span>                                           <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN514"><span class='Ref_To_Local'>child</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN515"><span class='Ref_To_Local'>children</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN522"></a>                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>childrelid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN514"><span class='Ref_To_Local'>child</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN231"><span class='Ref_to_Proto'>list_member_oid</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN478"><span class='Ref_To_Local'>relids</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN522"><span class='Ref_To_Local'>childrelid</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Skip duplicates if user specified both parent and child 
                 * tables. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN231"><span class='Ref_to_Proto'>list_member_oid</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN478"><span class='Ref_To_Local'>relids</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN522"><span class='Ref_To_Local'>childrelid</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN488"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN38"><span class='Ref_to_Const'>ShareUpdateExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* find_all_inheritors already got lock */ 
</span>                <a href="publicationcmds.c.html#LN488"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN522"><span class='Ref_To_Local'>childrelid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="publicationcmds.c.html#LN479"><span class='Ref_To_Local'>rels</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN479"><span class='Ref_To_Local'>rels</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN488"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="publicationcmds.c.html#LN478"><span class='Ref_To_Local'>relids</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN478"><span class='Ref_To_Local'>relids</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN522"><span class='Ref_To_Local'>childrelid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if recurse &raquo; </span> 
    <span class='Delimiter'>} 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN478"><span class='Ref_To_Local'>relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="publicationcmds.c.html#LN479"><span class='Ref_To_Local'>rels</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end OpenTableList &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Close all relations in the list. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN554"></a><span class='Declare_Function'>CloseTableList</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rels</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN556"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN556"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN554"><span class='Ref_to_Parameter'>rels</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN560"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN556"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN560"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Add listed tables to the publication. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN570"></a><span class='Declare_Function'>PublicationAddTables</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>pubid</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rels</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>if_not_exists</span><span class='Delimiter'>, 
</span><a name="LN571"></a>                     <a href="../../include/nodes/parsenodes.h.html#LN3356"><span class='Ref_to_Struct'>AlterPublicationStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN573"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="publicationcmds.c.html#LN571"><span class='Ref_to_Parameter'>stmt</span></a> <span class='Operator'>|| !</span><a href="publicationcmds.c.html#LN571"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3366"><span class='Ref_to_Member'>for_all_tables</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN573"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN570"><span class='Ref_to_Parameter'>rels</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN579"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN573"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN580"></a>        <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>obj</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Must be owner of the table or superuser. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN308"><span class='Ref_to_Proto'>pg_class_ownercheck</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN579"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
            <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN181"><span class='Ref_to_EnumConst'>ACL_KIND_CLASS</span></a><span class='Delimiter'>, 
</span>                           <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN579"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="publicationcmds.c.html#LN580"><span class='Ref_To_Local'>obj</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_publication.h.html#LN95"><span class='Ref_to_Proto'>publication_add_relation</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN570"><span class='Ref_to_Parameter'>pubid</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN579"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN570"><span class='Ref_to_Parameter'>if_not_exists</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN571"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/commands/event_trigger.h.html#LN67"><span class='Ref_to_Proto'>EventTriggerCollectSimpleCommand</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN580"><span class='Ref_To_Local'>obj</span></a><span class='Delimiter'>, </span><a href="../catalog/objectaddress.c.html#LN718"><span class='Ref_to_Global_Var'>InvalidObjectAddress</span></a><span class='Delimiter'>, 
</span>                                             <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="publicationcmds.c.html#LN571"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/catalog/objectaccess.h.html#LN144"><span class='Ref_to_Macro'>InvokeObjectPostCreateHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_publication_rel.h.html#LN27"><span class='Ref_to_Const'>PublicationRelRelationId</span></a><span class='Delimiter'>, 
</span>                                       <a href="publicationcmds.c.html#LN580"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end PublicationAddTables &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Remove listed tables from the publication. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN603"></a><span class='Declare_Function'>PublicationDropTables</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>pubid</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rels</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>missing_ok</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN605"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>obj</span><span class='Delimiter'>; 
</span><a name="LN606"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span><a name="LN607"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>prid</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN606"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN603"><span class='Ref_to_Parameter'>rels</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN611"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN606"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN612"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN611"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="publicationcmds.c.html#LN607"><span class='Ref_To_Local'>prid</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN184"><span class='Ref_to_Macro'>GetSysCacheOid2</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN80"><span class='Ref_to_EnumConst'>PUBLICATIONRELMAP</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN612"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                               <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN603"><span class='Ref_to_Parameter'>pubid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN607"><span class='Ref_To_Local'>prid</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN603"><span class='Ref_to_Parameter'>missing_ok</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"relation \"%s\" is not part of the publication"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN611"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN605"><span class='Ref_To_Local'>obj</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_publication_rel.h.html#LN27"><span class='Ref_to_Const'>PublicationRelRelationId</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN607"><span class='Ref_To_Local'>prid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/catalog/dependency.h.html#LN182"><span class='Ref_to_Proto'>performDeletion</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="publicationcmds.c.html#LN605"><span class='Ref_To_Local'>obj</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1655"><span class='Ref_to_EnumConst'>DROP_CASCADE</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end PublicationDropTables &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Internal workhorse for changing a publication owner 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN636"></a><span class='Declare_Function'>AlterPublicationOwner_internal</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tup</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>newOwnerId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN638"></a>    <a href="../../include/catalog/pg_publication.h.html#LN58"><span class='Ref_to_Typedef'>Form_pg_publication</span></a> <span class='Declare_Local'>form</span><span class='Delimiter'>; 
</span> 
    <a href="publicationcmds.c.html#LN638"><span class='Ref_To_Local'>form</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_publication.h.html#LN58"><span class='Ref_to_Typedef'>Form_pg_publication</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN636"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN638"><span class='Ref_To_Local'>form</span></a><span class='Operator'>-&GT;</span>pubowner <span class='Operator'>== </span><a href="publicationcmds.c.html#LN636"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span><a name="LN647"></a>        <a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Must be owner */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN327"><span class='Ref_to_Proto'>pg_publication_ownercheck</span></a><span class='Parentheses'>(</span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN636"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
            <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN202"><span class='Ref_to_EnumConst'>ACL_KIND_PUBLICATION</span></a><span class='Delimiter'>, 
</span>                           <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN638"><span class='Ref_To_Local'>form</span></a><span class='Operator'>-&GT;</span>pubname<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Must be able to become new owner */ 
</span>        <a href="../../include/utils/acl.h.html#LN233"><span class='Ref_to_Proto'>check_is_member_of_role</span></a><span class='Parentheses'>(</span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN636"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* New owner must have CREATE privilege on database */ 
</span>        <a href="publicationcmds.c.html#LN647"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN284"><span class='Ref_to_Proto'>pg_database_aclcheck</span></a><span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN636"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN81"><span class='Ref_to_Const'>ACL_CREATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN647"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN647"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN183"><span class='Ref_to_EnumConst'>ACL_KIND_DATABASE</span></a><span class='Delimiter'>, 
</span>                           <a href="../../include/commands/dbcommands.h.html#LN29"><span class='Ref_to_Proto'>get_database_name</span></a><span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN638"><span class='Ref_To_Local'>form</span></a><span class='Operator'>-&GT;</span>puballtables <span class='Operator'>&& !</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN636"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied to change owner of publication \"%s\""</span><span class='Delimiter'>, 
</span>                   <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN638"><span class='Ref_To_Local'>form</span></a><span class='Operator'>-&GT;</span>pubname<span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"The owner of a FOR ALL TABLES publication must be a superuser."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !superuser() &raquo; </span> 
 
    <a href="publicationcmds.c.html#LN638"><span class='Ref_To_Local'>form</span></a><span class='Operator'>-&GT;</span>pubowner <span class='Operator'>= </span><a href="publicationcmds.c.html#LN636"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Delimiter'>; 
</span>    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN636"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="publicationcmds.c.html#LN636"><span class='Ref_to_Parameter'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN636"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Update owner dependency reference */ 
</span>    <a href="../../include/catalog/dependency.h.html#LN259"><span class='Ref_to_Proto'>changeDependencyOnOwner</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_publication.h.html#LN28"><span class='Ref_to_Const'>PublicationRelationId</span></a><span class='Delimiter'>, 
</span>                            <a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN636"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="publicationcmds.c.html#LN636"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_publication.h.html#LN28"><span class='Ref_to_Const'>PublicationRelationId</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN636"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterPublicationOwner_internal &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Change publication owner -- by name 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN687"></a><span class='Declare_Function'>AlterPublicationOwner</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>newOwnerId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN689"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>subid</span><span class='Delimiter'>; 
</span><a name="LN690"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN691"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN692"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <a href="publicationcmds.c.html#LN691"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_publication.h.html#LN28"><span class='Ref_to_Const'>PublicationRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="publicationcmds.c.html#LN690"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN77"><span class='Ref_to_EnumConst'>PUBLICATIONNAME</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN687"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN690"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"publication \"%s\" does not exist"</span><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN687"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="publicationcmds.c.html#LN689"><span class='Ref_To_Local'>subid</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN690"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="publicationcmds.c.html#LN635"><span class='Ref_to_Func'>AlterPublicationOwner_internal</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN691"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN690"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN687"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN692"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_publication.h.html#LN28"><span class='Ref_to_Const'>PublicationRelationId</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN689"><span class='Ref_To_Local'>subid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN690"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN691"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="publicationcmds.c.html#LN692"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterPublicationOwner &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Change publication owner -- by OID 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN720"></a><span class='Declare_Function'>AlterPublicationOwner_oid</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>subid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>newOwnerId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN722"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN723"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span> 
    <a href="publicationcmds.c.html#LN723"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_publication.h.html#LN28"><span class='Ref_to_Const'>PublicationRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="publicationcmds.c.html#LN722"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN78"><span class='Ref_to_EnumConst'>PUBLICATIONOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN720"><span class='Ref_to_Parameter'>subid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN722"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"publication with OID %u does not exist"</span><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN720"><span class='Ref_to_Parameter'>subid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="publicationcmds.c.html#LN635"><span class='Ref_to_Func'>AlterPublicationOwner_internal</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN723"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN722"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>, </span><a href="publicationcmds.c.html#LN720"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN722"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="publicationcmds.c.html#LN723"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterPublicationOwner_oid &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>