<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\commands\seclabel.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\commands\seclabel.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:36 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/* ------------------------------------------------------------------------- 
 * 
 * seclabel.c 
 *    routines to support security label feature. 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * ------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/genam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/heapam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/catalog.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/indexing.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_seclabel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_shseclabel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/seclabel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/fmgroids.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/tqual.h"</span> 
 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN29"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Member'>provider_name</span><span class='Delimiter'>; 
</span><a name="LN30"></a>    <a href="../../include/commands/seclabel.h.html#LN28"><span class='Ref_to_Typedef'>check_object_relabel_type</span></a> <span class='Declare_Member'>hook</span><span class='Delimiter'>; 
</span><a name="LN31"></a>} <span class='Declare_Typedef'>LabelProvider</span><span class='Delimiter'>; 
</span> 
<a name="LN33"></a><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Var'>label_provider_list</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * ExecSecLabelStmt -- 
 * 
 * Apply a security label to a database object. 
 * 
 * Returns the ObjectAddress of the object to which the policy was applied. 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN43"></a><span class='Declare_Function'>ExecSecLabelStmt</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2584"><span class='Ref_to_Struct'>SecLabelStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN45"></a>    <a href="seclabel.c.html#LN27"><span class='Ref_to_Typedef'>LabelProvider</span></a> <span class='Operator'>*</span><span class='Declare_Local'>provider</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN46"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span><a name="LN47"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span><a name="LN48"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Find the named label provider, or if none specified, check whether 
     * there's exactly one, and if so use it. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="seclabel.c.html#LN43"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2589"><span class='Ref_to_Member'>provider</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="seclabel.c.html#LN33"><span class='Ref_to_Global_Var'>label_provider_list</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"no security label providers have been loaded"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN33"><span class='Ref_to_Global_Var'>label_provider_list</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"must specify provider when multiple security label providers have been loaded"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="seclabel.c.html#LN45"><span class='Ref_To_Local'>provider</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="seclabel.c.html#LN27"><span class='Ref_to_Typedef'>LabelProvider</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN33"><span class='Ref_to_Global_Var'>label_provider_list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN48"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="seclabel.c.html#LN33"><span class='Ref_to_Global_Var'>label_provider_list</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN70"></a>            <a href="seclabel.c.html#LN27"><span class='Ref_to_Typedef'>LabelProvider</span></a> <span class='Operator'>*</span><span class='Declare_Local'>lp</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN48"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="seclabel.c.html#LN43"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2589"><span class='Ref_to_Member'>provider</span></a><span class='Delimiter'>, </span><a href="seclabel.c.html#LN70"><span class='Ref_To_Local'>lp</span></a><span class='Operator'>-&GT;</span><a href="seclabel.c.html#LN29"><span class='Ref_to_Member'>provider_name</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="seclabel.c.html#LN45"><span class='Ref_To_Local'>provider</span></a> <span class='Operator'>= </span><a href="seclabel.c.html#LN70"><span class='Ref_To_Local'>lp</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="seclabel.c.html#LN45"><span class='Ref_To_Local'>provider</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"security label provider \"%s\" is not loaded"</span><span class='Delimiter'>, 
</span>                            <a href="seclabel.c.html#LN43"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2589"><span class='Ref_to_Member'>provider</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Translate the parser representation which identifies this object into 
     * an ObjectAddress. get_object_address() will throw an error if the 
     * object does not exist, and will also acquire a lock on the target to 
     * guard against concurrent modifications. 
     */ 
</span>    <a href="seclabel.c.html#LN46"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="../../include/catalog/objectaddress.h.html#LN42"><span class='Ref_to_Proto'>get_object_address</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN43"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2587"><span class='Ref_to_Member'>objtype</span></a><span class='Delimiter'>, </span><a href="seclabel.c.html#LN43"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2588"><span class='Ref_to_Member'>object</span></a><span class='Delimiter'>, 
</span>                                 <span class='Operator'>&</span><a href="seclabel.c.html#LN47"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN38"><span class='Ref_to_Const'>ShareUpdateExclusiveLock</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Require ownership of the target object. */ 
</span>    <a href="../../include/catalog/objectaddress.h.html#LN50"><span class='Ref_to_Proto'>check_object_ownership</span></a><span class='Parentheses'>(</span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="seclabel.c.html#LN43"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2587"><span class='Ref_to_Member'>objtype</span></a><span class='Delimiter'>, </span><a href="seclabel.c.html#LN46"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, 
</span>                           <a href="seclabel.c.html#LN43"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2588"><span class='Ref_to_Member'>object</span></a><span class='Delimiter'>, </span><a href="seclabel.c.html#LN47"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Perform other integrity checks as needed. */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="seclabel.c.html#LN43"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2587"><span class='Ref_to_Member'>objtype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1591"><span class='Ref_to_EnumConst'>OBJECT_COLUMN</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Allow security labels only on columns of tables, views, 
             * materialized views, composite types, and foreign tables (which 
             * are the only relkinds for which pg_dump will dump labels). 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="seclabel.c.html#LN47"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a> <span class='Operator'>&& 
</span>                <a href="seclabel.c.html#LN47"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN163"><span class='Ref_to_Const'>RELKIND_VIEW</span></a> <span class='Operator'>&& 
</span>                <a href="seclabel.c.html#LN47"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a> <span class='Operator'>&& 
</span>                <a href="seclabel.c.html#LN47"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN165"><span class='Ref_to_Const'>RELKIND_COMPOSITE_TYPE</span></a> <span class='Operator'>&& 
</span>                <a href="seclabel.c.html#LN47"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a> <span class='Operator'>&& 
</span>                <a href="seclabel.c.html#LN47"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a table, view, materialized view, composite type, or foreign table"</span><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN47"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch stmt-&GT;objtype &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Provider gets control here, may throw ERROR to veto new label. */ 
</span>    <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="seclabel.c.html#LN45"><span class='Ref_To_Local'>provider</span></a><span class='Operator'>-&GT;</span><a href="seclabel.c.html#LN30"><span class='Ref_to_Member'>hook</span></a><span class='Parentheses'>) (</span><span class='Operator'>&</span><a href="seclabel.c.html#LN46"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="seclabel.c.html#LN43"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2590"><span class='Ref_to_Member'>label</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Apply new label. */ 
</span>    <a href="../../include/commands/seclabel.h.html#LN18"><span class='Ref_to_Proto'>SetSecurityLabel</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="seclabel.c.html#LN46"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="seclabel.c.html#LN45"><span class='Ref_To_Local'>provider</span></a><span class='Operator'>-&GT;</span><a href="seclabel.c.html#LN29"><span class='Ref_to_Member'>provider_name</span></a><span class='Delimiter'>, </span><a href="seclabel.c.html#LN43"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2590"><span class='Ref_to_Member'>label</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If get_object_address() opened the relation for us, we close it to keep 
     * the reference count correct - but we retain any locks acquired by 
     * get_object_address() until commit time, to guard against concurrent 
     * activity. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="seclabel.c.html#LN47"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN47"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="seclabel.c.html#LN46"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecSecLabelStmt &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * GetSharedSecurityLabel returns the security label for a shared object for 
 * a given provider, or NULL if there is no such label. 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN146"></a><span class='Declare_Function'>GetSharedSecurityLabel</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>object</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>provider</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN148"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pg_shseclabel</span><span class='Delimiter'>; 
</span><a name="LN149"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>keys</span><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>]; 
</span><a name="LN150"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN151"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN152"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>datum</span><span class='Delimiter'>; 
</span><a name="LN153"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN154"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>seclabel</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="seclabel.c.html#LN149"><span class='Ref_To_Local'>keys</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_shseclabel.h.html#LN41"><span class='Ref_to_Const'>Anum_pg_shseclabel_objoid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN146"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="seclabel.c.html#LN149"><span class='Ref_To_Local'>keys</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_shseclabel.h.html#LN42"><span class='Ref_to_Const'>Anum_pg_shseclabel_classoid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN146"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="seclabel.c.html#LN149"><span class='Ref_To_Local'>keys</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_shseclabel.h.html#LN43"><span class='Ref_to_Const'>Anum_pg_shseclabel_provider</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_TEXTEQ<span class='Delimiter'>, 
</span>                <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN146"><span class='Ref_to_Parameter'>provider</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="seclabel.c.html#LN148"><span class='Ref_To_Local'>pg_shseclabel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_shseclabel.h.html#LN20"><span class='Ref_to_Const'>SharedSecLabelRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="seclabel.c.html#LN150"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN148"><span class='Ref_To_Local'>pg_shseclabel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN315"><span class='Ref_to_Const'>SharedSecLabelObjectIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Delimiter'>, </span><a href="seclabel.c.html#LN149"><span class='Ref_To_Local'>keys</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="seclabel.c.html#LN151"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN150"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN151"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="seclabel.c.html#LN152"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN768"><span class='Ref_to_Macro'>heap_getattr</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN151"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_shseclabel.h.html#LN44"><span class='Ref_to_Const'>Anum_pg_shseclabel_label</span></a><span class='Delimiter'>, 
</span>                             <a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN148"><span class='Ref_To_Local'>pg_shseclabel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="seclabel.c.html#LN153"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="seclabel.c.html#LN153"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>            <a href="seclabel.c.html#LN154"><span class='Ref_To_Local'>seclabel</span></a> <span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN152"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN150"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN148"><span class='Ref_To_Local'>pg_shseclabel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="seclabel.c.html#LN154"><span class='Ref_To_Local'>seclabel</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end GetSharedSecurityLabel &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * GetSecurityLabel returns the security label for a shared or database object 
 * for a given provider, or NULL if there is no such label. 
 */ 
</span><span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN194"></a><span class='Declare_Function'>GetSecurityLabel</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>object</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>provider</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN196"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pg_seclabel</span><span class='Delimiter'>; 
</span><a name="LN197"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>keys</span><span class='Delimiter'>[</span><span class='Number'>4</span><span class='Delimiter'>]; 
</span><a name="LN198"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN199"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN200"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>datum</span><span class='Delimiter'>; 
</span><a name="LN201"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN202"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>seclabel</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Shared objects have their own security label catalog. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/catalog.h.html#LN42"><span class='Ref_to_Proto'>IsSharedRelation</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN194"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="seclabel.c.html#LN145"><span class='Ref_to_Func'>GetSharedSecurityLabel</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN194"><span class='Ref_to_Parameter'>object</span></a><span class='Delimiter'>, </span><a href="seclabel.c.html#LN194"><span class='Ref_to_Parameter'>provider</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Must be an unshared object, so examine pg_seclabel. */ 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="seclabel.c.html#LN197"><span class='Ref_To_Local'>keys</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_seclabel.h.html#LN39"><span class='Ref_to_Const'>Anum_pg_seclabel_objoid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN194"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="seclabel.c.html#LN197"><span class='Ref_To_Local'>keys</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_seclabel.h.html#LN40"><span class='Ref_to_Const'>Anum_pg_seclabel_classoid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN194"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="seclabel.c.html#LN197"><span class='Ref_To_Local'>keys</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_seclabel.h.html#LN41"><span class='Ref_to_Const'>Anum_pg_seclabel_objsubid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_INT4EQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN194"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="seclabel.c.html#LN197"><span class='Ref_To_Local'>keys</span></a><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_seclabel.h.html#LN42"><span class='Ref_to_Const'>Anum_pg_seclabel_provider</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_TEXTEQ<span class='Delimiter'>, 
</span>                <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN194"><span class='Ref_to_Parameter'>provider</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="seclabel.c.html#LN196"><span class='Ref_To_Local'>pg_seclabel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_seclabel.h.html#LN20"><span class='Ref_to_Const'>SecLabelRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="seclabel.c.html#LN198"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN196"><span class='Ref_To_Local'>pg_seclabel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN312"><span class='Ref_to_Const'>SecLabelObjectIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><a href="seclabel.c.html#LN197"><span class='Ref_To_Local'>keys</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="seclabel.c.html#LN199"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN198"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN199"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="seclabel.c.html#LN200"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN768"><span class='Ref_to_Macro'>heap_getattr</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN199"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_seclabel.h.html#LN43"><span class='Ref_to_Const'>Anum_pg_seclabel_label</span></a><span class='Delimiter'>, 
</span>                             <a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN196"><span class='Ref_To_Local'>pg_seclabel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="seclabel.c.html#LN201"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="seclabel.c.html#LN201"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>            <a href="seclabel.c.html#LN202"><span class='Ref_To_Local'>seclabel</span></a> <span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN200"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN198"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN196"><span class='Ref_To_Local'>pg_seclabel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="seclabel.c.html#LN202"><span class='Ref_To_Local'>seclabel</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end GetSecurityLabel &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * SetSharedSecurityLabel is a helper function of SetSecurityLabel to 
 * handle shared database objects. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN251"></a><span class='Declare_Function'>SetSharedSecurityLabel</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>object</span><span class='Delimiter'>, 
</span><a name="LN252"></a>                       <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>provider</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>label</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN254"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pg_shseclabel</span><span class='Delimiter'>; 
</span><a name="LN255"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>keys</span><span class='Delimiter'>[</span><span class='Number'>4</span><span class='Delimiter'>]; 
</span><a name="LN256"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN257"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>oldtup</span><span class='Delimiter'>; 
</span><a name="LN258"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newtup</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN259"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_shseclabel.h.html#LN40"><span class='Ref_to_Const'>Natts_pg_shseclabel</span></a><span class='Delimiter'>]; 
</span><a name="LN260"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_shseclabel.h.html#LN40"><span class='Ref_to_Const'>Natts_pg_shseclabel</span></a><span class='Delimiter'>]; 
</span><a name="LN261"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>replaces</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_shseclabel.h.html#LN40"><span class='Ref_to_Const'>Natts_pg_shseclabel</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* Prepare to form or update a tuple, if necessary. */ 
</span>    memset<span class='Parentheses'>(</span><a href="seclabel.c.html#LN260"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="seclabel.c.html#LN260"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="seclabel.c.html#LN261"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="seclabel.c.html#LN261"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="seclabel.c.html#LN259"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_shseclabel.h.html#LN41"><span class='Ref_to_Const'>Anum_pg_shseclabel_objoid</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN251"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="seclabel.c.html#LN259"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_shseclabel.h.html#LN42"><span class='Ref_to_Const'>Anum_pg_shseclabel_classoid</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN251"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="seclabel.c.html#LN259"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_shseclabel.h.html#LN43"><span class='Ref_to_Const'>Anum_pg_shseclabel_provider</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN252"><span class='Ref_to_Parameter'>provider</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="seclabel.c.html#LN252"><span class='Ref_to_Parameter'>label</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="seclabel.c.html#LN259"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_shseclabel.h.html#LN44"><span class='Ref_to_Const'>Anum_pg_shseclabel_label</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN252"><span class='Ref_to_Parameter'>label</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Use the index to search for a matching old tuple */ 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="seclabel.c.html#LN255"><span class='Ref_To_Local'>keys</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_shseclabel.h.html#LN41"><span class='Ref_to_Const'>Anum_pg_shseclabel_objoid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN251"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="seclabel.c.html#LN255"><span class='Ref_To_Local'>keys</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_shseclabel.h.html#LN42"><span class='Ref_to_Const'>Anum_pg_shseclabel_classoid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN251"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="seclabel.c.html#LN255"><span class='Ref_To_Local'>keys</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_shseclabel.h.html#LN43"><span class='Ref_to_Const'>Anum_pg_shseclabel_provider</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_TEXTEQ<span class='Delimiter'>, 
</span>                <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN252"><span class='Ref_to_Parameter'>provider</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="seclabel.c.html#LN254"><span class='Ref_To_Local'>pg_shseclabel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_shseclabel.h.html#LN20"><span class='Ref_to_Const'>SharedSecLabelRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="seclabel.c.html#LN256"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN254"><span class='Ref_To_Local'>pg_shseclabel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN315"><span class='Ref_to_Const'>SharedSecLabelObjectIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Delimiter'>, </span><a href="seclabel.c.html#LN255"><span class='Ref_To_Local'>keys</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="seclabel.c.html#LN257"><span class='Ref_To_Local'>oldtup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN256"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN257"><span class='Ref_To_Local'>oldtup</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="seclabel.c.html#LN252"><span class='Ref_to_Parameter'>label</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="../../include/catalog/indexing.h.html#LN40"><span class='Ref_to_Proto'>CatalogTupleDelete</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN254"><span class='Ref_To_Local'>pg_shseclabel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="seclabel.c.html#LN257"><span class='Ref_To_Local'>oldtup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="seclabel.c.html#LN261"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_shseclabel.h.html#LN44"><span class='Ref_to_Const'>Anum_pg_shseclabel_label</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="seclabel.c.html#LN258"><span class='Ref_To_Local'>newtup</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN257"><span class='Ref_To_Local'>oldtup</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN254"><span class='Ref_To_Local'>pg_shseclabel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                       <a href="seclabel.c.html#LN259"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="seclabel.c.html#LN260"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><a href="seclabel.c.html#LN261"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN254"><span class='Ref_To_Local'>pg_shseclabel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="seclabel.c.html#LN257"><span class='Ref_To_Local'>oldtup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="seclabel.c.html#LN258"><span class='Ref_To_Local'>newtup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN256"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If we didn't find an old tuple, insert a new one */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="seclabel.c.html#LN258"><span class='Ref_To_Local'>newtup</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="seclabel.c.html#LN252"><span class='Ref_to_Parameter'>label</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="seclabel.c.html#LN258"><span class='Ref_To_Local'>newtup</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN254"><span class='Ref_To_Local'>pg_shseclabel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="seclabel.c.html#LN259"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="seclabel.c.html#LN260"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/catalog/indexing.h.html#LN32"><span class='Ref_to_Proto'>CatalogTupleInsert</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN254"><span class='Ref_To_Local'>pg_shseclabel</span></a><span class='Delimiter'>, </span><a href="seclabel.c.html#LN258"><span class='Ref_To_Local'>newtup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="seclabel.c.html#LN258"><span class='Ref_To_Local'>newtup</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN258"><span class='Ref_To_Local'>newtup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN254"><span class='Ref_To_Local'>pg_shseclabel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SetSharedSecurityLabel &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * SetSecurityLabel attempts to set the security label for the specified 
 * provider on the specified object to the given value.  NULL means that any 
 * any existing label should be deleted. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN326"></a><span class='Declare_Function'>SetSecurityLabel</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>object</span><span class='Delimiter'>, 
</span><a name="LN327"></a>                 <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>provider</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>label</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN329"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pg_seclabel</span><span class='Delimiter'>; 
</span><a name="LN330"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>keys</span><span class='Delimiter'>[</span><span class='Number'>4</span><span class='Delimiter'>]; 
</span><a name="LN331"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN332"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>oldtup</span><span class='Delimiter'>; 
</span><a name="LN333"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newtup</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN334"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_seclabel.h.html#LN38"><span class='Ref_to_Const'>Natts_pg_seclabel</span></a><span class='Delimiter'>]; 
</span><a name="LN335"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_seclabel.h.html#LN38"><span class='Ref_to_Const'>Natts_pg_seclabel</span></a><span class='Delimiter'>]; 
</span><a name="LN336"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>replaces</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_seclabel.h.html#LN38"><span class='Ref_to_Const'>Natts_pg_seclabel</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* Shared objects have their own security label catalog. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/catalog.h.html#LN42"><span class='Ref_to_Proto'>IsSharedRelation</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN326"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="seclabel.c.html#LN250"><span class='Ref_to_Func'>SetSharedSecurityLabel</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN326"><span class='Ref_to_Parameter'>object</span></a><span class='Delimiter'>, </span><a href="seclabel.c.html#LN327"><span class='Ref_to_Parameter'>provider</span></a><span class='Delimiter'>, </span><a href="seclabel.c.html#LN327"><span class='Ref_to_Parameter'>label</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Prepare to form or update a tuple, if necessary. */ 
</span>    memset<span class='Parentheses'>(</span><a href="seclabel.c.html#LN335"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="seclabel.c.html#LN335"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="seclabel.c.html#LN336"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="seclabel.c.html#LN336"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="seclabel.c.html#LN334"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_seclabel.h.html#LN39"><span class='Ref_to_Const'>Anum_pg_seclabel_objoid</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN326"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="seclabel.c.html#LN334"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_seclabel.h.html#LN40"><span class='Ref_to_Const'>Anum_pg_seclabel_classoid</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN326"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="seclabel.c.html#LN334"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_seclabel.h.html#LN41"><span class='Ref_to_Const'>Anum_pg_seclabel_objsubid</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN326"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="seclabel.c.html#LN334"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_seclabel.h.html#LN42"><span class='Ref_to_Const'>Anum_pg_seclabel_provider</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN327"><span class='Ref_to_Parameter'>provider</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="seclabel.c.html#LN327"><span class='Ref_to_Parameter'>label</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="seclabel.c.html#LN334"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_seclabel.h.html#LN43"><span class='Ref_to_Const'>Anum_pg_seclabel_label</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN327"><span class='Ref_to_Parameter'>label</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Use the index to search for a matching old tuple */ 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="seclabel.c.html#LN330"><span class='Ref_To_Local'>keys</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_seclabel.h.html#LN39"><span class='Ref_to_Const'>Anum_pg_seclabel_objoid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN326"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="seclabel.c.html#LN330"><span class='Ref_To_Local'>keys</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_seclabel.h.html#LN40"><span class='Ref_to_Const'>Anum_pg_seclabel_classoid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN326"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="seclabel.c.html#LN330"><span class='Ref_To_Local'>keys</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_seclabel.h.html#LN41"><span class='Ref_to_Const'>Anum_pg_seclabel_objsubid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_INT4EQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN326"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="seclabel.c.html#LN330"><span class='Ref_To_Local'>keys</span></a><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_seclabel.h.html#LN42"><span class='Ref_to_Const'>Anum_pg_seclabel_provider</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_TEXTEQ<span class='Delimiter'>, 
</span>                <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN327"><span class='Ref_to_Parameter'>provider</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="seclabel.c.html#LN329"><span class='Ref_To_Local'>pg_seclabel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_seclabel.h.html#LN20"><span class='Ref_to_Const'>SecLabelRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="seclabel.c.html#LN331"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN329"><span class='Ref_To_Local'>pg_seclabel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN312"><span class='Ref_to_Const'>SecLabelObjectIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><a href="seclabel.c.html#LN330"><span class='Ref_To_Local'>keys</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="seclabel.c.html#LN332"><span class='Ref_To_Local'>oldtup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN331"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN332"><span class='Ref_To_Local'>oldtup</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="seclabel.c.html#LN327"><span class='Ref_to_Parameter'>label</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="../../include/catalog/indexing.h.html#LN40"><span class='Ref_to_Proto'>CatalogTupleDelete</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN329"><span class='Ref_To_Local'>pg_seclabel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="seclabel.c.html#LN332"><span class='Ref_To_Local'>oldtup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="seclabel.c.html#LN336"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_seclabel.h.html#LN43"><span class='Ref_to_Const'>Anum_pg_seclabel_label</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="seclabel.c.html#LN333"><span class='Ref_To_Local'>newtup</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN332"><span class='Ref_To_Local'>oldtup</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN329"><span class='Ref_To_Local'>pg_seclabel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                       <a href="seclabel.c.html#LN334"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="seclabel.c.html#LN335"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><a href="seclabel.c.html#LN336"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN329"><span class='Ref_To_Local'>pg_seclabel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="seclabel.c.html#LN332"><span class='Ref_To_Local'>oldtup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="seclabel.c.html#LN333"><span class='Ref_To_Local'>newtup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN331"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If we didn't find an old tuple, insert a new one */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="seclabel.c.html#LN333"><span class='Ref_To_Local'>newtup</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="seclabel.c.html#LN327"><span class='Ref_to_Parameter'>label</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="seclabel.c.html#LN333"><span class='Ref_To_Local'>newtup</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN329"><span class='Ref_To_Local'>pg_seclabel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="seclabel.c.html#LN334"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="seclabel.c.html#LN335"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/catalog/indexing.h.html#LN32"><span class='Ref_to_Proto'>CatalogTupleInsert</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN329"><span class='Ref_To_Local'>pg_seclabel</span></a><span class='Delimiter'>, </span><a href="seclabel.c.html#LN333"><span class='Ref_To_Local'>newtup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Update indexes, if necessary */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="seclabel.c.html#LN333"><span class='Ref_To_Local'>newtup</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN333"><span class='Ref_To_Local'>newtup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN329"><span class='Ref_To_Local'>pg_seclabel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SetSecurityLabel &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * DeleteSharedSecurityLabel is a helper function of DeleteSecurityLabel 
 * to handle shared database objects. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN413"></a><span class='Declare_Function'>DeleteSharedSecurityLabel</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>objectId</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>classId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN415"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pg_shseclabel</span><span class='Delimiter'>; 
</span><a name="LN416"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>skey</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN417"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN418"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>oldtup</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="seclabel.c.html#LN416"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_shseclabel.h.html#LN41"><span class='Ref_to_Const'>Anum_pg_shseclabel_objoid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN413"><span class='Ref_to_Parameter'>objectId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="seclabel.c.html#LN416"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_shseclabel.h.html#LN42"><span class='Ref_to_Const'>Anum_pg_shseclabel_classoid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN413"><span class='Ref_to_Parameter'>classId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="seclabel.c.html#LN415"><span class='Ref_To_Local'>pg_shseclabel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_shseclabel.h.html#LN20"><span class='Ref_to_Const'>SharedSecLabelRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="seclabel.c.html#LN417"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN415"><span class='Ref_To_Local'>pg_shseclabel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN315"><span class='Ref_to_Const'>SharedSecLabelObjectIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="seclabel.c.html#LN416"><span class='Ref_To_Local'>skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN418"><span class='Ref_To_Local'>oldtup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN417"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)))</span> 
        <a href="../../include/catalog/indexing.h.html#LN40"><span class='Ref_to_Proto'>CatalogTupleDelete</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN415"><span class='Ref_To_Local'>pg_shseclabel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="seclabel.c.html#LN418"><span class='Ref_To_Local'>oldtup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN417"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN415"><span class='Ref_To_Local'>pg_shseclabel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DeleteSharedSecurityLabel &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * DeleteSecurityLabel removes all security labels for an object (and any 
 * sub-objects, if applicable). 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN445"></a><span class='Declare_Function'>DeleteSecurityLabel</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>object</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN447"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pg_seclabel</span><span class='Delimiter'>; 
</span><a name="LN448"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>skey</span><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>]; 
</span><a name="LN449"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN450"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>oldtup</span><span class='Delimiter'>; 
</span><a name="LN451"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nkeys</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Shared objects have their own security label catalog. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/catalog.h.html#LN42"><span class='Ref_to_Proto'>IsSharedRelation</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN445"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="seclabel.c.html#LN445"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/commands/seclabel.h.html#LN21"><span class='Ref_to_Proto'>DeleteSharedSecurityLabel</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN445"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Delimiter'>, </span><a href="seclabel.c.html#LN445"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="seclabel.c.html#LN448"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_seclabel.h.html#LN39"><span class='Ref_to_Const'>Anum_pg_seclabel_objoid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN445"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="seclabel.c.html#LN448"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_seclabel.h.html#LN40"><span class='Ref_to_Const'>Anum_pg_seclabel_classoid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN445"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="seclabel.c.html#LN445"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="seclabel.c.html#LN448"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>], 
</span>                    <a href="../../include/catalog/pg_seclabel.h.html#LN41"><span class='Ref_to_Const'>Anum_pg_seclabel_objsubid</span></a><span class='Delimiter'>, 
</span>                    <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_INT4EQ<span class='Delimiter'>, 
</span>                    <a href="../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN445"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="seclabel.c.html#LN451"><span class='Ref_To_Local'>nkeys</span></a> <span class='Operator'>= </span><span class='Number'>3</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="seclabel.c.html#LN451"><span class='Ref_To_Local'>nkeys</span></a> <span class='Operator'>= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span> 
    <a href="seclabel.c.html#LN447"><span class='Ref_To_Local'>pg_seclabel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_seclabel.h.html#LN20"><span class='Ref_to_Const'>SecLabelRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="seclabel.c.html#LN449"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN447"><span class='Ref_To_Local'>pg_seclabel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN312"><span class='Ref_to_Const'>SecLabelObjectIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="seclabel.c.html#LN451"><span class='Ref_To_Local'>nkeys</span></a><span class='Delimiter'>, </span><a href="seclabel.c.html#LN448"><span class='Ref_To_Local'>skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN450"><span class='Ref_To_Local'>oldtup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN449"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)))</span> 
        <a href="../../include/catalog/indexing.h.html#LN40"><span class='Ref_to_Proto'>CatalogTupleDelete</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN447"><span class='Ref_To_Local'>pg_seclabel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="seclabel.c.html#LN450"><span class='Ref_To_Local'>oldtup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN449"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN447"><span class='Ref_To_Local'>pg_seclabel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DeleteSecurityLabel &raquo; </span> 
 
<span class='Keyword'>void 
</span><a name="LN492"></a><span class='Declare_Function'>register_label_provider</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>provider_name</span><span class='Delimiter'>, </span><a href="../../include/commands/seclabel.h.html#LN28"><span class='Ref_to_Typedef'>check_object_relabel_type</span></a> <span class='Declare_Parameter'>hook</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN494"></a>    <a href="seclabel.c.html#LN27"><span class='Ref_to_Typedef'>LabelProvider</span></a> <span class='Operator'>*</span><span class='Declare_Local'>provider</span><span class='Delimiter'>; 
</span><a name="LN495"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span> 
    <a href="seclabel.c.html#LN495"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN42"><span class='Ref_to_Global_Var'>TopMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="seclabel.c.html#LN494"><span class='Ref_To_Local'>provider</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="seclabel.c.html#LN27"><span class='Ref_to_Typedef'>LabelProvider</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="seclabel.c.html#LN494"><span class='Ref_To_Local'>provider</span></a><span class='Operator'>-&GT;</span><a href="seclabel.c.html#LN29"><span class='Ref_to_Member'>provider_name</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN492"><span class='Ref_to_Parameter'>provider_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="seclabel.c.html#LN494"><span class='Ref_To_Local'>provider</span></a><span class='Operator'>-&GT;</span><a href="seclabel.c.html#LN30"><span class='Ref_to_Member'>hook</span></a> <span class='Operator'>= </span><a href="seclabel.c.html#LN492"><span class='Ref_to_Parameter'>hook</span></a><span class='Delimiter'>; 
</span>    <a href="seclabel.c.html#LN33"><span class='Ref_to_Global_Var'>label_provider_list</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN33"><span class='Ref_to_Global_Var'>label_provider_list</span></a><span class='Delimiter'>, </span><a href="seclabel.c.html#LN494"><span class='Ref_To_Local'>provider</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="seclabel.c.html#LN495"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>