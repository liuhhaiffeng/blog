<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\commands\sequence.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\commands\sequence.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:36 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * sequence.c 
 *    PostgreSQL sequences support code. 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/commands/sequence.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/bufmask.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/multixact.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/transam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xact.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xlog.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xloginsert.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xlogutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/dependency.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/indexing.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/namespace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/objectaccess.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_sequence.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/defrem.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/sequence.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/tablecmds.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"funcapi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/makefuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/lmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/proc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/smgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/acl.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/resowner.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/varlena.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * We don't want to log each fetching of a value from a sequence, 
 * so we pre-log a few fetches in advance. In the event of 
 * crash we can lose (skip over) as many values as we pre-logged. 
 */ 
</span><a name="LN53"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>SEQ_LOG_VALS</span>    <span class='Number'>32</span> 
 
<span class='Comment_Multi_Line'>/* 
 * The "special area" of a sequence's buffer page looks like this. 
 */ 
</span><a name="LN58"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>SEQ_MAGIC</span>     <span class='Number'>0x1717</span> 
 
<a name="LN60"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>sequence_magic</span> 
<span class='Delimiter'>{ 
</span><a name="LN62"></a>    <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Member'>magic</span><span class='Delimiter'>; 
</span><a name="LN63"></a>} <span class='Declare_Typedef'>sequence_magic</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * We store a SeqTable item for every sequence we have touched in the current 
 * session.  This is needed to hold onto nextval/currval state.  (We can't 
 * rely on the relcache, since it's only, well, a cache, and may decide to 
 * discard entries.) 
 */ 
</span><a name="LN71"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>SeqTableData</span> 
<span class='Delimiter'>{ 
</span><a name="LN73"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>relid</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* pg_class OID of this sequence (hash key) */ 
</span><a name="LN74"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>filenode</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* last seen relfilenode of this sequence */ 
</span><a name="LN75"></a>    <a href="../../include/c.h.html#LN398"><span class='Ref_to_Typedef'>LocalTransactionId</span></a> <span class='Declare_Member'>lxid</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* xact in which we last did a seq op */ 
</span><a name="LN76"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>last_valid</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* do we have a valid "last" value? */ 
</span><a name="LN77"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>last</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* value last returned by nextval */ 
</span><a name="LN78"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>cached</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* last value already cached for nextval */ 
</span>    <span class='Comment_Multi_Line'>/* if last != cached, we have not used up all the cached values */ 
</span><a name="LN80"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>increment</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* copy of sequence's increment field */ 
</span>    <span class='Comment_Multi_Line'>/* note that increment is zero until we first do nextval_internal() */ 
</span><a name="LN82"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>SeqTableData</span><span class='Delimiter'>; 
</span> 
<a name="LN84"></a><span class='Control'>typedef</span> <a href="sequence.c.html#LN71"><span class='Ref_to_Struct'>SeqTableData</span></a> <span class='Operator'>*</span><span class='Declare_Typedef'>SeqTable</span><span class='Delimiter'>; 
</span> 
<a name="LN86"></a><span class='Keyword'>static </span><a href="../utils/hash/dynahash.c.html#LN192"><span class='Ref_to_Struct'>HTAB</span></a> <span class='Operator'>*</span><span class='Declare_Var'>seqhashtab</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* hash table for SeqTable items */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * last_used_seq is updated by nextval() to point to the last used 
 * sequence. 
 */ 
</span><a name="LN92"></a><span class='Keyword'>static </span><a href="sequence.c.html#LN71"><span class='Ref_to_Struct'>SeqTableData</span></a> <span class='Operator'>*</span><span class='Declare_Var'>last_used_seq</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<a name="LN94"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>fill_seq_with_data</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tuple</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN95"></a><span class='Keyword'>static </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Prototype'>lock_and_open_sequence</span><span class='Parentheses'>(</span><a href="sequence.c.html#LN84"><span class='Ref_to_Typedef'>SeqTable</span></a> <span class='Declare_Parameter'>seq</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN96"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>create_seq_hashtable</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN97"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>init_sequence</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Delimiter'>, </span><a href="sequence.c.html#LN84"><span class='Ref_to_Typedef'>SeqTable</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>p_elm</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>p_rel</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN98"></a><span class='Keyword'>static </span><a href="../../include/commands/sequence.h.html#LN31"><span class='Ref_to_Typedef'>Form_pg_sequence_data</span></a> <span class='Declare_Prototype'>read_seq_tuple</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN99"></a>               <a href="../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>seqdatatuple</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN100"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>init_params</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>options</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>for_identity</span><span class='Delimiter'>, 
</span><a name="LN101"></a>            <span class='Keyword'>bool </span><span class='Declare_Parameter'>isInit</span><span class='Delimiter'>, 
</span><a name="LN102"></a>            <a href="../../include/catalog/pg_sequence.h.html#LN19"><span class='Ref_to_Typedef'>Form_pg_sequence</span></a> <span class='Declare_Parameter'>seqform</span><span class='Delimiter'>, 
</span><a name="LN103"></a>            <a href="../../include/commands/sequence.h.html#LN31"><span class='Ref_to_Typedef'>Form_pg_sequence_data</span></a> <span class='Declare_Parameter'>seqdataform</span><span class='Delimiter'>, 
</span><a name="LN104"></a>            <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>need_seq_rewrite</span><span class='Delimiter'>, 
</span><a name="LN105"></a>            <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>owned_by</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN106"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>do_setval</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Declare_Parameter'>next</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>iscalled</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN107"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>process_owned_by</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>seqrel</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>owned_by</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>for_identity</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * DefineSequence 
 *              Creates a new sequence relation 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN115"></a><span class='Declare_Function'>DefineSequence</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2438"><span class='Ref_to_Struct'>CreateSeqStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>seq</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN117"></a>    FormData_pg_sequence <span class='Declare_Local'>seqform</span><span class='Delimiter'>; 
</span><a name="LN118"></a>    <a href="../../include/commands/sequence.h.html#LN24"><span class='Ref_to_Struct'>FormData_pg_sequence_data</span></a> <span class='Declare_Local'>seqdataform</span><span class='Delimiter'>; 
</span><a name="LN119"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>need_seq_rewrite</span><span class='Delimiter'>; 
</span><a name="LN120"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>owned_by</span><span class='Delimiter'>; 
</span><a name="LN121"></a>    <a href="../../include/nodes/parsenodes.h.html#LN1972"><span class='Ref_to_Struct'>CreateStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>stmt</span> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1972"><span class='Ref_to_Struct'>CreateStmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN122"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>seqoid</span><span class='Delimiter'>; 
</span><a name="LN123"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span><a name="LN124"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN125"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN126"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupDesc</span><span class='Delimiter'>; 
</span><a name="LN127"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>value</span><span class='Delimiter'>[</span><a href="../../include/commands/sequence.h.html#LN42"><span class='Ref_to_Const'>SEQ_COL_LASTCOL</span></a><span class='Delimiter'>]; 
</span><a name="LN128"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>null</span><span class='Delimiter'>[</span><a href="../../include/commands/sequence.h.html#LN42"><span class='Ref_to_Const'>SEQ_COL_LASTCOL</span></a><span class='Delimiter'>]; 
</span><a name="LN129"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>pgs_values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_sequence.h.html#LN21"><span class='Ref_to_Const'>Natts_pg_sequence</span></a><span class='Delimiter'>]; 
</span><a name="LN130"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>pgs_nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_sequence.h.html#LN21"><span class='Ref_to_Const'>Natts_pg_sequence</span></a><span class='Delimiter'>]; 
</span><a name="LN131"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Unlogged sequences are not implemented -- not clear if useful. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN115"><span class='Ref_to_Parameter'>seq</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2441"><span class='Ref_to_Member'>sequence</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN70"><span class='Ref_to_Member'>relpersistence</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN170"><span class='Ref_to_Const'>RELPERSISTENCE_UNLOGGED</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unlogged sequences are not supported"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If if_not_exists was given and a relation with the same name already 
     * exists, bail out. (Note: we needn't check this when not if_not_exists, 
     * because DefineRelation will complain anyway.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN115"><span class='Ref_to_Parameter'>seq</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2445"><span class='Ref_to_Member'>if_not_exists</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/catalog/namespace.h.html#LN60"><span class='Ref_to_Proto'>RangeVarGetAndCheckCreationNamespace</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN115"><span class='Ref_to_Parameter'>seq</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2441"><span class='Ref_to_Member'>sequence</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="sequence.c.html#LN122"><span class='Ref_To_Local'>seqoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN122"><span class='Ref_To_Local'>seqoid</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DUPLICATE_TABLE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"relation \"%s\" already exists, skipping"</span><span class='Delimiter'>, 
</span>                            <a href="sequence.c.html#LN115"><span class='Ref_to_Parameter'>seq</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2441"><span class='Ref_to_Member'>sequence</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="../catalog/objectaddress.c.html#LN718"><span class='Ref_to_Global_Var'>InvalidObjectAddress</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Check and set all option values */ 
</span>    <a href="sequence.c.html#LN100"><span class='Ref_to_Proto'>init_params</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN115"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN115"><span class='Ref_to_Parameter'>seq</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2442"><span class='Ref_to_Member'>options</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN115"><span class='Ref_to_Parameter'>seq</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2444"><span class='Ref_to_Member'>for_identity</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                <span class='Operator'>&</span><a href="sequence.c.html#LN117"><span class='Ref_To_Local'>seqform</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="sequence.c.html#LN118"><span class='Ref_To_Local'>seqdataform</span></a><span class='Delimiter'>, 
</span>                <span class='Operator'>&</span><a href="sequence.c.html#LN119"><span class='Ref_To_Local'>need_seq_rewrite</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="sequence.c.html#LN120"><span class='Ref_To_Local'>owned_by</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create relation (and fill value[] and null[] for the tuple) 
     */ 
</span>    <a href="sequence.c.html#LN121"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1976"><span class='Ref_to_Member'>tableElts</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN131"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="../../include/commands/sequence.h.html#LN41"><span class='Ref_to_Const'>SEQ_COL_FIRSTCOL</span></a><span class='Delimiter'>; </span><a href="sequence.c.html#LN131"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="../../include/commands/sequence.h.html#LN42"><span class='Ref_to_Const'>SEQ_COL_LASTCOL</span></a><span class='Delimiter'>; </span><a href="sequence.c.html#LN131"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN168"></a>        <a href="../../include/nodes/parsenodes.h.html#LN636"><span class='Ref_to_Struct'>ColumnDef</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>coldef</span> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN636"><span class='Ref_to_Struct'>ColumnDef</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="sequence.c.html#LN168"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN641"><span class='Ref_to_Member'>inhcount</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN168"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN642"><span class='Ref_to_Member'>is_local</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN168"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN643"><span class='Ref_to_Member'>is_not_null</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN168"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN644"><span class='Ref_to_Member'>is_from_type</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN168"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN645"><span class='Ref_to_Member'>is_from_parent</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN168"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN646"><span class='Ref_to_Member'>storage</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN168"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN647"><span class='Ref_to_Member'>raw_default</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN168"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN648"><span class='Ref_to_Member'>cooked_default</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN168"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN650"><span class='Ref_to_Member'>collClause</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN168"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN651"><span class='Ref_to_Member'>collOid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN168"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN652"><span class='Ref_to_Member'>constraints</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN168"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN654"><span class='Ref_to_Member'>location</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <a href="sequence.c.html#LN128"><span class='Ref_To_Local'>null</span></a><span class='Delimiter'>[</span><a href="sequence.c.html#LN131"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN131"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../include/commands/sequence.h.html#LN37"><span class='Ref_to_Const'>SEQ_COL_LASTVAL</span></a><span class='Operator'>: 
</span>                <a href="sequence.c.html#LN168"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN640"><span class='Ref_to_Member'>typeName</span></a> <span class='Operator'>= </span><a href="../../include/nodes/makefuncs.h.html#LN72"><span class='Ref_to_Proto'>makeTypeNameFromOid</span></a><span class='Parentheses'>(</span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN21"><span class='Ref_to_Const'>INT8OID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="sequence.c.html#LN168"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN639"><span class='Ref_to_Member'>colname</span></a> <span class='Operator'>= </span><span class='String'>"last_value"</span><span class='Delimiter'>; 
</span>                <span class='Keyword'>value</span><span class='Delimiter'>[</span><a href="sequence.c.html#LN131"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN777"><span class='Ref_to_Macro'>Int64GetDatumFast</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN118"><span class='Ref_To_Local'>seqdataform</span></a><span class='Operator'>.</span><a href="../../include/commands/sequence.h.html#LN26"><span class='Ref_to_Member'>last_value</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/commands/sequence.h.html#LN38"><span class='Ref_to_Const'>SEQ_COL_LOG</span></a><span class='Operator'>: 
</span>                <a href="sequence.c.html#LN168"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN640"><span class='Ref_to_Member'>typeName</span></a> <span class='Operator'>= </span><a href="../../include/nodes/makefuncs.h.html#LN72"><span class='Ref_to_Proto'>makeTypeNameFromOid</span></a><span class='Parentheses'>(</span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN21"><span class='Ref_to_Const'>INT8OID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="sequence.c.html#LN168"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN639"><span class='Ref_to_Member'>colname</span></a> <span class='Operator'>= </span><span class='String'>"log_cnt"</span><span class='Delimiter'>; 
</span>                <span class='Keyword'>value</span><span class='Delimiter'>[</span><a href="sequence.c.html#LN131"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN624"><span class='Ref_to_Macro'>Int64GetDatum</span></a><span class='Parentheses'>((</span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/commands/sequence.h.html#LN39"><span class='Ref_to_Const'>SEQ_COL_CALLED</span></a><span class='Operator'>: 
</span>                <a href="sequence.c.html#LN168"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN640"><span class='Ref_to_Member'>typeName</span></a> <span class='Operator'>= </span><a href="../../include/nodes/makefuncs.h.html#LN72"><span class='Ref_to_Proto'>makeTypeNameFromOid</span></a><span class='Parentheses'>(</span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN17"><span class='Ref_to_Const'>BOOLOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="sequence.c.html#LN168"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN639"><span class='Ref_to_Member'>colname</span></a> <span class='Operator'>= </span><span class='String'>"is_called"</span><span class='Delimiter'>; 
</span>                <span class='Keyword'>value</span><span class='Delimiter'>[</span><a href="sequence.c.html#LN131"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="sequence.c.html#LN121"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1976"><span class='Ref_to_Member'>tableElts</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN121"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1976"><span class='Ref_to_Member'>tableElts</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN168"><span class='Ref_To_Local'>coldef</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=SEQ_COL_FIRSTCOL;i&LT;... &raquo; </span> 
 
    <a href="sequence.c.html#LN121"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1975"><span class='Ref_to_Member'>relation</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN115"><span class='Ref_to_Parameter'>seq</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2441"><span class='Ref_to_Member'>sequence</span></a><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN121"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1977"><span class='Ref_to_Member'>inhRelations</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN121"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1982"><span class='Ref_to_Member'>constraints</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN121"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1983"><span class='Ref_to_Member'>options</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN121"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1984"><span class='Ref_to_Member'>oncommit</span></a> <span class='Operator'>= </span><a href="../../include/nodes/primnodes.h.html#LN48"><span class='Ref_to_EnumConst'>ONCOMMIT_NOOP</span></a><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN121"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1985"><span class='Ref_to_Member'>tablespacename</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN121"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1986"><span class='Ref_to_Member'>if_not_exists</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN115"><span class='Ref_to_Parameter'>seq</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2445"><span class='Ref_to_Member'>if_not_exists</span></a><span class='Delimiter'>; 
</span> 
    <a href="sequence.c.html#LN123"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="../../include/commands/tablecmds.h.html#LN24"><span class='Ref_to_Proto'>DefineRelation</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN121"><span class='Ref_To_Local'>stmt</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN115"><span class='Ref_to_Parameter'>seq</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2443"><span class='Ref_to_Member'>ownerId</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN122"><span class='Ref_To_Local'>seqoid</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN123"><span class='Ref_To_Local'>address</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="sequence.c.html#LN122"><span class='Ref_To_Local'>seqoid</span></a> <span class='Operator'>!= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="sequence.c.html#LN124"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN122"><span class='Ref_To_Local'>seqoid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN126"><span class='Ref_To_Local'>tupDesc</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN124"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* now initialize the sequence's data */ 
</span>    <a href="sequence.c.html#LN125"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN126"><span class='Ref_To_Local'>tupDesc</span></a><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Delimiter'>, </span><a href="sequence.c.html#LN128"><span class='Ref_To_Local'>null</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN94"><span class='Ref_to_Proto'>fill_seq_with_data</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN124"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN125"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* process OWNED BY if given */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN120"><span class='Ref_To_Local'>owned_by</span></a><span class='Parentheses'>) 
</span>        <a href="sequence.c.html#LN107"><span class='Ref_to_Proto'>process_owned_by</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN124"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN120"><span class='Ref_To_Local'>owned_by</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN115"><span class='Ref_to_Parameter'>seq</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2444"><span class='Ref_to_Member'>for_identity</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN124"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* fill in pg_sequence */ 
</span>    <a href="sequence.c.html#LN124"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_sequence.h.html#LN5"><span class='Ref_to_Const'>SequenceRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN126"><span class='Ref_To_Local'>tupDesc</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN124"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    memset<span class='Parentheses'>(</span><a href="sequence.c.html#LN130"><span class='Ref_To_Local'>pgs_nulls</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="sequence.c.html#LN130"><span class='Ref_To_Local'>pgs_nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="sequence.c.html#LN129"><span class='Ref_To_Local'>pgs_values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_sequence.h.html#LN22"><span class='Ref_to_Const'>Anum_pg_sequence_seqrelid</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN122"><span class='Ref_To_Local'>seqoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN129"><span class='Ref_To_Local'>pgs_values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_sequence.h.html#LN23"><span class='Ref_to_Const'>Anum_pg_sequence_seqtypid</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN117"><span class='Ref_To_Local'>seqform</span></a><span class='Operator'>.</span>seqtypid<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN129"><span class='Ref_To_Local'>pgs_values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_sequence.h.html#LN24"><span class='Ref_to_Const'>Anum_pg_sequence_seqstart</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN777"><span class='Ref_to_Macro'>Int64GetDatumFast</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN117"><span class='Ref_To_Local'>seqform</span></a><span class='Operator'>.</span>seqstart<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN129"><span class='Ref_To_Local'>pgs_values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_sequence.h.html#LN25"><span class='Ref_to_Const'>Anum_pg_sequence_seqincrement</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN777"><span class='Ref_to_Macro'>Int64GetDatumFast</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN117"><span class='Ref_To_Local'>seqform</span></a><span class='Operator'>.</span>seqincrement<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN129"><span class='Ref_To_Local'>pgs_values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_sequence.h.html#LN26"><span class='Ref_to_Const'>Anum_pg_sequence_seqmax</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN777"><span class='Ref_to_Macro'>Int64GetDatumFast</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN117"><span class='Ref_To_Local'>seqform</span></a><span class='Operator'>.</span>seqmax<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN129"><span class='Ref_To_Local'>pgs_values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_sequence.h.html#LN27"><span class='Ref_to_Const'>Anum_pg_sequence_seqmin</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN777"><span class='Ref_to_Macro'>Int64GetDatumFast</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN117"><span class='Ref_To_Local'>seqform</span></a><span class='Operator'>.</span>seqmin<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN129"><span class='Ref_To_Local'>pgs_values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_sequence.h.html#LN28"><span class='Ref_to_Const'>Anum_pg_sequence_seqcache</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN777"><span class='Ref_to_Macro'>Int64GetDatumFast</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN117"><span class='Ref_To_Local'>seqform</span></a><span class='Operator'>.</span>seqcache<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN129"><span class='Ref_To_Local'>pgs_values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_sequence.h.html#LN29"><span class='Ref_to_Const'>Anum_pg_sequence_seqcycle</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN117"><span class='Ref_To_Local'>seqform</span></a><span class='Operator'>.</span>seqcycle<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="sequence.c.html#LN125"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN126"><span class='Ref_To_Local'>tupDesc</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN129"><span class='Ref_To_Local'>pgs_values</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN130"><span class='Ref_To_Local'>pgs_nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/catalog/indexing.h.html#LN32"><span class='Ref_to_Proto'>CatalogTupleInsert</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN124"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN125"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN125"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN124"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="sequence.c.html#LN123"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DefineSequence &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Reset a sequence to its initial value. 
 * 
 * The change is made transactionally, so that on failure of the current 
 * transaction, the sequence will be restored to its previous state. 
 * We do that by creating a whole new relfilenode for the sequence; so this 
 * works much like the rewriting forms of ALTER TABLE. 
 * 
 * Caller is assumed to have acquired AccessExclusiveLock on the sequence, 
 * which must not be released until end of transaction.  Caller is also 
 * responsible for permissions checking. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN268"></a><span class='Declare_Function'>ResetSequence</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>seq_relid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN270"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>seq_rel</span><span class='Delimiter'>; 
</span><a name="LN271"></a>    <a href="sequence.c.html#LN84"><span class='Ref_to_Typedef'>SeqTable</span></a>    <span class='Declare_Local'>elm</span><span class='Delimiter'>; 
</span><a name="LN272"></a>    <a href="../../include/commands/sequence.h.html#LN31"><span class='Ref_to_Typedef'>Form_pg_sequence_data</span></a> <span class='Declare_Local'>seq</span><span class='Delimiter'>; 
</span><a name="LN273"></a>    <a href="../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN274"></a>    <a href="../../include/access/htup.h.html#LN61"><span class='Ref_to_Struct'>HeapTupleData</span></a> <span class='Declare_Local'>seqdatatuple</span><span class='Delimiter'>; 
</span><a name="LN275"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN276"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>pgstuple</span><span class='Delimiter'>; 
</span><a name="LN277"></a>    <a href="../../include/catalog/pg_sequence.h.html#LN19"><span class='Ref_to_Typedef'>Form_pg_sequence</span></a> <span class='Declare_Local'>pgsform</span><span class='Delimiter'>; 
</span><a name="LN278"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>startv</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Read the old sequence.  This does a bit more work than really 
     * necessary, but it's simple, and we do want to double-check that it's 
     * indeed a sequence. 
     */ 
</span>    <a href="sequence.c.html#LN97"><span class='Ref_to_Proto'>init_sequence</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN268"><span class='Ref_to_Parameter'>seq_relid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="sequence.c.html#LN271"><span class='Ref_To_Local'>elm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="sequence.c.html#LN270"><span class='Ref_To_Local'>seq_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="sequence.c.html#LN98"><span class='Ref_to_Proto'>read_seq_tuple</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN270"><span class='Ref_To_Local'>seq_rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="sequence.c.html#LN273"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="sequence.c.html#LN274"><span class='Ref_To_Local'>seqdatatuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="sequence.c.html#LN276"><span class='Ref_To_Local'>pgstuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN87"><span class='Ref_to_EnumConst'>SEQRELID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN268"><span class='Ref_to_Parameter'>seq_relid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN276"><span class='Ref_To_Local'>pgstuple</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for sequence %u"</span><span class='Delimiter'>, </span><a href="sequence.c.html#LN268"><span class='Ref_to_Parameter'>seq_relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN277"><span class='Ref_To_Local'>pgsform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_sequence.h.html#LN19"><span class='Ref_to_Typedef'>Form_pg_sequence</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN276"><span class='Ref_To_Local'>pgstuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN278"><span class='Ref_To_Local'>startv</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN277"><span class='Ref_To_Local'>pgsform</span></a><span class='Operator'>-&GT;</span>seqstart<span class='Delimiter'>; 
</span>    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN276"><span class='Ref_To_Local'>pgstuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Copy the existing sequence tuple. 
     */ 
</span>    <a href="sequence.c.html#LN275"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN606"><span class='Ref_to_Func'>heap_copytuple</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="sequence.c.html#LN274"><span class='Ref_To_Local'>seqdatatuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Now we're done with the old page */ 
</span>    <a href="../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN273"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Modify the copied tuple to execute the restart (compare the RESTART 
     * action in AlterSequence) 
     */ 
</span>    <a href="sequence.c.html#LN272"><span class='Ref_To_Local'>seq</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/commands/sequence.h.html#LN31"><span class='Ref_to_Typedef'>Form_pg_sequence_data</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN275"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN272"><span class='Ref_To_Local'>seq</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/sequence.h.html#LN26"><span class='Ref_to_Member'>last_value</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN278"><span class='Ref_To_Local'>startv</span></a><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN272"><span class='Ref_To_Local'>seq</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/sequence.h.html#LN28"><span class='Ref_to_Member'>is_called</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN272"><span class='Ref_To_Local'>seq</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/sequence.h.html#LN27"><span class='Ref_to_Member'>log_cnt</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create a new storage file for the sequence.  We want to keep the 
     * sequence's relfrozenxid at 0, since it won't contain any unfrozen XIDs. 
     * Same with relminmxid, since a sequence will never contain multixacts. 
     */ 
</span>    <a href="../../include/utils/relcache.h.html#LN105"><span class='Ref_to_Proto'>RelationSetNewRelfilenode</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN270"><span class='Ref_To_Local'>seq_rel</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN270"><span class='Ref_To_Local'>seq_rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpersistence<span class='Delimiter'>, 
</span>                              <a href="../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Delimiter'>, </span><a href="../../include/access/multixact.h.html#LN22"><span class='Ref_to_Const'>InvalidMultiXactId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Insert the modified tuple into the new storage file. 
     */ 
</span>    <a href="sequence.c.html#LN94"><span class='Ref_to_Proto'>fill_seq_with_data</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN270"><span class='Ref_To_Local'>seq_rel</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN275"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Clear local cache so that we don't think we have cached numbers */ 
</span>    <span class='Comment_Multi_Line'>/* Note that we do not change the currval() state */ 
</span>    <a href="sequence.c.html#LN271"><span class='Ref_To_Local'>elm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN78"><span class='Ref_to_Member'>cached</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN271"><span class='Ref_To_Local'>elm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN77"><span class='Ref_to_Member'>last</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN270"><span class='Ref_To_Local'>seq_rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ResetSequence &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Initialize a sequence's relation with the specified tuple as content 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN336"></a><span class='Declare_Function'>fill_seq_with_data</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tuple</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN338"></a>    <a href="../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN339"></a>    <a href="../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span><a name="LN340"></a>    <a href="sequence.c.html#LN60"><span class='Ref_to_Struct'>sequence_magic</span></a> <span class='Operator'>*</span><span class='Declare_Local'>sm</span><span class='Delimiter'>; 
</span><a name="LN341"></a>    <a href="../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>offnum</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Initialize first page of relation with special magic number */ 
</span> 
    <a href="sequence.c.html#LN338"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>= </span><a href="../../include/storage/bufmgr.h.html#LN167"><span class='Ref_to_Proto'>ReadBuffer</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN336"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/bufmgr.h.html#LN81"><span class='Ref_to_Const'>P_NEW</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/storage/bufmgr.h.html#LN187"><span class='Ref_to_Proto'>BufferGetBlockNumber</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN338"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="sequence.c.html#LN339"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN338"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../storage/page/bufpage.c.html#LN39"><span class='Ref_to_Func'>PageInit</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN339"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="../../include/storage/bufmgr.h.html#LN146"><span class='Ref_to_Macro'>BufferGetPageSize</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN338"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="sequence.c.html#LN60"><span class='Ref_to_Struct'>sequence_magic</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN340"><span class='Ref_To_Local'>sm</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="sequence.c.html#LN60"><span class='Ref_to_Struct'>sequence_magic</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/storage/bufpage.h.html#LN322"><span class='Ref_to_Macro'>PageGetSpecialPointer</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN339"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN340"><span class='Ref_To_Local'>sm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN62"><span class='Ref_to_Member'>magic</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN58"><span class='Ref_to_Const'>SEQ_MAGIC</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Now insert sequence tuple */ 
</span> 
    <a href="../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN338"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../../include/storage/bufmgr.h.html#LN88"><span class='Ref_to_Const'>BUFFER_LOCK_EXCLUSIVE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Since VACUUM does not process sequences, we have to force the tuple to 
     * have xmin = FrozenTransactionId now.  Otherwise it would become 
     * invisible to SELECTs after 2G transactions.  It is okay to do this 
     * because if the current transaction aborts, no other xact will ever 
     * examine the sequence tuple anyway. 
     */ 
</span>    <a href="../../include/access/htup_details.h.html#LN312"><span class='Ref_to_Macro'>HeapTupleHeaderSetXmin</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN336"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>, </span><a href="../../include/access/transam.h.html#LN32"><span class='Ref_to_Const'>FrozenTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/htup_details.h.html#LN345"><span class='Ref_to_Macro'>HeapTupleHeaderSetXminFrozen</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN336"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/htup_details.h.html#LN390"><span class='Ref_to_Macro'>HeapTupleHeaderSetCmin</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN336"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN412"><span class='Ref_to_Const'>FirstCommandId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/htup_details.h.html#LN373"><span class='Ref_to_Macro'>HeapTupleHeaderSetXmax</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN336"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>, </span><a href="../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN336"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>|= </span><a href="../../include/access/htup_details.h.html#LN192"><span class='Ref_to_Const'>HEAP_XMAX_INVALID</span></a><span class='Delimiter'>; 
</span>    <a href="../../include/storage/itemptr.h.html#LN103"><span class='Ref_to_Macro'>ItemPointerSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="sequence.c.html#LN336"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup_details.h.html#LN149"><span class='Ref_to_Member'>t_ctid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* check the comment above nextval_internal()'s equivalent call. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN505"><span class='Ref_to_Macro'>RelationNeedsWAL</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN336"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/access/xact.h.html#LN331"><span class='Ref_to_Proto'>GetTopTransactionId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/miscadmin.h.html#LN132"><span class='Ref_to_Macro'>START_CRIT_SECTION</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/storage/bufmgr.h.html#LN176"><span class='Ref_to_Proto'>MarkBufferDirty</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN338"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="sequence.c.html#LN341"><span class='Ref_To_Local'>offnum</span></a> <span class='Operator'>= </span><a href="../../include/storage/bufpage.h.html#LN412"><span class='Ref_to_Macro'>PageAddItem</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN339"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/storage/item.h.html#LN16"><span class='Ref_to_Typedef'>Item</span></a><span class='Parentheses'>) </span><a href="sequence.c.html#LN336"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN336"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a><span class='Delimiter'>, 
</span>                         <a href="../../include/storage/off.h.html#LN25"><span class='Ref_to_Const'>InvalidOffsetNumber</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN341"><span class='Ref_To_Local'>offnum</span></a> <span class='Operator'>!= </span><a href="../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Parentheses'>) 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"failed to add sequence tuple to page"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* XLOG stuff */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN505"><span class='Ref_to_Macro'>RelationNeedsWAL</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN336"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN388"></a>        <a href="../../include/commands/sequence.h.html#LN47"><span class='Ref_to_Struct'>xl_seq_rec</span></a>  <span class='Declare_Local'>xlrec</span><span class='Delimiter'>; 
</span><a name="LN389"></a>        <a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Local'>recptr</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/access/xloginsert.h.html#LN41"><span class='Ref_to_Proto'>XLogBeginInsert</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="../../include/access/xloginsert.h.html#LN46"><span class='Ref_to_Proto'>XLogRegisterBuffer</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="sequence.c.html#LN338"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../../include/access/xloginsert.h.html#LN31"><span class='Ref_to_Const'>REGBUF_WILL_INIT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="sequence.c.html#LN388"><span class='Ref_To_Local'>xlrec</span></a><span class='Operator'>.</span><a href="../../include/commands/sequence.h.html#LN49"><span class='Ref_to_Member'>node</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN336"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN84"><span class='Ref_to_Member'>rd_node</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../include/access/xloginsert.h.html#LN45"><span class='Ref_to_Proto'>XLogRegisterData</span></a><span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="sequence.c.html#LN388"><span class='Ref_To_Local'>xlrec</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/commands/sequence.h.html#LN47"><span class='Ref_to_Struct'>xl_seq_rec</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../include/access/xloginsert.h.html#LN45"><span class='Ref_to_Proto'>XLogRegisterData</span></a><span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="sequence.c.html#LN336"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN336"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="sequence.c.html#LN389"><span class='Ref_To_Local'>recptr</span></a> <span class='Operator'>= </span><a href="../../include/access/xloginsert.h.html#LN43"><span class='Ref_to_Proto'>XLogInsert</span></a><span class='Parentheses'>(</span>RM_SEQ_ID<span class='Delimiter'>, </span><a href="../../include/commands/sequence.h.html#LN45"><span class='Ref_to_Const'>XLOG_SEQ_LOG</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/storage/bufpage.h.html#LN364"><span class='Ref_to_Macro'>PageSetLSN</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN339"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN389"><span class='Ref_To_Local'>recptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/miscadmin.h.html#LN134"><span class='Ref_to_Macro'>END_CRIT_SECTION</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN338"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end fill_seq_with_data &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * AlterSequence 
 * 
 * Modify the definition of a sequence relation 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN415"></a><span class='Declare_Function'>AlterSequence</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2448"><span class='Ref_to_Struct'>AlterSeqStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN417"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span><span class='Delimiter'>; 
</span><a name="LN418"></a>    <a href="sequence.c.html#LN84"><span class='Ref_to_Typedef'>SeqTable</span></a>    <span class='Declare_Local'>elm</span><span class='Delimiter'>; 
</span><a name="LN419"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>seqrel</span><span class='Delimiter'>; 
</span><a name="LN420"></a>    <a href="../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN421"></a>    <a href="../../include/access/htup.h.html#LN61"><span class='Ref_to_Struct'>HeapTupleData</span></a> <span class='Declare_Local'>datatuple</span><span class='Delimiter'>; 
</span><a name="LN422"></a>    <a href="../../include/catalog/pg_sequence.h.html#LN19"><span class='Ref_to_Typedef'>Form_pg_sequence</span></a> <span class='Declare_Local'>seqform</span><span class='Delimiter'>; 
</span><a name="LN423"></a>    <a href="../../include/commands/sequence.h.html#LN31"><span class='Ref_to_Typedef'>Form_pg_sequence_data</span></a> <span class='Declare_Local'>newdataform</span><span class='Delimiter'>; 
</span><a name="LN424"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>need_seq_rewrite</span><span class='Delimiter'>; 
</span><a name="LN425"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>owned_by</span><span class='Delimiter'>; 
</span><a name="LN426"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span><a name="LN427"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN428"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>seqtuple</span><span class='Delimiter'>; 
</span><a name="LN429"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newdatatuple</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Open and lock sequence. */ 
</span>    <a href="sequence.c.html#LN417"><span class='Ref_To_Local'>relid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN52"><span class='Ref_to_Macro'>RangeVarGetRelid</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN415"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2451"><span class='Ref_to_Member'>sequence</span></a><span class='Delimiter'>, 
</span>                             <a href="../../include/storage/lockdefs.h.html#LN41"><span class='Ref_to_Const'>ShareRowExclusiveLock</span></a><span class='Delimiter'>, 
</span>                             <a href="sequence.c.html#LN415"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2454"><span class='Ref_to_Member'>missing_ok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN417"><span class='Ref_To_Local'>relid</span></a> <span class='Operator'>== </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"relation \"%s\" does not exist, skipping"</span><span class='Delimiter'>, 
</span>                        <a href="sequence.c.html#LN415"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2451"><span class='Ref_to_Member'>sequence</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../catalog/objectaddress.c.html#LN718"><span class='Ref_to_Global_Var'>InvalidObjectAddress</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="sequence.c.html#LN97"><span class='Ref_to_Proto'>init_sequence</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN417"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="sequence.c.html#LN418"><span class='Ref_To_Local'>elm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="sequence.c.html#LN419"><span class='Ref_To_Local'>seqrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* allow ALTER to sequence owner only */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN308"><span class='Ref_to_Proto'>pg_class_ownercheck</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN417"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN181"><span class='Ref_to_EnumConst'>ACL_KIND_CLASS</span></a><span class='Delimiter'>, 
</span>                       <a href="sequence.c.html#LN415"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2451"><span class='Ref_to_Member'>sequence</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="sequence.c.html#LN427"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_sequence.h.html#LN5"><span class='Ref_to_Const'>SequenceRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN428"><span class='Ref_To_Local'>seqtuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN87"><span class='Ref_to_EnumConst'>SEQRELID</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN417"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN428"><span class='Ref_To_Local'>seqtuple</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for sequence %u"</span><span class='Delimiter'>, 
</span>             <a href="sequence.c.html#LN417"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="sequence.c.html#LN422"><span class='Ref_To_Local'>seqform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_sequence.h.html#LN19"><span class='Ref_to_Typedef'>Form_pg_sequence</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN428"><span class='Ref_To_Local'>seqtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* lock page's buffer and read tuple into new sequence structure */ 
</span>    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="sequence.c.html#LN98"><span class='Ref_to_Proto'>read_seq_tuple</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN419"><span class='Ref_To_Local'>seqrel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="sequence.c.html#LN420"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="sequence.c.html#LN421"><span class='Ref_To_Local'>datatuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* copy the existing sequence data tuple, so it can be modified localy */ 
</span>    <a href="sequence.c.html#LN429"><span class='Ref_To_Local'>newdatatuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN606"><span class='Ref_to_Func'>heap_copytuple</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="sequence.c.html#LN421"><span class='Ref_To_Local'>datatuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN423"><span class='Ref_To_Local'>newdataform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/commands/sequence.h.html#LN31"><span class='Ref_to_Typedef'>Form_pg_sequence_data</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN429"><span class='Ref_To_Local'>newdatatuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN420"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check and set new values */ 
</span>    <a href="sequence.c.html#LN100"><span class='Ref_to_Proto'>init_params</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN415"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN415"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2452"><span class='Ref_to_Member'>options</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN415"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2453"><span class='Ref_to_Member'>for_identity</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                <a href="sequence.c.html#LN422"><span class='Ref_To_Local'>seqform</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN423"><span class='Ref_To_Local'>newdataform</span></a><span class='Delimiter'>, 
</span>                <span class='Operator'>&</span><a href="sequence.c.html#LN424"><span class='Ref_To_Local'>need_seq_rewrite</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="sequence.c.html#LN425"><span class='Ref_To_Local'>owned_by</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Clear local cache so that we don't think we have cached numbers */ 
</span>    <span class='Comment_Multi_Line'>/* Note that we do not change the currval() state */ 
</span>    <a href="sequence.c.html#LN418"><span class='Ref_To_Local'>elm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN78"><span class='Ref_to_Member'>cached</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN418"><span class='Ref_To_Local'>elm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN77"><span class='Ref_to_Member'>last</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If needed, rewrite the sequence relation itself */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN424"><span class='Ref_To_Local'>need_seq_rewrite</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* check the comment above nextval_internal()'s equivalent call. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN505"><span class='Ref_to_Macro'>RelationNeedsWAL</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN419"><span class='Ref_To_Local'>seqrel</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/access/xact.h.html#LN331"><span class='Ref_to_Proto'>GetTopTransactionId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Create a new storage file for the sequence, making the state 
         * changes transactional.  We want to keep the sequence's relfrozenxid 
         * at 0, since it won't contain any unfrozen XIDs.  Same with 
         * relminmxid, since a sequence will never contain multixacts. 
         */ 
</span>        <a href="../../include/utils/relcache.h.html#LN105"><span class='Ref_to_Proto'>RelationSetNewRelfilenode</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN419"><span class='Ref_To_Local'>seqrel</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN419"><span class='Ref_To_Local'>seqrel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpersistence<span class='Delimiter'>, 
</span>                                  <a href="../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Delimiter'>, </span><a href="../../include/access/multixact.h.html#LN22"><span class='Ref_to_Const'>InvalidMultiXactId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Insert the modified tuple into the new storage file. 
         */ 
</span>        <a href="sequence.c.html#LN94"><span class='Ref_to_Proto'>fill_seq_with_data</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN419"><span class='Ref_To_Local'>seqrel</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN429"><span class='Ref_To_Local'>newdatatuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if need_seq_rewrite &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* process OWNED BY if given */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN425"><span class='Ref_To_Local'>owned_by</span></a><span class='Parentheses'>) 
</span>        <a href="sequence.c.html#LN107"><span class='Ref_to_Proto'>process_owned_by</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN419"><span class='Ref_To_Local'>seqrel</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN425"><span class='Ref_To_Local'>owned_by</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN415"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2453"><span class='Ref_to_Member'>for_identity</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* update the pg_sequence tuple (we could skip this in some cases...) */ 
</span>    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN427"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="sequence.c.html#LN428"><span class='Ref_To_Local'>seqtuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN428"><span class='Ref_To_Local'>seqtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN417"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN426"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN417"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN427"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN419"><span class='Ref_To_Local'>seqrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="sequence.c.html#LN426"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterSequence &raquo; </span> 
 
<span class='Keyword'>void 
</span><a name="LN517"></a><span class='Declare_Function'>DeleteSequenceTuple</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN519"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN520"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
    <a href="sequence.c.html#LN519"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_sequence.h.html#LN5"><span class='Ref_to_Const'>SequenceRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="sequence.c.html#LN520"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN87"><span class='Ref_to_EnumConst'>SEQRELID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN517"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN520"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for sequence %u"</span><span class='Delimiter'>, </span><a href="sequence.c.html#LN517"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN40"><span class='Ref_to_Proto'>CatalogTupleDelete</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN519"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="sequence.c.html#LN520"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN520"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN519"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Note: nextval with a text argument is no longer exported as a pg_proc 
 * entry, but we keep it around to ease porting of C code that may have 
 * called the function directly. 
 */ 
</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN540"></a><span class='Declare_Function'>nextval</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN542"></a>    <a href="../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>seqin</span> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN543"></a>    <a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>sequence</span><span class='Delimiter'>; 
</span><a name="LN544"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span><span class='Delimiter'>; 
</span> 
    <a href="sequence.c.html#LN543"><span class='Ref_To_Local'>sequence</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN119"><span class='Ref_to_Proto'>makeRangeVarFromNameList</span></a><span class='Parentheses'>(</span><a href="../../include/utils/varlena.h.html#LN28"><span class='Ref_to_Proto'>textToQualifiedNameList</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN542"><span class='Ref_To_Local'>seqin</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * XXX: This is not safe in the presence of concurrent DDL, but acquiring 
     * a lock here is more expensive than letting nextval_internal do it, 
     * since the latter maintains a cache that keeps us from hitting the lock 
     * manager more than once per transaction.  It's not clear whether the 
     * performance penalty is material in practice, but for now, we do it this 
     * way. 
     */ 
</span>    <a href="sequence.c.html#LN544"><span class='Ref_To_Local'>relid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN52"><span class='Ref_to_Macro'>RangeVarGetRelid</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN543"><span class='Ref_To_Local'>sequence</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/fmgr.h.html#LN326"><span class='Ref_to_Macro'>PG_RETURN_INT64</span></a><span class='Parentheses'>(</span><a href="../../include/commands/sequence.h.html#LN53"><span class='Ref_to_Proto'>nextval_internal</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN544"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end nextval &raquo; </span> 
 
<a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN562"></a><span class='Declare_Function'>nextval_oid</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN564"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/fmgr.h.html#LN326"><span class='Ref_to_Macro'>PG_RETURN_INT64</span></a><span class='Parentheses'>(</span><a href="../../include/commands/sequence.h.html#LN53"><span class='Ref_to_Proto'>nextval_internal</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN564"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> 
<a name="LN570"></a><span class='Declare_Function'>nextval_internal</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>check_permissions</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN572"></a>    <a href="sequence.c.html#LN84"><span class='Ref_to_Typedef'>SeqTable</span></a>    <span class='Declare_Local'>elm</span><span class='Delimiter'>; 
</span><a name="LN573"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>seqrel</span><span class='Delimiter'>; 
</span><a name="LN574"></a>    <a href="../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN575"></a>    <a href="../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span><a name="LN576"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>pgstuple</span><span class='Delimiter'>; 
</span><a name="LN577"></a>    <a href="../../include/catalog/pg_sequence.h.html#LN19"><span class='Ref_to_Typedef'>Form_pg_sequence</span></a> <span class='Declare_Local'>pgsform</span><span class='Delimiter'>; 
</span><a name="LN578"></a>    <a href="../../include/access/htup.h.html#LN61"><span class='Ref_to_Struct'>HeapTupleData</span></a> <span class='Declare_Local'>seqdatatuple</span><span class='Delimiter'>; 
</span><a name="LN579"></a>    <a href="../../include/commands/sequence.h.html#LN31"><span class='Ref_to_Typedef'>Form_pg_sequence_data</span></a> <span class='Declare_Local'>seq</span><span class='Delimiter'>; 
</span><a name="LN580"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>incby</span><span class='Delimiter'>, 
</span><a name="LN581"></a>                <span class='Declare_Local'>maxv</span><span class='Delimiter'>, 
</span><a name="LN582"></a>                <span class='Declare_Local'>minv</span><span class='Delimiter'>, 
</span><a name="LN583"></a>                <span class='Declare_Local'>cache</span><span class='Delimiter'>, 
</span><a name="LN584"></a>                <span class='Declare_Local'>log</span><span class='Delimiter'>, 
</span><a name="LN585"></a>                <span class='Declare_Local'>fetch</span><span class='Delimiter'>, 
</span><a name="LN586"></a>                <span class='Declare_Local'>last</span><span class='Delimiter'>; 
</span><a name="LN587"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>, 
</span><a name="LN588"></a>                <span class='Declare_Local'>next</span><span class='Delimiter'>, 
</span><a name="LN589"></a>                <span class='Declare_Local'>rescnt</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN590"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>cycle</span><span class='Delimiter'>; 
</span><a name="LN591"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>logit</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* open and lock sequence */ 
</span>    <a href="sequence.c.html#LN97"><span class='Ref_to_Proto'>init_sequence</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN570"><span class='Ref_to_Parameter'>relid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="sequence.c.html#LN572"><span class='Ref_To_Local'>elm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="sequence.c.html#LN573"><span class='Ref_To_Local'>seqrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN570"><span class='Ref_to_Parameter'>check_permissions</span></a> <span class='Operator'>&& 
</span>        <a href="../../include/utils/acl.h.html#LN283"><span class='Ref_to_Proto'>pg_class_aclcheck</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN572"><span class='Ref_To_Local'>elm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN73"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                          <a href="../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a> <span class='Operator'>| </span><a href="../../include/nodes/parsenodes.h.html#LN73"><span class='Ref_to_Const'>ACL_UPDATE</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied for sequence %s"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN573"><span class='Ref_To_Local'>seqrel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* read-only transactions may only modify temp sequences */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="sequence.c.html#LN573"><span class='Ref_To_Local'>seqrel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN89"><span class='Ref_to_Member'>rd_islocaltemp</span></a><span class='Parentheses'>) 
</span>        <a href="../tcop/utility.c.html#LN234"><span class='Ref_to_Func'>PreventCommandIfReadOnly</span></a><span class='Parentheses'>(</span><span class='String'>"nextval()"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Forbid this during parallel operation because, to make it work, the 
     * cooperating backends would need to share the backend-local cached 
     * sequence information.  Currently, we don't support that. 
     */ 
</span>    <a href="../tcop/utility.c.html#LN252"><span class='Ref_to_Func'>PreventCommandIfParallelMode</span></a><span class='Parentheses'>(</span><span class='String'>"nextval()"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN572"><span class='Ref_To_Local'>elm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN77"><span class='Ref_to_Member'>last</span></a> <span class='Operator'>!= </span><a href="sequence.c.html#LN572"><span class='Ref_To_Local'>elm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN78"><span class='Ref_to_Member'>cached</span></a><span class='Parentheses'>)</span>       <span class='Comment_Single_Line'>/* some numbers were cached */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="sequence.c.html#LN572"><span class='Ref_To_Local'>elm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN76"><span class='Ref_to_Member'>last_valid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="sequence.c.html#LN572"><span class='Ref_To_Local'>elm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN80"><span class='Ref_to_Member'>increment</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN572"><span class='Ref_To_Local'>elm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN77"><span class='Ref_to_Member'>last</span></a> <span class='Operator'>+= </span><a href="sequence.c.html#LN572"><span class='Ref_To_Local'>elm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN80"><span class='Ref_to_Member'>increment</span></a><span class='Delimiter'>; 
</span>        <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN573"><span class='Ref_To_Local'>seqrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN92"><span class='Ref_to_Global_Var'>last_used_seq</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN572"><span class='Ref_To_Local'>elm</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="sequence.c.html#LN572"><span class='Ref_To_Local'>elm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN77"><span class='Ref_to_Member'>last</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="sequence.c.html#LN576"><span class='Ref_To_Local'>pgstuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN87"><span class='Ref_to_EnumConst'>SEQRELID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN570"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN576"><span class='Ref_To_Local'>pgstuple</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for sequence %u"</span><span class='Delimiter'>, </span><a href="sequence.c.html#LN570"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN577"><span class='Ref_To_Local'>pgsform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_sequence.h.html#LN19"><span class='Ref_to_Typedef'>Form_pg_sequence</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN576"><span class='Ref_To_Local'>pgstuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN580"><span class='Ref_To_Local'>incby</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN577"><span class='Ref_To_Local'>pgsform</span></a><span class='Operator'>-&GT;</span>seqincrement<span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN581"><span class='Ref_To_Local'>maxv</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN577"><span class='Ref_To_Local'>pgsform</span></a><span class='Operator'>-&GT;</span>seqmax<span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN582"><span class='Ref_To_Local'>minv</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN577"><span class='Ref_To_Local'>pgsform</span></a><span class='Operator'>-&GT;</span>seqmin<span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN583"><span class='Ref_To_Local'>cache</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN577"><span class='Ref_To_Local'>pgsform</span></a><span class='Operator'>-&GT;</span>seqcache<span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN590"><span class='Ref_To_Local'>cycle</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN577"><span class='Ref_To_Local'>pgsform</span></a><span class='Operator'>-&GT;</span>seqcycle<span class='Delimiter'>; 
</span>    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN576"><span class='Ref_To_Local'>pgstuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* lock page' buffer and read tuple */ 
</span>    <a href="sequence.c.html#LN579"><span class='Ref_To_Local'>seq</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN98"><span class='Ref_to_Proto'>read_seq_tuple</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN573"><span class='Ref_To_Local'>seqrel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="sequence.c.html#LN574"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="sequence.c.html#LN578"><span class='Ref_To_Local'>seqdatatuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN575"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN574"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="sequence.c.html#LN572"><span class='Ref_To_Local'>elm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN80"><span class='Ref_to_Member'>increment</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN580"><span class='Ref_To_Local'>incby</span></a><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN586"><span class='Ref_To_Local'>last</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN588"><span class='Ref_To_Local'>next</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN587"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN579"><span class='Ref_To_Local'>seq</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/sequence.h.html#LN26"><span class='Ref_to_Member'>last_value</span></a><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN585"><span class='Ref_To_Local'>fetch</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN583"><span class='Ref_To_Local'>cache</span></a><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN584"><span class='Ref_To_Local'>log</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN579"><span class='Ref_To_Local'>seq</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/sequence.h.html#LN27"><span class='Ref_to_Member'>log_cnt</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="sequence.c.html#LN579"><span class='Ref_To_Local'>seq</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/sequence.h.html#LN28"><span class='Ref_to_Member'>is_called</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="sequence.c.html#LN589"><span class='Ref_To_Local'>rescnt</span></a><span class='Operator'>++</span><span class='Delimiter'>;</span>               <span class='Comment_Single_Line'>/* return last_value if not is_called */ 
</span>        <a href="sequence.c.html#LN585"><span class='Ref_To_Local'>fetch</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Decide whether we should emit a WAL log record.  If so, force up the 
     * fetch count to grab SEQ_LOG_VALS more values than we actually need to 
     * cache.  (These will then be usable without logging.) 
     * 
     * If this is the first nextval after a checkpoint, we must force a new 
     * WAL record to be written anyway, else replay starting from the 
     * checkpoint would fail to advance the sequence past the logged values. 
     * In this case we may as well fetch extra values. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN584"><span class='Ref_To_Local'>log</span></a> <span class='Operator'>&LT; </span><a href="sequence.c.html#LN585"><span class='Ref_To_Local'>fetch</span></a> <span class='Operator'>|| !</span><a href="sequence.c.html#LN579"><span class='Ref_To_Local'>seq</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/sequence.h.html#LN28"><span class='Ref_to_Member'>is_called</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* forced log to satisfy local demand for values */ 
</span>        <a href="sequence.c.html#LN585"><span class='Ref_To_Local'>fetch</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN584"><span class='Ref_To_Local'>log</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN585"><span class='Ref_To_Local'>fetch</span></a> <span class='Operator'>+ </span><a href="sequence.c.html#LN53"><span class='Ref_to_Const'>SEQ_LOG_VALS</span></a><span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN591"><span class='Ref_To_Local'>logit</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN669"></a>        <a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Local'>redoptr</span> <span class='Operator'>= </span><a href="../../include/access/xlog.h.html#LN273"><span class='Ref_to_Proto'>GetRedoRecPtr</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/storage/bufpage.h.html#LN362"><span class='Ref_to_Macro'>PageGetLSN</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN575"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><a href="sequence.c.html#LN669"><span class='Ref_To_Local'>redoptr</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* last update of seq was before checkpoint */ 
</span>            <a href="sequence.c.html#LN585"><span class='Ref_To_Local'>fetch</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN584"><span class='Ref_To_Local'>log</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN585"><span class='Ref_To_Local'>fetch</span></a> <span class='Operator'>+ </span><a href="sequence.c.html#LN53"><span class='Ref_to_Const'>SEQ_LOG_VALS</span></a><span class='Delimiter'>; 
</span>            <a href="sequence.c.html#LN591"><span class='Ref_To_Local'>logit</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN585"><span class='Ref_To_Local'>fetch</span></a><span class='Parentheses'>)</span>               <span class='Comment_Single_Line'>/* try to fetch cache [+ log ] numbers */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Check MAXVALUE for ascending sequences and MINVALUE for descending 
         * sequences 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN580"><span class='Ref_To_Local'>incby</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* ascending sequence */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="sequence.c.html#LN581"><span class='Ref_To_Local'>maxv</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="sequence.c.html#LN588"><span class='Ref_To_Local'>next</span></a> <span class='Operator'>&GT; </span><a href="sequence.c.html#LN581"><span class='Ref_To_Local'>maxv</span></a> <span class='Operator'>- </span><a href="sequence.c.html#LN580"><span class='Ref_To_Local'>incby</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>                <span class='Parentheses'>(</span><a href="sequence.c.html#LN581"><span class='Ref_To_Local'>maxv</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="sequence.c.html#LN588"><span class='Ref_To_Local'>next</span></a> <span class='Operator'>+ </span><a href="sequence.c.html#LN580"><span class='Ref_To_Local'>incby</span></a> <span class='Operator'>&GT; </span><a href="sequence.c.html#LN581"><span class='Ref_To_Local'>maxv</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN589"><span class='Ref_To_Local'>rescnt</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <span class='Control'>break</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* stop fetching */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="sequence.c.html#LN590"><span class='Ref_To_Local'>cycle</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN695"></a>                    <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><span class='Number'>100</span><span class='Delimiter'>]; 
</span> 
                    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN695"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="sequence.c.html#LN695"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN581"><span class='Ref_To_Local'>maxv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                         <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SEQUENCE_GENERATOR_LIMIT_EXCEEDED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                          <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"nextval: reached maximum value of sequence \"%s\" (%s)"</span><span class='Delimiter'>, 
</span>                                 <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN573"><span class='Ref_To_Local'>seqrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="sequence.c.html#LN695"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="sequence.c.html#LN588"><span class='Ref_To_Local'>next</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN582"><span class='Ref_To_Local'>minv</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
                <a href="sequence.c.html#LN588"><span class='Ref_To_Local'>next</span></a> <span class='Operator'>+= </span><a href="sequence.c.html#LN580"><span class='Ref_To_Local'>incby</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if incby&GT;0 &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* descending sequence */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="sequence.c.html#LN582"><span class='Ref_To_Local'>minv</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="sequence.c.html#LN588"><span class='Ref_To_Local'>next</span></a> <span class='Operator'>&LT; </span><a href="sequence.c.html#LN582"><span class='Ref_To_Local'>minv</span></a> <span class='Operator'>- </span><a href="sequence.c.html#LN580"><span class='Ref_To_Local'>incby</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>                <span class='Parentheses'>(</span><a href="sequence.c.html#LN582"><span class='Ref_To_Local'>minv</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="sequence.c.html#LN588"><span class='Ref_To_Local'>next</span></a> <span class='Operator'>+ </span><a href="sequence.c.html#LN580"><span class='Ref_To_Local'>incby</span></a> <span class='Operator'>&LT; </span><a href="sequence.c.html#LN582"><span class='Ref_To_Local'>minv</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN589"><span class='Ref_To_Local'>rescnt</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <span class='Control'>break</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* stop fetching */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="sequence.c.html#LN590"><span class='Ref_To_Local'>cycle</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN718"></a>                    <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><span class='Number'>100</span><span class='Delimiter'>]; 
</span> 
                    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN718"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="sequence.c.html#LN718"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN582"><span class='Ref_To_Local'>minv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                         <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SEQUENCE_GENERATOR_LIMIT_EXCEEDED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                          <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"nextval: reached minimum value of sequence \"%s\" (%s)"</span><span class='Delimiter'>, 
</span>                                 <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN573"><span class='Ref_To_Local'>seqrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="sequence.c.html#LN718"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="sequence.c.html#LN588"><span class='Ref_To_Local'>next</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN581"><span class='Ref_To_Local'>maxv</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
                <a href="sequence.c.html#LN588"><span class='Ref_To_Local'>next</span></a> <span class='Operator'>+= </span><a href="sequence.c.html#LN580"><span class='Ref_To_Local'>incby</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
        <a href="sequence.c.html#LN585"><span class='Ref_To_Local'>fetch</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN589"><span class='Ref_To_Local'>rescnt</span></a> <span class='Operator'>&LT; </span><a href="sequence.c.html#LN583"><span class='Ref_To_Local'>cache</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="sequence.c.html#LN584"><span class='Ref_To_Local'>log</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>            <a href="sequence.c.html#LN589"><span class='Ref_To_Local'>rescnt</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <a href="sequence.c.html#LN586"><span class='Ref_To_Local'>last</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN588"><span class='Ref_To_Local'>next</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN589"><span class='Ref_To_Local'>rescnt</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span>    <span class='Comment_Single_Line'>/* if it's first result - */ 
</span>                <a href="sequence.c.html#LN587"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN588"><span class='Ref_To_Local'>next</span></a><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* it's what to return */ 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while fetch &raquo; </span> 
 
    <a href="sequence.c.html#LN584"><span class='Ref_To_Local'>log</span></a> <span class='Operator'>-= </span><a href="sequence.c.html#LN585"><span class='Ref_To_Local'>fetch</span></a><span class='Delimiter'>;</span>               <span class='Comment_Single_Line'>/* adjust for any unfetched numbers */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="sequence.c.html#LN584"><span class='Ref_To_Local'>log</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* save info in local cache */ 
</span>    <a href="sequence.c.html#LN572"><span class='Ref_To_Local'>elm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN77"><span class='Ref_to_Member'>last</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN587"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* last returned number */ 
</span>    <a href="sequence.c.html#LN572"><span class='Ref_To_Local'>elm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN78"><span class='Ref_to_Member'>cached</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN586"><span class='Ref_To_Local'>last</span></a><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* last fetched number */ 
</span>    <a href="sequence.c.html#LN572"><span class='Ref_To_Local'>elm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN76"><span class='Ref_to_Member'>last_valid</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="sequence.c.html#LN92"><span class='Ref_to_Global_Var'>last_used_seq</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN572"><span class='Ref_To_Local'>elm</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If something needs to be WAL logged, acquire an xid, so this 
     * transaction's commit will trigger a WAL flush and wait for syncrep. 
     * It's sufficient to ensure the toplevel transaction has an xid, no need 
     * to assign xids subxacts, that'll already trigger an appropriate wait. 
     * (Have to do that here, so we're outside the critical section) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN591"><span class='Ref_To_Local'>logit</span></a> <span class='Operator'>&& </span><a href="../../include/utils/rel.h.html#LN505"><span class='Ref_to_Macro'>RelationNeedsWAL</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN573"><span class='Ref_To_Local'>seqrel</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/access/xact.h.html#LN331"><span class='Ref_to_Proto'>GetTopTransactionId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* ready to change the on-disk (or really, in-buffer) tuple */ 
</span>    <a href="../../include/miscadmin.h.html#LN132"><span class='Ref_to_Macro'>START_CRIT_SECTION</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We must mark the buffer dirty before doing XLogInsert(); see notes in 
     * SyncOneBuffer().  However, we don't apply the desired changes just yet. 
     * This looks like a violation of the buffer update protocol, but it is in 
     * fact safe because we hold exclusive lock on the buffer.  Any other 
     * process, including a checkpoint, that tries to examine the buffer 
     * contents will block until we release the lock, and then will see the 
     * final state that we install below. 
     */ 
</span>    <a href="../../include/storage/bufmgr.h.html#LN176"><span class='Ref_to_Proto'>MarkBufferDirty</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN574"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* XLOG stuff */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN591"><span class='Ref_To_Local'>logit</span></a> <span class='Operator'>&& </span><a href="../../include/utils/rel.h.html#LN505"><span class='Ref_to_Macro'>RelationNeedsWAL</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN573"><span class='Ref_To_Local'>seqrel</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN779"></a>        <a href="../../include/commands/sequence.h.html#LN47"><span class='Ref_to_Struct'>xl_seq_rec</span></a>  <span class='Declare_Local'>xlrec</span><span class='Delimiter'>; 
</span><a name="LN780"></a>        <a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Local'>recptr</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We don't log the current state of the tuple, but rather the state 
         * as it would appear after "log" more fetches.  This lets us skip 
         * that many future WAL records, at the cost that we lose those 
         * sequence values if we crash. 
         */ 
</span>        <a href="../../include/access/xloginsert.h.html#LN41"><span class='Ref_to_Proto'>XLogBeginInsert</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="../../include/access/xloginsert.h.html#LN46"><span class='Ref_to_Proto'>XLogRegisterBuffer</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="sequence.c.html#LN574"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../../include/access/xloginsert.h.html#LN31"><span class='Ref_to_Const'>REGBUF_WILL_INIT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* set values that will be saved in xlog */ 
</span>        <a href="sequence.c.html#LN579"><span class='Ref_To_Local'>seq</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/sequence.h.html#LN26"><span class='Ref_to_Member'>last_value</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN588"><span class='Ref_To_Local'>next</span></a><span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN579"><span class='Ref_To_Local'>seq</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/sequence.h.html#LN28"><span class='Ref_to_Member'>is_called</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN579"><span class='Ref_To_Local'>seq</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/sequence.h.html#LN27"><span class='Ref_to_Member'>log_cnt</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <a href="sequence.c.html#LN779"><span class='Ref_To_Local'>xlrec</span></a><span class='Operator'>.</span><a href="../../include/commands/sequence.h.html#LN49"><span class='Ref_to_Member'>node</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN573"><span class='Ref_To_Local'>seqrel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN84"><span class='Ref_to_Member'>rd_node</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../include/access/xloginsert.h.html#LN45"><span class='Ref_to_Proto'>XLogRegisterData</span></a><span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="sequence.c.html#LN779"><span class='Ref_To_Local'>xlrec</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/commands/sequence.h.html#LN47"><span class='Ref_to_Struct'>xl_seq_rec</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../include/access/xloginsert.h.html#LN45"><span class='Ref_to_Proto'>XLogRegisterData</span></a><span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="sequence.c.html#LN578"><span class='Ref_To_Local'>seqdatatuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN578"><span class='Ref_To_Local'>seqdatatuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="sequence.c.html#LN780"><span class='Ref_To_Local'>recptr</span></a> <span class='Operator'>= </span><a href="../../include/access/xloginsert.h.html#LN43"><span class='Ref_to_Proto'>XLogInsert</span></a><span class='Parentheses'>(</span>RM_SEQ_ID<span class='Delimiter'>, </span><a href="../../include/commands/sequence.h.html#LN45"><span class='Ref_to_Const'>XLOG_SEQ_LOG</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/storage/bufpage.h.html#LN364"><span class='Ref_to_Macro'>PageSetLSN</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN575"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN780"><span class='Ref_To_Local'>recptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if logit&&RelationNeedsW... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Now update sequence tuple to the intended final state */ 
</span>    <a href="sequence.c.html#LN579"><span class='Ref_To_Local'>seq</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/sequence.h.html#LN26"><span class='Ref_to_Member'>last_value</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN586"><span class='Ref_To_Local'>last</span></a><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* last fetched number */ 
</span>    <a href="sequence.c.html#LN579"><span class='Ref_To_Local'>seq</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/sequence.h.html#LN28"><span class='Ref_to_Member'>is_called</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN579"><span class='Ref_To_Local'>seq</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/sequence.h.html#LN27"><span class='Ref_to_Member'>log_cnt</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN584"><span class='Ref_To_Local'>log</span></a><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* how much is logged */ 
</span> 
    <a href="../../include/miscadmin.h.html#LN134"><span class='Ref_to_Macro'>END_CRIT_SECTION</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN574"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN573"><span class='Ref_To_Local'>seqrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="sequence.c.html#LN587"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end nextval_internal &raquo; </span> 
 
<a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN821"></a><span class='Declare_Function'>currval_oid</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN823"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN824"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN825"></a>    <a href="sequence.c.html#LN84"><span class='Ref_to_Typedef'>SeqTable</span></a>    <span class='Declare_Local'>elm</span><span class='Delimiter'>; 
</span><a name="LN826"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>seqrel</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* open and lock sequence */ 
</span>    <a href="sequence.c.html#LN97"><span class='Ref_to_Proto'>init_sequence</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN823"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="sequence.c.html#LN825"><span class='Ref_To_Local'>elm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="sequence.c.html#LN826"><span class='Ref_To_Local'>seqrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN283"><span class='Ref_to_Proto'>pg_class_aclcheck</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN825"><span class='Ref_To_Local'>elm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN73"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                          <a href="../../include/nodes/parsenodes.h.html#LN72"><span class='Ref_to_Const'>ACL_SELECT</span></a> <span class='Operator'>| </span><a href="../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied for sequence %s"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN826"><span class='Ref_To_Local'>seqrel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="sequence.c.html#LN825"><span class='Ref_To_Local'>elm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN76"><span class='Ref_to_Member'>last_valid</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"currval of sequence \"%s\" is not yet defined in this session"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN826"><span class='Ref_To_Local'>seqrel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <a href="sequence.c.html#LN824"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN825"><span class='Ref_To_Local'>elm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN77"><span class='Ref_to_Member'>last</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN826"><span class='Ref_To_Local'>seqrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/fmgr.h.html#LN326"><span class='Ref_to_Macro'>PG_RETURN_INT64</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN824"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end currval_oid &raquo; </span> 
 
<a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN852"></a><span class='Declare_Function'>lastval</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN854"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>seqrel</span><span class='Delimiter'>; 
</span><a name="LN855"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN92"><span class='Ref_to_Global_Var'>last_used_seq</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"lastval is not yet defined in this session"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Someone may have dropped the sequence since the last nextval() */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/syscache.h.html#LN173"><span class='Ref_to_Macro'>SearchSysCacheExists1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN92"><span class='Ref_to_Global_Var'>last_used_seq</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN73"><span class='Ref_to_Member'>relid</span></a><span class='Parentheses'>)))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"lastval is not yet defined in this session"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="sequence.c.html#LN854"><span class='Ref_To_Local'>seqrel</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN95"><span class='Ref_to_Proto'>lock_and_open_sequence</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN92"><span class='Ref_to_Global_Var'>last_used_seq</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* nextval() must have already been called for this sequence */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="sequence.c.html#LN92"><span class='Ref_to_Global_Var'>last_used_seq</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN76"><span class='Ref_to_Member'>last_valid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN283"><span class='Ref_to_Proto'>pg_class_aclcheck</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN92"><span class='Ref_to_Global_Var'>last_used_seq</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN73"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                          <a href="../../include/nodes/parsenodes.h.html#LN72"><span class='Ref_to_Const'>ACL_SELECT</span></a> <span class='Operator'>| </span><a href="../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied for sequence %s"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN854"><span class='Ref_To_Local'>seqrel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <a href="sequence.c.html#LN855"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN92"><span class='Ref_to_Global_Var'>last_used_seq</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN77"><span class='Ref_to_Member'>last</span></a><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN854"><span class='Ref_To_Local'>seqrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/fmgr.h.html#LN326"><span class='Ref_to_Macro'>PG_RETURN_INT64</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN855"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end lastval &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Main internal procedure that handles 2 & 3 arg forms of SETVAL. 
 * 
 * Note that the 3 arg version (which sets the is_called flag) is 
 * only for use in pg_dump, and setting the is_called flag may not 
 * work if multiple users are attached to the database and referencing 
 * the sequence (unlikely if pg_dump is restoring it). 
 * 
 * It is necessary to have the 3 arg version so that pg_dump can 
 * restore the state of a sequence exactly during data-only restores - 
 * it is the only way to clear the is_called flag in an existing 
 * sequence. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN900"></a><span class='Declare_Function'>do_setval</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Declare_Parameter'>next</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>iscalled</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN902"></a>    <a href="sequence.c.html#LN84"><span class='Ref_to_Typedef'>SeqTable</span></a>    <span class='Declare_Local'>elm</span><span class='Delimiter'>; 
</span><a name="LN903"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>seqrel</span><span class='Delimiter'>; 
</span><a name="LN904"></a>    <a href="../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN905"></a>    <a href="../../include/access/htup.h.html#LN61"><span class='Ref_to_Struct'>HeapTupleData</span></a> <span class='Declare_Local'>seqdatatuple</span><span class='Delimiter'>; 
</span><a name="LN906"></a>    <a href="../../include/commands/sequence.h.html#LN31"><span class='Ref_to_Typedef'>Form_pg_sequence_data</span></a> <span class='Declare_Local'>seq</span><span class='Delimiter'>; 
</span><a name="LN907"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>pgstuple</span><span class='Delimiter'>; 
</span><a name="LN908"></a>    <a href="../../include/catalog/pg_sequence.h.html#LN19"><span class='Ref_to_Typedef'>Form_pg_sequence</span></a> <span class='Declare_Local'>pgsform</span><span class='Delimiter'>; 
</span><a name="LN909"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>maxv</span><span class='Delimiter'>, 
</span><a name="LN910"></a>                <span class='Declare_Local'>minv</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* open and lock sequence */ 
</span>    <a href="sequence.c.html#LN97"><span class='Ref_to_Proto'>init_sequence</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN900"><span class='Ref_to_Parameter'>relid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="sequence.c.html#LN902"><span class='Ref_To_Local'>elm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="sequence.c.html#LN903"><span class='Ref_To_Local'>seqrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN283"><span class='Ref_to_Proto'>pg_class_aclcheck</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN902"><span class='Ref_To_Local'>elm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN73"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN73"><span class='Ref_to_Const'>ACL_UPDATE</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied for sequence %s"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN903"><span class='Ref_To_Local'>seqrel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <a href="sequence.c.html#LN907"><span class='Ref_To_Local'>pgstuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN87"><span class='Ref_to_EnumConst'>SEQRELID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN900"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN907"><span class='Ref_To_Local'>pgstuple</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for sequence %u"</span><span class='Delimiter'>, </span><a href="sequence.c.html#LN900"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN908"><span class='Ref_To_Local'>pgsform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_sequence.h.html#LN19"><span class='Ref_to_Typedef'>Form_pg_sequence</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN907"><span class='Ref_To_Local'>pgstuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN909"><span class='Ref_To_Local'>maxv</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN908"><span class='Ref_To_Local'>pgsform</span></a><span class='Operator'>-&GT;</span>seqmax<span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN910"><span class='Ref_To_Local'>minv</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN908"><span class='Ref_To_Local'>pgsform</span></a><span class='Operator'>-&GT;</span>seqmin<span class='Delimiter'>; 
</span>    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN907"><span class='Ref_To_Local'>pgstuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* read-only transactions may only modify temp sequences */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="sequence.c.html#LN903"><span class='Ref_To_Local'>seqrel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN89"><span class='Ref_to_Member'>rd_islocaltemp</span></a><span class='Parentheses'>) 
</span>        <a href="../tcop/utility.c.html#LN234"><span class='Ref_to_Func'>PreventCommandIfReadOnly</span></a><span class='Parentheses'>(</span><span class='String'>"setval()"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Forbid this during parallel operation because, to make it work, the 
     * cooperating backends would need to share the backend-local cached 
     * sequence information.  Currently, we don't support that. 
     */ 
</span>    <a href="../tcop/utility.c.html#LN252"><span class='Ref_to_Func'>PreventCommandIfParallelMode</span></a><span class='Parentheses'>(</span><span class='String'>"setval()"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* lock page' buffer and read tuple */ 
</span>    <a href="sequence.c.html#LN906"><span class='Ref_To_Local'>seq</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN98"><span class='Ref_to_Proto'>read_seq_tuple</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN903"><span class='Ref_To_Local'>seqrel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="sequence.c.html#LN904"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="sequence.c.html#LN905"><span class='Ref_To_Local'>seqdatatuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="sequence.c.html#LN900"><span class='Ref_to_Parameter'>next</span></a> <span class='Operator'>&LT; </span><a href="sequence.c.html#LN910"><span class='Ref_To_Local'>minv</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="sequence.c.html#LN900"><span class='Ref_to_Parameter'>next</span></a> <span class='Operator'>&GT; </span><a href="sequence.c.html#LN909"><span class='Ref_To_Local'>maxv</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN945"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>bufv</span><span class='Delimiter'>[</span><span class='Number'>100</span><span class='Delimiter'>], 
</span><a name="LN946"></a>                    <span class='Declare_Local'>bufm</span><span class='Delimiter'>[</span><span class='Number'>100</span><span class='Delimiter'>], 
</span><a name="LN947"></a>                    <span class='Declare_Local'>bufx</span><span class='Delimiter'>[</span><span class='Number'>100</span><span class='Delimiter'>]; 
</span> 
        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN945"><span class='Ref_To_Local'>bufv</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="sequence.c.html#LN945"><span class='Ref_To_Local'>bufv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN900"><span class='Ref_to_Parameter'>next</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN946"><span class='Ref_To_Local'>bufm</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="sequence.c.html#LN946"><span class='Ref_To_Local'>bufm</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN910"><span class='Ref_To_Local'>minv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN947"><span class='Ref_To_Local'>bufx</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="sequence.c.html#LN947"><span class='Ref_To_Local'>bufx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN909"><span class='Ref_To_Local'>maxv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NUMERIC_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"setval: value %s is out of bounds for sequence \"%s\" (%s..%s)"</span><span class='Delimiter'>, 
</span>                        <a href="sequence.c.html#LN945"><span class='Ref_To_Local'>bufv</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN903"><span class='Ref_To_Local'>seqrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="sequence.c.html#LN946"><span class='Ref_To_Local'>bufm</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN947"><span class='Ref_To_Local'>bufx</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Set the currval() state only if iscalled = true */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN900"><span class='Ref_to_Parameter'>iscalled</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="sequence.c.html#LN902"><span class='Ref_To_Local'>elm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN77"><span class='Ref_to_Member'>last</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN900"><span class='Ref_to_Parameter'>next</span></a><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* last returned number */ 
</span>        <a href="sequence.c.html#LN902"><span class='Ref_To_Local'>elm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN76"><span class='Ref_to_Member'>last_valid</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* In any case, forget any future cached numbers */ 
</span>    <a href="sequence.c.html#LN902"><span class='Ref_To_Local'>elm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN78"><span class='Ref_to_Member'>cached</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN902"><span class='Ref_To_Local'>elm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN77"><span class='Ref_to_Member'>last</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* check the comment above nextval_internal()'s equivalent call. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN505"><span class='Ref_to_Macro'>RelationNeedsWAL</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN903"><span class='Ref_To_Local'>seqrel</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/access/xact.h.html#LN331"><span class='Ref_to_Proto'>GetTopTransactionId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* ready to change the on-disk (or really, in-buffer) tuple */ 
</span>    <a href="../../include/miscadmin.h.html#LN132"><span class='Ref_to_Macro'>START_CRIT_SECTION</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="sequence.c.html#LN906"><span class='Ref_To_Local'>seq</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/sequence.h.html#LN26"><span class='Ref_to_Member'>last_value</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN900"><span class='Ref_to_Parameter'>next</span></a><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* last fetched number */ 
</span>    <a href="sequence.c.html#LN906"><span class='Ref_To_Local'>seq</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/sequence.h.html#LN28"><span class='Ref_to_Member'>is_called</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN900"><span class='Ref_to_Parameter'>iscalled</span></a><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN906"><span class='Ref_To_Local'>seq</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/sequence.h.html#LN27"><span class='Ref_to_Member'>log_cnt</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/storage/bufmgr.h.html#LN176"><span class='Ref_to_Proto'>MarkBufferDirty</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN904"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* XLOG stuff */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN505"><span class='Ref_to_Macro'>RelationNeedsWAL</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN903"><span class='Ref_To_Local'>seqrel</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN985"></a>        <a href="../../include/commands/sequence.h.html#LN47"><span class='Ref_to_Struct'>xl_seq_rec</span></a>  <span class='Declare_Local'>xlrec</span><span class='Delimiter'>; 
</span><a name="LN986"></a>        <a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Local'>recptr</span><span class='Delimiter'>; 
</span><a name="LN987"></a>        <a href="../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span> <span class='Operator'>= </span><a href="../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN904"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/access/xloginsert.h.html#LN41"><span class='Ref_to_Proto'>XLogBeginInsert</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="../../include/access/xloginsert.h.html#LN46"><span class='Ref_to_Proto'>XLogRegisterBuffer</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="sequence.c.html#LN904"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../../include/access/xloginsert.h.html#LN31"><span class='Ref_to_Const'>REGBUF_WILL_INIT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="sequence.c.html#LN985"><span class='Ref_To_Local'>xlrec</span></a><span class='Operator'>.</span><a href="../../include/commands/sequence.h.html#LN49"><span class='Ref_to_Member'>node</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN903"><span class='Ref_To_Local'>seqrel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN84"><span class='Ref_to_Member'>rd_node</span></a><span class='Delimiter'>; 
</span>        <a href="../../include/access/xloginsert.h.html#LN45"><span class='Ref_to_Proto'>XLogRegisterData</span></a><span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="sequence.c.html#LN985"><span class='Ref_To_Local'>xlrec</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/commands/sequence.h.html#LN47"><span class='Ref_to_Struct'>xl_seq_rec</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../include/access/xloginsert.h.html#LN45"><span class='Ref_to_Proto'>XLogRegisterData</span></a><span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="sequence.c.html#LN905"><span class='Ref_To_Local'>seqdatatuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN905"><span class='Ref_To_Local'>seqdatatuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="sequence.c.html#LN986"><span class='Ref_To_Local'>recptr</span></a> <span class='Operator'>= </span><a href="../../include/access/xloginsert.h.html#LN43"><span class='Ref_to_Proto'>XLogInsert</span></a><span class='Parentheses'>(</span>RM_SEQ_ID<span class='Delimiter'>, </span><a href="../../include/commands/sequence.h.html#LN45"><span class='Ref_to_Const'>XLOG_SEQ_LOG</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/storage/bufpage.h.html#LN364"><span class='Ref_to_Macro'>PageSetLSN</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN987"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN986"><span class='Ref_To_Local'>recptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/miscadmin.h.html#LN134"><span class='Ref_to_Macro'>END_CRIT_SECTION</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN904"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN903"><span class='Ref_To_Local'>seqrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end do_setval &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Implement the 2 arg setval procedure. 
 * See do_setval for discussion. 
 */ 
</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1013"></a><span class='Declare_Function'>setval_oid</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1015"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1016"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>next</span> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN246"><span class='Ref_to_Macro'>PG_GETARG_INT64</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="sequence.c.html#LN106"><span class='Ref_to_Proto'>do_setval</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1015"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1016"><span class='Ref_To_Local'>next</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/fmgr.h.html#LN326"><span class='Ref_to_Macro'>PG_RETURN_INT64</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1016"><span class='Ref_To_Local'>next</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Implement the 3 arg setval procedure. 
 * See do_setval for discussion. 
 */ 
</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1028"></a><span class='Declare_Function'>setval3_oid</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1030"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1031"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>next</span> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN246"><span class='Ref_to_Macro'>PG_GETARG_INT64</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1032"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>iscalled</span> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="sequence.c.html#LN106"><span class='Ref_to_Proto'>do_setval</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1030"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1031"><span class='Ref_To_Local'>next</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1032"><span class='Ref_To_Local'>iscalled</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/fmgr.h.html#LN326"><span class='Ref_to_Macro'>PG_RETURN_INT64</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1031"><span class='Ref_To_Local'>next</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Open the sequence and acquire lock if needed 
 * 
 * If we haven't touched the sequence already in this transaction, 
 * we need to acquire a lock.  We arrange for the lock to 
 * be owned by the top transaction, so that we don't need to do it 
 * more than once per xact. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> 
<a name="LN1049"></a><span class='Declare_Function'>lock_and_open_sequence</span><span class='Parentheses'>(</span><a href="sequence.c.html#LN84"><span class='Ref_to_Typedef'>SeqTable</span></a> <span class='Declare_Parameter'>seq</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1051"></a>    <a href="../../include/c.h.html#LN398"><span class='Ref_to_Typedef'>LocalTransactionId</span></a> <span class='Declare_Local'>thislxid</span> <span class='Operator'>= </span><a href="../storage/lmgr/proc.c.html#LN66"><span class='Ref_to_Global_Var'>MyProc</span></a><span class='Operator'>-&GT;</span><a href="../../include/storage/proc.h.html#LN104"><span class='Ref_to_Member'>lxid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get the lock if not already held in this xact */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1049"><span class='Ref_to_Parameter'>seq</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN75"><span class='Ref_to_Member'>lxid</span></a> <span class='Operator'>!= </span><a href="sequence.c.html#LN1051"><span class='Ref_To_Local'>thislxid</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1056"></a>        <a href="../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Local'>currentOwner</span><span class='Delimiter'>; 
</span> 
        <a href="sequence.c.html#LN1056"><span class='Ref_To_Local'>currentOwner</span></a> <span class='Operator'>= </span><a href="../utils/resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a><span class='Delimiter'>; 
</span>        <a href="../../include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../utils/resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a> <span class='Operator'>= </span><a href="../utils/resowner/resowner.c.html#LN139"><span class='Ref_to_Global_Var'>TopTransactionResourceOwner</span></a><span class='Delimiter'>; 
</span>            <a href="../../include/storage/lmgr.h.html#LN39"><span class='Ref_to_Proto'>LockRelationOid</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1049"><span class='Ref_to_Parameter'>seq</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN73"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Ensure CurrentResourceOwner is restored on error */ 
</span>            <a href="../utils/resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN1056"><span class='Ref_To_Local'>currentOwner</span></a><span class='Delimiter'>; 
</span>            <a href="../../include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="../utils/resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN1056"><span class='Ref_To_Local'>currentOwner</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Flag that we have a lock in the current xact */ 
</span>        <a href="sequence.c.html#LN1049"><span class='Ref_to_Parameter'>seq</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN75"><span class='Ref_to_Member'>lxid</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN1051"><span class='Ref_To_Local'>thislxid</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if seq-&GT;lxid!=thislxid &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* We now know we have the lock, and can safely open the rel */ 
</span>    <span class='Control'>return</span> <a href="../../include/access/heapam.h.html#LN84"><span class='Ref_to_Proto'>relation_open</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1049"><span class='Ref_to_Parameter'>seq</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN73"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end lock_and_open_sequence &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Creates the hash table for storing sequence data 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1085"></a><span class='Declare_Function'>create_seq_hashtable</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1087"></a>    <a href="../../include/utils/hsearch.h.html#LN64"><span class='Ref_to_Struct'>HASHCTL</span></a>     <span class='Declare_Local'>ctl</span><span class='Delimiter'>; 
</span> 
    memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="sequence.c.html#LN1087"><span class='Ref_To_Local'>ctl</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="sequence.c.html#LN1087"><span class='Ref_To_Local'>ctl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN1087"><span class='Ref_To_Local'>ctl</span></a><span class='Operator'>.</span><a href="../../include/utils/hsearch.h.html#LN71"><span class='Ref_to_Member'>keysize</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN1087"><span class='Ref_To_Local'>ctl</span></a><span class='Operator'>.</span><a href="../../include/utils/hsearch.h.html#LN72"><span class='Ref_to_Member'>entrysize</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="sequence.c.html#LN71"><span class='Ref_to_Struct'>SeqTableData</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="sequence.c.html#LN86"><span class='Ref_to_Global_Var'>seqhashtab</span></a> <span class='Operator'>= </span><a href="../../include/utils/hsearch.h.html#LN121"><span class='Ref_to_Proto'>hash_create</span></a><span class='Parentheses'>(</span><span class='String'>"Sequence values"</span><span class='Delimiter'>, </span><span class='Number'>16</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="sequence.c.html#LN1087"><span class='Ref_To_Local'>ctl</span></a><span class='Delimiter'>, 
</span>                             <a href="../../include/utils/hsearch.h.html#LN86"><span class='Ref_to_Const'>HASH_ELEM</span></a> <span class='Operator'>| </span><a href="../../include/utils/hsearch.h.html#LN87"><span class='Ref_to_Const'>HASH_BLOBS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Given a relation OID, open and lock the sequence.  p_elm and p_rel are 
 * output parameters. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1102"></a><span class='Declare_Function'>init_sequence</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Delimiter'>, </span><a href="sequence.c.html#LN84"><span class='Ref_to_Typedef'>SeqTable</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>p_elm</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>p_rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1104"></a>    <a href="sequence.c.html#LN84"><span class='Ref_to_Typedef'>SeqTable</span></a>    <span class='Declare_Local'>elm</span><span class='Delimiter'>; 
</span><a name="LN1105"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>seqrel</span><span class='Delimiter'>; 
</span><a name="LN1106"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Find or create a hash table entry for this sequence */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN86"><span class='Ref_to_Global_Var'>seqhashtab</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="sequence.c.html#LN96"><span class='Ref_to_Proto'>create_seq_hashtable</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="sequence.c.html#LN1104"><span class='Ref_To_Local'>elm</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="sequence.c.html#LN84"><span class='Ref_to_Typedef'>SeqTable</span></a><span class='Parentheses'>) </span><a href="../../include/utils/hsearch.h.html#LN125"><span class='Ref_to_Proto'>hash_search</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN86"><span class='Ref_to_Global_Var'>seqhashtab</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="sequence.c.html#LN1102"><span class='Ref_to_Parameter'>relid</span></a><span class='Delimiter'>, </span><a href="../../include/utils/hsearch.h.html#LN105"><span class='Ref_to_EnumConst'>HASH_ENTER</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="sequence.c.html#LN1106"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Initialize the new hash table entry if it did not exist already. 
     * 
     * NOTE: seqtable entries are stored for the life of a backend (unless 
     * explicitly discarded with DISCARD). If the sequence itself is deleted 
     * then the entry becomes wasted memory, but it's small enough that this 
     * should not matter. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="sequence.c.html#LN1106"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* relid already filled in */ 
</span>        <a href="sequence.c.html#LN1104"><span class='Ref_To_Local'>elm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN74"><span class='Ref_to_Member'>filenode</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN1104"><span class='Ref_To_Local'>elm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN75"><span class='Ref_to_Member'>lxid</span></a> <span class='Operator'>= </span><a href="../../include/storage/lock.h.html#LN69"><span class='Ref_to_Const'>InvalidLocalTransactionId</span></a><span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN1104"><span class='Ref_To_Local'>elm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN76"><span class='Ref_to_Member'>last_valid</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN1104"><span class='Ref_To_Local'>elm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN77"><span class='Ref_to_Member'>last</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN1104"><span class='Ref_To_Local'>elm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN78"><span class='Ref_to_Member'>cached</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Open the sequence relation. 
     */ 
</span>    <a href="sequence.c.html#LN1105"><span class='Ref_To_Local'>seqrel</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN95"><span class='Ref_to_Proto'>lock_and_open_sequence</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1104"><span class='Ref_To_Local'>elm</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1105"><span class='Ref_To_Local'>seqrel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a sequence"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1105"><span class='Ref_To_Local'>seqrel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the sequence has been transactionally replaced since we last saw it, 
     * discard any cached-but-unissued values.  We do not touch the currval() 
     * state, however. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1105"><span class='Ref_To_Local'>seqrel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relfilenode <span class='Operator'>!= </span><a href="sequence.c.html#LN1104"><span class='Ref_To_Local'>elm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN74"><span class='Ref_to_Member'>filenode</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="sequence.c.html#LN1104"><span class='Ref_To_Local'>elm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN74"><span class='Ref_to_Member'>filenode</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN1105"><span class='Ref_To_Local'>seqrel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relfilenode<span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN1104"><span class='Ref_To_Local'>elm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN78"><span class='Ref_to_Member'>cached</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN1104"><span class='Ref_To_Local'>elm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN77"><span class='Ref_to_Member'>last</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Return results */ 
</span>    <span class='Operator'>*</span><a href="sequence.c.html#LN1102"><span class='Ref_to_Parameter'>p_elm</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN1104"><span class='Ref_To_Local'>elm</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="sequence.c.html#LN1102"><span class='Ref_to_Parameter'>p_rel</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN1105"><span class='Ref_To_Local'>seqrel</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end init_sequence &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Given an opened sequence relation, lock the page buffer and find the tuple 
 * 
 * *buf receives the reference to the pinned-and-ex-locked buffer 
 * *seqdatatuple receives the reference to the sequence tuple proper 
 *      (this arg should point to a local variable of type HeapTupleData) 
 * 
 * Function's return value points to the data payload of the tuple 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/commands/sequence.h.html#LN31"><span class='Ref_to_Typedef'>Form_pg_sequence_data</span></a> 
<a name="LN1169"></a><span class='Declare_Function'>read_seq_tuple</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>seqdatatuple</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1171"></a>    <a href="../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span><a name="LN1172"></a>    <a href="../../include/storage/itemid.h.html#LN30"><span class='Ref_to_Typedef'>ItemId</span></a>      <span class='Declare_Local'>lp</span><span class='Delimiter'>; 
</span><a name="LN1173"></a>    <a href="sequence.c.html#LN60"><span class='Ref_to_Struct'>sequence_magic</span></a> <span class='Operator'>*</span><span class='Declare_Local'>sm</span><span class='Delimiter'>; 
</span><a name="LN1174"></a>    <a href="../../include/commands/sequence.h.html#LN31"><span class='Ref_to_Typedef'>Form_pg_sequence_data</span></a> <span class='Declare_Local'>seq</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="sequence.c.html#LN1169"><span class='Ref_to_Parameter'>buf</span></a> <span class='Operator'>= </span><a href="../../include/storage/bufmgr.h.html#LN167"><span class='Ref_to_Proto'>ReadBuffer</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1169"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="sequence.c.html#LN1169"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="../../include/storage/bufmgr.h.html#LN88"><span class='Ref_to_Const'>BUFFER_LOCK_EXCLUSIVE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="sequence.c.html#LN1171"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="sequence.c.html#LN1169"><span class='Ref_to_Parameter'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN1173"><span class='Ref_To_Local'>sm</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="sequence.c.html#LN60"><span class='Ref_to_Struct'>sequence_magic</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/storage/bufpage.h.html#LN322"><span class='Ref_to_Macro'>PageGetSpecialPointer</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1171"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1173"><span class='Ref_To_Local'>sm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN62"><span class='Ref_to_Member'>magic</span></a> <span class='Operator'>!= </span><a href="sequence.c.html#LN58"><span class='Ref_to_Const'>SEQ_MAGIC</span></a><span class='Parentheses'>) 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"bad magic number in sequence \"%s\": %08X"</span><span class='Delimiter'>, 
</span>             <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1169"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="sequence.c.html#LN1173"><span class='Ref_To_Local'>sm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN62"><span class='Ref_to_Member'>magic</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="sequence.c.html#LN1172"><span class='Ref_To_Local'>lp</span></a> <span class='Operator'>= </span><a href="../../include/storage/bufpage.h.html#LN231"><span class='Ref_to_Macro'>PageGetItemId</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1171"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/storage/itemid.h.html#LN97"><span class='Ref_to_Macro'>ItemIdIsNormal</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1172"><span class='Ref_To_Local'>lp</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Note we currently only bother to set these two fields of *seqdatatuple */ 
</span>    <a href="sequence.c.html#LN1169"><span class='Ref_to_Parameter'>seqdatatuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a><span class='Parentheses'>) </span><a href="../../include/storage/bufpage.h.html#LN336"><span class='Ref_to_Macro'>PageGetItem</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1171"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1172"><span class='Ref_To_Local'>lp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN1169"><span class='Ref_to_Parameter'>seqdatatuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a> <span class='Operator'>= </span><a href="../../include/storage/itemid.h.html#LN57"><span class='Ref_to_Macro'>ItemIdGetLength</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1172"><span class='Ref_To_Local'>lp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Previous releases of Postgres neglected to prevent SELECT FOR UPDATE on 
     * a sequence, which would leave a non-frozen XID in the sequence tuple's 
     * xmax, which eventually leads to clog access failures or worse. If we 
     * see this has happened, clean up after it.  We treat this like a hint 
     * bit update, ie, don't bother to WAL-log it, since we can certainly do 
     * this again if the update gets lost. 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="sequence.c.html#LN1169"><span class='Ref_to_Parameter'>seqdatatuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>& </span><a href="../../include/access/htup_details.h.html#LN193"><span class='Ref_to_Const'>HEAP_XMAX_IS_MULTI</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1169"><span class='Ref_to_Parameter'>seqdatatuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/access/htup_details.h.html#LN373"><span class='Ref_to_Macro'>HeapTupleHeaderSetXmax</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1169"><span class='Ref_to_Parameter'>seqdatatuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>, </span><a href="../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN1169"><span class='Ref_to_Parameter'>seqdatatuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>&= ~</span><a href="../../include/access/htup_details.h.html#LN191"><span class='Ref_to_Const'>HEAP_XMAX_COMMITTED</span></a><span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN1169"><span class='Ref_to_Parameter'>seqdatatuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>|= </span><a href="../../include/access/htup_details.h.html#LN192"><span class='Ref_to_Const'>HEAP_XMAX_INVALID</span></a><span class='Delimiter'>; 
</span>        <a href="../../include/storage/bufmgr.h.html#LN211"><span class='Ref_to_Proto'>MarkBufferDirtyHint</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="sequence.c.html#LN1169"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="sequence.c.html#LN1174"><span class='Ref_To_Local'>seq</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/commands/sequence.h.html#LN31"><span class='Ref_to_Typedef'>Form_pg_sequence_data</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1169"><span class='Ref_to_Parameter'>seqdatatuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="sequence.c.html#LN1174"><span class='Ref_To_Local'>seq</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end read_seq_tuple &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * init_params: process the options list of CREATE or ALTER SEQUENCE, and 
 * store the values into appropriate fields of seqform, for changes that go 
 * into the pg_sequence catalog, and fields of seqdataform for changes to the 
 * sequence relation itself.  Set *need_seq_rewrite to true if we changed any 
 * parameters that require rewriting the sequence's relation (interesting for 
 * ALTER SEQUENCE).  Also set *owned_by to any OWNED BY option, or to NIL if 
 * there is none. 
 * 
 * If isInit is true, fill any unspecified options with default values; 
 * otherwise, do not change existing options that aren't explicitly overridden. 
 * 
 * Note: we force a sequence rewrite whenever we change parameters that affect 
 * generation of future sequence values, even if the seqdataform per se is not 
 * changed.  This allows ALTER SEQUENCE to behave transactionally.  Currently, 
 * the only option that doesn't cause that is OWNED BY.  It's *necessary* for 
 * ALTER SEQUENCE OWNED BY to not rewrite the sequence, because that would 
 * break pg_upgrade by causing unwanted changes in the sequence's relfilenode. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1235"></a><span class='Declare_Function'>init_params</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>options</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>for_identity</span><span class='Delimiter'>, 
</span><a name="LN1236"></a>            <span class='Keyword'>bool </span><span class='Declare_Parameter'>isInit</span><span class='Delimiter'>, 
</span><a name="LN1237"></a>            <a href="../../include/catalog/pg_sequence.h.html#LN19"><span class='Ref_to_Typedef'>Form_pg_sequence</span></a> <span class='Declare_Parameter'>seqform</span><span class='Delimiter'>, 
</span><a name="LN1238"></a>            <a href="../../include/commands/sequence.h.html#LN31"><span class='Ref_to_Typedef'>Form_pg_sequence_data</span></a> <span class='Declare_Parameter'>seqdataform</span><span class='Delimiter'>, 
</span><a name="LN1239"></a>            <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>need_seq_rewrite</span><span class='Delimiter'>, 
</span><a name="LN1240"></a>            <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>owned_by</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1242"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>as_type</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1243"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>start_value</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1244"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>restart_value</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1245"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>increment_by</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1246"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>max_value</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1247"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>min_value</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1248"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>cache_value</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1249"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>is_cycled</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1250"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>option</span><span class='Delimiter'>; 
</span><a name="LN1251"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>reset_max_value</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN1252"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>reset_min_value</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="sequence.c.html#LN1239"><span class='Ref_to_Parameter'>need_seq_rewrite</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="sequence.c.html#LN1240"><span class='Ref_to_Parameter'>owned_by</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1250"><span class='Ref_To_Local'>option</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1235"><span class='Ref_to_Parameter'>options</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1259"></a>        <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>defel</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1250"><span class='Ref_To_Local'>option</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="sequence.c.html#LN1259"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"as"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1242"><span class='Ref_To_Local'>as_type</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1235"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1259"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="sequence.c.html#LN1242"><span class='Ref_To_Local'>as_type</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN1259"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="sequence.c.html#LN1239"><span class='Ref_to_Parameter'>need_seq_rewrite</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="sequence.c.html#LN1259"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"increment"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1245"><span class='Ref_To_Local'>increment_by</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1235"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1259"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="sequence.c.html#LN1245"><span class='Ref_To_Local'>increment_by</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN1259"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="sequence.c.html#LN1239"><span class='Ref_to_Parameter'>need_seq_rewrite</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="sequence.c.html#LN1259"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"start"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1243"><span class='Ref_To_Local'>start_value</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1235"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1259"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="sequence.c.html#LN1243"><span class='Ref_To_Local'>start_value</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN1259"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="sequence.c.html#LN1239"><span class='Ref_to_Parameter'>need_seq_rewrite</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="sequence.c.html#LN1259"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"restart"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1244"><span class='Ref_To_Local'>restart_value</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1235"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1259"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="sequence.c.html#LN1244"><span class='Ref_To_Local'>restart_value</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN1259"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="sequence.c.html#LN1239"><span class='Ref_to_Parameter'>need_seq_rewrite</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="sequence.c.html#LN1259"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"maxvalue"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1246"><span class='Ref_To_Local'>max_value</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1235"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1259"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="sequence.c.html#LN1246"><span class='Ref_To_Local'>max_value</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN1259"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="sequence.c.html#LN1239"><span class='Ref_to_Parameter'>need_seq_rewrite</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="sequence.c.html#LN1259"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"minvalue"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1247"><span class='Ref_To_Local'>min_value</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1235"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1259"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="sequence.c.html#LN1247"><span class='Ref_To_Local'>min_value</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN1259"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="sequence.c.html#LN1239"><span class='Ref_to_Parameter'>need_seq_rewrite</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="sequence.c.html#LN1259"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"cache"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1248"><span class='Ref_To_Local'>cache_value</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1235"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1259"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="sequence.c.html#LN1248"><span class='Ref_To_Local'>cache_value</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN1259"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="sequence.c.html#LN1239"><span class='Ref_to_Parameter'>need_seq_rewrite</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="sequence.c.html#LN1259"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"cycle"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1249"><span class='Ref_To_Local'>is_cycled</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1235"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1259"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="sequence.c.html#LN1249"><span class='Ref_To_Local'>is_cycled</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN1259"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="sequence.c.html#LN1239"><span class='Ref_to_Parameter'>need_seq_rewrite</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="sequence.c.html#LN1259"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"owned_by"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="sequence.c.html#LN1240"><span class='Ref_to_Parameter'>owned_by</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1235"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1259"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="sequence.c.html#LN1240"><span class='Ref_to_Parameter'>owned_by</span></a> <span class='Operator'>= </span><a href="../../include/commands/defrem.h.html#LN161"><span class='Ref_to_Proto'>defGetQualifiedName</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1259"><span class='Ref_To_Local'>defel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="sequence.c.html#LN1259"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"sequence_name"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * The parser allows this, but it is only for identity columns, in 
             * which case it is filtered out in parse_utilcmd.c.  We only get 
             * here if someone puts it into a CREATE SEQUENCE. 
             */ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid sequence option SEQUENCE NAME"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1235"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1259"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"option \"%s\" not recognized"</span><span class='Delimiter'>, 
</span>                 <a href="sequence.c.html#LN1259"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We must reset log_cnt when isInit or when changing any parameters that 
     * would affect future nextval allocations. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1236"><span class='Ref_to_Parameter'>isInit</span></a><span class='Parentheses'>) 
</span>        <a href="sequence.c.html#LN1238"><span class='Ref_to_Parameter'>seqdataform</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/sequence.h.html#LN27"><span class='Ref_to_Member'>log_cnt</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* AS type */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1242"><span class='Ref_To_Local'>as_type</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1377"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>newtypid</span> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN27"><span class='Ref_to_Proto'>typenameTypeId</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1235"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="../../include/commands/defrem.h.html#LN162"><span class='Ref_to_Proto'>defGetTypeName</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1242"><span class='Ref_To_Local'>as_type</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1377"><span class='Ref_To_Local'>newtypid</span></a> <span class='Operator'>!= </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN22"><span class='Ref_to_Const'>INT2OID</span></a> <span class='Operator'>&& 
</span>            <a href="sequence.c.html#LN1377"><span class='Ref_To_Local'>newtypid</span></a> <span class='Operator'>!= </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN24"><span class='Ref_to_Const'>INT4OID</span></a> <span class='Operator'>&& 
</span>            <a href="sequence.c.html#LN1377"><span class='Ref_To_Local'>newtypid</span></a> <span class='Operator'>!= </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN21"><span class='Ref_to_Const'>INT8OID</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="sequence.c.html#LN1235"><span class='Ref_to_Parameter'>for_identity</span></a> 
                     <span class='Operator'>? </span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"identity column type must be smallint, integer, or bigint"</span><span class='Parentheses'>) 
</span>            <span class='Operator'>: </span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"sequence type must be smallint, integer, or bigint"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="sequence.c.html#LN1236"><span class='Ref_to_Parameter'>isInit</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * When changing type and the old sequence min/max values were the 
             * min/max of the old type, adjust sequence min/max values to 
             * min/max of new type.  (Otherwise, the user chose explicit 
             * min/max values, which we'll leave alone.) 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqtypid <span class='Operator'>== </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN22"><span class='Ref_to_Const'>INT2OID</span></a> <span class='Operator'>&& </span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmax <span class='Operator'>== </span><a href="../../include/c.h.html#LN336"><span class='Ref_to_Const'>PG_INT16_MAX</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>                <span class='Parentheses'>(</span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqtypid <span class='Operator'>== </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN24"><span class='Ref_to_Const'>INT4OID</span></a> <span class='Operator'>&& </span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmax <span class='Operator'>== </span><a href="../../include/c.h.html#LN339"><span class='Ref_to_Const'>PG_INT32_MAX</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>            <span class='Parentheses'>(</span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqtypid <span class='Operator'>== </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN21"><span class='Ref_to_Const'>INT8OID</span></a> <span class='Operator'>&& </span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmax <span class='Operator'>== </span><a href="../../include/c.h.html#LN342"><span class='Ref_to_Const'>PG_INT64_MAX</span></a><span class='Parentheses'>))</span> 
                <a href="sequence.c.html#LN1251"><span class='Ref_To_Local'>reset_max_value</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqtypid <span class='Operator'>== </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN22"><span class='Ref_to_Const'>INT2OID</span></a> <span class='Operator'>&& </span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmin <span class='Operator'>== </span><a href="../../include/c.h.html#LN335"><span class='Ref_to_Const'>PG_INT16_MIN</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>                <span class='Parentheses'>(</span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqtypid <span class='Operator'>== </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN24"><span class='Ref_to_Const'>INT4OID</span></a> <span class='Operator'>&& </span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmin <span class='Operator'>== </span><a href="../../include/c.h.html#LN338"><span class='Ref_to_Const'>PG_INT32_MIN</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>            <span class='Parentheses'>(</span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqtypid <span class='Operator'>== </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN21"><span class='Ref_to_Const'>INT8OID</span></a> <span class='Operator'>&& </span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmin <span class='Operator'>== </span><a href="../../include/c.h.html#LN341"><span class='Ref_to_Const'>PG_INT64_MIN</span></a><span class='Parentheses'>))</span> 
                <a href="sequence.c.html#LN1252"><span class='Ref_To_Local'>reset_min_value</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqtypid <span class='Operator'>= </span><a href="sequence.c.html#LN1377"><span class='Ref_To_Local'>newtypid</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if as_type!=NULL &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1236"><span class='Ref_to_Parameter'>isInit</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqtypid <span class='Operator'>= </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN21"><span class='Ref_to_Const'>INT8OID</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* INCREMENT BY */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1245"><span class='Ref_To_Local'>increment_by</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqincrement <span class='Operator'>= </span><a href="../../include/commands/defrem.h.html#LN160"><span class='Ref_to_Proto'>defGetInt64</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1245"><span class='Ref_To_Local'>increment_by</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqincrement <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"INCREMENT must not be zero"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN1238"><span class='Ref_to_Parameter'>seqdataform</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/sequence.h.html#LN27"><span class='Ref_to_Member'>log_cnt</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1236"><span class='Ref_to_Parameter'>isInit</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqincrement <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* CYCLE */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1249"><span class='Ref_To_Local'>is_cycled</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqcycle <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN51"><span class='Ref_to_Macro'>intVal</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1249"><span class='Ref_To_Local'>is_cycled</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN519"><span class='Ref_to_Macro'>BoolIsValid</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqcycle<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN1238"><span class='Ref_to_Parameter'>seqdataform</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/sequence.h.html#LN27"><span class='Ref_to_Member'>log_cnt</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1236"><span class='Ref_to_Parameter'>isInit</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqcycle <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* MAXVALUE (null arg means NO MAXVALUE) */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1246"><span class='Ref_To_Local'>max_value</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="sequence.c.html#LN1246"><span class='Ref_To_Local'>max_value</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmax <span class='Operator'>= </span><a href="../../include/commands/defrem.h.html#LN160"><span class='Ref_to_Proto'>defGetInt64</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1246"><span class='Ref_To_Local'>max_value</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN1238"><span class='Ref_to_Parameter'>seqdataform</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/sequence.h.html#LN27"><span class='Ref_to_Member'>log_cnt</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1236"><span class='Ref_to_Parameter'>isInit</span></a> <span class='Operator'>|| </span><a href="sequence.c.html#LN1246"><span class='Ref_To_Local'>max_value</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="sequence.c.html#LN1251"><span class='Ref_To_Local'>reset_max_value</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqincrement <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="sequence.c.html#LN1251"><span class='Ref_To_Local'>reset_max_value</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* ascending seq */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqtypid <span class='Operator'>== </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN22"><span class='Ref_to_Const'>INT2OID</span></a><span class='Parentheses'>) 
</span>                <a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmax <span class='Operator'>= </span><a href="../../include/c.h.html#LN336"><span class='Ref_to_Const'>PG_INT16_MAX</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqtypid <span class='Operator'>== </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN24"><span class='Ref_to_Const'>INT4OID</span></a><span class='Parentheses'>) 
</span>                <a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmax <span class='Operator'>= </span><a href="../../include/c.h.html#LN339"><span class='Ref_to_Const'>PG_INT32_MAX</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmax <span class='Operator'>= </span><a href="../../include/c.h.html#LN342"><span class='Ref_to_Const'>PG_INT64_MAX</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmax <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* descending seq */ 
</span>        <a href="sequence.c.html#LN1238"><span class='Ref_to_Parameter'>seqdataform</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/sequence.h.html#LN27"><span class='Ref_to_Member'>log_cnt</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqtypid <span class='Operator'>== </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN22"><span class='Ref_to_Const'>INT2OID</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmax <span class='Operator'>&LT; </span><a href="../../include/c.h.html#LN335"><span class='Ref_to_Const'>PG_INT16_MIN</span></a> <span class='Operator'>|| </span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmax <span class='Operator'>&GT; </span><a href="../../include/c.h.html#LN336"><span class='Ref_to_Const'>PG_INT16_MAX</span></a><span class='Parentheses'>))</span> 
        <span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqtypid <span class='Operator'>== </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN24"><span class='Ref_to_Const'>INT4OID</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmax <span class='Operator'>&LT; </span><a href="../../include/c.h.html#LN338"><span class='Ref_to_Const'>PG_INT32_MIN</span></a> <span class='Operator'>|| </span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmax <span class='Operator'>&GT; </span><a href="../../include/c.h.html#LN339"><span class='Ref_to_Const'>PG_INT32_MAX</span></a><span class='Parentheses'>))</span> 
        <span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqtypid <span class='Operator'>== </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN21"><span class='Ref_to_Const'>INT8OID</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmax <span class='Operator'>&LT; </span><a href="../../include/c.h.html#LN341"><span class='Ref_to_Const'>PG_INT64_MIN</span></a> <span class='Operator'>|| </span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmax <span class='Operator'>&GT; </span><a href="../../include/c.h.html#LN342"><span class='Ref_to_Const'>PG_INT64_MAX</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1467"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>bufx</span><span class='Delimiter'>[</span><span class='Number'>100</span><span class='Delimiter'>]; 
</span> 
        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1467"><span class='Ref_To_Local'>bufx</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="sequence.c.html#LN1467"><span class='Ref_To_Local'>bufx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmax<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"MAXVALUE (%s) is out of range for sequence data type %s"</span><span class='Delimiter'>, 
</span>                   <a href="sequence.c.html#LN1467"><span class='Ref_To_Local'>bufx</span></a><span class='Delimiter'>, </span><a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqtypid<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* MINVALUE (null arg means NO MINVALUE) */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1247"><span class='Ref_To_Local'>min_value</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="sequence.c.html#LN1247"><span class='Ref_To_Local'>min_value</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmin <span class='Operator'>= </span><a href="../../include/commands/defrem.h.html#LN160"><span class='Ref_to_Proto'>defGetInt64</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1247"><span class='Ref_To_Local'>min_value</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN1238"><span class='Ref_to_Parameter'>seqdataform</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/sequence.h.html#LN27"><span class='Ref_to_Member'>log_cnt</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1236"><span class='Ref_to_Parameter'>isInit</span></a> <span class='Operator'>|| </span><a href="sequence.c.html#LN1247"><span class='Ref_To_Local'>min_value</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="sequence.c.html#LN1252"><span class='Ref_To_Local'>reset_min_value</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqincrement <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="sequence.c.html#LN1252"><span class='Ref_To_Local'>reset_min_value</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* descending seq */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqtypid <span class='Operator'>== </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN22"><span class='Ref_to_Const'>INT2OID</span></a><span class='Parentheses'>) 
</span>                <a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmin <span class='Operator'>= </span><a href="../../include/c.h.html#LN335"><span class='Ref_to_Const'>PG_INT16_MIN</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqtypid <span class='Operator'>== </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN24"><span class='Ref_to_Const'>INT4OID</span></a><span class='Parentheses'>) 
</span>                <a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmin <span class='Operator'>= </span><a href="../../include/c.h.html#LN338"><span class='Ref_to_Const'>PG_INT32_MIN</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmin <span class='Operator'>= </span><a href="../../include/c.h.html#LN341"><span class='Ref_to_Const'>PG_INT64_MIN</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmin <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* ascending seq */ 
</span>        <a href="sequence.c.html#LN1238"><span class='Ref_to_Parameter'>seqdataform</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/sequence.h.html#LN27"><span class='Ref_to_Member'>log_cnt</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqtypid <span class='Operator'>== </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN22"><span class='Ref_to_Const'>INT2OID</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmin <span class='Operator'>&LT; </span><a href="../../include/c.h.html#LN335"><span class='Ref_to_Const'>PG_INT16_MIN</span></a> <span class='Operator'>|| </span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmin <span class='Operator'>&GT; </span><a href="../../include/c.h.html#LN336"><span class='Ref_to_Const'>PG_INT16_MAX</span></a><span class='Parentheses'>))</span> 
        <span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqtypid <span class='Operator'>== </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN24"><span class='Ref_to_Const'>INT4OID</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmin <span class='Operator'>&LT; </span><a href="../../include/c.h.html#LN338"><span class='Ref_to_Const'>PG_INT32_MIN</span></a> <span class='Operator'>|| </span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmin <span class='Operator'>&GT; </span><a href="../../include/c.h.html#LN339"><span class='Ref_to_Const'>PG_INT32_MAX</span></a><span class='Parentheses'>))</span> 
        <span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqtypid <span class='Operator'>== </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN21"><span class='Ref_to_Const'>INT8OID</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmin <span class='Operator'>&LT; </span><a href="../../include/c.h.html#LN341"><span class='Ref_to_Const'>PG_INT64_MIN</span></a> <span class='Operator'>|| </span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmin <span class='Operator'>&GT; </span><a href="../../include/c.h.html#LN342"><span class='Ref_to_Const'>PG_INT64_MAX</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1504"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>bufm</span><span class='Delimiter'>[</span><span class='Number'>100</span><span class='Delimiter'>]; 
</span> 
        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1504"><span class='Ref_To_Local'>bufm</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="sequence.c.html#LN1504"><span class='Ref_To_Local'>bufm</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmin<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"MINVALUE (%s) is out of range for sequence data type %s"</span><span class='Delimiter'>, 
</span>                   <a href="sequence.c.html#LN1504"><span class='Ref_To_Local'>bufm</span></a><span class='Delimiter'>, </span><a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqtypid<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* crosscheck min/max */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmin <span class='Operator'>&GT;= </span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmax<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1517"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>bufm</span><span class='Delimiter'>[</span><span class='Number'>100</span><span class='Delimiter'>], 
</span><a name="LN1518"></a>                    <span class='Declare_Local'>bufx</span><span class='Delimiter'>[</span><span class='Number'>100</span><span class='Delimiter'>]; 
</span> 
        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1517"><span class='Ref_To_Local'>bufm</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="sequence.c.html#LN1517"><span class='Ref_To_Local'>bufm</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmin<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1518"><span class='Ref_To_Local'>bufx</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="sequence.c.html#LN1518"><span class='Ref_To_Local'>bufx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmax<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"MINVALUE (%s) must be less than MAXVALUE (%s)"</span><span class='Delimiter'>, 
</span>                        <a href="sequence.c.html#LN1517"><span class='Ref_To_Local'>bufm</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1518"><span class='Ref_To_Local'>bufx</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* START WITH */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1243"><span class='Ref_To_Local'>start_value</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqstart <span class='Operator'>= </span><a href="../../include/commands/defrem.h.html#LN160"><span class='Ref_to_Proto'>defGetInt64</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1243"><span class='Ref_To_Local'>start_value</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1236"><span class='Ref_to_Parameter'>isInit</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqincrement <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqstart <span class='Operator'>= </span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmin<span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* ascending seq */ 
</span>        <span class='Control'>else</span> 
            <a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqstart <span class='Operator'>= </span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmax<span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* descending seq */ 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* crosscheck START */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqstart <span class='Operator'>&LT; </span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmin<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1544"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>bufs</span><span class='Delimiter'>[</span><span class='Number'>100</span><span class='Delimiter'>], 
</span><a name="LN1545"></a>                    <span class='Declare_Local'>bufm</span><span class='Delimiter'>[</span><span class='Number'>100</span><span class='Delimiter'>]; 
</span> 
        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1544"><span class='Ref_To_Local'>bufs</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="sequence.c.html#LN1544"><span class='Ref_To_Local'>bufs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqstart<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1545"><span class='Ref_To_Local'>bufm</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="sequence.c.html#LN1545"><span class='Ref_To_Local'>bufm</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmin<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"START value (%s) cannot be less than MINVALUE (%s)"</span><span class='Delimiter'>, 
</span>                        <a href="sequence.c.html#LN1544"><span class='Ref_To_Local'>bufs</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1545"><span class='Ref_To_Local'>bufm</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqstart <span class='Operator'>&GT; </span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmax<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1556"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>bufs</span><span class='Delimiter'>[</span><span class='Number'>100</span><span class='Delimiter'>], 
</span><a name="LN1557"></a>                    <span class='Declare_Local'>bufm</span><span class='Delimiter'>[</span><span class='Number'>100</span><span class='Delimiter'>]; 
</span> 
        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1556"><span class='Ref_To_Local'>bufs</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="sequence.c.html#LN1556"><span class='Ref_To_Local'>bufs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqstart<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1557"><span class='Ref_To_Local'>bufm</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="sequence.c.html#LN1557"><span class='Ref_To_Local'>bufm</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmax<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"START value (%s) cannot be greater than MAXVALUE (%s)"</span><span class='Delimiter'>, 
</span>                     <a href="sequence.c.html#LN1556"><span class='Ref_To_Local'>bufs</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1557"><span class='Ref_To_Local'>bufm</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* RESTART [WITH] */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1244"><span class='Ref_To_Local'>restart_value</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1244"><span class='Ref_To_Local'>restart_value</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="sequence.c.html#LN1238"><span class='Ref_to_Parameter'>seqdataform</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/sequence.h.html#LN26"><span class='Ref_to_Member'>last_value</span></a> <span class='Operator'>= </span><a href="../../include/commands/defrem.h.html#LN160"><span class='Ref_to_Proto'>defGetInt64</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1244"><span class='Ref_To_Local'>restart_value</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="sequence.c.html#LN1238"><span class='Ref_to_Parameter'>seqdataform</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/sequence.h.html#LN26"><span class='Ref_to_Member'>last_value</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqstart<span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN1238"><span class='Ref_to_Parameter'>seqdataform</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/sequence.h.html#LN28"><span class='Ref_to_Member'>is_called</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN1238"><span class='Ref_to_Parameter'>seqdataform</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/sequence.h.html#LN27"><span class='Ref_to_Member'>log_cnt</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1236"><span class='Ref_to_Parameter'>isInit</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="sequence.c.html#LN1238"><span class='Ref_to_Parameter'>seqdataform</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/sequence.h.html#LN26"><span class='Ref_to_Member'>last_value</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqstart<span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN1238"><span class='Ref_to_Parameter'>seqdataform</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/sequence.h.html#LN28"><span class='Ref_to_Member'>is_called</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* crosscheck RESTART (or current value, if changing MIN/MAX) */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1238"><span class='Ref_to_Parameter'>seqdataform</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/sequence.h.html#LN26"><span class='Ref_to_Member'>last_value</span></a> <span class='Operator'>&LT; </span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmin<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1586"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>bufs</span><span class='Delimiter'>[</span><span class='Number'>100</span><span class='Delimiter'>], 
</span><a name="LN1587"></a>                    <span class='Declare_Local'>bufm</span><span class='Delimiter'>[</span><span class='Number'>100</span><span class='Delimiter'>]; 
</span> 
        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1586"><span class='Ref_To_Local'>bufs</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="sequence.c.html#LN1586"><span class='Ref_To_Local'>bufs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1238"><span class='Ref_to_Parameter'>seqdataform</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/sequence.h.html#LN26"><span class='Ref_to_Member'>last_value</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1587"><span class='Ref_To_Local'>bufm</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="sequence.c.html#LN1587"><span class='Ref_To_Local'>bufm</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmin<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"RESTART value (%s) cannot be less than MINVALUE (%s)"</span><span class='Delimiter'>, 
</span>                      <a href="sequence.c.html#LN1586"><span class='Ref_To_Local'>bufs</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1587"><span class='Ref_To_Local'>bufm</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1238"><span class='Ref_to_Parameter'>seqdataform</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/sequence.h.html#LN26"><span class='Ref_to_Member'>last_value</span></a> <span class='Operator'>&GT; </span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmax<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1598"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>bufs</span><span class='Delimiter'>[</span><span class='Number'>100</span><span class='Delimiter'>], 
</span><a name="LN1599"></a>                    <span class='Declare_Local'>bufm</span><span class='Delimiter'>[</span><span class='Number'>100</span><span class='Delimiter'>]; 
</span> 
        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1598"><span class='Ref_To_Local'>bufs</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="sequence.c.html#LN1598"><span class='Ref_To_Local'>bufs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1238"><span class='Ref_to_Parameter'>seqdataform</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/sequence.h.html#LN26"><span class='Ref_to_Member'>last_value</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1599"><span class='Ref_To_Local'>bufm</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="sequence.c.html#LN1599"><span class='Ref_To_Local'>bufm</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqmax<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"RESTART value (%s) cannot be greater than MAXVALUE (%s)"</span><span class='Delimiter'>, 
</span>                   <a href="sequence.c.html#LN1598"><span class='Ref_To_Local'>bufs</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1599"><span class='Ref_To_Local'>bufm</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* CACHE */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1248"><span class='Ref_To_Local'>cache_value</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqcache <span class='Operator'>= </span><a href="../../include/commands/defrem.h.html#LN160"><span class='Ref_to_Proto'>defGetInt64</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1248"><span class='Ref_To_Local'>cache_value</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqcache <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1615"></a>            <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><span class='Number'>100</span><span class='Delimiter'>]; 
</span> 
            <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1615"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="sequence.c.html#LN1615"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqcache<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"CACHE (%s) must be greater than zero"</span><span class='Delimiter'>, 
</span>                            <a href="sequence.c.html#LN1615"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="sequence.c.html#LN1238"><span class='Ref_to_Parameter'>seqdataform</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/sequence.h.html#LN27"><span class='Ref_to_Member'>log_cnt</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1236"><span class='Ref_to_Parameter'>isInit</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="sequence.c.html#LN1237"><span class='Ref_to_Parameter'>seqform</span></a><span class='Operator'>-&GT;</span>seqcache <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end init_params &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Process an OWNED BY option for CREATE/ALTER SEQUENCE 
 * 
 * Ownership permissions on the sequence are already checked, 
 * but if we are establishing a new owned-by dependency, we must 
 * enforce that the referenced table has the same owner and namespace 
 * as the sequence. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1640"></a><span class='Declare_Function'>process_owned_by</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>seqrel</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>owned_by</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>for_identity</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1642"></a>    <a href="../../include/catalog/dependency.h.html#LN72"><span class='Ref_to_Enum'>DependencyType</span></a> <span class='Declare_Local'>deptype</span><span class='Delimiter'>; 
</span><a name="LN1643"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nnames</span><span class='Delimiter'>; 
</span><a name="LN1644"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>tablerel</span><span class='Delimiter'>; 
</span><a name="LN1645"></a>    <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>attnum</span><span class='Delimiter'>; 
</span> 
    <a href="sequence.c.html#LN1642"><span class='Ref_To_Local'>deptype</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN1640"><span class='Ref_to_Parameter'>for_identity</span></a> <span class='Operator'>? </span><a href="../../include/catalog/dependency.h.html#LN76"><span class='Ref_to_EnumConst'>DEPENDENCY_INTERNAL</span></a> <span class='Operator'>: </span><a href="../../include/catalog/dependency.h.html#LN75"><span class='Ref_to_EnumConst'>DEPENDENCY_AUTO</span></a><span class='Delimiter'>; 
</span> 
    <a href="sequence.c.html#LN1643"><span class='Ref_To_Local'>nnames</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1640"><span class='Ref_to_Parameter'>owned_by</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="sequence.c.html#LN1643"><span class='Ref_To_Local'>nnames</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1643"><span class='Ref_To_Local'>nnames</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Must be OWNED BY NONE */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1640"><span class='Ref_to_Parameter'>owned_by</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, </span><span class='String'>"none"</span><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid OWNED BY option"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Specify OWNED BY table.column or OWNED BY NONE."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN1644"><span class='Ref_To_Local'>tablerel</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN1645"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1664"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>relname</span><span class='Delimiter'>; 
</span><a name="LN1665"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>attrname</span><span class='Delimiter'>; 
</span><a name="LN1666"></a>        <a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Separate relname and attr name */ 
</span>        <a href="sequence.c.html#LN1664"><span class='Ref_To_Local'>relname</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN220"><span class='Ref_to_Proto'>list_truncate</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN268"><span class='Ref_to_Proto'>list_copy</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1640"><span class='Ref_to_Parameter'>owned_by</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="sequence.c.html#LN1643"><span class='Ref_To_Local'>nnames</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN1665"><span class='Ref_To_Local'>attrname</span></a> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN81"><span class='Ref_to_Func'>list_tail</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1640"><span class='Ref_to_Parameter'>owned_by</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Open and lock rel to ensure it won't go away meanwhile */ 
</span>        <a href="sequence.c.html#LN1666"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN119"><span class='Ref_to_Proto'>makeRangeVarFromNameList</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1664"><span class='Ref_To_Local'>relname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN1644"><span class='Ref_To_Local'>tablerel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN86"><span class='Ref_to_Proto'>relation_openrv</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1666"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Must be a regular or foreign table */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="sequence.c.html#LN1644"><span class='Ref_To_Local'>tablerel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a> <span class='Operator'>|| 
</span>              <a href="sequence.c.html#LN1644"><span class='Ref_To_Local'>tablerel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a> <span class='Operator'>|| 
</span>              <a href="sequence.c.html#LN1644"><span class='Ref_To_Local'>tablerel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN163"><span class='Ref_to_Const'>RELKIND_VIEW</span></a> <span class='Operator'>|| 
</span>              <a href="sequence.c.html#LN1644"><span class='Ref_To_Local'>tablerel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"referenced relation \"%s\" is not a table or foreign table"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1644"><span class='Ref_To_Local'>tablerel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* We insist on same owner and schema */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1640"><span class='Ref_to_Parameter'>seqrel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relowner <span class='Operator'>!= </span><a href="sequence.c.html#LN1644"><span class='Ref_To_Local'>tablerel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relowner<span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"sequence must have same owner as table it is linked to"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN443"><span class='Ref_to_Macro'>RelationGetNamespace</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1640"><span class='Ref_to_Parameter'>seqrel</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../include/utils/rel.h.html#LN443"><span class='Ref_to_Macro'>RelationGetNamespace</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1644"><span class='Ref_To_Local'>tablerel</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"sequence must be in same schema as table it is linked to"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Now, fetch the attribute number from the system cache */ 
</span>        <a href="sequence.c.html#LN1645"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN87"><span class='Ref_to_Proto'>get_attnum</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1644"><span class='Ref_To_Local'>tablerel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="sequence.c.html#LN1665"><span class='Ref_To_Local'>attrname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1645"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>== </span><a href="../../include/access/attnum.h.html#LN22"><span class='Ref_to_Const'>InvalidAttrNumber</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" of relation \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                            <a href="sequence.c.html#LN1665"><span class='Ref_To_Local'>attrname</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1644"><span class='Ref_To_Local'>tablerel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Catch user explicitly running OWNED BY on identity sequence. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1642"><span class='Ref_To_Local'>deptype</span></a> <span class='Operator'>== </span><a href="../../include/catalog/dependency.h.html#LN75"><span class='Ref_to_EnumConst'>DEPENDENCY_AUTO</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1710"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tableId</span><span class='Delimiter'>; 
</span><a name="LN1711"></a>        <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>colId</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/dependency.h.html#LN240"><span class='Ref_to_Proto'>sequenceIsOwned</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1640"><span class='Ref_to_Parameter'>seqrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN76"><span class='Ref_to_EnumConst'>DEPENDENCY_INTERNAL</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="sequence.c.html#LN1710"><span class='Ref_To_Local'>tableId</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="sequence.c.html#LN1711"><span class='Ref_To_Local'>colId</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot change ownership of identity sequence"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Sequence \"%s\" is linked to table \"%s\"."</span><span class='Delimiter'>, 
</span>                               <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1640"><span class='Ref_to_Parameter'>seqrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                               <a href="../../include/utils/lsyscache.h.html#LN124"><span class='Ref_to_Proto'>get_rel_name</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1710"><span class='Ref_To_Local'>tableId</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * OK, we are ready to update pg_depend.  First remove any existing 
     * dependencies for the sequence, then optionally add a new one. 
     */ 
</span>    <a href="../../include/catalog/dependency.h.html#LN231"><span class='Ref_to_Proto'>deleteDependencyRecordsForClass</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1640"><span class='Ref_to_Parameter'>seqrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                    <a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1642"><span class='Ref_To_Local'>deptype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1644"><span class='Ref_To_Local'>tablerel</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1731"></a>        <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>refobject</span><span class='Delimiter'>, 
</span><a name="LN1732"></a>                    <span class='Declare_Local'>depobject</span><span class='Delimiter'>; 
</span> 
        <a href="sequence.c.html#LN1731"><span class='Ref_To_Local'>refobject</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN1731"><span class='Ref_To_Local'>refobject</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1644"><span class='Ref_To_Local'>tablerel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN1731"><span class='Ref_To_Local'>refobject</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN1645"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN1732"><span class='Ref_To_Local'>depobject</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN1732"><span class='Ref_To_Local'>depobject</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1640"><span class='Ref_to_Parameter'>seqrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN1732"><span class='Ref_To_Local'>depobject</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="sequence.c.html#LN1732"><span class='Ref_To_Local'>depobject</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="sequence.c.html#LN1731"><span class='Ref_To_Local'>refobject</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1642"><span class='Ref_To_Local'>deptype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Done, but hold lock until commit */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1644"><span class='Ref_To_Local'>tablerel</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1644"><span class='Ref_To_Local'>tablerel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end process_owned_by &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Return sequence parameters in a list of the form created by the parser. 
 */ 
</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN1753"></a><span class='Declare_Function'>sequence_options</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1755"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>pgstuple</span><span class='Delimiter'>; 
</span><a name="LN1756"></a>    <a href="../../include/catalog/pg_sequence.h.html#LN19"><span class='Ref_to_Typedef'>Form_pg_sequence</span></a> <span class='Declare_Local'>pgsform</span><span class='Delimiter'>; 
</span><a name="LN1757"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>options</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <a href="sequence.c.html#LN1755"><span class='Ref_To_Local'>pgstuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN87"><span class='Ref_to_EnumConst'>SEQRELID</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1753"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1755"><span class='Ref_To_Local'>pgstuple</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for sequence %u"</span><span class='Delimiter'>, </span><a href="sequence.c.html#LN1753"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN1756"><span class='Ref_To_Local'>pgsform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_sequence.h.html#LN19"><span class='Ref_to_Typedef'>Form_pg_sequence</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1755"><span class='Ref_To_Local'>pgstuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="sequence.c.html#LN1757"><span class='Ref_To_Local'>options</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1757"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/makefuncs.h.html#LN82"><span class='Ref_to_Proto'>makeDefElem</span></a><span class='Parentheses'>(</span><span class='String'>"cache"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../nodes/value.c.html#LN21"><span class='Ref_to_Func'>makeInteger</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1756"><span class='Ref_To_Local'>pgsform</span></a><span class='Operator'>-&GT;</span>seqcache<span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN1757"><span class='Ref_To_Local'>options</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1757"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/makefuncs.h.html#LN82"><span class='Ref_to_Proto'>makeDefElem</span></a><span class='Parentheses'>(</span><span class='String'>"cycle"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../nodes/value.c.html#LN21"><span class='Ref_to_Func'>makeInteger</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1756"><span class='Ref_To_Local'>pgsform</span></a><span class='Operator'>-&GT;</span>seqcycle<span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN1757"><span class='Ref_To_Local'>options</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1757"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/makefuncs.h.html#LN82"><span class='Ref_to_Proto'>makeDefElem</span></a><span class='Parentheses'>(</span><span class='String'>"increment"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../nodes/value.c.html#LN21"><span class='Ref_to_Func'>makeInteger</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1756"><span class='Ref_To_Local'>pgsform</span></a><span class='Operator'>-&GT;</span>seqincrement<span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN1757"><span class='Ref_To_Local'>options</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1757"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/makefuncs.h.html#LN82"><span class='Ref_to_Proto'>makeDefElem</span></a><span class='Parentheses'>(</span><span class='String'>"maxvalue"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../nodes/value.c.html#LN21"><span class='Ref_to_Func'>makeInteger</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1756"><span class='Ref_To_Local'>pgsform</span></a><span class='Operator'>-&GT;</span>seqmax<span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN1757"><span class='Ref_To_Local'>options</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1757"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/makefuncs.h.html#LN82"><span class='Ref_to_Proto'>makeDefElem</span></a><span class='Parentheses'>(</span><span class='String'>"minvalue"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../nodes/value.c.html#LN21"><span class='Ref_to_Func'>makeInteger</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1756"><span class='Ref_To_Local'>pgsform</span></a><span class='Operator'>-&GT;</span>seqmin<span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN1757"><span class='Ref_To_Local'>options</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1757"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/makefuncs.h.html#LN82"><span class='Ref_to_Proto'>makeDefElem</span></a><span class='Parentheses'>(</span><span class='String'>"start"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../nodes/value.c.html#LN21"><span class='Ref_to_Func'>makeInteger</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1756"><span class='Ref_To_Local'>pgsform</span></a><span class='Operator'>-&GT;</span>seqstart<span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1755"><span class='Ref_To_Local'>pgstuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="sequence.c.html#LN1757"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end sequence_options &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Return sequence parameters (formerly for use by information schema) 
 */ 
</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1780"></a><span class='Declare_Function'>pg_sequence_parameters</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1782"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1783"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span><span class='Delimiter'>; 
</span><a name="LN1784"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><span class='Number'>7</span><span class='Delimiter'>]; 
</span><a name="LN1785"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>[</span><span class='Number'>7</span><span class='Delimiter'>]; 
</span><a name="LN1786"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>pgstuple</span><span class='Delimiter'>; 
</span><a name="LN1787"></a>    <a href="../../include/catalog/pg_sequence.h.html#LN19"><span class='Ref_to_Typedef'>Form_pg_sequence</span></a> <span class='Declare_Local'>pgsform</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN283"><span class='Ref_to_Proto'>pg_class_aclcheck</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1782"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN72"><span class='Ref_to_Const'>ACL_SELECT</span></a> <span class='Operator'>| </span><a href="../../include/nodes/parsenodes.h.html#LN73"><span class='Ref_to_Const'>ACL_UPDATE</span></a> <span class='Operator'>| </span><a href="../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied for sequence %s"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/lsyscache.h.html#LN124"><span class='Ref_to_Proto'>get_rel_name</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1782"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <a href="sequence.c.html#LN1783"><span class='Ref_To_Local'>tupdesc</span></a> <span class='Operator'>= </span><a href="../access/common/tupdesc.c.html#LN39"><span class='Ref_to_Func'>CreateTemplateTupleDesc</span></a><span class='Parentheses'>(</span><span class='Number'>7</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/tupdesc.h.html#LN114"><span class='Ref_to_Proto'>TupleDescInitEntry</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1783"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>) </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"start_value"</span><span class='Delimiter'>, 
</span>                       <a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN21"><span class='Ref_to_Const'>INT8OID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/tupdesc.h.html#LN114"><span class='Ref_to_Proto'>TupleDescInitEntry</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1783"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>) </span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='String'>"minimum_value"</span><span class='Delimiter'>, 
</span>                       <a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN21"><span class='Ref_to_Const'>INT8OID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/tupdesc.h.html#LN114"><span class='Ref_to_Proto'>TupleDescInitEntry</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1783"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>) </span><span class='Number'>3</span><span class='Delimiter'>, </span><span class='String'>"maximum_value"</span><span class='Delimiter'>, 
</span>                       <a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN21"><span class='Ref_to_Const'>INT8OID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/tupdesc.h.html#LN114"><span class='Ref_to_Proto'>TupleDescInitEntry</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1783"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>) </span><span class='Number'>4</span><span class='Delimiter'>, </span><span class='String'>"increment"</span><span class='Delimiter'>, 
</span>                       <a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN21"><span class='Ref_to_Const'>INT8OID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/tupdesc.h.html#LN114"><span class='Ref_to_Proto'>TupleDescInitEntry</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1783"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>) </span><span class='Number'>5</span><span class='Delimiter'>, </span><span class='String'>"cycle_option"</span><span class='Delimiter'>, 
</span>                       <a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN17"><span class='Ref_to_Const'>BOOLOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/tupdesc.h.html#LN114"><span class='Ref_to_Proto'>TupleDescInitEntry</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1783"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>) </span><span class='Number'>6</span><span class='Delimiter'>, </span><span class='String'>"cache_size"</span><span class='Delimiter'>, 
</span>                       <a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN21"><span class='Ref_to_Const'>INT8OID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/tupdesc.h.html#LN114"><span class='Ref_to_Proto'>TupleDescInitEntry</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1783"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>) </span><span class='Number'>7</span><span class='Delimiter'>, </span><span class='String'>"data_type"</span><span class='Delimiter'>, 
</span>                       <a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN27"><span class='Ref_to_Const'>OIDOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/funcapi.h.html#LN229"><span class='Ref_to_Proto'>BlessTupleDesc</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1783"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    memset<span class='Parentheses'>(</span><a href="sequence.c.html#LN1785"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="sequence.c.html#LN1785"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="sequence.c.html#LN1786"><span class='Ref_To_Local'>pgstuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN87"><span class='Ref_to_EnumConst'>SEQRELID</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1782"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1786"><span class='Ref_To_Local'>pgstuple</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for sequence %u"</span><span class='Delimiter'>, </span><a href="sequence.c.html#LN1782"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN1787"><span class='Ref_To_Local'>pgsform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_sequence.h.html#LN19"><span class='Ref_to_Typedef'>Form_pg_sequence</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1786"><span class='Ref_To_Local'>pgstuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="sequence.c.html#LN1784"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN624"><span class='Ref_to_Macro'>Int64GetDatum</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1787"><span class='Ref_To_Local'>pgsform</span></a><span class='Operator'>-&GT;</span>seqstart<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN1784"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN624"><span class='Ref_to_Macro'>Int64GetDatum</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1787"><span class='Ref_To_Local'>pgsform</span></a><span class='Operator'>-&GT;</span>seqmin<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN1784"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN624"><span class='Ref_to_Macro'>Int64GetDatum</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1787"><span class='Ref_To_Local'>pgsform</span></a><span class='Operator'>-&GT;</span>seqmax<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN1784"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN624"><span class='Ref_to_Macro'>Int64GetDatum</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1787"><span class='Ref_To_Local'>pgsform</span></a><span class='Operator'>-&GT;</span>seqincrement<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN1784"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>4</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1787"><span class='Ref_To_Local'>pgsform</span></a><span class='Operator'>-&GT;</span>seqcycle<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN1784"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>5</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN624"><span class='Ref_to_Macro'>Int64GetDatum</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1787"><span class='Ref_To_Local'>pgsform</span></a><span class='Operator'>-&GT;</span>seqcache<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN1784"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>6</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1787"><span class='Ref_To_Local'>pgsform</span></a><span class='Operator'>-&GT;</span>seqtypid<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1786"><span class='Ref_To_Local'>pgstuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/funcapi.h.html#LN221"><span class='Ref_to_Macro'>HeapTupleGetDatum</span></a><span class='Parentheses'>(</span><a href="../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1783"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1784"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1785"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_sequence_parameters &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Return the last value from the sequence 
 * 
 * Note: This has a completely different meaning than lastval(). 
 */ 
</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1839"></a><span class='Declare_Function'>pg_sequence_last_value</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1841"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1842"></a>    <a href="sequence.c.html#LN84"><span class='Ref_to_Typedef'>SeqTable</span></a>    <span class='Declare_Local'>elm</span><span class='Delimiter'>; 
</span><a name="LN1843"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>seqrel</span><span class='Delimiter'>; 
</span><a name="LN1844"></a>    <a href="../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN1845"></a>    <a href="../../include/access/htup.h.html#LN61"><span class='Ref_to_Struct'>HeapTupleData</span></a> <span class='Declare_Local'>seqtuple</span><span class='Delimiter'>; 
</span><a name="LN1846"></a>    <a href="../../include/commands/sequence.h.html#LN31"><span class='Ref_to_Typedef'>Form_pg_sequence_data</span></a> <span class='Declare_Local'>seq</span><span class='Delimiter'>; 
</span><a name="LN1847"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_called</span><span class='Delimiter'>; 
</span><a name="LN1848"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* open and lock sequence */ 
</span>    <a href="sequence.c.html#LN97"><span class='Ref_to_Proto'>init_sequence</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1841"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="sequence.c.html#LN1842"><span class='Ref_To_Local'>elm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="sequence.c.html#LN1843"><span class='Ref_To_Local'>seqrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN283"><span class='Ref_to_Proto'>pg_class_aclcheck</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1841"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN72"><span class='Ref_to_Const'>ACL_SELECT</span></a> <span class='Operator'>| </span><a href="../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied for sequence %s"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1843"><span class='Ref_To_Local'>seqrel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <a href="sequence.c.html#LN1846"><span class='Ref_To_Local'>seq</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN98"><span class='Ref_to_Proto'>read_seq_tuple</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1843"><span class='Ref_To_Local'>seqrel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="sequence.c.html#LN1844"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="sequence.c.html#LN1845"><span class='Ref_To_Local'>seqtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="sequence.c.html#LN1847"><span class='Ref_To_Local'>is_called</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN1846"><span class='Ref_To_Local'>seq</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/sequence.h.html#LN28"><span class='Ref_to_Member'>is_called</span></a><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN1848"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN1846"><span class='Ref_To_Local'>seq</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/sequence.h.html#LN26"><span class='Ref_to_Member'>last_value</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1844"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1843"><span class='Ref_To_Local'>seqrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1847"><span class='Ref_To_Local'>is_called</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/fmgr.h.html#LN326"><span class='Ref_to_Macro'>PG_RETURN_INT64</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1848"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_sequence_last_value &raquo; </span> 
 
 
<span class='Keyword'>void 
</span><a name="LN1875"></a><span class='Declare_Function'>seq_redo</span><span class='Parentheses'>(</span><a href="../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>record</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1877"></a>    <a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Local'>lsn</span> <span class='Operator'>= </span><a href="sequence.c.html#LN1875"><span class='Ref_to_Parameter'>record</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/xlogreader.h.html#LN114"><span class='Ref_to_Member'>EndRecPtr</span></a><span class='Delimiter'>; 
</span><a name="LN1878"></a>    <a href="../../include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>       <span class='Declare_Local'>info</span> <span class='Operator'>= </span><a href="../../include/access/xlogreader.h.html#LN215"><span class='Ref_to_Macro'>XLogRecGetInfo</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1875"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>) </span><span class='Operator'>& ~</span><a href="../../include/access/xlogrecord.h.html#LN61"><span class='Ref_to_Const'>XLR_INFO_MASK</span></a><span class='Delimiter'>; 
</span><a name="LN1879"></a>    <a href="../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>buffer</span><span class='Delimiter'>; 
</span><a name="LN1880"></a>    <a href="../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span><a name="LN1881"></a>    <a href="../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>localpage</span><span class='Delimiter'>; 
</span><a name="LN1882"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>item</span><span class='Delimiter'>; 
</span><a name="LN1883"></a>    <a href="../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>itemsz</span><span class='Delimiter'>; 
</span><a name="LN1884"></a>    <a href="../../include/commands/sequence.h.html#LN47"><span class='Ref_to_Struct'>xl_seq_rec</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xlrec</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/commands/sequence.h.html#LN47"><span class='Ref_to_Struct'>xl_seq_rec</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/access/xlogreader.h.html#LN219"><span class='Ref_to_Macro'>XLogRecGetData</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1875"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1885"></a>    <a href="sequence.c.html#LN60"><span class='Ref_to_Struct'>sequence_magic</span></a> <span class='Operator'>*</span><span class='Declare_Local'>sm</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN1878"><span class='Ref_To_Local'>info</span></a> <span class='Operator'>!= </span><a href="../../include/commands/sequence.h.html#LN45"><span class='Ref_to_Const'>XLOG_SEQ_LOG</span></a><span class='Parentheses'>) 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN52"><span class='Ref_to_Const'>PANIC</span></a><span class='Delimiter'>, </span><span class='String'>"seq_redo: unknown op code %u"</span><span class='Delimiter'>, </span><a href="sequence.c.html#LN1878"><span class='Ref_To_Local'>info</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="sequence.c.html#LN1879"><span class='Ref_To_Local'>buffer</span></a> <span class='Operator'>= </span><a href="../../include/access/xlogutils.h.html#LN37"><span class='Ref_to_Proto'>XLogInitBufferForRedo</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1875"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN1880"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a><span class='Parentheses'>) </span><a href="../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1879"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We always reinit the page.  However, since this WAL record type is also 
     * used for updating sequences, it's possible that a hot-standby backend 
     * is examining the page concurrently; so we mustn't transiently trash the 
     * buffer.  The solution is to build the correct new page contents in 
     * local workspace and then memcpy into the buffer.  Then only bytes that 
     * are supposed to change will change, even transiently. We must palloc 
     * the local page for alignment reasons. 
     */ 
</span>    <a href="sequence.c.html#LN1881"><span class='Ref_To_Local'>localpage</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../include/storage/bufmgr.h.html#LN146"><span class='Ref_to_Macro'>BufferGetPageSize</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1879"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../storage/page/bufpage.c.html#LN39"><span class='Ref_to_Func'>PageInit</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1881"><span class='Ref_To_Local'>localpage</span></a><span class='Delimiter'>, </span><a href="../../include/storage/bufmgr.h.html#LN146"><span class='Ref_to_Macro'>BufferGetPageSize</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1879"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="sequence.c.html#LN60"><span class='Ref_to_Struct'>sequence_magic</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN1885"><span class='Ref_To_Local'>sm</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="sequence.c.html#LN60"><span class='Ref_to_Struct'>sequence_magic</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/storage/bufpage.h.html#LN322"><span class='Ref_to_Macro'>PageGetSpecialPointer</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1881"><span class='Ref_To_Local'>localpage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN1885"><span class='Ref_To_Local'>sm</span></a><span class='Operator'>-&GT;</span><a href="sequence.c.html#LN62"><span class='Ref_to_Member'>magic</span></a> <span class='Operator'>= </span><a href="sequence.c.html#LN58"><span class='Ref_to_Const'>SEQ_MAGIC</span></a><span class='Delimiter'>; 
</span> 
    <a href="sequence.c.html#LN1882"><span class='Ref_To_Local'>item</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="sequence.c.html#LN1884"><span class='Ref_To_Local'>xlrec</span></a> <span class='Operator'>+ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/commands/sequence.h.html#LN47"><span class='Ref_to_Struct'>xl_seq_rec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="sequence.c.html#LN1883"><span class='Ref_To_Local'>itemsz</span></a> <span class='Operator'>= </span><a href="../../include/access/xlogreader.h.html#LN220"><span class='Ref_to_Macro'>XLogRecGetDataLen</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1875"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/commands/sequence.h.html#LN47"><span class='Ref_to_Struct'>xl_seq_rec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/storage/bufpage.h.html#LN412"><span class='Ref_to_Macro'>PageAddItem</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1881"><span class='Ref_To_Local'>localpage</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/storage/item.h.html#LN16"><span class='Ref_to_Typedef'>Item</span></a><span class='Parentheses'>) </span><a href="sequence.c.html#LN1882"><span class='Ref_To_Local'>item</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1883"><span class='Ref_To_Local'>itemsz</span></a><span class='Delimiter'>, 
</span>                    <a href="../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><a href="../../include/storage/off.h.html#LN25"><span class='Ref_to_Const'>InvalidOffsetNumber</span></a><span class='Parentheses'>)</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN52"><span class='Ref_to_Const'>PANIC</span></a><span class='Delimiter'>, </span><span class='String'>"seq_redo: failed to add item to page"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/storage/bufpage.h.html#LN364"><span class='Ref_to_Macro'>PageSetLSN</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1881"><span class='Ref_To_Local'>localpage</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1877"><span class='Ref_To_Local'>lsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    memcpy<span class='Parentheses'>(</span><a href="sequence.c.html#LN1880"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="sequence.c.html#LN1881"><span class='Ref_To_Local'>localpage</span></a><span class='Delimiter'>, </span><a href="../../include/storage/bufmgr.h.html#LN146"><span class='Ref_to_Macro'>BufferGetPageSize</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1879"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/storage/bufmgr.h.html#LN176"><span class='Ref_to_Proto'>MarkBufferDirty</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1879"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1879"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1881"><span class='Ref_To_Local'>localpage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end seq_redo &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Flush cached sequence information. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1928"></a><span class='Declare_Function'>ResetSequenceCaches</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sequence.c.html#LN86"><span class='Ref_to_Global_Var'>seqhashtab</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/hsearch.h.html#LN123"><span class='Ref_to_Proto'>hash_destroy</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN86"><span class='Ref_to_Global_Var'>seqhashtab</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="sequence.c.html#LN86"><span class='Ref_to_Global_Var'>seqhashtab</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="sequence.c.html#LN92"><span class='Ref_to_Global_Var'>last_used_seq</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Mask a Sequence page before performing consistency checks on it. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1943"></a><span class='Declare_Function'>seq_mask</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>page</span><span class='Delimiter'>, </span><a href="../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Parameter'>blkno</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../include/access/bufmask.h.html#LN25"><span class='Ref_to_Proto'>mask_page_lsn</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1943"><span class='Ref_to_Parameter'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/bufmask.h.html#LN27"><span class='Ref_to_Proto'>mask_unused_space</span></a><span class='Parentheses'>(</span><a href="sequence.c.html#LN1943"><span class='Ref_to_Parameter'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>