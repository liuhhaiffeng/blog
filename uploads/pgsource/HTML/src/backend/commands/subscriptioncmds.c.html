<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\commands\subscriptioncmds.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\commands\subscriptioncmds.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:36 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * subscriptioncmds.c 
 *      subscription catalog manipulation functions 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * IDENTIFICATION 
 *      subscriptioncmds.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/heapam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xact.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"catalog/dependency.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/indexing.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/namespace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/objectaccess.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/objectaddress.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_subscription.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_subscription_rel.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"commands/defrem.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/event_trigger.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/subscriptioncmds.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"executor/executor.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"nodes/makefuncs.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"replication/logicallauncher.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"replication/origin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"replication/walreceiver.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"replication/walsender.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"replication/worker_internal.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"storage/lmgr.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/guc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
 
<a name="LN53"></a><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>fetch_table_list</span><span class='Parentheses'>(</span><a href="../replication/libpqwalreceiver/libpqwalreceiver.c.html#LN39"><span class='Ref_to_Struct'>WalReceiverConn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>wrconn</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>publications</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Common option parsing function for CREATE and ALTER SUBSCRIPTION commands. 
 * 
 * Since not all options can be specified in both commands, this function 
 * will report an error on options if the target output pointer is NULL to 
 * accommodate that. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN63"></a><span class='Declare_Function'>parse_subscription_options</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>options</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>connect</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>enabled_given</span><span class='Delimiter'>, 
</span><a name="LN64"></a>                           <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>enabled</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>create_slot</span><span class='Delimiter'>, 
</span><a name="LN65"></a>                           <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>slot_name_given</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>slot_name</span><span class='Delimiter'>, 
</span><a name="LN66"></a>                           <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>copy_data</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>synchronous_commit</span><span class='Delimiter'>, 
</span><a name="LN67"></a>                           <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>refresh</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN69"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span><a name="LN70"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>connect_given</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN71"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>create_slot_given</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN72"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>copy_data_given</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN73"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>refresh_given</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If connect is specified, the others also need to be. */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="subscriptioncmds.c.html#LN63"><span class='Ref_to_Parameter'>connect</span></a> <span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN64"><span class='Ref_to_Parameter'>enabled</span></a> <span class='Operator'>&& </span><a href="subscriptioncmds.c.html#LN64"><span class='Ref_to_Parameter'>create_slot</span></a> <span class='Operator'>&& </span><a href="subscriptioncmds.c.html#LN66"><span class='Ref_to_Parameter'>copy_data</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN63"><span class='Ref_to_Parameter'>connect</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="subscriptioncmds.c.html#LN63"><span class='Ref_to_Parameter'>connect</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN64"><span class='Ref_to_Parameter'>enabled</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="subscriptioncmds.c.html#LN63"><span class='Ref_to_Parameter'>enabled_given</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="subscriptioncmds.c.html#LN64"><span class='Ref_to_Parameter'>enabled</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN64"><span class='Ref_to_Parameter'>create_slot</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="subscriptioncmds.c.html#LN64"><span class='Ref_to_Parameter'>create_slot</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN65"><span class='Ref_to_Parameter'>slot_name</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="subscriptioncmds.c.html#LN65"><span class='Ref_to_Parameter'>slot_name_given</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="subscriptioncmds.c.html#LN65"><span class='Ref_to_Parameter'>slot_name</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN66"><span class='Ref_to_Parameter'>copy_data</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="subscriptioncmds.c.html#LN66"><span class='Ref_to_Parameter'>copy_data</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN66"><span class='Ref_to_Parameter'>synchronous_commit</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="subscriptioncmds.c.html#LN66"><span class='Ref_to_Parameter'>synchronous_commit</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN67"><span class='Ref_to_Parameter'>refresh</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="subscriptioncmds.c.html#LN67"><span class='Ref_to_Parameter'>refresh</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Parse options */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN69"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN63"><span class='Ref_to_Parameter'>options</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN102"></a>        <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>defel</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN69"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN102"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"connect"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="subscriptioncmds.c.html#LN63"><span class='Ref_to_Parameter'>connect</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN70"><span class='Ref_To_Local'>connect_given</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <a href="subscriptioncmds.c.html#LN70"><span class='Ref_To_Local'>connect_given</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="subscriptioncmds.c.html#LN63"><span class='Ref_to_Parameter'>connect</span></a> <span class='Operator'>= </span><a href="define.c.html#LN109"><span class='Ref_to_Func'>defGetBoolean</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN102"><span class='Ref_To_Local'>defel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN102"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"enabled"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="subscriptioncmds.c.html#LN64"><span class='Ref_to_Parameter'>enabled</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="subscriptioncmds.c.html#LN63"><span class='Ref_to_Parameter'>enabled_given</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Operator'>*</span><a href="subscriptioncmds.c.html#LN63"><span class='Ref_to_Parameter'>enabled_given</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="subscriptioncmds.c.html#LN64"><span class='Ref_to_Parameter'>enabled</span></a> <span class='Operator'>= </span><a href="define.c.html#LN109"><span class='Ref_to_Func'>defGetBoolean</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN102"><span class='Ref_To_Local'>defel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN102"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"create_slot"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="subscriptioncmds.c.html#LN64"><span class='Ref_to_Parameter'>create_slot</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN71"><span class='Ref_To_Local'>create_slot_given</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <a href="subscriptioncmds.c.html#LN71"><span class='Ref_To_Local'>create_slot_given</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="subscriptioncmds.c.html#LN64"><span class='Ref_to_Parameter'>create_slot</span></a> <span class='Operator'>= </span><a href="define.c.html#LN109"><span class='Ref_to_Func'>defGetBoolean</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN102"><span class='Ref_To_Local'>defel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN102"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"slot_name"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="subscriptioncmds.c.html#LN65"><span class='Ref_to_Parameter'>slot_name</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="subscriptioncmds.c.html#LN65"><span class='Ref_to_Parameter'>slot_name_given</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Operator'>*</span><a href="subscriptioncmds.c.html#LN65"><span class='Ref_to_Parameter'>slot_name_given</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="subscriptioncmds.c.html#LN65"><span class='Ref_to_Parameter'>slot_name</span></a> <span class='Operator'>= </span><a href="define.c.html#LN47"><span class='Ref_to_Func'>defGetString</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN102"><span class='Ref_To_Local'>defel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Setting slot_name = NONE is treated as no slot name. */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><span class='Operator'>*</span><a href="subscriptioncmds.c.html#LN65"><span class='Ref_to_Parameter'>slot_name</span></a><span class='Delimiter'>, </span><span class='String'>"none"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Operator'>*</span><a href="subscriptioncmds.c.html#LN65"><span class='Ref_to_Parameter'>slot_name</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN102"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"copy_data"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="subscriptioncmds.c.html#LN66"><span class='Ref_to_Parameter'>copy_data</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN72"><span class='Ref_To_Local'>copy_data_given</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <a href="subscriptioncmds.c.html#LN72"><span class='Ref_To_Local'>copy_data_given</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="subscriptioncmds.c.html#LN66"><span class='Ref_to_Parameter'>copy_data</span></a> <span class='Operator'>= </span><a href="define.c.html#LN109"><span class='Ref_to_Func'>defGetBoolean</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN102"><span class='Ref_To_Local'>defel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN102"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"synchronous_commit"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>                 <a href="subscriptioncmds.c.html#LN66"><span class='Ref_to_Parameter'>synchronous_commit</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="subscriptioncmds.c.html#LN66"><span class='Ref_to_Parameter'>synchronous_commit</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Operator'>*</span><a href="subscriptioncmds.c.html#LN66"><span class='Ref_to_Parameter'>synchronous_commit</span></a> <span class='Operator'>= </span><a href="define.c.html#LN47"><span class='Ref_to_Func'>defGetString</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN102"><span class='Ref_To_Local'>defel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Test if the given value is valid for synchronous_commit GUC. */ 
</span>            <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../include/utils/guc.h.html#LN361"><span class='Ref_to_Proto'>set_config_option</span></a><span class='Parentheses'>(</span><span class='String'>"synchronous_commit"</span><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="subscriptioncmds.c.html#LN66"><span class='Ref_to_Parameter'>synchronous_commit</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../include/utils/guc.h.html#LN73"><span class='Ref_to_EnumConst'>PGC_BACKEND</span></a><span class='Delimiter'>, </span><a href="../../include/utils/guc.h.html#LN118"><span class='Ref_to_EnumConst'>PGC_S_TEST</span></a><span class='Delimiter'>, </span><a href="../../include/utils/guc.h.html#LN193"><span class='Ref_to_EnumConst'>GUC_ACTION_SET</span></a><span class='Delimiter'>, 
</span>                                     <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN102"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"refresh"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="subscriptioncmds.c.html#LN67"><span class='Ref_to_Parameter'>refresh</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN73"><span class='Ref_To_Local'>refresh_given</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <a href="subscriptioncmds.c.html#LN73"><span class='Ref_To_Local'>refresh_given</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="subscriptioncmds.c.html#LN67"><span class='Ref_to_Parameter'>refresh</span></a> <span class='Operator'>= </span><a href="define.c.html#LN109"><span class='Ref_to_Func'>defGetBoolean</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN102"><span class='Ref_To_Local'>defel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unrecognized subscription parameter: %s"</span><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN102"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We've been explicitly asked to not connect, that requires some 
     * additional processing. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN63"><span class='Ref_to_Parameter'>connect</span></a> <span class='Operator'>&& !*</span><a href="subscriptioncmds.c.html#LN63"><span class='Ref_to_Parameter'>connect</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Check for incompatible options from the user. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN64"><span class='Ref_to_Parameter'>enabled</span></a> <span class='Operator'>&& *</span><a href="subscriptioncmds.c.html#LN63"><span class='Ref_to_Parameter'>enabled_given</span></a> <span class='Operator'>&& *</span><a href="subscriptioncmds.c.html#LN64"><span class='Ref_to_Parameter'>enabled</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"connect = false and enabled = true are mutually exclusive options"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN64"><span class='Ref_to_Parameter'>create_slot</span></a> <span class='Operator'>&& </span><a href="subscriptioncmds.c.html#LN71"><span class='Ref_To_Local'>create_slot_given</span></a> <span class='Operator'>&& *</span><a href="subscriptioncmds.c.html#LN64"><span class='Ref_to_Parameter'>create_slot</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"connect = false and create_slot = true are mutually exclusive options"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN66"><span class='Ref_to_Parameter'>copy_data</span></a> <span class='Operator'>&& </span><a href="subscriptioncmds.c.html#LN72"><span class='Ref_To_Local'>copy_data_given</span></a> <span class='Operator'>&& *</span><a href="subscriptioncmds.c.html#LN66"><span class='Ref_to_Parameter'>copy_data</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"connect = false and copy_data = true are mutually exclusive options"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Change the defaults of other options. */ 
</span>        <span class='Operator'>*</span><a href="subscriptioncmds.c.html#LN64"><span class='Ref_to_Parameter'>enabled</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="subscriptioncmds.c.html#LN64"><span class='Ref_to_Parameter'>create_slot</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="subscriptioncmds.c.html#LN66"><span class='Ref_to_Parameter'>copy_data</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if connect&&!*connect &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Do additional checking for disallowed combination when slot_name = NONE 
     * was used. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN65"><span class='Ref_to_Parameter'>slot_name</span></a> <span class='Operator'>&& *</span><a href="subscriptioncmds.c.html#LN65"><span class='Ref_to_Parameter'>slot_name_given</span></a> <span class='Operator'>&& !*</span><a href="subscriptioncmds.c.html#LN65"><span class='Ref_to_Parameter'>slot_name</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN64"><span class='Ref_to_Parameter'>enabled</span></a> <span class='Operator'>&& *</span><a href="subscriptioncmds.c.html#LN63"><span class='Ref_to_Parameter'>enabled_given</span></a> <span class='Operator'>&& *</span><a href="subscriptioncmds.c.html#LN64"><span class='Ref_to_Parameter'>enabled</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"slot_name = NONE and enabled = true are mutually exclusive options"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN64"><span class='Ref_to_Parameter'>create_slot</span></a> <span class='Operator'>&& </span><a href="subscriptioncmds.c.html#LN71"><span class='Ref_To_Local'>create_slot_given</span></a> <span class='Operator'>&& *</span><a href="subscriptioncmds.c.html#LN64"><span class='Ref_to_Parameter'>create_slot</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"slot_name = NONE and create_slot = true are mutually exclusive options"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN64"><span class='Ref_to_Parameter'>enabled</span></a> <span class='Operator'>&& !*</span><a href="subscriptioncmds.c.html#LN63"><span class='Ref_to_Parameter'>enabled_given</span></a> <span class='Operator'>&& *</span><a href="subscriptioncmds.c.html#LN64"><span class='Ref_to_Parameter'>enabled</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"subscription with slot_name = NONE must also set enabled = false"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN64"><span class='Ref_to_Parameter'>create_slot</span></a> <span class='Operator'>&& !</span><a href="subscriptioncmds.c.html#LN71"><span class='Ref_To_Local'>create_slot_given</span></a> <span class='Operator'>&& *</span><a href="subscriptioncmds.c.html#LN64"><span class='Ref_to_Parameter'>create_slot</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"subscription with slot_name = NONE must also set create_slot = false"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if slot_name&&*slot_name... &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end parse_subscription_options &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Auxiliary function to return a text array out of a list of String nodes. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN249"></a><span class='Declare_Function'>publicationListToArray</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>publist</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN251"></a>    <a href="../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>arr</span><span class='Delimiter'>; 
</span><a name="LN252"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>datums</span><span class='Delimiter'>; 
</span><a name="LN253"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>j</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN254"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span><a name="LN255"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>memcxt</span><span class='Delimiter'>; 
</span><a name="LN256"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create memory context for temporary allocations. */ 
</span>    <a href="subscriptioncmds.c.html#LN255"><span class='Ref_To_Local'>memcxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, 
</span>                                   <span class='String'>"publicationListToArray to array"</span><span class='Delimiter'>, 
</span>                                   <a href="../../include/utils/memutils.h.html#LN161"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_MINSIZE</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../include/utils/memutils.h.html#LN162"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_INITSIZE</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../include/utils/memutils.h.html#LN163"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_MAXSIZE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subscriptioncmds.c.html#LN256"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN255"><span class='Ref_To_Local'>memcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="subscriptioncmds.c.html#LN252"><span class='Ref_To_Local'>datums</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN249"><span class='Ref_to_Parameter'>publist</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN254"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN249"><span class='Ref_to_Parameter'>publist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN269"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>name</span> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN254"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN270"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>pcell</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Check for duplicates. */ 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN270"><span class='Ref_To_Local'>pcell</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN249"><span class='Ref_to_Parameter'>publist</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN275"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>pname</span> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN270"><span class='Ref_To_Local'>pcell</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN269"><span class='Ref_To_Local'>name</span></a> <span class='Operator'>== </span><a href="subscriptioncmds.c.html#LN275"><span class='Ref_To_Local'>pname</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN269"><span class='Ref_To_Local'>name</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN275"><span class='Ref_To_Local'>pname</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"publication name \"%s\" used more than once"</span><span class='Delimiter'>, 
</span>                                <a href="subscriptioncmds.c.html#LN275"><span class='Ref_To_Local'>pname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="subscriptioncmds.c.html#LN252"><span class='Ref_To_Local'>datums</span></a><span class='Delimiter'>[</span><a href="subscriptioncmds.c.html#LN253"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN269"><span class='Ref_To_Local'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN256"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="subscriptioncmds.c.html#LN251"><span class='Ref_To_Local'>arr</span></a> <span class='Operator'>= </span><a href="../../include/utils/array.h.html#LN369"><span class='Ref_to_Proto'>construct_array</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN252"><span class='Ref_To_Local'>datums</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN249"><span class='Ref_to_Parameter'>publist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                          <a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'i'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN255"><span class='Ref_To_Local'>memcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN251"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end publicationListToArray &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Create new subscription. 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN303"></a><span class='Declare_Function'>CreateSubscription</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN3370"><span class='Ref_to_Struct'>CreateSubscriptionStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isTopLevel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN305"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN306"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>myself</span><span class='Delimiter'>; 
</span><a name="LN307"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>subid</span><span class='Delimiter'>; 
</span><a name="LN308"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription.h.html#LN63"><span class='Ref_to_Const'>Natts_pg_subscription</span></a><span class='Delimiter'>]; 
</span><a name="LN309"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription.h.html#LN63"><span class='Ref_to_Const'>Natts_pg_subscription</span></a><span class='Delimiter'>]; 
</span><a name="LN310"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>owner</span> <span class='Operator'>= </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN311"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN312"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>connect</span><span class='Delimiter'>; 
</span><a name="LN313"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>enabled_given</span><span class='Delimiter'>; 
</span><a name="LN314"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>enabled</span><span class='Delimiter'>; 
</span><a name="LN315"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>copy_data</span><span class='Delimiter'>; 
</span><a name="LN316"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>synchronous_commit</span><span class='Delimiter'>; 
</span><a name="LN317"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>conninfo</span><span class='Delimiter'>; 
</span><a name="LN318"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>slotname</span><span class='Delimiter'>; 
</span><a name="LN319"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>slotname_given</span><span class='Delimiter'>; 
</span><a name="LN320"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>originname</span><span class='Delimiter'>[</span><a href="../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a><span class='Delimiter'>]; 
</span><a name="LN321"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>create_slot</span><span class='Delimiter'>; 
</span><a name="LN322"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>publications</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Parse and check options. 
     * 
     * Connection and publication should not be specified here. 
     */ 
</span>    <a href="subscriptioncmds.c.html#LN62"><span class='Ref_to_Func'>parse_subscription_options</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN303"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3376"><span class='Ref_to_Member'>options</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN312"><span class='Ref_To_Local'>connect</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN313"><span class='Ref_To_Local'>enabled_given</span></a><span class='Delimiter'>, 
</span>                               <span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN314"><span class='Ref_To_Local'>enabled</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN321"><span class='Ref_To_Local'>create_slot</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN319"><span class='Ref_To_Local'>slotname_given</span></a><span class='Delimiter'>, 
</span>                               <span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN318"><span class='Ref_To_Local'>slotname</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN315"><span class='Ref_To_Local'>copy_data</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN316"><span class='Ref_To_Local'>synchronous_commit</span></a><span class='Delimiter'>, 
</span>                               <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Since creating a replication slot is not transactional, rolling back 
     * the transaction leaves the created replication slot.  So we cannot run 
     * CREATE SUBSCRIPTION inside a transaction block if creating a 
     * replication slot. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN321"><span class='Ref_To_Local'>create_slot</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/access/xact.h.html#LN370"><span class='Ref_to_Proto'>PreventTransactionChain</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN303"><span class='Ref_to_Parameter'>isTopLevel</span></a><span class='Delimiter'>, </span><span class='String'>"CREATE SUBSCRIPTION ... WITH (create_slot = true)"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>())</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"must be superuser to create subscriptions"</span><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <a href="subscriptioncmds.c.html#LN305"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_subscription.h.html#LN21"><span class='Ref_to_Const'>SubscriptionRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check if name is used */ 
</span>    <a href="subscriptioncmds.c.html#LN307"><span class='Ref_To_Local'>subid</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN184"><span class='Ref_to_Macro'>GetSysCacheOid2</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN91"><span class='Ref_to_EnumConst'>SUBSCRIPTIONNAME</span></a><span class='Delimiter'>, </span><a href="../utils/init/globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a><span class='Delimiter'>, 
</span>                            <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN303"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3373"><span class='Ref_to_Member'>subname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN307"><span class='Ref_To_Local'>subid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/pg_basebackup/streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"subscription \"%s\" already exists"</span><span class='Delimiter'>, 
</span>                        <a href="subscriptioncmds.c.html#LN303"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3373"><span class='Ref_to_Member'>subname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="subscriptioncmds.c.html#LN319"><span class='Ref_To_Local'>slotname_given</span></a> <span class='Operator'>&& </span><a href="subscriptioncmds.c.html#LN318"><span class='Ref_To_Local'>slotname</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="subscriptioncmds.c.html#LN318"><span class='Ref_To_Local'>slotname</span></a> <span class='Operator'>= </span><a href="subscriptioncmds.c.html#LN303"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3373"><span class='Ref_to_Member'>subname</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* The default for synchronous_commit of subscriptions is off. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN316"><span class='Ref_To_Local'>synchronous_commit</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="subscriptioncmds.c.html#LN316"><span class='Ref_To_Local'>synchronous_commit</span></a> <span class='Operator'>= </span><span class='String'>"off"</span><span class='Delimiter'>; 
</span> 
    <a href="subscriptioncmds.c.html#LN317"><span class='Ref_To_Local'>conninfo</span></a> <span class='Operator'>= </span><a href="subscriptioncmds.c.html#LN303"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3374"><span class='Ref_to_Member'>conninfo</span></a><span class='Delimiter'>; 
</span>    <a href="subscriptioncmds.c.html#LN322"><span class='Ref_To_Local'>publications</span></a> <span class='Operator'>= </span><a href="subscriptioncmds.c.html#LN303"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3375"><span class='Ref_to_Member'>publication</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Load the library providing us libpq calls. */ 
</span>    <a href="../utils/fmgr/dfmgr.c.html#LN135"><span class='Ref_to_Func'>load_file</span></a><span class='Parentheses'>(</span><span class='String'>"libpqwalreceiver"</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check the connection info string. */ 
</span>    <a href="../../include/replication/walreceiver.h.html#LN243"><span class='Ref_to_Macro'>walrcv_check_conninfo</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN317"><span class='Ref_To_Local'>conninfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Everything ok, form a new tuple. */ 
</span>    memset<span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN309"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN309"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN308"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN308"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="subscriptioncmds.c.html#LN309"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription.h.html#LN64"><span class='Ref_to_Const'>Anum_pg_subscription_subdbid</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subscriptioncmds.c.html#LN309"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription.h.html#LN65"><span class='Ref_to_Const'>Anum_pg_subscription_subname</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>        <a href="../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../utils/adt/name.c.html#LN44"><span class='Ref_to_Func'>namein</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN303"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3373"><span class='Ref_to_Member'>subname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="subscriptioncmds.c.html#LN309"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription.h.html#LN66"><span class='Ref_to_Const'>Anum_pg_subscription_subowner</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN310"><span class='Ref_To_Local'>owner</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subscriptioncmds.c.html#LN309"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription.h.html#LN67"><span class='Ref_to_Const'>Anum_pg_subscription_subenabled</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN314"><span class='Ref_To_Local'>enabled</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subscriptioncmds.c.html#LN309"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription.h.html#LN68"><span class='Ref_to_Const'>Anum_pg_subscription_subconninfo</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>        <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN317"><span class='Ref_To_Local'>conninfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN318"><span class='Ref_To_Local'>slotname</span></a><span class='Parentheses'>) 
</span>        <a href="subscriptioncmds.c.html#LN309"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription.h.html#LN69"><span class='Ref_to_Const'>Anum_pg_subscription_subslotname</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>            <a href="../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../utils/adt/name.c.html#LN44"><span class='Ref_to_Func'>namein</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN318"><span class='Ref_To_Local'>slotname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="subscriptioncmds.c.html#LN308"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription.h.html#LN69"><span class='Ref_to_Const'>Anum_pg_subscription_subslotname</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="subscriptioncmds.c.html#LN309"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription.h.html#LN70"><span class='Ref_to_Const'>Anum_pg_subscription_subsynccommit</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>        <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN316"><span class='Ref_To_Local'>synchronous_commit</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subscriptioncmds.c.html#LN309"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription.h.html#LN71"><span class='Ref_to_Const'>Anum_pg_subscription_subpublications</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>        <a href="subscriptioncmds.c.html#LN248"><span class='Ref_to_Func'>publicationListToArray</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN322"><span class='Ref_To_Local'>publications</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="subscriptioncmds.c.html#LN311"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN305"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN309"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN308"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Insert tuple into catalog. */ 
</span>    <a href="subscriptioncmds.c.html#LN307"><span class='Ref_To_Local'>subid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/indexing.h.html#LN32"><span class='Ref_to_Proto'>CatalogTupleInsert</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN305"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN311"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN311"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../catalog/pg_shdepend.c.html#LN157"><span class='Ref_to_Func'>recordDependencyOnOwner</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_subscription.h.html#LN21"><span class='Ref_to_Const'>SubscriptionRelationId</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN307"><span class='Ref_To_Local'>subid</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN310"><span class='Ref_To_Local'>owner</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN320"><span class='Ref_To_Local'>originname</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN320"><span class='Ref_To_Local'>originname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"pg_%u"</span><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN307"><span class='Ref_To_Local'>subid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/replication/origin.h.html#LN42"><span class='Ref_to_Proto'>replorigin_create</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN320"><span class='Ref_To_Local'>originname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Connect to remote side to execute requested commands and fetch table 
     * info. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN312"><span class='Ref_To_Local'>connect</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN415"></a>        <a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Local'>lsn</span><span class='Delimiter'>; 
</span><a name="LN416"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>err</span><span class='Delimiter'>; 
</span><a name="LN417"></a>        <a href="../replication/libpqwalreceiver/libpqwalreceiver.c.html#LN39"><span class='Ref_to_Struct'>WalReceiverConn</span></a> <span class='Operator'>*</span><span class='Declare_Local'>wrconn</span><span class='Delimiter'>; 
</span><a name="LN418"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tables</span><span class='Delimiter'>; 
</span><a name="LN419"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span><a name="LN420"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>table_state</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Try to connect to the publisher. */ 
</span>        <a href="subscriptioncmds.c.html#LN417"><span class='Ref_To_Local'>wrconn</span></a> <span class='Operator'>= </span><a href="../../include/replication/walreceiver.h.html#LN241"><span class='Ref_to_Macro'>walrcv_connect</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN317"><span class='Ref_To_Local'>conninfo</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN303"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3373"><span class='Ref_to_Member'>subname</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN416"><span class='Ref_To_Local'>err</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="subscriptioncmds.c.html#LN417"><span class='Ref_To_Local'>wrconn</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not connect to the publisher: %s"</span><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN416"><span class='Ref_To_Local'>err</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Set sync state based on if we were asked to do data copy or 
             * not. 
             */ 
</span>            <a href="subscriptioncmds.c.html#LN420"><span class='Ref_To_Local'>table_state</span></a> <span class='Operator'>= </span><a href="subscriptioncmds.c.html#LN315"><span class='Ref_To_Local'>copy_data</span></a> <span class='Operator'>? </span><a href="../../include/catalog/pg_subscription_rel.h.html#LN53"><span class='Ref_to_Const'>SUBREL_STATE_INIT</span></a> <span class='Operator'>: </span><a href="../../include/catalog/pg_subscription_rel.h.html#LN58"><span class='Ref_to_Const'>SUBREL_STATE_READY</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Get the table list from publisher and build local table status 
             * info. 
             */ 
</span>            <a href="subscriptioncmds.c.html#LN418"><span class='Ref_To_Local'>tables</span></a> <span class='Operator'>= </span><a href="subscriptioncmds.c.html#LN53"><span class='Ref_to_Proto'>fetch_table_list</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN417"><span class='Ref_To_Local'>wrconn</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN322"><span class='Ref_To_Local'>publications</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN419"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN418"><span class='Ref_To_Local'>tables</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN443"></a>                <a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>rv</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN419"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN444"></a>                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span><span class='Delimiter'>; 
</span> 
                <a href="subscriptioncmds.c.html#LN444"><span class='Ref_To_Local'>relid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN52"><span class='Ref_to_Macro'>RangeVarGetRelid</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN443"><span class='Ref_To_Local'>rv</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Check for supported relkind. */ 
</span>                <a href="../../include/executor/executor.h.html#LN537"><span class='Ref_to_Proto'>CheckSubscriptionRelkind</span></a><span class='Parentheses'>(</span><a href="../../include/utils/lsyscache.h.html#LN127"><span class='Ref_to_Proto'>get_rel_relkind</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN444"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <a href="subscriptioncmds.c.html#LN443"><span class='Ref_To_Local'>rv</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN66"><span class='Ref_to_Member'>schemaname</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN443"><span class='Ref_To_Local'>rv</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="../../include/catalog/pg_subscription_rel.h.html#LN72"><span class='Ref_to_Proto'>SetSubscriptionRelState</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN307"><span class='Ref_To_Local'>subid</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN444"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN420"><span class='Ref_To_Local'>table_state</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../include/access/xlogdefs.h.html#LN27"><span class='Ref_to_Const'>InvalidXLogRecPtr</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If requested, create permanent slot for the subscription. We 
             * won't use the initial snapshot for anything, so no need to 
             * export it. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN321"><span class='Ref_To_Local'>create_slot</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN318"><span class='Ref_To_Local'>slotname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="../../include/replication/walreceiver.h.html#LN259"><span class='Ref_to_Macro'>walrcv_create_slot</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN417"><span class='Ref_To_Local'>wrconn</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN318"><span class='Ref_To_Local'>slotname</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                   <a href="../../include/replication/walsender.h.html#LN24"><span class='Ref_to_EnumConst'>CRS_NOEXPORT_SNAPSHOT</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN415"><span class='Ref_To_Local'>lsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                      <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"created replication slot \"%s\" on publisher"</span><span class='Delimiter'>, 
</span>                              <a href="subscriptioncmds.c.html#LN318"><span class='Ref_To_Local'>slotname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Close the connection in case of failure. */ 
</span>            <a href="../../include/replication/walreceiver.h.html#LN263"><span class='Ref_to_Macro'>walrcv_disconnect</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN417"><span class='Ref_To_Local'>wrconn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* And we are done with the remote side. */ 
</span>        <a href="../../include/replication/walreceiver.h.html#LN263"><span class='Ref_to_Macro'>walrcv_disconnect</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN417"><span class='Ref_To_Local'>wrconn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if connect &raquo; </span> 
    <span class='Control'>else</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"tables were not subscribed, you will have to run "</span> 
                        <span class='String'>"ALTER SUBSCRIPTION ... REFRESH PUBLICATION to "</span> 
                        <span class='String'>"subscribe the tables"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN305"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN314"><span class='Ref_To_Local'>enabled</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/replication/logicallauncher.h.html#LN23"><span class='Ref_to_Proto'>ApplyLauncherWakeupAtCommit</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN306"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_subscription.h.html#LN21"><span class='Ref_to_Const'>SubscriptionRelationId</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN307"><span class='Ref_To_Local'>subid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN144"><span class='Ref_to_Macro'>InvokeObjectPostCreateHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_subscription.h.html#LN21"><span class='Ref_to_Const'>SubscriptionRelationId</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN307"><span class='Ref_To_Local'>subid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="subscriptioncmds.c.html#LN306"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CreateSubscription &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN502"></a><span class='Declare_Function'>AlterSubscription_refresh</span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_subscription.h.html#LN74"><span class='Ref_to_Struct'>Subscription</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>sub</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>copy_data</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN504"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>err</span><span class='Delimiter'>; 
</span><a name="LN505"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>pubrel_names</span><span class='Delimiter'>; 
</span><a name="LN506"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>subrel_states</span><span class='Delimiter'>; 
</span><a name="LN507"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>subrel_local_oids</span><span class='Delimiter'>; 
</span><a name="LN508"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>pubrel_local_oids</span><span class='Delimiter'>; 
</span><a name="LN509"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span><a name="LN510"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>off</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Load the library providing us libpq calls. */ 
</span>    <a href="../utils/fmgr/dfmgr.c.html#LN135"><span class='Ref_to_Func'>load_file</span></a><span class='Parentheses'>(</span><span class='String'>"libpqwalreceiver"</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Try to connect to the publisher. */ 
</span>    <a href="../replication/walreceiver.c.html#LN78"><span class='Ref_to_Global_Var'>wrconn</span></a> <span class='Operator'>= </span><a href="../../include/replication/walreceiver.h.html#LN241"><span class='Ref_to_Macro'>walrcv_connect</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN502"><span class='Ref_to_Parameter'>sub</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/pg_subscription.h.html#LN82"><span class='Ref_to_Member'>conninfo</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN502"><span class='Ref_to_Parameter'>sub</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/pg_subscription.h.html#LN79"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN504"><span class='Ref_To_Local'>err</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../replication/walreceiver.c.html#LN78"><span class='Ref_to_Global_Var'>wrconn</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not connect to the publisher: %s"</span><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN504"><span class='Ref_To_Local'>err</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get the table list from publisher. */ 
</span>    <a href="subscriptioncmds.c.html#LN505"><span class='Ref_To_Local'>pubrel_names</span></a> <span class='Operator'>= </span><a href="subscriptioncmds.c.html#LN53"><span class='Ref_to_Proto'>fetch_table_list</span></a><span class='Parentheses'>(</span><a href="../replication/walreceiver.c.html#LN78"><span class='Ref_to_Global_Var'>wrconn</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN502"><span class='Ref_to_Parameter'>sub</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/pg_subscription.h.html#LN85"><span class='Ref_to_Member'>publications</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We are done with the remote side, close connection. */ 
</span>    <a href="../../include/replication/walreceiver.h.html#LN263"><span class='Ref_to_Macro'>walrcv_disconnect</span></a><span class='Parentheses'>(</span><a href="../replication/walreceiver.c.html#LN78"><span class='Ref_to_Global_Var'>wrconn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get local table list. */ 
</span>    <a href="subscriptioncmds.c.html#LN506"><span class='Ref_To_Local'>subrel_states</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_subscription_rel.h.html#LN78"><span class='Ref_to_Proto'>GetSubscriptionRelations</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN502"><span class='Ref_to_Parameter'>sub</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/pg_subscription.h.html#LN76"><span class='Ref_to_Member'>oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Build qsorted array of local table oids for faster lookup. This can 
     * potentially contain all tables in the database so speed of lookup is 
     * important. 
     */ 
</span>    <a href="subscriptioncmds.c.html#LN507"><span class='Ref_To_Local'>subrel_local_oids</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN506"><span class='Ref_To_Local'>subrel_states</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="subscriptioncmds.c.html#LN510"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN509"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN506"><span class='Ref_To_Local'>subrel_states</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN539"></a>        <a href="../../include/catalog/pg_subscription_rel.h.html#LN65"><span class='Ref_to_Struct'>SubscriptionRelState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>relstate</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_subscription_rel.h.html#LN65"><span class='Ref_to_Struct'>SubscriptionRelState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN509"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="subscriptioncmds.c.html#LN507"><span class='Ref_To_Local'>subrel_local_oids</span></a><span class='Delimiter'>[</span><a href="subscriptioncmds.c.html#LN510"><span class='Ref_To_Local'>off</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="subscriptioncmds.c.html#LN539"><span class='Ref_To_Local'>relstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/pg_subscription_rel.h.html#LN67"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/port.h.html#LN439"><span class='Ref_to_Macro'>qsort</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN507"><span class='Ref_To_Local'>subrel_local_oids</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN506"><span class='Ref_To_Local'>subrel_states</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>          <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/utils/builtins.h.html#LN69"><span class='Ref_to_Proto'>oid_cmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Walk over the remote tables and try to match them to locally known 
     * tables. If the table is not known locally create a new state for it. 
     * 
     * Also builds array of local oids of remote tables for the next step. 
     */ 
</span>    <a href="subscriptioncmds.c.html#LN510"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="subscriptioncmds.c.html#LN508"><span class='Ref_To_Local'>pubrel_local_oids</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN505"><span class='Ref_To_Local'>pubrel_names</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN509"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN505"><span class='Ref_To_Local'>pubrel_names</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN557"></a>        <a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>rv</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN509"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN558"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span><span class='Delimiter'>; 
</span> 
        <a href="subscriptioncmds.c.html#LN558"><span class='Ref_To_Local'>relid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN52"><span class='Ref_to_Macro'>RangeVarGetRelid</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN557"><span class='Ref_To_Local'>rv</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Check for supported relkind. */ 
</span>        <a href="../../include/executor/executor.h.html#LN537"><span class='Ref_to_Proto'>CheckSubscriptionRelkind</span></a><span class='Parentheses'>(</span><a href="../../include/utils/lsyscache.h.html#LN127"><span class='Ref_to_Proto'>get_rel_relkind</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN558"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="subscriptioncmds.c.html#LN557"><span class='Ref_To_Local'>rv</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN66"><span class='Ref_to_Member'>schemaname</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN557"><span class='Ref_To_Local'>rv</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="subscriptioncmds.c.html#LN508"><span class='Ref_To_Local'>pubrel_local_oids</span></a><span class='Delimiter'>[</span><a href="subscriptioncmds.c.html#LN510"><span class='Ref_To_Local'>off</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="subscriptioncmds.c.html#LN558"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>bsearch<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN558"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN507"><span class='Ref_To_Local'>subrel_local_oids</span></a><span class='Delimiter'>, 
</span>                     <a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN506"><span class='Ref_To_Local'>subrel_states</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/utils/builtins.h.html#LN69"><span class='Ref_to_Proto'>oid_cmp</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/catalog/pg_subscription_rel.h.html#LN72"><span class='Ref_to_Proto'>SetSubscriptionRelState</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN502"><span class='Ref_to_Parameter'>sub</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/pg_subscription.h.html#LN76"><span class='Ref_to_Member'>oid</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN558"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, 
</span>                          <a href="subscriptioncmds.c.html#LN502"><span class='Ref_to_Parameter'>copy_data</span></a> <span class='Operator'>? </span><a href="../../include/catalog/pg_subscription_rel.h.html#LN53"><span class='Ref_to_Const'>SUBREL_STATE_INIT</span></a> <span class='Operator'>: </span><a href="../../include/catalog/pg_subscription_rel.h.html#LN58"><span class='Ref_to_Const'>SUBREL_STATE_READY</span></a><span class='Delimiter'>, 
</span>                                    <a href="../../include/access/xlogdefs.h.html#LN27"><span class='Ref_to_Const'>InvalidXLogRecPtr</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"added subscription for table %s.%s"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/builtins.h.html#LN77"><span class='Ref_to_Proto'>quote_identifier</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN557"><span class='Ref_To_Local'>rv</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN66"><span class='Ref_to_Member'>schemaname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/builtins.h.html#LN77"><span class='Ref_to_Proto'>quote_identifier</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN557"><span class='Ref_To_Local'>rv</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Next remove state for tables we should not care about anymore using the 
     * data we collected above 
     */ 
</span>    <a href="../../include/port.h.html#LN439"><span class='Ref_to_Macro'>qsort</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN508"><span class='Ref_To_Local'>pubrel_local_oids</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN505"><span class='Ref_To_Local'>pubrel_names</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>          <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/utils/builtins.h.html#LN69"><span class='Ref_to_Proto'>oid_cmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN510"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="subscriptioncmds.c.html#LN510"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>&LT; </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN506"><span class='Ref_To_Local'>subrel_states</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="subscriptioncmds.c.html#LN510"><span class='Ref_To_Local'>off</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN590"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span> <span class='Operator'>= </span><a href="subscriptioncmds.c.html#LN507"><span class='Ref_To_Local'>subrel_local_oids</span></a><span class='Delimiter'>[</span><a href="subscriptioncmds.c.html#LN510"><span class='Ref_To_Local'>off</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>bsearch<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN590"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN508"><span class='Ref_To_Local'>pubrel_local_oids</span></a><span class='Delimiter'>, 
</span>                     <a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN505"><span class='Ref_To_Local'>pubrel_names</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/utils/builtins.h.html#LN69"><span class='Ref_to_Proto'>oid_cmp</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN595"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>namespace</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/catalog/pg_subscription_rel.h.html#LN76"><span class='Ref_to_Proto'>RemoveSubscriptionRel</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN502"><span class='Ref_to_Parameter'>sub</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/pg_subscription.h.html#LN76"><span class='Ref_to_Member'>oid</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN590"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/replication/worker_internal.h.html#LN75"><span class='Ref_to_Proto'>logicalrep_worker_stop</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN502"><span class='Ref_to_Parameter'>sub</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/pg_subscription.h.html#LN76"><span class='Ref_to_Member'>oid</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN590"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>namespace</span> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="../../include/utils/lsyscache.h.html#LN125"><span class='Ref_to_Proto'>get_rel_namespace</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN590"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"removed subscription for table %s.%s"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/builtins.h.html#LN77"><span class='Ref_to_Proto'>quote_identifier</span></a><span class='Parentheses'>(</span><span class='Control'>namespace</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/builtins.h.html#LN77"><span class='Ref_to_Proto'>quote_identifier</span></a><span class='Parentheses'>(</span><a href="../../include/utils/lsyscache.h.html#LN124"><span class='Ref_to_Proto'>get_rel_name</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN590"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>)))))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for off=0;off&LT;list_length... &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end AlterSubscription_refresh &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Alter the existing subscription. 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN614"></a><span class='Declare_Function'>AlterSubscription</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN3388"><span class='Ref_to_Struct'>AlterSubscriptionStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN616"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN617"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>myself</span><span class='Delimiter'>; 
</span><a name="LN618"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription.h.html#LN63"><span class='Ref_to_Const'>Natts_pg_subscription</span></a><span class='Delimiter'>]; 
</span><a name="LN619"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>replaces</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription.h.html#LN63"><span class='Ref_to_Const'>Natts_pg_subscription</span></a><span class='Delimiter'>]; 
</span><a name="LN620"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription.h.html#LN63"><span class='Ref_to_Const'>Natts_pg_subscription</span></a><span class='Delimiter'>]; 
</span><a name="LN621"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN622"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>subid</span><span class='Delimiter'>; 
</span><a name="LN623"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>update_tuple</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN624"></a>    <a href="../../include/catalog/pg_subscription.h.html#LN74"><span class='Ref_to_Struct'>Subscription</span></a> <span class='Operator'>*</span><span class='Declare_Local'>sub</span><span class='Delimiter'>; 
</span> 
    <a href="subscriptioncmds.c.html#LN616"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_subscription.h.html#LN21"><span class='Ref_to_Const'>SubscriptionRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Fetch the existing tuple. */ 
</span>    <a href="subscriptioncmds.c.html#LN621"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN166"><span class='Ref_to_Macro'>SearchSysCacheCopy2</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN91"><span class='Ref_to_EnumConst'>SUBSCRIPTIONNAME</span></a><span class='Delimiter'>, </span><a href="../utils/init/globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN614"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3392"><span class='Ref_to_Member'>subname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN621"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"subscription \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="subscriptioncmds.c.html#LN614"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3392"><span class='Ref_to_Member'>subname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* must be owner */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN328"><span class='Ref_to_Proto'>pg_subscription_ownercheck</span></a><span class='Parentheses'>(</span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN621"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN203"><span class='Ref_to_EnumConst'>ACL_KIND_SUBSCRIPTION</span></a><span class='Delimiter'>, 
</span>                       <a href="subscriptioncmds.c.html#LN614"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3392"><span class='Ref_to_Member'>subname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="subscriptioncmds.c.html#LN622"><span class='Ref_To_Local'>subid</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN621"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subscriptioncmds.c.html#LN624"><span class='Ref_To_Local'>sub</span></a> <span class='Operator'>= </span><a href="../catalog/pg_subscription.c.html#LN43"><span class='Ref_to_Func'>GetSubscription</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN622"><span class='Ref_To_Local'>subid</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Form a new tuple. */ 
</span>    memset<span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN620"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN620"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN618"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN618"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN619"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN619"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN614"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3391"><span class='Ref_to_Member'>kind</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN3381"><span class='Ref_to_EnumConst'>ALTER_SUBSCRIPTION_OPTIONS</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN655"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>slotname</span><span class='Delimiter'>; 
</span><a name="LN656"></a>                <span class='Keyword'>bool</span>        <span class='Declare_Local'>slotname_given</span><span class='Delimiter'>; 
</span><a name="LN657"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>synchronous_commit</span><span class='Delimiter'>; 
</span> 
                <a href="subscriptioncmds.c.html#LN62"><span class='Ref_to_Func'>parse_subscription_options</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN614"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3395"><span class='Ref_to_Member'>options</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                           <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN656"><span class='Ref_To_Local'>slotname_given</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN655"><span class='Ref_To_Local'>slotname</span></a><span class='Delimiter'>, 
</span>                                           <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN657"><span class='Ref_To_Local'>synchronous_commit</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN656"><span class='Ref_To_Local'>slotname_given</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN624"><span class='Ref_To_Local'>sub</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/pg_subscription.h.html#LN81"><span class='Ref_to_Member'>enabled</span></a> <span class='Operator'>&& !</span><a href="subscriptioncmds.c.html#LN655"><span class='Ref_To_Local'>slotname</span></a><span class='Parentheses'>) 
</span>                        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot set slot_name = NONE for enabled subscription"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN655"><span class='Ref_To_Local'>slotname</span></a><span class='Parentheses'>) 
</span>                        <a href="subscriptioncmds.c.html#LN620"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription.h.html#LN69"><span class='Ref_to_Const'>Anum_pg_subscription_subslotname</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                            <a href="../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../utils/adt/name.c.html#LN44"><span class='Ref_to_Func'>namein</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN655"><span class='Ref_To_Local'>slotname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <a href="subscriptioncmds.c.html#LN618"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription.h.html#LN69"><span class='Ref_to_Const'>Anum_pg_subscription_subslotname</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <a href="subscriptioncmds.c.html#LN619"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription.h.html#LN69"><span class='Ref_to_Const'>Anum_pg_subscription_subslotname</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN657"><span class='Ref_To_Local'>synchronous_commit</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="subscriptioncmds.c.html#LN620"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription.h.html#LN70"><span class='Ref_to_Const'>Anum_pg_subscription_subsynccommit</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                        <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN657"><span class='Ref_To_Local'>synchronous_commit</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="subscriptioncmds.c.html#LN619"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription.h.html#LN70"><span class='Ref_to_Const'>Anum_pg_subscription_subsynccommit</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <a href="subscriptioncmds.c.html#LN623"><span class='Ref_To_Local'>update_tuple</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN3385"><span class='Ref_to_EnumConst'>ALTER_SUBSCRIPTION_ENABLED</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN691"></a>                <span class='Keyword'>bool</span>        <span class='Declare_Local'>enabled</span><span class='Delimiter'>, 
</span><a name="LN692"></a>                            <span class='Declare_Local'>enabled_given</span><span class='Delimiter'>; 
</span> 
                <a href="subscriptioncmds.c.html#LN62"><span class='Ref_to_Func'>parse_subscription_options</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN614"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3395"><span class='Ref_to_Member'>options</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                           <span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN692"><span class='Ref_To_Local'>enabled_given</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN691"><span class='Ref_To_Local'>enabled</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                           <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN692"><span class='Ref_To_Local'>enabled_given</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="subscriptioncmds.c.html#LN624"><span class='Ref_To_Local'>sub</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/pg_subscription.h.html#LN83"><span class='Ref_to_Member'>slotname</span></a> <span class='Operator'>&& </span><a href="subscriptioncmds.c.html#LN691"><span class='Ref_To_Local'>enabled</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot enable subscription that does not have a slot name"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                <a href="subscriptioncmds.c.html#LN620"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription.h.html#LN67"><span class='Ref_to_Const'>Anum_pg_subscription_subenabled</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                    <a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN691"><span class='Ref_To_Local'>enabled</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="subscriptioncmds.c.html#LN619"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription.h.html#LN67"><span class='Ref_to_Const'>Anum_pg_subscription_subenabled</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN691"><span class='Ref_To_Local'>enabled</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/replication/logicallauncher.h.html#LN23"><span class='Ref_to_Proto'>ApplyLauncherWakeupAtCommit</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
                <a href="subscriptioncmds.c.html#LN623"><span class='Ref_To_Local'>update_tuple</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN3382"><span class='Ref_to_EnumConst'>ALTER_SUBSCRIPTION_CONNECTION</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Load the library providing us libpq calls. */ 
</span>            <a href="../utils/fmgr/dfmgr.c.html#LN135"><span class='Ref_to_Func'>load_file</span></a><span class='Parentheses'>(</span><span class='String'>"libpqwalreceiver"</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Check the connection info string. */ 
</span>            <a href="../../include/replication/walreceiver.h.html#LN243"><span class='Ref_to_Macro'>walrcv_check_conninfo</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN614"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3393"><span class='Ref_to_Member'>conninfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="subscriptioncmds.c.html#LN620"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription.h.html#LN68"><span class='Ref_to_Const'>Anum_pg_subscription_subconninfo</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN614"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3393"><span class='Ref_to_Member'>conninfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="subscriptioncmds.c.html#LN619"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription.h.html#LN68"><span class='Ref_to_Const'>Anum_pg_subscription_subconninfo</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="subscriptioncmds.c.html#LN623"><span class='Ref_To_Local'>update_tuple</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN3383"><span class='Ref_to_EnumConst'>ALTER_SUBSCRIPTION_PUBLICATION</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN729"></a>                <span class='Keyword'>bool</span>        <span class='Declare_Local'>copy_data</span><span class='Delimiter'>; 
</span><a name="LN730"></a>                <span class='Keyword'>bool</span>        <span class='Declare_Local'>refresh</span><span class='Delimiter'>; 
</span> 
                <a href="subscriptioncmds.c.html#LN62"><span class='Ref_to_Func'>parse_subscription_options</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN614"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3395"><span class='Ref_to_Member'>options</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                           <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN729"><span class='Ref_To_Local'>copy_data</span></a><span class='Delimiter'>, 
</span>                                           <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN730"><span class='Ref_To_Local'>refresh</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="subscriptioncmds.c.html#LN620"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription.h.html#LN71"><span class='Ref_to_Const'>Anum_pg_subscription_subpublications</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                    <a href="subscriptioncmds.c.html#LN248"><span class='Ref_to_Func'>publicationListToArray</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN614"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3394"><span class='Ref_to_Member'>publication</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="subscriptioncmds.c.html#LN619"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription.h.html#LN71"><span class='Ref_to_Const'>Anum_pg_subscription_subpublications</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
                <a href="subscriptioncmds.c.html#LN623"><span class='Ref_To_Local'>update_tuple</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Refresh if user asked us to. */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN730"><span class='Ref_To_Local'>refresh</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="subscriptioncmds.c.html#LN624"><span class='Ref_To_Local'>sub</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/pg_subscription.h.html#LN81"><span class='Ref_to_Member'>enabled</span></a><span class='Parentheses'>) 
</span>                        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"ALTER SUBSCRIPTION with refresh is not allowed for disabled subscriptions"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Use ALTER SUBSCRIPTION ... SET PUBLICATION ... WITH (refresh = false)."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* Make sure refresh sees the new list of publications. */ 
</span>                    <a href="subscriptioncmds.c.html#LN624"><span class='Ref_To_Local'>sub</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/pg_subscription.h.html#LN85"><span class='Ref_to_Member'>publications</span></a> <span class='Operator'>= </span><a href="subscriptioncmds.c.html#LN614"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3394"><span class='Ref_to_Member'>publication</span></a><span class='Delimiter'>; 
</span> 
                    <a href="subscriptioncmds.c.html#LN501"><span class='Ref_to_Func'>AlterSubscription_refresh</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN624"><span class='Ref_To_Local'>sub</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN729"><span class='Ref_To_Local'>copy_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN3384"><span class='Ref_to_EnumConst'>ALTER_SUBSCRIPTION_REFRESH</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN762"></a>                <span class='Keyword'>bool</span>        <span class='Declare_Local'>copy_data</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="subscriptioncmds.c.html#LN624"><span class='Ref_To_Local'>sub</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/pg_subscription.h.html#LN81"><span class='Ref_to_Member'>enabled</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"ALTER SUBSCRIPTION ... REFRESH is not allowed for disabled subscriptions"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                <a href="subscriptioncmds.c.html#LN62"><span class='Ref_to_Func'>parse_subscription_options</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN614"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3395"><span class='Ref_to_Member'>options</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                           <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN762"><span class='Ref_To_Local'>copy_data</span></a><span class='Delimiter'>, 
</span>                                           <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="subscriptioncmds.c.html#LN501"><span class='Ref_to_Func'>AlterSubscription_refresh</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN624"><span class='Ref_To_Local'>sub</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN762"><span class='Ref_To_Local'>copy_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized ALTER SUBSCRIPTION kind %d"</span><span class='Delimiter'>, 
</span>                 <a href="subscriptioncmds.c.html#LN614"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3391"><span class='Ref_to_Member'>kind</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch stmt-&GT;kind &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Update the catalog if needed. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN623"><span class='Ref_To_Local'>update_tuple</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="subscriptioncmds.c.html#LN621"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN621"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN616"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN620"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN618"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, 
</span>                                <a href="subscriptioncmds.c.html#LN619"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN616"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN621"><span class='Ref_To_Local'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN621"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN621"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN616"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN617"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_subscription.h.html#LN21"><span class='Ref_to_Const'>SubscriptionRelationId</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN622"><span class='Ref_To_Local'>subid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_subscription.h.html#LN21"><span class='Ref_to_Const'>SubscriptionRelationId</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN622"><span class='Ref_To_Local'>subid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="subscriptioncmds.c.html#LN617"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterSubscription &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Drop a subscription 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN807"></a><span class='Declare_Function'>DropSubscription</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN3398"><span class='Ref_to_Struct'>DropSubscriptionStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isTopLevel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN809"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN810"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>myself</span><span class='Delimiter'>; 
</span><a name="LN811"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN812"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>subid</span><span class='Delimiter'>; 
</span><a name="LN813"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>datum</span><span class='Delimiter'>; 
</span><a name="LN814"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN815"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>subname</span><span class='Delimiter'>; 
</span><a name="LN816"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>conninfo</span><span class='Delimiter'>; 
</span><a name="LN817"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>slotname</span><span class='Delimiter'>; 
</span><a name="LN818"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>originname</span><span class='Delimiter'>[</span><a href="../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a><span class='Delimiter'>]; 
</span><a name="LN819"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>err</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN820"></a>    <a href="../../include/access/xlogdefs.h.html#LN50"><span class='Ref_to_Typedef'>RepOriginId</span></a> <span class='Declare_Local'>originid</span><span class='Delimiter'>; 
</span><a name="LN821"></a>    <a href="../replication/libpqwalreceiver/libpqwalreceiver.c.html#LN39"><span class='Ref_to_Struct'>WalReceiverConn</span></a> <span class='Operator'>*</span><span class='Declare_Local'>wrconn</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN822"></a>    <a href="../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>cmd</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Lock pg_subscription with AccessExclusiveLock to ensure that the 
     * launcher doesn't restart new worker during dropping the subscription 
     */ 
</span>    <a href="subscriptioncmds.c.html#LN809"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_subscription.h.html#LN21"><span class='Ref_to_Const'>SubscriptionRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="subscriptioncmds.c.html#LN811"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN157"><span class='Ref_to_Macro'>SearchSysCache2</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN91"><span class='Ref_to_EnumConst'>SUBSCRIPTIONNAME</span></a><span class='Delimiter'>, </span><a href="../utils/init/globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a><span class='Delimiter'>, 
</span>                          <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN807"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3401"><span class='Ref_to_Member'>subname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN811"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN809"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="subscriptioncmds.c.html#LN807"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3402"><span class='Ref_to_Member'>missing_ok</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"subscription \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                            <a href="subscriptioncmds.c.html#LN807"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3401"><span class='Ref_to_Member'>subname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"subscription \"%s\" does not exist, skipping"</span><span class='Delimiter'>, 
</span>                            <a href="subscriptioncmds.c.html#LN807"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3401"><span class='Ref_to_Member'>subname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="subscriptioncmds.c.html#LN812"><span class='Ref_To_Local'>subid</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN811"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* must be owner */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN328"><span class='Ref_to_Proto'>pg_subscription_ownercheck</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN812"><span class='Ref_To_Local'>subid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN203"><span class='Ref_to_EnumConst'>ACL_KIND_SUBSCRIPTION</span></a><span class='Delimiter'>, 
</span>                       <a href="subscriptioncmds.c.html#LN807"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3401"><span class='Ref_to_Member'>subname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* DROP hook for the subscription being removed */ 
</span>    <a href="../../include/catalog/objectaccess.h.html#LN153"><span class='Ref_to_Macro'>InvokeObjectDropHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_subscription.h.html#LN21"><span class='Ref_to_Const'>SubscriptionRelationId</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN812"><span class='Ref_To_Local'>subid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Lock the subscription so nobody else can do anything with it (including 
     * the replication workers). 
     */ 
</span>    <a href="../../include/storage/lmgr.h.html#LN93"><span class='Ref_to_Proto'>LockSharedObject</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_subscription.h.html#LN21"><span class='Ref_to_Const'>SubscriptionRelationId</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN812"><span class='Ref_To_Local'>subid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get subname */ 
</span>    <a href="subscriptioncmds.c.html#LN813"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN92"><span class='Ref_to_EnumConst'>SUBSCRIPTIONOID</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN811"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>, 
</span>                            <a href="../../include/catalog/pg_subscription.h.html#LN65"><span class='Ref_to_Const'>Anum_pg_subscription_subname</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN814"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="subscriptioncmds.c.html#LN814"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subscriptioncmds.c.html#LN815"><span class='Ref_To_Local'>subname</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="../../include/postgres.h.html#LN590"><span class='Ref_to_Macro'>DatumGetName</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN813"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get conninfo */ 
</span>    <a href="subscriptioncmds.c.html#LN813"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN92"><span class='Ref_to_EnumConst'>SUBSCRIPTIONOID</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN811"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>, 
</span>                            <a href="../../include/catalog/pg_subscription.h.html#LN68"><span class='Ref_to_Const'>Anum_pg_subscription_subconninfo</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN814"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="subscriptioncmds.c.html#LN814"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subscriptioncmds.c.html#LN816"><span class='Ref_To_Local'>conninfo</span></a> <span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN813"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get slotname */ 
</span>    <a href="subscriptioncmds.c.html#LN813"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN92"><span class='Ref_to_EnumConst'>SUBSCRIPTIONOID</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN811"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>, 
</span>                            <a href="../../include/catalog/pg_subscription.h.html#LN69"><span class='Ref_to_Const'>Anum_pg_subscription_subslotname</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN814"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="subscriptioncmds.c.html#LN814"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>        <a href="subscriptioncmds.c.html#LN817"><span class='Ref_To_Local'>slotname</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="../../include/postgres.h.html#LN590"><span class='Ref_to_Macro'>DatumGetName</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN813"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="subscriptioncmds.c.html#LN817"><span class='Ref_To_Local'>slotname</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Since dropping a replication slot is not transactional, the replication 
     * slot stays dropped even if the transaction rolls back.  So we cannot 
     * run DROP SUBSCRIPTION inside a transaction block if dropping the 
     * replication slot. 
     * 
     * XXX The command name should really be something like "DROP SUBSCRIPTION 
     * of a subscription that is associated with a replication slot", but we 
     * don't have the proper facilities for that. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN817"><span class='Ref_To_Local'>slotname</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/access/xact.h.html#LN370"><span class='Ref_to_Proto'>PreventTransactionChain</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN807"><span class='Ref_to_Parameter'>isTopLevel</span></a><span class='Delimiter'>, </span><span class='String'>"DROP SUBSCRIPTION"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN810"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_subscription.h.html#LN21"><span class='Ref_to_Const'>SubscriptionRelationId</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN812"><span class='Ref_To_Local'>subid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/commands/event_trigger.h.html#LN61"><span class='Ref_to_Proto'>EventTriggerSQLDropAddObject</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN810"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Remove the tuple from catalog. */ 
</span>    <a href="../../include/catalog/indexing.h.html#LN40"><span class='Ref_to_Proto'>CatalogTupleDelete</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN809"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN811"><span class='Ref_To_Local'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN811"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Clean up dependencies */ 
</span>    <a href="../../include/catalog/dependency.h.html#LN254"><span class='Ref_to_Proto'>deleteSharedDependencyRecordsFor</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_subscription.h.html#LN21"><span class='Ref_to_Const'>SubscriptionRelationId</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN812"><span class='Ref_To_Local'>subid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Remove any associated relation synchronization states. */ 
</span>    <a href="../../include/catalog/pg_subscription_rel.h.html#LN76"><span class='Ref_to_Proto'>RemoveSubscriptionRel</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN812"><span class='Ref_To_Local'>subid</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Kill the apply worker so that the slot becomes accessible. */ 
</span>    <a href="../../include/replication/worker_internal.h.html#LN75"><span class='Ref_to_Proto'>logicalrep_worker_stop</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN812"><span class='Ref_To_Local'>subid</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Remove the origin tracking if exists. */ 
</span>    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN818"><span class='Ref_To_Local'>originname</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN818"><span class='Ref_To_Local'>originname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"pg_%u"</span><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN812"><span class='Ref_To_Local'>subid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subscriptioncmds.c.html#LN820"><span class='Ref_To_Local'>originid</span></a> <span class='Operator'>= </span><a href="../../include/replication/origin.h.html#LN41"><span class='Ref_to_Proto'>replorigin_by_name</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN818"><span class='Ref_To_Local'>originname</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN820"><span class='Ref_To_Local'>originid</span></a> <span class='Operator'>!= </span><a href="../../include/replication/origin.h.html#LN33"><span class='Ref_to_Const'>InvalidRepOriginId</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/replication/origin.h.html#LN43"><span class='Ref_to_Proto'>replorigin_drop</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN820"><span class='Ref_To_Local'>originid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If there is no slot associated with the subscription, we can finish 
     * here. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="subscriptioncmds.c.html#LN817"><span class='Ref_To_Local'>slotname</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN809"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Otherwise drop the replication slot at the publisher node using the 
     * replication connection. 
     */ 
</span>    <a href="../utils/fmgr/dfmgr.c.html#LN135"><span class='Ref_to_Func'>load_file</span></a><span class='Parentheses'>(</span><span class='String'>"libpqwalreceiver"</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN822"><span class='Ref_To_Local'>cmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN822"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, </span><span class='String'>"DROP_REPLICATION_SLOT %s"</span><span class='Delimiter'>, </span><a href="../../include/utils/builtins.h.html#LN77"><span class='Ref_to_Proto'>quote_identifier</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN817"><span class='Ref_To_Local'>slotname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="subscriptioncmds.c.html#LN821"><span class='Ref_To_Local'>wrconn</span></a> <span class='Operator'>= </span><a href="../../include/replication/walreceiver.h.html#LN241"><span class='Ref_to_Macro'>walrcv_connect</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN816"><span class='Ref_To_Local'>conninfo</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN815"><span class='Ref_To_Local'>subname</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN819"><span class='Ref_To_Local'>err</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN821"><span class='Ref_To_Local'>wrconn</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not connect to publisher when attempting to "</span> 
                        <span class='String'>"drop the replication slot \"%s\""</span><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN817"><span class='Ref_To_Local'>slotname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"The error was: %s"</span><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN819"><span class='Ref_To_Local'>err</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Use ALTER SUBSCRIPTION ... SET (slot_name = NONE) "</span> 
                         <span class='String'>"to disassociate the subscription from the slot."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span><a name="LN953"></a>        <a href="../../include/replication/walreceiver.h.html#LN184"><span class='Ref_to_Struct'>WalRcvExecResult</span></a> <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
        <a href="subscriptioncmds.c.html#LN953"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../include/replication/walreceiver.h.html#LN261"><span class='Ref_to_Macro'>walrcv_exec</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN821"><span class='Ref_To_Local'>wrconn</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN822"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN953"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="../../include/replication/walreceiver.h.html#LN186"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>!= </span><a href="../../include/replication/walreceiver.h.html#LN171"><span class='Ref_to_EnumConst'>WALRCV_OK_COMMAND</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not drop the replication slot \"%s\" on publisher"</span><span class='Delimiter'>, 
</span>                    <a href="subscriptioncmds.c.html#LN817"><span class='Ref_To_Local'>slotname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"The error was: %s"</span><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN953"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="../../include/replication/walreceiver.h.html#LN187"><span class='Ref_to_Member'>err</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"dropped replication slot \"%s\" on publisher"</span><span class='Delimiter'>, 
</span>                            <a href="subscriptioncmds.c.html#LN817"><span class='Ref_To_Local'>slotname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/replication/walreceiver.h.html#LN266"><span class='Ref_to_Func'>walrcv_clear_result</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN953"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Close the connection in case of failure */ 
</span>        <a href="../../include/replication/walreceiver.h.html#LN263"><span class='Ref_to_Macro'>walrcv_disconnect</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN821"><span class='Ref_To_Local'>wrconn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/replication/walreceiver.h.html#LN263"><span class='Ref_to_Macro'>walrcv_disconnect</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN821"><span class='Ref_To_Local'>wrconn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN822"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN809"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DropSubscription &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Internal workhorse for changing a subscription owner 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN988"></a><span class='Declare_Function'>AlterSubscriptionOwner_internal</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tup</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>newOwnerId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN990"></a>    <a href="../../include/catalog/pg_subscription.h.html#LN57"><span class='Ref_to_Typedef'>Form_pg_subscription</span></a> <span class='Declare_Local'>form</span><span class='Delimiter'>; 
</span> 
    <a href="subscriptioncmds.c.html#LN990"><span class='Ref_To_Local'>form</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_subscription.h.html#LN57"><span class='Ref_to_Typedef'>Form_pg_subscription</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN988"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN990"><span class='Ref_To_Local'>form</span></a><span class='Operator'>-&GT;</span>subowner <span class='Operator'>== </span><a href="subscriptioncmds.c.html#LN988"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN328"><span class='Ref_to_Proto'>pg_subscription_ownercheck</span></a><span class='Parentheses'>(</span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN988"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN203"><span class='Ref_to_EnumConst'>ACL_KIND_SUBSCRIPTION</span></a><span class='Delimiter'>, 
</span>                       <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN990"><span class='Ref_To_Local'>form</span></a><span class='Operator'>-&GT;</span>subname<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* New owner must be a superuser */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN988"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>           <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied to change owner of subscription \"%s\""</span><span class='Delimiter'>, 
</span>                  <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN990"><span class='Ref_To_Local'>form</span></a><span class='Operator'>-&GT;</span>subname<span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>               <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"The owner of a subscription must be a superuser."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="subscriptioncmds.c.html#LN990"><span class='Ref_To_Local'>form</span></a><span class='Operator'>-&GT;</span>subowner <span class='Operator'>= </span><a href="subscriptioncmds.c.html#LN988"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Delimiter'>; 
</span>    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN988"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN988"><span class='Ref_to_Parameter'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN988"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Update owner dependency reference */ 
</span>    <a href="../../include/catalog/dependency.h.html#LN259"><span class='Ref_to_Proto'>changeDependencyOnOwner</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_subscription.h.html#LN21"><span class='Ref_to_Const'>SubscriptionRelationId</span></a><span class='Delimiter'>, 
</span>                            <a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN988"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="subscriptioncmds.c.html#LN988"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_subscription.h.html#LN21"><span class='Ref_to_Const'>SubscriptionRelationId</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN988"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterSubscriptionOwner_internal &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Change subscription owner -- by name 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN1025"></a><span class='Declare_Function'>AlterSubscriptionOwner</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>newOwnerId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1027"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>subid</span><span class='Delimiter'>; 
</span><a name="LN1028"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN1029"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN1030"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <a href="subscriptioncmds.c.html#LN1029"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_subscription.h.html#LN21"><span class='Ref_to_Const'>SubscriptionRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="subscriptioncmds.c.html#LN1028"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN166"><span class='Ref_to_Macro'>SearchSysCacheCopy2</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN91"><span class='Ref_to_EnumConst'>SUBSCRIPTIONNAME</span></a><span class='Delimiter'>, </span><a href="../utils/init/globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN1025"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN1028"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"subscription \"%s\" does not exist"</span><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN1025"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="subscriptioncmds.c.html#LN1027"><span class='Ref_To_Local'>subid</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN1028"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="subscriptioncmds.c.html#LN987"><span class='Ref_to_Func'>AlterSubscriptionOwner_internal</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN1029"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN1028"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN1025"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN1030"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_subscription.h.html#LN21"><span class='Ref_to_Const'>SubscriptionRelationId</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN1027"><span class='Ref_To_Local'>subid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN1028"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN1029"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="subscriptioncmds.c.html#LN1030"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterSubscriptionOwner &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Change subscription owner -- by OID 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1059"></a><span class='Declare_Function'>AlterSubscriptionOwner_oid</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>subid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>newOwnerId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1061"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN1062"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span> 
    <a href="subscriptioncmds.c.html#LN1062"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_subscription.h.html#LN21"><span class='Ref_to_Const'>SubscriptionRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="subscriptioncmds.c.html#LN1061"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN92"><span class='Ref_to_EnumConst'>SUBSCRIPTIONOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN1059"><span class='Ref_to_Parameter'>subid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN1061"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"subscription with OID %u does not exist"</span><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN1059"><span class='Ref_to_Parameter'>subid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="subscriptioncmds.c.html#LN987"><span class='Ref_to_Func'>AlterSubscriptionOwner_internal</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN1062"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN1061"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN1059"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN1061"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN1062"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterSubscriptionOwner_oid &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Get the list of tables which belong to specified publications on the 
 * publisher connection. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN1085"></a><span class='Declare_Function'>fetch_table_list</span><span class='Parentheses'>(</span><a href="../replication/libpqwalreceiver/libpqwalreceiver.c.html#LN39"><span class='Ref_to_Struct'>WalReceiverConn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>wrconn</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>publications</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1087"></a>    <a href="../../include/replication/walreceiver.h.html#LN184"><span class='Ref_to_Struct'>WalRcvExecResult</span></a> <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN1088"></a>    <a href="../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>cmd</span><span class='Delimiter'>; 
</span><a name="LN1089"></a>    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>slot</span><span class='Delimiter'>; 
</span><a name="LN1090"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tableRow</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{</span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>}; 
</span><a name="LN1091"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span><a name="LN1092"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>first</span><span class='Delimiter'>; 
</span><a name="LN1093"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tablelist</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN1085"><span class='Ref_to_Parameter'>publications</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN1088"><span class='Ref_To_Local'>cmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN1088"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, </span><span class='String'>"SELECT DISTINCT t.schemaname, t.tablename\n"</span> 
                     <span class='String'>"  FROM pg_catalog.pg_publication_tables t\n"</span> 
                     <span class='String'>" WHERE t.pubname IN ("</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="subscriptioncmds.c.html#LN1092"><span class='Ref_To_Local'>first</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN1091"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN1085"><span class='Ref_to_Parameter'>publications</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1104"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>pubname</span> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN1091"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN1092"><span class='Ref_To_Local'>first</span></a><span class='Parentheses'>) 
</span>            <a href="subscriptioncmds.c.html#LN1092"><span class='Ref_To_Local'>first</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN1088"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, </span><span class='String'>", "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN1088"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, </span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="../utils/adt/quote.c.html#LN100"><span class='Ref_to_Func'>quote_literal_cstr</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN1104"><span class='Ref_To_Local'>pubname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN1088"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, </span><span class='String'>")"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="subscriptioncmds.c.html#LN1087"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../include/replication/walreceiver.h.html#LN261"><span class='Ref_to_Macro'>walrcv_exec</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN1085"><span class='Ref_to_Parameter'>wrconn</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN1088"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN1090"><span class='Ref_To_Local'>tableRow</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN1088"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN1087"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="../../include/replication/walreceiver.h.html#LN186"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>!= </span><a href="../../include/replication/walreceiver.h.html#LN173"><span class='Ref_to_EnumConst'>WALRCV_OK_TUPLES</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not receive list of replicated tables from the publisher: %s"</span><span class='Delimiter'>, 
</span>                        <a href="subscriptioncmds.c.html#LN1087"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="../../include/replication/walreceiver.h.html#LN187"><span class='Ref_to_Member'>err</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Process tables. */ 
</span>    <a href="subscriptioncmds.c.html#LN1089"><span class='Ref_To_Local'>slot</span></a> <span class='Operator'>= </span><a href="../../include/executor/tuptable.h.html#LN144"><span class='Ref_to_Proto'>MakeSingleTupleTableSlot</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN1087"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="../../include/replication/walreceiver.h.html#LN189"><span class='Ref_to_Member'>tupledesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/utils/tuplestore.h.html#LN72"><span class='Ref_to_Proto'>tuplestore_gettupleslot</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN1087"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="../../include/replication/walreceiver.h.html#LN188"><span class='Ref_to_Member'>tuplestore</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN1089"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1127"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>nspname</span><span class='Delimiter'>; 
</span><a name="LN1128"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>relname</span><span class='Delimiter'>; 
</span><a name="LN1129"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN1130"></a>        <a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>rv</span><span class='Delimiter'>; 
</span> 
        <a href="subscriptioncmds.c.html#LN1127"><span class='Ref_To_Local'>nspname</span></a> <span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="../../include/executor/tuptable.h.html#LN167"><span class='Ref_to_Proto'>slot_getattr</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN1089"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN1129"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="subscriptioncmds.c.html#LN1129"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="subscriptioncmds.c.html#LN1128"><span class='Ref_To_Local'>relname</span></a> <span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="../../include/executor/tuptable.h.html#LN167"><span class='Ref_to_Proto'>slot_getattr</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN1089"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="subscriptioncmds.c.html#LN1129"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="subscriptioncmds.c.html#LN1129"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="subscriptioncmds.c.html#LN1130"><span class='Ref_To_Local'>rv</span></a> <span class='Operator'>= </span><a href="../../include/nodes/makefuncs.h.html#LN68"><span class='Ref_to_Proto'>makeRangeVar</span></a><span class='Parentheses'>(</span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN1127"><span class='Ref_To_Local'>nspname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN1128"><span class='Ref_To_Local'>relname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="subscriptioncmds.c.html#LN1093"><span class='Ref_To_Local'>tablelist</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN1093"><span class='Ref_To_Local'>tablelist</span></a><span class='Delimiter'>, </span><a href="subscriptioncmds.c.html#LN1130"><span class='Ref_To_Local'>rv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/executor/tuptable.h.html#LN154"><span class='Ref_to_Proto'>ExecClearTuple</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN1089"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/executor/tuptable.h.html#LN145"><span class='Ref_to_Proto'>ExecDropSingleTupleTableSlot</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN1089"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/replication/walreceiver.h.html#LN266"><span class='Ref_to_Func'>walrcv_clear_result</span></a><span class='Parentheses'>(</span><a href="subscriptioncmds.c.html#LN1087"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="subscriptioncmds.c.html#LN1093"><span class='Ref_To_Local'>tablelist</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end fetch_table_list &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>