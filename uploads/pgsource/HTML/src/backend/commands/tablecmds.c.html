<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\commands\tablecmds.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\commands\tablecmds.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:36 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * tablecmds.c 
 *    Commands for creating and altering table structures and settings 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/commands/tablecmds.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/genam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/heapam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/multixact.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/reloptions.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/relscan.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/sysattr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/tupconvert.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xact.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xlog.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/catalog.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/dependency.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/heap.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/index.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/indexing.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/namespace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/objectaccess.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/partition.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_am.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_collation.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_constraint.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_constraint_fn.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_depend.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_foreign_table.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_inherits.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_inherits_fn.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_namespace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_opclass.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_tablespace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_trigger.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type_fn.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/storage.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/storage_xlog.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/toasting.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/cluster.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/comment.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/defrem.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/event_trigger.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/policy.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/sequence.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/tablecmds.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/tablespace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/trigger.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/typecmds.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/user.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"executor/executor.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"foreign/foreign.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/makefuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/nodeFuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/parsenodes.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/clauses.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/planner.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/predtest.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/prep.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/var.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_clause.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_coerce.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_collate.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_expr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_oper.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_relation.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_utilcmd.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parser.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"pgstat.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"rewrite/rewriteDefine.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"rewrite/rewriteHandler.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"rewrite/rewriteManip.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/bufmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/lmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/lock.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/predicate.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/smgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/acl.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/fmgroids.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/inval.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/relcache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/ruleutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/snapmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/tqual.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/typcache.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * ON COMMIT action list 
 */ 
</span><a name="LN107"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>OnCommitItem</span> 
<span class='Delimiter'>{ 
</span><a name="LN109"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>relid</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* relid of relation */ 
</span><a name="LN110"></a>    <a href="../../include/nodes/primnodes.h.html#LN46"><span class='Ref_to_Enum'>OnCommitAction</span></a> <span class='Declare_Member'>oncommit</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* what to do at end of xact */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If this entry was created during the current transaction, 
     * creating_subid is the ID of the creating subxact; if created in a prior 
     * transaction, creating_subid is zero.  If deleted during the current 
     * transaction, deleting_subid is the ID of the deleting subxact; if no 
     * deletion request is pending, deleting_subid is zero. 
     */ 
</span><a name="LN119"></a>    <a href="../../include/c.h.html#LN400"><span class='Ref_to_Typedef'>SubTransactionId</span></a> <span class='Declare_Member'>creating_subid</span><span class='Delimiter'>; 
</span><a name="LN120"></a>    <a href="../../include/c.h.html#LN400"><span class='Ref_to_Typedef'>SubTransactionId</span></a> <span class='Declare_Member'>deleting_subid</span><span class='Delimiter'>; 
</span><a name="LN121"></a>} <span class='Declare_Typedef'>OnCommitItem</span><span class='Delimiter'>; 
</span> 
<a name="LN123"></a><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Var'>on_commits</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * State information for ALTER TABLE 
 * 
 * The pending-work queue for an ALTER TABLE is a List of AlteredTableInfo 
 * structs, one for each table modified by the operation (the named table 
 * plus any child tables that are affected).  We save lists of subcommands 
 * to apply to this table (possibly modified by parse transformation steps); 
 * these lists will be executed in Phase 2.  If a Phase 3 step is needed, 
 * necessary information is stored in the constraints and newvals lists. 
 * 
 * Phase 2 is divided into multiple passes; subcommands are executed in 
 * a pass determined by subcommand type. 
 */ 
</span> 
<a name="LN140"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>AT_PASS_UNSET</span>           <span class='Operator'>-</span><span class='Number'>1</span>      <span class='Comment_Single_Line'>/* UNSET will cause ERROR */ 
</span><a name="LN141"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>AT_PASS_DROP</span>            <span class='Number'>0</span>       <span class='Comment_Single_Line'>/* DROP (all flavors) */ 
</span><a name="LN142"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>AT_PASS_ALTER_TYPE</span>      <span class='Number'>1</span>       <span class='Comment_Single_Line'>/* ALTER COLUMN TYPE */ 
</span><a name="LN143"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>AT_PASS_OLD_INDEX</span>       <span class='Number'>2</span>       <span class='Comment_Single_Line'>/* re-add existing indexes */ 
</span><a name="LN144"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>AT_PASS_OLD_CONSTR</span>      <span class='Number'>3</span>       <span class='Comment_Single_Line'>/* re-add existing constraints */ 
</span><a name="LN145"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>AT_PASS_COL_ATTRS</span>       <span class='Number'>4</span>       <span class='Comment_Single_Line'>/* set other column attributes */ 
</span><span class='Comment_Multi_Line'>/* We could support a RENAME COLUMN pass here, but not currently used */ 
</span><a name="LN147"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>AT_PASS_ADD_COL</span>         <span class='Number'>5</span>       <span class='Comment_Single_Line'>/* ADD COLUMN */ 
</span><a name="LN148"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>AT_PASS_ADD_INDEX</span>       <span class='Number'>6</span>       <span class='Comment_Single_Line'>/* ADD indexes */ 
</span><a name="LN149"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>AT_PASS_ADD_CONSTR</span>      <span class='Number'>7</span>       <span class='Comment_Single_Line'>/* ADD constraints, defaults */ 
</span><a name="LN150"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>AT_PASS_MISC</span>            <span class='Number'>8</span>       <span class='Comment_Single_Line'>/* other stuff */ 
</span><a name="LN151"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>AT_NUM_PASSES</span>           <span class='Number'>9</span> 
 
<a name="LN153"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>AlteredTableInfo</span> 
<span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Information saved before any work commences: */ 
</span><a name="LN156"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>relid</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* Relation to work on */ 
</span><a name="LN157"></a>    <span class='Keyword'>char</span>        <span class='Declare_Member'>relkind</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* Its relkind */ 
</span><a name="LN158"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Member'>oldDesc</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* Pre-modification tuple descriptor */ 
</span>    <span class='Comment_Multi_Line'>/* Information saved by Phase 1 for Phase 2: */ 
</span><a name="LN160"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>subcmds</span><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN151"><span class='Ref_to_Const'>AT_NUM_PASSES</span></a><span class='Delimiter'>]; </span><span class='Comment_Single_Line'>/* Lists of AlterTableCmd */ 
</span>    <span class='Comment_Multi_Line'>/* Information saved by Phases 1/2 for Phase 3: */ 
</span><a name="LN162"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>constraints</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* List of NewConstraint */ 
</span><a name="LN163"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>newvals</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* List of NewColumnValue */ 
</span><a name="LN164"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>new_notnull</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* T if we added new NOT NULL constraints */ 
</span><a name="LN165"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>rewrite</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* Reason for forced rewrite, if any */ 
</span><a name="LN166"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>newTableSpace</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* new tablespace; 0 means no change */ 
</span><a name="LN167"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>chgPersistence</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* T if SET LOGGED/UNLOGGED is used */ 
</span><a name="LN168"></a>    <span class='Keyword'>char</span>        <span class='Declare_Member'>newrelpersistence</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* if above is true */ 
</span><a name="LN169"></a>    <a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>partition_constraint</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* for attach partition validation */ 
</span>    <span class='Comment_Multi_Line'>/* Objects to rebuild after completing ALTER TYPE operations */ 
</span><a name="LN171"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>changedConstraintOids</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* OIDs of constraints to rebuild */ 
</span><a name="LN172"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>changedConstraintDefs</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* string definitions of same */ 
</span><a name="LN173"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>changedIndexOids</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* OIDs of indexes to rebuild */ 
</span><a name="LN174"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>changedIndexDefs</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* string definitions of same */ 
</span><a name="LN175"></a><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end AlteredTableInfo &raquo; </span> <span class='Declare_Typedef'>AlteredTableInfo</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* Struct describing one new constraint to check in Phase 3 scan */ 
/* Note: new NOT NULL constraints are handled elsewhere */ 
</span><a name="LN179"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>NewConstraint</span> 
<span class='Delimiter'>{ 
</span><a name="LN181"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>name</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* Constraint name, or NULL if none */ 
</span><a name="LN182"></a>    <a href="../../include/nodes/parsenodes.h.html#LN2020"><span class='Ref_to_Enum'>ConstrType</span></a>  <span class='Declare_Member'>contype</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* CHECK or FOREIGN */ 
</span><a name="LN183"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>refrelid</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* PK rel, if FOREIGN */ 
</span><a name="LN184"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>refindid</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* OID of PK's index, if FOREIGN */ 
</span><a name="LN185"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>conid</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* OID of pg_constraint entry, if FOREIGN */ 
</span><a name="LN186"></a>    <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>qual</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* Check expr or CONSTR_FOREIGN Constraint */ 
</span><a name="LN187"></a>    <a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a>  <span class='Operator'>*</span><span class='Declare_Member'>qualstate</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* Execution state for CHECK expr */ 
</span><a name="LN188"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>NewConstraint</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Struct describing one new column value that needs to be computed during 
 * Phase 3 copy (this could be either a new column with a non-null default, or 
 * a column that we're changing the type of).  Columns without such an entry 
 * are just copied from the old table during ATRewriteTable.  Note that the 
 * expr is an expression over *old* table values. 
 */ 
</span><a name="LN197"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>NewColumnValue</span> 
<span class='Delimiter'>{ 
</span><a name="LN199"></a>    <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Member'>attnum</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* which column */ 
</span><a name="LN200"></a>    <a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>expr</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* expression to compute */ 
</span><a name="LN201"></a>    <a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a>  <span class='Operator'>*</span><span class='Declare_Member'>exprstate</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* execution state */ 
</span><a name="LN202"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>NewColumnValue</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Error-reporting support for RemoveRelations 
 */ 
</span><a name="LN207"></a><span class='Control'>struct</span> <span class='Declare_Struct'>dropmsgstrings</span> 
<span class='Delimiter'>{ 
</span><a name="LN209"></a>    <span class='Keyword'>char</span>        <span class='Declare_Member'>kind</span><span class='Delimiter'>; 
</span><a name="LN210"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>nonexistent_code</span><span class='Delimiter'>; 
</span><a name="LN211"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Member'>nonexistent_msg</span><span class='Delimiter'>; 
</span><a name="LN212"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Member'>skipping_msg</span><span class='Delimiter'>; 
</span><a name="LN213"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Member'>nota_msg</span><span class='Delimiter'>; 
</span><a name="LN214"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Member'>drophint_msg</span><span class='Delimiter'>; 
}; 
</span> 
<a name="LN217"></a><span class='Keyword'>static const </span><span class='Control'>struct</span> <a href="tablecmds.c.html#LN207"><span class='Ref_to_Struct'>dropmsgstrings</span></a> <span class='Declare_Var'>dropmsgstringarray</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>    <span class='Delimiter'>{</span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a><span class='Delimiter'>, 
</span>        <a href="../../bin/scripts/vacuumdb.c.html#LN25"><span class='Ref_to_Const'>ERRCODE_UNDEFINED_TABLE</span></a><span class='Delimiter'>, 
</span>        <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"table \"%s\" does not exist"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"table \"%s\" does not exist, skipping"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a table"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"Use DROP TABLE to remove a table."</span><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><a href="../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Delimiter'>, 
</span>        <a href="../../bin/scripts/vacuumdb.c.html#LN25"><span class='Ref_to_Const'>ERRCODE_UNDEFINED_TABLE</span></a><span class='Delimiter'>, 
</span>        <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"sequence \"%s\" does not exist"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"sequence \"%s\" does not exist, skipping"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a sequence"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"Use DROP SEQUENCE to remove a sequence."</span><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><a href="../../include/catalog/pg_class.h.html#LN163"><span class='Ref_to_Const'>RELKIND_VIEW</span></a><span class='Delimiter'>, 
</span>        <a href="../../bin/scripts/vacuumdb.c.html#LN25"><span class='Ref_to_Const'>ERRCODE_UNDEFINED_TABLE</span></a><span class='Delimiter'>, 
</span>        <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"view \"%s\" does not exist"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"view \"%s\" does not exist, skipping"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a view"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"Use DROP VIEW to remove a view."</span><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><a href="../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a><span class='Delimiter'>, 
</span>        <a href="../../bin/scripts/vacuumdb.c.html#LN25"><span class='Ref_to_Const'>ERRCODE_UNDEFINED_TABLE</span></a><span class='Delimiter'>, 
</span>        <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"materialized view \"%s\" does not exist"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"materialized view \"%s\" does not exist, skipping"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a materialized view"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"Use DROP MATERIALIZED VIEW to remove a materialized view."</span><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><a href="../../include/catalog/pg_class.h.html#LN160"><span class='Ref_to_Const'>RELKIND_INDEX</span></a><span class='Delimiter'>, 
</span>        ERRCODE_UNDEFINED_OBJECT<span class='Delimiter'>, 
</span>        <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"index \"%s\" does not exist"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"index \"%s\" does not exist, skipping"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not an index"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"Use DROP INDEX to remove an index."</span><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><a href="../../include/catalog/pg_class.h.html#LN165"><span class='Ref_to_Const'>RELKIND_COMPOSITE_TYPE</span></a><span class='Delimiter'>, 
</span>        ERRCODE_UNDEFINED_OBJECT<span class='Delimiter'>, 
</span>        <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"type \"%s\" does not exist"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"type \"%s\" does not exist, skipping"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a type"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"Use DROP TYPE to remove a type."</span><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><a href="../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a><span class='Delimiter'>, 
</span>        ERRCODE_UNDEFINED_OBJECT<span class='Delimiter'>, 
</span>        <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"foreign table \"%s\" does not exist"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"foreign table \"%s\" does not exist, skipping"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a foreign table"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"Use DROP FOREIGN TABLE to remove a foreign table."</span><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Delimiter'>, 
</span>        <a href="../../bin/scripts/vacuumdb.c.html#LN25"><span class='Ref_to_Const'>ERRCODE_UNDEFINED_TABLE</span></a><span class='Delimiter'>, 
</span>        <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"table \"%s\" does not exist"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"table \"%s\" does not exist, skipping"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a table"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"Use DROP TABLE to remove a table."</span><span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>'\0'</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>} 
}; 
</span> 
<a name="LN269"></a><span class='Control'>struct</span> <span class='Declare_Struct'>DropRelationCallbackState</span> 
<span class='Delimiter'>{ 
</span><a name="LN271"></a>    <span class='Keyword'>char</span>        <span class='Declare_Member'>relkind</span><span class='Delimiter'>; 
</span><a name="LN272"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>heapOid</span><span class='Delimiter'>; 
</span><a name="LN273"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>partParentOid</span><span class='Delimiter'>; 
</span><a name="LN274"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>concurrent</span><span class='Delimiter'>; 
}; 
</span> 
<span class='Comment_Multi_Line'>/* Alter table target-type flags for ATSimplePermissions */ 
</span><a name="LN278"></a><span class='Keyword'>#define</span>     <span class='Declare_Constant'>ATT_TABLE</span>               <span class='Number'>0x0001</span> 
<a name="LN279"></a><span class='Keyword'>#define</span>     <span class='Declare_Constant'>ATT_VIEW</span>                <span class='Number'>0x0002</span> 
<a name="LN280"></a><span class='Keyword'>#define</span>     <span class='Declare_Constant'>ATT_MATVIEW</span>             <span class='Number'>0x0004</span> 
<a name="LN281"></a><span class='Keyword'>#define</span>     <span class='Declare_Constant'>ATT_INDEX</span>               <span class='Number'>0x0008</span> 
<a name="LN282"></a><span class='Keyword'>#define</span>     <span class='Declare_Constant'>ATT_COMPOSITE_TYPE</span>      <span class='Number'>0x0010</span> 
<a name="LN283"></a><span class='Keyword'>#define</span>     <span class='Declare_Constant'>ATT_FOREIGN_TABLE</span>       <span class='Number'>0x0020</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Partition tables are expected to be dropped when the parent partitioned 
 * table gets dropped. Hence for partitioning we use AUTO dependency. 
 * Otherwise, for regular inheritance use NORMAL dependency. 
 */ 
</span><a name="LN290"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>child_dependency_type</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>child_is_partition</span><span class='Parentheses'>)</span>   <span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="tablecmds.c.html#LN290"><span class='Ref_to_Parameter'>child_is_partition</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="../../include/catalog/dependency.h.html#LN75"><span class='Ref_to_EnumConst'>DEPENDENCY_AUTO</span></a> <span class='Operator'>: </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span> 
 
<a name="LN293"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>truncate_check_rel</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN294"></a><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>MergeAttributes</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>schema</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>supers</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>relpersistence</span><span class='Delimiter'>, 
</span><a name="LN295"></a>                <span class='Keyword'>bool </span><span class='Declare_Parameter'>is_partition</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>supOids</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>supconstr</span><span class='Delimiter'>, 
</span><a name="LN296"></a>                <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>supOidCount</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN297"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>MergeCheckConstraint</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>constraints</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Delimiter'>, </span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN298"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>MergeAttributesIntoExisting</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>child_rel</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>parent_rel</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN299"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>MergeConstraintsIntoExisting</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>child_rel</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>parent_rel</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN300"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>StoreCatalogInheritance</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relationId</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>supers</span><span class='Delimiter'>, 
</span><a name="LN301"></a>                        <span class='Keyword'>bool </span><span class='Declare_Parameter'>child_is_partition</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN302"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>StoreCatalogInheritance1</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relationId</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>parentOid</span><span class='Delimiter'>, 
</span><a name="LN303"></a>                         <a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a> <span class='Declare_Parameter'>seqNumber</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>inhRelation</span><span class='Delimiter'>, 
</span><a name="LN304"></a>                         <span class='Keyword'>bool </span><span class='Declare_Parameter'>child_is_partition</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN305"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>findAttrByName</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>attributeName</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>schema</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN306"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>AlterIndexNamespaces</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>classRel</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN307"></a>                   <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oldNspOid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>newNspOid</span><span class='Delimiter'>, </span><a href="../catalog/dependency.c.html#LN108"><span class='Ref_to_Struct'>ObjectAddresses</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>objsMoved</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN308"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>AlterSeqNamespaces</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>classRel</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN309"></a>                   <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oldNspOid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>newNspOid</span><span class='Delimiter'>, </span><a href="../catalog/dependency.c.html#LN108"><span class='Ref_to_Struct'>ObjectAddresses</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>objsMoved</span><span class='Delimiter'>, 
</span><a name="LN310"></a>                   <a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN311"></a><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Prototype'>ATExecAlterConstraint</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cmd</span><span class='Delimiter'>, 
</span><a name="LN312"></a>                      <span class='Keyword'>bool </span><span class='Declare_Parameter'>recurse</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recursing</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN313"></a><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Prototype'>ATExecValidateConstraint</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>constrName</span><span class='Delimiter'>, 
</span><a name="LN314"></a>                         <span class='Keyword'>bool </span><span class='Declare_Parameter'>recurse</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recursing</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN315"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>transformColumnNameList</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relId</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>colList</span><span class='Delimiter'>, 
</span><a name="LN316"></a>                        <a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>attnums</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>atttypids</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN317"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>transformFkeyGetPrimaryKey</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>pkrel</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>indexOid</span><span class='Delimiter'>, 
</span><a name="LN318"></a>                           <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>attnamelist</span><span class='Delimiter'>, 
</span><a name="LN319"></a>                           <a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>attnums</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>atttypids</span><span class='Delimiter'>, 
</span><a name="LN320"></a>                           <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>opclasses</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN321"></a><span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Prototype'>transformFkeyCheckAttrs</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>pkrel</span><span class='Delimiter'>, 
</span><a name="LN322"></a>                        <span class='Keyword'>int </span><span class='Declare_Parameter'>numattrs</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>attnums</span><span class='Delimiter'>, 
</span><a name="LN323"></a>                        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>opclasses</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN324"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>checkFkeyPermissions</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>attnums</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>natts</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN325"></a><span class='Keyword'>static </span><a href="../../include/parser/parse_coerce.h.html#LN23"><span class='Ref_to_Enum'>CoercionPathType</span></a> <span class='Declare_Prototype'>findFkeyCast</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>targetTypeId</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>sourceTypeId</span><span class='Delimiter'>, 
</span><a name="LN326"></a>             <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>funcid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN327"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>validateCheckConstraint</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>constrtup</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN328"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>validateForeignKeyConstraint</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>conname</span><span class='Delimiter'>, 
</span><a name="LN329"></a>                             <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>pkrel</span><span class='Delimiter'>, 
</span><a name="LN330"></a>                             <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>pkindOid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>constraintOid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN331"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>createForeignKeyTriggers</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>refRelOid</span><span class='Delimiter'>, 
</span><a name="LN332"></a>                         <a href="../../include/nodes/parsenodes.h.html#LN2050"><span class='Ref_to_Struct'>Constraint</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fkconstraint</span><span class='Delimiter'>, 
</span><a name="LN333"></a>                         <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>constraintOid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>indexOid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN334"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ATController</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1662"><span class='Ref_to_Struct'>AlterTableStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parsetree</span><span class='Delimiter'>, 
</span><a name="LN335"></a>             <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cmds</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recurse</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN336"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ATPrepCmd</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>wqueue</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cmd</span><span class='Delimiter'>, 
</span><a name="LN337"></a>          <span class='Keyword'>bool </span><span class='Declare_Parameter'>recurse</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recursing</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN338"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ATRewriteCatalogs</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>wqueue</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN339"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ATExecCmd</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>wqueue</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tab</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN340"></a>          <a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cmd</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN341"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ATRewriteTables</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1662"><span class='Ref_to_Struct'>AlterTableStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parsetree</span><span class='Delimiter'>, 
</span><a name="LN342"></a>                <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>wqueue</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN343"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ATRewriteTable</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tab</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>OIDNewHeap</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN344"></a><span class='Keyword'>static </span><a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>ATGetQueueEntry</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>wqueue</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN345"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ATSimplePermissions</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>allowed_targets</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN346"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ATWrongRelkindError</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>allowed_targets</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN347"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ATSimpleRecursion</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>wqueue</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN348"></a>                  <a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cmd</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recurse</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN349"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ATTypedTableRecursion</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>wqueue</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cmd</span><span class='Delimiter'>, 
</span><a name="LN350"></a>                      <a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN351"></a><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>find_typed_table_dependencies</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeOid</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>typeName</span><span class='Delimiter'>, 
</span><a name="LN352"></a>                              <a href="../../include/nodes/parsenodes.h.html#LN1652"><span class='Ref_to_Enum'>DropBehavior</span></a> <span class='Declare_Parameter'>behavior</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN353"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ATPrepAddColumn</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>wqueue</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recurse</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recursing</span><span class='Delimiter'>, 
</span><a name="LN354"></a>                <span class='Keyword'>bool </span><span class='Declare_Parameter'>is_view</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cmd</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN355"></a><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Prototype'>ATExecAddColumn</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>wqueue</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tab</span><span class='Delimiter'>, 
</span><a name="LN356"></a>                <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN636"><span class='Ref_to_Struct'>ColumnDef</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>colDef</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isOid</span><span class='Delimiter'>, 
</span><a name="LN357"></a>                <span class='Keyword'>bool </span><span class='Declare_Parameter'>recurse</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recursing</span><span class='Delimiter'>, 
</span><a name="LN358"></a>                <span class='Keyword'>bool </span><span class='Declare_Parameter'>if_not_exists</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN359"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>check_for_column_name_collision</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colname</span><span class='Delimiter'>, 
</span><a name="LN360"></a>                                <span class='Keyword'>bool </span><span class='Declare_Parameter'>if_not_exists</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN361"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>add_column_datatype_dependency</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>attnum</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN362"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>add_column_collation_dependency</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>attnum</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>collid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN363"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ATPrepAddOids</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>wqueue</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recurse</span><span class='Delimiter'>, 
</span><a name="LN364"></a>              <a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cmd</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN365"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ATPrepDropNotNull</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recurse</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recursing</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN366"></a><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Prototype'>ATExecDropNotNull</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colName</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN367"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ATPrepSetNotNull</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recurse</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recursing</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN368"></a><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Prototype'>ATExecSetNotNull</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tab</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN369"></a>                 <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colName</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN370"></a><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Prototype'>ATExecColumnDefault</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colName</span><span class='Delimiter'>, 
</span><a name="LN371"></a>                    <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>newDefault</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN372"></a><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Prototype'>ATExecAddIdentity</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colName</span><span class='Delimiter'>, 
</span><a name="LN373"></a>                  <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>def</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN374"></a><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Prototype'>ATExecSetIdentity</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colName</span><span class='Delimiter'>, 
</span><a name="LN375"></a>                  <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>def</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN376"></a><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Prototype'>ATExecDropIdentity</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colName</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>missing_ok</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN377"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ATPrepSetStatistics</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colName</span><span class='Delimiter'>, 
</span><a name="LN378"></a>                    <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>newValue</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN379"></a><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Prototype'>ATExecSetStatistics</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colName</span><span class='Delimiter'>, 
</span><a name="LN380"></a>                    <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>newValue</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN381"></a><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Prototype'>ATExecSetOptions</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colName</span><span class='Delimiter'>, 
</span><a name="LN382"></a>                 <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>options</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isReset</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN383"></a><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Prototype'>ATExecSetStorage</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colName</span><span class='Delimiter'>, 
</span><a name="LN384"></a>                 <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>newValue</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN385"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ATPrepDropColumn</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>wqueue</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recurse</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recursing</span><span class='Delimiter'>, 
</span><a name="LN386"></a>                 <a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cmd</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN387"></a><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Prototype'>ATExecDropColumn</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>wqueue</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colName</span><span class='Delimiter'>, 
</span><a name="LN388"></a>                 <a href="../../include/nodes/parsenodes.h.html#LN1652"><span class='Ref_to_Enum'>DropBehavior</span></a> <span class='Declare_Parameter'>behavior</span><span class='Delimiter'>, 
</span><a name="LN389"></a>                 <span class='Keyword'>bool </span><span class='Declare_Parameter'>recurse</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recursing</span><span class='Delimiter'>, 
</span><a name="LN390"></a>                 <span class='Keyword'>bool </span><span class='Declare_Parameter'>missing_ok</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN391"></a><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Prototype'>ATExecAddIndex</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tab</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN392"></a>               <a href="../../include/nodes/parsenodes.h.html#LN2667"><span class='Ref_to_Struct'>IndexStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>is_rebuild</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN393"></a><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Prototype'>ATExecAddConstraint</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>wqueue</span><span class='Delimiter'>, 
</span><a name="LN394"></a>                    <a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tab</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN395"></a>                    <a href="../../include/nodes/parsenodes.h.html#LN2050"><span class='Ref_to_Struct'>Constraint</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>newConstraint</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recurse</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>is_readd</span><span class='Delimiter'>, 
</span><a name="LN396"></a>                    <a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN397"></a><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Prototype'>ATExecAddIndexConstraint</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tab</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN398"></a>                         <a href="../../include/nodes/parsenodes.h.html#LN2667"><span class='Ref_to_Struct'>IndexStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN399"></a><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Prototype'>ATAddCheckConstraint</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>wqueue</span><span class='Delimiter'>, 
</span><a name="LN400"></a>                     <a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tab</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN401"></a>                     <a href="../../include/nodes/parsenodes.h.html#LN2050"><span class='Ref_to_Struct'>Constraint</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>constr</span><span class='Delimiter'>, 
</span><a name="LN402"></a>                     <span class='Keyword'>bool </span><span class='Declare_Parameter'>recurse</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recursing</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>is_readd</span><span class='Delimiter'>, 
</span><a name="LN403"></a>                     <a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN404"></a><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Prototype'>ATAddForeignKeyConstraint</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tab</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN405"></a>                          <a href="../../include/nodes/parsenodes.h.html#LN2050"><span class='Ref_to_Struct'>Constraint</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fkconstraint</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN406"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ATExecDropConstraint</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>constrName</span><span class='Delimiter'>, 
</span><a name="LN407"></a>                     <a href="../../include/nodes/parsenodes.h.html#LN1652"><span class='Ref_to_Enum'>DropBehavior</span></a> <span class='Declare_Parameter'>behavior</span><span class='Delimiter'>, 
</span><a name="LN408"></a>                     <span class='Keyword'>bool </span><span class='Declare_Parameter'>recurse</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recursing</span><span class='Delimiter'>, 
</span><a name="LN409"></a>                     <span class='Keyword'>bool </span><span class='Declare_Parameter'>missing_ok</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN410"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ATPrepAlterColumnType</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>wqueue</span><span class='Delimiter'>, 
</span><a name="LN411"></a>                      <a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tab</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN412"></a>                      <span class='Keyword'>bool </span><span class='Declare_Parameter'>recurse</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recursing</span><span class='Delimiter'>, 
</span><a name="LN413"></a>                      <a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cmd</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN414"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>ATColumnChangeRequiresRewrite</span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Delimiter'>, </span><a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a> <span class='Declare_Parameter'>varattno</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN415"></a><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Prototype'>ATExecAlterColumnType</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tab</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN416"></a>                      <a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cmd</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN417"></a><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Prototype'>ATExecAlterColumnGenericOptions</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colName</span><span class='Delimiter'>, 
</span><a name="LN418"></a>                                <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>options</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN419"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ATPostAlterTypeCleanup</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>wqueue</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tab</span><span class='Delimiter'>, 
</span><a name="LN420"></a>                       <a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN421"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ATPostAlterTypeParse</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oldId</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oldRelId</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>refRelId</span><span class='Delimiter'>, 
</span><a name="LN422"></a>                     <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>cmd</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>wqueue</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Delimiter'>, 
</span><a name="LN423"></a>                     <span class='Keyword'>bool </span><span class='Declare_Parameter'>rewrite</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN424"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>RebuildConstraintComment</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tab</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>pass</span><span class='Delimiter'>, 
</span><a name="LN425"></a>                         <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>objid</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>conname</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN426"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>TryReuseIndex</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oldId</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2667"><span class='Ref_to_Struct'>IndexStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN427"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>TryReuseForeignKey</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oldId</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2050"><span class='Ref_to_Struct'>Constraint</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>con</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN428"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>change_owner_fix_column_acls</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relationOid</span><span class='Delimiter'>, 
</span><a name="LN429"></a>                             <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oldOwnerId</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>newOwnerId</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN430"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>change_owner_recurse_to_sequences</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relationOid</span><span class='Delimiter'>, 
</span><a name="LN431"></a>                                  <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>newOwnerId</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN432"></a><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Prototype'>ATExecClusterOn</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>indexName</span><span class='Delimiter'>, 
</span><a name="LN433"></a>                <a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN434"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ATExecDropCluster</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN435"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>ATPrepChangePersistence</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>toLogged</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN436"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ATPrepSetTableSpace</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tab</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN437"></a>                    <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>tablespacename</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN438"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ATExecSetTableSpace</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>tableOid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>newTableSpace</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN439"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ATExecSetRelOptions</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>defList</span><span class='Delimiter'>, 
</span><a name="LN440"></a>                    <a href="../../include/nodes/parsenodes.h.html#LN1671"><span class='Ref_to_Enum'>AlterTableType</span></a> <span class='Declare_Parameter'>operation</span><span class='Delimiter'>, 
</span><a name="LN441"></a>                    <a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN442"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ATExecEnableDisableTrigger</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>trigname</span><span class='Delimiter'>, 
</span><a name="LN443"></a>                       <span class='Keyword'>char </span><span class='Declare_Parameter'>fires_when</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>skip_system</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN444"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ATExecEnableDisableRule</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>rulename</span><span class='Delimiter'>, 
</span><a name="LN445"></a>                        <span class='Keyword'>char </span><span class='Declare_Parameter'>fires_when</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN446"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ATPrepAddInherit</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>child_rel</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN447"></a><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Prototype'>ATExecAddInherit</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>child_rel</span><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parent</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN448"></a><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Prototype'>ATExecDropInherit</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parent</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN449"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>drop_parent_dependency</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>refclassid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>refobjid</span><span class='Delimiter'>, 
</span><a name="LN450"></a>                       <a href="../../include/catalog/dependency.h.html#LN72"><span class='Ref_to_Enum'>DependencyType</span></a> <span class='Declare_Parameter'>deptype</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN451"></a><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Prototype'>ATExecAddOf</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="../../include/nodes/parsenodes.h.html#LN205"><span class='Ref_to_Struct'>TypeName</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ofTypename</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN452"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ATExecDropOf</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN453"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ATExecReplicaIdentity</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1742"><span class='Ref_to_Struct'>ReplicaIdentityStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN454"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ATExecGenericOptions</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>options</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN455"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ATExecEnableRowSecurity</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN456"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ATExecDisableRowSecurity</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN457"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ATExecForceNoForceRowSecurity</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>force_rls</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN459"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>copy_relation_data</span><span class='Parentheses'>(</span><a href="../../include/storage/smgr.h.html#LN77"><span class='Ref_to_Typedef'>SMgrRelation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/storage/smgr.h.html#LN77"><span class='Ref_to_Typedef'>SMgrRelation</span></a> <span class='Declare_Parameter'>dst</span><span class='Delimiter'>, 
</span><a name="LN460"></a>                   <a href="../../include/common/relpath.h.html#LN23"><span class='Ref_to_Enum'>ForkNumber</span></a> <span class='Declare_Parameter'>forkNum</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>relpersistence</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN461"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Prototype'>storage_name</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Declare_Parameter'>c</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN463"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>RangeVarCallbackForDropRelation</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relOid</span><span class='Delimiter'>, 
</span><a name="LN464"></a>                                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oldRelOid</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN465"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>RangeVarCallbackForAlterRelation</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rv</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Delimiter'>, 
</span><a name="LN466"></a>                                 <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oldrelid</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN467"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>is_partition_attr</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a> <span class='Declare_Parameter'>attnum</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>used_in_expr</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN468"></a><span class='Keyword'>static </span><a href="../../include/nodes/parsenodes.h.html#LN777"><span class='Ref_to_Struct'>PartitionSpec</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>transformPartitionSpec</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN777"><span class='Ref_to_Struct'>PartitionSpec</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>partspec</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>strategy</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN469"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ComputePartitionAttrs</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>partParams</span><span class='Delimiter'>, </span><a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>partattrs</span><span class='Delimiter'>, 
</span><a name="LN470"></a>                      <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>partexprs</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>partopclass</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>partcollation</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN471"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>CreateInheritance</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>child_rel</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>parent_rel</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN472"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>RemoveInheritance</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>child_rel</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>parent_rel</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN473"></a><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Prototype'>ATExecAttachPartition</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>wqueue</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN474"></a>                      <a href="../../include/nodes/parsenodes.h.html#LN829"><span class='Ref_to_Struct'>PartitionCmd</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cmd</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN475"></a><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Prototype'>ATExecDetachPartition</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      DefineRelation 
 *              Creates a new relation. 
 * 
 * stmt carries parsetree information from an ordinary CREATE TABLE statement. 
 * The other arguments are used to extend the behavior for other cases: 
 * relkind: relkind to assign to the new relation 
 * ownerId: if not InvalidOid, use this as the new relation's owner. 
 * typaddress: if not null, it's set to the pg_type entry's address. 
 * 
 * Note that permissions checks are done against current user regardless of 
 * ownerId.  A nonzero ownerId is used when someone is creating a relation 
 * "on behalf of" someone else, so we still want to see that the current user 
 * has permissions to do it. 
 * 
 * If successful, returns the address of the new relation. 
 * ---------------------------------------------------------------- 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN497"></a><span class='Declare_Function'>DefineRelation</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1972"><span class='Ref_to_Struct'>CreateStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>relkind</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>ownerId</span><span class='Delimiter'>, 
</span><a name="LN498"></a>               <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typaddress</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>queryString</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN500"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>relname</span><span class='Delimiter'>[</span><a href="../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a><span class='Delimiter'>]; 
</span><a name="LN501"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>namespaceId</span><span class='Delimiter'>; 
</span><a name="LN502"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relationId</span><span class='Delimiter'>; 
</span><a name="LN503"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tablespaceId</span><span class='Delimiter'>; 
</span><a name="LN504"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN505"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>descriptor</span><span class='Delimiter'>; 
</span><a name="LN506"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>inheritOids</span><span class='Delimiter'>; 
</span><a name="LN507"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>old_constraints</span><span class='Delimiter'>; 
</span><a name="LN508"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>localHasOids</span><span class='Delimiter'>; 
</span><a name="LN509"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>parentOidCount</span><span class='Delimiter'>; 
</span><a name="LN510"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>rawDefaults</span><span class='Delimiter'>; 
</span><a name="LN511"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>cookedDefaults</span><span class='Delimiter'>; 
</span><a name="LN512"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>reloptions</span><span class='Delimiter'>; 
</span><a name="LN513"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>listptr</span><span class='Delimiter'>; 
</span><a name="LN514"></a>    <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>attnum</span><span class='Delimiter'>; 
</span><a name="LN515"></a>    <span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Local'>validnsps</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><a href="../../include/access/reloptions.h.html#LN58"><span class='Ref_to_Const'>HEAP_RELOPT_NAMESPACES</span></a><span class='Delimiter'>; 
</span><a name="LN516"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ofTypeId</span><span class='Delimiter'>; 
</span><a name="LN517"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Truncate relname to appropriate length (probably a waste of time, as 
     * parser should have done this already). 
     */ 
</span>    <a href="../../include/c.h.html#LN829"><span class='Ref_to_Macro'>StrNCpy</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN500"><span class='Ref_To_Local'>relname</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1975"><span class='Ref_to_Member'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Delimiter'>, </span><a href="../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check consistency of arguments 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1984"><span class='Ref_to_Member'>oncommit</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/primnodes.h.html#LN48"><span class='Ref_to_EnumConst'>ONCOMMIT_NOOP</span></a> 
        <span class='Operator'>&& </span><a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1975"><span class='Ref_to_Member'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN70"><span class='Ref_to_Member'>relpersistence</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN171"><span class='Ref_to_Const'>RELPERSISTENCE_TEMP</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TABLE_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"ON COMMIT can only be used on temporary tables"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1980"><span class='Ref_to_Member'>partspec</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>relkind</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a><span class='Parentheses'>) 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected relkind: %d"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>relkind</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>relkind</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Look up the namespace in which we are supposed to create the relation, 
     * check we have permission to create there, lock it against concurrent 
     * drop, and mark stmt-&GT;relation as RELPERSISTENCE_TEMP if a temporary 
     * namespace is selected. 
     */ 
</span>    <a href="tablecmds.c.html#LN501"><span class='Ref_To_Local'>namespaceId</span></a> <span class='Operator'>= 
</span>        <a href="../../include/catalog/namespace.h.html#LN60"><span class='Ref_to_Proto'>RangeVarGetAndCheckCreationNamespace</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1975"><span class='Ref_to_Member'>relation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Security check: disallow creating temp tables from security-restricted 
     * code.  This is needed because calling code might not expect untrusted 
     * tables to appear in pg_temp at the front of its search path. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1975"><span class='Ref_to_Member'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN70"><span class='Ref_to_Member'>relpersistence</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN171"><span class='Ref_to_Const'>RELPERSISTENCE_TEMP</span></a> 
        <span class='Operator'>&& </span><a href="../../include/miscadmin.h.html#LN315"><span class='Ref_to_Proto'>InSecurityRestrictedOperation</span></a><span class='Parentheses'>())</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot create temporary table within security-restricted operation"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Select tablespace to use.  If not specified, use default tablespace 
     * (which may in turn default to database's default). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1985"><span class='Ref_to_Member'>tablespacename</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN503"><span class='Ref_To_Local'>tablespaceId</span></a> <span class='Operator'>= </span><a href="../../include/commands/tablespace.h.html#LN55"><span class='Ref_to_Proto'>get_tablespace_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1985"><span class='Ref_to_Member'>tablespacename</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN503"><span class='Ref_To_Local'>tablespaceId</span></a> <span class='Operator'>= </span><a href="../../include/commands/tablespace.h.html#LN51"><span class='Ref_to_Proto'>GetDefaultTablespace</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1975"><span class='Ref_to_Member'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN70"><span class='Ref_to_Member'>relpersistence</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* note InvalidOid is OK in this case */ 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Check permissions except when using database's default */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN503"><span class='Ref_To_Local'>tablespaceId</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="tablecmds.c.html#LN503"><span class='Ref_To_Local'>tablespaceId</span></a> <span class='Operator'>!= </span><a href="../utils/init/globals.c.html#LN78"><span class='Ref_to_Global_Var'>MyDatabaseTableSpace</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN579"></a>        <a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN579"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN290"><span class='Ref_to_Proto'>pg_tablespace_aclcheck</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN503"><span class='Ref_To_Local'>tablespaceId</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                                           <a href="../../include/nodes/parsenodes.h.html#LN81"><span class='Ref_to_Const'>ACL_CREATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN579"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN579"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN195"><span class='Ref_to_EnumConst'>ACL_KIND_TABLESPACE</span></a><span class='Delimiter'>, 
</span>                           <a href="../../include/commands/tablespace.h.html#LN56"><span class='Ref_to_Proto'>get_tablespace_name</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN503"><span class='Ref_To_Local'>tablespaceId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* In all cases disallow placing user relations in pg_global */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN503"><span class='Ref_To_Local'>tablespaceId</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_tablespace.h.html#LN63"><span class='Ref_to_Const'>GLOBALTABLESPACE_OID</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"only shared relations can be placed in pg_global tablespace"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Identify user ID that will own the table */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>ownerId</span></a><span class='Parentheses'>))</span> 
        <a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>ownerId</span></a> <span class='Operator'>= </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Parse and validate reloptions, if any. 
     */ 
</span>    <a href="tablecmds.c.html#LN512"><span class='Ref_To_Local'>reloptions</span></a> <span class='Operator'>= </span><a href="../../include/access/reloptions.h.html#LN257"><span class='Ref_to_Proto'>transformRelOptions</span></a><span class='Parentheses'>((</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1983"><span class='Ref_to_Member'>options</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN515"><span class='Ref_To_Local'>validnsps</span></a><span class='Delimiter'>, 
</span>                                     <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>relkind</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN163"><span class='Ref_to_Const'>RELKIND_VIEW</span></a><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../include/access/reloptions.h.html#LN275"><span class='Ref_to_Proto'>view_reloptions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN512"><span class='Ref_To_Local'>reloptions</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../include/access/reloptions.h.html#LN274"><span class='Ref_to_Proto'>heap_reloptions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>relkind</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN512"><span class='Ref_To_Local'>reloptions</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1981"><span class='Ref_to_Member'>ofTypename</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN611"></a>        <a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN516"><span class='Ref_To_Local'>ofTypeId</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN27"><span class='Ref_to_Proto'>typenameTypeId</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1981"><span class='Ref_to_Member'>ofTypename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN611"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN293"><span class='Ref_to_Proto'>pg_type_aclcheck</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN516"><span class='Ref_To_Local'>ofTypeId</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN611"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/acl.h.html#LN301"><span class='Ref_to_Proto'>aclcheck_error_type</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN611"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN516"><span class='Ref_To_Local'>ofTypeId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="tablecmds.c.html#LN516"><span class='Ref_To_Local'>ofTypeId</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Look up inheritance ancestors and generate relation schema, including 
     * inherited attributes.  (Note that stmt-&GT;tableElts is destructively 
     * modified by MergeAttributes.) 
     */ 
</span>    <a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1976"><span class='Ref_to_Member'>tableElts</span></a> <span class='Operator'>= 
</span>        <a href="tablecmds.c.html#LN294"><span class='Ref_to_Proto'>MergeAttributes</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1976"><span class='Ref_to_Member'>tableElts</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1977"><span class='Ref_to_Member'>inhRelations</span></a><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1975"><span class='Ref_to_Member'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN70"><span class='Ref_to_Member'>relpersistence</span></a><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1979"><span class='Ref_to_Member'>partbound</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                        <span class='Operator'>&</span><a href="tablecmds.c.html#LN506"><span class='Ref_To_Local'>inheritOids</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN507"><span class='Ref_To_Local'>old_constraints</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN509"><span class='Ref_To_Local'>parentOidCount</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create a tuple descriptor from the relation schema.  Note that this 
     * deals with column names, types, and NOT NULL constraints, but not 
     * default values or CHECK constraints; we handle those below. 
     */ 
</span>    <a href="tablecmds.c.html#LN505"><span class='Ref_To_Local'>descriptor</span></a> <span class='Operator'>= </span><a href="../../include/access/tupdesc.h.html#LN132"><span class='Ref_to_Proto'>BuildDescForRelation</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1976"><span class='Ref_to_Member'>tableElts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Notice that we allow OIDs here only for plain tables and partitioned 
     * tables, even though some other relkinds can support them.  This is 
     * necessary because the default_with_oids GUC must apply only to plain 
     * tables and not any other relkind; doing otherwise would break existing 
     * pg_dump files.  We could allow explicit "WITH OIDS" while not allowing 
     * default_with_oids to affect other relkinds, but it would complicate 
     * interpretOidsOption(). 
     */ 
</span>    <a href="tablecmds.c.html#LN508"><span class='Ref_To_Local'>localHasOids</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_clause.h.html#LN21"><span class='Ref_to_Proto'>interpretOidsOption</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1983"><span class='Ref_to_Member'>options</span></a><span class='Delimiter'>, 
</span>                                       <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>relkind</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a> <span class='Operator'>|| 
</span>                                      <a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>relkind</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN505"><span class='Ref_To_Local'>descriptor</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN78"><span class='Ref_to_Member'>tdhasoid</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN508"><span class='Ref_To_Local'>localHasOids</span></a> <span class='Operator'>|| </span><a href="tablecmds.c.html#LN509"><span class='Ref_To_Local'>parentOidCount</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If a partitioned table doesn't have the system OID column, then none of 
     * its partitions should have it. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1979"><span class='Ref_to_Member'>partbound</span></a> <span class='Operator'>&& </span><a href="tablecmds.c.html#LN509"><span class='Ref_To_Local'>parentOidCount</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="tablecmds.c.html#LN508"><span class='Ref_To_Local'>localHasOids</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot create table with OIDs as partition of table without OIDs"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Find columns with default values and prepare for insertion of the 
     * defaults.  Pre-cooked (that is, inherited) defaults go into a list of 
     * CookedConstraint structs that we'll pass to heap_create_with_catalog, 
     * while raw defaults go into a list of RawColumnDefault structs that will 
     * be processed by AddRelationNewConstraints.  (We can't deal with raw 
     * expressions until we can do transformExpr.) 
     * 
     * We can set the atthasdef flags now in the tuple descriptor; this just 
     * saves StoreAttrDefault from having to do an immediate update of the 
     * pg_attribute rows. 
     */ 
</span>    <a href="tablecmds.c.html#LN510"><span class='Ref_To_Local'>rawDefaults</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN511"><span class='Ref_To_Local'>cookedDefaults</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN514"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN513"><span class='Ref_To_Local'>listptr</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1976"><span class='Ref_to_Member'>tableElts</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN681"></a>        <a href="../../include/nodes/parsenodes.h.html#LN636"><span class='Ref_to_Struct'>ColumnDef</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>colDef</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN513"><span class='Ref_To_Local'>listptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN514"><span class='Ref_To_Local'>attnum</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN681"><span class='Ref_To_Local'>colDef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN647"><span class='Ref_to_Member'>raw_default</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN687"></a>            <a href="../../include/catalog/heap.h.html#LN21"><span class='Ref_to_Struct'>RawColumnDefault</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rawEnt</span><span class='Delimiter'>; 
</span> 
            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN681"><span class='Ref_To_Local'>colDef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN648"><span class='Ref_to_Member'>cooked_default</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="tablecmds.c.html#LN687"><span class='Ref_To_Local'>rawEnt</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/heap.h.html#LN21"><span class='Ref_to_Struct'>RawColumnDefault</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/catalog/heap.h.html#LN21"><span class='Ref_to_Struct'>RawColumnDefault</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN687"><span class='Ref_To_Local'>rawEnt</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/heap.h.html#LN23"><span class='Ref_to_Member'>attnum</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN514"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN687"><span class='Ref_To_Local'>rawEnt</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/heap.h.html#LN24"><span class='Ref_to_Member'>raw_default</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN681"><span class='Ref_To_Local'>colDef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN647"><span class='Ref_to_Member'>raw_default</span></a><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN510"><span class='Ref_To_Local'>rawDefaults</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN510"><span class='Ref_To_Local'>rawDefaults</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN687"><span class='Ref_To_Local'>rawEnt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN505"><span class='Ref_To_Local'>descriptor</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN514"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atthasdef <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN681"><span class='Ref_To_Local'>colDef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN648"><span class='Ref_to_Member'>cooked_default</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN699"></a>            <a href="../../include/catalog/heap.h.html#LN27"><span class='Ref_to_Struct'>CookedConstraint</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cooked</span><span class='Delimiter'>; 
</span> 
            <a href="tablecmds.c.html#LN699"><span class='Ref_To_Local'>cooked</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/heap.h.html#LN27"><span class='Ref_to_Struct'>CookedConstraint</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/catalog/heap.h.html#LN27"><span class='Ref_to_Struct'>CookedConstraint</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN699"><span class='Ref_To_Local'>cooked</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/heap.h.html#LN29"><span class='Ref_to_Member'>contype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN2025"><span class='Ref_to_EnumConst'>CONSTR_DEFAULT</span></a><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN699"><span class='Ref_To_Local'>cooked</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/heap.h.html#LN30"><span class='Ref_to_Member'>conoid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* until created */ 
</span>            <a href="tablecmds.c.html#LN699"><span class='Ref_To_Local'>cooked</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/heap.h.html#LN31"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN699"><span class='Ref_To_Local'>cooked</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/heap.h.html#LN32"><span class='Ref_to_Member'>attnum</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN514"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN699"><span class='Ref_To_Local'>cooked</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/heap.h.html#LN33"><span class='Ref_to_Member'>expr</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN681"><span class='Ref_To_Local'>colDef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN648"><span class='Ref_to_Member'>cooked_default</span></a><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN699"><span class='Ref_To_Local'>cooked</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/heap.h.html#LN34"><span class='Ref_to_Member'>skip_validation</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN699"><span class='Ref_To_Local'>cooked</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/heap.h.html#LN35"><span class='Ref_to_Member'>is_local</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* not used for defaults */ 
</span>            <a href="tablecmds.c.html#LN699"><span class='Ref_To_Local'>cooked</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/heap.h.html#LN36"><span class='Ref_to_Member'>inhcount</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* ditto */ 
</span>            <a href="tablecmds.c.html#LN699"><span class='Ref_To_Local'>cooked</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/heap.h.html#LN37"><span class='Ref_to_Member'>is_no_inherit</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN511"><span class='Ref_To_Local'>cookedDefaults</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN511"><span class='Ref_To_Local'>cookedDefaults</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN699"><span class='Ref_To_Local'>cooked</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN505"><span class='Ref_To_Local'>descriptor</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN514"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atthasdef <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN681"><span class='Ref_To_Local'>colDef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN649"><span class='Ref_to_Member'>identity</span></a><span class='Parentheses'>) 
</span>            <a href="tablecmds.c.html#LN505"><span class='Ref_To_Local'>descriptor</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN514"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attidentity <span class='Operator'>= </span><a href="tablecmds.c.html#LN681"><span class='Ref_To_Local'>colDef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN649"><span class='Ref_to_Member'>identity</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create the relation.  Inherited defaults and constraints are passed in 
     * for immediate handling --- since they don't need parsing, they can be 
     * stored immediately. 
     */ 
</span>    <a href="tablecmds.c.html#LN502"><span class='Ref_To_Local'>relationId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/heap.h.html#LN53"><span class='Ref_to_Proto'>heap_create_with_catalog</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN500"><span class='Ref_To_Local'>relname</span></a><span class='Delimiter'>, 
</span>                                          <a href="tablecmds.c.html#LN501"><span class='Ref_To_Local'>namespaceId</span></a><span class='Delimiter'>, 
</span>                                          <a href="tablecmds.c.html#LN503"><span class='Ref_To_Local'>tablespaceId</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                                          <a href="tablecmds.c.html#LN516"><span class='Ref_To_Local'>ofTypeId</span></a><span class='Delimiter'>, 
</span>                                          <a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>ownerId</span></a><span class='Delimiter'>, 
</span>                                          <a href="tablecmds.c.html#LN505"><span class='Ref_To_Local'>descriptor</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN511"><span class='Ref_To_Local'>cookedDefaults</span></a><span class='Delimiter'>, 
</span>                                                      <a href="tablecmds.c.html#LN507"><span class='Ref_To_Local'>old_constraints</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                          <a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>relkind</span></a><span class='Delimiter'>, 
</span>                                          <a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1975"><span class='Ref_to_Member'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN70"><span class='Ref_to_Member'>relpersistence</span></a><span class='Delimiter'>, 
</span>                                          <span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                          <span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                          <a href="tablecmds.c.html#LN508"><span class='Ref_To_Local'>localHasOids</span></a><span class='Delimiter'>, 
</span>                                          <a href="tablecmds.c.html#LN509"><span class='Ref_To_Local'>parentOidCount</span></a><span class='Delimiter'>, 
</span>                                          <a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1984"><span class='Ref_to_Member'>oncommit</span></a><span class='Delimiter'>, 
</span>                                          <a href="tablecmds.c.html#LN512"><span class='Ref_To_Local'>reloptions</span></a><span class='Delimiter'>, 
</span>                                          <span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                          <a href="../utils/init/globals.c.html#LN111"><span class='Ref_to_Global_Var'>allowSystemTableMods</span></a><span class='Delimiter'>, 
</span>                                          <span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                          <a href="tablecmds.c.html#LN498"><span class='Ref_to_Parameter'>typaddress</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Store inheritance information for new rel. */ 
</span>    <a href="tablecmds.c.html#LN300"><span class='Ref_to_Proto'>StoreCatalogInheritance</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN502"><span class='Ref_To_Local'>relationId</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN506"><span class='Ref_To_Local'>inheritOids</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1979"><span class='Ref_to_Member'>partbound</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We must bump the command counter to make the newly-created relation 
     * tuple visible for opening. 
     */ 
</span>    <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Open the new relation and acquire exclusive lock on it.  This isn't 
     * really necessary for locking out other backends (since they can't see 
     * the new rel anyway until we commit), but it keeps the lock manager from 
     * complaining about deadlock risks. 
     */ 
</span>    <a href="tablecmds.c.html#LN504"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN84"><span class='Ref_to_Proto'>relation_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN502"><span class='Ref_To_Local'>relationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Process and store partition bound, if any. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1979"><span class='Ref_to_Member'>partbound</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN767"></a>        <a href="../../include/nodes/parsenodes.h.html#LN795"><span class='Ref_to_Struct'>PartitionBoundSpec</span></a> <span class='Operator'>*</span><span class='Declare_Local'>bound</span><span class='Delimiter'>; 
</span><a name="LN768"></a>        <a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pstate</span><span class='Delimiter'>; 
</span><a name="LN769"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>parentId</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN112"><span class='Ref_to_Macro'>linitial_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN506"><span class='Ref_To_Local'>inheritOids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN770"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>parent</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Already have strong enough lock on the parent */ 
</span>        <a href="tablecmds.c.html#LN770"><span class='Ref_To_Local'>parent</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN769"><span class='Ref_To_Local'>parentId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We are going to try to validate the partition bound specification 
         * against the partition key of parentRel, so it better have one. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN770"><span class='Ref_To_Local'>parent</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not partitioned"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN770"><span class='Ref_To_Local'>parent</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Tranform the bound values */ 
</span>        <a href="tablecmds.c.html#LN768"><span class='Ref_To_Local'>pstate</span></a> <span class='Operator'>= </span><a href="../parser/parse_node.c.html#LN42"><span class='Ref_to_Func'>make_parsestate</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN768"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/parser/parse_node.h.html#LN167"><span class='Ref_to_Member'>p_sourcetext</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN498"><span class='Ref_to_Parameter'>queryString</span></a><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN767"><span class='Ref_To_Local'>bound</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_utilcmd.h.html#LN27"><span class='Ref_to_Proto'>transformPartitionBound</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN768"><span class='Ref_To_Local'>pstate</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN770"><span class='Ref_To_Local'>parent</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1979"><span class='Ref_to_Member'>partbound</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Check first that the new partition's bound is valid and does not 
         * overlap with any of existing partitions of the parent - note that 
         * it does not return on error. 
         */ 
</span>        <a href="../../include/catalog/partition.h.html#LN76"><span class='Ref_to_Proto'>check_new_partition_bound</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN500"><span class='Ref_To_Local'>relname</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN770"><span class='Ref_To_Local'>parent</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN767"><span class='Ref_To_Local'>bound</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Update the pg_class entry. */ 
</span>        <a href="../../include/catalog/heap.h.html#LN145"><span class='Ref_to_Proto'>StorePartitionBound</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN504"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN770"><span class='Ref_To_Local'>parent</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN767"><span class='Ref_To_Local'>bound</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN770"><span class='Ref_To_Local'>parent</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * The code that follows may also update the pg_class tuple to update 
         * relnumchecks, so bump up the command counter to avoid the "already 
         * updated by self" error. 
         */ 
</span>        <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if stmt-&GT;partbound &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Process the partitioning specification (if any) and store the partition 
     * key information into the catalog. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1980"><span class='Ref_to_Member'>partspec</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN817"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>strategy</span><span class='Delimiter'>; 
</span><a name="LN818"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>partnatts</span><span class='Delimiter'>; 
</span><a name="LN819"></a>        <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>partattrs</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN50"><span class='Ref_to_Const'>PARTITION_MAX_KEYS</span></a><span class='Delimiter'>]; 
</span><a name="LN820"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>partopclass</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN50"><span class='Ref_to_Const'>PARTITION_MAX_KEYS</span></a><span class='Delimiter'>]; 
</span><a name="LN821"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>partcollation</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN50"><span class='Ref_to_Const'>PARTITION_MAX_KEYS</span></a><span class='Delimiter'>]; 
</span><a name="LN822"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>partexprs</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN818"><span class='Ref_To_Local'>partnatts</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1980"><span class='Ref_to_Member'>partspec</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN781"><span class='Ref_to_Member'>partParams</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Protect fixed-size arrays here and in executor */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN818"><span class='Ref_To_Local'>partnatts</span></a> <span class='Operator'>&GT; </span><a href="../../include/pg_config_manual.h.html#LN50"><span class='Ref_to_Const'>PARTITION_MAX_KEYS</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_TOO_MANY_COLUMNS<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot partition using more than %d columns"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/pg_config_manual.h.html#LN50"><span class='Ref_to_Const'>PARTITION_MAX_KEYS</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We need to transform the raw parsetrees corresponding to partition 
         * expressions into executable expression trees.  Like column defaults 
         * and CHECK constraints, we could not have done the transformation 
         * earlier. 
         */ 
</span>        <a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1980"><span class='Ref_to_Member'>partspec</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN468"><span class='Ref_to_Proto'>transformPartitionSpec</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN504"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1980"><span class='Ref_to_Member'>partspec</span></a><span class='Delimiter'>, 
</span>                                                <span class='Operator'>&</span><a href="tablecmds.c.html#LN817"><span class='Ref_To_Local'>strategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN469"><span class='Ref_to_Proto'>ComputePartitionAttrs</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN504"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1980"><span class='Ref_to_Member'>partspec</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN781"><span class='Ref_to_Member'>partParams</span></a><span class='Delimiter'>, 
</span>                              <a href="tablecmds.c.html#LN819"><span class='Ref_To_Local'>partattrs</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN822"><span class='Ref_To_Local'>partexprs</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN820"><span class='Ref_To_Local'>partopclass</span></a><span class='Delimiter'>, 
</span>                              <a href="tablecmds.c.html#LN821"><span class='Ref_To_Local'>partcollation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/heap.h.html#LN137"><span class='Ref_to_Proto'>StorePartitionKey</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN504"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN817"><span class='Ref_To_Local'>strategy</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN818"><span class='Ref_To_Local'>partnatts</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN819"><span class='Ref_To_Local'>partattrs</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN822"><span class='Ref_To_Local'>partexprs</span></a><span class='Delimiter'>, 
</span>                          <a href="tablecmds.c.html#LN820"><span class='Ref_To_Local'>partopclass</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN821"><span class='Ref_To_Local'>partcollation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if stmt-&GT;partspec &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Now add any newly specified column default values and CHECK constraints 
     * to the new relation.  These are passed to us in the form of raw 
     * parsetrees; we need to transform them to executable expression trees 
     * before they can be added. The most convenient way to do that is to 
     * apply the parser's transformExpr routine, but transformExpr doesn't 
     * work unless we have a pre-existing relation. So, the transformation has 
     * to be postponed to this final step of CREATE TABLE. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN510"><span class='Ref_To_Local'>rawDefaults</span></a> <span class='Operator'>|| </span><a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1982"><span class='Ref_to_Member'>constraints</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/catalog/heap.h.html#LN97"><span class='Ref_to_Proto'>AddRelationNewConstraints</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN504"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN510"><span class='Ref_To_Local'>rawDefaults</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN497"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1982"><span class='Ref_to_Member'>constraints</span></a><span class='Delimiter'>, 
</span>                                  <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN517"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN502"><span class='Ref_To_Local'>relationId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Clean up.  We keep lock on new relation (although it shouldn't be 
     * visible to anyone else anyway, until commit). 
     */ 
</span>    <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN504"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN517"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DefineRelation &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Emit the right error or warning message for a "DROP" command issued on a 
 * non-existent relation 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN879"></a><span class='Declare_Function'>DropErrorMsgNonExistent</span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>rightkind</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>missing_ok</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN881"></a>    <span class='Keyword'>const </span><span class='Control'>struct</span> <a href="tablecmds.c.html#LN207"><span class='Ref_to_Struct'>dropmsgstrings</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rentry</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN879"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN66"><span class='Ref_to_Member'>schemaname</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/namespace.h.html#LN112"><span class='Ref_to_Proto'>LookupNamespaceNoError</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN879"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN66"><span class='Ref_to_Member'>schemaname</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN879"><span class='Ref_to_Parameter'>missing_ok</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_SCHEMA<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                   <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"schema \"%s\" does not exist"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN879"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN66"><span class='Ref_to_Member'>schemaname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"schema \"%s\" does not exist, skipping"</span><span class='Delimiter'>, 
</span>                            <a href="tablecmds.c.html#LN879"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN66"><span class='Ref_to_Member'>schemaname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN881"><span class='Ref_To_Local'>rentry</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN217"><span class='Ref_to_Global_Var'>dropmsgstringarray</span></a><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN881"><span class='Ref_To_Local'>rentry</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN209"><span class='Ref_to_Member'>kind</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN881"><span class='Ref_To_Local'>rentry</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN881"><span class='Ref_To_Local'>rentry</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN209"><span class='Ref_to_Member'>kind</span></a> <span class='Operator'>== </span><a href="tablecmds.c.html#LN879"><span class='Ref_to_Parameter'>rightkind</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN879"><span class='Ref_to_Parameter'>missing_ok</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN881"><span class='Ref_To_Local'>rentry</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN210"><span class='Ref_to_Member'>nonexistent_code</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN881"><span class='Ref_To_Local'>rentry</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN211"><span class='Ref_to_Member'>nonexistent_msg</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN879"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN881"><span class='Ref_To_Local'>rentry</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN212"><span class='Ref_to_Member'>skipping_msg</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN879"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN881"><span class='Ref_To_Local'>rentry</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN209"><span class='Ref_to_Member'>kind</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* Should be impossible */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end DropErrorMsgNonExistent &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Emit the right error message for a "DROP" command issued on a 
 * relation of the wrong type 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN927"></a><span class='Declare_Function'>DropErrorMsgWrongType</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>relname</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>wrongkind</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>rightkind</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN929"></a>    <span class='Keyword'>const </span><span class='Control'>struct</span> <a href="tablecmds.c.html#LN207"><span class='Ref_to_Struct'>dropmsgstrings</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rentry</span><span class='Delimiter'>; 
</span><a name="LN930"></a>    <span class='Keyword'>const </span><span class='Control'>struct</span> <a href="tablecmds.c.html#LN207"><span class='Ref_to_Struct'>dropmsgstrings</span></a> <span class='Operator'>*</span><span class='Declare_Local'>wentry</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN929"><span class='Ref_To_Local'>rentry</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN217"><span class='Ref_to_Global_Var'>dropmsgstringarray</span></a><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN929"><span class='Ref_To_Local'>rentry</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN209"><span class='Ref_to_Member'>kind</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN929"><span class='Ref_To_Local'>rentry</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN929"><span class='Ref_To_Local'>rentry</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN209"><span class='Ref_to_Member'>kind</span></a> <span class='Operator'>== </span><a href="tablecmds.c.html#LN927"><span class='Ref_to_Parameter'>rightkind</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN929"><span class='Ref_To_Local'>rentry</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN209"><span class='Ref_to_Member'>kind</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN930"><span class='Ref_To_Local'>wentry</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN217"><span class='Ref_to_Global_Var'>dropmsgstringarray</span></a><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN930"><span class='Ref_To_Local'>wentry</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN209"><span class='Ref_to_Member'>kind</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN930"><span class='Ref_To_Local'>wentry</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN930"><span class='Ref_To_Local'>wentry</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN209"><span class='Ref_to_Member'>kind</span></a> <span class='Operator'>== </span><a href="tablecmds.c.html#LN927"><span class='Ref_to_Parameter'>wrongkind</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* wrongkind could be something we don't have in our table... */ 
</span> 
    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN929"><span class='Ref_To_Local'>rentry</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN213"><span class='Ref_to_Member'>nota_msg</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN927"><span class='Ref_to_Parameter'>relname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>       <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN930"><span class='Ref_To_Local'>wentry</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN209"><span class='Ref_to_Member'>kind</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>)</span> <span class='Operator'>? </span><a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"%s"</span><span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><a href="tablecmds.c.html#LN930"><span class='Ref_To_Local'>wentry</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN214"><span class='Ref_to_Member'>drophint_msg</span></a><span class='Parentheses'>))</span> <span class='Operator'>: </span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DropErrorMsgWrongType &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * RemoveRelations 
 *      Implements DROP TABLE, DROP INDEX, DROP SEQUENCE, DROP VIEW, 
 *      DROP MATERIALIZED VIEW, DROP FOREIGN TABLE 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN954"></a><span class='Declare_Function'>RemoveRelations</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2546"><span class='Ref_to_Struct'>DropStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>drop</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN956"></a>    <a href="../catalog/dependency.c.html#LN108"><span class='Ref_to_Struct'>ObjectAddresses</span></a> <span class='Operator'>*</span><span class='Declare_Local'>objects</span><span class='Delimiter'>; 
</span><a name="LN957"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>relkind</span><span class='Delimiter'>; 
</span><a name="LN958"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span><a name="LN959"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>flags</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN960"></a>    <a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a>    <span class='Declare_Local'>lockmode</span> <span class='Operator'>= </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* DROP CONCURRENTLY uses a weaker lock, and has some restrictions */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN954"><span class='Ref_to_Parameter'>drop</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2553"><span class='Ref_to_Member'>concurrent</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN959"><span class='Ref_To_Local'>flags</span></a> <span class='Operator'>|= </span><a href="../../include/catalog/dependency.h.html#LN174"><span class='Ref_to_Const'>PERFORM_DELETION_CONCURRENTLY</span></a><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN960"><span class='Ref_To_Local'>lockmode</span></a> <span class='Operator'>= </span><a href="../../include/storage/lockdefs.h.html#LN38"><span class='Ref_to_Const'>ShareUpdateExclusiveLock</span></a><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN954"><span class='Ref_to_Parameter'>drop</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2550"><span class='Ref_to_Member'>removeType</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN1605"><span class='Ref_to_EnumConst'>OBJECT_INDEX</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN954"><span class='Ref_to_Parameter'>drop</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2549"><span class='Ref_to_Member'>objects</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"DROP INDEX CONCURRENTLY does not support dropping multiple objects"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN954"><span class='Ref_to_Parameter'>drop</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2551"><span class='Ref_to_Member'>behavior</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN1655"><span class='Ref_to_EnumConst'>DROP_CASCADE</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"DROP INDEX CONCURRENTLY does not support CASCADE"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * First we identify all the relations, then we delete them in a single 
     * performMultipleDeletions() call.  This is to avoid unwanted DROP 
     * RESTRICT errors if one of the relations depends on another. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* Determine required relkind */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN954"><span class='Ref_to_Parameter'>drop</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2550"><span class='Ref_to_Member'>removeType</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1622"><span class='Ref_to_EnumConst'>OBJECT_TABLE</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN957"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1605"><span class='Ref_to_EnumConst'>OBJECT_INDEX</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN957"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_class.h.html#LN160"><span class='Ref_to_Const'>RELKIND_INDEX</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1618"><span class='Ref_to_EnumConst'>OBJECT_SEQUENCE</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN957"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1632"><span class='Ref_to_EnumConst'>OBJECT_VIEW</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN957"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_class.h.html#LN163"><span class='Ref_to_Const'>RELKIND_VIEW</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1608"><span class='Ref_to_EnumConst'>OBJECT_MATVIEW</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN957"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1603"><span class='Ref_to_EnumConst'>OBJECT_FOREIGN_TABLE</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN957"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized drop object type: %d"</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN954"><span class='Ref_to_Parameter'>drop</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2550"><span class='Ref_to_Member'>removeType</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN957"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch drop-&GT;removeType &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Lock and validate each relation; build a list of object addresses */ 
</span>    <a href="tablecmds.c.html#LN956"><span class='Ref_To_Local'>objects</span></a> <span class='Operator'>= </span><a href="../../include/catalog/dependency.h.html#LN200"><span class='Ref_to_Proto'>new_object_addresses</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN958"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN954"><span class='Ref_to_Parameter'>drop</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2549"><span class='Ref_to_Member'>objects</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1023"></a>        <a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>rel</span> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN119"><span class='Ref_to_Proto'>makeRangeVarFromNameList</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN958"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN1024"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relOid</span><span class='Delimiter'>; 
</span><a name="LN1025"></a>        <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>obj</span><span class='Delimiter'>; 
</span><a name="LN1026"></a>        <span class='Control'>struct</span> <a href="tablecmds.c.html#LN269"><span class='Ref_to_Struct'>DropRelationCallbackState</span></a> <span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * These next few steps are a great deal like relation_openrv, but we 
         * don't bother building a relcache entry since we don't need it. 
         * 
         * Check for shared-cache-inval messages before trying to access the 
         * relation.  This is needed to cover the case where the name 
         * identifies a rel that has been dropped and recreated since the 
         * start of our transaction: if we don't flush the old syscache entry, 
         * then we'll latch onto that entry and suffer an error later. 
         */ 
</span>        <a href="../../include/utils/inval.h.html#LN25"><span class='Ref_to_Proto'>AcceptInvalidationMessages</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Look up the appropriate relation using namespace search. */ 
</span>        <a href="tablecmds.c.html#LN1026"><span class='Ref_To_Local'>state</span></a><span class='Operator'>.</span><a href="tablecmds.c.html#LN271"><span class='Ref_to_Member'>relkind</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN957"><span class='Ref_To_Local'>relkind</span></a><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN1026"><span class='Ref_To_Local'>state</span></a><span class='Operator'>.</span><a href="tablecmds.c.html#LN272"><span class='Ref_to_Member'>heapOid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN1026"><span class='Ref_To_Local'>state</span></a><span class='Operator'>.</span><a href="tablecmds.c.html#LN273"><span class='Ref_to_Member'>partParentOid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN1026"><span class='Ref_To_Local'>state</span></a><span class='Operator'>.</span><a href="tablecmds.c.html#LN274"><span class='Ref_to_Member'>concurrent</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN954"><span class='Ref_to_Parameter'>drop</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2553"><span class='Ref_to_Member'>concurrent</span></a><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN1024"><span class='Ref_To_Local'>relOid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN55"><span class='Ref_to_Proto'>RangeVarGetRelidExtended</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1023"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN960"><span class='Ref_To_Local'>lockmode</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                          <span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                          <a href="tablecmds.c.html#LN463"><span class='Ref_to_Proto'>RangeVarCallbackForDropRelation</span></a><span class='Delimiter'>, 
</span>                                          <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN1026"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Not there? */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1024"><span class='Ref_To_Local'>relOid</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="tablecmds.c.html#LN878"><span class='Ref_to_Func'>DropErrorMsgNonExistent</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1023"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN957"><span class='Ref_To_Local'>relkind</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN954"><span class='Ref_to_Parameter'>drop</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2552"><span class='Ref_to_Member'>missing_ok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* OK, we're ready to delete this one */ 
</span>        <a href="tablecmds.c.html#LN1025"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN1025"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1024"><span class='Ref_To_Local'>relOid</span></a><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN1025"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/dependency.h.html#LN202"><span class='Ref_to_Proto'>add_exact_object_address</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN1025"><span class='Ref_To_Local'>obj</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN956"><span class='Ref_To_Local'>objects</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/catalog/dependency.h.html#LN185"><span class='Ref_to_Proto'>performMultipleDeletions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN956"><span class='Ref_To_Local'>objects</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN954"><span class='Ref_to_Parameter'>drop</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2551"><span class='Ref_to_Member'>behavior</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN959"><span class='Ref_To_Local'>flags</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/dependency.h.html#LN212"><span class='Ref_to_Proto'>free_object_addresses</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN956"><span class='Ref_To_Local'>objects</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RemoveRelations &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Before acquiring a table lock, check whether we have sufficient rights. 
 * In the case of DROP INDEX, also try to lock the table before the index. 
 * Also, if the table to be dropped is a partition, we try to lock the parent 
 * first. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1077"></a><span class='Declare_Function'>RangeVarCallbackForDropRelation</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relOid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oldRelOid</span><span class='Delimiter'>, 
</span><a name="LN1078"></a>                                <span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1080"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN1081"></a>    <span class='Control'>struct</span> <a href="tablecmds.c.html#LN269"><span class='Ref_to_Struct'>DropRelationCallbackState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN1082"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>relkind</span><span class='Delimiter'>; 
</span><a name="LN1083"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>expected_relkind</span><span class='Delimiter'>; 
</span><a name="LN1084"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_partition</span><span class='Delimiter'>; 
</span><a name="LN1085"></a>    <a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Local'>classform</span><span class='Delimiter'>; 
</span><a name="LN1086"></a>    <a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a>    <span class='Declare_Local'>heap_lockmode</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN1081"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="tablecmds.c.html#LN269"><span class='Ref_to_Struct'>DropRelationCallbackState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN1078"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN1082"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1081"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN271"><span class='Ref_to_Member'>relkind</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN1086"><span class='Ref_To_Local'>heap_lockmode</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1081"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN274"><span class='Ref_to_Member'>concurrent</span></a> <span class='Operator'>? 
</span>        <a href="../../include/storage/lockdefs.h.html#LN38"><span class='Ref_to_Const'>ShareUpdateExclusiveLock</span></a> <span class='Operator'>: </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we previously locked some other index's heap, and the name we're 
     * looking up no longer refers to that relation, release the now-useless 
     * lock. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1077"><span class='Ref_to_Parameter'>relOid</span></a> <span class='Operator'>!= </span><a href="tablecmds.c.html#LN1077"><span class='Ref_to_Parameter'>oldRelOid</span></a> <span class='Operator'>&& </span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1081"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN272"><span class='Ref_to_Member'>heapOid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/storage/lmgr.h.html#LN42"><span class='Ref_to_Proto'>UnlockRelationOid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1081"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN272"><span class='Ref_to_Member'>heapOid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1086"><span class='Ref_To_Local'>heap_lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN1081"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN272"><span class='Ref_to_Member'>heapOid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Similarly, if we previously locked some other partition's heap, and the 
     * name we're looking up no longer refers to that relation, release the 
     * now-useless lock. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1077"><span class='Ref_to_Parameter'>relOid</span></a> <span class='Operator'>!= </span><a href="tablecmds.c.html#LN1077"><span class='Ref_to_Parameter'>oldRelOid</span></a> <span class='Operator'>&& </span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1081"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN273"><span class='Ref_to_Member'>partParentOid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/storage/lmgr.h.html#LN42"><span class='Ref_to_Proto'>UnlockRelationOid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1081"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN273"><span class='Ref_to_Member'>partParentOid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN1081"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN273"><span class='Ref_to_Member'>partParentOid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Didn't find a relation, so no need for locking or permission checks. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1077"><span class='Ref_to_Parameter'>relOid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN1080"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1077"><span class='Ref_to_Parameter'>relOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1080"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span><span class='Delimiter'>;</span>                 <span class='Comment_Single_Line'>/* concurrently dropped, so nothing to do */ 
</span>    <a href="tablecmds.c.html#LN1085"><span class='Ref_To_Local'>classform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1080"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN1084"><span class='Ref_To_Local'>is_partition</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1085"><span class='Ref_To_Local'>classform</span></a><span class='Operator'>-&GT;</span>relispartition<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Both RELKIND_RELATION and RELKIND_PARTITIONED_TABLE are OBJECT_TABLE, 
     * but RemoveRelations() can only pass one relkind for a given relation. 
     * It chooses RELKIND_RELATION for both regular and partitioned tables. 
     * That means we must be careful before giving the wrong type error when 
     * the relation is RELKIND_PARTITIONED_TABLE. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1085"><span class='Ref_To_Local'>classform</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>        <a href="tablecmds.c.html#LN1083"><span class='Ref_To_Local'>expected_relkind</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="tablecmds.c.html#LN1083"><span class='Ref_To_Local'>expected_relkind</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1085"><span class='Ref_To_Local'>classform</span></a><span class='Operator'>-&GT;</span>relkind<span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1082"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>!= </span><a href="tablecmds.c.html#LN1083"><span class='Ref_To_Local'>expected_relkind</span></a><span class='Parentheses'>) 
</span>        <a href="tablecmds.c.html#LN926"><span class='Ref_to_Func'>DropErrorMsgWrongType</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1077"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1085"><span class='Ref_To_Local'>classform</span></a><span class='Operator'>-&GT;</span>relkind<span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1082"><span class='Ref_To_Local'>relkind</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Allow DROP to either table owner or schema owner */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN308"><span class='Ref_to_Proto'>pg_class_ownercheck</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1077"><span class='Ref_to_Parameter'>relOid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>())</span> <span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN314"><span class='Ref_to_Proto'>pg_namespace_ownercheck</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1085"><span class='Ref_To_Local'>classform</span></a><span class='Operator'>-&GT;</span>relnamespace<span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN181"><span class='Ref_to_EnumConst'>ACL_KIND_CLASS</span></a><span class='Delimiter'>, 
</span>                       <a href="tablecmds.c.html#LN1077"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/init/globals.c.html#LN111"><span class='Ref_to_Global_Var'>allowSystemTableMods</span></a> <span class='Operator'>&& </span><a href="../../include/catalog/catalog.h.html#LN33"><span class='Ref_to_Proto'>IsSystemClass</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1077"><span class='Ref_to_Parameter'>relOid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1085"><span class='Ref_To_Local'>classform</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied: \"%s\" is a system catalog"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN1077"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1080"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * In DROP INDEX, attempt to acquire lock on the parent table before 
     * locking the index.  index_drop() will need this anyway, and since 
     * regular queries lock tables before their indexes, we risk deadlock if 
     * we do it the other way around.  No error if we don't find a pg_index 
     * entry, though --- the relation may have been dropped. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1082"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN160"><span class='Ref_to_Const'>RELKIND_INDEX</span></a> <span class='Operator'>&& </span><a href="tablecmds.c.html#LN1077"><span class='Ref_to_Parameter'>relOid</span></a> <span class='Operator'>!= </span><a href="tablecmds.c.html#LN1077"><span class='Ref_to_Parameter'>oldRelOid</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN1081"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN272"><span class='Ref_to_Member'>heapOid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/index.h.html#LN131"><span class='Ref_to_Proto'>IndexGetRelation</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1077"><span class='Ref_to_Parameter'>relOid</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1081"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN272"><span class='Ref_to_Member'>heapOid</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/storage/lmgr.h.html#LN39"><span class='Ref_to_Proto'>LockRelationOid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1081"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN272"><span class='Ref_to_Member'>heapOid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1086"><span class='Ref_To_Local'>heap_lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Similarly, if the relation is a partition, we must acquire lock on its 
     * parent before locking the partition.  That's because queries lock the 
     * parent before its partitions, so we risk deadlock it we do it the other 
     * way around. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1084"><span class='Ref_To_Local'>is_partition</span></a> <span class='Operator'>&& </span><a href="tablecmds.c.html#LN1077"><span class='Ref_to_Parameter'>relOid</span></a> <span class='Operator'>!= </span><a href="tablecmds.c.html#LN1077"><span class='Ref_to_Parameter'>oldRelOid</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN1081"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN273"><span class='Ref_to_Member'>partParentOid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/partition.h.html#LN78"><span class='Ref_to_Proto'>get_partition_parent</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1077"><span class='Ref_to_Parameter'>relOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1081"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN273"><span class='Ref_to_Member'>partParentOid</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/storage/lmgr.h.html#LN39"><span class='Ref_to_Proto'>LockRelationOid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1081"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN273"><span class='Ref_to_Member'>partParentOid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end RangeVarCallbackForDropRelation &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ExecuteTruncate 
 *      Executes a TRUNCATE command. 
 * 
 * This is a multi-relation truncate.  We first open and grab exclusive 
 * lock on all relations involved, checking permissions and otherwise 
 * verifying that the relation is OK for truncation.  In CASCADE mode, 
 * relations having FK references to the targeted relations are automatically 
 * added to the group; in RESTRICT mode, we check that all FK references are 
 * internal to the group that's being truncated.  Finally all the relations 
 * are truncated and reindexed. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1195"></a><span class='Declare_Function'>ExecuteTruncate</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2560"><span class='Ref_to_Struct'>TruncateStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1197"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>rels</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1198"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>relids</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1199"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>seq_relids</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1200"></a>    <a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>estate</span><span class='Delimiter'>; 
</span><a name="LN1201"></a>    <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>resultRelInfos</span><span class='Delimiter'>; 
</span><a name="LN1202"></a>    <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>resultRelInfo</span><span class='Delimiter'>; 
</span><a name="LN1203"></a>    <a href="../../include/c.h.html#LN400"><span class='Ref_to_Typedef'>SubTransactionId</span></a> <span class='Declare_Local'>mySubid</span><span class='Delimiter'>; 
</span><a name="LN1204"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Open, exclusive-lock, and check all the explicitly-specified relations 
     */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1204"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1195"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2563"><span class='Ref_to_Member'>relations</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1211"></a>        <a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>rv</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1204"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1212"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN1213"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>recurse</span> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1211"><span class='Ref_To_Local'>rv</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN68"><span class='Ref_to_Member'>inh</span></a><span class='Delimiter'>; 
</span><a name="LN1214"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>myrelid</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN1212"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN92"><span class='Ref_to_Proto'>heap_openrv</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1211"><span class='Ref_To_Local'>rv</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN1214"><span class='Ref_To_Local'>myrelid</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1212"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* don't throw error for "TRUNCATE foo, foo" */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN231"><span class='Ref_to_Proto'>list_member_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1198"><span class='Ref_To_Local'>relids</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1214"><span class='Ref_To_Local'>myrelid</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1212"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="tablecmds.c.html#LN293"><span class='Ref_to_Proto'>truncate_check_rel</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1212"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN1197"><span class='Ref_To_Local'>rels</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1197"><span class='Ref_To_Local'>rels</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1212"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN1198"><span class='Ref_To_Local'>relids</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1198"><span class='Ref_To_Local'>relids</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1214"><span class='Ref_To_Local'>myrelid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1213"><span class='Ref_To_Local'>recurse</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1230"></a>            <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>child</span><span class='Delimiter'>; 
</span><a name="LN1231"></a>            <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>children</span><span class='Delimiter'>; 
</span> 
            <a href="tablecmds.c.html#LN1231"><span class='Ref_To_Local'>children</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_inherits_fn.h.html#LN20"><span class='Ref_to_Proto'>find_all_inheritors</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1214"><span class='Ref_To_Local'>myrelid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1230"><span class='Ref_To_Local'>child</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1231"><span class='Ref_To_Local'>children</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1237"></a>                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>childrelid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1230"><span class='Ref_To_Local'>child</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN231"><span class='Ref_to_Proto'>list_member_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1198"><span class='Ref_To_Local'>relids</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1237"><span class='Ref_To_Local'>childrelid</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* find_all_inheritors already got lock */ 
</span>                <a href="tablecmds.c.html#LN1212"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1237"><span class='Ref_To_Local'>childrelid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN293"><span class='Ref_to_Proto'>truncate_check_rel</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1212"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN1197"><span class='Ref_To_Local'>rels</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1197"><span class='Ref_To_Local'>rels</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1212"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN1198"><span class='Ref_To_Local'>relids</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1198"><span class='Ref_To_Local'>relids</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1237"><span class='Ref_To_Local'>childrelid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if recurse &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1212"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot truncate only a partitioned table"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Do not specify the ONLY keyword, or use truncate only on the partitions directly."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * In CASCADE mode, suck in all referencing relations as well.  This 
     * requires multiple iterations to find indirectly-dependent relations. At 
     * each phase, we need to exclusive-lock new rels before looking for their 
     * dependencies, else we might miss something.  Also, we check each rel as 
     * soon as we open it, to avoid a faux pas such as holding lock for a long 
     * time on a rel we have no permissions for. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1195"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2565"><span class='Ref_to_Member'>behavior</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN1655"><span class='Ref_to_EnumConst'>DROP_CASCADE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1268"></a>            <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>newrelids</span><span class='Delimiter'>; 
</span> 
            <a href="tablecmds.c.html#LN1268"><span class='Ref_To_Local'>newrelids</span></a> <span class='Operator'>= </span><a href="../../include/catalog/heap.h.html#LN85"><span class='Ref_to_Proto'>heap_truncate_find_FKs</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1198"><span class='Ref_To_Local'>relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1268"><span class='Ref_To_Local'>newrelids</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* nothing else to add */ 
</span> 
            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1204"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1268"><span class='Ref_To_Local'>newrelids</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1276"></a>                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1204"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1277"></a>                <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span> 
                <a href="tablecmds.c.html#LN1277"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1276"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"truncate cascades to table \"%s\""</span><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1277"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN293"><span class='Ref_to_Proto'>truncate_check_rel</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1277"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN1197"><span class='Ref_To_Local'>rels</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1197"><span class='Ref_To_Local'>rels</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1277"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN1198"><span class='Ref_To_Local'>relids</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1198"><span class='Ref_To_Local'>relids</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1276"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if stmt-&GT;behavior==DROP_... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Check foreign key references.  In CASCADE mode, this should be 
     * unnecessary since we just pulled in all the references; but as a 
     * cross-check, do it anyway if in an Assert-enabled build. 
     */ 
</span><span class='Directive'>#ifdef</span> USE_ASSERT_CHECKING 
    <a href="../../include/catalog/heap.h.html#LN83"><span class='Ref_to_Proto'>heap_truncate_check_FKs</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1197"><span class='Ref_To_Local'>rels</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1195"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2565"><span class='Ref_to_Member'>behavior</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN1654"><span class='Ref_to_EnumConst'>DROP_RESTRICT</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/catalog/heap.h.html#LN83"><span class='Ref_to_Proto'>heap_truncate_check_FKs</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1197"><span class='Ref_To_Local'>rels</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If we are asked to restart sequences, find all the sequences, lock them 
     * (we need AccessExclusiveLock for ResetSequence), and check permissions. 
     * We want to do this early since it's pointless to do all the truncation 
     * work only to fail on sequence permissions. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1195"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2564"><span class='Ref_to_Member'>restart_seqs</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1204"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1197"><span class='Ref_To_Local'>rels</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1312"></a>            <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1204"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1313"></a>            <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>seqlist</span> <span class='Operator'>= </span><a href="../../include/catalog/dependency.h.html#LN241"><span class='Ref_to_Proto'>getOwnedSequences</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1312"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1314"></a>            <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>seqcell</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1314"><span class='Ref_To_Local'>seqcell</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1313"><span class='Ref_To_Local'>seqlist</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1318"></a>                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>seq_relid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1314"><span class='Ref_To_Local'>seqcell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1319"></a>                <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>seq_rel</span><span class='Delimiter'>; 
</span> 
                <a href="tablecmds.c.html#LN1319"><span class='Ref_To_Local'>seq_rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN84"><span class='Ref_to_Proto'>relation_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1318"><span class='Ref_To_Local'>seq_relid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* This check must match AlterSequence! */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN308"><span class='Ref_to_Proto'>pg_class_ownercheck</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1318"><span class='Ref_To_Local'>seq_relid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
                    <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN181"><span class='Ref_to_EnumConst'>ACL_KIND_CLASS</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1319"><span class='Ref_To_Local'>seq_rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                <a href="tablecmds.c.html#LN1199"><span class='Ref_To_Local'>seq_relids</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1199"><span class='Ref_To_Local'>seq_relids</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1318"><span class='Ref_To_Local'>seq_relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1319"><span class='Ref_To_Local'>seq_rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if stmt-&GT;restart_seqs &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Prepare to catch AFTER triggers. */ 
</span>    <a href="../../include/commands/trigger.h.html#LN187"><span class='Ref_to_Proto'>AfterTriggerBeginQuery</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * To fire triggers, we'll need an EState as well as a ResultRelInfo for 
     * each relation.  We don't need to call ExecOpenIndices, though. 
     */ 
</span>    <a href="tablecmds.c.html#LN1200"><span class='Ref_To_Local'>estate</span></a> <span class='Operator'>= </span><a href="../executor/execUtils.c.html#LN78"><span class='Ref_to_Func'>CreateExecutorState</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN1201"><span class='Ref_To_Local'>resultRelInfos</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1197"><span class='Ref_To_Local'>rels</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN1202"><span class='Ref_To_Local'>resultRelInfo</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1201"><span class='Ref_To_Local'>resultRelInfos</span></a><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1204"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1197"><span class='Ref_To_Local'>rels</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1348"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1204"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/executor/executor.h.html#LN180"><span class='Ref_to_Proto'>InitResultRelInfo</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1202"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, 
</span>                          <a href="tablecmds.c.html#LN1348"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, 
</span>                          <span class='Number'>0</span><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* dummy rangetable index */ 
</span>                          <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                          <span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN1202"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="tablecmds.c.html#LN1200"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN420"><span class='Ref_to_Member'>es_result_relations</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1201"><span class='Ref_To_Local'>resultRelInfos</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN1200"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN421"><span class='Ref_to_Member'>es_num_result_relations</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1197"><span class='Ref_To_Local'>rels</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Process all BEFORE STATEMENT TRUNCATE triggers before we begin 
     * truncating (this is because one of them might throw an error). Also, if 
     * we were to allow them to prevent statement execution, that would need 
     * to be handled here. 
     */ 
</span>    <a href="tablecmds.c.html#LN1202"><span class='Ref_To_Local'>resultRelInfo</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1201"><span class='Ref_To_Local'>resultRelInfos</span></a><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1204"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1197"><span class='Ref_To_Local'>rels</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN1200"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN422"><span class='Ref_to_Member'>es_result_relation_info</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1202"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>; 
</span>        <a href="../../include/commands/trigger.h.html#LN181"><span class='Ref_to_Proto'>ExecBSTruncateTriggers</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1200"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1202"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN1202"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * OK, truncate each table. 
     */ 
</span>    <a href="tablecmds.c.html#LN1203"><span class='Ref_To_Local'>mySubid</span></a> <span class='Operator'>= </span><a href="../../include/access/xact.h.html#LN336"><span class='Ref_to_Proto'>GetCurrentSubTransactionId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1204"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1197"><span class='Ref_To_Local'>rels</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1381"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1204"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Skip partitioned tables as there is nothing to do */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1381"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Normally, we need a transaction-safe truncation here.  However, if 
         * the table was either created in the current (sub)transaction or has 
         * a new relfilenode in the current (sub)transaction, then we can just 
         * truncate it in-place, because a rollback would cause the whole 
         * table or the current physical file to be thrown away anyway. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1381"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN109"><span class='Ref_to_Member'>rd_createSubid</span></a> <span class='Operator'>== </span><a href="tablecmds.c.html#LN1203"><span class='Ref_To_Local'>mySubid</span></a> <span class='Operator'>|| 
</span>            <a href="tablecmds.c.html#LN1381"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN110"><span class='Ref_to_Member'>rd_newRelfilenodeSubid</span></a> <span class='Operator'>== </span><a href="tablecmds.c.html#LN1203"><span class='Ref_To_Local'>mySubid</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Immediate, non-rollbackable truncation is OK */ 
</span>            <a href="../../include/catalog/heap.h.html#LN81"><span class='Ref_to_Proto'>heap_truncate_one_rel</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1381"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1402"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>heap_relid</span><span class='Delimiter'>; 
</span><a name="LN1403"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>toast_relid</span><span class='Delimiter'>; 
</span><a name="LN1404"></a>            <a href="../../include/c.h.html#LN406"><span class='Ref_to_Typedef'>MultiXactId</span></a> <span class='Declare_Local'>minmulti</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * This effectively deletes all rows in the table, and may be done 
             * in a serializable transaction.  In that case we must record a 
             * rw-conflict in to this transaction from each transaction 
             * holding a predicate lock on the table. 
             */ 
</span>            <a href="../../include/storage/predicate.h.html#LN62"><span class='Ref_to_Proto'>CheckTableForSerializableConflictIn</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1381"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="tablecmds.c.html#LN1404"><span class='Ref_To_Local'>minmulti</span></a> <span class='Operator'>= </span><a href="../../include/access/multixact.h.html#LN137"><span class='Ref_to_Proto'>GetOldestMultiXactId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Need the full transaction-safe pushups. 
             * 
             * Create a new empty storage file for the relation, and assign it 
             * as the relfilenode value. The old storage file is scheduled for 
             * deletion at commit. 
             */ 
</span>            <a href="../../include/utils/relcache.h.html#LN105"><span class='Ref_to_Proto'>RelationSetNewRelfilenode</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1381"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1381"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpersistence<span class='Delimiter'>, 
</span>                                      <a href="../utils/time/snapmgr.c.html#LN164"><span class='Ref_to_Global_Var'>RecentXmin</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1404"><span class='Ref_To_Local'>minmulti</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1381"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpersistence <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN170"><span class='Ref_to_Const'>RELPERSISTENCE_UNLOGGED</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/catalog/heap.h.html#LN75"><span class='Ref_to_Proto'>heap_create_init_fork</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1381"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="tablecmds.c.html#LN1402"><span class='Ref_To_Local'>heap_relid</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1381"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN1403"><span class='Ref_To_Local'>toast_relid</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1381"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltoastrelid<span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * The same for the toast table, if any. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1403"><span class='Ref_To_Local'>toast_relid</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="tablecmds.c.html#LN1381"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN84"><span class='Ref_to_Proto'>relation_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1403"><span class='Ref_To_Local'>toast_relid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/utils/relcache.h.html#LN105"><span class='Ref_to_Proto'>RelationSetNewRelfilenode</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1381"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1381"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpersistence<span class='Delimiter'>, 
</span>                                          <a href="../utils/time/snapmgr.c.html#LN164"><span class='Ref_to_Global_Var'>RecentXmin</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1404"><span class='Ref_To_Local'>minmulti</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1381"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpersistence <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN170"><span class='Ref_to_Const'>RELPERSISTENCE_UNLOGGED</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/catalog/heap.h.html#LN75"><span class='Ref_to_Proto'>heap_create_init_fork</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1381"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1381"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Reconstruct the indexes to match, and we're done. 
             */ 
</span>            <a href="../../include/catalog/index.h.html#LN127"><span class='Ref_to_Proto'>reindex_relation</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1402"><span class='Ref_To_Local'>heap_relid</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/index.h.html#LN121"><span class='Ref_to_Const'>REINDEX_REL_PROCESS_TOAST</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
        <a href="../../include/pgstat.h.html#LN1290"><span class='Ref_to_Proto'>pgstat_count_truncate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1381"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Restart owned sequences if we were asked to. 
     */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1204"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1199"><span class='Ref_To_Local'>seq_relids</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1458"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>seq_relid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1204"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/commands/sequence.h.html#LN60"><span class='Ref_to_Proto'>ResetSequence</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1458"><span class='Ref_To_Local'>seq_relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Process all AFTER STATEMENT TRUNCATE triggers. 
     */ 
</span>    <a href="tablecmds.c.html#LN1202"><span class='Ref_To_Local'>resultRelInfo</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1201"><span class='Ref_To_Local'>resultRelInfos</span></a><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1204"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1197"><span class='Ref_To_Local'>rels</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN1200"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN422"><span class='Ref_to_Member'>es_result_relation_info</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1202"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>; 
</span>        <a href="../../include/commands/trigger.h.html#LN183"><span class='Ref_to_Proto'>ExecASTruncateTriggers</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1200"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1202"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN1202"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Handle queued AFTER triggers */ 
</span>    <a href="../../include/commands/trigger.h.html#LN188"><span class='Ref_to_Proto'>AfterTriggerEndQuery</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1200"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We can clean up the EState now */ 
</span>    <a href="../executor/execUtils.c.html#LN176"><span class='Ref_to_Func'>FreeExecutorState</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1200"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* And close the rels (can't do this while EState still holds refs) */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1204"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1197"><span class='Ref_To_Local'>rels</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1483"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1204"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1483"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end ExecuteTruncate &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Check that a given rel is safe to truncate.  Subroutine for ExecuteTruncate 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1493"></a><span class='Declare_Function'>truncate_check_rel</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1495"></a>    <a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Only allow truncate on regular tables and partitioned tables (although, 
     * the latter are only being included here for the following checks; no 
     * physical truncation will occur in their case.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1493"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a> <span class='Operator'>&& 
</span>        <a href="tablecmds.c.html#LN1493"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a table"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1493"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Permissions checks */ 
</span>    <a href="tablecmds.c.html#LN1495"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN283"><span class='Ref_to_Proto'>pg_class_aclcheck</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1493"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                                  <a href="../../include/nodes/parsenodes.h.html#LN75"><span class='Ref_to_Const'>ACL_TRUNCATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1495"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1495"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN181"><span class='Ref_to_EnumConst'>ACL_KIND_CLASS</span></a><span class='Delimiter'>, 
</span>                       <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1493"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/init/globals.c.html#LN111"><span class='Ref_to_Global_Var'>allowSystemTableMods</span></a> <span class='Operator'>&& </span><a href="../../include/catalog/catalog.h.html#LN29"><span class='Ref_to_Proto'>IsSystemRelation</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1493"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied: \"%s\" is a system catalog"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1493"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Don't allow truncate on temp tables of other backends ... their local 
     * buffer manager is not going to cope. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN533"><span class='Ref_to_Macro'>RELATION_IS_OTHER_TEMP</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1493"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot truncate temporary tables of other sessions"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Also check for active uses of the relation in the current transaction, 
     * including open scans and pending AFTER trigger events. 
     */ 
</span>    <a href="../../include/commands/tablecmds.h.html#LN52"><span class='Ref_to_Proto'>CheckTableNotInUse</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1493"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='String'>"TRUNCATE"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end truncate_check_rel &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * storage_name 
 *    returns the name corresponding to a typstorage/attstorage enum value 
 */ 
</span><span class='Keyword'>static const char </span><span class='Operator'>* 
</span><a name="LN1543"></a><span class='Declare_Function'>storage_name</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Declare_Parameter'>c</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1543"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <span class='String'>'p'</span><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"PLAIN"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='String'>'m'</span><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"MAIN"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='String'>'x'</span><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EXTENDED"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='String'>'e'</span><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EXTERNAL"</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"???"</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/*---------- 
 * MergeAttributes 
 *      Returns new schema given initial schema and superclasses. 
 * 
 * Input arguments: 
 * 'schema' is the column/attribute definition for the table. (It's a list 
 *      of ColumnDef's.) It is destructively changed. 
 * 'supers' is a list of names (as RangeVar nodes) of parent relations. 
 * 'relpersistence' is a persistence type of the table. 
 * 'is_partition' tells if the table is a partition 
 * 
 * Output arguments: 
 * 'supOids' receives a list of the OIDs of the parent relations. 
 * 'supconstr' receives a list of constraints belonging to the parents, 
 *      updated as necessary to be valid for the child. 
 * 'supOidCount' is set to the number of parents that have OID columns. 
 * 
 * Return value: 
 * Completed schema list. 
 * 
 * Notes: 
 *    The order in which the attributes are inherited is very important. 
 *    Intuitively, the inherited attributes should come first. If a table 
 *    inherits from multiple parents, the order of those attributes are 
 *    according to the order of the parents specified in CREATE TABLE. 
 * 
 *    Here's an example: 
 * 
 *      create table person (name text, age int4, location point); 
 *      create table emp (salary int4, manager text) inherits(person); 
 *      create table student (gpa float8) inherits (person); 
 *      create table stud_emp (percent int4) inherits (emp, student); 
 * 
 *    The order of the attributes of stud_emp is: 
 * 
 *                          person {1:name, 2:age, 3:location} 
 *                          /    \ 
 *             {6:gpa}  student   emp {4:salary, 5:manager} 
 *                          \    / 
 *                         stud_emp {7:percent} 
 * 
 *     If the same attribute name appears multiple times, then it appears 
 *     in the result table in the proper location for its first appearance. 
 * 
 *     Constraints (including NOT NULL constraints) for the child table 
 *     are the union of all relevant constraints, from both the child schema 
 *     and parent tables. 
 * 
 *     The default value for a child column is defined as: 
 *      (1) If the child schema specifies a default, that value is used. 
 *      (2) If neither the child nor any parent specifies a default, then 
 *          the column will not have a default. 
 *      (3) If conflicting defaults are inherited from different parents 
 *          (and not overridden by the child), an error is raised. 
 *      (4) Otherwise the inherited default is used. 
 *      Rule (3) is new in Postgres 7.1; in earlier releases you got a 
 *      rather arbitrary choice of which parent default to use. 
 *---------- 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN1620"></a><span class='Declare_Function'>MergeAttributes</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>schema</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>supers</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>relpersistence</span><span class='Delimiter'>, 
</span><a name="LN1621"></a>                <span class='Keyword'>bool </span><span class='Declare_Parameter'>is_partition</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>supOids</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>supconstr</span><span class='Delimiter'>, 
</span><a name="LN1622"></a>                <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>supOidCount</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1624"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>entry</span><span class='Delimiter'>; 
</span><a name="LN1625"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>inhSchema</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1626"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>parentOids</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1627"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>constraints</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1628"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>parentsWithOids</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN1629"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>have_bogus_defaults</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN1630"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>child_attno</span><span class='Delimiter'>; 
</span><a name="LN1631"></a>    <span class='Keyword'>static </span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Declare_Local'>bogus_marker</span> <span class='Operator'>= </span><span class='Delimiter'>{</span><span class='Number'>0</span><span class='Delimiter'>};</span>     <span class='Comment_Single_Line'>/* marks conflicting defaults */ 
</span><a name="LN1632"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>saved_schema</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check for and reject tables with too many columns. We perform this 
     * check relatively early for two reasons: (a) we don't run the risk of 
     * overflowing an AttrNumber in subsequent code (b) an O(n^2) algorithm is 
     * okay if we're processing &LT;= 1600 columns, but could take minutes to 
     * execute if the user attempts to create a table with hundreds of 
     * thousands of columns. 
     * 
     * Note that we also need to check that we do not exceed this figure after 
     * including columns from inherited relations. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1620"><span class='Ref_to_Parameter'>schema</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><a href="../../include/access/htup_details.h.html#LN46"><span class='Ref_to_Const'>MaxHeapAttributeNumber</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_TOO_MANY_COLUMNS<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"tables can have at most %d columns"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/access/htup_details.h.html#LN46"><span class='Ref_to_Const'>MaxHeapAttributeNumber</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * In case of a partition, there are no new column definitions, only dummy 
     * ColumnDefs created for column constraints.  We merge them with the 
     * constraints inherited from the parent. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1621"><span class='Ref_to_Parameter'>is_partition</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN1632"><span class='Ref_To_Local'>saved_schema</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1620"><span class='Ref_to_Parameter'>schema</span></a><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN1620"><span class='Ref_to_Parameter'>schema</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check for duplicate names in the explicit list of attributes. 
     * 
     * Although we might consider merging such entries in the same way that we 
     * handle name conflicts for inherited attributes, it seems to make more 
     * sense to assume such conflicts are errors. 
     */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1624"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1620"><span class='Ref_to_Parameter'>schema</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1671"></a>        <a href="../../include/nodes/parsenodes.h.html#LN636"><span class='Ref_to_Struct'>ColumnDef</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>coldef</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1624"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1672"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>rest</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1624"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1673"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>prev</span> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1624"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1671"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN640"><span class='Ref_to_Member'>typeName</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Typed table column option that does not belong to a column from 
             * the type.  This works because the columns from the type come 
             * first in the list. 
             */ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                            <a href="tablecmds.c.html#LN1671"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN639"><span class='Ref_to_Member'>colname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1672"><span class='Ref_To_Local'>rest</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1689"></a>            <a href="../../include/nodes/parsenodes.h.html#LN636"><span class='Ref_to_Struct'>ColumnDef</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>restdef</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1672"><span class='Ref_To_Local'>rest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1690"></a>            <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>next</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1672"><span class='Ref_To_Local'>rest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>     <span class='Comment_Multi_Line'>/* need to save it in case we 
                                                 * delete it */ 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1671"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN639"><span class='Ref_to_Member'>colname</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1689"><span class='Ref_To_Local'>restdef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN639"><span class='Ref_to_Member'>colname</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1671"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN644"><span class='Ref_to_Member'>is_from_type</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * merge the column options into the column from the type 
                     */ 
</span>                    <a href="tablecmds.c.html#LN1671"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN643"><span class='Ref_to_Member'>is_not_null</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1689"><span class='Ref_To_Local'>restdef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN643"><span class='Ref_to_Member'>is_not_null</span></a><span class='Delimiter'>; 
</span>                    <a href="tablecmds.c.html#LN1671"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN647"><span class='Ref_to_Member'>raw_default</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1689"><span class='Ref_To_Local'>restdef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN647"><span class='Ref_to_Member'>raw_default</span></a><span class='Delimiter'>; 
</span>                    <a href="tablecmds.c.html#LN1671"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN648"><span class='Ref_to_Member'>cooked_default</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1689"><span class='Ref_To_Local'>restdef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN648"><span class='Ref_to_Member'>cooked_default</span></a><span class='Delimiter'>; 
</span>                    <a href="tablecmds.c.html#LN1671"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN652"><span class='Ref_to_Member'>constraints</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1689"><span class='Ref_To_Local'>restdef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN652"><span class='Ref_to_Member'>constraints</span></a><span class='Delimiter'>; 
</span>                    <a href="tablecmds.c.html#LN1671"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN644"><span class='Ref_to_Member'>is_from_type</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                    <a href="../../include/nodes/pg_list.h.html#LN238"><span class='Ref_to_Proto'>list_delete_cell</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1620"><span class='Ref_to_Parameter'>schema</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1672"><span class='Ref_To_Local'>rest</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1673"><span class='Ref_To_Local'>prev</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DUPLICATE_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" specified more than once"</span><span class='Delimiter'>, 
</span>                                    <a href="tablecmds.c.html#LN1671"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN639"><span class='Ref_to_Member'>colname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if strcmp(coldef-&GT;colnam... &raquo; </span> 
            <a href="tablecmds.c.html#LN1673"><span class='Ref_To_Local'>prev</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1672"><span class='Ref_To_Local'>rest</span></a><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN1672"><span class='Ref_To_Local'>rest</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1690"><span class='Ref_To_Local'>next</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while rest!=NULL &raquo; </span> 
    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Scan the parents left-to-right, and merge their attributes to form a 
     * list of inherited attributes (inhSchema).  Also check to see if we need 
     * to inherit an OID column. 
     */ 
</span>    <a href="tablecmds.c.html#LN1630"><span class='Ref_To_Local'>child_attno</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1624"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1620"><span class='Ref_to_Parameter'>supers</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1726"></a>        <a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>parent</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1624"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1727"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span><a name="LN1728"></a>        <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupleDesc</span><span class='Delimiter'>; 
</span><a name="LN1729"></a>        <a href="../../include/access/tupdesc.h.html#LN36"><span class='Ref_to_Typedef'>TupleConstr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>constr</span><span class='Delimiter'>; 
</span><a name="LN1730"></a>        <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a> <span class='Operator'>*</span><span class='Declare_Local'>newattno</span><span class='Delimiter'>; 
</span><a name="LN1731"></a>        <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>parent_attno</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * A self-exclusive lock is needed here.  If two backends attempt to 
         * add children to the same parent simultaneously, and that parent has 
         * no pre-existing children, then both will attempt to update the 
         * parent's relhassubclass field, leading to a "tuple concurrently 
         * updated" error.  Also, this interlocks against a concurrent ANALYZE 
         * on the parent table, which might otherwise be attempting to clear 
         * the parent's relhassubclass field, if its previous children were 
         * recently dropped. 
         * 
         * If the child table is a partition, then we instead grab an 
         * exclusive lock on the parent because its partition descriptor will 
         * be changed by addition of the new partition. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN1621"><span class='Ref_to_Parameter'>is_partition</span></a><span class='Parentheses'>) 
</span>            <a href="tablecmds.c.html#LN1727"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN92"><span class='Ref_to_Proto'>heap_openrv</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1726"><span class='Ref_To_Local'>parent</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN38"><span class='Ref_to_Const'>ShareUpdateExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="tablecmds.c.html#LN1727"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN92"><span class='Ref_to_Proto'>heap_openrv</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1726"><span class='Ref_To_Local'>parent</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We do not allow partitioned tables and partitions to participate in 
         * regular inheritance. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1727"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a> <span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="tablecmds.c.html#LN1621"><span class='Ref_to_Parameter'>is_partition</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot inherit from partitioned table \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="tablecmds.c.html#LN1726"><span class='Ref_To_Local'>parent</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1727"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relispartition <span class='Operator'>&& !</span><a href="tablecmds.c.html#LN1621"><span class='Ref_to_Parameter'>is_partition</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot inherit from partition \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="tablecmds.c.html#LN1726"><span class='Ref_To_Local'>parent</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1727"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a> <span class='Operator'>&& 
</span>            <a href="tablecmds.c.html#LN1727"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a> <span class='Operator'>&& 
</span>            <a href="tablecmds.c.html#LN1727"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"inherited relation \"%s\" is not a table or foreign table"</span><span class='Delimiter'>, 
</span>                            <a href="tablecmds.c.html#LN1726"><span class='Ref_To_Local'>parent</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Permanent rels cannot inherit from temporary ones */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1620"><span class='Ref_to_Parameter'>relpersistence</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN171"><span class='Ref_to_Const'>RELPERSISTENCE_TEMP</span></a> <span class='Operator'>&& 
</span>            <a href="tablecmds.c.html#LN1727"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpersistence <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN171"><span class='Ref_to_Const'>RELPERSISTENCE_TEMP</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN1621"><span class='Ref_to_Parameter'>is_partition</span></a> 
                            <span class='Operator'>? </span><span class='String'>"cannot inherit from temporary relation \"%s\""</span> 
                            <span class='Operator'>: </span><span class='String'>"cannot create a permanent relation as partition of temporary relation \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="tablecmds.c.html#LN1726"><span class='Ref_To_Local'>parent</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* If existing rel is temp, it must belong to this session */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1727"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpersistence <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN171"><span class='Ref_to_Const'>RELPERSISTENCE_TEMP</span></a> <span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="tablecmds.c.html#LN1727"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN89"><span class='Ref_to_Member'>rd_islocaltemp</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN1621"><span class='Ref_to_Parameter'>is_partition</span></a> 
                <span class='Operator'>? </span><span class='String'>"cannot inherit from temporary relation of another session"</span> 
                            <span class='Operator'>: </span><span class='String'>"cannot create as partition of temporary relation of another session"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We should have an UNDER permission flag for this, but for now, 
         * demand that creator of a child table own the parent. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN308"><span class='Ref_to_Proto'>pg_class_ownercheck</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1727"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
            <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN181"><span class='Ref_to_EnumConst'>ACL_KIND_CLASS</span></a><span class='Delimiter'>, 
</span>                           <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1727"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Reject duplications in the list of parents. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN231"><span class='Ref_to_Proto'>list_member_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1626"><span class='Ref_To_Local'>parentOids</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1727"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DUPLICATE_TABLE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"relation \"%s\" would be inherited from more than once"</span><span class='Delimiter'>, 
</span>                    <a href="tablecmds.c.html#LN1726"><span class='Ref_To_Local'>parent</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN1626"><span class='Ref_To_Local'>parentOids</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1626"><span class='Ref_To_Local'>parentOids</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1727"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1727"><span class='Ref_To_Local'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relhasoids<span class='Parentheses'>) 
</span>            <a href="tablecmds.c.html#LN1628"><span class='Ref_To_Local'>parentsWithOids</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN1728"><span class='Ref_To_Local'>tupleDesc</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1727"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN1729"><span class='Ref_To_Local'>constr</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1728"><span class='Ref_To_Local'>tupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN75"><span class='Ref_to_Member'>constr</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * newattno[] will contain the child-table attribute numbers for the 
         * attributes of this parent table.  (They are not the same for 
         * parents after the first one, nor if we have dropped columns.) 
         */ 
</span>        <a href="tablecmds.c.html#LN1730"><span class='Ref_To_Local'>newattno</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1728"><span class='Ref_To_Local'>tupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1731"><span class='Ref_To_Local'>parent_attno</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN1731"><span class='Ref_To_Local'>parent_attno</span></a> <span class='Operator'>&LT;= </span><a href="tablecmds.c.html#LN1728"><span class='Ref_To_Local'>tupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; 
</span>             <a href="tablecmds.c.html#LN1731"><span class='Ref_To_Local'>parent_attno</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1830"></a>            <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>attribute</span> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1728"><span class='Ref_To_Local'>tupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN1731"><span class='Ref_To_Local'>parent_attno</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN1831"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>attributeName</span> <span class='Operator'>= </span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1830"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1832"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>exist_attno</span><span class='Delimiter'>; 
</span><a name="LN1833"></a>            <a href="../../include/nodes/parsenodes.h.html#LN636"><span class='Ref_to_Struct'>ColumnDef</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>def</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Ignore dropped columns in the parent. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1830"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* leave newattno entry as zero */ 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Does it conflict with some previously inherited column? 
             */ 
</span>            <a href="tablecmds.c.html#LN1832"><span class='Ref_To_Local'>exist_attno</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN305"><span class='Ref_to_Proto'>findAttrByName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1831"><span class='Ref_To_Local'>attributeName</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1625"><span class='Ref_To_Local'>inhSchema</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1832"><span class='Ref_To_Local'>exist_attno</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1847"></a>                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>defTypeId</span><span class='Delimiter'>; 
</span><a name="LN1848"></a>                <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>deftypmod</span><span class='Delimiter'>; 
</span><a name="LN1849"></a>                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>defCollId</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Yes, try to merge the two column definitions. They must 
                 * have the same type, typmod, and collation. 
                 */ 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"merging multiple inherited definitions of column \"%s\""</span><span class='Delimiter'>, 
</span>                                <a href="tablecmds.c.html#LN1831"><span class='Ref_To_Local'>attributeName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN1833"><span class='Ref_To_Local'>def</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN636"><span class='Ref_to_Struct'>ColumnDef</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN223"><span class='Ref_to_Proto'>list_nth</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1625"><span class='Ref_To_Local'>inhSchema</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1832"><span class='Ref_To_Local'>exist_attno</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/parser/parse_type.h.html#LN28"><span class='Ref_to_Proto'>typenameTypeIdAndMod</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1833"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN640"><span class='Ref_to_Member'>typeName</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN1847"><span class='Ref_To_Local'>defTypeId</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN1848"><span class='Ref_To_Local'>deftypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1847"><span class='Ref_To_Local'>defTypeId</span></a> <span class='Operator'>!= </span><a href="tablecmds.c.html#LN1830"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>-&GT;</span>atttypid <span class='Operator'>|| 
</span>                    <a href="tablecmds.c.html#LN1848"><span class='Ref_To_Local'>deftypmod</span></a> <span class='Operator'>!= </span><a href="tablecmds.c.html#LN1830"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>-&GT;</span>atttypmod<span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"inherited column \"%s\" has a type conflict"</span><span class='Delimiter'>, 
</span>                               <a href="tablecmds.c.html#LN1831"><span class='Ref_To_Local'>attributeName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"%s versus %s"</span><span class='Delimiter'>, 
</span>                                       <a href="../utils/adt/format_type.c.html#LN111"><span class='Ref_to_Func'>format_type_with_typemod</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1847"><span class='Ref_To_Local'>defTypeId</span></a><span class='Delimiter'>, 
</span>                                                                <a href="tablecmds.c.html#LN1848"><span class='Ref_To_Local'>deftypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../utils/adt/format_type.c.html#LN111"><span class='Ref_to_Func'>format_type_with_typemod</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1830"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>, 
</span>                                                    <a href="tablecmds.c.html#LN1830"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>-&GT;</span>atttypmod<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN1849"><span class='Ref_To_Local'>defCollId</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN35"><span class='Ref_to_Proto'>GetColumnDefCollation</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1833"><span class='Ref_To_Local'>def</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1847"><span class='Ref_To_Local'>defTypeId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1849"><span class='Ref_To_Local'>defCollId</span></a> <span class='Operator'>!= </span><a href="tablecmds.c.html#LN1830"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>-&GT;</span>attcollation<span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_COLLATION_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"inherited column \"%s\" has a collation conflict"</span><span class='Delimiter'>, 
</span>                           <a href="tablecmds.c.html#LN1831"><span class='Ref_To_Local'>attributeName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" versus \"%s\""</span><span class='Delimiter'>, 
</span>                                       <a href="../../include/utils/lsyscache.h.html#LN93"><span class='Ref_to_Proto'>get_collation_name</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1849"><span class='Ref_To_Local'>defCollId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="../../include/utils/lsyscache.h.html#LN93"><span class='Ref_to_Proto'>get_collation_name</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1830"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>-&GT;</span>attcollation<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Copy storage parameter */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1833"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN646"><span class='Ref_to_Member'>storage</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="tablecmds.c.html#LN1833"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN646"><span class='Ref_to_Member'>storage</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1830"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>-&GT;</span>attstorage<span class='Delimiter'>; 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1833"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN646"><span class='Ref_to_Member'>storage</span></a> <span class='Operator'>!= </span><a href="tablecmds.c.html#LN1830"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>-&GT;</span>attstorage<span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"inherited column \"%s\" has a storage parameter conflict"</span><span class='Delimiter'>, 
</span>                                    <a href="tablecmds.c.html#LN1831"><span class='Ref_To_Local'>attributeName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"%s versus %s"</span><span class='Delimiter'>, 
</span>                                       <a href="tablecmds.c.html#LN461"><span class='Ref_to_Proto'>storage_name</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1833"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN646"><span class='Ref_to_Member'>storage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                       <a href="tablecmds.c.html#LN461"><span class='Ref_to_Proto'>storage_name</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1830"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>-&GT;</span>attstorage<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
                <a href="tablecmds.c.html#LN1833"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN641"><span class='Ref_to_Member'>inhcount</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Merge of NOT NULL constraints = OR 'em together */ 
</span>                <a href="tablecmds.c.html#LN1833"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN643"><span class='Ref_to_Member'>is_not_null</span></a> <span class='Operator'>|= </span><a href="tablecmds.c.html#LN1830"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>-&GT;</span>attnotnull<span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Default and other constraints are handled below */ 
</span>                <a href="tablecmds.c.html#LN1730"><span class='Ref_To_Local'>newattno</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN1731"><span class='Ref_To_Local'>parent_attno</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="tablecmds.c.html#LN1832"><span class='Ref_To_Local'>exist_attno</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if exist_attno&GT;0 &raquo; </span> 
            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * No, create a new inherited column 
                 */ 
</span>                <a href="tablecmds.c.html#LN1833"><span class='Ref_To_Local'>def</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN636"><span class='Ref_to_Struct'>ColumnDef</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN1833"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN639"><span class='Ref_to_Member'>colname</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1831"><span class='Ref_To_Local'>attributeName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN1833"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN640"><span class='Ref_to_Member'>typeName</span></a> <span class='Operator'>= </span><a href="../../include/nodes/makefuncs.h.html#LN72"><span class='Ref_to_Proto'>makeTypeNameFromOid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1830"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>, 
</span>                                                    <a href="tablecmds.c.html#LN1830"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>-&GT;</span>atttypmod<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN1833"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN641"><span class='Ref_to_Member'>inhcount</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN1833"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN642"><span class='Ref_to_Member'>is_local</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN1833"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN643"><span class='Ref_to_Member'>is_not_null</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1830"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>-&GT;</span>attnotnull<span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN1833"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN644"><span class='Ref_to_Member'>is_from_type</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN1833"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN645"><span class='Ref_to_Member'>is_from_parent</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN1833"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN646"><span class='Ref_to_Member'>storage</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1830"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>-&GT;</span>attstorage<span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN1833"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN647"><span class='Ref_to_Member'>raw_default</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN1833"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN648"><span class='Ref_to_Member'>cooked_default</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN1833"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN650"><span class='Ref_to_Member'>collClause</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN1833"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN651"><span class='Ref_to_Member'>collOid</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1830"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>-&GT;</span>attcollation<span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN1833"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN652"><span class='Ref_to_Member'>constraints</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN1833"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN654"><span class='Ref_to_Member'>location</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN1625"><span class='Ref_To_Local'>inhSchema</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1625"><span class='Ref_To_Local'>inhSchema</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1833"><span class='Ref_To_Local'>def</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN1730"><span class='Ref_To_Local'>newattno</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN1731"><span class='Ref_To_Local'>parent_attno</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= ++</span><a href="tablecmds.c.html#LN1630"><span class='Ref_To_Local'>child_attno</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
            <span class='Comment_Multi_Line'>/* 
             * Copy default if any 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1830"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>-&GT;</span>atthasdef<span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1929"></a>                <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>this_default</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1930"></a>                <a href="../../include/access/tupdesc.h.html#LN21"><span class='Ref_to_Typedef'>AttrDefault</span></a> <span class='Operator'>*</span><span class='Declare_Local'>attrdef</span><span class='Delimiter'>; 
</span><a name="LN1931"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Find default in constraint structure */ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1729"><span class='Ref_To_Local'>constr</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN1930"><span class='Ref_To_Local'>attrdef</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1729"><span class='Ref_To_Local'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN38"><span class='Ref_to_Member'>defval</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1931"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN1931"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tablecmds.c.html#LN1729"><span class='Ref_To_Local'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN40"><span class='Ref_to_Member'>num_defval</span></a><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN1931"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1930"><span class='Ref_To_Local'>attrdef</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN1931"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/access/tupdesc.h.html#LN23"><span class='Ref_to_Member'>adnum</span></a> <span class='Operator'>== </span><a href="tablecmds.c.html#LN1731"><span class='Ref_To_Local'>parent_attno</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="tablecmds.c.html#LN1929"><span class='Ref_To_Local'>this_default</span></a> <span class='Operator'>= </span><a href="../nodes/read.c.html#LN36"><span class='Ref_to_Func'>stringToNode</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1930"><span class='Ref_To_Local'>attrdef</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN1931"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/access/tupdesc.h.html#LN24"><span class='Ref_to_Member'>adbin</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1929"><span class='Ref_To_Local'>this_default</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * If default expr could contain any vars, we'd need to fix 
                 * 'em, but it can't; so default is ready to apply to child. 
                 * 
                 * If we already had a default from some prior parent, check 
                 * to see if they are the same.  If so, no problem; if not, 
                 * mark the column as having a bogus default. Below, we will 
                 * complain if the bogus default isn't overridden by the child 
                 * schema. 
                 */ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1833"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN647"><span class='Ref_to_Member'>raw_default</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1833"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN648"><span class='Ref_to_Member'>cooked_default</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <a href="tablecmds.c.html#LN1833"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN648"><span class='Ref_to_Member'>cooked_default</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1929"><span class='Ref_To_Local'>this_default</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1833"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN648"><span class='Ref_to_Member'>cooked_default</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1929"><span class='Ref_To_Local'>this_default</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="tablecmds.c.html#LN1833"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN648"><span class='Ref_to_Member'>cooked_default</span></a> <span class='Operator'>= &</span><a href="tablecmds.c.html#LN1631"><span class='Ref_To_Local'>bogus_marker</span></a><span class='Delimiter'>; 
</span>                    <a href="tablecmds.c.html#LN1629"><span class='Ref_To_Local'>have_bogus_defaults</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if attribute-&GT;atthasdef &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for parent_attno=1;parent... &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * Now copy the CHECK constraints of this parent, adjusting attnos 
         * using the completed newattno[] map.  Identically named constraints 
         * are merged if possible, else we throw error. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1729"><span class='Ref_To_Local'>constr</span></a> <span class='Operator'>&& </span><a href="tablecmds.c.html#LN1729"><span class='Ref_To_Local'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN41"><span class='Ref_to_Member'>num_check</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1974"></a>            <a href="../../include/access/tupdesc.h.html#LN27"><span class='Ref_to_Typedef'>ConstrCheck</span></a> <span class='Operator'>*</span><span class='Declare_Local'>check</span> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1729"><span class='Ref_To_Local'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN39"><span class='Ref_to_Member'>check</span></a><span class='Delimiter'>; 
</span><a name="LN1975"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1975"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN1975"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tablecmds.c.html#LN1729"><span class='Ref_To_Local'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN41"><span class='Ref_to_Member'>num_check</span></a><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN1975"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1979"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>name</span> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1974"><span class='Ref_To_Local'>check</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN1975"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/access/tupdesc.h.html#LN29"><span class='Ref_to_Member'>ccname</span></a><span class='Delimiter'>; 
</span><a name="LN1980"></a>                <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>expr</span><span class='Delimiter'>; 
</span><a name="LN1981"></a>                <span class='Keyword'>bool</span>        <span class='Declare_Local'>found_whole_row</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* ignore if the constraint is non-inheritable */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1974"><span class='Ref_To_Local'>check</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN1975"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/access/tupdesc.h.html#LN32"><span class='Ref_to_Member'>ccnoinherit</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Adjust Vars to match new table's column numbering */ 
</span>                <a href="tablecmds.c.html#LN1980"><span class='Ref_To_Local'>expr</span></a> <span class='Operator'>= </span><a href="../../include/rewrite/rewriteManip.h.html#LN71"><span class='Ref_to_Proto'>map_variable_attnos</span></a><span class='Parentheses'>(</span><a href="../nodes/read.c.html#LN36"><span class='Ref_to_Func'>stringToNode</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1974"><span class='Ref_To_Local'>check</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN1975"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/access/tupdesc.h.html#LN30"><span class='Ref_to_Member'>ccbin</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                           <span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                           <a href="tablecmds.c.html#LN1730"><span class='Ref_To_Local'>newattno</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1728"><span class='Ref_To_Local'>tupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>, 
</span>                                           <span class='Operator'>&</span><a href="tablecmds.c.html#LN1981"><span class='Ref_To_Local'>found_whole_row</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * For the moment we have to reject whole-row variables. We 
                 * could convert them, if we knew the new table's rowtype OID, 
                 * but that hasn't been assigned yet. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1981"><span class='Ref_To_Local'>found_whole_row</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                          <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot convert whole-row table reference"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Constraint \"%s\" contains a whole-row reference to table \"%s\"."</span><span class='Delimiter'>, 
</span>                                       <a href="tablecmds.c.html#LN1979"><span class='Ref_To_Local'>name</span></a><span class='Delimiter'>, 
</span>                                       <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1727"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* check for duplicate */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN297"><span class='Ref_to_Proto'>MergeCheckConstraint</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1627"><span class='Ref_To_Local'>constraints</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1979"><span class='Ref_To_Local'>name</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1980"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* nope, this is a new one */ 
</span><a name="LN2010"></a>                    <a href="../../include/catalog/heap.h.html#LN27"><span class='Ref_to_Struct'>CookedConstraint</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cooked</span><span class='Delimiter'>; 
</span> 
                    <a href="tablecmds.c.html#LN2010"><span class='Ref_To_Local'>cooked</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/heap.h.html#LN27"><span class='Ref_to_Struct'>CookedConstraint</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/catalog/heap.h.html#LN27"><span class='Ref_to_Struct'>CookedConstraint</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <a href="tablecmds.c.html#LN2010"><span class='Ref_To_Local'>cooked</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/heap.h.html#LN29"><span class='Ref_to_Member'>contype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN2027"><span class='Ref_to_EnumConst'>CONSTR_CHECK</span></a><span class='Delimiter'>; 
</span>                    <a href="tablecmds.c.html#LN2010"><span class='Ref_To_Local'>cooked</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/heap.h.html#LN30"><span class='Ref_to_Member'>conoid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* until created */ 
</span>                    <a href="tablecmds.c.html#LN2010"><span class='Ref_To_Local'>cooked</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/heap.h.html#LN31"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1979"><span class='Ref_To_Local'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="tablecmds.c.html#LN2010"><span class='Ref_To_Local'>cooked</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/heap.h.html#LN32"><span class='Ref_to_Member'>attnum</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* not used for constraints */ 
</span>                    <a href="tablecmds.c.html#LN2010"><span class='Ref_To_Local'>cooked</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/heap.h.html#LN33"><span class='Ref_to_Member'>expr</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1980"><span class='Ref_To_Local'>expr</span></a><span class='Delimiter'>; 
</span>                    <a href="tablecmds.c.html#LN2010"><span class='Ref_To_Local'>cooked</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/heap.h.html#LN34"><span class='Ref_to_Member'>skip_validation</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                    <a href="tablecmds.c.html#LN2010"><span class='Ref_To_Local'>cooked</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/heap.h.html#LN35"><span class='Ref_to_Member'>is_local</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                    <a href="tablecmds.c.html#LN2010"><span class='Ref_To_Local'>cooked</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/heap.h.html#LN36"><span class='Ref_to_Member'>inhcount</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                    <a href="tablecmds.c.html#LN2010"><span class='Ref_To_Local'>cooked</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/heap.h.html#LN37"><span class='Ref_to_Member'>is_no_inherit</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                    <a href="tablecmds.c.html#LN1627"><span class='Ref_To_Local'>constraints</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1627"><span class='Ref_To_Local'>constraints</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2010"><span class='Ref_To_Local'>cooked</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;constr-&GT;num_che... &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if constr&&constr-&GT;num_c... &raquo; </span> 
 
        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1730"><span class='Ref_To_Local'>newattno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Close the parent rel, but keep our lock on it until xact commit. 
         * That will prevent someone else from deleting or ALTERing the parent 
         * before the child is committed. 
         */ 
</span>        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1727"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we had no inherited attributes, the result schema is just the 
     * explicitly declared columns.  Otherwise, we need to merge the declared 
     * columns into the inherited schema list.  Although, we never have any 
     * explicitly declared columns if the table is a partition. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1625"><span class='Ref_To_Local'>inhSchema</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2045"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>schema_attno</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1624"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1620"><span class='Ref_to_Parameter'>schema</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2049"></a>            <a href="../../include/nodes/parsenodes.h.html#LN636"><span class='Ref_to_Struct'>ColumnDef</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>newdef</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1624"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2050"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>attributeName</span> <span class='Operator'>= </span><a href="tablecmds.c.html#LN2049"><span class='Ref_To_Local'>newdef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN639"><span class='Ref_to_Member'>colname</span></a><span class='Delimiter'>; 
</span><a name="LN2051"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>exist_attno</span><span class='Delimiter'>; 
</span> 
            <a href="tablecmds.c.html#LN2045"><span class='Ref_To_Local'>schema_attno</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Does it conflict with some previously inherited column? 
             */ 
</span>            <a href="tablecmds.c.html#LN2051"><span class='Ref_To_Local'>exist_attno</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN305"><span class='Ref_to_Proto'>findAttrByName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2050"><span class='Ref_To_Local'>attributeName</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1625"><span class='Ref_To_Local'>inhSchema</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2051"><span class='Ref_To_Local'>exist_attno</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2061"></a>                <a href="../../include/nodes/parsenodes.h.html#LN636"><span class='Ref_to_Struct'>ColumnDef</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>def</span><span class='Delimiter'>; 
</span><a name="LN2062"></a>                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>defTypeId</span><span class='Delimiter'>, 
</span><a name="LN2063"></a>                            <span class='Declare_Local'>newTypeId</span><span class='Delimiter'>; 
</span><a name="LN2064"></a>                <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>deftypmod</span><span class='Delimiter'>, 
</span><a name="LN2065"></a>                            <span class='Declare_Local'>newtypmod</span><span class='Delimiter'>; 
</span><a name="LN2066"></a>                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>defcollid</span><span class='Delimiter'>, 
</span><a name="LN2067"></a>                            <span class='Declare_Local'>newcollid</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Partitions have only one parent and have no column 
                 * definitions of their own, so conflict should never occur. 
                 */ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN1621"><span class='Ref_to_Parameter'>is_partition</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Yes, try to merge the two column definitions. They must 
                 * have the same type, typmod, and collation. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2051"><span class='Ref_To_Local'>exist_attno</span></a> <span class='Operator'>== </span><a href="tablecmds.c.html#LN2045"><span class='Ref_To_Local'>schema_attno</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"merging column \"%s\" with inherited definition"</span><span class='Delimiter'>, 
</span>                            <a href="tablecmds.c.html#LN2050"><span class='Ref_To_Local'>attributeName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"moving and merging column \"%s\" with inherited definition"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2050"><span class='Ref_To_Local'>attributeName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"User-specified column moved to the position of the inherited column."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN2061"><span class='Ref_To_Local'>def</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN636"><span class='Ref_to_Struct'>ColumnDef</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN223"><span class='Ref_to_Proto'>list_nth</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1625"><span class='Ref_To_Local'>inhSchema</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2051"><span class='Ref_To_Local'>exist_attno</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/parser/parse_type.h.html#LN28"><span class='Ref_to_Proto'>typenameTypeIdAndMod</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2061"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN640"><span class='Ref_to_Member'>typeName</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN2062"><span class='Ref_To_Local'>defTypeId</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN2064"><span class='Ref_To_Local'>deftypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/parser/parse_type.h.html#LN28"><span class='Ref_to_Proto'>typenameTypeIdAndMod</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2049"><span class='Ref_To_Local'>newdef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN640"><span class='Ref_to_Member'>typeName</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN2063"><span class='Ref_To_Local'>newTypeId</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN2065"><span class='Ref_To_Local'>newtypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2062"><span class='Ref_To_Local'>defTypeId</span></a> <span class='Operator'>!= </span><a href="tablecmds.c.html#LN2063"><span class='Ref_To_Local'>newTypeId</span></a> <span class='Operator'>|| </span><a href="tablecmds.c.html#LN2064"><span class='Ref_To_Local'>deftypmod</span></a> <span class='Operator'>!= </span><a href="tablecmds.c.html#LN2065"><span class='Ref_To_Local'>newtypmod</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" has a type conflict"</span><span class='Delimiter'>, 
</span>                                    <a href="tablecmds.c.html#LN2050"><span class='Ref_To_Local'>attributeName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"%s versus %s"</span><span class='Delimiter'>, 
</span>                                       <a href="../utils/adt/format_type.c.html#LN111"><span class='Ref_to_Func'>format_type_with_typemod</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2062"><span class='Ref_To_Local'>defTypeId</span></a><span class='Delimiter'>, 
</span>                                                                <a href="tablecmds.c.html#LN2064"><span class='Ref_To_Local'>deftypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                       <a href="../utils/adt/format_type.c.html#LN111"><span class='Ref_to_Func'>format_type_with_typemod</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2063"><span class='Ref_To_Local'>newTypeId</span></a><span class='Delimiter'>, 
</span>                                                                <a href="tablecmds.c.html#LN2065"><span class='Ref_To_Local'>newtypmod</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN2066"><span class='Ref_To_Local'>defcollid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN35"><span class='Ref_to_Proto'>GetColumnDefCollation</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2061"><span class='Ref_To_Local'>def</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2062"><span class='Ref_To_Local'>defTypeId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN2067"><span class='Ref_To_Local'>newcollid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN35"><span class='Ref_to_Proto'>GetColumnDefCollation</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2049"><span class='Ref_To_Local'>newdef</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2063"><span class='Ref_To_Local'>newTypeId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2066"><span class='Ref_To_Local'>defcollid</span></a> <span class='Operator'>!= </span><a href="tablecmds.c.html#LN2067"><span class='Ref_To_Local'>newcollid</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_COLLATION_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" has a collation conflict"</span><span class='Delimiter'>, 
</span>                                    <a href="tablecmds.c.html#LN2050"><span class='Ref_To_Local'>attributeName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" versus \"%s\""</span><span class='Delimiter'>, 
</span>                                       <a href="../../include/utils/lsyscache.h.html#LN93"><span class='Ref_to_Proto'>get_collation_name</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2066"><span class='Ref_To_Local'>defcollid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                       <a href="../../include/utils/lsyscache.h.html#LN93"><span class='Ref_to_Proto'>get_collation_name</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2067"><span class='Ref_To_Local'>newcollid</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Identity is never inherited.  The new column can have an 
                 * identity definition, so we always just take that one. 
                 */ 
</span>                <a href="tablecmds.c.html#LN2061"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN649"><span class='Ref_to_Member'>identity</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN2049"><span class='Ref_To_Local'>newdef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN649"><span class='Ref_to_Member'>identity</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Copy storage parameter */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2061"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN646"><span class='Ref_to_Member'>storage</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="tablecmds.c.html#LN2061"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN646"><span class='Ref_to_Member'>storage</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN2049"><span class='Ref_To_Local'>newdef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN646"><span class='Ref_to_Member'>storage</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2049"><span class='Ref_To_Local'>newdef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN646"><span class='Ref_to_Member'>storage</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="tablecmds.c.html#LN2061"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN646"><span class='Ref_to_Member'>storage</span></a> <span class='Operator'>!= </span><a href="tablecmds.c.html#LN2049"><span class='Ref_To_Local'>newdef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN646"><span class='Ref_to_Member'>storage</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" has a storage parameter conflict"</span><span class='Delimiter'>, 
</span>                            <a href="tablecmds.c.html#LN2050"><span class='Ref_To_Local'>attributeName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"%s versus %s"</span><span class='Delimiter'>, 
</span>                                       <a href="tablecmds.c.html#LN461"><span class='Ref_to_Proto'>storage_name</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2061"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN646"><span class='Ref_to_Member'>storage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                       <a href="tablecmds.c.html#LN461"><span class='Ref_to_Proto'>storage_name</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2049"><span class='Ref_To_Local'>newdef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN646"><span class='Ref_to_Member'>storage</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Mark the column as locally defined */ 
</span>                <a href="tablecmds.c.html#LN2061"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN642"><span class='Ref_to_Member'>is_local</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Merge of NOT NULL constraints = OR 'em together */ 
</span>                <a href="tablecmds.c.html#LN2061"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN643"><span class='Ref_to_Member'>is_not_null</span></a> <span class='Operator'>|= </span><a href="tablecmds.c.html#LN2049"><span class='Ref_To_Local'>newdef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN643"><span class='Ref_to_Member'>is_not_null</span></a><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* If new def has a default, override previous default */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2049"><span class='Ref_To_Local'>newdef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN647"><span class='Ref_to_Member'>raw_default</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="tablecmds.c.html#LN2061"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN647"><span class='Ref_to_Member'>raw_default</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN2049"><span class='Ref_To_Local'>newdef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN647"><span class='Ref_to_Member'>raw_default</span></a><span class='Delimiter'>; 
</span>                    <a href="tablecmds.c.html#LN2061"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN648"><span class='Ref_to_Member'>cooked_default</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN2049"><span class='Ref_To_Local'>newdef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN648"><span class='Ref_to_Member'>cooked_default</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if exist_attno&GT;0 &raquo; </span> 
            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * No, attach new column to result schema 
                 */ 
</span>                <a href="tablecmds.c.html#LN1625"><span class='Ref_To_Local'>inhSchema</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1625"><span class='Ref_To_Local'>inhSchema</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2049"><span class='Ref_To_Local'>newdef</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="tablecmds.c.html#LN1620"><span class='Ref_to_Parameter'>schema</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1625"><span class='Ref_To_Local'>inhSchema</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Check that we haven't exceeded the legal # of columns after merging 
         * in inherited columns. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1620"><span class='Ref_to_Parameter'>schema</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><a href="../../include/access/htup_details.h.html#LN46"><span class='Ref_to_Const'>MaxHeapAttributeNumber</span></a><span class='Parentheses'>)</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_TOO_MANY_COLUMNS<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"tables can have at most %d columns"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/access/htup_details.h.html#LN46"><span class='Ref_to_Const'>MaxHeapAttributeNumber</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if inhSchema!=NIL &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Now that we have the column definition list for a partition, we can 
     * check whether the columns referenced in the column constraint specs 
     * actually exist.  Also, we merge the constraints into the corresponding 
     * column definitions. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1621"><span class='Ref_to_Parameter'>is_partition</span></a> <span class='Operator'>&& </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1632"><span class='Ref_To_Local'>saved_schema</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN1620"><span class='Ref_to_Parameter'>schema</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1620"><span class='Ref_to_Parameter'>schema</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1632"><span class='Ref_To_Local'>saved_schema</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1624"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1620"><span class='Ref_to_Parameter'>schema</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2174"></a>            <a href="../../include/nodes/parsenodes.h.html#LN636"><span class='Ref_to_Struct'>ColumnDef</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>coldef</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1624"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2175"></a>            <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>rest</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1624"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2176"></a>            <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>prev</span> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1624"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Partition column option that does not belong to a column from 
             * the parent.  This works because the columns from the parent 
             * come first in the list (see above). 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2174"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN640"><span class='Ref_to_Member'>typeName</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                                <a href="tablecmds.c.html#LN2174"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN639"><span class='Ref_to_Member'>colname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2175"><span class='Ref_To_Local'>rest</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2190"></a>                <a href="../../include/nodes/parsenodes.h.html#LN636"><span class='Ref_to_Struct'>ColumnDef</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>restdef</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2175"><span class='Ref_To_Local'>rest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2191"></a>                <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>next</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2175"><span class='Ref_To_Local'>rest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Comment_Multi_Line'>/* need to save it in case we 
                                                 * delete it */ 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2174"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN639"><span class='Ref_to_Member'>colname</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2190"><span class='Ref_To_Local'>restdef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN639"><span class='Ref_to_Member'>colname</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * merge the column options into the column from the 
                     * parent 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2174"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN645"><span class='Ref_to_Member'>is_from_parent</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="tablecmds.c.html#LN2174"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN643"><span class='Ref_to_Member'>is_not_null</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN2190"><span class='Ref_To_Local'>restdef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN643"><span class='Ref_to_Member'>is_not_null</span></a><span class='Delimiter'>; 
</span>                        <a href="tablecmds.c.html#LN2174"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN647"><span class='Ref_to_Member'>raw_default</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN2190"><span class='Ref_To_Local'>restdef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN647"><span class='Ref_to_Member'>raw_default</span></a><span class='Delimiter'>; 
</span>                        <a href="tablecmds.c.html#LN2174"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN648"><span class='Ref_to_Member'>cooked_default</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN2190"><span class='Ref_To_Local'>restdef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN648"><span class='Ref_to_Member'>cooked_default</span></a><span class='Delimiter'>; 
</span>                        <a href="tablecmds.c.html#LN2174"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN652"><span class='Ref_to_Member'>constraints</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN2190"><span class='Ref_To_Local'>restdef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN652"><span class='Ref_to_Member'>constraints</span></a><span class='Delimiter'>; 
</span>                        <a href="tablecmds.c.html#LN2174"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN645"><span class='Ref_to_Member'>is_from_parent</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                        <a href="../../include/nodes/pg_list.h.html#LN238"><span class='Ref_to_Proto'>list_delete_cell</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1620"><span class='Ref_to_Parameter'>schema</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2175"><span class='Ref_To_Local'>rest</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2176"><span class='Ref_To_Local'>prev</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DUPLICATE_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" specified more than once"</span><span class='Delimiter'>, 
</span>                                    <a href="tablecmds.c.html#LN2174"><span class='Ref_To_Local'>coldef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN639"><span class='Ref_to_Member'>colname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if strcmp(coldef-&GT;colnam... &raquo; </span> 
                <a href="tablecmds.c.html#LN2176"><span class='Ref_To_Local'>prev</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN2175"><span class='Ref_To_Local'>rest</span></a><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN2175"><span class='Ref_To_Local'>rest</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN2191"><span class='Ref_To_Local'>next</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while rest!=NULL &raquo; </span> 
        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if is_partition&&list_le... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If we found any conflicting parent default values, check to make sure 
     * they were overridden by the child. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1629"><span class='Ref_To_Local'>have_bogus_defaults</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1624"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN1620"><span class='Ref_to_Parameter'>schema</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2229"></a>            <a href="../../include/nodes/parsenodes.h.html#LN636"><span class='Ref_to_Struct'>ColumnDef</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>def</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN1624"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2229"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN648"><span class='Ref_to_Member'>cooked_default</span></a> <span class='Operator'>== &</span><a href="tablecmds.c.html#LN1631"><span class='Ref_To_Local'>bogus_marker</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_COLUMN_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                  <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" inherits conflicting default values"</span><span class='Delimiter'>, 
</span>                         <a href="tablecmds.c.html#LN2229"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN639"><span class='Ref_to_Member'>colname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"To resolve the conflict, specify a default explicitly."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Operator'>*</span><a href="tablecmds.c.html#LN1621"><span class='Ref_to_Parameter'>supOids</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1626"><span class='Ref_To_Local'>parentOids</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="tablecmds.c.html#LN1621"><span class='Ref_to_Parameter'>supconstr</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1627"><span class='Ref_To_Local'>constraints</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="tablecmds.c.html#LN1622"><span class='Ref_to_Parameter'>supOidCount</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN1628"><span class='Ref_To_Local'>parentsWithOids</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="tablecmds.c.html#LN1620"><span class='Ref_to_Parameter'>schema</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end MergeAttributes &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * MergeCheckConstraint 
 *      Try to merge an inherited CHECK constraint with previous ones 
 * 
 * If we inherit identically-named constraints from multiple parents, we must 
 * merge them, or throw an error if they don't have identical definitions. 
 * 
 * constraints is a list of CookedConstraint structs for previous constraints. 
 * 
 * Returns TRUE if merged (constraint is a duplicate), or FALSE if it's 
 * got a so-far-unique name, or throws error if conflict. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN2260"></a><span class='Declare_Function'>MergeCheckConstraint</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>constraints</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Delimiter'>, </span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2262"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2262"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2260"><span class='Ref_to_Parameter'>constraints</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2266"></a>        <a href="../../include/catalog/heap.h.html#LN27"><span class='Ref_to_Struct'>CookedConstraint</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ccon</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/heap.h.html#LN27"><span class='Ref_to_Struct'>CookedConstraint</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2262"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2266"><span class='Ref_To_Local'>ccon</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/heap.h.html#LN29"><span class='Ref_to_Member'>contype</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN2027"><span class='Ref_to_EnumConst'>CONSTR_CHECK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Non-matching names never conflict */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2266"><span class='Ref_To_Local'>ccon</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/heap.h.html#LN31"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2260"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2260"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2266"><span class='Ref_To_Local'>ccon</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/heap.h.html#LN33"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* OK to merge */ 
</span>            <a href="tablecmds.c.html#LN2266"><span class='Ref_To_Local'>ccon</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/heap.h.html#LN36"><span class='Ref_to_Member'>inhcount</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/pg_basebackup/streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"check constraint name \"%s\" appears multiple times but with different expressions"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN2260"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end MergeCheckConstraint &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * StoreCatalogInheritance 
 *      Updates the system catalogs with proper inheritance information. 
 * 
 * supers is a list of the OIDs of the new relation's direct ancestors. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2298"></a><span class='Declare_Function'>StoreCatalogInheritance</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relationId</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>supers</span><span class='Delimiter'>, 
</span><a name="LN2299"></a>                        <span class='Keyword'>bool </span><span class='Declare_Parameter'>child_is_partition</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2301"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span><a name="LN2302"></a>    <a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>seqNumber</span><span class='Delimiter'>; 
</span><a name="LN2303"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>entry</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * sanity checks 
     */ 
</span>    <a href="../../include/c.h.html#LN676"><span class='Ref_to_Macro'>AssertArg</span></a><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2298"><span class='Ref_to_Parameter'>relationId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2298"><span class='Ref_to_Parameter'>supers</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Store INHERITS information in pg_inherits using direct ancestors only. 
     * Also enter dependencies on the direct ancestors, and make sure they are 
     * marked with relhassubclass = true. 
     * 
     * (Once upon a time, both direct and indirect ancestors were found here 
     * and then entered into pg_ipl.  Since that catalog doesn't exist 
     * anymore, there's no need to look for indirect ancestors.) 
     */ 
</span>    <a href="tablecmds.c.html#LN2301"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_inherits.h.html#LN28"><span class='Ref_to_Const'>InheritsRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN2302"><span class='Ref_To_Local'>seqNumber</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2303"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2298"><span class='Ref_to_Parameter'>supers</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2327"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>parentOid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2303"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN302"><span class='Ref_to_Proto'>StoreCatalogInheritance1</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2298"><span class='Ref_to_Parameter'>relationId</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2327"><span class='Ref_To_Local'>parentOid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2302"><span class='Ref_To_Local'>seqNumber</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2301"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, 
</span>                                 <a href="tablecmds.c.html#LN2299"><span class='Ref_to_Parameter'>child_is_partition</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN2302"><span class='Ref_To_Local'>seqNumber</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2301"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end StoreCatalogInheritance &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Make catalog entries showing relationId as being an inheritance child 
 * of parentOid.  inhRelation is the already-opened pg_inherits catalog. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2342"></a><span class='Declare_Function'>StoreCatalogInheritance1</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relationId</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>parentOid</span><span class='Delimiter'>, 
</span><a name="LN2343"></a>                         <a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a> <span class='Declare_Parameter'>seqNumber</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>inhRelation</span><span class='Delimiter'>, 
</span><a name="LN2344"></a>                         <span class='Keyword'>bool </span><span class='Declare_Parameter'>child_is_partition</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2346"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>desc</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2343"><span class='Ref_to_Parameter'>inhRelation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2347"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_inherits.h.html#LN48"><span class='Ref_to_Const'>Natts_pg_inherits</span></a><span class='Delimiter'>]; 
</span><a name="LN2348"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_inherits.h.html#LN48"><span class='Ref_to_Const'>Natts_pg_inherits</span></a><span class='Delimiter'>]; 
</span><a name="LN2349"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>childobject</span><span class='Delimiter'>, 
</span><a name="LN2350"></a>                <span class='Declare_Local'>parentobject</span><span class='Delimiter'>; 
</span><a name="LN2351"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make the pg_inherits entry 
     */ 
</span>    <a href="tablecmds.c.html#LN2347"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_inherits.h.html#LN49"><span class='Ref_to_Const'>Anum_pg_inherits_inhrelid</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2342"><span class='Ref_to_Parameter'>relationId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN2347"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_inherits.h.html#LN50"><span class='Ref_to_Const'>Anum_pg_inherits_inhparent</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2342"><span class='Ref_to_Parameter'>parentOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN2347"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_inherits.h.html#LN51"><span class='Ref_to_Const'>Anum_pg_inherits_inhseqno</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN456"><span class='Ref_to_Macro'>Int16GetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2343"><span class='Ref_to_Parameter'>seqNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    memset<span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2348"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2348"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN2351"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2346"><span class='Ref_To_Local'>desc</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2347"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2348"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN32"><span class='Ref_to_Proto'>CatalogTupleInsert</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2343"><span class='Ref_to_Parameter'>inhRelation</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2351"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2351"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Store a dependency too 
     */ 
</span>    <a href="tablecmds.c.html#LN2350"><span class='Ref_To_Local'>parentobject</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN2350"><span class='Ref_To_Local'>parentobject</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN2342"><span class='Ref_to_Parameter'>parentOid</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN2350"><span class='Ref_To_Local'>parentobject</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN2349"><span class='Ref_To_Local'>childobject</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN2349"><span class='Ref_To_Local'>childobject</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN2342"><span class='Ref_to_Parameter'>relationId</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN2349"><span class='Ref_To_Local'>childobject</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN2349"><span class='Ref_To_Local'>childobject</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN2350"><span class='Ref_To_Local'>parentobject</span></a><span class='Delimiter'>, 
</span>                       <a href="tablecmds.c.html#LN290"><span class='Ref_to_Macro'>child_dependency_type</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2344"><span class='Ref_to_Parameter'>child_is_partition</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Post creation hook of this inheritance. Since object_access_hook 
     * doesn't take multiple object identifiers, we relay oid of parent 
     * relation using auxiliary_id argument. 
     */ 
</span>    <a href="../../include/catalog/objectaccess.h.html#LN165"><span class='Ref_to_Macro'>InvokeObjectPostAlterHookArg</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_inherits.h.html#LN28"><span class='Ref_to_Const'>InheritsRelationId</span></a><span class='Delimiter'>, 
</span>                                 <a href="tablecmds.c.html#LN2342"><span class='Ref_to_Parameter'>relationId</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                 <a href="tablecmds.c.html#LN2342"><span class='Ref_to_Parameter'>parentOid</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Mark the parent as having subclasses. 
     */ 
</span>    <a href="../../include/commands/tablecmds.h.html#LN56"><span class='Ref_to_Proto'>SetRelationHasSubclass</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2342"><span class='Ref_to_Parameter'>parentOid</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end StoreCatalogInheritance1 &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Look for an existing schema entry with the given name. 
 * 
 * Returns the index (starting with 1) if attribute already exists in schema, 
 * 0 if it doesn't. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN2403"></a><span class='Declare_Function'>findAttrByName</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>attributeName</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>schema</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2405"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>s</span><span class='Delimiter'>; 
</span><a name="LN2406"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2405"><span class='Ref_To_Local'>s</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2403"><span class='Ref_to_Parameter'>schema</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2410"></a>        <a href="../../include/nodes/parsenodes.h.html#LN636"><span class='Ref_to_Struct'>ColumnDef</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>def</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2405"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2403"><span class='Ref_to_Parameter'>attributeName</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2410"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN639"><span class='Ref_to_Member'>colname</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <a href="tablecmds.c.html#LN2406"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN2406"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * SetRelationHasSubclass 
 *      Set the value of the relation's relhassubclass field in pg_class. 
 * 
 * NOTE: caller must be holding an appropriate lock on the relation. 
 * ShareUpdateExclusiveLock is sufficient. 
 * 
 * NOTE: an important side-effect of this operation is that an SI invalidation 
 * message is sent out to all backends --- including me --- causing plans 
 * referencing the relation to be rebuilt with the new list of children. 
 * This must happen even if we find that no change is needed in the pg_class 
 * row. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2435"></a><span class='Declare_Function'>SetRelationHasSubclass</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relationId</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>relhassubclass</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2437"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relationRelation</span><span class='Delimiter'>; 
</span><a name="LN2438"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN2439"></a>    <a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Local'>classtuple</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Fetch a modifiable copy of the tuple, modify it, update pg_class. 
     */ 
</span>    <a href="tablecmds.c.html#LN2437"><span class='Ref_To_Local'>relationRelation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN2438"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2435"><span class='Ref_to_Parameter'>relationId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2438"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for relation %u"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2435"><span class='Ref_to_Parameter'>relationId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN2439"><span class='Ref_To_Local'>classtuple</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2438"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2439"><span class='Ref_To_Local'>classtuple</span></a><span class='Operator'>-&GT;</span>relhassubclass <span class='Operator'>!= </span><a href="tablecmds.c.html#LN2435"><span class='Ref_to_Parameter'>relhassubclass</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN2439"><span class='Ref_To_Local'>classtuple</span></a><span class='Operator'>-&GT;</span>relhassubclass <span class='Operator'>= </span><a href="tablecmds.c.html#LN2435"><span class='Ref_to_Parameter'>relhassubclass</span></a><span class='Delimiter'>; 
</span>        <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2437"><span class='Ref_To_Local'>relationRelation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN2438"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2438"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* no need to change tuple, but force relcache rebuild anyway */ 
</span>        <a href="../../include/utils/inval.h.html#LN47"><span class='Ref_to_Proto'>CacheInvalidateRelcacheByTuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2438"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2438"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2437"><span class='Ref_To_Local'>relationRelation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SetRelationHasSubclass &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *      renameatt_check         - basic sanity checks before attribute rename 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2469"></a><span class='Declare_Function'>renameatt_check</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>myrelid</span><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Parameter'>classform</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recursing</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2471"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>relkind</span> <span class='Operator'>= </span><a href="tablecmds.c.html#LN2469"><span class='Ref_to_Parameter'>classform</span></a><span class='Operator'>-&GT;</span>relkind<span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2469"><span class='Ref_to_Parameter'>classform</span></a><span class='Operator'>-&GT;</span>reloftype <span class='Operator'>&& !</span><a href="tablecmds.c.html#LN2469"><span class='Ref_to_Parameter'>recursing</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot rename column of typed table"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Renaming the columns of sequences or toast tables doesn't actually 
     * break anything from the system's point of view, since internal 
     * references are by attnum.  But it doesn't seem right to allow users to 
     * change names that are hardcoded into the system, hence the following 
     * restriction. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2471"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a> <span class='Operator'>&& 
</span>        <a href="tablecmds.c.html#LN2471"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN163"><span class='Ref_to_Const'>RELKIND_VIEW</span></a> <span class='Operator'>&& 
</span>        <a href="tablecmds.c.html#LN2471"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a> <span class='Operator'>&& 
</span>        <a href="tablecmds.c.html#LN2471"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN165"><span class='Ref_to_Const'>RELKIND_COMPOSITE_TYPE</span></a> <span class='Operator'>&& 
</span>        <a href="tablecmds.c.html#LN2471"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN160"><span class='Ref_to_Const'>RELKIND_INDEX</span></a> <span class='Operator'>&& 
</span>        <a href="tablecmds.c.html#LN2471"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a> <span class='Operator'>&& 
</span>        <a href="tablecmds.c.html#LN2471"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a table, view, materialized view, composite type, index, or foreign table"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2469"><span class='Ref_to_Parameter'>classform</span></a><span class='Operator'>-&GT;</span>relname<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * permissions checking.  only the owner of a class can change its schema. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN308"><span class='Ref_to_Proto'>pg_class_ownercheck</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2469"><span class='Ref_to_Parameter'>myrelid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN181"><span class='Ref_to_EnumConst'>ACL_KIND_CLASS</span></a><span class='Delimiter'>, 
</span>                       <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2469"><span class='Ref_to_Parameter'>classform</span></a><span class='Operator'>-&GT;</span>relname<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/init/globals.c.html#LN111"><span class='Ref_to_Global_Var'>allowSystemTableMods</span></a> <span class='Operator'>&& </span><a href="../../include/catalog/catalog.h.html#LN33"><span class='Ref_to_Proto'>IsSystemClass</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2469"><span class='Ref_to_Parameter'>myrelid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2469"><span class='Ref_to_Parameter'>classform</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied: \"%s\" is a system catalog"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2469"><span class='Ref_to_Parameter'>classform</span></a><span class='Operator'>-&GT;</span>relname<span class='Parentheses'>))))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end renameatt_check &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *      renameatt_internal      - workhorse for renameatt 
 * 
 * Return value is the attribute number in the 'myrelid' relation. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a> 
<a name="LN2516"></a><span class='Declare_Function'>renameatt_internal</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>myrelid</span><span class='Delimiter'>, 
</span><a name="LN2517"></a>                   <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>oldattname</span><span class='Delimiter'>, 
</span><a name="LN2518"></a>                   <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>newattname</span><span class='Delimiter'>, 
</span><a name="LN2519"></a>                   <span class='Keyword'>bool </span><span class='Declare_Parameter'>recurse</span><span class='Delimiter'>, 
</span><a name="LN2520"></a>                   <span class='Keyword'>bool </span><span class='Declare_Parameter'>recursing</span><span class='Delimiter'>, 
</span><a name="LN2521"></a>                   <span class='Keyword'>int </span><span class='Declare_Parameter'>expected_parents</span><span class='Delimiter'>, 
</span><a name="LN2522"></a>                   <a href="../../include/nodes/parsenodes.h.html#LN1652"><span class='Ref_to_Enum'>DropBehavior</span></a> <span class='Declare_Parameter'>behavior</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2524"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>targetrelation</span><span class='Delimiter'>; 
</span><a name="LN2525"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>attrelation</span><span class='Delimiter'>; 
</span><a name="LN2526"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>atttup</span><span class='Delimiter'>; 
</span><a name="LN2527"></a>    <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>attform</span><span class='Delimiter'>; 
</span><a name="LN2528"></a>    <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>attnum</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Grab an exclusive lock on the target table, which we will NOT release 
     * until end of transaction. 
     */ 
</span>    <a href="tablecmds.c.html#LN2524"><span class='Ref_To_Local'>targetrelation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN84"><span class='Ref_to_Proto'>relation_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2516"><span class='Ref_to_Parameter'>myrelid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN2468"><span class='Ref_to_Func'>renameatt_check</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2516"><span class='Ref_to_Parameter'>myrelid</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN410"><span class='Ref_to_Macro'>RelationGetForm</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2524"><span class='Ref_To_Local'>targetrelation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2520"><span class='Ref_to_Parameter'>recursing</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * if the 'recurse' flag is set then we are supposed to rename this 
     * attribute in all classes that inherit from 'relname' (as well as in 
     * 'relname'). 
     * 
     * any permissions or problems with duplicate attributes will cause the 
     * whole transaction to abort, which is what we want -- all or nothing. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2519"><span class='Ref_to_Parameter'>recurse</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2547"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>child_oids</span><span class='Delimiter'>, 
</span><a name="LN2548"></a>                   <span class='Operator'>*</span><span class='Declare_Local'>child_numparents</span><span class='Delimiter'>; 
</span><a name="LN2549"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lo</span><span class='Delimiter'>, 
</span><a name="LN2550"></a>                   <span class='Operator'>*</span><span class='Declare_Local'>li</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * we need the number of parents for each child so that the recursive 
         * calls to renameatt() can determine whether there are any parents 
         * outside the inheritance hierarchy being processed. 
         */ 
</span>        <a href="tablecmds.c.html#LN2547"><span class='Ref_To_Local'>child_oids</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_inherits_fn.h.html#LN20"><span class='Ref_to_Proto'>find_all_inheritors</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2516"><span class='Ref_to_Parameter'>myrelid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Delimiter'>, 
</span>                                         <span class='Operator'>&</span><a href="tablecmds.c.html#LN2548"><span class='Ref_To_Local'>child_numparents</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * find_all_inheritors does the recursive search of the inheritance 
         * hierarchy, so all we have to do is process all of the relids in the 
         * list that it returns. 
         */ 
</span>        <a href="../../include/nodes/pg_list.h.html#LN179"><span class='Ref_to_Macro'>forboth</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2549"><span class='Ref_To_Local'>lo</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2547"><span class='Ref_To_Local'>child_oids</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2550"><span class='Ref_To_Local'>li</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2548"><span class='Ref_To_Local'>child_numparents</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2567"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>childrelid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2549"><span class='Ref_To_Local'>lo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2568"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>numparents</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2550"><span class='Ref_To_Local'>li</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2567"><span class='Ref_To_Local'>childrelid</span></a> <span class='Operator'>== </span><a href="tablecmds.c.html#LN2516"><span class='Ref_to_Parameter'>myrelid</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* note we need not recurse again */ 
</span>            <a href="tablecmds.c.html#LN2515"><span class='Ref_to_Func'>renameatt_internal</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2567"><span class='Ref_To_Local'>childrelid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2517"><span class='Ref_to_Parameter'>oldattname</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2518"><span class='Ref_to_Parameter'>newattname</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2568"><span class='Ref_To_Local'>numparents</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2522"><span class='Ref_to_Parameter'>behavior</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if recurse &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * If we are told not to recurse, there had better not be any child 
         * tables; else the rename would put them out of step. 
         * 
         * expected_parents will only be 0 if we are not already recursing. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2521"><span class='Ref_to_Parameter'>expected_parents</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>            <a href="../../include/catalog/pg_inherits_fn.h.html#LN19"><span class='Ref_to_Proto'>find_inheritance_children</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2516"><span class='Ref_to_Parameter'>myrelid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TABLE_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"inherited column \"%s\" must be renamed in child tables too"</span><span class='Delimiter'>, 
</span>                            <a href="tablecmds.c.html#LN2517"><span class='Ref_to_Parameter'>oldattname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* rename attributes in typed tables of composite type */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2524"><span class='Ref_To_Local'>targetrelation</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN165"><span class='Ref_to_Const'>RELKIND_COMPOSITE_TYPE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2595"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>child_oids</span><span class='Delimiter'>; 
</span><a name="LN2596"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lo</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN2595"><span class='Ref_To_Local'>child_oids</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN351"><span class='Ref_to_Proto'>find_typed_table_dependencies</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2524"><span class='Ref_To_Local'>targetrelation</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltype<span class='Delimiter'>, 
</span>                                     <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2524"><span class='Ref_To_Local'>targetrelation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                   <a href="tablecmds.c.html#LN2522"><span class='Ref_to_Parameter'>behavior</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2596"><span class='Ref_To_Local'>lo</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2595"><span class='Ref_To_Local'>child_oids</span></a><span class='Parentheses'>) 
</span><a name="LN2603"></a>            <span class='Declare_Local'>renameatt_internal</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2596"><span class='Ref_To_Local'>lo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2517"><span class='Ref_to_Parameter'>oldattname</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2518"><span class='Ref_to_Parameter'>newattname</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2522"><span class='Ref_to_Parameter'>behavior</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="tablecmds.c.html#LN2525"><span class='Ref_To_Local'>attrelation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN32"><span class='Ref_to_Const'>AttributeRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN2526"><span class='Ref_To_Local'>atttup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN130"><span class='Ref_to_Proto'>SearchSysCacheCopyAttName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2516"><span class='Ref_to_Parameter'>myrelid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2517"><span class='Ref_to_Parameter'>oldattname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2526"><span class='Ref_To_Local'>atttup</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN2517"><span class='Ref_to_Parameter'>oldattname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN2527"><span class='Ref_To_Local'>attform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2526"><span class='Ref_To_Local'>atttup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN2528"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN2527"><span class='Ref_To_Local'>attform</span></a><span class='Operator'>-&GT;</span>attnum<span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2528"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot rename system column \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN2517"><span class='Ref_to_Parameter'>oldattname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * if the attribute is inherited, forbid the renaming.  if this is a 
     * top-level call to renameatt(), then expected_parents will be 0, so the 
     * effect of this code will be to prohibit the renaming if the attribute 
     * is inherited at all.  if this is a recursive call to renameatt(), 
     * expected_parents will be the number of parents the current relation has 
     * within the inheritance hierarchy being processed, so we'll prohibit the 
     * renaming only if there are additional parents from elsewhere. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2527"><span class='Ref_To_Local'>attform</span></a><span class='Operator'>-&GT;</span>attinhcount <span class='Operator'>&GT; </span><a href="tablecmds.c.html#LN2521"><span class='Ref_to_Parameter'>expected_parents</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TABLE_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot rename inherited column \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN2517"><span class='Ref_to_Parameter'>oldattname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* new name should not already exist */ 
</span>    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN359"><span class='Ref_to_Proto'>check_for_column_name_collision</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2524"><span class='Ref_To_Local'>targetrelation</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2518"><span class='Ref_to_Parameter'>newattname</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* apply the update */ 
</span>    <a href="../../include/utils/builtins.h.html#LN40"><span class='Ref_to_Proto'>namestrcpy</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2527"><span class='Ref_To_Local'>attform</span></a><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2518"><span class='Ref_to_Parameter'>newattname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2525"><span class='Ref_To_Local'>attrelation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN2526"><span class='Ref_To_Local'>atttup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2526"><span class='Ref_To_Local'>atttup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2516"><span class='Ref_to_Parameter'>myrelid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2528"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2526"><span class='Ref_To_Local'>atttup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2525"><span class='Ref_To_Local'>attrelation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2524"><span class='Ref_To_Local'>targetrelation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* close rel but keep lock */ 
</span> 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN2528"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end renameatt_internal &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Perform permissions and integrity checks before acquiring a relation lock. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2661"></a><span class='Declare_Function'>RangeVarCallbackForRenameAttribute</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rv</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oldrelid</span><span class='Delimiter'>, 
</span><a name="LN2662"></a>                                   <span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2664"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN2665"></a>    <a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Local'>form</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN2664"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2661"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2664"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span><span class='Delimiter'>;</span>                 <span class='Comment_Single_Line'>/* concurrently dropped */ 
</span>    <a href="tablecmds.c.html#LN2665"><span class='Ref_To_Local'>form</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2664"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN2468"><span class='Ref_to_Func'>renameatt_check</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2661"><span class='Ref_to_Parameter'>relid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2665"><span class='Ref_To_Local'>form</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2664"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 *      renameatt       - changes the name of an attribute in a relation 
 * 
 * The returned ObjectAddress is that of the renamed column. 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN2681"></a><span class='Declare_Function'>renameatt</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2770"><span class='Ref_to_Struct'>RenameStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2683"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span><span class='Delimiter'>; 
</span><a name="LN2684"></a>    <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>attnum</span><span class='Delimiter'>; 
</span><a name="LN2685"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* lock level taken here should match renameatt_internal */ 
</span>    <a href="tablecmds.c.html#LN2683"><span class='Ref_To_Local'>relid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN55"><span class='Ref_to_Proto'>RangeVarGetRelidExtended</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2681"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2775"><span class='Ref_to_Member'>relation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Delimiter'>, 
</span>                                     <a href="tablecmds.c.html#LN2681"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2781"><span class='Ref_to_Member'>missing_ok</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                     <a href="tablecmds.c.html#LN2660"><span class='Ref_to_Func'>RangeVarCallbackForRenameAttribute</span></a><span class='Delimiter'>, 
</span>                                     <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2683"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"relation \"%s\" does not exist, skipping"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN2681"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2775"><span class='Ref_to_Member'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../catalog/objectaddress.c.html#LN718"><span class='Ref_to_Global_Var'>InvalidObjectAddress</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="tablecmds.c.html#LN2684"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= 
</span>        <a href="tablecmds.c.html#LN2515"><span class='Ref_to_Func'>renameatt_internal</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2683"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, 
</span>                           <a href="tablecmds.c.html#LN2681"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2777"><span class='Ref_to_Member'>subname</span></a><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* old att name */ 
</span>                           <a href="tablecmds.c.html#LN2681"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2779"><span class='Ref_to_Member'>newname</span></a><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* new att name */ 
</span>                           <a href="tablecmds.c.html#LN2681"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2775"><span class='Ref_to_Member'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN68"><span class='Ref_to_Member'>inh</span></a><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* recursive? */ 
</span>                           <span class='Boolean'>false</span><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* recursing? */ 
</span>                           <span class='Number'>0</span><span class='Delimiter'>,</span>   <span class='Comment_Single_Line'>/* expected inhcount */ 
</span>                           <a href="tablecmds.c.html#LN2681"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2780"><span class='Ref_to_Member'>behavior</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN32"><span class='Ref_to_Macro'>ObjectAddressSubSet</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2685"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2683"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2684"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN2685"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end renameatt &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * same logic as renameatt_internal 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN2719"></a><span class='Declare_Function'>rename_constraint_internal</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>myrelid</span><span class='Delimiter'>, 
</span><a name="LN2720"></a>                           <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>mytypid</span><span class='Delimiter'>, 
</span><a name="LN2721"></a>                           <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>oldconname</span><span class='Delimiter'>, 
</span><a name="LN2722"></a>                           <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>newconname</span><span class='Delimiter'>, 
</span><a name="LN2723"></a>                           <span class='Keyword'>bool </span><span class='Declare_Parameter'>recurse</span><span class='Delimiter'>, 
</span><a name="LN2724"></a>                           <span class='Keyword'>bool </span><span class='Declare_Parameter'>recursing</span><span class='Delimiter'>, 
</span><a name="LN2725"></a>                           <span class='Keyword'>int </span><span class='Declare_Parameter'>expected_parents</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2727"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>targetrelation</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN2728"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>constraintOid</span><span class='Delimiter'>; 
</span><a name="LN2729"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN2730"></a>    <a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a> <span class='Declare_Local'>con</span><span class='Delimiter'>; 
</span><a name="LN2731"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/c.h.html#LN676"><span class='Ref_to_Macro'>AssertArg</span></a><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN2719"><span class='Ref_to_Parameter'>myrelid</span></a> <span class='Operator'>|| !</span><a href="tablecmds.c.html#LN2720"><span class='Ref_to_Parameter'>mytypid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2720"><span class='Ref_to_Parameter'>mytypid</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN2728"><span class='Ref_To_Local'>constraintOid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_constraint_fn.h.html#LN71"><span class='Ref_to_Proto'>get_domain_constraint_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2720"><span class='Ref_to_Parameter'>mytypid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2721"><span class='Ref_to_Parameter'>oldconname</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN2727"><span class='Ref_To_Local'>targetrelation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN84"><span class='Ref_to_Proto'>relation_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2719"><span class='Ref_to_Parameter'>myrelid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * don't tell it whether we're recursing; we allow changing typed 
         * tables here 
         */ 
</span>        <a href="tablecmds.c.html#LN2468"><span class='Ref_to_Func'>renameatt_check</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2719"><span class='Ref_to_Parameter'>myrelid</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN410"><span class='Ref_to_Macro'>RelationGetForm</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2727"><span class='Ref_To_Local'>targetrelation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN2728"><span class='Ref_To_Local'>constraintOid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_constraint_fn.h.html#LN70"><span class='Ref_to_Proto'>get_relation_constraint_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2719"><span class='Ref_to_Parameter'>myrelid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2721"><span class='Ref_to_Parameter'>oldconname</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="tablecmds.c.html#LN2729"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN52"><span class='Ref_to_EnumConst'>CONSTROID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2728"><span class='Ref_To_Local'>constraintOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2729"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for constraint %u"</span><span class='Delimiter'>, 
</span>             <a href="tablecmds.c.html#LN2728"><span class='Ref_To_Local'>constraintOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN2730"><span class='Ref_To_Local'>con</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2729"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2719"><span class='Ref_to_Parameter'>myrelid</span></a> <span class='Operator'>&& </span><a href="tablecmds.c.html#LN2730"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>contype <span class='Operator'>== </span><a href="../../include/catalog/pg_constraint.h.html#LN187"><span class='Ref_to_Const'>CONSTRAINT_CHECK</span></a> <span class='Operator'>&& !</span><a href="tablecmds.c.html#LN2730"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>connoinherit<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2723"><span class='Ref_to_Parameter'>recurse</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2762"></a>            <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>child_oids</span><span class='Delimiter'>, 
</span><a name="LN2763"></a>                       <span class='Operator'>*</span><span class='Declare_Local'>child_numparents</span><span class='Delimiter'>; 
</span><a name="LN2764"></a>            <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lo</span><span class='Delimiter'>, 
</span><a name="LN2765"></a>                       <span class='Operator'>*</span><span class='Declare_Local'>li</span><span class='Delimiter'>; 
</span> 
            <a href="tablecmds.c.html#LN2762"><span class='Ref_To_Local'>child_oids</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_inherits_fn.h.html#LN20"><span class='Ref_to_Proto'>find_all_inheritors</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2719"><span class='Ref_to_Parameter'>myrelid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Delimiter'>, 
</span>                                             <span class='Operator'>&</span><a href="tablecmds.c.html#LN2763"><span class='Ref_To_Local'>child_numparents</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/nodes/pg_list.h.html#LN179"><span class='Ref_to_Macro'>forboth</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2764"><span class='Ref_To_Local'>lo</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2762"><span class='Ref_To_Local'>child_oids</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2765"><span class='Ref_To_Local'>li</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2763"><span class='Ref_To_Local'>child_numparents</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2772"></a>                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>childrelid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2764"><span class='Ref_To_Local'>lo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2773"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>numparents</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2765"><span class='Ref_To_Local'>li</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2772"><span class='Ref_To_Local'>childrelid</span></a> <span class='Operator'>== </span><a href="tablecmds.c.html#LN2719"><span class='Ref_to_Parameter'>myrelid</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
                <a href="tablecmds.c.html#LN2718"><span class='Ref_to_Func'>rename_constraint_internal</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2772"><span class='Ref_To_Local'>childrelid</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2721"><span class='Ref_to_Parameter'>oldconname</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2722"><span class='Ref_to_Parameter'>newconname</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2773"><span class='Ref_To_Local'>numparents</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if recurse &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2725"><span class='Ref_to_Parameter'>expected_parents</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>                <a href="../../include/catalog/pg_inherits_fn.h.html#LN19"><span class='Ref_to_Proto'>find_inheritance_children</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2719"><span class='Ref_to_Parameter'>myrelid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TABLE_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"inherited constraint \"%s\" must be renamed in child tables too"</span><span class='Delimiter'>, 
</span>                                <a href="tablecmds.c.html#LN2721"><span class='Ref_to_Parameter'>oldconname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2730"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>coninhcount <span class='Operator'>&GT; </span><a href="tablecmds.c.html#LN2725"><span class='Ref_to_Parameter'>expected_parents</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TABLE_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot rename inherited constraint \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="tablecmds.c.html#LN2721"><span class='Ref_to_Parameter'>oldconname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if myrelid&&con-&GT;contype... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2730"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>conindid 
        <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2730"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>contype <span class='Operator'>== </span><a href="../../include/catalog/pg_constraint.h.html#LN189"><span class='Ref_to_Const'>CONSTRAINT_PRIMARY</span></a> 
            <span class='Operator'>|| </span><a href="tablecmds.c.html#LN2730"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>contype <span class='Operator'>== </span><a href="../../include/catalog/pg_constraint.h.html#LN190"><span class='Ref_to_Const'>CONSTRAINT_UNIQUE</span></a> 
            <span class='Operator'>|| </span><a href="tablecmds.c.html#LN2730"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>contype <span class='Operator'>== </span><a href="../../include/catalog/pg_constraint.h.html#LN192"><span class='Ref_to_Const'>CONSTRAINT_EXCLUSION</span></a><span class='Parentheses'>))</span> 
        <span class='Comment_Multi_Line'>/* rename the index; this renames the constraint as well */ 
</span>        <a href="../../include/commands/tablecmds.h.html#LN66"><span class='Ref_to_Proto'>RenameRelationInternal</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2730"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>conindid<span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2722"><span class='Ref_to_Parameter'>newconname</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../include/catalog/pg_constraint_fn.h.html#LN59"><span class='Ref_to_Proto'>RenameConstraintById</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2728"><span class='Ref_To_Local'>constraintOid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2722"><span class='Ref_to_Parameter'>newconname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2731"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_constraint.h.html#LN28"><span class='Ref_to_Const'>ConstraintRelationId</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2728"><span class='Ref_To_Local'>constraintOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2729"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2727"><span class='Ref_To_Local'>targetrelation</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2727"><span class='Ref_To_Local'>targetrelation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* close rel but keep lock */ 
</span> 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN2731"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end rename_constraint_internal &raquo; </span> 
 
<a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN2818"></a><span class='Declare_Function'>RenameConstraint</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2770"><span class='Ref_to_Struct'>RenameStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2820"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span><a name="LN2821"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typid</span> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2818"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2773"><span class='Ref_to_Member'>renameType</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN1598"><span class='Ref_to_EnumConst'>OBJECT_DOMCONSTRAINT</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2825"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN2826"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN2821"><span class='Ref_To_Local'>typid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN27"><span class='Ref_to_Proto'>typenameTypeId</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="../../include/nodes/makefuncs.h.html#LN71"><span class='Ref_to_Proto'>makeTypeNameFromNameList</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2818"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2776"><span class='Ref_to_Member'>object</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN2825"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN2826"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2821"><span class='Ref_To_Local'>typid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2826"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for type %u"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2821"><span class='Ref_To_Local'>typid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/commands/typecmds.h.html#LN40"><span class='Ref_to_Proto'>checkDomainOwner</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2826"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2826"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2825"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* lock level taken here should match rename_constraint_internal */ 
</span>        <a href="tablecmds.c.html#LN2820"><span class='Ref_To_Local'>relid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN55"><span class='Ref_to_Proto'>RangeVarGetRelidExtended</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2818"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2775"><span class='Ref_to_Member'>relation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Delimiter'>, 
</span>                                         <a href="tablecmds.c.html#LN2818"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2781"><span class='Ref_to_Member'>missing_ok</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                         <a href="tablecmds.c.html#LN2660"><span class='Ref_to_Func'>RangeVarCallbackForRenameAttribute</span></a><span class='Delimiter'>, 
</span>                                         <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2820"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"relation \"%s\" does not exist, skipping"</span><span class='Delimiter'>, 
</span>                            <a href="tablecmds.c.html#LN2818"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2775"><span class='Ref_to_Member'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="../catalog/objectaddress.c.html#LN718"><span class='Ref_to_Global_Var'>InvalidObjectAddress</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> 
        <a href="tablecmds.c.html#LN2718"><span class='Ref_to_Func'>rename_constraint_internal</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2820"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2821"><span class='Ref_To_Local'>typid</span></a><span class='Delimiter'>, 
</span>                                   <a href="tablecmds.c.html#LN2818"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2777"><span class='Ref_to_Member'>subname</span></a><span class='Delimiter'>, 
</span>                                   <a href="tablecmds.c.html#LN2818"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2779"><span class='Ref_to_Member'>newname</span></a><span class='Delimiter'>, 
</span>                                   <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2818"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2775"><span class='Ref_to_Member'>relation</span></a> <span class='Operator'>&& 
</span>                                    <a href="tablecmds.c.html#LN2818"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2775"><span class='Ref_to_Member'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN68"><span class='Ref_to_Member'>inh</span></a><span class='Parentheses'>)</span><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* recursive? */ 
</span>                                   <span class='Boolean'>false</span><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* recursing? */ 
</span>                                   <span class='Number'>0</span> <span class='Comment_Multi_Line'>/* expected inhcount */ </span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end RenameConstraint &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Execute ALTER TABLE/INDEX/SEQUENCE/VIEW/MATERIALIZED VIEW/FOREIGN TABLE 
 * RENAME 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN2869"></a><span class='Declare_Function'>RenameRelation</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2770"><span class='Ref_to_Struct'>RenameStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2871"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span><span class='Delimiter'>; 
</span><a name="LN2872"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Grab an exclusive lock on the target table, index, sequence, view, 
     * materialized view, or foreign table, which we will NOT release until 
     * end of transaction. 
     * 
     * Lock level used here should match RenameRelationInternal, to avoid lock 
     * escalation. 
     */ 
</span>    <a href="tablecmds.c.html#LN2871"><span class='Ref_To_Local'>relid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN55"><span class='Ref_to_Proto'>RangeVarGetRelidExtended</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2869"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2775"><span class='Ref_to_Member'>relation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Delimiter'>, 
</span>                                     <a href="tablecmds.c.html#LN2869"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2781"><span class='Ref_to_Member'>missing_ok</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                     <a href="tablecmds.c.html#LN465"><span class='Ref_to_Proto'>RangeVarCallbackForAlterRelation</span></a><span class='Delimiter'>, 
</span>                                     <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN2869"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2871"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"relation \"%s\" does not exist, skipping"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN2869"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2775"><span class='Ref_to_Member'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../catalog/objectaddress.c.html#LN718"><span class='Ref_to_Global_Var'>InvalidObjectAddress</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Do the work */ 
</span>    <a href="../../include/commands/tablecmds.h.html#LN66"><span class='Ref_to_Proto'>RenameRelationInternal</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2871"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2869"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2779"><span class='Ref_to_Member'>newname</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2872"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2871"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN2872"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RenameRelation &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *      RenameRelationInternal - change the name of a relation 
 * 
 *      XXX - When renaming sequences, we don't bother to modify the 
 *            sequence name that is stored within the sequence itself 
 *            (this would cause problems with MVCC). In the future, 
 *            the sequence name should probably be removed from the 
 *            sequence, AFAIK there's no need for it to be there. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2913"></a><span class='Declare_Function'>RenameRelationInternal</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>myrelid</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>newrelname</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>is_internal</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2915"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>targetrelation</span><span class='Delimiter'>; 
</span><a name="LN2916"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relrelation</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* for RELATION relation */ 
</span><a name="LN2917"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>reltup</span><span class='Delimiter'>; 
</span><a name="LN2918"></a>    <a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Local'>relform</span><span class='Delimiter'>; 
</span><a name="LN2919"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>namespaceId</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Grab an exclusive lock on the target table, index, sequence, view, 
     * materialized view, or foreign table, which we will NOT release until 
     * end of transaction. 
     */ 
</span>    <a href="tablecmds.c.html#LN2915"><span class='Ref_To_Local'>targetrelation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN84"><span class='Ref_to_Proto'>relation_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2913"><span class='Ref_to_Parameter'>myrelid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN2919"><span class='Ref_To_Local'>namespaceId</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN443"><span class='Ref_to_Macro'>RelationGetNamespace</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2915"><span class='Ref_To_Local'>targetrelation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Find relation's pg_class tuple, and make sure newrelname isn't in use. 
     */ 
</span>    <a href="tablecmds.c.html#LN2916"><span class='Ref_To_Local'>relrelation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN2917"><span class='Ref_To_Local'>reltup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2913"><span class='Ref_to_Parameter'>myrelid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2917"><span class='Ref_To_Local'>reltup</span></a><span class='Parentheses'>))</span>      <span class='Comment_Single_Line'>/* shouldn't happen */ 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for relation %u"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2913"><span class='Ref_to_Parameter'>myrelid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN2918"><span class='Ref_To_Local'>relform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2917"><span class='Ref_To_Local'>reltup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/lsyscache.h.html#LN123"><span class='Ref_to_Proto'>get_relname_relid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2913"><span class='Ref_to_Parameter'>newrelname</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2919"><span class='Ref_To_Local'>namespaceId</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DUPLICATE_TABLE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"relation \"%s\" already exists"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN2913"><span class='Ref_to_Parameter'>newrelname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Update pg_class tuple with new relname.  (Scribbling on reltup is OK 
     * because it's a copy...) 
     */ 
</span>    <a href="../../include/utils/builtins.h.html#LN40"><span class='Ref_to_Proto'>namestrcpy</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2918"><span class='Ref_To_Local'>relform</span></a><span class='Operator'>-&GT;</span>relname<span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2913"><span class='Ref_to_Parameter'>newrelname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2916"><span class='Ref_To_Local'>relrelation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN2917"><span class='Ref_To_Local'>reltup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2917"><span class='Ref_To_Local'>reltup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN165"><span class='Ref_to_Macro'>InvokeObjectPostAlterHookArg</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2913"><span class='Ref_to_Parameter'>myrelid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                 <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2913"><span class='Ref_to_Parameter'>is_internal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2917"><span class='Ref_To_Local'>reltup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2916"><span class='Ref_To_Local'>relrelation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Also rename the associated type, if any. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2915"><span class='Ref_To_Local'>targetrelation</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltype<span class='Parentheses'>))</span> 
        <a href="../../include/catalog/pg_type_fn.h.html#LN75"><span class='Ref_to_Proto'>RenameTypeInternal</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2915"><span class='Ref_To_Local'>targetrelation</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltype<span class='Delimiter'>, 
</span>                           <a href="tablecmds.c.html#LN2913"><span class='Ref_to_Parameter'>newrelname</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2919"><span class='Ref_To_Local'>namespaceId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Also rename the associated constraint, if any. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2915"><span class='Ref_To_Local'>targetrelation</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN160"><span class='Ref_to_Const'>RELKIND_INDEX</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2971"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>constraintId</span> <span class='Operator'>= </span><a href="../../include/catalog/dependency.h.html#LN246"><span class='Ref_to_Proto'>get_index_constraint</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2913"><span class='Ref_to_Parameter'>myrelid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2971"><span class='Ref_To_Local'>constraintId</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/catalog/pg_constraint_fn.h.html#LN59"><span class='Ref_to_Proto'>RenameConstraintById</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2971"><span class='Ref_To_Local'>constraintId</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN2913"><span class='Ref_to_Parameter'>newrelname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Close rel, but keep exclusive lock! 
     */ 
</span>    <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN2915"><span class='Ref_To_Local'>targetrelation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RenameRelationInternal &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Disallow ALTER TABLE (and similar commands) when the current backend has 
 * any open reference to the target table besides the one just acquired by 
 * the calling command; this implies there's an open cursor or active plan. 
 * We need this check because our lock doesn't protect us against stomping 
 * on our own foot, only other people's feet! 
 * 
 * For ALTER TABLE, the only case known to cause serious trouble is ALTER 
 * COLUMN TYPE, and some changes are obviously pretty benign, so this could 
 * possibly be relaxed to only error out for certain types of alterations. 
 * But the use-case for allowing any of these things is not obvious, so we 
 * won't work hard at it for now. 
 * 
 * We also reject these commands if there are any pending AFTER trigger events 
 * for the rel.  This is certainly necessary for the rewriting variants of 
 * ALTER TABLE, because they don't preserve tuple TIDs and so the pending 
 * events would try to fetch the wrong tuples.  It might be overly cautious 
 * in other cases, but again it seems better to err on the side of paranoia. 
 * 
 * REINDEX calls this with "rel" referencing the index to be rebuilt; here 
 * we are worried about active indexscans on the index.  The trigger-event 
 * check can be skipped, since we are doing no damage to the parent table. 
 * 
 * The statement name (eg, "ALTER TABLE") is passed for use in error messages. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN3009"></a><span class='Declare_Function'>CheckTableNotInUse</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3011"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>expected_refcnt</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN3011"><span class='Ref_To_Local'>expected_refcnt</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN3009"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN90"><span class='Ref_to_Member'>rd_isnailed</span></a> <span class='Operator'>? </span><span class='Number'>2</span> <span class='Operator'>: </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3009"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN87"><span class='Ref_to_Member'>rd_refcnt</span></a> <span class='Operator'>!= </span><a href="tablecmds.c.html#LN3011"><span class='Ref_To_Local'>expected_refcnt</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_IN_USE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Comment_Multi_Line'>/* translator: first %s is a SQL command, eg ALTER TABLE */ 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot %s \"%s\" because "</span> 
                        <span class='String'>"it is being used by active queries in this session"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN3009"><span class='Ref_to_Parameter'>stmt</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3009"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3009"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN160"><span class='Ref_to_Const'>RELKIND_INDEX</span></a> <span class='Operator'>&& 
</span>        <a href="../../include/commands/trigger.h.html#LN194"><span class='Ref_to_Proto'>AfterTriggerPendingOnRel</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3009"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_IN_USE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Comment_Multi_Line'>/* translator: first %s is a SQL command, eg ALTER TABLE */ 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot %s \"%s\" because "</span> 
                        <span class='String'>"it has pending trigger events"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN3009"><span class='Ref_to_Parameter'>stmt</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3009"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CheckTableNotInUse &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * AlterTableLookupRelation 
 *      Look up, and lock, the OID for the relation named by an alter table 
 *      statement. 
 */ 
</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN3038"></a><span class='Declare_Function'>AlterTableLookupRelation</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1662"><span class='Ref_to_Struct'>AlterTableStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="../../include/catalog/namespace.h.html#LN55"><span class='Ref_to_Proto'>RangeVarGetRelidExtended</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3038"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1665"><span class='Ref_to_Member'>relation</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3038"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3038"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1668"><span class='Ref_to_Member'>missing_ok</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                    <a href="tablecmds.c.html#LN465"><span class='Ref_to_Proto'>RangeVarCallbackForAlterRelation</span></a><span class='Delimiter'>, 
</span>                                    <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN3038"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * AlterTable 
 *      Execute ALTER TABLE, which can be a list of subcommands 
 * 
 * ALTER TABLE is performed in three phases: 
 *      1. Examine subcommands and perform pre-transformation checking. 
 *      2. Update system catalogs. 
 *      3. Scan table(s) to check new constraints, and optionally recopy 
 *         the data into new table(s). 
 * Phase 3 is not performed unless one or more of the subcommands requires 
 * it.  The intention of this design is to allow multiple independent 
 * updates of the table schema to be performed with only one pass over the 
 * data. 
 * 
 * ATPrepCmd performs phase 1.  A "work queue" entry is created for 
 * each table to be affected (there may be multiple affected tables if the 
 * commands traverse a table inheritance hierarchy).  Also we do preliminary 
 * validation of the subcommands, including parse transformation of those 
 * expressions that need to be evaluated with respect to the old table 
 * schema. 
 * 
 * ATRewriteCatalogs performs phase 2 for each affected table.  (Note that 
 * phases 2 and 3 normally do no explicit recursion, since phase 1 already 
 * did it --- although some subcommands have to recurse in phase 2 instead.) 
 * Certain subcommands need to be performed before others to avoid 
 * unnecessary conflicts; for example, DROP COLUMN should come before 
 * ADD COLUMN.  Therefore phase 1 divides the subcommands into multiple 
 * lists, one for each logical "pass" of phase 2. 
 * 
 * ATRewriteTables performs phase 3 for those tables that need it. 
 * 
 * Thanks to the magic of MVCC, an error anywhere along the way rolls back 
 * the whole operation; we don't have to do anything special to clean up. 
 * 
 * The caller must lock the relation, with an appropriate lock level 
 * for the subcommands requested, using AlterTableGetLockLevel(stmt-&GT;cmds) 
 * or higher. We pass the lock level down 
 * so that we can apply it recursively to inherited tables. Note that the 
 * lock level we want as we recurse might well be higher than required for 
 * that specific subcommand. So we pass down the overall lock requirement, 
 * rather than reassess it at lower levels. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN3088"></a><span class='Declare_Function'>AlterTable</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1662"><span class='Ref_to_Struct'>AlterTableStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3090"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Caller is required to provide an adequate lock. */ 
</span>    <a href="tablecmds.c.html#LN3090"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN84"><span class='Ref_to_Proto'>relation_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3088"><span class='Ref_to_Parameter'>relid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/commands/tablecmds.h.html#LN52"><span class='Ref_to_Proto'>CheckTableNotInUse</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3090"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='String'>"ALTER TABLE"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN334"><span class='Ref_to_Proto'>ATController</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3088"><span class='Ref_to_Parameter'>stmt</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3090"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3088"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1666"><span class='Ref_to_Member'>cmds</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3088"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1665"><span class='Ref_to_Member'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN68"><span class='Ref_to_Member'>inh</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3088"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * AlterTableInternal 
 * 
 * ALTER TABLE with target specified by OID 
 * 
 * We do not reject if the relation is already open, because it's quite 
 * likely that one or more layers of caller have it open.  That means it 
 * is unsafe to use this entry point for alterations that could break 
 * existing query plans.  On the assumption it's not used for such, we 
 * don't have to reject pending AFTER triggers, either. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN3112"></a><span class='Declare_Function'>AlterTableInternal</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cmds</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recurse</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3114"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN3115"></a>    <a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a>    <span class='Declare_Local'>lockmode</span> <span class='Operator'>= </span><a href="../../include/commands/tablecmds.h.html#LN33"><span class='Ref_to_Proto'>AlterTableGetLockLevel</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3112"><span class='Ref_to_Parameter'>cmds</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN3114"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN84"><span class='Ref_to_Proto'>relation_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3112"><span class='Ref_to_Parameter'>relid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3115"><span class='Ref_To_Local'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/commands/event_trigger.h.html#LN72"><span class='Ref_to_Proto'>EventTriggerAlterTableRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3112"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN334"><span class='Ref_to_Proto'>ATController</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3114"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3112"><span class='Ref_to_Parameter'>cmds</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3112"><span class='Ref_to_Parameter'>recurse</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3115"><span class='Ref_To_Local'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * AlterTableGetLockLevel 
 * 
 * Sets the overall lock level required for the supplied list of subcommands. 
 * Policy for doing this set according to needs of AlterTable(), see 
 * comments there for overall explanation. 
 * 
 * Function is called before and after parsing, so it must give same 
 * answer each time it is called. Some subcommands are transformed 
 * into other subcommand types, so the transform must never be made to a 
 * lower lock level than previously assigned. All transforms are noted below. 
 * 
 * Since this is called before we lock the table we cannot use table metadata 
 * to influence the type of lock we acquire. 
 * 
 * There should be no lockmodes hardcoded into the subcommand functions. All 
 * lockmode decisions for ALTER TABLE are made here only. The one exception is 
 * ALTER TABLE RENAME which is treated as a different statement type T_RenameStmt 
 * and does not travel through this section of code and cannot be combined with 
 * any of the subcommands given here. 
 * 
 * Note that Hot Standby only knows about AccessExclusiveLocks on the master 
 * so any changes that might affect SELECTs running on standbys need to use 
 * AccessExclusiveLocks even if you think a lesser lock would do, unless you 
 * have a solution for that also. 
 * 
 * Also note that pg_dump uses only an AccessShareLock, meaning that anything 
 * that takes a lock less than AccessExclusiveLock can change object definitions 
 * while pg_dump is running. Be careful to check that the appropriate data is 
 * derived by pg_dump using an MVCC snapshot, rather than syscache lookups, 
 * otherwise we might end up with an inconsistent dump that can't restore. 
 */ 
</span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> 
<a name="LN3157"></a><span class='Declare_Function'>AlterTableGetLockLevel</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cmds</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * This only works if we read catalog tables using MVCC snapshots. 
     */ 
</span><a name="LN3162"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lcmd</span><span class='Delimiter'>; 
</span><a name="LN3163"></a>    <a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a>    <span class='Declare_Local'>lockmode</span> <span class='Operator'>= </span><a href="../../include/storage/lockdefs.h.html#LN38"><span class='Ref_to_Const'>ShareUpdateExclusiveLock</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3162"><span class='Ref_To_Local'>lcmd</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3157"><span class='Ref_to_Parameter'>cmds</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3167"></a>        <a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cmd</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3162"><span class='Ref_To_Local'>lcmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3168"></a>        <a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a>    <span class='Declare_Local'>cmd_lockmode</span> <span class='Operator'>= </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* default for compiler */ 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3167"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1752"><span class='Ref_to_Member'>subtype</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * These subcommands rewrite the heap, so require full locks. 
                 */ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1673"><span class='Ref_to_EnumConst'>AT_AddColumn</span></a><span class='Operator'>:</span>  <span class='Comment_Multi_Line'>/* may rewrite heap, in some cases and visible 
                                 * to SELECT */ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1709"><span class='Ref_to_EnumConst'>AT_SetTableSpace</span></a><span class='Operator'>:</span>      <span class='Comment_Single_Line'>/* must rewrite heap */ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1699"><span class='Ref_to_EnumConst'>AT_AlterColumnType</span></a><span class='Operator'>:</span>    <span class='Comment_Single_Line'>/* must rewrite heap */ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1706"><span class='Ref_to_EnumConst'>AT_AddOids</span></a><span class='Operator'>:</span>    <span class='Comment_Single_Line'>/* must rewrite heap */ 
</span>                <a href="tablecmds.c.html#LN3168"><span class='Ref_To_Local'>cmd_lockmode</span></a> <span class='Operator'>= </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * These subcommands may require addition of toast tables. If 
                 * we add a toast table to a table currently being scanned, we 
                 * might miss data added to the new toast table by concurrent 
                 * insert transactions. 
                 */ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1682"><span class='Ref_to_EnumConst'>AT_SetStorage</span></a><span class='Operator'>:</span><span class='Comment_Multi_Line'>/* may add toast tables, see 
                                 * ATRewriteCatalogs() */ 
</span>                <a href="tablecmds.c.html#LN3168"><span class='Ref_To_Local'>cmd_lockmode</span></a> <span class='Operator'>= </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Removing constraints can affect SELECTs that have been 
                 * optimised assuming the constraint holds true. 
                 */ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1696"><span class='Ref_to_EnumConst'>AT_DropConstraint</span></a><span class='Operator'>:</span>     <span class='Comment_Single_Line'>/* as DROP INDEX */ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1677"><span class='Ref_to_EnumConst'>AT_DropNotNull</span></a><span class='Operator'>:</span>        <span class='Comment_Single_Line'>/* may change some SQL plans */ 
</span>                <a href="tablecmds.c.html#LN3168"><span class='Ref_To_Local'>cmd_lockmode</span></a> <span class='Operator'>= </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Subcommands that may be visible to concurrent SELECTs 
                 */ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1683"><span class='Ref_to_EnumConst'>AT_DropColumn</span></a><span class='Operator'>: </span><span class='Comment_Single_Line'>/* change visible to SELECT */ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1675"><span class='Ref_to_EnumConst'>AT_AddColumnToView</span></a><span class='Operator'>:</span>    <span class='Comment_Single_Line'>/* CREATE VIEW */ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1708"><span class='Ref_to_EnumConst'>AT_DropOids</span></a><span class='Operator'>:</span>   <span class='Comment_Single_Line'>/* calls AT_DropColumn */ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1722"><span class='Ref_to_EnumConst'>AT_EnableAlwaysRule</span></a><span class='Operator'>:</span>   <span class='Comment_Single_Line'>/* may change SELECT rules */ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1723"><span class='Ref_to_EnumConst'>AT_EnableReplicaRule</span></a><span class='Operator'>:</span>  <span class='Comment_Single_Line'>/* may change SELECT rules */ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1721"><span class='Ref_to_EnumConst'>AT_EnableRule</span></a><span class='Operator'>: </span><span class='Comment_Single_Line'>/* may change SELECT rules */ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1724"><span class='Ref_to_EnumConst'>AT_DisableRule</span></a><span class='Operator'>:</span>        <span class='Comment_Single_Line'>/* may change SELECT rules */ 
</span>                <a href="tablecmds.c.html#LN3168"><span class='Ref_To_Local'>cmd_lockmode</span></a> <span class='Operator'>= </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Changing owner may remove implicit SELECT privileges 
                 */ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1701"><span class='Ref_to_EnumConst'>AT_ChangeOwner</span></a><span class='Operator'>:</span>        <span class='Comment_Single_Line'>/* change visible to SELECT */ 
</span>                <a href="tablecmds.c.html#LN3168"><span class='Ref_To_Local'>cmd_lockmode</span></a> <span class='Operator'>= </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Changing foreign table options may affect optimization. 
                 */ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1734"><span class='Ref_to_EnumConst'>AT_GenericOptions</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1700"><span class='Ref_to_EnumConst'>AT_AlterColumnGenericOptions</span></a><span class='Operator'>: 
</span>                <a href="tablecmds.c.html#LN3168"><span class='Ref_To_Local'>cmd_lockmode</span></a> <span class='Operator'>= </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * These subcommands affect write operations only. 
                 */ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1713"><span class='Ref_to_EnumConst'>AT_EnableTrig</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1714"><span class='Ref_to_EnumConst'>AT_EnableAlwaysTrig</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1715"><span class='Ref_to_EnumConst'>AT_EnableReplicaTrig</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1717"><span class='Ref_to_EnumConst'>AT_EnableTrigAll</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1719"><span class='Ref_to_EnumConst'>AT_EnableTrigUser</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1716"><span class='Ref_to_EnumConst'>AT_DisableTrig</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1718"><span class='Ref_to_EnumConst'>AT_DisableTrigAll</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1720"><span class='Ref_to_EnumConst'>AT_DisableTrigUser</span></a><span class='Operator'>: 
</span>                <a href="tablecmds.c.html#LN3168"><span class='Ref_To_Local'>cmd_lockmode</span></a> <span class='Operator'>= </span><a href="../../include/storage/lockdefs.h.html#LN41"><span class='Ref_to_Const'>ShareRowExclusiveLock</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * These subcommands affect write operations only. XXX 
                 * Theoretically, these could be ShareRowExclusiveLock. 
                 */ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1676"><span class='Ref_to_EnumConst'>AT_ColumnDefault</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1690"><span class='Ref_to_EnumConst'>AT_AlterConstraint</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1685"><span class='Ref_to_EnumConst'>AT_AddIndex</span></a><span class='Operator'>:</span>   <span class='Comment_Single_Line'>/* from ADD CONSTRAINT */ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1695"><span class='Ref_to_EnumConst'>AT_AddIndexConstraint</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1729"><span class='Ref_to_EnumConst'>AT_ReplicaIdentity</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1678"><span class='Ref_to_EnumConst'>AT_SetNotNull</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1730"><span class='Ref_to_EnumConst'>AT_EnableRowSecurity</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1731"><span class='Ref_to_EnumConst'>AT_DisableRowSecurity</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1732"><span class='Ref_to_EnumConst'>AT_ForceRowSecurity</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1733"><span class='Ref_to_EnumConst'>AT_NoForceRowSecurity</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1737"><span class='Ref_to_EnumConst'>AT_AddIdentity</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1739"><span class='Ref_to_EnumConst'>AT_DropIdentity</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1738"><span class='Ref_to_EnumConst'>AT_SetIdentity</span></a><span class='Operator'>: 
</span>                <a href="tablecmds.c.html#LN3168"><span class='Ref_To_Local'>cmd_lockmode</span></a> <span class='Operator'>= </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1687"><span class='Ref_to_EnumConst'>AT_AddConstraint</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1693"><span class='Ref_to_EnumConst'>AT_ProcessedConstraint</span></a><span class='Operator'>:</span>        <span class='Comment_Single_Line'>/* becomes AT_AddConstraint */ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1688"><span class='Ref_to_EnumConst'>AT_AddConstraintRecurse</span></a><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* becomes AT_AddConstraint */ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1689"><span class='Ref_to_EnumConst'>AT_ReAddConstraint</span></a><span class='Operator'>:</span>    <span class='Comment_Single_Line'>/* becomes AT_AddConstraint */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3167"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2050"><span class='Ref_to_Struct'>Constraint</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span><a name="LN3271"></a>                    <a href="../../include/nodes/parsenodes.h.html#LN2050"><span class='Ref_to_Struct'>Constraint</span></a> <span class='Operator'>*</span><span class='Declare_Local'>con</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2050"><span class='Ref_to_Struct'>Constraint</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN3167"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Delimiter'>; 
</span> 
                    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3271"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2053"><span class='Ref_to_Member'>contype</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2030"><span class='Ref_to_EnumConst'>CONSTR_EXCLUSION</span></a><span class='Operator'>: 
</span>                        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2028"><span class='Ref_to_EnumConst'>CONSTR_PRIMARY</span></a><span class='Operator'>: 
</span>                        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2029"><span class='Ref_to_EnumConst'>CONSTR_UNIQUE</span></a><span class='Operator'>: 
</span> 
                            <span class='Comment_Multi_Line'>/* 
                             * Cases essentially the same as CREATE INDEX. We 
                             * could reduce the lock strength to ShareLock if 
                             * we can work out how to allow concurrent catalog 
                             * updates. XXX Might be set down to 
                             * ShareRowExclusiveLock but requires further 
                             * analysis. 
                             */ 
</span>                            <a href="tablecmds.c.html#LN3168"><span class='Ref_To_Local'>cmd_lockmode</span></a> <span class='Operator'>= </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span>                        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2031"><span class='Ref_to_EnumConst'>CONSTR_FOREIGN</span></a><span class='Operator'>: 
</span> 
                            <span class='Comment_Multi_Line'>/* 
                             * We add triggers to both tables when we add a 
                             * Foreign Key, so the lock level must be at least 
                             * as strong as CREATE TRIGGER. 
                             */ 
</span>                            <a href="tablecmds.c.html#LN3168"><span class='Ref_To_Local'>cmd_lockmode</span></a> <span class='Operator'>= </span><a href="../../include/storage/lockdefs.h.html#LN41"><span class='Ref_to_Const'>ShareRowExclusiveLock</span></a><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>default</span><span class='Operator'>: 
</span>                            <a href="tablecmds.c.html#LN3168"><span class='Ref_To_Local'>cmd_lockmode</span></a> <span class='Operator'>= </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch con-&GT;contype &raquo; </span> 
                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(cmd-&GT;def,Constrai... &raquo; </span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * These subcommands affect inheritance behaviour. Queries 
                 * started before us will continue to see the old inheritance 
                 * behaviour, while queries started after we commit will see 
                 * new behaviour. No need to prevent reads or writes to the 
                 * subtable while we hook it up though. Changing the TupDesc 
                 * may be a problem, so keep highest lock. 
                 */ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1725"><span class='Ref_to_EnumConst'>AT_AddInherit</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1726"><span class='Ref_to_EnumConst'>AT_DropInherit</span></a><span class='Operator'>: 
</span>                <a href="tablecmds.c.html#LN3168"><span class='Ref_To_Local'>cmd_lockmode</span></a> <span class='Operator'>= </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * These subcommands affect implicit row type conversion. They 
                 * have affects similar to CREATE/DROP CAST on queries. don't 
                 * provide for invalidating parse trees as a result of such 
                 * changes, so we keep these at AccessExclusiveLock. 
                 */ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1727"><span class='Ref_to_EnumConst'>AT_AddOf</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1728"><span class='Ref_to_EnumConst'>AT_DropOf</span></a><span class='Operator'>: 
</span>                <a href="tablecmds.c.html#LN3168"><span class='Ref_To_Local'>cmd_lockmode</span></a> <span class='Operator'>= </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Only used by CREATE OR REPLACE VIEW which must conflict 
                 * with an SELECTs currently using the view. 
                 */ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1712"><span class='Ref_to_EnumConst'>AT_ReplaceRelOptions</span></a><span class='Operator'>: 
</span>                <a href="tablecmds.c.html#LN3168"><span class='Ref_To_Local'>cmd_lockmode</span></a> <span class='Operator'>= </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * These subcommands affect general strategies for performance 
                 * and maintenance, though don't change the semantic results 
                 * from normal data reads and writes. Delaying an ALTER TABLE 
                 * behind currently active writes only delays the point where 
                 * the new strategy begins to take effect, so there is no 
                 * benefit in waiting. In this case the minimum restriction 
                 * applies: we don't currently allow concurrent catalog 
                 * updates. 
                 */ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1679"><span class='Ref_to_EnumConst'>AT_SetStatistics</span></a><span class='Operator'>:</span>      <span class='Comment_Single_Line'>/* Uses MVCC in getTableAttrs() */ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1702"><span class='Ref_to_EnumConst'>AT_ClusterOn</span></a><span class='Operator'>:</span>  <span class='Comment_Single_Line'>/* Uses MVCC in getIndexes() */ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1703"><span class='Ref_to_EnumConst'>AT_DropCluster</span></a><span class='Operator'>:</span>        <span class='Comment_Single_Line'>/* Uses MVCC in getIndexes() */ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1680"><span class='Ref_to_EnumConst'>AT_SetOptions</span></a><span class='Operator'>: </span><span class='Comment_Single_Line'>/* Uses MVCC in getTableAttrs() */ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1681"><span class='Ref_to_EnumConst'>AT_ResetOptions</span></a><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* Uses MVCC in getTableAttrs() */ 
</span>                <a href="tablecmds.c.html#LN3168"><span class='Ref_To_Local'>cmd_lockmode</span></a> <span class='Operator'>= </span><a href="../../include/storage/lockdefs.h.html#LN38"><span class='Ref_to_Const'>ShareUpdateExclusiveLock</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1704"><span class='Ref_to_EnumConst'>AT_SetLogged</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1705"><span class='Ref_to_EnumConst'>AT_SetUnLogged</span></a><span class='Operator'>: 
</span>                <a href="tablecmds.c.html#LN3168"><span class='Ref_To_Local'>cmd_lockmode</span></a> <span class='Operator'>= </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1691"><span class='Ref_to_EnumConst'>AT_ValidateConstraint</span></a><span class='Operator'>: </span><span class='Comment_Multi_Line'>/* Uses MVCC in 
                                                 * getConstraints() */ 
</span>                <a href="tablecmds.c.html#LN3168"><span class='Ref_To_Local'>cmd_lockmode</span></a> <span class='Operator'>= </span><a href="../../include/storage/lockdefs.h.html#LN38"><span class='Ref_to_Const'>ShareUpdateExclusiveLock</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Rel options are more complex than first appears. Options 
                 * are set here for tables, views and indexes; for historical 
                 * reasons these can all be used with ALTER TABLE, so we can't 
                 * decide between them using the basic grammar. 
                 */ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1710"><span class='Ref_to_EnumConst'>AT_SetRelOptions</span></a><span class='Operator'>:</span>      <span class='Comment_Multi_Line'>/* Uses MVCC in getIndexes() and 
                                         * getTables() */ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1711"><span class='Ref_to_EnumConst'>AT_ResetRelOptions</span></a><span class='Operator'>:</span>    <span class='Comment_Multi_Line'>/* Uses MVCC in getIndexes() and 
                                         * getTables() */ 
</span>                <a href="tablecmds.c.html#LN3168"><span class='Ref_To_Local'>cmd_lockmode</span></a> <span class='Operator'>= </span><a href="../../include/access/reloptions.h.html#LN280"><span class='Ref_to_Proto'>AlterTableGetRelOptionsLockLevel</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN3167"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1735"><span class='Ref_to_EnumConst'>AT_AttachPartition</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1736"><span class='Ref_to_EnumConst'>AT_DetachPartition</span></a><span class='Operator'>: 
</span>                <a href="tablecmds.c.html#LN3168"><span class='Ref_To_Local'>cmd_lockmode</span></a> <span class='Operator'>= </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>default</span><span class='Operator'>:</span>            <span class='Comment_Single_Line'>/* oops */ 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized alter table type: %d"</span><span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN3167"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1752"><span class='Ref_to_Member'>subtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch cmd-&GT;subtype &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * Take the greatest lockmode from any subcommand 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3168"><span class='Ref_To_Local'>cmd_lockmode</span></a> <span class='Operator'>&GT; </span><a href="tablecmds.c.html#LN3163"><span class='Ref_To_Local'>lockmode</span></a><span class='Parentheses'>) 
</span>            <a href="tablecmds.c.html#LN3163"><span class='Ref_To_Local'>lockmode</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN3168"><span class='Ref_To_Local'>cmd_lockmode</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN3163"><span class='Ref_To_Local'>lockmode</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterTableGetLockLevel &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ATController provides top level control over the phases. 
 * 
 * parsetree is passed in to allow it to be passed to event triggers 
 * when requested. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3406"></a><span class='Declare_Function'>ATController</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1662"><span class='Ref_to_Struct'>AlterTableStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parsetree</span><span class='Delimiter'>, 
</span><a name="LN3407"></a>             <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cmds</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recurse</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3409"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>wqueue</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN3410"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lcmd</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Phase 1: preliminary examination of commands, create work queue */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3410"><span class='Ref_To_Local'>lcmd</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3407"><span class='Ref_to_Parameter'>cmds</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3415"></a>        <a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cmd</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3410"><span class='Ref_To_Local'>lcmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN336"><span class='Ref_to_Proto'>ATPrepCmd</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN3409"><span class='Ref_To_Local'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3407"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3415"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3407"><span class='Ref_to_Parameter'>recurse</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3407"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Close the relation, but keep lock until commit */ 
</span>    <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3407"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Phase 2: update system catalogs */ 
</span>    <a href="tablecmds.c.html#LN338"><span class='Ref_to_Proto'>ATRewriteCatalogs</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN3409"><span class='Ref_To_Local'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3407"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Phase 3: scan/rewrite tables as needed */ 
</span>    <a href="tablecmds.c.html#LN341"><span class='Ref_to_Proto'>ATRewriteTables</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3406"><span class='Ref_to_Parameter'>parsetree</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN3409"><span class='Ref_To_Local'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3407"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATController &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ATPrepCmd 
 * 
 * Traffic cop for ALTER TABLE Phase 1 operations, including simple 
 * recursion and permission checks. 
 * 
 * Caller must have acquired appropriate lock type on relation already. 
 * This lock should be held until commit. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3440"></a><span class='Declare_Function'>ATPrepCmd</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>wqueue</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cmd</span><span class='Delimiter'>, 
</span><a name="LN3441"></a>          <span class='Keyword'>bool </span><span class='Declare_Parameter'>recurse</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recursing</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3443"></a>    <a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tab</span><span class='Delimiter'>; 
</span><a name="LN3444"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>pass</span> <span class='Operator'>= </span><a href="tablecmds.c.html#LN140"><span class='Ref_to_Const'>AT_PASS_UNSET</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Find or create work queue entry for this table */ 
</span>    <a href="tablecmds.c.html#LN3443"><span class='Ref_To_Local'>tab</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN344"><span class='Ref_to_Proto'>ATGetQueueEntry</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Copy the original subcommand for each table.  This avoids conflicts 
     * when different child tables need to make different parse 
     * transformations (for example, the same column may have different column 
     * numbers in different children). 
     */ 
</span>    <a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>cmd</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>cmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Do permissions checking, recursion to child tables if needed, and any 
     * additional phase-1 processing needed. 
     */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1752"><span class='Ref_to_Member'>subtype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1673"><span class='Ref_to_EnumConst'>AT_AddColumn</span></a><span class='Operator'>:</span>      <span class='Comment_Single_Line'>/* ADD COLUMN */ 
</span>            <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, 
</span>                         <a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN282"><span class='Ref_to_Const'>ATT_COMPOSITE_TYPE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN283"><span class='Ref_to_Const'>ATT_FOREIGN_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN353"><span class='Ref_to_Proto'>ATPrepAddColumn</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3441"><span class='Ref_to_Parameter'>recurse</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3441"><span class='Ref_to_Parameter'>recursing</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>cmd</span></a><span class='Delimiter'>, 
</span>                            <a href="tablecmds.c.html#LN3441"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Recursion occurs during execution phase */ 
</span>            <a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN147"><span class='Ref_to_Const'>AT_PASS_ADD_COL</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1675"><span class='Ref_to_EnumConst'>AT_AddColumnToView</span></a><span class='Operator'>:</span>        <span class='Comment_Multi_Line'>/* add column via CREATE OR REPLACE 
                                         * VIEW */ 
</span>            <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN279"><span class='Ref_to_Const'>ATT_VIEW</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN353"><span class='Ref_to_Proto'>ATPrepAddColumn</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3441"><span class='Ref_to_Parameter'>recurse</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3441"><span class='Ref_to_Parameter'>recursing</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>cmd</span></a><span class='Delimiter'>, 
</span>                            <a href="tablecmds.c.html#LN3441"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Recursion occurs during execution phase */ 
</span>            <a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN147"><span class='Ref_to_Const'>AT_PASS_ADD_COL</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1676"><span class='Ref_to_EnumConst'>AT_ColumnDefault</span></a><span class='Operator'>:</span>  <span class='Comment_Single_Line'>/* ALTER COLUMN DEFAULT */ 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * We allow defaults on views so that INSERT into a view can have 
             * default-ish behavior.  This works because the rewriter 
             * substitutes default values into INSERTs before it expands 
             * rules. 
             */ 
</span>            <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN279"><span class='Ref_to_Const'>ATT_VIEW</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN283"><span class='Ref_to_Const'>ATT_FOREIGN_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN347"><span class='Ref_to_Proto'>ATSimpleRecursion</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>cmd</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3441"><span class='Ref_to_Parameter'>recurse</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3441"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* No command-specific prep needed */ 
</span>            <a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a> <span class='Operator'>? </span><a href="tablecmds.c.html#LN149"><span class='Ref_to_Const'>AT_PASS_ADD_CONSTR</span></a> <span class='Operator'>: </span><a href="tablecmds.c.html#LN141"><span class='Ref_to_Const'>AT_PASS_DROP</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1737"><span class='Ref_to_EnumConst'>AT_AddIdentity</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN279"><span class='Ref_to_Const'>ATT_VIEW</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN283"><span class='Ref_to_Const'>ATT_FOREIGN_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN149"><span class='Ref_to_Const'>AT_PASS_ADD_CONSTR</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1739"><span class='Ref_to_EnumConst'>AT_DropIdentity</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN279"><span class='Ref_to_Const'>ATT_VIEW</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN283"><span class='Ref_to_Const'>ATT_FOREIGN_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN141"><span class='Ref_to_Const'>AT_PASS_DROP</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1738"><span class='Ref_to_EnumConst'>AT_SetIdentity</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN279"><span class='Ref_to_Const'>ATT_VIEW</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN283"><span class='Ref_to_Const'>ATT_FOREIGN_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN145"><span class='Ref_to_Const'>AT_PASS_COL_ATTRS</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1677"><span class='Ref_to_EnumConst'>AT_DropNotNull</span></a><span class='Operator'>:</span>    <span class='Comment_Single_Line'>/* ALTER COLUMN DROP NOT NULL */ 
</span>            <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN283"><span class='Ref_to_Const'>ATT_FOREIGN_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN365"><span class='Ref_to_Proto'>ATPrepDropNotNull</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3441"><span class='Ref_to_Parameter'>recurse</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3441"><span class='Ref_to_Parameter'>recursing</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN347"><span class='Ref_to_Proto'>ATSimpleRecursion</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>cmd</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3441"><span class='Ref_to_Parameter'>recurse</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3441"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* No command-specific prep needed */ 
</span>            <a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN141"><span class='Ref_to_Const'>AT_PASS_DROP</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1678"><span class='Ref_to_EnumConst'>AT_SetNotNull</span></a><span class='Operator'>:</span>     <span class='Comment_Single_Line'>/* ALTER COLUMN SET NOT NULL */ 
</span>            <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN283"><span class='Ref_to_Const'>ATT_FOREIGN_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN367"><span class='Ref_to_Proto'>ATPrepSetNotNull</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3441"><span class='Ref_to_Parameter'>recurse</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3441"><span class='Ref_to_Parameter'>recursing</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN347"><span class='Ref_to_Proto'>ATSimpleRecursion</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>cmd</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3441"><span class='Ref_to_Parameter'>recurse</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3441"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* No command-specific prep needed */ 
</span>            <a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN149"><span class='Ref_to_Const'>AT_PASS_ADD_CONSTR</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1679"><span class='Ref_to_EnumConst'>AT_SetStatistics</span></a><span class='Operator'>:</span>  <span class='Comment_Single_Line'>/* ALTER COLUMN SET STATISTICS */ 
</span>            <a href="tablecmds.c.html#LN347"><span class='Ref_to_Proto'>ATSimpleRecursion</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>cmd</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3441"><span class='Ref_to_Parameter'>recurse</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3441"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Performs own permission checks */ 
</span>            <a href="tablecmds.c.html#LN377"><span class='Ref_to_Proto'>ATPrepSetStatistics</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1753"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3441"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN150"><span class='Ref_to_Const'>AT_PASS_MISC</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1680"><span class='Ref_to_EnumConst'>AT_SetOptions</span></a><span class='Operator'>:</span>     <span class='Comment_Single_Line'>/* ALTER COLUMN SET ( options ) */ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1681"><span class='Ref_to_EnumConst'>AT_ResetOptions</span></a><span class='Operator'>:</span>   <span class='Comment_Single_Line'>/* ALTER COLUMN RESET ( options ) */ 
</span>            <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN280"><span class='Ref_to_Const'>ATT_MATVIEW</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN281"><span class='Ref_to_Const'>ATT_INDEX</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN283"><span class='Ref_to_Const'>ATT_FOREIGN_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* This command never recurses */ 
</span>            <a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN150"><span class='Ref_to_Const'>AT_PASS_MISC</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1682"><span class='Ref_to_EnumConst'>AT_SetStorage</span></a><span class='Operator'>:</span>     <span class='Comment_Single_Line'>/* ALTER COLUMN SET STORAGE */ 
</span>            <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN280"><span class='Ref_to_Const'>ATT_MATVIEW</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN283"><span class='Ref_to_Const'>ATT_FOREIGN_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN347"><span class='Ref_to_Proto'>ATSimpleRecursion</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>cmd</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3441"><span class='Ref_to_Parameter'>recurse</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3441"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* No command-specific prep needed */ 
</span>            <a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN150"><span class='Ref_to_Const'>AT_PASS_MISC</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1683"><span class='Ref_to_EnumConst'>AT_DropColumn</span></a><span class='Operator'>:</span>     <span class='Comment_Single_Line'>/* DROP COLUMN */ 
</span>            <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, 
</span>                         <a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN282"><span class='Ref_to_Const'>ATT_COMPOSITE_TYPE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN283"><span class='Ref_to_Const'>ATT_FOREIGN_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN385"><span class='Ref_to_Proto'>ATPrepDropColumn</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3441"><span class='Ref_to_Parameter'>recurse</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3441"><span class='Ref_to_Parameter'>recursing</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>cmd</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3441"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Recursion occurs during execution phase */ 
</span>            <a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN141"><span class='Ref_to_Const'>AT_PASS_DROP</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1685"><span class='Ref_to_EnumConst'>AT_AddIndex</span></a><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* ADD INDEX */ 
</span>            <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* This command never recurses */ 
</span>            <span class='Comment_Multi_Line'>/* No command-specific prep needed */ 
</span>            <a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN148"><span class='Ref_to_Const'>AT_PASS_ADD_INDEX</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1687"><span class='Ref_to_EnumConst'>AT_AddConstraint</span></a><span class='Operator'>:</span>  <span class='Comment_Single_Line'>/* ADD CONSTRAINT */ 
</span>            <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN283"><span class='Ref_to_Const'>ATT_FOREIGN_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Recursion occurs during execution phase */ 
</span>            <span class='Comment_Multi_Line'>/* No command-specific prep needed except saving recurse flag */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3441"><span class='Ref_to_Parameter'>recurse</span></a><span class='Parentheses'>) 
</span>                <a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1752"><span class='Ref_to_Member'>subtype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN1688"><span class='Ref_to_EnumConst'>AT_AddConstraintRecurse</span></a><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN149"><span class='Ref_to_Const'>AT_PASS_ADD_CONSTR</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1695"><span class='Ref_to_EnumConst'>AT_AddIndexConstraint</span></a><span class='Operator'>:</span>     <span class='Comment_Single_Line'>/* ADD CONSTRAINT USING INDEX */ 
</span>            <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* This command never recurses */ 
</span>            <span class='Comment_Multi_Line'>/* No command-specific prep needed */ 
</span>            <a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN149"><span class='Ref_to_Const'>AT_PASS_ADD_CONSTR</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1696"><span class='Ref_to_EnumConst'>AT_DropConstraint</span></a><span class='Operator'>: </span><span class='Comment_Single_Line'>/* DROP CONSTRAINT */ 
</span>            <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN283"><span class='Ref_to_Const'>ATT_FOREIGN_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Recursion occurs during execution phase */ 
</span>            <span class='Comment_Multi_Line'>/* No command-specific prep needed except saving recurse flag */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3441"><span class='Ref_to_Parameter'>recurse</span></a><span class='Parentheses'>) 
</span>                <a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1752"><span class='Ref_to_Member'>subtype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN1697"><span class='Ref_to_EnumConst'>AT_DropConstraintRecurse</span></a><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN141"><span class='Ref_to_Const'>AT_PASS_DROP</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1699"><span class='Ref_to_EnumConst'>AT_AlterColumnType</span></a><span class='Operator'>:</span>        <span class='Comment_Single_Line'>/* ALTER COLUMN TYPE */ 
</span>            <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, 
</span>                         <a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN282"><span class='Ref_to_Const'>ATT_COMPOSITE_TYPE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN283"><span class='Ref_to_Const'>ATT_FOREIGN_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Performs own recursion */ 
</span>            <a href="tablecmds.c.html#LN410"><span class='Ref_to_Proto'>ATPrepAlterColumnType</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3443"><span class='Ref_To_Local'>tab</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3441"><span class='Ref_to_Parameter'>recurse</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3441"><span class='Ref_to_Parameter'>recursing</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>cmd</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3441"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN142"><span class='Ref_to_Const'>AT_PASS_ALTER_TYPE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1700"><span class='Ref_to_EnumConst'>AT_AlterColumnGenericOptions</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN283"><span class='Ref_to_Const'>ATT_FOREIGN_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* This command never recurses */ 
</span>            <span class='Comment_Multi_Line'>/* No command-specific prep needed */ 
</span>            <a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN150"><span class='Ref_to_Const'>AT_PASS_MISC</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1701"><span class='Ref_to_EnumConst'>AT_ChangeOwner</span></a><span class='Operator'>:</span>    <span class='Comment_Single_Line'>/* ALTER OWNER */ 
</span>            <span class='Comment_Multi_Line'>/* This command never recurses */ 
</span>            <span class='Comment_Multi_Line'>/* No command-specific prep needed */ 
</span>            <a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN150"><span class='Ref_to_Const'>AT_PASS_MISC</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1702"><span class='Ref_to_EnumConst'>AT_ClusterOn</span></a><span class='Operator'>:</span>      <span class='Comment_Single_Line'>/* CLUSTER ON */ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1703"><span class='Ref_to_EnumConst'>AT_DropCluster</span></a><span class='Operator'>:</span>    <span class='Comment_Single_Line'>/* SET WITHOUT CLUSTER */ 
</span>            <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN280"><span class='Ref_to_Const'>ATT_MATVIEW</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* These commands never recurse */ 
</span>            <span class='Comment_Multi_Line'>/* No command-specific prep needed */ 
</span>            <a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN150"><span class='Ref_to_Const'>AT_PASS_MISC</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1704"><span class='Ref_to_EnumConst'>AT_SetLogged</span></a><span class='Operator'>:</span>      <span class='Comment_Single_Line'>/* SET LOGGED */ 
</span>            <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN3443"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN167"><span class='Ref_to_Member'>chgPersistence</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN435"><span class='Ref_to_Proto'>ATPrepChangePersistence</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* force rewrite if necessary; see comment in ATRewriteTables */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3443"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN167"><span class='Ref_to_Member'>chgPersistence</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="tablecmds.c.html#LN3443"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN165"><span class='Ref_to_Member'>rewrite</span></a> <span class='Operator'>|= </span><a href="../../include/commands/event_trigger.h.html#LN30"><span class='Ref_to_Const'>AT_REWRITE_ALTER_PERSISTENCE</span></a><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN3443"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN168"><span class='Ref_to_Member'>newrelpersistence</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_class.h.html#LN169"><span class='Ref_to_Const'>RELPERSISTENCE_PERMANENT</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN150"><span class='Ref_to_Const'>AT_PASS_MISC</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1705"><span class='Ref_to_EnumConst'>AT_SetUnLogged</span></a><span class='Operator'>:</span>    <span class='Comment_Single_Line'>/* SET UNLOGGED */ 
</span>            <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN3443"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN167"><span class='Ref_to_Member'>chgPersistence</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN435"><span class='Ref_to_Proto'>ATPrepChangePersistence</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* force rewrite if necessary; see comment in ATRewriteTables */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3443"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN167"><span class='Ref_to_Member'>chgPersistence</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="tablecmds.c.html#LN3443"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN165"><span class='Ref_to_Member'>rewrite</span></a> <span class='Operator'>|= </span><a href="../../include/commands/event_trigger.h.html#LN30"><span class='Ref_to_Const'>AT_REWRITE_ALTER_PERSISTENCE</span></a><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN3443"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN168"><span class='Ref_to_Member'>newrelpersistence</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_class.h.html#LN170"><span class='Ref_to_Const'>RELPERSISTENCE_UNLOGGED</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN150"><span class='Ref_to_Const'>AT_PASS_MISC</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1706"><span class='Ref_to_EnumConst'>AT_AddOids</span></a><span class='Operator'>:</span>        <span class='Comment_Single_Line'>/* SET WITH OIDS */ 
</span>            <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN283"><span class='Ref_to_Const'>ATT_FOREIGN_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relhasoids <span class='Operator'>|| </span><a href="tablecmds.c.html#LN3441"><span class='Ref_to_Parameter'>recursing</span></a><span class='Parentheses'>) 
</span>                <a href="tablecmds.c.html#LN363"><span class='Ref_to_Proto'>ATPrepAddOids</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3441"><span class='Ref_to_Parameter'>recurse</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>cmd</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3441"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Recursion occurs during execution phase */ 
</span>            <a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN147"><span class='Ref_to_Const'>AT_PASS_ADD_COL</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1708"><span class='Ref_to_EnumConst'>AT_DropOids</span></a><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* SET WITHOUT OIDS */ 
</span>            <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN283"><span class='Ref_to_Const'>ATT_FOREIGN_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Performs own recursion */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relhasoids<span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN3630"></a>                <a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a> <span class='Operator'>*</span><span class='Declare_Local'>dropCmd</span> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="tablecmds.c.html#LN3630"><span class='Ref_To_Local'>dropCmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1752"><span class='Ref_to_Member'>subtype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN1683"><span class='Ref_to_EnumConst'>AT_DropColumn</span></a><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN3630"><span class='Ref_To_Local'>dropCmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1753"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><span class='String'>"oid"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN3630"><span class='Ref_To_Local'>dropCmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1758"><span class='Ref_to_Member'>behavior</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1758"><span class='Ref_to_Member'>behavior</span></a><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN336"><span class='Ref_to_Proto'>ATPrepCmd</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3630"><span class='Ref_To_Local'>dropCmd</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3441"><span class='Ref_to_Parameter'>recurse</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3441"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN141"><span class='Ref_to_Const'>AT_PASS_DROP</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1709"><span class='Ref_to_EnumConst'>AT_SetTableSpace</span></a><span class='Operator'>:</span>  <span class='Comment_Single_Line'>/* SET TABLESPACE */ 
</span>            <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN280"><span class='Ref_to_Const'>ATT_MATVIEW</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN281"><span class='Ref_to_Const'>ATT_INDEX</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* This command never recurses */ 
</span>            <a href="tablecmds.c.html#LN436"><span class='Ref_to_Proto'>ATPrepSetTableSpace</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3443"><span class='Ref_To_Local'>tab</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1753"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3441"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN150"><span class='Ref_to_Const'>AT_PASS_MISC</span></a><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* doesn't actually matter */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1710"><span class='Ref_to_EnumConst'>AT_SetRelOptions</span></a><span class='Operator'>:</span>  <span class='Comment_Single_Line'>/* SET (...) */ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1711"><span class='Ref_to_EnumConst'>AT_ResetRelOptions</span></a><span class='Operator'>:</span>        <span class='Comment_Single_Line'>/* RESET (...) */ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1712"><span class='Ref_to_EnumConst'>AT_ReplaceRelOptions</span></a><span class='Operator'>:</span>      <span class='Comment_Single_Line'>/* reset them all, then set just these */ 
</span>            <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN279"><span class='Ref_to_Const'>ATT_VIEW</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN280"><span class='Ref_to_Const'>ATT_MATVIEW</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN281"><span class='Ref_to_Const'>ATT_INDEX</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* This command never recurses */ 
</span>            <span class='Comment_Multi_Line'>/* No command-specific prep needed */ 
</span>            <a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN150"><span class='Ref_to_Const'>AT_PASS_MISC</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1725"><span class='Ref_to_EnumConst'>AT_AddInherit</span></a><span class='Operator'>:</span>     <span class='Comment_Single_Line'>/* INHERIT */ 
</span>            <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN283"><span class='Ref_to_Const'>ATT_FOREIGN_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* This command never recurses */ 
</span>            <a href="tablecmds.c.html#LN446"><span class='Ref_to_Proto'>ATPrepAddInherit</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN150"><span class='Ref_to_Const'>AT_PASS_MISC</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1726"><span class='Ref_to_EnumConst'>AT_DropInherit</span></a><span class='Operator'>:</span>    <span class='Comment_Single_Line'>/* NO INHERIT */ 
</span>            <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN283"><span class='Ref_to_Const'>ATT_FOREIGN_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* This command never recurses */ 
</span>            <span class='Comment_Multi_Line'>/* No command-specific prep needed */ 
</span>            <a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN150"><span class='Ref_to_Const'>AT_PASS_MISC</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1690"><span class='Ref_to_EnumConst'>AT_AlterConstraint</span></a><span class='Operator'>:</span>        <span class='Comment_Single_Line'>/* ALTER CONSTRAINT */ 
</span>            <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN150"><span class='Ref_to_Const'>AT_PASS_MISC</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1691"><span class='Ref_to_EnumConst'>AT_ValidateConstraint</span></a><span class='Operator'>:</span>     <span class='Comment_Single_Line'>/* VALIDATE CONSTRAINT */ 
</span>            <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN283"><span class='Ref_to_Const'>ATT_FOREIGN_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Recursion occurs during execution phase */ 
</span>            <span class='Comment_Multi_Line'>/* No command-specific prep needed except saving recurse flag */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3441"><span class='Ref_to_Parameter'>recurse</span></a><span class='Parentheses'>) 
</span>                <a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1752"><span class='Ref_to_Member'>subtype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN1692"><span class='Ref_to_EnumConst'>AT_ValidateConstraintRecurse</span></a><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN150"><span class='Ref_to_Const'>AT_PASS_MISC</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1729"><span class='Ref_to_EnumConst'>AT_ReplicaIdentity</span></a><span class='Operator'>:</span>        <span class='Comment_Single_Line'>/* REPLICA IDENTITY ... */ 
</span>            <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN280"><span class='Ref_to_Const'>ATT_MATVIEW</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN150"><span class='Ref_to_Const'>AT_PASS_MISC</span></a><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* This command never recurses */ 
</span>            <span class='Comment_Multi_Line'>/* No command-specific prep needed */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1713"><span class='Ref_to_EnumConst'>AT_EnableTrig</span></a><span class='Operator'>:</span>     <span class='Comment_Single_Line'>/* ENABLE TRIGGER variants */ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1714"><span class='Ref_to_EnumConst'>AT_EnableAlwaysTrig</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1715"><span class='Ref_to_EnumConst'>AT_EnableReplicaTrig</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1717"><span class='Ref_to_EnumConst'>AT_EnableTrigAll</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1719"><span class='Ref_to_EnumConst'>AT_EnableTrigUser</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1716"><span class='Ref_to_EnumConst'>AT_DisableTrig</span></a><span class='Operator'>:</span>    <span class='Comment_Single_Line'>/* DISABLE TRIGGER variants */ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1718"><span class='Ref_to_EnumConst'>AT_DisableTrigAll</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1720"><span class='Ref_to_EnumConst'>AT_DisableTrigUser</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN283"><span class='Ref_to_Const'>ATT_FOREIGN_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN150"><span class='Ref_to_Const'>AT_PASS_MISC</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1721"><span class='Ref_to_EnumConst'>AT_EnableRule</span></a><span class='Operator'>:</span>     <span class='Comment_Single_Line'>/* ENABLE/DISABLE RULE variants */ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1722"><span class='Ref_to_EnumConst'>AT_EnableAlwaysRule</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1723"><span class='Ref_to_EnumConst'>AT_EnableReplicaRule</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1724"><span class='Ref_to_EnumConst'>AT_DisableRule</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1727"><span class='Ref_to_EnumConst'>AT_AddOf</span></a><span class='Operator'>:</span>          <span class='Comment_Single_Line'>/* OF */ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1728"><span class='Ref_to_EnumConst'>AT_DropOf</span></a><span class='Operator'>: </span><span class='Comment_Single_Line'>/* NOT OF */ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1730"><span class='Ref_to_EnumConst'>AT_EnableRowSecurity</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1731"><span class='Ref_to_EnumConst'>AT_DisableRowSecurity</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1732"><span class='Ref_to_EnumConst'>AT_ForceRowSecurity</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1733"><span class='Ref_to_EnumConst'>AT_NoForceRowSecurity</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* These commands never recurse */ 
</span>            <span class='Comment_Multi_Line'>/* No command-specific prep needed */ 
</span>            <a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN150"><span class='Ref_to_Const'>AT_PASS_MISC</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1734"><span class='Ref_to_EnumConst'>AT_GenericOptions</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN283"><span class='Ref_to_Const'>ATT_FOREIGN_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* No command-specific prep needed */ 
</span>            <a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN150"><span class='Ref_to_Const'>AT_PASS_MISC</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1735"><span class='Ref_to_EnumConst'>AT_AttachPartition</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1736"><span class='Ref_to_EnumConst'>AT_DetachPartition</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* No command-specific prep needed */ 
</span>            <a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN150"><span class='Ref_to_Const'>AT_PASS_MISC</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>:</span>                <span class='Comment_Single_Line'>/* oops */ 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized alter table type: %d"</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1752"><span class='Ref_to_Member'>subtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN140"><span class='Ref_to_Const'>AT_PASS_UNSET</span></a><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch cmd-&GT;subtype &raquo; </span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>&GT; </span><a href="tablecmds.c.html#LN140"><span class='Ref_to_Const'>AT_PASS_UNSET</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Add the subcommand to the appropriate list for phase 2 */ 
</span>    <a href="tablecmds.c.html#LN3443"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN160"><span class='Ref_to_Member'>subcmds</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3443"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN160"><span class='Ref_to_Member'>subcmds</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN3444"><span class='Ref_To_Local'>pass</span></a><span class='Delimiter'>], </span><a href="tablecmds.c.html#LN3440"><span class='Ref_to_Parameter'>cmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATPrepCmd &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ATRewriteCatalogs 
 * 
 * Traffic cop for ALTER TABLE Phase 2 operations.  Subcommands are 
 * dispatched in a "safe" execution order (designed to avoid unnecessary 
 * conflicts). 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3740"></a><span class='Declare_Function'>ATRewriteCatalogs</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>wqueue</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3742"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>pass</span><span class='Delimiter'>; 
</span><a name="LN3743"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>ltab</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We process all the tables "in parallel", one pass at a time.  This is 
     * needed because we may have to propagate work from one table to another 
     * (specifically, ALTER TYPE on a foreign key's PK has to dispatch the 
     * re-adding of the foreign key constraint to the other table).  Work can 
     * only be propagated into later passes, however. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3742"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN3742"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>&LT; </span><a href="tablecmds.c.html#LN151"><span class='Ref_to_Const'>AT_NUM_PASSES</span></a><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN3742"><span class='Ref_To_Local'>pass</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Go through each table that needs to be processed */ 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3743"><span class='Ref_To_Local'>ltab</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="tablecmds.c.html#LN3740"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN3757"></a>            <a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tab</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3743"><span class='Ref_To_Local'>ltab</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3758"></a>            <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>subcmds</span> <span class='Operator'>= </span><a href="tablecmds.c.html#LN3757"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN160"><span class='Ref_to_Member'>subcmds</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN3742"><span class='Ref_To_Local'>pass</span></a><span class='Delimiter'>]; 
</span><a name="LN3759"></a>            <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN3760"></a>            <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lcmd</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3758"><span class='Ref_To_Local'>subcmds</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Appropriate lock was obtained by phase 1, needn't get it again 
             */ 
</span>            <a href="tablecmds.c.html#LN3759"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN84"><span class='Ref_to_Proto'>relation_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3757"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN156"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3760"><span class='Ref_To_Local'>lcmd</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3758"><span class='Ref_To_Local'>subcmds</span></a><span class='Parentheses'>) 
</span><a name="LN3771"></a>                <span class='Declare_Local'>ATExecCmd</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3740"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3757"><span class='Ref_To_Local'>tab</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3759"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3760"><span class='Ref_To_Local'>lcmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3740"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * After the ALTER TYPE pass, do cleanup work (this is not done in 
             * ATExecAlterColumnType since it should be done only once if 
             * multiple columns of a table are altered). 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3742"><span class='Ref_To_Local'>pass</span></a> <span class='Operator'>== </span><a href="tablecmds.c.html#LN142"><span class='Ref_to_Const'>AT_PASS_ALTER_TYPE</span></a><span class='Parentheses'>) 
</span>                <a href="tablecmds.c.html#LN419"><span class='Ref_to_Proto'>ATPostAlterTypeCleanup</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3740"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3757"><span class='Ref_To_Local'>tab</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3740"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3759"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for pass=0;pass&LT;AT_NUM_PA... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Check to see if a toast table must be added. */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3743"><span class='Ref_To_Local'>ltab</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="tablecmds.c.html#LN3740"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3788"></a>        <a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tab</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3743"><span class='Ref_To_Local'>ltab</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If the table is source table of ATTACH PARTITION command, we did 
         * not modify anything about it that will change its toasting 
         * requirement, so no need to check. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="tablecmds.c.html#LN3788"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN157"><span class='Ref_to_Member'>relkind</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a> <span class='Operator'>|| 
</span>              <a href="tablecmds.c.html#LN3788"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN157"><span class='Ref_to_Member'>relkind</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>             <a href="tablecmds.c.html#LN3788"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN169"><span class='Ref_to_Member'>partition_constraint</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> <span class='Operator'>|| 
</span>            <a href="tablecmds.c.html#LN3788"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN157"><span class='Ref_to_Member'>relkind</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a><span class='Parentheses'>)</span> 
            <a href="../../include/catalog/toasting.h.html#LN24"><span class='Ref_to_Proto'>AlterTableCreateToastTable</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3788"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN156"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3740"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end ATRewriteCatalogs &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ATExecCmd: dispatch a subcommand to appropriate execution routine 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3807"></a><span class='Declare_Function'>ATExecCmd</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>wqueue</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tab</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN3808"></a>          <a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cmd</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3810"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span> <span class='Operator'>= </span><a href="../catalog/objectaddress.c.html#LN718"><span class='Ref_to_Global_Var'>InvalidObjectAddress</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1752"><span class='Ref_to_Member'>subtype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1673"><span class='Ref_to_EnumConst'>AT_AddColumn</span></a><span class='Operator'>:</span>      <span class='Comment_Single_Line'>/* ADD COLUMN */ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1675"><span class='Ref_to_EnumConst'>AT_AddColumnToView</span></a><span class='Operator'>:</span>        <span class='Comment_Multi_Line'>/* add column via CREATE OR REPLACE 
                                         * VIEW */ 
</span>            <a href="tablecmds.c.html#LN3810"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN355"><span class='Ref_to_Proto'>ATExecAddColumn</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>tab</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN636"><span class='Ref_to_Struct'>ColumnDef</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Delimiter'>, 
</span>                                      <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                      <span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1674"><span class='Ref_to_EnumConst'>AT_AddColumnRecurse</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN3810"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN355"><span class='Ref_to_Proto'>ATExecAddColumn</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>tab</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN636"><span class='Ref_to_Struct'>ColumnDef</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Delimiter'>, 
</span>                                      <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                      <a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1759"><span class='Ref_to_Member'>missing_ok</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1676"><span class='Ref_to_EnumConst'>AT_ColumnDefault</span></a><span class='Operator'>:</span>  <span class='Comment_Single_Line'>/* ALTER COLUMN DEFAULT */ 
</span>            <a href="tablecmds.c.html#LN3810"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN370"><span class='Ref_to_Proto'>ATExecColumnDefault</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1753"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1737"><span class='Ref_to_EnumConst'>AT_AddIdentity</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN3810"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN372"><span class='Ref_to_Proto'>ATExecAddIdentity</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1753"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1738"><span class='Ref_to_EnumConst'>AT_SetIdentity</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN3810"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN374"><span class='Ref_to_Proto'>ATExecSetIdentity</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1753"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1739"><span class='Ref_to_EnumConst'>AT_DropIdentity</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN3810"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN376"><span class='Ref_to_Proto'>ATExecDropIdentity</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1753"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1759"><span class='Ref_to_Member'>missing_ok</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1677"><span class='Ref_to_EnumConst'>AT_DropNotNull</span></a><span class='Operator'>:</span>    <span class='Comment_Single_Line'>/* ALTER COLUMN DROP NOT NULL */ 
</span>            <a href="tablecmds.c.html#LN3810"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN366"><span class='Ref_to_Proto'>ATExecDropNotNull</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1753"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1678"><span class='Ref_to_EnumConst'>AT_SetNotNull</span></a><span class='Operator'>:</span>     <span class='Comment_Single_Line'>/* ALTER COLUMN SET NOT NULL */ 
</span>            <a href="tablecmds.c.html#LN3810"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN368"><span class='Ref_to_Proto'>ATExecSetNotNull</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>tab</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1753"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1679"><span class='Ref_to_EnumConst'>AT_SetStatistics</span></a><span class='Operator'>:</span>  <span class='Comment_Single_Line'>/* ALTER COLUMN SET STATISTICS */ 
</span>            <a href="tablecmds.c.html#LN3810"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN379"><span class='Ref_to_Proto'>ATExecSetStatistics</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1753"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1680"><span class='Ref_to_EnumConst'>AT_SetOptions</span></a><span class='Operator'>:</span>     <span class='Comment_Single_Line'>/* ALTER COLUMN SET ( options ) */ 
</span>            <a href="tablecmds.c.html#LN3810"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN381"><span class='Ref_to_Proto'>ATExecSetOptions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1753"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1681"><span class='Ref_to_EnumConst'>AT_ResetOptions</span></a><span class='Operator'>:</span>   <span class='Comment_Single_Line'>/* ALTER COLUMN RESET ( options ) */ 
</span>            <a href="tablecmds.c.html#LN3810"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN381"><span class='Ref_to_Proto'>ATExecSetOptions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1753"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1682"><span class='Ref_to_EnumConst'>AT_SetStorage</span></a><span class='Operator'>:</span>     <span class='Comment_Single_Line'>/* ALTER COLUMN SET STORAGE */ 
</span>            <a href="tablecmds.c.html#LN3810"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN383"><span class='Ref_to_Proto'>ATExecSetStorage</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1753"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1683"><span class='Ref_to_EnumConst'>AT_DropColumn</span></a><span class='Operator'>:</span>     <span class='Comment_Single_Line'>/* DROP COLUMN */ 
</span>            <a href="tablecmds.c.html#LN3810"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN387"><span class='Ref_to_Proto'>ATExecDropColumn</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1753"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, 
</span>                                       <a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1758"><span class='Ref_to_Member'>behavior</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                       <a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1759"><span class='Ref_to_Member'>missing_ok</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1684"><span class='Ref_to_EnumConst'>AT_DropColumnRecurse</span></a><span class='Operator'>:</span>      <span class='Comment_Single_Line'>/* DROP COLUMN with recursion */ 
</span>            <a href="tablecmds.c.html#LN3810"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN387"><span class='Ref_to_Proto'>ATExecDropColumn</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1753"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, 
</span>                                       <a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1758"><span class='Ref_to_Member'>behavior</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                       <a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1759"><span class='Ref_to_Member'>missing_ok</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1685"><span class='Ref_to_EnumConst'>AT_AddIndex</span></a><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* ADD INDEX */ 
</span>            <a href="tablecmds.c.html#LN3810"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN391"><span class='Ref_to_Proto'>ATExecAddIndex</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>tab</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2667"><span class='Ref_to_Struct'>IndexStmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                     <a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1686"><span class='Ref_to_EnumConst'>AT_ReAddIndex</span></a><span class='Operator'>:</span>     <span class='Comment_Single_Line'>/* ADD INDEX */ 
</span>            <a href="tablecmds.c.html#LN3810"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN391"><span class='Ref_to_Proto'>ATExecAddIndex</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>tab</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2667"><span class='Ref_to_Struct'>IndexStmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                     <a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1687"><span class='Ref_to_EnumConst'>AT_AddConstraint</span></a><span class='Operator'>:</span>  <span class='Comment_Single_Line'>/* ADD CONSTRAINT */ 
</span>            <a href="tablecmds.c.html#LN3810"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= 
</span>                <a href="tablecmds.c.html#LN393"><span class='Ref_to_Proto'>ATExecAddConstraint</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>tab</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2050"><span class='Ref_to_Struct'>Constraint</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Delimiter'>, 
</span>                                    <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1688"><span class='Ref_to_EnumConst'>AT_AddConstraintRecurse</span></a><span class='Operator'>:</span>   <span class='Comment_Single_Line'>/* ADD CONSTRAINT with recursion */ 
</span>            <a href="tablecmds.c.html#LN3810"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= 
</span>                <a href="tablecmds.c.html#LN393"><span class='Ref_to_Proto'>ATExecAddConstraint</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>tab</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2050"><span class='Ref_to_Struct'>Constraint</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Delimiter'>, 
</span>                                    <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1689"><span class='Ref_to_EnumConst'>AT_ReAddConstraint</span></a><span class='Operator'>:</span>        <span class='Comment_Multi_Line'>/* Re-add pre-existing check 
                                         * constraint */ 
</span>            <a href="tablecmds.c.html#LN3810"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= 
</span>                <a href="tablecmds.c.html#LN393"><span class='Ref_to_Proto'>ATExecAddConstraint</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>tab</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2050"><span class='Ref_to_Struct'>Constraint</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Delimiter'>, 
</span>                                    <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1698"><span class='Ref_to_EnumConst'>AT_ReAddComment</span></a><span class='Operator'>:</span>   <span class='Comment_Single_Line'>/* Re-add existing comment */ 
</span>            <a href="tablecmds.c.html#LN3810"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="../../include/commands/comment.h.html#LN32"><span class='Ref_to_Proto'>CommentObject</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/parsenodes.h.html#LN2572"><span class='Ref_to_Struct'>CommentStmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1695"><span class='Ref_to_EnumConst'>AT_AddIndexConstraint</span></a><span class='Operator'>:</span>     <span class='Comment_Single_Line'>/* ADD CONSTRAINT USING INDEX */ 
</span>            <a href="tablecmds.c.html#LN3810"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN397"><span class='Ref_to_Proto'>ATExecAddIndexConstraint</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>tab</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2667"><span class='Ref_to_Struct'>IndexStmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Delimiter'>, 
</span>                                               <a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1690"><span class='Ref_to_EnumConst'>AT_AlterConstraint</span></a><span class='Operator'>:</span>        <span class='Comment_Single_Line'>/* ALTER CONSTRAINT */ 
</span>            <a href="tablecmds.c.html#LN3810"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN311"><span class='Ref_to_Proto'>ATExecAlterConstraint</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1691"><span class='Ref_to_EnumConst'>AT_ValidateConstraint</span></a><span class='Operator'>:</span>     <span class='Comment_Single_Line'>/* VALIDATE CONSTRAINT */ 
</span>            <a href="tablecmds.c.html#LN3810"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN313"><span class='Ref_to_Proto'>ATExecValidateConstraint</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1753"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                               <a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1692"><span class='Ref_to_EnumConst'>AT_ValidateConstraintRecurse</span></a><span class='Operator'>:</span>      <span class='Comment_Multi_Line'>/* VALIDATE CONSTRAINT with 
                                                 * recursion */ 
</span>            <a href="tablecmds.c.html#LN3810"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN313"><span class='Ref_to_Proto'>ATExecValidateConstraint</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1753"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                               <a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1696"><span class='Ref_to_EnumConst'>AT_DropConstraint</span></a><span class='Operator'>: </span><span class='Comment_Single_Line'>/* DROP CONSTRAINT */ 
</span>            <a href="tablecmds.c.html#LN406"><span class='Ref_to_Proto'>ATExecDropConstraint</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1753"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1758"><span class='Ref_to_Member'>behavior</span></a><span class='Delimiter'>, 
</span>                                 <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                 <a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1759"><span class='Ref_to_Member'>missing_ok</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1697"><span class='Ref_to_EnumConst'>AT_DropConstraintRecurse</span></a><span class='Operator'>:</span>  <span class='Comment_Single_Line'>/* DROP CONSTRAINT with recursion */ 
</span>            <a href="tablecmds.c.html#LN406"><span class='Ref_to_Proto'>ATExecDropConstraint</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1753"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1758"><span class='Ref_to_Member'>behavior</span></a><span class='Delimiter'>, 
</span>                                 <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                 <a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1759"><span class='Ref_to_Member'>missing_ok</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1699"><span class='Ref_to_EnumConst'>AT_AlterColumnType</span></a><span class='Operator'>:</span>        <span class='Comment_Single_Line'>/* ALTER COLUMN TYPE */ 
</span>            <a href="tablecmds.c.html#LN3810"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN415"><span class='Ref_to_Proto'>ATExecAlterColumnType</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>tab</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1700"><span class='Ref_to_EnumConst'>AT_AlterColumnGenericOptions</span></a><span class='Operator'>:</span>      <span class='Comment_Single_Line'>/* ALTER COLUMN OPTIONS */ 
</span>            <a href="tablecmds.c.html#LN3810"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= 
</span>                <a href="tablecmds.c.html#LN417"><span class='Ref_to_Proto'>ATExecAlterColumnGenericOptions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1753"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, 
</span>                                                <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1701"><span class='Ref_to_EnumConst'>AT_ChangeOwner</span></a><span class='Operator'>:</span>    <span class='Comment_Single_Line'>/* ALTER OWNER */ 
</span>            <a href="../../include/commands/tablecmds.h.html#LN35"><span class='Ref_to_Proto'>ATExecChangeOwner</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="../../include/utils/acl.h.html#LN236"><span class='Ref_to_Proto'>get_rolespec_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1755"><span class='Ref_to_Member'>newowner</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1702"><span class='Ref_to_EnumConst'>AT_ClusterOn</span></a><span class='Operator'>:</span>      <span class='Comment_Single_Line'>/* CLUSTER ON */ 
</span>            <a href="tablecmds.c.html#LN3810"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN432"><span class='Ref_to_Proto'>ATExecClusterOn</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1753"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1703"><span class='Ref_to_EnumConst'>AT_DropCluster</span></a><span class='Operator'>:</span>    <span class='Comment_Single_Line'>/* SET WITHOUT CLUSTER */ 
</span>            <a href="tablecmds.c.html#LN434"><span class='Ref_to_Proto'>ATExecDropCluster</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1704"><span class='Ref_to_EnumConst'>AT_SetLogged</span></a><span class='Operator'>:</span>      <span class='Comment_Single_Line'>/* SET LOGGED */ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1705"><span class='Ref_to_EnumConst'>AT_SetUnLogged</span></a><span class='Operator'>:</span>    <span class='Comment_Single_Line'>/* SET UNLOGGED */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1706"><span class='Ref_to_EnumConst'>AT_AddOids</span></a><span class='Operator'>:</span>        <span class='Comment_Single_Line'>/* SET WITH OIDS */ 
</span>            <span class='Comment_Multi_Line'>/* Use the ADD COLUMN code, unless prep decided to do nothing */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="tablecmds.c.html#LN3810"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= 
</span>                    <a href="tablecmds.c.html#LN355"><span class='Ref_to_Proto'>ATExecAddColumn</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>tab</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN636"><span class='Ref_to_Struct'>ColumnDef</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Delimiter'>, 
</span>                                    <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                    <a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1759"><span class='Ref_to_Member'>missing_ok</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1707"><span class='Ref_to_EnumConst'>AT_AddOidsRecurse</span></a><span class='Operator'>: </span><span class='Comment_Single_Line'>/* SET WITH OIDS */ 
</span>            <span class='Comment_Multi_Line'>/* Use the ADD COLUMN code, unless prep decided to do nothing */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="tablecmds.c.html#LN3810"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= 
</span>                    <a href="tablecmds.c.html#LN355"><span class='Ref_to_Proto'>ATExecAddColumn</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>tab</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN636"><span class='Ref_to_Struct'>ColumnDef</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Delimiter'>, 
</span>                                    <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                    <a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1759"><span class='Ref_to_Member'>missing_ok</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1708"><span class='Ref_to_EnumConst'>AT_DropOids</span></a><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* SET WITHOUT OIDS */ 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Nothing to do here; we'll have generated a DropColumn 
             * subcommand to do the real work 
             */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1709"><span class='Ref_to_EnumConst'>AT_SetTableSpace</span></a><span class='Operator'>:</span>  <span class='Comment_Single_Line'>/* SET TABLESPACE */ 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Nothing to do here; Phase 3 does the work 
             */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1710"><span class='Ref_to_EnumConst'>AT_SetRelOptions</span></a><span class='Operator'>:</span>  <span class='Comment_Single_Line'>/* SET (...) */ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1711"><span class='Ref_to_EnumConst'>AT_ResetRelOptions</span></a><span class='Operator'>:</span>        <span class='Comment_Single_Line'>/* RESET (...) */ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1712"><span class='Ref_to_EnumConst'>AT_ReplaceRelOptions</span></a><span class='Operator'>:</span>      <span class='Comment_Single_Line'>/* replace entire option list */ 
</span>            <a href="tablecmds.c.html#LN439"><span class='Ref_to_Proto'>ATExecSetRelOptions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1752"><span class='Ref_to_Member'>subtype</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1713"><span class='Ref_to_EnumConst'>AT_EnableTrig</span></a><span class='Operator'>:</span>     <span class='Comment_Single_Line'>/* ENABLE TRIGGER name */ 
</span>            <a href="tablecmds.c.html#LN442"><span class='Ref_to_Proto'>ATExecEnableDisableTrigger</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1753"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../include/commands/trigger.h.html#LN108"><span class='Ref_to_Const'>TRIGGER_FIRES_ON_ORIGIN</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1714"><span class='Ref_to_EnumConst'>AT_EnableAlwaysTrig</span></a><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* ENABLE ALWAYS TRIGGER name */ 
</span>            <a href="tablecmds.c.html#LN442"><span class='Ref_to_Proto'>ATExecEnableDisableTrigger</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1753"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, 
</span>                                       <a href="../../include/commands/trigger.h.html#LN109"><span class='Ref_to_Const'>TRIGGER_FIRES_ALWAYS</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1715"><span class='Ref_to_EnumConst'>AT_EnableReplicaTrig</span></a><span class='Operator'>:</span>      <span class='Comment_Single_Line'>/* ENABLE REPLICA TRIGGER name */ 
</span>            <a href="tablecmds.c.html#LN442"><span class='Ref_to_Proto'>ATExecEnableDisableTrigger</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1753"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/commands/trigger.h.html#LN110"><span class='Ref_to_Const'>TRIGGER_FIRES_ON_REPLICA</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1716"><span class='Ref_to_EnumConst'>AT_DisableTrig</span></a><span class='Operator'>:</span>    <span class='Comment_Single_Line'>/* DISABLE TRIGGER name */ 
</span>            <a href="tablecmds.c.html#LN442"><span class='Ref_to_Proto'>ATExecEnableDisableTrigger</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1753"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, 
</span>                                       <a href="../../include/commands/trigger.h.html#LN111"><span class='Ref_to_Const'>TRIGGER_DISABLED</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1717"><span class='Ref_to_EnumConst'>AT_EnableTrigAll</span></a><span class='Operator'>:</span>  <span class='Comment_Single_Line'>/* ENABLE TRIGGER ALL */ 
</span>            <a href="tablecmds.c.html#LN442"><span class='Ref_to_Proto'>ATExecEnableDisableTrigger</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                   <a href="../../include/commands/trigger.h.html#LN108"><span class='Ref_to_Const'>TRIGGER_FIRES_ON_ORIGIN</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1718"><span class='Ref_to_EnumConst'>AT_DisableTrigAll</span></a><span class='Operator'>: </span><span class='Comment_Single_Line'>/* DISABLE TRIGGER ALL */ 
</span>            <a href="tablecmds.c.html#LN442"><span class='Ref_to_Proto'>ATExecEnableDisableTrigger</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                       <a href="../../include/commands/trigger.h.html#LN111"><span class='Ref_to_Const'>TRIGGER_DISABLED</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1719"><span class='Ref_to_EnumConst'>AT_EnableTrigUser</span></a><span class='Operator'>: </span><span class='Comment_Single_Line'>/* ENABLE TRIGGER USER */ 
</span>            <a href="tablecmds.c.html#LN442"><span class='Ref_to_Proto'>ATExecEnableDisableTrigger</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                    <a href="../../include/commands/trigger.h.html#LN108"><span class='Ref_to_Const'>TRIGGER_FIRES_ON_ORIGIN</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1720"><span class='Ref_to_EnumConst'>AT_DisableTrigUser</span></a><span class='Operator'>:</span>        <span class='Comment_Single_Line'>/* DISABLE TRIGGER USER */ 
</span>            <a href="tablecmds.c.html#LN442"><span class='Ref_to_Proto'>ATExecEnableDisableTrigger</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                       <a href="../../include/commands/trigger.h.html#LN111"><span class='Ref_to_Const'>TRIGGER_DISABLED</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1721"><span class='Ref_to_EnumConst'>AT_EnableRule</span></a><span class='Operator'>:</span>     <span class='Comment_Single_Line'>/* ENABLE RULE name */ 
</span>            <a href="tablecmds.c.html#LN444"><span class='Ref_to_Proto'>ATExecEnableDisableRule</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1753"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, 
</span>                                    <a href="../../include/rewrite/rewriteDefine.h.html#LN20"><span class='Ref_to_Const'>RULE_FIRES_ON_ORIGIN</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1722"><span class='Ref_to_EnumConst'>AT_EnableAlwaysRule</span></a><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* ENABLE ALWAYS RULE name */ 
</span>            <a href="tablecmds.c.html#LN444"><span class='Ref_to_Proto'>ATExecEnableDisableRule</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1753"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, 
</span>                                    <a href="../../include/rewrite/rewriteDefine.h.html#LN21"><span class='Ref_to_Const'>RULE_FIRES_ALWAYS</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1723"><span class='Ref_to_EnumConst'>AT_EnableReplicaRule</span></a><span class='Operator'>:</span>      <span class='Comment_Single_Line'>/* ENABLE REPLICA RULE name */ 
</span>            <a href="tablecmds.c.html#LN444"><span class='Ref_to_Proto'>ATExecEnableDisableRule</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1753"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, 
</span>                                    <a href="../../include/rewrite/rewriteDefine.h.html#LN22"><span class='Ref_to_Const'>RULE_FIRES_ON_REPLICA</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1724"><span class='Ref_to_EnumConst'>AT_DisableRule</span></a><span class='Operator'>:</span>    <span class='Comment_Single_Line'>/* DISABLE RULE name */ 
</span>            <a href="tablecmds.c.html#LN444"><span class='Ref_to_Proto'>ATExecEnableDisableRule</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1753"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, 
</span>                                    <a href="../../include/rewrite/rewriteDefine.h.html#LN23"><span class='Ref_to_Const'>RULE_DISABLED</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1725"><span class='Ref_to_EnumConst'>AT_AddInherit</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN3810"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN447"><span class='Ref_to_Proto'>ATExecAddInherit</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1726"><span class='Ref_to_EnumConst'>AT_DropInherit</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN3810"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN448"><span class='Ref_to_Proto'>ATExecDropInherit</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1727"><span class='Ref_to_EnumConst'>AT_AddOf</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN3810"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN451"><span class='Ref_to_Proto'>ATExecAddOf</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN205"><span class='Ref_to_Struct'>TypeName</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1728"><span class='Ref_to_EnumConst'>AT_DropOf</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN452"><span class='Ref_to_Proto'>ATExecDropOf</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1729"><span class='Ref_to_EnumConst'>AT_ReplicaIdentity</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN453"><span class='Ref_to_Proto'>ATExecReplicaIdentity</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1742"><span class='Ref_to_Struct'>ReplicaIdentityStmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1730"><span class='Ref_to_EnumConst'>AT_EnableRowSecurity</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN455"><span class='Ref_to_Proto'>ATExecEnableRowSecurity</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1731"><span class='Ref_to_EnumConst'>AT_DisableRowSecurity</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN456"><span class='Ref_to_Proto'>ATExecDisableRowSecurity</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1732"><span class='Ref_to_EnumConst'>AT_ForceRowSecurity</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN457"><span class='Ref_to_Proto'>ATExecForceNoForceRowSecurity</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1733"><span class='Ref_to_EnumConst'>AT_NoForceRowSecurity</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN457"><span class='Ref_to_Proto'>ATExecForceNoForceRowSecurity</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1734"><span class='Ref_to_EnumConst'>AT_GenericOptions</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN454"><span class='Ref_to_Proto'>ATExecGenericOptions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1735"><span class='Ref_to_EnumConst'>AT_AttachPartition</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN473"><span class='Ref_to_Proto'>ATExecAttachPartition</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN829"><span class='Ref_to_Struct'>PartitionCmd</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1736"><span class='Ref_to_EnumConst'>AT_DetachPartition</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN475"><span class='Ref_to_Proto'>ATExecDetachPartition</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN3807"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Parentheses'>((</span><a href="../../include/nodes/parsenodes.h.html#LN829"><span class='Ref_to_Struct'>PartitionCmd</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>name<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>:</span>                <span class='Comment_Single_Line'>/* oops */ 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized alter table type: %d"</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1752"><span class='Ref_to_Member'>subtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch cmd-&GT;subtype &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Report the subcommand to interested event triggers. 
     */ 
</span>    <a href="../../include/commands/event_trigger.h.html#LN73"><span class='Ref_to_Proto'>EventTriggerCollectAlterTableSubcmd</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN3808"><span class='Ref_to_Parameter'>cmd</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN3810"><span class='Ref_To_Local'>address</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Bump the command counter to ensure the next subcommand in the sequence 
     * can see the changes so far 
     */ 
</span>    <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATExecCmd &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ATRewriteTables: ALTER TABLE phase 3 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4083"></a><span class='Declare_Function'>ATRewriteTables</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1662"><span class='Ref_to_Struct'>AlterTableStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parsetree</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>wqueue</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4085"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>ltab</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Go through each table that needs to be checked or rewritten */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4085"><span class='Ref_To_Local'>ltab</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="tablecmds.c.html#LN4083"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4090"></a>        <a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tab</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4085"><span class='Ref_To_Local'>ltab</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Foreign tables have no storage, nor do partitioned tables. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4090"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN157"><span class='Ref_to_Member'>relkind</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a> <span class='Operator'>|| 
</span>            <a href="tablecmds.c.html#LN4090"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN157"><span class='Ref_to_Member'>relkind</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If we change column data types or add/remove OIDs, the operation 
         * has to be propagated to tables that use this table's rowtype as a 
         * column type.  tab-&GT;newvals will also be non-NULL in the case where 
         * we're adding a column with a default.  We choose to forbid that 
         * case as well, since composite types might eventually support 
         * defaults. 
         * 
         * (Eventually we'll probably need to check for composite type 
         * dependencies even when we're just scanning the table without a 
         * rewrite, but at the moment a composite type does not enforce any 
         * constraints, so it's not necessary/appropriate to enforce them just 
         * during ALTER.) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4090"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN163"><span class='Ref_to_Member'>newvals</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>|| </span><a href="tablecmds.c.html#LN4090"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN165"><span class='Ref_to_Member'>rewrite</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN4113"></a>            <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span> 
            <a href="tablecmds.c.html#LN4113"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4090"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN156"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/commands/tablecmds.h.html#LN69"><span class='Ref_to_Proto'>find_composite_type_dependencies</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4113"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltype<span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4113"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4113"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We only need to rewrite the table if at least one column needs to 
         * be recomputed, we are adding/removing the OID column, or we are 
         * changing its persistence. 
         * 
         * There are two reasons for requiring a rewrite when changing 
         * persistence: on one hand, we need to ensure that the buffers 
         * belonging to each of the two relations are marked with or without 
         * BM_PERMANENT properly.  On the other hand, since rewriting creates 
         * and assigns a new relfilenode, we automatically create or drop an 
         * init fork for the relation as appropriate. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4090"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN165"><span class='Ref_to_Member'>rewrite</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Build a temporary relation and copy data */ 
</span><a name="LN4135"></a>            <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>OldHeap</span><span class='Delimiter'>; 
</span><a name="LN4136"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>OIDNewHeap</span><span class='Delimiter'>; 
</span><a name="LN4137"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>NewTableSpace</span><span class='Delimiter'>; 
</span><a name="LN4138"></a>            <span class='Keyword'>char</span>        <span class='Declare_Local'>persistence</span><span class='Delimiter'>; 
</span> 
            <a href="tablecmds.c.html#LN4135"><span class='Ref_To_Local'>OldHeap</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4090"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN156"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * We don't support rewriting of system catalogs; there are too 
             * many corner cases and too little benefit.  In particular this 
             * is certainly not going to work for mapped catalogs. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/catalog.h.html#LN29"><span class='Ref_to_Proto'>IsSystemRelation</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4135"><span class='Ref_To_Local'>OldHeap</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot rewrite system relation \"%s\""</span><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4135"><span class='Ref_To_Local'>OldHeap</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN315"><span class='Ref_to_Macro'>RelationIsUsedAsCatalogTable</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4135"><span class='Ref_To_Local'>OldHeap</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot rewrite table \"%s\" used as a catalog table"</span><span class='Delimiter'>, 
</span>                       <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4135"><span class='Ref_To_Local'>OldHeap</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Don't allow rewrite on temp tables of other backends ... their 
             * local buffer manager is not going to cope. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN533"><span class='Ref_to_Macro'>RELATION_IS_OTHER_TEMP</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4135"><span class='Ref_To_Local'>OldHeap</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot rewrite temporary tables of other sessions"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Select destination tablespace (same as original unless user 
             * requested a change) 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4090"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN166"><span class='Ref_to_Member'>newTableSpace</span></a><span class='Parentheses'>) 
</span>                <a href="tablecmds.c.html#LN4137"><span class='Ref_To_Local'>NewTableSpace</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN4090"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN166"><span class='Ref_to_Member'>newTableSpace</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="tablecmds.c.html#LN4137"><span class='Ref_To_Local'>NewTableSpace</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN4135"><span class='Ref_To_Local'>OldHeap</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltablespace<span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Select persistence of transient table (same as original unless 
             * user requested a change) 
             */ 
</span>            <a href="tablecmds.c.html#LN4138"><span class='Ref_To_Local'>persistence</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN4090"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN167"><span class='Ref_to_Member'>chgPersistence</span></a> <span class='Operator'>? 
</span>                <a href="tablecmds.c.html#LN4090"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN168"><span class='Ref_to_Member'>newrelpersistence</span></a> <span class='Operator'>: </span><a href="tablecmds.c.html#LN4135"><span class='Ref_To_Local'>OldHeap</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpersistence<span class='Delimiter'>; 
</span> 
            <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4135"><span class='Ref_To_Local'>OldHeap</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Fire off an Event Trigger now, before actually rewriting the 
             * table. 
             * 
             * We don't support Event Trigger for nested commands anywhere, 
             * here included, and parsetree is given NULL when coming from 
             * AlterTableInternal. 
             * 
             * And fire it only once. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4083"><span class='Ref_to_Parameter'>parsetree</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/commands/event_trigger.h.html#LN56"><span class='Ref_to_Proto'>EventTriggerTableRewrite</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN4083"><span class='Ref_to_Parameter'>parsetree</span></a><span class='Delimiter'>, 
</span>                                         <a href="tablecmds.c.html#LN4090"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN156"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, 
</span>                                         <a href="tablecmds.c.html#LN4090"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN165"><span class='Ref_to_Member'>rewrite</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Create transient table that will receive the modified data. 
             * 
             * Ensure it is marked correctly as logged or unlogged.  We have 
             * to do this here so that buffers for the new relfilenode will 
             * have the right persistence set, and at the same time ensure 
             * that the original filenode's buffers will get read in with the 
             * correct setting (i.e. the original one).  Otherwise a rollback 
             * after the rewrite would possibly result with buffers for the 
             * original filenode having the wrong persistence setting. 
             * 
             * NB: This relies on swap_relation_files() also swapping the 
             * persistence. That wouldn't work for pg_class, but that can't be 
             * unlogged anyway. 
             */ 
</span>            <a href="tablecmds.c.html#LN4136"><span class='Ref_To_Local'>OIDNewHeap</span></a> <span class='Operator'>= </span><a href="../../include/commands/cluster.h.html#LN27"><span class='Ref_to_Proto'>make_new_heap</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4090"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN156"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4137"><span class='Ref_To_Local'>NewTableSpace</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4138"><span class='Ref_To_Local'>persistence</span></a><span class='Delimiter'>, 
</span>                                       <a href="tablecmds.c.html#LN4083"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Copy the heap data into the new table with the desired 
             * modifications, and test the current data within the table 
             * against new constraints generated by ALTER TABLE commands. 
             */ 
</span>            <a href="tablecmds.c.html#LN343"><span class='Ref_to_Proto'>ATRewriteTable</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4090"><span class='Ref_To_Local'>tab</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4136"><span class='Ref_To_Local'>OIDNewHeap</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4083"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Swap the physical files of the old and new heaps, then rebuild 
             * indexes and discard the old heap.  We can use RecentXmin for 
             * the table's new relfrozenxid because we rewrote all the tuples 
             * in ATRewriteTable, so no older Xid remains in the table.  Also, 
             * we never try to swap toast tables by content, since we have no 
             * interest in letting this code work on system catalogs. 
             */ 
</span>            <a href="../../include/commands/cluster.h.html#LN29"><span class='Ref_to_Proto'>finish_heap_swap</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4090"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN156"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4136"><span class='Ref_To_Local'>OIDNewHeap</span></a><span class='Delimiter'>, 
</span>                             <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                             <span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4090"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN166"><span class='Ref_to_Member'>newTableSpace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/time/snapmgr.c.html#LN164"><span class='Ref_to_Global_Var'>RecentXmin</span></a><span class='Delimiter'>, 
</span>                             <a href="../../include/access/multixact.h.html#LN109"><span class='Ref_to_Proto'>ReadNextMultiXactId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                             <a href="tablecmds.c.html#LN4138"><span class='Ref_To_Local'>persistence</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if tab-&GT;rewrite&GT;0 &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Test the current data within the table against new constraints 
             * generated by ALTER TABLE commands, but don't rebuild data. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4090"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN162"><span class='Ref_to_Member'>constraints</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>|| </span><a href="tablecmds.c.html#LN4090"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN164"><span class='Ref_to_Member'>new_notnull</span></a> <span class='Operator'>|| 
</span>                <a href="tablecmds.c.html#LN4090"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN169"><span class='Ref_to_Member'>partition_constraint</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="tablecmds.c.html#LN343"><span class='Ref_to_Proto'>ATRewriteTable</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4090"><span class='Ref_To_Local'>tab</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4083"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If we had SET TABLESPACE but no reason to reconstruct tuples, 
             * just do a block-by-block copy. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4090"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN166"><span class='Ref_to_Member'>newTableSpace</span></a><span class='Parentheses'>) 
</span>                <a href="tablecmds.c.html#LN438"><span class='Ref_to_Proto'>ATExecSetTableSpace</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4090"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN156"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4090"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN166"><span class='Ref_to_Member'>newTableSpace</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4083"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Foreign key constraints are checked in a final pass, since (a) it's 
     * generally best to examine each one separately, and (b) it's at least 
     * theoretically possible that we have changed both relations of the 
     * foreign key, and we'd better have finished both rewrites before we try 
     * to read the tables. 
     */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4085"><span class='Ref_To_Local'>ltab</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="tablecmds.c.html#LN4083"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4269"></a>        <a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tab</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4085"><span class='Ref_To_Local'>ltab</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4270"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN4271"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lcon</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4271"><span class='Ref_To_Local'>lcon</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4269"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN162"><span class='Ref_to_Member'>constraints</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN4275"></a>            <a href="tablecmds.c.html#LN179"><span class='Ref_to_Struct'>NewConstraint</span></a> <span class='Operator'>*</span><span class='Declare_Local'>con</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4271"><span class='Ref_To_Local'>lcon</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4275"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN182"><span class='Ref_to_Member'>contype</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN2031"><span class='Ref_to_EnumConst'>CONSTR_FOREIGN</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN4279"></a>                <a href="../../include/nodes/parsenodes.h.html#LN2050"><span class='Ref_to_Struct'>Constraint</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fkconstraint</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2050"><span class='Ref_to_Struct'>Constraint</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN4275"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN186"><span class='Ref_to_Member'>qual</span></a><span class='Delimiter'>; 
</span><a name="LN4280"></a>                <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>refrel</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4270"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* Long since locked, no need for another */ 
</span>                    <a href="tablecmds.c.html#LN4270"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4269"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN156"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <a href="tablecmds.c.html#LN4280"><span class='Ref_To_Local'>refrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4275"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN183"><span class='Ref_to_Member'>refrelid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN36"><span class='Ref_to_Const'>RowShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="tablecmds.c.html#LN328"><span class='Ref_to_Proto'>validateForeignKeyConstraint</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4279"><span class='Ref_To_Local'>fkconstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2056"><span class='Ref_to_Member'>conname</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4270"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4280"><span class='Ref_To_Local'>refrel</span></a><span class='Delimiter'>, 
</span>                                             <a href="tablecmds.c.html#LN4275"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN184"><span class='Ref_to_Member'>refindid</span></a><span class='Delimiter'>, 
</span>                                             <a href="tablecmds.c.html#LN4275"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN185"><span class='Ref_to_Member'>conid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * No need to mark the constraint row as validated, we did 
                 * that when we inserted the row earlier. 
                 */ 
</span> 
                <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4280"><span class='Ref_To_Local'>refrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if con-&GT;contype==CONSTR_... &raquo; </span> 
        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4270"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4270"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end ATRewriteTables &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ATRewriteTable: scan or rewrite one table 
 * 
 * OIDNewHeap is InvalidOid if we don't need to rewrite 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4314"></a><span class='Declare_Function'>ATRewriteTable</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tab</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>OIDNewHeap</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4316"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>oldrel</span><span class='Delimiter'>; 
</span><a name="LN4317"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>newrel</span><span class='Delimiter'>; 
</span><a name="LN4318"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>oldTupDesc</span><span class='Delimiter'>; 
</span><a name="LN4319"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>newTupDesc</span><span class='Delimiter'>; 
</span><a name="LN4320"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>needscan</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN4321"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>notnull_attrs</span><span class='Delimiter'>; 
</span><a name="LN4322"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN4323"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span><a name="LN4324"></a>    <a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>estate</span><span class='Delimiter'>; 
</span><a name="LN4325"></a>    <a href="../../include/c.h.html#LN410"><span class='Ref_to_Typedef'>CommandId</span></a>   <span class='Declare_Local'>mycid</span><span class='Delimiter'>; 
</span><a name="LN4326"></a>    <a href="../../include/access/heapam.h.html#LN32"><span class='Ref_to_Typedef'>BulkInsertState</span></a> <span class='Declare_Local'>bistate</span><span class='Delimiter'>; 
</span><a name="LN4327"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>hi_options</span><span class='Delimiter'>; 
</span><a name="LN4328"></a>    <a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>partqualstate</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Open the relation(s).  We have surely already locked the existing 
     * table. 
     */ 
</span>    <a href="tablecmds.c.html#LN4316"><span class='Ref_To_Local'>oldrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4314"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN156"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN4318"><span class='Ref_To_Local'>oldTupDesc</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN4314"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN158"><span class='Ref_to_Member'>oldDesc</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN4319"><span class='Ref_To_Local'>newTupDesc</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4316"><span class='Ref_To_Local'>oldrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* includes all mods */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4314"><span class='Ref_to_Parameter'>OIDNewHeap</span></a><span class='Parentheses'>))</span> 
        <a href="tablecmds.c.html#LN4317"><span class='Ref_To_Local'>newrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4314"><span class='Ref_to_Parameter'>OIDNewHeap</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4314"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="tablecmds.c.html#LN4317"><span class='Ref_To_Local'>newrel</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Prepare a BulkInsertState and options for heap_insert. Because we're 
     * building a new heap, we can skip WAL-logging and fsync it to disk at 
     * the end instead (unless WAL-logging is required for archiving or 
     * streaming replication). The FSM is empty too, so don't bother using it. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4317"><span class='Ref_To_Local'>newrel</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN4325"><span class='Ref_To_Local'>mycid</span></a> <span class='Operator'>= </span><a href="../../include/access/xact.h.html#LN339"><span class='Ref_to_Proto'>GetCurrentCommandId</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN4326"><span class='Ref_To_Local'>bistate</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN147"><span class='Ref_to_Proto'>GetBulkInsertState</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN4327"><span class='Ref_To_Local'>hi_options</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN28"><span class='Ref_to_Const'>HEAP_INSERT_SKIP_FSM</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/xlog.h.html#LN144"><span class='Ref_to_Macro'>XLogIsNeeded</span></a><span class='Parentheses'>())</span> 
            <a href="tablecmds.c.html#LN4327"><span class='Ref_To_Local'>hi_options</span></a> <span class='Operator'>|= </span><a href="../../include/access/heapam.h.html#LN27"><span class='Ref_to_Const'>HEAP_INSERT_SKIP_WAL</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* keep compiler quiet about using these uninitialized */ 
</span>        <a href="tablecmds.c.html#LN4325"><span class='Ref_To_Local'>mycid</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN4326"><span class='Ref_To_Local'>bistate</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN4327"><span class='Ref_To_Local'>hi_options</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Generate the constraint and default execution states 
     */ 
</span> 
    <a href="tablecmds.c.html#LN4324"><span class='Ref_To_Local'>estate</span></a> <span class='Operator'>= </span><a href="../executor/execUtils.c.html#LN78"><span class='Ref_to_Func'>CreateExecutorState</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build the needed expression execution states */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4323"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4314"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN162"><span class='Ref_to_Member'>constraints</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4375"></a>        <a href="tablecmds.c.html#LN179"><span class='Ref_to_Struct'>NewConstraint</span></a> <span class='Operator'>*</span><span class='Declare_Local'>con</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4323"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4375"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN182"><span class='Ref_to_Member'>contype</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2027"><span class='Ref_to_EnumConst'>CONSTR_CHECK</span></a><span class='Operator'>: 
</span>                <a href="tablecmds.c.html#LN4320"><span class='Ref_To_Local'>needscan</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN4375"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN187"><span class='Ref_to_Member'>qualstate</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN246"><span class='Ref_to_Proto'>ExecPrepareExpr</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN4375"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN186"><span class='Ref_to_Member'>qual</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4324"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2031"><span class='Ref_to_EnumConst'>CONSTR_FOREIGN</span></a><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* Nothing to do here */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized constraint type: %d"</span><span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN4375"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN182"><span class='Ref_to_Member'>contype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Build expression execution states for partition check quals */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4314"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN169"><span class='Ref_to_Member'>partition_constraint</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN4320"><span class='Ref_To_Local'>needscan</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN4328"><span class='Ref_To_Local'>partqualstate</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN246"><span class='Ref_to_Proto'>ExecPrepareExpr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4314"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN169"><span class='Ref_to_Member'>partition_constraint</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4324"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4323"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4314"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN163"><span class='Ref_to_Member'>newvals</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4401"></a>        <a href="tablecmds.c.html#LN197"><span class='Ref_to_Struct'>NewColumnValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ex</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4323"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* expr already planned */ 
</span>        <a href="tablecmds.c.html#LN4401"><span class='Ref_To_Local'>ex</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN201"><span class='Ref_to_Member'>exprstate</span></a> <span class='Operator'>= </span><a href="../executor/execExpr.c.html#LN111"><span class='Ref_to_Func'>ExecInitExpr</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN4401"><span class='Ref_To_Local'>ex</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN200"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="tablecmds.c.html#LN4321"><span class='Ref_To_Local'>notnull_attrs</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4317"><span class='Ref_To_Local'>newrel</span></a> <span class='Operator'>|| </span><a href="tablecmds.c.html#LN4314"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN164"><span class='Ref_to_Member'>new_notnull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * If we are rebuilding the tuples OR if we added any new NOT NULL 
         * constraints, check all not-null constraints.  This is a bit of 
         * overkill but it minimizes risk of bugs, and heap_attisnull is a 
         * pretty cheap test anyway. 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4322"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN4322"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tablecmds.c.html#LN4319"><span class='Ref_To_Local'>newTupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN4322"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4319"><span class='Ref_To_Local'>newTupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN4322"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attnotnull <span class='Operator'>&& 
</span>                <span class='Operator'>!</span><a href="tablecmds.c.html#LN4319"><span class='Ref_To_Local'>newTupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN4322"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>                <a href="tablecmds.c.html#LN4321"><span class='Ref_To_Local'>notnull_attrs</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN144"><span class='Ref_to_Func'>lappend_int</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4321"><span class='Ref_To_Local'>notnull_attrs</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4322"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4321"><span class='Ref_To_Local'>notnull_attrs</span></a><span class='Parentheses'>) 
</span>            <a href="tablecmds.c.html#LN4320"><span class='Ref_To_Local'>needscan</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4317"><span class='Ref_To_Local'>newrel</span></a> <span class='Operator'>|| </span><a href="tablecmds.c.html#LN4320"><span class='Ref_To_Local'>needscan</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4428"></a>        <a href="../../include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>econtext</span><span class='Delimiter'>; 
</span><a name="LN4429"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>values</span><span class='Delimiter'>; 
</span><a name="LN4430"></a>        <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN4431"></a>        <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>oldslot</span><span class='Delimiter'>; 
</span><a name="LN4432"></a>        <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>newslot</span><span class='Delimiter'>; 
</span><a name="LN4433"></a>        <a href="../../include/access/heapam.h.html#LN99"><span class='Ref_to_Typedef'>HeapScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN4434"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN4435"></a>        <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldCxt</span><span class='Delimiter'>; 
</span><a name="LN4436"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>dropped_attrs</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN4437"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span><a name="LN4438"></a>        <a href="../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a>    <span class='Declare_Local'>snapshot</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4317"><span class='Ref_To_Local'>newrel</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN24"><span class='Ref_to_Const'>DEBUG1</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"rewriting table \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4316"><span class='Ref_To_Local'>oldrel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN24"><span class='Ref_to_Const'>DEBUG1</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"verifying table \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4316"><span class='Ref_To_Local'>oldrel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4317"><span class='Ref_To_Local'>newrel</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * All predicate locks on the tuples or pages are about to be made 
             * invalid, because we move tuples around.  Promote them to 
             * relation locks. 
             */ 
</span>            <a href="../../include/storage/predicate.h.html#LN55"><span class='Ref_to_Proto'>TransferPredicateLocksToHeapRelation</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4316"><span class='Ref_To_Local'>oldrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="tablecmds.c.html#LN4428"><span class='Ref_To_Local'>econtext</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN455"><span class='Ref_to_Macro'>GetPerTupleExprContext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4324"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Make tuple slots for old and new tuples.  Note that even when the 
         * tuples are the same, the tupDescs might not be (consider ADD COLUMN 
         * without a default). 
         */ 
</span>        <a href="tablecmds.c.html#LN4431"><span class='Ref_To_Local'>oldslot</span></a> <span class='Operator'>= </span><a href="../../include/executor/tuptable.h.html#LN144"><span class='Ref_to_Proto'>MakeSingleTupleTableSlot</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4318"><span class='Ref_To_Local'>oldTupDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN4432"><span class='Ref_To_Local'>newslot</span></a> <span class='Operator'>= </span><a href="../../include/executor/tuptable.h.html#LN144"><span class='Ref_to_Proto'>MakeSingleTupleTableSlot</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4319"><span class='Ref_To_Local'>newTupDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Preallocate values/isnull arrays */ 
</span>        <a href="tablecmds.c.html#LN4322"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4319"><span class='Ref_To_Local'>newTupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4318"><span class='Ref_To_Local'>oldTupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN4429"><span class='Ref_To_Local'>values</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4322"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN4430"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4322"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memset<span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4429"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4322"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memset<span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4430"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4322"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Any attributes that are dropped according to the new tuple 
         * descriptor can be set to NULL. We precompute the list of dropped 
         * attributes to avoid needing to do so in the per-tuple loop. 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4322"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN4322"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tablecmds.c.html#LN4319"><span class='Ref_To_Local'>newTupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN4322"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4319"><span class='Ref_To_Local'>newTupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN4322"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>                <a href="tablecmds.c.html#LN4436"><span class='Ref_To_Local'>dropped_attrs</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN144"><span class='Ref_to_Func'>lappend_int</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4436"><span class='Ref_To_Local'>dropped_attrs</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4322"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Scan through the rows, generating a new row if needed and then 
         * checking all the constraints. 
         */ 
</span>        <a href="tablecmds.c.html#LN4438"><span class='Ref_To_Local'>snapshot</span></a> <span class='Operator'>= </span><a href="../../include/utils/snapmgr.h.html#LN80"><span class='Ref_to_Proto'>RegisterSnapshot</span></a><span class='Parentheses'>(</span><a href="../../include/utils/snapmgr.h.html#LN64"><span class='Ref_to_Proto'>GetLatestSnapshot</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN4433"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN108"><span class='Ref_to_Proto'>heap_beginscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4316"><span class='Ref_To_Local'>oldrel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4438"><span class='Ref_To_Local'>snapshot</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Switch to per-tuple memory context and reset it for each tuple 
         * produced, so we don't leak memory. 
         */ 
</span>        <a href="tablecmds.c.html#LN4435"><span class='Ref_To_Local'>oldCxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../../include/executor/executor.h.html#LN460"><span class='Ref_to_Macro'>GetPerTupleMemoryContext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4324"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="tablecmds.c.html#LN4434"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN127"><span class='Ref_to_Proto'>heap_getnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4433"><span class='Ref_To_Local'>scan</span></a><span class='Delimiter'>, </span><a href="../../include/access/sdir.h.html#LN25"><span class='Ref_to_EnumConst'>ForwardScanDirection</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4314"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN165"><span class='Ref_to_Member'>rewrite</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN4504"></a>                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tupOid</span> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Extract data from old tuple */ 
</span>                <a href="../../include/access/htup_details.h.html#LN813"><span class='Ref_to_Proto'>heap_deform_tuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4434"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4318"><span class='Ref_To_Local'>oldTupDesc</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4429"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4513"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4318"><span class='Ref_To_Local'>oldTupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN78"><span class='Ref_to_Member'>tdhasoid</span></a><span class='Parentheses'>) 
</span>                    <a href="tablecmds.c.html#LN4504"><span class='Ref_To_Local'>tupOid</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4434"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Set dropped attributes to null in new tuple */ 
</span>                <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4437"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4436"><span class='Ref_To_Local'>dropped_attrs</span></a><span class='Parentheses'>) 
</span><a name="LN4513"></a>                    <span class='Declare_Local'>isnull</span><span class='Delimiter'>[</span><a href="../../include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4437"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Process supplied expressions to replace selected columns. 
                 * Expression inputs come from the old tuple. 
                 */ 
</span>                <a href="../../include/executor/tuptable.h.html#LN147"><span class='Ref_to_Proto'>ExecStoreTuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4434"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4431"><span class='Ref_To_Local'>oldslot</span></a><span class='Delimiter'>, </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN4428"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN196"><span class='Ref_to_Member'>ecxt_scantuple</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN4431"><span class='Ref_To_Local'>oldslot</span></a><span class='Delimiter'>; 
</span> 
                <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4323"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4314"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN163"><span class='Ref_to_Member'>newvals</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN4524"></a>                    <a href="tablecmds.c.html#LN197"><span class='Ref_to_Struct'>NewColumnValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ex</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4323"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="tablecmds.c.html#LN4429"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN4524"><span class='Ref_To_Local'>ex</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN199"><span class='Ref_to_Member'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN264"><span class='Ref_to_Func'>ExecEvalExpr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4524"><span class='Ref_To_Local'>ex</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN201"><span class='Ref_to_Member'>exprstate</span></a><span class='Delimiter'>, 
</span>                                                          <a href="tablecmds.c.html#LN4428"><span class='Ref_To_Local'>econtext</span></a><span class='Delimiter'>, 
</span>                                                    <span class='Operator'>&</span><a href="tablecmds.c.html#LN4513"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN4524"><span class='Ref_To_Local'>ex</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN199"><span class='Ref_to_Member'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Form the new tuple. Note that we don't explicitly pfree it, 
                 * since the per-tuple memory context will be reset shortly. 
                 */ 
</span>                <a href="tablecmds.c.html#LN4434"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4319"><span class='Ref_To_Local'>newTupDesc</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4429"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4513"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Preserve OID, if any */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4319"><span class='Ref_To_Local'>newTupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN78"><span class='Ref_to_Member'>tdhasoid</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/access/htup_details.h.html#LN697"><span class='Ref_to_Macro'>HeapTupleSetOid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4434"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4504"><span class='Ref_To_Local'>tupOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Constraints might reference the tableoid column, so 
                 * initialize t_tableOid before evaluating them. 
                 */ 
</span>                <a href="tablecmds.c.html#LN4434"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4316"><span class='Ref_To_Local'>oldrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if tab-&GT;rewrite&GT;0 &raquo; </span> 
 
            <span class='Comment_Multi_Line'>/* Now check any constraints on the possibly-changed tuple */ 
</span>            <a href="../../include/executor/tuptable.h.html#LN147"><span class='Ref_to_Proto'>ExecStoreTuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4434"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4432"><span class='Ref_To_Local'>newslot</span></a><span class='Delimiter'>, </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN4428"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN196"><span class='Ref_to_Member'>ecxt_scantuple</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN4432"><span class='Ref_To_Local'>newslot</span></a><span class='Delimiter'>; 
</span> 
            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4323"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4321"><span class='Ref_To_Local'>notnull_attrs</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN4554"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>attn</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4323"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../access/common/heaptuple.c.html#LN295"><span class='Ref_to_Func'>heap_attisnull</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4434"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4554"><span class='Ref_To_Local'>attn</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>))</span> 
                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NOT_NULL_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" contains null values"</span><span class='Delimiter'>, 
</span>                                  <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4319"><span class='Ref_To_Local'>newTupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN4554"><span class='Ref_To_Local'>attn</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                             <a href="../../include/utils/relcache.h.html#LN77"><span class='Ref_to_Proto'>errtablecol</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4316"><span class='Ref_To_Local'>oldrel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4554"><span class='Ref_To_Local'>attn</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4323"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4314"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN162"><span class='Ref_to_Member'>constraints</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN4566"></a>                <a href="tablecmds.c.html#LN179"><span class='Ref_to_Struct'>NewConstraint</span></a> <span class='Operator'>*</span><span class='Declare_Local'>con</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4323"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4566"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN182"><span class='Ref_to_Member'>contype</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2027"><span class='Ref_to_EnumConst'>CONSTR_CHECK</span></a><span class='Operator'>: 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/executor/executor.h.html#LN366"><span class='Ref_to_Proto'>ExecCheck</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4566"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN187"><span class='Ref_to_Member'>qualstate</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4428"><span class='Ref_To_Local'>econtext</span></a><span class='Parentheses'>))</span> 
                            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CHECK_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"check constraint \"%s\" is violated by some row"</span><span class='Delimiter'>, 
</span>                                            <a href="tablecmds.c.html#LN4566"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN181"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="../../include/utils/relcache.h.html#LN79"><span class='Ref_to_Proto'>errtableconstraint</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4316"><span class='Ref_To_Local'>oldrel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4566"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN181"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2031"><span class='Ref_to_EnumConst'>CONSTR_FOREIGN</span></a><span class='Operator'>: 
</span>                        <span class='Comment_Multi_Line'>/* Nothing to do here */ 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>default</span><span class='Operator'>: 
</span>                        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized constraint type: %d"</span><span class='Delimiter'>, 
</span>                             <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN4566"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN182"><span class='Ref_to_Member'>contype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4328"><span class='Ref_To_Local'>partqualstate</span></a> <span class='Operator'>&& !</span><a href="../../include/executor/executor.h.html#LN366"><span class='Ref_to_Proto'>ExecCheck</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4328"><span class='Ref_To_Local'>partqualstate</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4428"><span class='Ref_To_Local'>econtext</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CHECK_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"partition constraint is violated by some row"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Write the tuple out to the new relation */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4317"><span class='Ref_To_Local'>newrel</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/access/heapam.h.html#LN151"><span class='Ref_to_Proto'>heap_insert</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4317"><span class='Ref_To_Local'>newrel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4434"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4325"><span class='Ref_To_Local'>mycid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4327"><span class='Ref_To_Local'>hi_options</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4326"><span class='Ref_To_Local'>bistate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/executor/executor.h.html#LN449"><span class='Ref_to_Macro'>ResetExprContext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4428"><span class='Ref_To_Local'>econtext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (tuple=heap_getnext(s... &raquo; </span> 
 
        <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4435"><span class='Ref_To_Local'>oldCxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/access/heapam.h.html#LN126"><span class='Ref_to_Proto'>heap_endscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4433"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/snapmgr.h.html#LN81"><span class='Ref_to_Proto'>UnregisterSnapshot</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4438"><span class='Ref_To_Local'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/executor/tuptable.h.html#LN145"><span class='Ref_to_Proto'>ExecDropSingleTupleTableSlot</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4431"><span class='Ref_To_Local'>oldslot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/executor/tuptable.h.html#LN145"><span class='Ref_to_Proto'>ExecDropSingleTupleTableSlot</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4432"><span class='Ref_To_Local'>newslot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if newrel||needscan &raquo; </span> 
 
    <a href="../executor/execUtils.c.html#LN176"><span class='Ref_to_Func'>FreeExecutorState</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4324"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4316"><span class='Ref_To_Local'>oldrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4317"><span class='Ref_To_Local'>newrel</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/access/heapam.h.html#LN148"><span class='Ref_to_Proto'>FreeBulkInsertState</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4326"><span class='Ref_To_Local'>bistate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* If we skipped writing WAL, then we need to sync the heap. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4327"><span class='Ref_To_Local'>hi_options</span></a> <span class='Operator'>& </span><a href="../../include/access/heapam.h.html#LN27"><span class='Ref_to_Const'>HEAP_INSERT_SKIP_WAL</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/access/heapam.h.html#LN180"><span class='Ref_to_Proto'>heap_sync</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4317"><span class='Ref_To_Local'>newrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4317"><span class='Ref_To_Local'>newrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end ATRewriteTable &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ATGetQueueEntry: find or create an entry in the ALTER TABLE work queue 
 */ 
</span><span class='Keyword'>static </span><a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>* 
</span><a name="LN4628"></a><span class='Declare_Function'>ATGetQueueEntry</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>wqueue</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4630"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4628"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4631"></a>    <a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tab</span><span class='Delimiter'>; 
</span><a name="LN4632"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>ltab</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4632"><span class='Ref_To_Local'>ltab</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="tablecmds.c.html#LN4628"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN4631"><span class='Ref_To_Local'>tab</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4632"><span class='Ref_To_Local'>ltab</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4631"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN156"><span class='Ref_to_Member'>relid</span></a> <span class='Operator'>== </span><a href="tablecmds.c.html#LN4630"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="tablecmds.c.html#LN4631"><span class='Ref_To_Local'>tab</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Not there, so add it.  Note that we make a copy of the relation's 
     * existing descriptor before anything interesting can happen to it. 
     */ 
</span>    <a href="tablecmds.c.html#LN4631"><span class='Ref_To_Local'>tab</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN4631"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN156"><span class='Ref_to_Member'>relid</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN4630"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN4631"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN157"><span class='Ref_to_Member'>relkind</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN4628"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind<span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN4631"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN158"><span class='Ref_to_Member'>oldDesc</span></a> <span class='Operator'>= </span><a href="../../include/access/tupdesc.h.html#LN88"><span class='Ref_to_Proto'>CreateTupleDescCopy</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4628"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN4631"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN168"><span class='Ref_to_Member'>newrelpersistence</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_class.h.html#LN169"><span class='Ref_to_Const'>RELPERSISTENCE_PERMANENT</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN4631"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN167"><span class='Ref_to_Member'>chgPersistence</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="tablecmds.c.html#LN4628"><span class='Ref_to_Parameter'>wqueue</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="tablecmds.c.html#LN4628"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4631"><span class='Ref_To_Local'>tab</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN4631"><span class='Ref_To_Local'>tab</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATGetQueueEntry &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ATSimplePermissions 
 * 
 * - Ensure that it is a relation (or possibly a view) 
 * - Ensure this user is the owner 
 * - Ensure that it is not a system table 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4665"></a><span class='Declare_Function'>ATSimplePermissions</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>allowed_targets</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4667"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>actual_target</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4665"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN4667"><span class='Ref_To_Local'>actual_target</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN163"><span class='Ref_to_Const'>RELKIND_VIEW</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN4667"><span class='Ref_To_Local'>actual_target</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN279"><span class='Ref_to_Const'>ATT_VIEW</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN4667"><span class='Ref_To_Local'>actual_target</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN280"><span class='Ref_to_Const'>ATT_MATVIEW</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN160"><span class='Ref_to_Const'>RELKIND_INDEX</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN4667"><span class='Ref_To_Local'>actual_target</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN281"><span class='Ref_to_Const'>ATT_INDEX</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN165"><span class='Ref_to_Const'>RELKIND_COMPOSITE_TYPE</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN4667"><span class='Ref_To_Local'>actual_target</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN282"><span class='Ref_to_Const'>ATT_COMPOSITE_TYPE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN4667"><span class='Ref_To_Local'>actual_target</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN283"><span class='Ref_to_Const'>ATT_FOREIGN_TABLE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN4667"><span class='Ref_To_Local'>actual_target</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch rel-&GT;rd_rel-&GT;relkind &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Wrong target type? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="tablecmds.c.html#LN4667"><span class='Ref_To_Local'>actual_target</span></a> <span class='Operator'>& </span><a href="tablecmds.c.html#LN4665"><span class='Ref_to_Parameter'>allowed_targets</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="tablecmds.c.html#LN346"><span class='Ref_to_Proto'>ATWrongRelkindError</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4665"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4665"><span class='Ref_to_Parameter'>allowed_targets</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Permissions checks */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN308"><span class='Ref_to_Proto'>pg_class_ownercheck</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4665"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN181"><span class='Ref_to_EnumConst'>ACL_KIND_CLASS</span></a><span class='Delimiter'>, 
</span>                       <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4665"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/init/globals.c.html#LN111"><span class='Ref_to_Global_Var'>allowSystemTableMods</span></a> <span class='Operator'>&& </span><a href="../../include/catalog/catalog.h.html#LN29"><span class='Ref_to_Proto'>IsSystemRelation</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4665"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied: \"%s\" is a system catalog"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4665"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATSimplePermissions &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ATWrongRelkindError 
 * 
 * Throw an error when a relation has been determined to be of the wrong 
 * type. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4718"></a><span class='Declare_Function'>ATWrongRelkindError</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>allowed_targets</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4720"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>msg</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4718"><span class='Ref_to_Parameter'>allowed_targets</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN4720"><span class='Ref_To_Local'>msg</span></a> <span class='Operator'>= </span>_<span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a table"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN279"><span class='Ref_to_Const'>ATT_VIEW</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN4720"><span class='Ref_To_Local'>msg</span></a> <span class='Operator'>= </span>_<span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a table or view"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN279"><span class='Ref_to_Const'>ATT_VIEW</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN283"><span class='Ref_to_Const'>ATT_FOREIGN_TABLE</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN4720"><span class='Ref_To_Local'>msg</span></a> <span class='Operator'>= </span>_<span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a table, view, or foreign table"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN279"><span class='Ref_to_Const'>ATT_VIEW</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN280"><span class='Ref_to_Const'>ATT_MATVIEW</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN281"><span class='Ref_to_Const'>ATT_INDEX</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN4720"><span class='Ref_To_Local'>msg</span></a> <span class='Operator'>= </span>_<span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a table, view, materialized view, or index"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN280"><span class='Ref_to_Const'>ATT_MATVIEW</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN4720"><span class='Ref_To_Local'>msg</span></a> <span class='Operator'>= </span>_<span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a table or materialized view"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN280"><span class='Ref_to_Const'>ATT_MATVIEW</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN281"><span class='Ref_to_Const'>ATT_INDEX</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN4720"><span class='Ref_To_Local'>msg</span></a> <span class='Operator'>= </span>_<span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a table, materialized view, or index"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN280"><span class='Ref_to_Const'>ATT_MATVIEW</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN283"><span class='Ref_to_Const'>ATT_FOREIGN_TABLE</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN4720"><span class='Ref_To_Local'>msg</span></a> <span class='Operator'>= </span>_<span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a table, materialized view, or foreign table"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN283"><span class='Ref_to_Const'>ATT_FOREIGN_TABLE</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN4720"><span class='Ref_To_Local'>msg</span></a> <span class='Operator'>= </span>_<span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a table or foreign table"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN282"><span class='Ref_to_Const'>ATT_COMPOSITE_TYPE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN283"><span class='Ref_to_Const'>ATT_FOREIGN_TABLE</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN4720"><span class='Ref_To_Local'>msg</span></a> <span class='Operator'>= </span>_<span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a table, composite type, or foreign table"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN280"><span class='Ref_to_Const'>ATT_MATVIEW</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN281"><span class='Ref_to_Const'>ATT_INDEX</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN283"><span class='Ref_to_Const'>ATT_FOREIGN_TABLE</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN4720"><span class='Ref_To_Local'>msg</span></a> <span class='Operator'>= </span>_<span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a table, materialized view, index, or foreign table"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="tablecmds.c.html#LN279"><span class='Ref_to_Const'>ATT_VIEW</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN4720"><span class='Ref_To_Local'>msg</span></a> <span class='Operator'>= </span>_<span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a view"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="tablecmds.c.html#LN283"><span class='Ref_to_Const'>ATT_FOREIGN_TABLE</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN4720"><span class='Ref_To_Local'>msg</span></a> <span class='Operator'>= </span>_<span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a foreign table"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* shouldn't get here, add all necessary cases above */ 
</span>            <a href="tablecmds.c.html#LN4720"><span class='Ref_To_Local'>msg</span></a> <span class='Operator'>= </span>_<span class='Parentheses'>(</span><span class='String'>"\"%s\" is of the wrong type"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch allowed_targets &raquo; </span> 
 
    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4720"><span class='Ref_To_Local'>msg</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4718"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATWrongRelkindError &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ATSimpleRecursion 
 * 
 * Simple table recursion sufficient for most ALTER TABLE operations. 
 * All direct and indirect children are processed in an unspecified order. 
 * Note that if a child inherits from the original table via multiple 
 * inheritance paths, it will be visited just once. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4780"></a><span class='Declare_Function'>ATSimpleRecursion</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>wqueue</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN4781"></a>                  <a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cmd</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recurse</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * Propagate to children if desired.  Only plain tables and foreign tables 
     * have children, so no need to search for other relkinds. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4781"><span class='Ref_to_Parameter'>recurse</span></a> <span class='Operator'>&& 
</span>        <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4780"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a> <span class='Operator'>|| 
</span>         <a href="tablecmds.c.html#LN4780"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a> <span class='Operator'>|| 
</span>         <a href="tablecmds.c.html#LN4780"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN4792"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4780"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4793"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>child</span><span class='Delimiter'>; 
</span><a name="LN4794"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>children</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN4794"><span class='Ref_To_Local'>children</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_inherits_fn.h.html#LN20"><span class='Ref_to_Proto'>find_all_inheritors</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4792"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4781"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * find_all_inheritors does the recursive search of the inheritance 
         * hierarchy, so all we have to do is process all of the relids in the 
         * list that it returns. 
         */ 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4793"><span class='Ref_To_Local'>child</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4794"><span class='Ref_To_Local'>children</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN4805"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>childrelid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4793"><span class='Ref_To_Local'>child</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4806"></a>            <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>childrel</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4805"><span class='Ref_To_Local'>childrelid</span></a> <span class='Operator'>== </span><a href="tablecmds.c.html#LN4792"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* find_all_inheritors already got lock */ 
</span>            <a href="tablecmds.c.html#LN4806"><span class='Ref_To_Local'>childrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN84"><span class='Ref_to_Proto'>relation_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4805"><span class='Ref_To_Local'>childrelid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/commands/tablecmds.h.html#LN52"><span class='Ref_to_Proto'>CheckTableNotInUse</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4806"><span class='Ref_To_Local'>childrel</span></a><span class='Delimiter'>, </span><span class='String'>"ALTER TABLE"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN336"><span class='Ref_to_Proto'>ATPrepCmd</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4780"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4806"><span class='Ref_To_Local'>childrel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4781"><span class='Ref_to_Parameter'>cmd</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4781"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4806"><span class='Ref_To_Local'>childrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if recurse&&(rel-&GT;rd_rel... &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end ATSimpleRecursion &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ATTypedTableRecursion 
 * 
 * Propagate ALTER TYPE operations to the typed tables of that type. 
 * Also check the RESTRICT/CASCADE behavior.  Given CASCADE, also permit 
 * recursion to inheritance children of the typed tables. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4827"></a><span class='Declare_Function'>ATTypedTableRecursion</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>wqueue</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cmd</span><span class='Delimiter'>, 
</span><a name="LN4828"></a>                      <a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4830"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>child</span><span class='Delimiter'>; 
</span><a name="LN4831"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>children</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4827"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN165"><span class='Ref_to_Const'>RELKIND_COMPOSITE_TYPE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN4831"><span class='Ref_To_Local'>children</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN351"><span class='Ref_to_Proto'>find_typed_table_dependencies</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4827"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltype<span class='Delimiter'>, 
</span>                                             <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4827"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                             <a href="tablecmds.c.html#LN4827"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1758"><span class='Ref_to_Member'>behavior</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4830"><span class='Ref_To_Local'>child</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4831"><span class='Ref_To_Local'>children</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4841"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>childrelid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4830"><span class='Ref_To_Local'>child</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4842"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>childrel</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN4842"><span class='Ref_To_Local'>childrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN84"><span class='Ref_to_Proto'>relation_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4841"><span class='Ref_To_Local'>childrelid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4828"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/commands/tablecmds.h.html#LN52"><span class='Ref_to_Proto'>CheckTableNotInUse</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4842"><span class='Ref_To_Local'>childrel</span></a><span class='Delimiter'>, </span><span class='String'>"ALTER TABLE"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN336"><span class='Ref_to_Proto'>ATPrepCmd</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4827"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4842"><span class='Ref_To_Local'>childrel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4827"><span class='Ref_to_Parameter'>cmd</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4828"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4842"><span class='Ref_To_Local'>childrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end ATTypedTableRecursion &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * find_composite_type_dependencies 
 * 
 * Check to see if a composite type is being used as a column in some 
 * other table (possibly nested several levels deep in composite types!). 
 * Eventually, we'd like to propagate the check or rewrite operation 
 * into other such tables, but for now, just error out if we find any. 
 * 
 * Caller should provide either a table name or a type name (not both) to 
 * report in the error message, if any. 
 * 
 * We assume that functions and views depending on the type are not reasons 
 * to reject the ALTER.  (How safe is this really?) 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN4867"></a><span class='Declare_Function'>find_composite_type_dependencies</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeOid</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>origRelation</span><span class='Delimiter'>, 
</span><a name="LN4868"></a>                                 <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>origTypeName</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4870"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>depRel</span><span class='Delimiter'>; 
</span><a name="LN4871"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN4872"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>depScan</span><span class='Delimiter'>; 
</span><a name="LN4873"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>depTup</span><span class='Delimiter'>; 
</span><a name="LN4874"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>arrayOid</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We scan pg_depend to find those things that depend on the rowtype. (We 
     * assume we can ignore refobjsubid for a rowtype.) 
     */ 
</span>    <a href="tablecmds.c.html#LN4870"><span class='Ref_To_Local'>depRel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_depend.h.html#LN28"><span class='Ref_to_Const'>DependRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN4871"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN70"><span class='Ref_to_Const'>Anum_pg_depend_refclassid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN4871"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN71"><span class='Ref_to_Const'>Anum_pg_depend_refobjid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4867"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN4872"><span class='Ref_To_Local'>depScan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4870"><span class='Ref_To_Local'>depRel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN146"><span class='Ref_to_Const'>DependReferenceIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                 <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4871"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4873"><span class='Ref_To_Local'>depTup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4872"><span class='Ref_To_Local'>depScan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN4896"></a>        <a href="../../include/catalog/pg_depend.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_depend</span></a> <span class='Declare_Local'>pg_depend</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_depend.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_depend</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4873"><span class='Ref_To_Local'>depTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4897"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN4898"></a>        <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>att</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Ignore dependees that aren't user columns of relations */ 
</span>        <span class='Comment_Multi_Line'>/* (we assume system columns are never of rowtypes) */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4896"><span class='Ref_To_Local'>pg_depend</span></a><span class='Operator'>-&GT;</span>classid <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a> <span class='Operator'>|| 
</span>            <a href="tablecmds.c.html#LN4896"><span class='Ref_To_Local'>pg_depend</span></a><span class='Operator'>-&GT;</span>objsubid <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN4897"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN84"><span class='Ref_to_Proto'>relation_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4896"><span class='Ref_To_Local'>pg_depend</span></a><span class='Operator'>-&GT;</span>objid<span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN4898"><span class='Ref_To_Local'>att</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN4897"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN4896"><span class='Ref_To_Local'>pg_depend</span></a><span class='Operator'>-&GT;</span>objsubid <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4897"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a> <span class='Operator'>|| 
</span>            <a href="tablecmds.c.html#LN4897"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a> <span class='Operator'>|| 
</span>            <a href="tablecmds.c.html#LN4897"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4868"><span class='Ref_to_Parameter'>origTypeName</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot alter type \"%s\" because column \"%s.%s\" uses it"</span><span class='Delimiter'>, 
</span>                                <a href="tablecmds.c.html#LN4868"><span class='Ref_to_Parameter'>origTypeName</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4897"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4898"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4867"><span class='Ref_to_Parameter'>origRelation</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN165"><span class='Ref_to_Const'>RELKIND_COMPOSITE_TYPE</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot alter type \"%s\" because column \"%s.%s\" uses it"</span><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4867"><span class='Ref_to_Parameter'>origRelation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4897"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4898"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4867"><span class='Ref_to_Parameter'>origRelation</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot alter foreign table \"%s\" because column \"%s.%s\" uses its row type"</span><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4867"><span class='Ref_to_Parameter'>origRelation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4897"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4898"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot alter table \"%s\" because column \"%s.%s\" uses its row type"</span><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4867"><span class='Ref_to_Parameter'>origRelation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4897"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4898"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if rel-&GT;rd_rel-&GT;relkind=... &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4897"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltype<span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * A view or composite type itself isn't a problem, but we must 
             * recursively check for indirect dependencies via its rowtype. 
             */ 
</span>            <a href="../../include/commands/tablecmds.h.html#LN69"><span class='Ref_to_Proto'>find_composite_type_dependencies</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4897"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltype<span class='Delimiter'>, 
</span>                                             <a href="tablecmds.c.html#LN4867"><span class='Ref_to_Parameter'>origRelation</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4868"><span class='Ref_to_Parameter'>origTypeName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4897"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while HeapTupleIsValid(depT... &raquo; </span> 
 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4872"><span class='Ref_To_Local'>depScan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4870"><span class='Ref_To_Local'>depRel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If there's an array type for the rowtype, must check for uses of it, 
     * too. 
     */ 
</span>    <a href="tablecmds.c.html#LN4874"><span class='Ref_To_Local'>arrayOid</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN158"><span class='Ref_to_Proto'>get_array_type</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4867"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4874"><span class='Ref_To_Local'>arrayOid</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/commands/tablecmds.h.html#LN69"><span class='Ref_to_Proto'>find_composite_type_dependencies</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4874"><span class='Ref_To_Local'>arrayOid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4867"><span class='Ref_to_Parameter'>origRelation</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4868"><span class='Ref_to_Parameter'>origTypeName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end find_composite_type_dependencies &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * find_typed_table_dependencies 
 * 
 * Check to see if a composite type is being used as the type of a 
 * typed table.  Abort if any are found and behavior is RESTRICT. 
 * Else return the list of tables. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN4977"></a><span class='Declare_Function'>find_typed_table_dependencies</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeOid</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>typeName</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1652"><span class='Ref_to_Enum'>DropBehavior</span></a> <span class='Declare_Parameter'>behavior</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4979"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>classRel</span><span class='Delimiter'>; 
</span><a name="LN4980"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN4981"></a>    <a href="../../include/access/heapam.h.html#LN99"><span class='Ref_to_Typedef'>HeapScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN4982"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN4983"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN4979"><span class='Ref_To_Local'>classRel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN4980"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_class.h.html#LN105"><span class='Ref_to_Const'>Anum_pg_class_reloftype</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4977"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN4981"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN110"><span class='Ref_to_Proto'>heap_beginscan_catalog</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4979"><span class='Ref_To_Local'>classRel</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN4980"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="tablecmds.c.html#LN4982"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN127"><span class='Ref_to_Proto'>heap_getnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4981"><span class='Ref_To_Local'>scan</span></a><span class='Delimiter'>, </span><a href="../../include/access/sdir.h.html#LN25"><span class='Ref_to_EnumConst'>ForwardScanDirection</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4977"><span class='Ref_to_Parameter'>behavior</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN1654"><span class='Ref_to_EnumConst'>DROP_RESTRICT</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DEPENDENT_OBJECTS_STILL_EXIST<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot alter type \"%s\" because it is the type of a typed table"</span><span class='Delimiter'>, 
</span>                            <a href="tablecmds.c.html#LN4977"><span class='Ref_to_Parameter'>typeName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Use ALTER ... CASCADE to alter the typed tables too."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="tablecmds.c.html#LN4983"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4983"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4982"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/heapam.h.html#LN126"><span class='Ref_to_Proto'>heap_endscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4981"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN4979"><span class='Ref_To_Local'>classRel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN4983"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end find_typed_table_dependencies &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * check_of_type 
 * 
 * Check whether a type is suitable for CREATE TABLE OF/ALTER TABLE OF.  If it 
 * isn't suitable, throw an error.  Currently, we require that the type 
 * originated with CREATE TYPE AS.  We could support any row type, but doing so 
 * would require handling a number of extra corner cases in the DDL commands. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN5022"></a><span class='Declare_Function'>check_of_type</span><span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>typetuple</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5024"></a>    <a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a> <span class='Declare_Local'>typ</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5022"><span class='Ref_to_Parameter'>typetuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN5025"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>typeOk</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5024"><span class='Ref_To_Local'>typ</span></a><span class='Operator'>-&GT;</span>typtype <span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN720"><span class='Ref_to_Const'>TYPTYPE_COMPOSITE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5029"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>typeRelation</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5024"><span class='Ref_To_Local'>typ</span></a><span class='Operator'>-&GT;</span>typrelid<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN5029"><span class='Ref_To_Local'>typeRelation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN84"><span class='Ref_to_Proto'>relation_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5024"><span class='Ref_To_Local'>typ</span></a><span class='Operator'>-&GT;</span>typrelid<span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN5025"><span class='Ref_To_Local'>typeOk</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5029"><span class='Ref_To_Local'>typeRelation</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN165"><span class='Ref_to_Const'>RELKIND_COMPOSITE_TYPE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Close the parent rel, but keep our AccessShareLock on it until xact 
         * commit.  That will prevent someone else from deleting or ALTERing 
         * the type before the typed table creation/conversion commits. 
         */ 
</span>        <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5029"><span class='Ref_To_Local'>typeRelation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN5025"><span class='Ref_To_Local'>typeOk</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"type %s is not a composite type"</span><span class='Delimiter'>, 
</span>                        <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5022"><span class='Ref_to_Parameter'>typetuple</span></a><span class='Parentheses'>)))))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end check_of_type &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * ALTER TABLE ADD COLUMN 
 * 
 * Adds an additional attribute to a relation making the assumption that 
 * CHECK, NOT NULL, and FOREIGN KEY constraints will be removed from the 
 * AT_AddColumn AlterTableCmd by parse_utilcmd.c and added as independent 
 * AlterTableCmd's. 
 * 
 * ADD COLUMN cannot use the normal ALTER TABLE recursion mechanism, because we 
 * have to decide at runtime whether to recurse or not depending on whether we 
 * actually add a column or merely merge with an existing column.  (We can't 
 * check this in a static pre-pass because it won't handle multiple inheritance 
 * situations correctly.) 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN5065"></a><span class='Declare_Function'>ATPrepAddColumn</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>wqueue</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recurse</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recursing</span><span class='Delimiter'>, 
</span><a name="LN5066"></a>                <span class='Keyword'>bool </span><span class='Declare_Parameter'>is_view</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cmd</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5065"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reloftype <span class='Operator'>&& !</span><a href="tablecmds.c.html#LN5065"><span class='Ref_to_Parameter'>recursing</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot add column to typed table"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5065"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN165"><span class='Ref_to_Const'>RELKIND_COMPOSITE_TYPE</span></a><span class='Parentheses'>) 
</span>        <a href="tablecmds.c.html#LN349"><span class='Ref_to_Proto'>ATTypedTableRecursion</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5065"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5065"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5066"><span class='Ref_to_Parameter'>cmd</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5066"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5065"><span class='Ref_to_Parameter'>recurse</span></a> <span class='Operator'>&& !</span><a href="tablecmds.c.html#LN5066"><span class='Ref_to_Parameter'>is_view</span></a><span class='Parentheses'>) 
</span>        <a href="tablecmds.c.html#LN5066"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1752"><span class='Ref_to_Member'>subtype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN1674"><span class='Ref_to_EnumConst'>AT_AddColumnRecurse</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Add a column to a table; this handles the AT_AddOids cases as well.  The 
 * return value is the address of the new column in the parent relation. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN5085"></a><span class='Declare_Function'>ATExecAddColumn</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>wqueue</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tab</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN5086"></a>                <a href="../../include/nodes/parsenodes.h.html#LN636"><span class='Ref_to_Struct'>ColumnDef</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>colDef</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isOid</span><span class='Delimiter'>, 
</span><a name="LN5087"></a>                <span class='Keyword'>bool </span><span class='Declare_Parameter'>recurse</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recursing</span><span class='Delimiter'>, 
</span><a name="LN5088"></a>                <span class='Keyword'>bool </span><span class='Declare_Parameter'>if_not_exists</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5090"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>myrelid</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5085"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN5091"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pgclass</span><span class='Delimiter'>, 
</span><a name="LN5092"></a>                <span class='Declare_Local'>attrdesc</span><span class='Delimiter'>; 
</span><a name="LN5093"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>reltup</span><span class='Delimiter'>; 
</span><a name="LN5094"></a>    FormData_pg_attribute <span class='Declare_Local'>attribute</span><span class='Delimiter'>; 
</span><a name="LN5095"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>newattnum</span><span class='Delimiter'>; 
</span><a name="LN5096"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>relkind</span><span class='Delimiter'>; 
</span><a name="LN5097"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>typeTuple</span><span class='Delimiter'>; 
</span><a name="LN5098"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typeOid</span><span class='Delimiter'>; 
</span><a name="LN5099"></a>    <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>typmod</span><span class='Delimiter'>; 
</span><a name="LN5100"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>collOid</span><span class='Delimiter'>; 
</span><a name="LN5101"></a>    <a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a> <span class='Declare_Local'>tform</span><span class='Delimiter'>; 
</span><a name="LN5102"></a>    <a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>defval</span><span class='Delimiter'>; 
</span><a name="LN5103"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>children</span><span class='Delimiter'>; 
</span><a name="LN5104"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>child</span><span class='Delimiter'>; 
</span><a name="LN5105"></a>    <a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span><a name="LN5106"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* At top level, permission check was done in ATPrepCmd, else do it */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5087"><span class='Ref_to_Parameter'>recursing</span></a><span class='Parentheses'>) 
</span>        <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5085"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN283"><span class='Ref_to_Const'>ATT_FOREIGN_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5085"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relispartition <span class='Operator'>&& !</span><a href="tablecmds.c.html#LN5087"><span class='Ref_to_Parameter'>recursing</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot add column to a partition"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN5092"><span class='Ref_To_Local'>attrdesc</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN32"><span class='Ref_to_Const'>AttributeRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Are we adding the column to a recursion child?  If so, check whether to 
     * merge with an existing definition for the column.  If we do merge, we 
     * must not recurse.  Children will already have the column, and recursing 
     * into them would mess up attinhcount. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5086"><span class='Ref_to_Parameter'>colDef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN641"><span class='Ref_to_Member'>inhcount</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5127"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Does child already have a column by this name? */ 
</span>        <a href="tablecmds.c.html#LN5127"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN130"><span class='Ref_to_Proto'>SearchSysCacheCopyAttName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5090"><span class='Ref_To_Local'>myrelid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5086"><span class='Ref_to_Parameter'>colDef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN639"><span class='Ref_to_Member'>colname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5127"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN5133"></a>            <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>childatt</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5127"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN5134"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ctypeId</span><span class='Delimiter'>; 
</span><a name="LN5135"></a>            <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>ctypmod</span><span class='Delimiter'>; 
</span><a name="LN5136"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ccollid</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Child column must match on type, typmod, and collation */ 
</span>            <a href="../../include/parser/parse_type.h.html#LN28"><span class='Ref_to_Proto'>typenameTypeIdAndMod</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5086"><span class='Ref_to_Parameter'>colDef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN640"><span class='Ref_to_Member'>typeName</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN5134"><span class='Ref_To_Local'>ctypeId</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN5135"><span class='Ref_To_Local'>ctypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5134"><span class='Ref_To_Local'>ctypeId</span></a> <span class='Operator'>!= </span><a href="tablecmds.c.html#LN5133"><span class='Ref_To_Local'>childatt</span></a><span class='Operator'>-&GT;</span>atttypid <span class='Operator'>|| 
</span>                <a href="tablecmds.c.html#LN5135"><span class='Ref_To_Local'>ctypmod</span></a> <span class='Operator'>!= </span><a href="tablecmds.c.html#LN5133"><span class='Ref_To_Local'>childatt</span></a><span class='Operator'>-&GT;</span>atttypmod<span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"child table \"%s\" has different type for column \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5085"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5086"><span class='Ref_to_Parameter'>colDef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN639"><span class='Ref_to_Member'>colname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN5136"><span class='Ref_To_Local'>ccollid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN35"><span class='Ref_to_Proto'>GetColumnDefCollation</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5086"><span class='Ref_to_Parameter'>colDef</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5134"><span class='Ref_To_Local'>ctypeId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5136"><span class='Ref_To_Local'>ccollid</span></a> <span class='Operator'>!= </span><a href="tablecmds.c.html#LN5133"><span class='Ref_To_Local'>childatt</span></a><span class='Operator'>-&GT;</span>attcollation<span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_COLLATION_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"child table \"%s\" has different collation for column \"%s\""</span><span class='Delimiter'>, 
</span>                              <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5085"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5086"><span class='Ref_to_Parameter'>colDef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN639"><span class='Ref_to_Member'>colname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" versus \"%s\""</span><span class='Delimiter'>, 
</span>                                   <a href="../../include/utils/lsyscache.h.html#LN93"><span class='Ref_to_Proto'>get_collation_name</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5136"><span class='Ref_To_Local'>ccollid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                               <a href="../../include/utils/lsyscache.h.html#LN93"><span class='Ref_to_Proto'>get_collation_name</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5133"><span class='Ref_To_Local'>childatt</span></a><span class='Operator'>-&GT;</span>attcollation<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* If it's OID, child column must actually be OID */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5086"><span class='Ref_to_Parameter'>isOid</span></a> <span class='Operator'>&& </span><a href="tablecmds.c.html#LN5133"><span class='Ref_To_Local'>childatt</span></a><span class='Operator'>-&GT;</span>attnum <span class='Operator'>!= </span><a href="../../include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"child table \"%s\" has a conflicting \"%s\" column"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5085"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5086"><span class='Ref_to_Parameter'>colDef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN639"><span class='Ref_to_Member'>colname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Bump the existing child att's inhcount */ 
</span>            <a href="tablecmds.c.html#LN5133"><span class='Ref_To_Local'>childatt</span></a><span class='Operator'>-&GT;</span>attinhcount<span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5092"><span class='Ref_To_Local'>attrdesc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN5127"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5127"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5127"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Inform the user about the merge */ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>              <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"merging definition of column \"%s\" for child \"%s\""</span><span class='Delimiter'>, 
</span>                      <a href="tablecmds.c.html#LN5086"><span class='Ref_to_Parameter'>colDef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN639"><span class='Ref_to_Member'>colname</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5085"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5092"><span class='Ref_To_Local'>attrdesc</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="../catalog/objectaddress.c.html#LN718"><span class='Ref_to_Global_Var'>InvalidObjectAddress</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if HeapTupleIsValid(tupl... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if colDef-&GT;inhcount&GT;0 &raquo; </span> 
 
    <a href="tablecmds.c.html#LN5091"><span class='Ref_To_Local'>pgclass</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN5093"><span class='Ref_To_Local'>reltup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5090"><span class='Ref_To_Local'>myrelid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5093"><span class='Ref_To_Local'>reltup</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for relation %u"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5090"><span class='Ref_To_Local'>myrelid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN5096"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5093"><span class='Ref_To_Local'>reltup</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>relkind<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Cannot add identity column if table has children, because identity does 
     * not inherit.  (Adding column and identity separately will work.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5086"><span class='Ref_to_Parameter'>colDef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN649"><span class='Ref_to_Member'>identity</span></a> <span class='Operator'>&& 
</span>        <a href="tablecmds.c.html#LN5087"><span class='Ref_to_Parameter'>recurse</span></a> <span class='Operator'>&& 
</span>        <a href="../../include/catalog/pg_inherits_fn.h.html#LN19"><span class='Ref_to_Proto'>find_inheritance_children</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5090"><span class='Ref_To_Local'>myrelid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TABLE_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot recursively add identity column to table that has child tables"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* skip if the name already exists and if_not_exists is true */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN359"><span class='Ref_to_Proto'>check_for_column_name_collision</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5085"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5086"><span class='Ref_to_Parameter'>colDef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN639"><span class='Ref_to_Member'>colname</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5088"><span class='Ref_to_Parameter'>if_not_exists</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5092"><span class='Ref_To_Local'>attrdesc</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5093"><span class='Ref_To_Local'>reltup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5091"><span class='Ref_To_Local'>pgclass</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../catalog/objectaddress.c.html#LN718"><span class='Ref_to_Global_Var'>InvalidObjectAddress</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Determine the new attribute's number */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5086"><span class='Ref_to_Parameter'>isOid</span></a><span class='Parentheses'>) 
</span>        <a href="tablecmds.c.html#LN5095"><span class='Ref_To_Local'>newattnum</span></a> <span class='Operator'>= </span><a href="../../include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN5095"><span class='Ref_To_Local'>newattnum</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5093"><span class='Ref_To_Local'>reltup</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>relnatts <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5095"><span class='Ref_To_Local'>newattnum</span></a> <span class='Operator'>&GT; </span><a href="../../include/access/htup_details.h.html#LN46"><span class='Ref_to_Const'>MaxHeapAttributeNumber</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_TOO_MANY_COLUMNS<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"tables can have at most %d columns"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/access/htup_details.h.html#LN46"><span class='Ref_to_Const'>MaxHeapAttributeNumber</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="tablecmds.c.html#LN5097"><span class='Ref_To_Local'>typeTuple</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN25"><span class='Ref_to_Proto'>typenameType</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5086"><span class='Ref_to_Parameter'>colDef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN640"><span class='Ref_to_Member'>typeName</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN5099"><span class='Ref_To_Local'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN5101"><span class='Ref_To_Local'>tform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5097"><span class='Ref_To_Local'>typeTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN5098"><span class='Ref_To_Local'>typeOid</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5097"><span class='Ref_To_Local'>typeTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN5105"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN293"><span class='Ref_to_Proto'>pg_type_aclcheck</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5098"><span class='Ref_To_Local'>typeOid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5105"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/acl.h.html#LN301"><span class='Ref_to_Proto'>aclcheck_error_type</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5105"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5098"><span class='Ref_To_Local'>typeOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN5100"><span class='Ref_To_Local'>collOid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN35"><span class='Ref_to_Proto'>GetColumnDefCollation</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5086"><span class='Ref_to_Parameter'>colDef</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5098"><span class='Ref_To_Local'>typeOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* make sure datatype is legal for a column */ 
</span>    <a href="../../include/catalog/heap.h.html#LN131"><span class='Ref_to_Proto'>CheckAttributeType</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5086"><span class='Ref_to_Parameter'>colDef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN639"><span class='Ref_to_Member'>colname</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5098"><span class='Ref_To_Local'>typeOid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5100"><span class='Ref_To_Local'>collOid</span></a><span class='Delimiter'>, 
</span>                       <a href="../../include/nodes/pg_list.h.html#LN150"><span class='Ref_to_Macro'>list_make1_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5085"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltype<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                       <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* construct new attribute's pg_attribute entry */ 
</span>    <a href="tablecmds.c.html#LN5094"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>.</span>attrelid <span class='Operator'>= </span><a href="tablecmds.c.html#LN5090"><span class='Ref_To_Local'>myrelid</span></a><span class='Delimiter'>; 
</span>    <a href="../../include/utils/builtins.h.html#LN40"><span class='Ref_to_Proto'>namestrcpy</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5094"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>.</span>attname<span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5086"><span class='Ref_to_Parameter'>colDef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN639"><span class='Ref_to_Member'>colname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN5094"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>.</span>atttypid <span class='Operator'>= </span><a href="tablecmds.c.html#LN5098"><span class='Ref_To_Local'>typeOid</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN5094"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>.</span>attstattarget <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5095"><span class='Ref_To_Local'>newattnum</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? -</span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN5094"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>.</span>attlen <span class='Operator'>= </span><a href="tablecmds.c.html#LN5101"><span class='Ref_To_Local'>tform</span></a><span class='Operator'>-&GT;</span>typlen<span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN5094"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>.</span>attcacheoff <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN5094"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>.</span>atttypmod <span class='Operator'>= </span><a href="tablecmds.c.html#LN5099"><span class='Ref_To_Local'>typmod</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN5094"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>.</span>attnum <span class='Operator'>= </span><a href="tablecmds.c.html#LN5095"><span class='Ref_To_Local'>newattnum</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN5094"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>.</span>attbyval <span class='Operator'>= </span><a href="tablecmds.c.html#LN5101"><span class='Ref_To_Local'>tform</span></a><span class='Operator'>-&GT;</span>typbyval<span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN5094"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>.</span>attndims <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5086"><span class='Ref_to_Parameter'>colDef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN640"><span class='Ref_to_Member'>typeName</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN214"><span class='Ref_to_Member'>arrayBounds</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN5094"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>.</span>attstorage <span class='Operator'>= </span><a href="tablecmds.c.html#LN5101"><span class='Ref_To_Local'>tform</span></a><span class='Operator'>-&GT;</span>typstorage<span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN5094"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>.</span>attalign <span class='Operator'>= </span><a href="tablecmds.c.html#LN5101"><span class='Ref_To_Local'>tform</span></a><span class='Operator'>-&GT;</span>typalign<span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN5094"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>.</span>attnotnull <span class='Operator'>= </span><a href="tablecmds.c.html#LN5086"><span class='Ref_to_Parameter'>colDef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN643"><span class='Ref_to_Member'>is_not_null</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN5094"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>.</span>atthasdef <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN5094"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>.</span>attidentity <span class='Operator'>= </span><a href="tablecmds.c.html#LN5086"><span class='Ref_to_Parameter'>colDef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN649"><span class='Ref_to_Member'>identity</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN5094"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>.</span>attisdropped <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN5094"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>.</span>attislocal <span class='Operator'>= </span><a href="tablecmds.c.html#LN5086"><span class='Ref_to_Parameter'>colDef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN642"><span class='Ref_to_Member'>is_local</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN5094"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>.</span>attinhcount <span class='Operator'>= </span><a href="tablecmds.c.html#LN5086"><span class='Ref_to_Parameter'>colDef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN641"><span class='Ref_to_Member'>inhcount</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN5094"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>.</span>attcollation <span class='Operator'>= </span><a href="tablecmds.c.html#LN5100"><span class='Ref_To_Local'>collOid</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* attribute.attacl is handled by InsertPgAttributeTuple */ 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5097"><span class='Ref_To_Local'>typeTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/heap.h.html#LN87"><span class='Ref_to_Proto'>InsertPgAttributeTuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5092"><span class='Ref_To_Local'>attrdesc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN5094"><span class='Ref_To_Local'>attribute</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5092"><span class='Ref_To_Local'>attrdesc</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Update pg_class tuple as appropriate 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5086"><span class='Ref_to_Parameter'>isOid</span></a><span class='Parentheses'>) 
</span>        <span class='Parentheses'>((</span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5093"><span class='Ref_To_Local'>reltup</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>relhasoids <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Parentheses'>((</span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5093"><span class='Ref_To_Local'>reltup</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>relnatts <span class='Operator'>= </span><a href="tablecmds.c.html#LN5095"><span class='Ref_To_Local'>newattnum</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5091"><span class='Ref_To_Local'>pgclass</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN5093"><span class='Ref_To_Local'>reltup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5093"><span class='Ref_To_Local'>reltup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5093"><span class='Ref_To_Local'>reltup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Post creation hook for new attribute */ 
</span>    <a href="../../include/catalog/objectaccess.h.html#LN144"><span class='Ref_to_Macro'>InvokeObjectPostCreateHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5090"><span class='Ref_To_Local'>myrelid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5095"><span class='Ref_To_Local'>newattnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5091"><span class='Ref_To_Local'>pgclass</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make the attribute's catalog entry visible */ 
</span>    <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Store the DEFAULT, if any, in the catalogs 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5086"><span class='Ref_to_Parameter'>colDef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN647"><span class='Ref_to_Member'>raw_default</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5287"></a>        <a href="../../include/catalog/heap.h.html#LN21"><span class='Ref_to_Struct'>RawColumnDefault</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rawEnt</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN5287"><span class='Ref_To_Local'>rawEnt</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/heap.h.html#LN21"><span class='Ref_to_Struct'>RawColumnDefault</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/catalog/heap.h.html#LN21"><span class='Ref_to_Struct'>RawColumnDefault</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN5287"><span class='Ref_To_Local'>rawEnt</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/heap.h.html#LN23"><span class='Ref_to_Member'>attnum</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN5094"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>.</span>attnum<span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN5287"><span class='Ref_To_Local'>rawEnt</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/heap.h.html#LN24"><span class='Ref_to_Member'>raw_default</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5086"><span class='Ref_to_Parameter'>colDef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN647"><span class='Ref_to_Member'>raw_default</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * This function is intended for CREATE TABLE, so it processes a 
         * _list_ of defaults, but we just do one. 
         */ 
</span>        <a href="../../include/catalog/heap.h.html#LN97"><span class='Ref_to_Proto'>AddRelationNewConstraints</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5085"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5287"><span class='Ref_To_Local'>rawEnt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, 
</span>                                  <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Make the additional catalog changes visible */ 
</span>        <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Tell Phase 3 to fill in the default expression, if there is one. 
     * 
     * If there is no default, Phase 3 doesn't have to do anything, because 
     * that effectively means that the default is NULL.  The heap tuple access 
     * routines always check for attnum &GT; # of attributes in tuple, and return 
     * NULL if so, so without any modification of the tuple data we will get 
     * the effect of NULL values in the new column. 
     * 
     * An exception occurs when the new column is of a domain type: the domain 
     * might have a NOT NULL constraint, or a check constraint that indirectly 
     * rejects nulls.  If there are any domain constraints then we construct 
     * an explicit NULL default value that will be passed through 
     * CoerceToDomain processing.  (This is a tad inefficient, since it causes 
     * rewriting the table which we really don't have to do, but the present 
     * design of domain processing doesn't offer any simple way of checking 
     * the constraints more directly.) 
     * 
     * Note: we use build_column_default, and not just the cooked default 
     * returned by AddRelationNewConstraints, so that the right thing happens 
     * when a datatype's default applies. 
     * 
     * We skip this step completely for views and foreign tables.  For a view, 
     * we can only get here from CREATE OR REPLACE VIEW, which historically 
     * doesn't set up defaults, not even for domain-typed columns.  And in any 
     * case we mustn't invoke Phase 3 on a view or foreign table, since they 
     * have no storage. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5096"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN163"><span class='Ref_to_Const'>RELKIND_VIEW</span></a> <span class='Operator'>&& </span><a href="tablecmds.c.html#LN5096"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN165"><span class='Ref_to_Const'>RELKIND_COMPOSITE_TYPE</span></a> 
        <span class='Operator'>&& </span><a href="tablecmds.c.html#LN5096"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a> <span class='Operator'>&& </span><a href="tablecmds.c.html#LN5094"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>.</span>attnum <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN5102"><span class='Ref_To_Local'>defval</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/rewrite/rewriteHandler.h.html#LN24"><span class='Ref_to_Proto'>build_column_default</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5085"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5094"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>.</span>attnum<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN5102"><span class='Ref_To_Local'>defval</span></a> <span class='Operator'>&& </span><a href="../../include/utils/typcache.h.html#LN149"><span class='Ref_to_Proto'>DomainHasConstraints</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5098"><span class='Ref_To_Local'>typeOid</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN5339"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>baseTypeId</span><span class='Delimiter'>; 
</span><a name="LN5340"></a>            <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>baseTypeMod</span><span class='Delimiter'>; 
</span><a name="LN5341"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>baseTypeColl</span><span class='Delimiter'>; 
</span> 
            <a href="tablecmds.c.html#LN5340"><span class='Ref_To_Local'>baseTypeMod</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN5099"><span class='Ref_To_Local'>typmod</span></a><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN5339"><span class='Ref_To_Local'>baseTypeId</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN169"><span class='Ref_to_Proto'>getBaseTypeAndTypmod</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5098"><span class='Ref_To_Local'>typeOid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN5340"><span class='Ref_To_Local'>baseTypeMod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN5341"><span class='Ref_To_Local'>baseTypeColl</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN166"><span class='Ref_to_Proto'>get_typcollation</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5339"><span class='Ref_To_Local'>baseTypeId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN5102"><span class='Ref_To_Local'>defval</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/makefuncs.h.html#LN57"><span class='Ref_to_Proto'>makeNullConst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5339"><span class='Ref_To_Local'>baseTypeId</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5340"><span class='Ref_To_Local'>baseTypeMod</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5341"><span class='Ref_To_Local'>baseTypeColl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN5102"><span class='Ref_To_Local'>defval</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/parser/parse_coerce.h.html#LN37"><span class='Ref_to_Proto'>coerce_to_target_type</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                                    <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN5102"><span class='Ref_To_Local'>defval</span></a><span class='Delimiter'>, 
</span>                                                    <a href="tablecmds.c.html#LN5339"><span class='Ref_To_Local'>baseTypeId</span></a><span class='Delimiter'>, 
</span>                                                    <a href="tablecmds.c.html#LN5098"><span class='Ref_To_Local'>typeOid</span></a><span class='Delimiter'>, 
</span>                                                    <a href="tablecmds.c.html#LN5099"><span class='Ref_To_Local'>typmod</span></a><span class='Delimiter'>, 
</span>                                                    <a href="../../include/nodes/primnodes.h.html#LN421"><span class='Ref_to_EnumConst'>COERCION_ASSIGNMENT</span></a><span class='Delimiter'>, 
</span>                                                    <a href="../../include/nodes/primnodes.h.html#LN438"><span class='Ref_to_EnumConst'>COERCE_IMPLICIT_CAST</span></a><span class='Delimiter'>, 
</span>                                                    <span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5102"><span class='Ref_To_Local'>defval</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Comment_Single_Line'>/* should not happen */ 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"failed to coerce base type to domain"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !defval&&DomainHasCon... &raquo; </span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5102"><span class='Ref_To_Local'>defval</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN5361"></a>            <a href="tablecmds.c.html#LN197"><span class='Ref_to_Struct'>NewColumnValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>newval</span><span class='Delimiter'>; 
</span> 
            <a href="tablecmds.c.html#LN5361"><span class='Ref_To_Local'>newval</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN197"><span class='Ref_to_Struct'>NewColumnValue</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN197"><span class='Ref_to_Struct'>NewColumnValue</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN5361"><span class='Ref_To_Local'>newval</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN199"><span class='Ref_to_Member'>attnum</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN5094"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>.</span>attnum<span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN5361"><span class='Ref_To_Local'>newval</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN200"><span class='Ref_to_Member'>expr</span></a> <span class='Operator'>= </span><a href="../../include/optimizer/planner.h.html#LN53"><span class='Ref_to_Proto'>expression_planner</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5102"><span class='Ref_To_Local'>defval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="tablecmds.c.html#LN5085"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN163"><span class='Ref_to_Member'>newvals</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5085"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN163"><span class='Ref_to_Member'>newvals</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5361"><span class='Ref_To_Local'>newval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN5085"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN165"><span class='Ref_to_Member'>rewrite</span></a> <span class='Operator'>|= </span><a href="../../include/commands/event_trigger.h.html#LN31"><span class='Ref_to_Const'>AT_REWRITE_DEFAULT_VAL</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If the new column is NOT NULL, tell Phase 3 it needs to test that. 
         * (Note we don't do this for an OID column.  OID will be marked not 
         * null, but since it's filled specially, there's no need to test 
         * anything.) 
         */ 
</span>        <a href="tablecmds.c.html#LN5085"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN164"><span class='Ref_to_Member'>new_notnull</span></a> <span class='Operator'>|= </span><a href="tablecmds.c.html#LN5086"><span class='Ref_to_Parameter'>colDef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN643"><span class='Ref_to_Member'>is_not_null</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if relkind!=RELKIND_VIEW... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If we are adding an OID column, we have to tell Phase 3 to rewrite the 
     * table to fix that. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5086"><span class='Ref_to_Parameter'>isOid</span></a><span class='Parentheses'>) 
</span>        <a href="tablecmds.c.html#LN5085"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN165"><span class='Ref_to_Member'>rewrite</span></a> <span class='Operator'>|= </span><a href="../../include/commands/event_trigger.h.html#LN33"><span class='Ref_to_Const'>AT_REWRITE_ALTER_OID</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Add needed dependency entries for the new column. 
     */ 
</span>    <a href="tablecmds.c.html#LN361"><span class='Ref_to_Proto'>add_column_datatype_dependency</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5090"><span class='Ref_To_Local'>myrelid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5095"><span class='Ref_To_Local'>newattnum</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5094"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>.</span>atttypid<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN362"><span class='Ref_to_Proto'>add_column_collation_dependency</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5090"><span class='Ref_To_Local'>myrelid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5095"><span class='Ref_To_Local'>newattnum</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5094"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>.</span>attcollation<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Propagate to children as appropriate.  Unlike most other ALTER 
     * routines, we have to do this one level of recursion at a time; we can't 
     * use find_all_inheritors to do it in one pass. 
     */ 
</span>    <a href="tablecmds.c.html#LN5103"><span class='Ref_To_Local'>children</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_inherits_fn.h.html#LN19"><span class='Ref_to_Proto'>find_inheritance_children</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5085"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5088"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we are told not to recurse, there had better not be any child 
     * tables; else the addition would put them out of step. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5103"><span class='Ref_To_Local'>children</span></a> <span class='Operator'>&& !</span><a href="tablecmds.c.html#LN5087"><span class='Ref_to_Parameter'>recurse</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TABLE_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column must be added to child tables too"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Children should see column as singly inherited */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN5087"><span class='Ref_to_Parameter'>recursing</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN5086"><span class='Ref_to_Parameter'>colDef</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5086"><span class='Ref_to_Parameter'>colDef</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN5086"><span class='Ref_to_Parameter'>colDef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN641"><span class='Ref_to_Member'>inhcount</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN5086"><span class='Ref_to_Parameter'>colDef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN642"><span class='Ref_to_Member'>is_local</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5104"><span class='Ref_To_Local'>child</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5103"><span class='Ref_To_Local'>children</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5419"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>childrelid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5104"><span class='Ref_To_Local'>child</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN5420"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>childrel</span><span class='Delimiter'>; 
</span><a name="LN5421"></a>        <a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>childtab</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* find_inheritance_children already got lock */ 
</span>        <a href="tablecmds.c.html#LN5420"><span class='Ref_To_Local'>childrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5419"><span class='Ref_To_Local'>childrelid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/commands/tablecmds.h.html#LN52"><span class='Ref_to_Proto'>CheckTableNotInUse</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5420"><span class='Ref_To_Local'>childrel</span></a><span class='Delimiter'>, </span><span class='String'>"ALTER TABLE"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Find or create work queue entry for this table */ 
</span>        <a href="tablecmds.c.html#LN5421"><span class='Ref_To_Local'>childtab</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN344"><span class='Ref_to_Proto'>ATGetQueueEntry</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5085"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5420"><span class='Ref_To_Local'>childrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Recurse to child; return value is ignored */ 
</span>        <a href="tablecmds.c.html#LN355"><span class='Ref_to_Proto'>ATExecAddColumn</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5085"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5421"><span class='Ref_To_Local'>childtab</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5420"><span class='Ref_To_Local'>childrel</span></a><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN5086"><span class='Ref_to_Parameter'>colDef</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5086"><span class='Ref_to_Parameter'>isOid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5087"><span class='Ref_to_Parameter'>recurse</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN5088"><span class='Ref_to_Parameter'>if_not_exists</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5088"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5420"><span class='Ref_To_Local'>childrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN32"><span class='Ref_to_Macro'>ObjectAddressSubSet</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5106"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5090"><span class='Ref_To_Local'>myrelid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5095"><span class='Ref_To_Local'>newattnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="tablecmds.c.html#LN5106"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATExecAddColumn &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * If a new or renamed column will collide with the name of an existing 
 * column and if_not_exists is false then error out, else do nothing. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN5447"></a><span class='Declare_Function'>check_for_column_name_collision</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colname</span><span class='Delimiter'>, 
</span><a name="LN5448"></a>                                <span class='Keyword'>bool </span><span class='Declare_Parameter'>if_not_exists</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5450"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>attTuple</span><span class='Delimiter'>; 
</span><a name="LN5451"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>attnum</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * this test is deliberately not attisdropped-aware, since if one tries to 
     * add a column matching a dropped column name, it's gonna fail anyway. 
     */ 
</span>    <a href="tablecmds.c.html#LN5450"><span class='Ref_To_Local'>attTuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN157"><span class='Ref_to_Macro'>SearchSysCache2</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN39"><span class='Ref_to_EnumConst'>ATTNAME</span></a><span class='Delimiter'>, 
</span>                               <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5447"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                               <a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5447"><span class='Ref_to_Parameter'>colname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5450"><span class='Ref_To_Local'>attTuple</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN5451"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5450"><span class='Ref_To_Local'>attTuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>attnum<span class='Delimiter'>; 
</span>    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5450"><span class='Ref_To_Local'>attTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We throw a different error message for conflicts with system column 
     * names, since they are normally not shown and the user might otherwise 
     * be confused about the reason for the conflict. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5451"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DUPLICATE_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column name \"%s\" conflicts with a system column name"</span><span class='Delimiter'>, 
</span>                    <a href="tablecmds.c.html#LN5447"><span class='Ref_to_Parameter'>colname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5448"><span class='Ref_to_Parameter'>if_not_exists</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DUPLICATE_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" of relation \"%s\" already exists, skipping"</span><span class='Delimiter'>, 
</span>                            <a href="tablecmds.c.html#LN5447"><span class='Ref_to_Parameter'>colname</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5447"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DUPLICATE_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" of relation \"%s\" already exists"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN5447"><span class='Ref_to_Parameter'>colname</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5447"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end check_for_column_name_collision &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Install a column's dependency on its datatype. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN5500"></a><span class='Declare_Function'>add_column_datatype_dependency</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>attnum</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5502"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>myself</span><span class='Delimiter'>, 
</span><a name="LN5503"></a>                <span class='Declare_Local'>referenced</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN5502"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN5502"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN5500"><span class='Ref_to_Parameter'>relid</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN5502"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN5500"><span class='Ref_to_Parameter'>attnum</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN5503"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN5503"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN5500"><span class='Ref_to_Parameter'>typid</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN5503"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN5502"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN5503"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Install a column's dependency on its collation. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN5518"></a><span class='Declare_Function'>add_column_collation_dependency</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>attnum</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>collid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5520"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>myself</span><span class='Delimiter'>, 
</span><a name="LN5521"></a>                <span class='Declare_Local'>referenced</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We know the default collation is pinned, so don't bother recording it */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5518"><span class='Ref_to_Parameter'>collid</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="tablecmds.c.html#LN5518"><span class='Ref_to_Parameter'>collid</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_collation.h.html#LN74"><span class='Ref_to_Const'>DEFAULT_COLLATION_OID</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN5520"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN5520"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN5518"><span class='Ref_to_Parameter'>relid</span></a><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN5520"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN5518"><span class='Ref_to_Parameter'>attnum</span></a><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN5521"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_collation.h.html#LN29"><span class='Ref_to_Const'>CollationRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN5521"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN5518"><span class='Ref_to_Parameter'>collid</span></a><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN5521"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN5520"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN5521"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * ALTER TABLE SET WITH OIDS 
 * 
 * Basically this is an ADD COLUMN for the special OID column.  We have 
 * to cons up a ColumnDef node because the ADD COLUMN code needs one. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN5543"></a><span class='Declare_Function'>ATPrepAddOids</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>wqueue</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recurse</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cmd</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* If we're recursing to a child table, the ColumnDef is already set up */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5543"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5548"></a>        <a href="../../include/nodes/parsenodes.h.html#LN636"><span class='Ref_to_Struct'>ColumnDef</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>cdef</span> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN636"><span class='Ref_to_Struct'>ColumnDef</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN5548"><span class='Ref_To_Local'>cdef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN639"><span class='Ref_to_Member'>colname</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><span class='String'>"oid"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN5548"><span class='Ref_To_Local'>cdef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN640"><span class='Ref_to_Member'>typeName</span></a> <span class='Operator'>= </span><a href="../../include/nodes/makefuncs.h.html#LN72"><span class='Ref_to_Proto'>makeTypeNameFromOid</span></a><span class='Parentheses'>(</span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN27"><span class='Ref_to_Const'>OIDOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN5548"><span class='Ref_To_Local'>cdef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN641"><span class='Ref_to_Member'>inhcount</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN5548"><span class='Ref_To_Local'>cdef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN642"><span class='Ref_to_Member'>is_local</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN5548"><span class='Ref_To_Local'>cdef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN643"><span class='Ref_to_Member'>is_not_null</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN5548"><span class='Ref_To_Local'>cdef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN646"><span class='Ref_to_Member'>storage</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN5548"><span class='Ref_To_Local'>cdef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN654"><span class='Ref_to_Member'>location</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN5543"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN5548"><span class='Ref_To_Local'>cdef</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="tablecmds.c.html#LN353"><span class='Ref_to_Proto'>ATPrepAddColumn</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5543"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5543"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5543"><span class='Ref_to_Parameter'>recurse</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5543"><span class='Ref_to_Parameter'>cmd</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5543"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5543"><span class='Ref_to_Parameter'>recurse</span></a><span class='Parentheses'>) 
</span>        <a href="tablecmds.c.html#LN5543"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1752"><span class='Ref_to_Member'>subtype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN1707"><span class='Ref_to_EnumConst'>AT_AddOidsRecurse</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATPrepAddOids &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ALTER TABLE ALTER COLUMN DROP NOT NULL 
 * 
 * Return the address of the modified column.  If the column was already 
 * nullable, InvalidObjectAddress is returned. 
 */ 
</span> 
<span class='Keyword'>static void 
</span><a name="LN5573"></a><span class='Declare_Function'>ATPrepDropNotNull</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recurse</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recursing</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * If the parent is a partitioned table, like check constraints, we do not 
     * support removing the NOT NULL while partitions exist. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5573"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5581"></a>        <a href="../../include/catalog/partition.h.html#LN39"><span class='Ref_to_Typedef'>PartitionDesc</span></a> <span class='Declare_Local'>partdesc</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN632"><span class='Ref_to_Macro'>RelationGetPartitionDesc</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5573"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5581"><span class='Ref_To_Local'>partdesc</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5581"><span class='Ref_To_Local'>partdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN34"><span class='Ref_to_Member'>nparts</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& !</span><a href="tablecmds.c.html#LN5573"><span class='Ref_to_Parameter'>recurse</span></a> <span class='Operator'>&& !</span><a href="tablecmds.c.html#LN5573"><span class='Ref_to_Parameter'>recursing</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TABLE_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot remove constraint from only the partitioned table when partitions exist"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Do not specify the ONLY keyword."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN5592"></a><span class='Declare_Function'>ATExecDropNotNull</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colName</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5594"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN5595"></a>    <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>attnum</span><span class='Delimiter'>; 
</span><a name="LN5596"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>attr_rel</span><span class='Delimiter'>; 
</span><a name="LN5597"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>indexoidlist</span><span class='Delimiter'>; 
</span><a name="LN5598"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>indexoidscan</span><span class='Delimiter'>; 
</span><a name="LN5599"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * lookup the attribute 
     */ 
</span>    <a href="tablecmds.c.html#LN5596"><span class='Ref_To_Local'>attr_rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN32"><span class='Ref_to_Const'>AttributeRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN5594"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN130"><span class='Ref_to_Proto'>SearchSysCacheCopyAttName</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5592"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5592"><span class='Ref_to_Parameter'>colName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5594"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" of relation \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN5592"><span class='Ref_to_Parameter'>colName</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5592"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN5595"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5594"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>attnum<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Prevent them from altering a system attribute */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5595"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot alter system column \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN5592"><span class='Ref_to_Parameter'>colName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/lsyscache.h.html#LN88"><span class='Ref_to_Proto'>get_attidentity</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5592"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5595"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" of relation \"%s\" is an identity column"</span><span class='Delimiter'>, 
</span>                    <a href="tablecmds.c.html#LN5592"><span class='Ref_to_Parameter'>colName</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5592"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check that the attribute is not in a primary key 
     * 
     * Note: we'll throw error even if the pkey index is not valid. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* Loop over all indexes on the relation */ 
</span>    <a href="tablecmds.c.html#LN5597"><span class='Ref_To_Local'>indexoidlist</span></a> <span class='Operator'>= </span><a href="../../include/utils/relcache.h.html#LN40"><span class='Ref_to_Proto'>RelationGetIndexList</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5592"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5598"><span class='Ref_To_Local'>indexoidscan</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5597"><span class='Ref_To_Local'>indexoidlist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5640"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>indexoid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5598"><span class='Ref_To_Local'>indexoidscan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN5641"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>indexTuple</span><span class='Delimiter'>; 
</span><a name="LN5642"></a>        <a href="../../include/catalog/pg_index.h.html#LN66"><span class='Ref_to_Typedef'>Form_pg_index</span></a> <span class='Declare_Local'>indexStruct</span><span class='Delimiter'>; 
</span><a name="LN5643"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN5641"><span class='Ref_To_Local'>indexTuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN65"><span class='Ref_to_EnumConst'>INDEXRELID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5640"><span class='Ref_To_Local'>indexoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5641"><span class='Ref_To_Local'>indexTuple</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for index %u"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5640"><span class='Ref_To_Local'>indexoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN5642"><span class='Ref_To_Local'>indexStruct</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_index.h.html#LN66"><span class='Ref_to_Typedef'>Form_pg_index</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5641"><span class='Ref_To_Local'>indexTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* If the index is not a primary key, skip the check */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5642"><span class='Ref_To_Local'>indexStruct</span></a><span class='Operator'>-&GT;</span>indisprimary<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Loop over each attribute in the primary key and see if it 
             * matches the to-be-altered attribute 
             */ 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5643"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN5643"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tablecmds.c.html#LN5642"><span class='Ref_To_Local'>indexStruct</span></a><span class='Operator'>-&GT;</span>indnatts<span class='Delimiter'>; </span><a href="tablecmds.c.html#LN5643"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5642"><span class='Ref_To_Local'>indexStruct</span></a><span class='Operator'>-&GT;</span>indkey<span class='Operator'>.</span>values<span class='Delimiter'>[</span><a href="tablecmds.c.html#LN5643"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="tablecmds.c.html#LN5595"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TABLE_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" is in a primary key"</span><span class='Delimiter'>, 
</span>                                    <a href="tablecmds.c.html#LN5592"><span class='Ref_to_Parameter'>colName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5641"><span class='Ref_To_Local'>indexTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5597"><span class='Ref_To_Local'>indexoidlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If rel is partition, shouldn't drop NOT NULL if parent has the same */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5592"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relispartition<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5675"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>parentId</span> <span class='Operator'>= </span><a href="../../include/catalog/partition.h.html#LN78"><span class='Ref_to_Proto'>get_partition_parent</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5592"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN5676"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>parent</span> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5675"><span class='Ref_To_Local'>parentId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN5677"></a>        <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupDesc</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5676"><span class='Ref_To_Local'>parent</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN5678"></a>        <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>parent_attnum</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN5678"><span class='Ref_To_Local'>parent_attnum</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN87"><span class='Ref_to_Proto'>get_attnum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5675"><span class='Ref_To_Local'>parentId</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5592"><span class='Ref_to_Parameter'>colName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5677"><span class='Ref_To_Local'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN5678"><span class='Ref_To_Local'>parent_attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attnotnull<span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TABLE_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                   <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" is marked NOT NULL in parent table"</span><span class='Delimiter'>, 
</span>                          <a href="tablecmds.c.html#LN5592"><span class='Ref_to_Parameter'>colName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5676"><span class='Ref_To_Local'>parent</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Okay, actually perform the catalog change ... if needed 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5594"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>attnotnull<span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Parentheses'>((</span><a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5594"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>attnotnull <span class='Operator'>= </span><span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5596"><span class='Ref_To_Local'>attr_rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN5594"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5594"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/objectaddress.h.html#LN32"><span class='Ref_to_Macro'>ObjectAddressSubSet</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5599"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5592"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5595"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="tablecmds.c.html#LN5599"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="../catalog/objectaddress.c.html#LN718"><span class='Ref_to_Global_Var'>InvalidObjectAddress</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5592"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5595"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5596"><span class='Ref_To_Local'>attr_rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN5599"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATExecDropNotNull &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ALTER TABLE ALTER COLUMN SET NOT NULL 
 * 
 * Return the address of the modified column.  If the column was already NOT 
 * NULL, InvalidObjectAddress is returned. 
 */ 
</span> 
<span class='Keyword'>static void 
</span><a name="LN5720"></a><span class='Declare_Function'>ATPrepSetNotNull</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recurse</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recursing</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * If the parent is a partitioned table, like check constraints, NOT NULL 
     * constraints must be added to the child tables.  Complain if requested 
     * otherwise and partitions exist. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5720"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5729"></a>        <a href="../../include/catalog/partition.h.html#LN39"><span class='Ref_to_Typedef'>PartitionDesc</span></a> <span class='Declare_Local'>partdesc</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN632"><span class='Ref_to_Macro'>RelationGetPartitionDesc</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5720"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5729"><span class='Ref_To_Local'>partdesc</span></a> <span class='Operator'>&& </span><a href="tablecmds.c.html#LN5729"><span class='Ref_To_Local'>partdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN34"><span class='Ref_to_Member'>nparts</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& !</span><a href="tablecmds.c.html#LN5720"><span class='Ref_to_Parameter'>recurse</span></a> <span class='Operator'>&& !</span><a href="tablecmds.c.html#LN5720"><span class='Ref_to_Parameter'>recursing</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TABLE_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot add constraint to only the partitioned table when partitions exist"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Do not specify the ONLY keyword."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN5740"></a><span class='Declare_Function'>ATExecSetNotNull</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tab</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN5741"></a>                 <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colName</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5743"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN5744"></a>    <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>attnum</span><span class='Delimiter'>; 
</span><a name="LN5745"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>attr_rel</span><span class='Delimiter'>; 
</span><a name="LN5746"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * lookup the attribute 
     */ 
</span>    <a href="tablecmds.c.html#LN5745"><span class='Ref_To_Local'>attr_rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN32"><span class='Ref_to_Const'>AttributeRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN5743"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN130"><span class='Ref_to_Proto'>SearchSysCacheCopyAttName</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5740"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5741"><span class='Ref_to_Parameter'>colName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5743"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" of relation \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN5741"><span class='Ref_to_Parameter'>colName</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5740"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN5744"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5743"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>attnum<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Prevent them from altering a system attribute */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5744"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot alter system column \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN5741"><span class='Ref_to_Parameter'>colName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Okay, actually perform the catalog change ... if needed 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5743"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>attnotnull<span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Parentheses'>((</span><a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5743"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>attnotnull <span class='Operator'>= </span><span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5745"><span class='Ref_To_Local'>attr_rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN5743"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5743"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Tell Phase 3 it needs to test the constraint */ 
</span>        <a href="tablecmds.c.html#LN5740"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN164"><span class='Ref_to_Member'>new_notnull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/objectaddress.h.html#LN32"><span class='Ref_to_Macro'>ObjectAddressSubSet</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5746"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5740"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5744"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="tablecmds.c.html#LN5746"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="../catalog/objectaddress.c.html#LN718"><span class='Ref_to_Global_Var'>InvalidObjectAddress</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5740"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5744"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5745"><span class='Ref_To_Local'>attr_rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN5746"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATExecSetNotNull &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ALTER TABLE ALTER COLUMN SET/DROP DEFAULT 
 * 
 * Return the address of the affected column. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN5802"></a><span class='Declare_Function'>ATExecColumnDefault</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colName</span><span class='Delimiter'>, 
</span><a name="LN5803"></a>                    <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>newDefault</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5805"></a>    <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>attnum</span><span class='Delimiter'>; 
</span><a name="LN5806"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * get the number of the attribute 
     */ 
</span>    <a href="tablecmds.c.html#LN5805"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN87"><span class='Ref_to_Proto'>get_attnum</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5802"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5802"><span class='Ref_to_Parameter'>colName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5805"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>== </span><a href="../../include/access/attnum.h.html#LN22"><span class='Ref_to_Const'>InvalidAttrNumber</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" of relation \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN5802"><span class='Ref_to_Parameter'>colName</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5802"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Prevent them from altering a system attribute */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5805"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot alter system column \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN5802"><span class='Ref_to_Parameter'>colName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/lsyscache.h.html#LN88"><span class='Ref_to_Proto'>get_attidentity</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5802"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5805"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" of relation \"%s\" is an identity column"</span><span class='Delimiter'>, 
</span>                    <a href="tablecmds.c.html#LN5802"><span class='Ref_to_Parameter'>colName</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5802"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                 <a href="tablecmds.c.html#LN5803"><span class='Ref_to_Parameter'>newDefault</span></a> <span class='Operator'>? </span><span class='Number'>0</span> <span class='Operator'>: </span><a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Use ALTER TABLE ... ALTER COLUMN ... DROP IDENTITY instead."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Remove any old default for the column.  We use RESTRICT here for 
     * safety, but at present we do not expect anything to depend on the 
     * default. 
     * 
     * We treat removing the existing default as an internal operation when it 
     * is preparatory to adding a new default, but as a user-initiated 
     * operation when the user asked for a drop. 
     */ 
</span>    <a href="../../include/catalog/heap.h.html#LN117"><span class='Ref_to_Proto'>RemoveAttrDefault</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5802"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5805"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1654"><span class='Ref_to_EnumConst'>DROP_RESTRICT</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                      <a href="tablecmds.c.html#LN5803"><span class='Ref_to_Parameter'>newDefault</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>? </span><span class='Boolean'>false </span><span class='Operator'>: </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5803"><span class='Ref_to_Parameter'>newDefault</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* SET DEFAULT */ 
</span><a name="LN5847"></a>        <a href="../../include/catalog/heap.h.html#LN21"><span class='Ref_to_Struct'>RawColumnDefault</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rawEnt</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN5847"><span class='Ref_To_Local'>rawEnt</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/heap.h.html#LN21"><span class='Ref_to_Struct'>RawColumnDefault</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/catalog/heap.h.html#LN21"><span class='Ref_to_Struct'>RawColumnDefault</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN5847"><span class='Ref_To_Local'>rawEnt</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/heap.h.html#LN23"><span class='Ref_to_Member'>attnum</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN5805"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN5847"><span class='Ref_To_Local'>rawEnt</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/heap.h.html#LN24"><span class='Ref_to_Member'>raw_default</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN5803"><span class='Ref_to_Parameter'>newDefault</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * This function is intended for CREATE TABLE, so it processes a 
         * _list_ of defaults, but we just do one. 
         */ 
</span>        <a href="../../include/catalog/heap.h.html#LN97"><span class='Ref_to_Proto'>AddRelationNewConstraints</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5802"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5847"><span class='Ref_To_Local'>rawEnt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, 
</span>                                  <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN32"><span class='Ref_to_Macro'>ObjectAddressSubSet</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5806"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5802"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5805"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="tablecmds.c.html#LN5806"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATExecColumnDefault &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ALTER TABLE ALTER COLUMN ADD IDENTITY 
 * 
 * Return the address of the affected column. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN5872"></a><span class='Declare_Function'>ATExecAddIdentity</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colName</span><span class='Delimiter'>, 
</span><a name="LN5873"></a>                  <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>def</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5875"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>attrelation</span><span class='Delimiter'>; 
</span><a name="LN5876"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN5877"></a>    <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>attTup</span><span class='Delimiter'>; 
</span><a name="LN5878"></a>    <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>attnum</span><span class='Delimiter'>; 
</span><a name="LN5879"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span><a name="LN5880"></a>    <a href="../../include/nodes/parsenodes.h.html#LN636"><span class='Ref_to_Struct'>ColumnDef</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>cdef</span> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN636"><span class='Ref_to_Struct'>ColumnDef</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5873"><span class='Ref_to_Parameter'>def</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN5875"><span class='Ref_To_Local'>attrelation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN32"><span class='Ref_to_Const'>AttributeRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN5876"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN130"><span class='Ref_to_Proto'>SearchSysCacheCopyAttName</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5872"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5872"><span class='Ref_to_Parameter'>colName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5876"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" of relation \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN5872"><span class='Ref_to_Parameter'>colName</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5872"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN5877"><span class='Ref_To_Local'>attTup</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5876"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN5878"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN5877"><span class='Ref_To_Local'>attTup</span></a><span class='Operator'>-&GT;</span>attnum<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Can't alter a system attribute */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5878"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot alter system column \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN5872"><span class='Ref_to_Parameter'>colName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Creating a column as identity implies NOT NULL, so adding the identity 
     * to an existing column that is not NOT NULL would create a state that 
     * cannot be reproduced without contortions. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN5877"><span class='Ref_To_Local'>attTup</span></a><span class='Operator'>-&GT;</span>attnotnull<span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" of relation \"%s\" must be declared NOT NULL before identity can be added"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN5872"><span class='Ref_to_Parameter'>colName</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5872"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5877"><span class='Ref_To_Local'>attTup</span></a><span class='Operator'>-&GT;</span>attidentity<span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" of relation \"%s\" is already an identity column"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN5872"><span class='Ref_to_Parameter'>colName</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5872"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5877"><span class='Ref_To_Local'>attTup</span></a><span class='Operator'>-&GT;</span>atthasdef<span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" of relation \"%s\" already has a default value"</span><span class='Delimiter'>, 
</span>               <a href="tablecmds.c.html#LN5872"><span class='Ref_to_Parameter'>colName</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5872"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN5877"><span class='Ref_To_Local'>attTup</span></a><span class='Operator'>-&GT;</span>attidentity <span class='Operator'>= </span><a href="tablecmds.c.html#LN5880"><span class='Ref_To_Local'>cdef</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN649"><span class='Ref_to_Member'>identity</span></a><span class='Delimiter'>; 
</span>    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5875"><span class='Ref_To_Local'>attrelation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN5876"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5876"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5872"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="tablecmds.c.html#LN5877"><span class='Ref_To_Local'>attTup</span></a><span class='Operator'>-&GT;</span>attnum<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/catalog/objectaddress.h.html#LN32"><span class='Ref_to_Macro'>ObjectAddressSubSet</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5879"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5872"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5878"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5876"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5875"><span class='Ref_To_Local'>attrelation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN5879"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATExecAddIdentity &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ALTER TABLE ALTER COLUMN SET { GENERATED or sequence options } 
 * 
 * Return the address of the affected column. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN5944"></a><span class='Declare_Function'>ATExecSetIdentity</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colName</span><span class='Delimiter'>, </span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>def</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5946"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>option</span><span class='Delimiter'>; 
</span><a name="LN5947"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>generatedEl</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN5948"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN5949"></a>    <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>attTup</span><span class='Delimiter'>; 
</span><a name="LN5950"></a>    <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>attnum</span><span class='Delimiter'>; 
</span><a name="LN5951"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>attrelation</span><span class='Delimiter'>; 
</span><a name="LN5952"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5946"><span class='Ref_To_Local'>option</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5944"><span class='Ref_to_Parameter'>def</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN5956"></a>        <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>defel</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5946"><span class='Ref_To_Local'>option</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5956"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"generated"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5947"><span class='Ref_To_Local'>generatedEl</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN5947"><span class='Ref_To_Local'>generatedEl</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN5956"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"option \"%s\" not recognized"</span><span class='Delimiter'>, 
</span>                 <a href="tablecmds.c.html#LN5956"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Even if there is nothing to change here, we run all the checks.  There 
     * will be a subsequent ALTER SEQUENCE that relies on everything being 
     * there. 
     */ 
</span> 
    <a href="tablecmds.c.html#LN5951"><span class='Ref_To_Local'>attrelation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN32"><span class='Ref_to_Const'>AttributeRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN5948"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN130"><span class='Ref_to_Proto'>SearchSysCacheCopyAttName</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5944"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5944"><span class='Ref_to_Parameter'>colName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5948"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" of relation \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN5944"><span class='Ref_to_Parameter'>colName</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5944"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN5949"><span class='Ref_To_Local'>attTup</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5948"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN5950"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN5949"><span class='Ref_To_Local'>attTup</span></a><span class='Operator'>-&GT;</span>attnum<span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5950"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot alter system column \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN5944"><span class='Ref_to_Parameter'>colName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN5949"><span class='Ref_To_Local'>attTup</span></a><span class='Operator'>-&GT;</span>attidentity<span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" of relation \"%s\" is not an identity column"</span><span class='Delimiter'>, 
</span>                <a href="tablecmds.c.html#LN5944"><span class='Ref_to_Parameter'>colName</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5944"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5947"><span class='Ref_To_Local'>generatedEl</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN5949"><span class='Ref_To_Local'>attTup</span></a><span class='Operator'>-&GT;</span>attidentity <span class='Operator'>= </span><a href="../../include/commands/defrem.h.html#LN159"><span class='Ref_to_Proto'>defGetInt32</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5947"><span class='Ref_To_Local'>generatedEl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5951"><span class='Ref_To_Local'>attrelation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN5948"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5948"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5944"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <a href="tablecmds.c.html#LN5949"><span class='Ref_To_Local'>attTup</span></a><span class='Operator'>-&GT;</span>attnum<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/catalog/objectaddress.h.html#LN32"><span class='Ref_to_Macro'>ObjectAddressSubSet</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5952"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5944"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN5950"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="tablecmds.c.html#LN5952"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="../catalog/objectaddress.c.html#LN718"><span class='Ref_to_Global_Var'>InvalidObjectAddress</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5948"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN5951"><span class='Ref_To_Local'>attrelation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN5952"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATExecSetIdentity &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ALTER TABLE ALTER COLUMN DROP IDENTITY 
 * 
 * Return the address of the affected column. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN6026"></a><span class='Declare_Function'>ATExecDropIdentity</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colName</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>missing_ok</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6028"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN6029"></a>    <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>attTup</span><span class='Delimiter'>; 
</span><a name="LN6030"></a>    <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>attnum</span><span class='Delimiter'>; 
</span><a name="LN6031"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>attrelation</span><span class='Delimiter'>; 
</span><a name="LN6032"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span><a name="LN6033"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>seqid</span><span class='Delimiter'>; 
</span><a name="LN6034"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>seqaddress</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN6031"><span class='Ref_To_Local'>attrelation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN32"><span class='Ref_to_Const'>AttributeRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN6028"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN130"><span class='Ref_to_Proto'>SearchSysCacheCopyAttName</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6026"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6026"><span class='Ref_to_Parameter'>colName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6028"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" of relation \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN6026"><span class='Ref_to_Parameter'>colName</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6026"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN6029"><span class='Ref_To_Local'>attTup</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6028"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN6030"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN6029"><span class='Ref_To_Local'>attTup</span></a><span class='Operator'>-&GT;</span>attnum<span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6030"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot alter system column \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN6026"><span class='Ref_to_Parameter'>colName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN6029"><span class='Ref_To_Local'>attTup</span></a><span class='Operator'>-&GT;</span>attidentity<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN6026"><span class='Ref_to_Parameter'>missing_ok</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" of relation \"%s\" is not an identity column"</span><span class='Delimiter'>, 
</span>                            <a href="tablecmds.c.html#LN6026"><span class='Ref_to_Parameter'>colName</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6026"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" of relation \"%s\" is not an identity column, skipping"</span><span class='Delimiter'>, 
</span>                            <a href="tablecmds.c.html#LN6026"><span class='Ref_to_Parameter'>colName</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6026"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6028"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6031"><span class='Ref_To_Local'>attrelation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="../catalog/objectaddress.c.html#LN718"><span class='Ref_to_Global_Var'>InvalidObjectAddress</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="tablecmds.c.html#LN6029"><span class='Ref_To_Local'>attTup</span></a><span class='Operator'>-&GT;</span>attidentity <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6031"><span class='Ref_To_Local'>attrelation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN6028"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6028"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6026"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="tablecmds.c.html#LN6029"><span class='Ref_To_Local'>attTup</span></a><span class='Operator'>-&GT;</span>attnum<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/catalog/objectaddress.h.html#LN32"><span class='Ref_to_Macro'>ObjectAddressSubSet</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6032"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6026"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6030"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6028"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6031"><span class='Ref_To_Local'>attrelation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* drop the internal sequence */ 
</span>    <a href="tablecmds.c.html#LN6033"><span class='Ref_To_Local'>seqid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/dependency.h.html#LN242"><span class='Ref_to_Proto'>getOwnedSequence</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6026"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6030"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/catalog/dependency.h.html#LN231"><span class='Ref_to_Proto'>deleteDependencyRecordsForClass</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6033"><span class='Ref_To_Local'>seqid</span></a><span class='Delimiter'>, 
</span>                                    <a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN76"><span class='Ref_to_EnumConst'>DEPENDENCY_INTERNAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN6034"><span class='Ref_To_Local'>seqaddress</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN6034"><span class='Ref_To_Local'>seqaddress</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN6033"><span class='Ref_To_Local'>seqid</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN6034"><span class='Ref_To_Local'>seqaddress</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../../include/catalog/dependency.h.html#LN182"><span class='Ref_to_Proto'>performDeletion</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN6034"><span class='Ref_To_Local'>seqaddress</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1654"><span class='Ref_to_EnumConst'>DROP_RESTRICT</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN173"><span class='Ref_to_Const'>PERFORM_DELETION_INTERNAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN6032"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATExecDropIdentity &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ALTER TABLE ALTER COLUMN SET STATISTICS 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN6100"></a><span class='Declare_Function'>ATPrepSetStatistics</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colName</span><span class='Delimiter'>, </span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>newValue</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * We do our own permission checking because (a) we want to allow SET 
     * STATISTICS on indexes (for expressional index columns), and (b) we want 
     * to allow SET STATISTICS on system catalogs without requiring 
     * allowSystemTableMods to be turned on. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6100"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a> <span class='Operator'>&& 
</span>        <a href="tablecmds.c.html#LN6100"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a> <span class='Operator'>&& 
</span>        <a href="tablecmds.c.html#LN6100"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN160"><span class='Ref_to_Const'>RELKIND_INDEX</span></a> <span class='Operator'>&& 
</span>        <a href="tablecmds.c.html#LN6100"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a> <span class='Operator'>&& 
</span>        <a href="tablecmds.c.html#LN6100"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a table, materialized view, index, or foreign table"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6100"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Permissions checks */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN308"><span class='Ref_to_Proto'>pg_class_ownercheck</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6100"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN181"><span class='Ref_to_EnumConst'>ACL_KIND_CLASS</span></a><span class='Delimiter'>, 
</span>                       <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6100"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATPrepSetStatistics &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Return value is the address of the modified column 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN6128"></a><span class='Declare_Function'>ATExecSetStatistics</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colName</span><span class='Delimiter'>, </span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>newValue</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6130"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>newtarget</span><span class='Delimiter'>; 
</span><a name="LN6131"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>attrelation</span><span class='Delimiter'>; 
</span><a name="LN6132"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN6133"></a>    <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>attrtuple</span><span class='Delimiter'>; 
</span><a name="LN6134"></a>    <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>attnum</span><span class='Delimiter'>; 
</span><a name="LN6135"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6128"><span class='Ref_to_Parameter'>newValue</span></a><span class='Delimiter'>, </span>Integer<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN6130"><span class='Ref_To_Local'>newtarget</span></a> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN51"><span class='Ref_to_Macro'>intVal</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6128"><span class='Ref_to_Parameter'>newValue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Limit target to a sane range 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6130"><span class='Ref_To_Local'>newtarget</span></a> <span class='Operator'>&LT; -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"statistics target %d is too low"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN6130"><span class='Ref_To_Local'>newtarget</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6130"><span class='Ref_To_Local'>newtarget</span></a> <span class='Operator'>&GT; </span><span class='Number'>10000</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN6130"><span class='Ref_To_Local'>newtarget</span></a> <span class='Operator'>= </span><span class='Number'>10000</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"lowering statistics target to %d"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN6130"><span class='Ref_To_Local'>newtarget</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="tablecmds.c.html#LN6131"><span class='Ref_To_Local'>attrelation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN32"><span class='Ref_to_Const'>AttributeRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN6132"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN130"><span class='Ref_to_Proto'>SearchSysCacheCopyAttName</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6128"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6128"><span class='Ref_to_Parameter'>colName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6132"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" of relation \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN6128"><span class='Ref_to_Parameter'>colName</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6128"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN6133"><span class='Ref_To_Local'>attrtuple</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6132"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN6134"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN6133"><span class='Ref_To_Local'>attrtuple</span></a><span class='Operator'>-&GT;</span>attnum<span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6134"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot alter system column \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN6128"><span class='Ref_to_Parameter'>colName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN6133"><span class='Ref_To_Local'>attrtuple</span></a><span class='Operator'>-&GT;</span>attstattarget <span class='Operator'>= </span><a href="tablecmds.c.html#LN6130"><span class='Ref_To_Local'>newtarget</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6131"><span class='Ref_To_Local'>attrelation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN6132"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6132"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6128"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="tablecmds.c.html#LN6133"><span class='Ref_To_Local'>attrtuple</span></a><span class='Operator'>-&GT;</span>attnum<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/catalog/objectaddress.h.html#LN32"><span class='Ref_to_Macro'>ObjectAddressSubSet</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6135"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6128"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6134"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6132"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6131"><span class='Ref_To_Local'>attrelation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN6135"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATExecSetStatistics &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Return value is the address of the modified column 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN6197"></a><span class='Declare_Function'>ATExecSetOptions</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colName</span><span class='Delimiter'>, </span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>options</span><span class='Delimiter'>, 
</span><a name="LN6198"></a>                 <span class='Keyword'>bool </span><span class='Declare_Parameter'>isReset</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6200"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>attrelation</span><span class='Delimiter'>; 
</span><a name="LN6201"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>, 
</span><a name="LN6202"></a>                <span class='Declare_Local'>newtuple</span><span class='Delimiter'>; 
</span><a name="LN6203"></a>    <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>attrtuple</span><span class='Delimiter'>; 
</span><a name="LN6204"></a>    <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>attnum</span><span class='Delimiter'>; 
</span><a name="LN6205"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>datum</span><span class='Delimiter'>, 
</span><a name="LN6206"></a>                <span class='Declare_Local'>newOptions</span><span class='Delimiter'>; 
</span><a name="LN6207"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN6208"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span><a name="LN6209"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>repl_val</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_attribute.h.html#LN193"><span class='Ref_to_Const'>Natts_pg_attribute</span></a><span class='Delimiter'>]; 
</span><a name="LN6210"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>repl_null</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_attribute.h.html#LN193"><span class='Ref_to_Const'>Natts_pg_attribute</span></a><span class='Delimiter'>]; 
</span><a name="LN6211"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>repl_repl</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_attribute.h.html#LN193"><span class='Ref_to_Const'>Natts_pg_attribute</span></a><span class='Delimiter'>]; 
</span> 
    <a href="tablecmds.c.html#LN6200"><span class='Ref_To_Local'>attrelation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN32"><span class='Ref_to_Const'>AttributeRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN6201"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN129"><span class='Ref_to_Proto'>SearchSysCacheAttName</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6197"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6197"><span class='Ref_to_Parameter'>colName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6201"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" of relation \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN6197"><span class='Ref_to_Parameter'>colName</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6197"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN6203"><span class='Ref_To_Local'>attrtuple</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6201"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN6204"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN6203"><span class='Ref_To_Local'>attrtuple</span></a><span class='Operator'>-&GT;</span>attnum<span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6204"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot alter system column \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN6197"><span class='Ref_to_Parameter'>colName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Generate new proposed attoptions (text array) */ 
</span>    <a href="tablecmds.c.html#LN6205"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN39"><span class='Ref_to_EnumConst'>ATTNAME</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6201"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_attribute.h.html#LN214"><span class='Ref_to_Const'>Anum_pg_attribute_attoptions</span></a><span class='Delimiter'>, 
</span>                            <span class='Operator'>&</span><a href="tablecmds.c.html#LN6207"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN6206"><span class='Ref_To_Local'>newOptions</span></a> <span class='Operator'>= </span><a href="../../include/access/reloptions.h.html#LN257"><span class='Ref_to_Proto'>transformRelOptions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6207"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>? </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span> <span class='Operator'>: </span><a href="tablecmds.c.html#LN6205"><span class='Ref_To_Local'>datum</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6197"><span class='Ref_to_Parameter'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                     <span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6198"><span class='Ref_to_Parameter'>isReset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Validate new options */ 
</span>    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../include/access/reloptions.h.html#LN278"><span class='Ref_to_Proto'>attribute_reloptions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6206"><span class='Ref_To_Local'>newOptions</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build new tuple. */ 
</span>    memset<span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6210"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6210"><span class='Ref_To_Local'>repl_null</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6211"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6211"><span class='Ref_To_Local'>repl_repl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6206"><span class='Ref_To_Local'>newOptions</span></a> <span class='Operator'>!= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="tablecmds.c.html#LN6209"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_attribute.h.html#LN214"><span class='Ref_to_Const'>Anum_pg_attribute_attoptions</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="tablecmds.c.html#LN6206"><span class='Ref_To_Local'>newOptions</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="tablecmds.c.html#LN6210"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_attribute.h.html#LN214"><span class='Ref_to_Const'>Anum_pg_attribute_attoptions</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN6211"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_attribute.h.html#LN214"><span class='Ref_to_Const'>Anum_pg_attribute_attoptions</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN6202"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6201"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6200"><span class='Ref_To_Local'>attrelation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="tablecmds.c.html#LN6209"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6210"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6211"><span class='Ref_To_Local'>repl_repl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Update system catalog. */ 
</span>    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6200"><span class='Ref_To_Local'>attrelation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN6202"><span class='Ref_To_Local'>newtuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6202"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6197"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="tablecmds.c.html#LN6203"><span class='Ref_To_Local'>attrtuple</span></a><span class='Operator'>-&GT;</span>attnum<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/catalog/objectaddress.h.html#LN32"><span class='Ref_to_Macro'>ObjectAddressSubSet</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6208"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6197"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6204"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6202"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6201"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6200"><span class='Ref_To_Local'>attrelation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN6208"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATExecSetOptions &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ALTER TABLE ALTER COLUMN SET STORAGE 
 * 
 * Return value is the address of the modified column 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN6275"></a><span class='Declare_Function'>ATExecSetStorage</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colName</span><span class='Delimiter'>, </span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>newValue</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6277"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>storagemode</span><span class='Delimiter'>; 
</span><a name="LN6278"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>newstorage</span><span class='Delimiter'>; 
</span><a name="LN6279"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>attrelation</span><span class='Delimiter'>; 
</span><a name="LN6280"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN6281"></a>    <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>attrtuple</span><span class='Delimiter'>; 
</span><a name="LN6282"></a>    <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>attnum</span><span class='Delimiter'>; 
</span><a name="LN6283"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6275"><span class='Ref_to_Parameter'>newValue</span></a><span class='Delimiter'>, </span>String<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN6277"><span class='Ref_To_Local'>storagemode</span></a> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6275"><span class='Ref_to_Parameter'>newValue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6277"><span class='Ref_To_Local'>storagemode</span></a><span class='Delimiter'>, </span><span class='String'>"plain"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="tablecmds.c.html#LN6278"><span class='Ref_To_Local'>newstorage</span></a> <span class='Operator'>= </span><span class='String'>'p'</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6277"><span class='Ref_To_Local'>storagemode</span></a><span class='Delimiter'>, </span><span class='String'>"external"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="tablecmds.c.html#LN6278"><span class='Ref_To_Local'>newstorage</span></a> <span class='Operator'>= </span><span class='String'>'e'</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6277"><span class='Ref_To_Local'>storagemode</span></a><span class='Delimiter'>, </span><span class='String'>"extended"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="tablecmds.c.html#LN6278"><span class='Ref_To_Local'>newstorage</span></a> <span class='Operator'>= </span><span class='String'>'x'</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6277"><span class='Ref_To_Local'>storagemode</span></a><span class='Delimiter'>, </span><span class='String'>"main"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="tablecmds.c.html#LN6278"><span class='Ref_To_Local'>newstorage</span></a> <span class='Operator'>= </span><span class='String'>'m'</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid storage type \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN6277"><span class='Ref_To_Local'>storagemode</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN6278"><span class='Ref_To_Local'>newstorage</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="tablecmds.c.html#LN6279"><span class='Ref_To_Local'>attrelation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN32"><span class='Ref_to_Const'>AttributeRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN6280"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN130"><span class='Ref_to_Proto'>SearchSysCacheCopyAttName</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6275"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6275"><span class='Ref_to_Parameter'>colName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6280"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" of relation \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN6275"><span class='Ref_to_Parameter'>colName</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6275"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN6281"><span class='Ref_To_Local'>attrtuple</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6280"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN6282"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN6281"><span class='Ref_To_Local'>attrtuple</span></a><span class='Operator'>-&GT;</span>attnum<span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6282"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot alter system column \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN6275"><span class='Ref_to_Parameter'>colName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * safety check: do not allow toasted storage modes unless column datatype 
     * is TOAST-aware. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6278"><span class='Ref_To_Local'>newstorage</span></a> <span class='Operator'>== </span><span class='String'>'p'</span> <span class='Operator'>|| </span><a href="../../include/utils/lsyscache.h.html#LN183"><span class='Ref_to_Macro'>TypeIsToastable</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6281"><span class='Ref_To_Local'>attrtuple</span></a><span class='Operator'>-&GT;</span>atttypid<span class='Parentheses'>))</span> 
        <a href="tablecmds.c.html#LN6281"><span class='Ref_To_Local'>attrtuple</span></a><span class='Operator'>-&GT;</span>attstorage <span class='Operator'>= </span><a href="tablecmds.c.html#LN6278"><span class='Ref_To_Local'>newstorage</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column data type %s can only have storage PLAIN"</span><span class='Delimiter'>, 
</span>                        <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6281"><span class='Ref_To_Local'>attrtuple</span></a><span class='Operator'>-&GT;</span>atttypid<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6279"><span class='Ref_To_Local'>attrelation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN6280"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6280"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6275"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="tablecmds.c.html#LN6281"><span class='Ref_To_Local'>attrtuple</span></a><span class='Operator'>-&GT;</span>attnum<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6280"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6279"><span class='Ref_To_Local'>attrelation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN32"><span class='Ref_to_Macro'>ObjectAddressSubSet</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6283"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6275"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6282"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="tablecmds.c.html#LN6283"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATExecSetStorage &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * ALTER TABLE DROP COLUMN 
 * 
 * DROP COLUMN cannot use the normal ALTER TABLE recursion mechanism, 
 * because we have to decide at runtime whether to recurse or not depending 
 * on whether attinhcount goes to zero or not.  (We can't check this in a 
 * static pre-pass because it won't handle multiple inheritance situations 
 * correctly.) 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN6361"></a><span class='Declare_Function'>ATPrepDropColumn</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>wqueue</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recurse</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recursing</span><span class='Delimiter'>, 
</span><a name="LN6362"></a>                 <a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cmd</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6361"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reloftype <span class='Operator'>&& !</span><a href="tablecmds.c.html#LN6361"><span class='Ref_to_Parameter'>recursing</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot drop column from typed table"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6361"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN165"><span class='Ref_to_Const'>RELKIND_COMPOSITE_TYPE</span></a><span class='Parentheses'>) 
</span>        <a href="tablecmds.c.html#LN349"><span class='Ref_to_Proto'>ATTypedTableRecursion</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6361"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6361"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6362"><span class='Ref_to_Parameter'>cmd</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6362"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6361"><span class='Ref_to_Parameter'>recurse</span></a><span class='Parentheses'>) 
</span>        <a href="tablecmds.c.html#LN6362"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1752"><span class='Ref_to_Member'>subtype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN1684"><span class='Ref_to_EnumConst'>AT_DropColumnRecurse</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Checks if attnum is a partition attribute for rel 
 * 
 * Sets *used_in_expr if attnum is found to be referenced in some partition 
 * key expression.  It's possible for a column to be both used directly and 
 * as part of an expression; if that happens, *used_in_expr may end up as 
 * either true or false.  That's OK for current uses of this function, because 
 * *used_in_expr is only used to tailor the error message text. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN6386"></a><span class='Declare_Function'>is_partition_attr</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a> <span class='Declare_Parameter'>attnum</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>used_in_expr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6388"></a>    <a href="../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>; 
</span><a name="LN6389"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>partnatts</span><span class='Delimiter'>; 
</span><a name="LN6390"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>partexprs</span><span class='Delimiter'>; 
</span><a name="LN6391"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>partexprs_item</span><span class='Delimiter'>; 
</span><a name="LN6392"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6386"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN6388"><span class='Ref_To_Local'>key</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN584"><span class='Ref_to_Macro'>RelationGetPartitionKey</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6386"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN6389"><span class='Ref_To_Local'>partnatts</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN595"><span class='Ref_to_Func'>get_partition_natts</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6388"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN6390"><span class='Ref_To_Local'>partexprs</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN601"><span class='Ref_to_Func'>get_partition_exprs</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6388"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN6391"><span class='Ref_To_Local'>partexprs_item</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6390"><span class='Ref_To_Local'>partexprs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6392"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN6392"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tablecmds.c.html#LN6389"><span class='Ref_To_Local'>partnatts</span></a><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN6392"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN6404"></a>        <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>partattno</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN610"><span class='Ref_to_Func'>get_partition_col_attnum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6388"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6392"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6404"><span class='Ref_To_Local'>partattno</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6386"><span class='Ref_to_Parameter'>attnum</span></a> <span class='Operator'>== </span><a href="tablecmds.c.html#LN6404"><span class='Ref_To_Local'>partattno</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6386"><span class='Ref_to_Parameter'>used_in_expr</span></a><span class='Parentheses'>) 
</span>                    <span class='Operator'>*</span><a href="tablecmds.c.html#LN6386"><span class='Ref_to_Parameter'>used_in_expr</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Arbitrary expression */ 
</span><a name="LN6418"></a>            <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6391"><span class='Ref_To_Local'>partexprs_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN6419"></a>            <a href="../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>expr_attrs</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Find all attributes referenced */ 
</span>            <a href="../../include/optimizer/var.h.html#LN31"><span class='Ref_to_Proto'>pull_varattnos</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6418"><span class='Ref_To_Local'>expr</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN6419"><span class='Ref_To_Local'>expr_attrs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN6391"><span class='Ref_To_Local'>partexprs_item</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6391"><span class='Ref_To_Local'>partexprs_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/bitmapset.h.html#LN75"><span class='Ref_to_Proto'>bms_is_member</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6386"><span class='Ref_to_Parameter'>attnum</span></a> <span class='Operator'>- </span><a href="../../include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a><span class='Delimiter'>, 
</span>                              <a href="tablecmds.c.html#LN6419"><span class='Ref_To_Local'>expr_attrs</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6386"><span class='Ref_to_Parameter'>used_in_expr</span></a><span class='Parentheses'>) 
</span>                    <span class='Operator'>*</span><a href="tablecmds.c.html#LN6386"><span class='Ref_to_Parameter'>used_in_expr</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;partnatts;i++ &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end is_partition_attr &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Return value is the address of the dropped column. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN6442"></a><span class='Declare_Function'>ATExecDropColumn</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>wqueue</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colName</span><span class='Delimiter'>, 
</span><a name="LN6443"></a>                 <a href="../../include/nodes/parsenodes.h.html#LN1652"><span class='Ref_to_Enum'>DropBehavior</span></a> <span class='Declare_Parameter'>behavior</span><span class='Delimiter'>, 
</span><a name="LN6444"></a>                 <span class='Keyword'>bool </span><span class='Declare_Parameter'>recurse</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recursing</span><span class='Delimiter'>, 
</span><a name="LN6445"></a>                 <span class='Keyword'>bool </span><span class='Declare_Parameter'>missing_ok</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6447"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN6448"></a>    <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>targetatt</span><span class='Delimiter'>; 
</span><a name="LN6449"></a>    <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>attnum</span><span class='Delimiter'>; 
</span><a name="LN6450"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>children</span><span class='Delimiter'>; 
</span><a name="LN6451"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>object</span><span class='Delimiter'>; 
</span><a name="LN6452"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_expr</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* At top level, permission check was done in ATPrepCmd, else do it */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6444"><span class='Ref_to_Parameter'>recursing</span></a><span class='Parentheses'>) 
</span>        <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6442"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN283"><span class='Ref_to_Const'>ATT_FOREIGN_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * get the number of the attribute 
     */ 
</span>    <a href="tablecmds.c.html#LN6447"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN129"><span class='Ref_to_Proto'>SearchSysCacheAttName</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6442"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6442"><span class='Ref_to_Parameter'>colName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6447"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN6445"><span class='Ref_to_Parameter'>missing_ok</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" of relation \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                            <a href="tablecmds.c.html#LN6442"><span class='Ref_to_Parameter'>colName</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6442"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" of relation \"%s\" does not exist, skipping"</span><span class='Delimiter'>, 
</span>                            <a href="tablecmds.c.html#LN6442"><span class='Ref_to_Parameter'>colName</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6442"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="../catalog/objectaddress.c.html#LN718"><span class='Ref_to_Global_Var'>InvalidObjectAddress</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <a href="tablecmds.c.html#LN6448"><span class='Ref_To_Local'>targetatt</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6447"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN6449"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN6448"><span class='Ref_To_Local'>targetatt</span></a><span class='Operator'>-&GT;</span>attnum<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Can't drop a system attribute, except OID */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6449"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="tablecmds.c.html#LN6449"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>!= </span><a href="../../include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot drop system column \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN6442"><span class='Ref_to_Parameter'>colName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Don't drop inherited columns */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6448"><span class='Ref_To_Local'>targetatt</span></a><span class='Operator'>-&GT;</span>attinhcount <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& !</span><a href="tablecmds.c.html#LN6444"><span class='Ref_to_Parameter'>recursing</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TABLE_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot drop inherited column \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN6442"><span class='Ref_to_Parameter'>colName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Don't drop columns used in the partition key */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN467"><span class='Ref_to_Proto'>is_partition_attr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6442"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6449"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN6452"><span class='Ref_To_Local'>is_expr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN6452"><span class='Ref_To_Local'>is_expr</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TABLE_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot drop column named in partition key"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TABLE_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot drop column referenced in partition key expression"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6447"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Propagate to children as appropriate.  Unlike most other ALTER 
     * routines, we have to do this one level of recursion at a time; we can't 
     * use find_all_inheritors to do it in one pass. 
     */ 
</span>    <a href="tablecmds.c.html#LN6450"><span class='Ref_To_Local'>children</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_inherits_fn.h.html#LN19"><span class='Ref_to_Proto'>find_inheritance_children</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6442"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6445"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6450"><span class='Ref_To_Local'>children</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN6521"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>attr_rel</span><span class='Delimiter'>; 
</span><a name="LN6522"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>child</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * In case of a partitioned table, the column must be dropped from the 
         * partitions as well. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6442"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a> <span class='Operator'>&& !</span><a href="tablecmds.c.html#LN6444"><span class='Ref_to_Parameter'>recurse</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TABLE_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot drop column from only the partitioned table when partitions exist"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Do not specify the ONLY keyword."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN6521"><span class='Ref_To_Local'>attr_rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN32"><span class='Ref_to_Const'>AttributeRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6522"><span class='Ref_To_Local'>child</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6450"><span class='Ref_To_Local'>children</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN6537"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>childrelid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6522"><span class='Ref_To_Local'>child</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN6538"></a>            <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>childrel</span><span class='Delimiter'>; 
</span><a name="LN6539"></a>            <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>childatt</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* find_inheritance_children already got lock */ 
</span>            <a href="tablecmds.c.html#LN6538"><span class='Ref_To_Local'>childrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6537"><span class='Ref_To_Local'>childrelid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/commands/tablecmds.h.html#LN52"><span class='Ref_to_Proto'>CheckTableNotInUse</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6538"><span class='Ref_To_Local'>childrel</span></a><span class='Delimiter'>, </span><span class='String'>"ALTER TABLE"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="tablecmds.c.html#LN6447"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN130"><span class='Ref_to_Proto'>SearchSysCacheCopyAttName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6537"><span class='Ref_To_Local'>childrelid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6442"><span class='Ref_to_Parameter'>colName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6447"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span>       <span class='Comment_Single_Line'>/* shouldn't happen */ 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for attribute \"%s\" of relation %u"</span><span class='Delimiter'>, 
</span>                     <a href="tablecmds.c.html#LN6442"><span class='Ref_to_Parameter'>colName</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6537"><span class='Ref_To_Local'>childrelid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN6539"><span class='Ref_To_Local'>childatt</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6447"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6539"><span class='Ref_To_Local'>childatt</span></a><span class='Operator'>-&GT;</span>attinhcount <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span>     <span class='Comment_Single_Line'>/* shouldn't happen */ 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"relation %u has non-inherited attribute \"%s\""</span><span class='Delimiter'>, 
</span>                     <a href="tablecmds.c.html#LN6537"><span class='Ref_To_Local'>childrelid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6442"><span class='Ref_to_Parameter'>colName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6444"><span class='Ref_to_Parameter'>recurse</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * If the child column has other definition sources, just 
                 * decrement its inheritance count; if not, recurse to delete 
                 * it. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6539"><span class='Ref_To_Local'>childatt</span></a><span class='Operator'>-&GT;</span>attinhcount <span class='Operator'>== </span><span class='Number'>1</span> <span class='Operator'>&& !</span><a href="tablecmds.c.html#LN6539"><span class='Ref_To_Local'>childatt</span></a><span class='Operator'>-&GT;</span>attislocal<span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* Time to delete this child column, too */ 
</span>                    <a href="tablecmds.c.html#LN387"><span class='Ref_to_Proto'>ATExecDropColumn</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6442"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6538"><span class='Ref_To_Local'>childrel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6442"><span class='Ref_to_Parameter'>colName</span></a><span class='Delimiter'>, 
</span>                                     <a href="tablecmds.c.html#LN6443"><span class='Ref_to_Parameter'>behavior</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                     <span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6445"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* Child column must survive my deletion */ 
</span>                    <a href="tablecmds.c.html#LN6539"><span class='Ref_To_Local'>childatt</span></a><span class='Operator'>-&GT;</span>attinhcount<span class='Operator'>--</span><span class='Delimiter'>; 
</span> 
                    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6521"><span class='Ref_To_Local'>attr_rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN6447"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6447"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* Make update visible */ 
</span>                    <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if recurse &raquo; </span> 
            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * If we were told to drop ONLY in this table (no recursion), 
                 * we need to mark the inheritors' attributes as locally 
                 * defined rather than inherited. 
                 */ 
</span>                <a href="tablecmds.c.html#LN6539"><span class='Ref_To_Local'>childatt</span></a><span class='Operator'>-&GT;</span>attinhcount<span class='Operator'>--</span><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN6539"><span class='Ref_To_Local'>childatt</span></a><span class='Operator'>-&GT;</span>attislocal <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
                <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6521"><span class='Ref_To_Local'>attr_rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN6447"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6447"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Make update visible */ 
</span>                <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6447"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6538"><span class='Ref_To_Local'>childrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6521"><span class='Ref_To_Local'>attr_rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if children &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Perform the actual column deletion 
     */ 
</span>    <a href="tablecmds.c.html#LN6451"><span class='Ref_To_Local'>object</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN6451"><span class='Ref_To_Local'>object</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6442"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN6451"><span class='Ref_To_Local'>object</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN6449"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/dependency.h.html#LN182"><span class='Ref_to_Proto'>performDeletion</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN6451"><span class='Ref_To_Local'>object</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6443"><span class='Ref_to_Parameter'>behavior</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we dropped the OID column, must adjust pg_class.relhasoids and tell 
     * Phase 3 to physically get rid of the column.  We formerly left the 
     * column in place physically, but this caused subtle problems.  See 
     * http://archives.postgresql.org/pgsql-hackers/2009-02/msg00363.php 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6449"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>== </span><a href="../../include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN6620"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>class_rel</span><span class='Delimiter'>; 
</span><a name="LN6621"></a>        <a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Local'>tuple_class</span><span class='Delimiter'>; 
</span><a name="LN6622"></a>        <a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tab</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN6620"><span class='Ref_To_Local'>class_rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN6447"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, 
</span>                                    <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6442"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6447"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for relation %u"</span><span class='Delimiter'>, 
</span>                 <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6442"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN6621"><span class='Ref_To_Local'>tuple_class</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6447"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN6621"><span class='Ref_To_Local'>tuple_class</span></a><span class='Operator'>-&GT;</span>relhasoids <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6620"><span class='Ref_To_Local'>class_rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN6447"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6447"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6620"><span class='Ref_To_Local'>class_rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Find or create work queue entry for this table */ 
</span>        <a href="tablecmds.c.html#LN6622"><span class='Ref_To_Local'>tab</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN344"><span class='Ref_to_Proto'>ATGetQueueEntry</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6442"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6442"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Tell Phase 3 to physically remove the OID column */ 
</span>        <a href="tablecmds.c.html#LN6622"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN165"><span class='Ref_to_Member'>rewrite</span></a> <span class='Operator'>|= </span><a href="../../include/commands/event_trigger.h.html#LN33"><span class='Ref_to_Const'>AT_REWRITE_ALTER_OID</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if attnum==ObjectIdAttri... &raquo; </span> 
 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN6451"><span class='Ref_To_Local'>object</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATExecDropColumn &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ALTER TABLE ADD INDEX 
 * 
 * There is no such command in the grammar, but parse_utilcmd.c converts 
 * UNIQUE and PRIMARY KEY constraints into AT_AddIndex subcommands.  This lets 
 * us schedule creation of the index at the appropriate time during ALTER. 
 * 
 * Return value is the address of the new index. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN6658"></a><span class='Declare_Function'>ATExecAddIndex</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tab</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN6659"></a>               <a href="../../include/nodes/parsenodes.h.html#LN2667"><span class='Ref_to_Struct'>IndexStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>is_rebuild</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6661"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>check_rights</span><span class='Delimiter'>; 
</span><a name="LN6662"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>skip_build</span><span class='Delimiter'>; 
</span><a name="LN6663"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>quiet</span><span class='Delimiter'>; 
</span><a name="LN6664"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6659"><span class='Ref_to_Parameter'>stmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2667"><span class='Ref_to_Struct'>IndexStmt</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN6659"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2687"><span class='Ref_to_Member'>concurrent</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* The IndexStmt has already been through transformIndexStmt */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6659"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2686"><span class='Ref_to_Member'>transformed</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* suppress schema rights check when rebuilding existing index */ 
</span>    <a href="tablecmds.c.html#LN6661"><span class='Ref_To_Local'>check_rights</span></a> <span class='Operator'>= !</span><a href="tablecmds.c.html#LN6659"><span class='Ref_to_Parameter'>is_rebuild</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* skip index build if phase 3 will do it or we're reusing an old one */ 
</span>    <a href="tablecmds.c.html#LN6662"><span class='Ref_To_Local'>skip_build</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN6658"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN165"><span class='Ref_to_Member'>rewrite</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6659"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2680"><span class='Ref_to_Member'>oldNode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* suppress notices when rebuilding existing index */ 
</span>    <a href="tablecmds.c.html#LN6663"><span class='Ref_To_Local'>quiet</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN6659"><span class='Ref_to_Parameter'>is_rebuild</span></a><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN6664"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="../../include/commands/defrem.h.html#LN24"><span class='Ref_to_Proto'>DefineIndex</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6658"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                          <a href="tablecmds.c.html#LN6659"><span class='Ref_to_Parameter'>stmt</span></a><span class='Delimiter'>, 
</span>                          <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>   <span class='Comment_Single_Line'>/* no predefined OID */ 
</span>                          <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* is_alter_table */ 
</span>                          <a href="tablecmds.c.html#LN6661"><span class='Ref_To_Local'>check_rights</span></a><span class='Delimiter'>, 
</span>                          <span class='Boolean'>false</span><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* check_not_in_use - we did it already */ 
</span>                          <a href="tablecmds.c.html#LN6662"><span class='Ref_To_Local'>skip_build</span></a><span class='Delimiter'>, 
</span>                          <a href="tablecmds.c.html#LN6663"><span class='Ref_To_Local'>quiet</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If TryReuseIndex() stashed a relfilenode for us, we used it for the new 
     * index instead of building from scratch.  The DROP of the old edition of 
     * this index will have scheduled the storage for deletion at commit, so 
     * cancel that pending deletion. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6659"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2680"><span class='Ref_to_Member'>oldNode</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN6696"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>irel</span> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN129"><span class='Ref_to_Proto'>index_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6664"><span class='Ref_To_Local'>address</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/storage.h.html#LN22"><span class='Ref_to_Proto'>RelationPreserveStorage</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6696"><span class='Ref_To_Local'>irel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN84"><span class='Ref_to_Member'>rd_node</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/access/genam.h.html#LN130"><span class='Ref_to_Proto'>index_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6696"><span class='Ref_To_Local'>irel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN6664"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATExecAddIndex &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ALTER TABLE ADD CONSTRAINT USING INDEX 
 * 
 * Returns the address of the new constraint. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN6711"></a><span class='Declare_Function'>ATExecAddIndexConstraint</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tab</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN6712"></a>                         <a href="../../include/nodes/parsenodes.h.html#LN2667"><span class='Ref_to_Struct'>IndexStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6714"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>index_oid</span> <span class='Operator'>= </span><a href="tablecmds.c.html#LN6712"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2679"><span class='Ref_to_Member'>indexOid</span></a><span class='Delimiter'>; 
</span><a name="LN6715"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>indexRel</span><span class='Delimiter'>; 
</span><a name="LN6716"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>indexName</span><span class='Delimiter'>; 
</span><a name="LN6717"></a>    <a href="../../include/nodes/execnodes.h.html#LN130"><span class='Ref_to_Struct'>IndexInfo</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>indexInfo</span><span class='Delimiter'>; 
</span><a name="LN6718"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>constraintName</span><span class='Delimiter'>; 
</span><a name="LN6719"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>constraintType</span><span class='Delimiter'>; 
</span><a name="LN6720"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6712"><span class='Ref_to_Parameter'>stmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2667"><span class='Ref_to_Struct'>IndexStmt</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6714"><span class='Ref_To_Local'>index_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6712"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2683"><span class='Ref_to_Member'>isconstraint</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN6715"><span class='Ref_To_Local'>indexRel</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN129"><span class='Ref_to_Proto'>index_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6714"><span class='Ref_To_Local'>index_oid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN6716"><span class='Ref_To_Local'>indexName</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6715"><span class='Ref_To_Local'>indexRel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN6717"><span class='Ref_To_Local'>indexInfo</span></a> <span class='Operator'>= </span><a href="../../include/catalog/index.h.html#LN81"><span class='Ref_to_Proto'>BuildIndexInfo</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6715"><span class='Ref_To_Local'>indexRel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* this should have been checked at parse time */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN6717"><span class='Ref_To_Local'>indexInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN145"><span class='Ref_to_Member'>ii_Unique</span></a><span class='Parentheses'>) 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"index \"%s\" is not unique"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6716"><span class='Ref_To_Local'>indexName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Determine name to assign to constraint.  We require a constraint to 
     * have the same name as the underlying index; therefore, use the index's 
     * existing name as the default constraint name, and if the user 
     * explicitly gives some other name for the constraint, rename the index 
     * to match. 
     */ 
</span>    <a href="tablecmds.c.html#LN6718"><span class='Ref_To_Local'>constraintName</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN6712"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2670"><span class='Ref_to_Member'>idxname</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6718"><span class='Ref_To_Local'>constraintName</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="tablecmds.c.html#LN6718"><span class='Ref_To_Local'>constraintName</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN6716"><span class='Ref_To_Local'>indexName</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6718"><span class='Ref_To_Local'>constraintName</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6716"><span class='Ref_To_Local'>indexName</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"ALTER TABLE / ADD CONSTRAINT USING INDEX will rename index \"%s\" to \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN6716"><span class='Ref_To_Local'>indexName</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6718"><span class='Ref_To_Local'>constraintName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="../../include/commands/tablecmds.h.html#LN66"><span class='Ref_to_Proto'>RenameRelationInternal</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6714"><span class='Ref_To_Local'>index_oid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6718"><span class='Ref_To_Local'>constraintName</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Extra checks needed if making primary key */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6712"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2682"><span class='Ref_to_Member'>primary</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/catalog/index.h.html#LN40"><span class='Ref_to_Proto'>index_check_primary_key</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6711"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6717"><span class='Ref_To_Local'>indexInfo</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Note we currently don't support EXCLUSION constraints here */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6712"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2682"><span class='Ref_to_Member'>primary</span></a><span class='Parentheses'>) 
</span>        <a href="tablecmds.c.html#LN6719"><span class='Ref_To_Local'>constraintType</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_constraint.h.html#LN189"><span class='Ref_to_Const'>CONSTRAINT_PRIMARY</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="tablecmds.c.html#LN6719"><span class='Ref_To_Local'>constraintType</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_constraint.h.html#LN190"><span class='Ref_to_Const'>CONSTRAINT_UNIQUE</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create the catalog entries for the constraint */ 
</span>    <a href="tablecmds.c.html#LN6720"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="../../include/catalog/index.h.html#LN66"><span class='Ref_to_Proto'>index_constraint_create</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6711"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, 
</span>                                      <a href="tablecmds.c.html#LN6714"><span class='Ref_To_Local'>index_oid</span></a><span class='Delimiter'>, 
</span>                                      <a href="tablecmds.c.html#LN6717"><span class='Ref_To_Local'>indexInfo</span></a><span class='Delimiter'>, 
</span>                                      <a href="tablecmds.c.html#LN6718"><span class='Ref_To_Local'>constraintName</span></a><span class='Delimiter'>, 
</span>                                      <a href="tablecmds.c.html#LN6719"><span class='Ref_To_Local'>constraintType</span></a><span class='Delimiter'>, 
</span>                                      <a href="tablecmds.c.html#LN6712"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2684"><span class='Ref_to_Member'>deferrable</span></a><span class='Delimiter'>, 
</span>                                      <a href="tablecmds.c.html#LN6712"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2685"><span class='Ref_to_Member'>initdeferred</span></a><span class='Delimiter'>, 
</span>                                      <a href="tablecmds.c.html#LN6712"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2682"><span class='Ref_to_Member'>primary</span></a><span class='Delimiter'>, 
</span>                                      <span class='Boolean'>true</span><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* update pg_index */ 
</span>                                      <span class='Boolean'>true</span><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* remove old dependencies */ 
</span>                                      <a href="../utils/init/globals.c.html#LN111"><span class='Ref_to_Global_Var'>allowSystemTableMods</span></a><span class='Delimiter'>, 
</span>                                      <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* is_internal */ 
</span> 
    <a href="../../include/access/genam.h.html#LN130"><span class='Ref_to_Proto'>index_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6715"><span class='Ref_To_Local'>indexRel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN6720"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATExecAddIndexConstraint &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ALTER TABLE ADD CONSTRAINT 
 * 
 * Return value is the address of the new constraint; if no constraint was 
 * added, InvalidObjectAddress is returned. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN6790"></a><span class='Declare_Function'>ATExecAddConstraint</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>wqueue</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tab</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN6791"></a>                    <a href="../../include/nodes/parsenodes.h.html#LN2050"><span class='Ref_to_Struct'>Constraint</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>newConstraint</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recurse</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>is_readd</span><span class='Delimiter'>, 
</span><a name="LN6792"></a>                    <a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6794"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span> <span class='Operator'>= </span><a href="../catalog/objectaddress.c.html#LN718"><span class='Ref_to_Global_Var'>InvalidObjectAddress</span></a><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6791"><span class='Ref_to_Parameter'>newConstraint</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2050"><span class='Ref_to_Struct'>Constraint</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Currently, we only expect to see CONSTR_CHECK and CONSTR_FOREIGN nodes 
     * arriving here (see the preprocessing done in parse_utilcmd.c).  Use a 
     * switch anyway to make it easier to add more code later. 
     */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6791"><span class='Ref_to_Parameter'>newConstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2053"><span class='Ref_to_Member'>contype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2027"><span class='Ref_to_EnumConst'>CONSTR_CHECK</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN6794"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= 
</span>                <a href="tablecmds.c.html#LN399"><span class='Ref_to_Proto'>ATAddCheckConstraint</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6790"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6790"><span class='Ref_to_Parameter'>tab</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6790"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, 
</span>                                     <a href="tablecmds.c.html#LN6791"><span class='Ref_to_Parameter'>newConstraint</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6791"><span class='Ref_to_Parameter'>recurse</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6791"><span class='Ref_to_Parameter'>is_readd</span></a><span class='Delimiter'>, 
</span>                                     <a href="tablecmds.c.html#LN6792"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2031"><span class='Ref_to_EnumConst'>CONSTR_FOREIGN</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Note that we currently never recurse for FK constraints, so the 
             * "recurse" flag is silently ignored. 
             * 
             * Assign or validate constraint name 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6791"><span class='Ref_to_Parameter'>newConstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2056"><span class='Ref_to_Member'>conname</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint_fn.h.html#LN62"><span class='Ref_to_Proto'>ConstraintNameIsUsed</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint_fn.h.html#LN24"><span class='Ref_to_EnumConst'>CONSTRAINT_RELATION</span></a><span class='Delimiter'>, 
</span>                                         <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6790"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <a href="../../include/utils/rel.h.html#LN443"><span class='Ref_to_Macro'>RelationGetNamespace</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6790"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <a href="tablecmds.c.html#LN6791"><span class='Ref_to_Parameter'>newConstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2056"><span class='Ref_to_Member'>conname</span></a><span class='Parentheses'>))</span> 
                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/pg_basebackup/streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"constraint \"%s\" for relation \"%s\" already exists"</span><span class='Delimiter'>, 
</span>                                    <a href="tablecmds.c.html#LN6791"><span class='Ref_to_Parameter'>newConstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2056"><span class='Ref_to_Member'>conname</span></a><span class='Delimiter'>, 
</span>                                    <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6790"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
                <a href="tablecmds.c.html#LN6791"><span class='Ref_to_Parameter'>newConstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2056"><span class='Ref_to_Member'>conname</span></a> <span class='Operator'>= 
</span>                    <a href="../../include/catalog/pg_constraint_fn.h.html#LN64"><span class='Ref_to_Proto'>ChooseConstraintName</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6790"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6791"><span class='Ref_to_Parameter'>newConstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2083"><span class='Ref_to_Member'>fk_attrs</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                                         <span class='String'>"fkey"</span><span class='Delimiter'>, 
</span>                                         <a href="../../include/utils/rel.h.html#LN443"><span class='Ref_to_Macro'>RelationGetNamespace</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6790"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="tablecmds.c.html#LN6794"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN404"><span class='Ref_to_Proto'>ATAddForeignKeyConstraint</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6790"><span class='Ref_to_Parameter'>tab</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6790"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6791"><span class='Ref_to_Parameter'>newConstraint</span></a><span class='Delimiter'>, 
</span>                                                <a href="tablecmds.c.html#LN6792"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized constraint type: %d"</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN6791"><span class='Ref_to_Parameter'>newConstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2053"><span class='Ref_to_Member'>contype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch newConstraint-&GT;contyp... &raquo; </span> 
 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN6794"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATExecAddConstraint &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Add a check constraint to a single table and its children.  Returns the 
 * address of the constraint added to the parent relation, if one gets added, 
 * or InvalidObjectAddress otherwise. 
 * 
 * Subroutine for ATExecAddConstraint. 
 * 
 * We must recurse to child tables during execution, rather than using 
 * ALTER TABLE's normal prep-time recursion.  The reason is that all the 
 * constraints *must* be given the same name, else they won't be seen as 
 * related later.  If the user didn't explicitly specify a name, then 
 * AddRelationNewConstraints would normally assign different names to the 
 * child constraints.  To fix that, we must capture the name assigned at 
 * the parent table and pass that down. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN6868"></a><span class='Declare_Function'>ATAddCheckConstraint</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>wqueue</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tab</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN6869"></a>                     <a href="../../include/nodes/parsenodes.h.html#LN2050"><span class='Ref_to_Struct'>Constraint</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>constr</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recurse</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recursing</span><span class='Delimiter'>, 
</span><a name="LN6870"></a>                     <span class='Keyword'>bool </span><span class='Declare_Parameter'>is_readd</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6872"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>newcons</span><span class='Delimiter'>; 
</span><a name="LN6873"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lcon</span><span class='Delimiter'>; 
</span><a name="LN6874"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>children</span><span class='Delimiter'>; 
</span><a name="LN6875"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>child</span><span class='Delimiter'>; 
</span><a name="LN6876"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span> <span class='Operator'>= </span><a href="../catalog/objectaddress.c.html#LN718"><span class='Ref_to_Global_Var'>InvalidObjectAddress</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* At top level, permission check was done in ATPrepCmd, else do it */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6869"><span class='Ref_to_Parameter'>recursing</span></a><span class='Parentheses'>) 
</span>        <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6868"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN283"><span class='Ref_to_Const'>ATT_FOREIGN_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Call AddRelationNewConstraints to do the work, making sure it works on 
     * a copy of the Constraint so transformExpr can't modify the original. It 
     * returns a list of cooked constraints. 
     * 
     * If the constraint ends up getting merged with a pre-existing one, it's 
     * omitted from the returned list, which is what we want: we do not need 
     * to do any validation work.  That can only happen at child tables, 
     * though, since we disallow merging at the top level. 
     */ 
</span>    <a href="tablecmds.c.html#LN6872"><span class='Ref_To_Local'>newcons</span></a> <span class='Operator'>= </span><a href="../../include/catalog/heap.h.html#LN97"><span class='Ref_to_Proto'>AddRelationNewConstraints</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6868"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6869"><span class='Ref_to_Parameter'>constr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                                        <a href="tablecmds.c.html#LN6869"><span class='Ref_to_Parameter'>recursing</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN6870"><span class='Ref_to_Parameter'>is_readd</span></a><span class='Delimiter'>,</span>   <span class='Comment_Single_Line'>/* allow_merge */ 
</span>                                        <span class='Operator'>!</span><a href="tablecmds.c.html#LN6869"><span class='Ref_to_Parameter'>recursing</span></a><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* is_local */ 
</span>                                        <a href="tablecmds.c.html#LN6870"><span class='Ref_to_Parameter'>is_readd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* is_internal */ 
</span> 
    <span class='Comment_Multi_Line'>/* we don't expect more than one constraint here */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6872"><span class='Ref_To_Local'>newcons</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Add each to-be-validated constraint to Phase 3's queue */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6873"><span class='Ref_To_Local'>lcon</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6872"><span class='Ref_To_Local'>newcons</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN6904"></a>        <a href="../../include/catalog/heap.h.html#LN27"><span class='Ref_to_Struct'>CookedConstraint</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ccon</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/heap.h.html#LN27"><span class='Ref_to_Struct'>CookedConstraint</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6873"><span class='Ref_To_Local'>lcon</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN6904"><span class='Ref_To_Local'>ccon</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/heap.h.html#LN34"><span class='Ref_to_Member'>skip_validation</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN6908"></a>            <a href="tablecmds.c.html#LN179"><span class='Ref_to_Struct'>NewConstraint</span></a> <span class='Operator'>*</span><span class='Declare_Local'>newcon</span><span class='Delimiter'>; 
</span> 
            <a href="tablecmds.c.html#LN6908"><span class='Ref_To_Local'>newcon</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN179"><span class='Ref_to_Struct'>NewConstraint</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN179"><span class='Ref_to_Struct'>NewConstraint</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN6908"><span class='Ref_To_Local'>newcon</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN181"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN6904"><span class='Ref_To_Local'>ccon</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/heap.h.html#LN31"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN6908"><span class='Ref_To_Local'>newcon</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN182"><span class='Ref_to_Member'>contype</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN6904"><span class='Ref_To_Local'>ccon</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/heap.h.html#LN29"><span class='Ref_to_Member'>contype</span></a><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN6908"><span class='Ref_To_Local'>newcon</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN186"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN6904"><span class='Ref_To_Local'>ccon</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/heap.h.html#LN33"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>; 
</span> 
            <a href="tablecmds.c.html#LN6868"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN162"><span class='Ref_to_Member'>constraints</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6868"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN162"><span class='Ref_to_Member'>constraints</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6908"><span class='Ref_To_Local'>newcon</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Save the actually assigned name if it was defaulted */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6869"><span class='Ref_to_Parameter'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2056"><span class='Ref_to_Member'>conname</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="tablecmds.c.html#LN6869"><span class='Ref_to_Parameter'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2056"><span class='Ref_to_Member'>conname</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN6904"><span class='Ref_To_Local'>ccon</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/heap.h.html#LN31"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6876"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_constraint.h.html#LN28"><span class='Ref_to_Const'>ConstraintRelationId</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6904"><span class='Ref_To_Local'>ccon</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/heap.h.html#LN30"><span class='Ref_to_Member'>conoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* At this point we must have a locked-down name to use */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6869"><span class='Ref_to_Parameter'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2056"><span class='Ref_to_Member'>conname</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Advance command counter in case same table is visited multiple times */ 
</span>    <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the constraint got merged with an existing constraint, we're done. 
     * We mustn't recurse to child tables in this case, because they've 
     * already got the constraint, and visiting them again would lead to an 
     * incorrect value for coninhcount. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6872"><span class='Ref_To_Local'>newcons</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="tablecmds.c.html#LN6876"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If adding a NO INHERIT constraint, no need to find our children. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6869"><span class='Ref_to_Parameter'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2062"><span class='Ref_to_Member'>is_no_inherit</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="tablecmds.c.html#LN6876"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Propagate to children as appropriate.  Unlike most other ALTER 
     * routines, we have to do this one level of recursion at a time; we can't 
     * use find_all_inheritors to do it in one pass. 
     */ 
</span>    <a href="tablecmds.c.html#LN6874"><span class='Ref_To_Local'>children</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_inherits_fn.h.html#LN19"><span class='Ref_to_Proto'>find_inheritance_children</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6868"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6870"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check if ONLY was specified with ALTER TABLE.  If so, allow the 
     * constraint creation only if there are no children currently.  Error out 
     * otherwise. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN6869"><span class='Ref_to_Parameter'>recurse</span></a> <span class='Operator'>&& </span><a href="tablecmds.c.html#LN6874"><span class='Ref_To_Local'>children</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TABLE_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"constraint must be added to child tables too"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6875"><span class='Ref_To_Local'>child</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6874"><span class='Ref_To_Local'>children</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN6965"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>childrelid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6875"><span class='Ref_To_Local'>child</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN6966"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>childrel</span><span class='Delimiter'>; 
</span><a name="LN6967"></a>        <a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>childtab</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* find_inheritance_children already got lock */ 
</span>        <a href="tablecmds.c.html#LN6966"><span class='Ref_To_Local'>childrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6965"><span class='Ref_To_Local'>childrelid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/commands/tablecmds.h.html#LN52"><span class='Ref_to_Proto'>CheckTableNotInUse</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6966"><span class='Ref_To_Local'>childrel</span></a><span class='Delimiter'>, </span><span class='String'>"ALTER TABLE"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Find or create work queue entry for this table */ 
</span>        <a href="tablecmds.c.html#LN6967"><span class='Ref_To_Local'>childtab</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN344"><span class='Ref_to_Proto'>ATGetQueueEntry</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6868"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6966"><span class='Ref_To_Local'>childrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Recurse to child */ 
</span>        <a href="tablecmds.c.html#LN399"><span class='Ref_to_Proto'>ATAddCheckConstraint</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6868"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6967"><span class='Ref_To_Local'>childtab</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6966"><span class='Ref_To_Local'>childrel</span></a><span class='Delimiter'>, 
</span>                             <a href="tablecmds.c.html#LN6869"><span class='Ref_to_Parameter'>constr</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6869"><span class='Ref_to_Parameter'>recurse</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6870"><span class='Ref_to_Parameter'>is_readd</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6870"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6966"><span class='Ref_To_Local'>childrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN6876"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATAddCheckConstraint &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Add a foreign-key constraint to a single table; return the new constraint's 
 * address. 
 * 
 * Subroutine for ATExecAddConstraint.  Must already hold exclusive 
 * lock on the rel, and have done appropriate validity checks for it. 
 * We do permissions checks here, however. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN6995"></a><span class='Declare_Function'>ATAddForeignKeyConstraint</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tab</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN6996"></a>                          <a href="../../include/nodes/parsenodes.h.html#LN2050"><span class='Ref_to_Struct'>Constraint</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fkconstraint</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6998"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pkrel</span><span class='Delimiter'>; 
</span><a name="LN6999"></a>    <a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>pkattnum</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN45"><span class='Ref_to_Const'>INDEX_MAX_KEYS</span></a><span class='Delimiter'>]; 
</span><a name="LN7000"></a>    <a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>fkattnum</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN45"><span class='Ref_to_Const'>INDEX_MAX_KEYS</span></a><span class='Delimiter'>]; 
</span><a name="LN7001"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>pktypoid</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN45"><span class='Ref_to_Const'>INDEX_MAX_KEYS</span></a><span class='Delimiter'>]; 
</span><a name="LN7002"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>fktypoid</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN45"><span class='Ref_to_Const'>INDEX_MAX_KEYS</span></a><span class='Delimiter'>]; 
</span><a name="LN7003"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>opclasses</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN45"><span class='Ref_to_Const'>INDEX_MAX_KEYS</span></a><span class='Delimiter'>]; 
</span><a name="LN7004"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>pfeqoperators</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN45"><span class='Ref_to_Const'>INDEX_MAX_KEYS</span></a><span class='Delimiter'>]; 
</span><a name="LN7005"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ppeqoperators</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN45"><span class='Ref_to_Const'>INDEX_MAX_KEYS</span></a><span class='Delimiter'>]; 
</span><a name="LN7006"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ffeqoperators</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN45"><span class='Ref_to_Const'>INDEX_MAX_KEYS</span></a><span class='Delimiter'>]; 
</span><a name="LN7007"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN7008"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numfks</span><span class='Delimiter'>, 
</span><a name="LN7009"></a>                <span class='Declare_Local'>numpks</span><span class='Delimiter'>; 
</span><a name="LN7010"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>indexOid</span><span class='Delimiter'>; 
</span><a name="LN7011"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>constrOid</span><span class='Delimiter'>; 
</span><a name="LN7012"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>old_check_ok</span><span class='Delimiter'>; 
</span><a name="LN7013"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span><a name="LN7014"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>old_pfeqop_item</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6996"><span class='Ref_to_Parameter'>fkconstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2088"><span class='Ref_to_Member'>old_conpfeqop</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Grab ShareRowExclusiveLock on the pk table, so that someone doesn't 
     * delete rows out from under us. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6996"><span class='Ref_to_Parameter'>fkconstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2089"><span class='Ref_to_Member'>old_pktable_oid</span></a><span class='Parentheses'>))</span> 
        <a href="tablecmds.c.html#LN6998"><span class='Ref_To_Local'>pkrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6996"><span class='Ref_to_Parameter'>fkconstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2089"><span class='Ref_to_Member'>old_pktable_oid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN41"><span class='Ref_to_Const'>ShareRowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="tablecmds.c.html#LN6998"><span class='Ref_To_Local'>pkrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN92"><span class='Ref_to_Proto'>heap_openrv</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6996"><span class='Ref_to_Parameter'>fkconstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2082"><span class='Ref_to_Member'>pktable</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN41"><span class='Ref_to_Const'>ShareRowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Validity checks (permission checks wait till we have the column 
     * numbers) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6998"><span class='Ref_To_Local'>pkrel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot reference partitioned table \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6998"><span class='Ref_To_Local'>pkrel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6998"><span class='Ref_To_Local'>pkrel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"referenced relation \"%s\" is not a table"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6998"><span class='Ref_To_Local'>pkrel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/init/globals.c.html#LN111"><span class='Ref_to_Global_Var'>allowSystemTableMods</span></a> <span class='Operator'>&& </span><a href="../../include/catalog/catalog.h.html#LN29"><span class='Ref_to_Proto'>IsSystemRelation</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6998"><span class='Ref_To_Local'>pkrel</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied: \"%s\" is a system catalog"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6998"><span class='Ref_To_Local'>pkrel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * References from permanent or unlogged tables to temp tables, and from 
     * permanent tables to unlogged tables, are disallowed because the 
     * referenced data can vanish out from under us.  References from temp 
     * tables to any other table type are also disallowed, because other 
     * backends might need to run the RI triggers on the perm table, but they 
     * can't reliably see tuples in the local buffers of other backends. 
     */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6995"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpersistence<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN169"><span class='Ref_to_Const'>RELPERSISTENCE_PERMANENT</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6998"><span class='Ref_To_Local'>pkrel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpersistence <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN169"><span class='Ref_to_Const'>RELPERSISTENCE_PERMANENT</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TABLE_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"constraints on permanent tables may reference only permanent tables"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN170"><span class='Ref_to_Const'>RELPERSISTENCE_UNLOGGED</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6998"><span class='Ref_To_Local'>pkrel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpersistence <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN169"><span class='Ref_to_Const'>RELPERSISTENCE_PERMANENT</span></a> 
                <span class='Operator'>&& </span><a href="tablecmds.c.html#LN6998"><span class='Ref_To_Local'>pkrel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpersistence <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN170"><span class='Ref_to_Const'>RELPERSISTENCE_UNLOGGED</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TABLE_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"constraints on unlogged tables may reference only permanent or unlogged tables"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN171"><span class='Ref_to_Const'>RELPERSISTENCE_TEMP</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6998"><span class='Ref_To_Local'>pkrel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpersistence <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN171"><span class='Ref_to_Const'>RELPERSISTENCE_TEMP</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TABLE_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"constraints on temporary tables may reference only temporary tables"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN6998"><span class='Ref_To_Local'>pkrel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN89"><span class='Ref_to_Member'>rd_islocaltemp</span></a> <span class='Operator'>|| !</span><a href="tablecmds.c.html#LN6995"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN89"><span class='Ref_to_Member'>rd_islocaltemp</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TABLE_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"constraints on temporary tables must involve temporary tables of this session"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch rel-&GT;rd_rel-&GT;relpersi... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Look up the referencing attributes to make sure they exist, and record 
     * their attnums and type OIDs. 
     */ 
</span>    <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6999"><span class='Ref_To_Local'>pkattnum</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6999"><span class='Ref_To_Local'>pkattnum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7000"><span class='Ref_To_Local'>fkattnum</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7000"><span class='Ref_To_Local'>fkattnum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7001"><span class='Ref_To_Local'>pktypoid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7001"><span class='Ref_To_Local'>pktypoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7002"><span class='Ref_To_Local'>fktypoid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7002"><span class='Ref_To_Local'>fktypoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7003"><span class='Ref_To_Local'>opclasses</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7003"><span class='Ref_To_Local'>opclasses</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7004"><span class='Ref_To_Local'>pfeqoperators</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7004"><span class='Ref_To_Local'>pfeqoperators</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7005"><span class='Ref_To_Local'>ppeqoperators</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7005"><span class='Ref_To_Local'>ppeqoperators</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7006"><span class='Ref_To_Local'>ffeqoperators</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7006"><span class='Ref_To_Local'>ffeqoperators</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN7008"><span class='Ref_To_Local'>numfks</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN315"><span class='Ref_to_Proto'>transformColumnNameList</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6995"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="tablecmds.c.html#LN6996"><span class='Ref_to_Parameter'>fkconstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2083"><span class='Ref_to_Member'>fk_attrs</span></a><span class='Delimiter'>, 
</span>                                     <a href="tablecmds.c.html#LN7000"><span class='Ref_To_Local'>fkattnum</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7002"><span class='Ref_To_Local'>fktypoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the attribute list for the referenced table was omitted, lookup the 
     * definition of the primary key and use it.  Otherwise, validate the 
     * supplied attribute list.  In either case, discover the index OID and 
     * index opclasses, and the attnums and type OIDs of the attributes. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6996"><span class='Ref_to_Parameter'>fkconstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2084"><span class='Ref_to_Member'>pk_attrs</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN7009"><span class='Ref_To_Local'>numpks</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN317"><span class='Ref_to_Proto'>transformFkeyGetPrimaryKey</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6998"><span class='Ref_To_Local'>pkrel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN7010"><span class='Ref_To_Local'>indexOid</span></a><span class='Delimiter'>, 
</span>                                            <span class='Operator'>&</span><a href="tablecmds.c.html#LN6996"><span class='Ref_to_Parameter'>fkconstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2084"><span class='Ref_to_Member'>pk_attrs</span></a><span class='Delimiter'>, 
</span>                                            <a href="tablecmds.c.html#LN6999"><span class='Ref_To_Local'>pkattnum</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7001"><span class='Ref_To_Local'>pktypoid</span></a><span class='Delimiter'>, 
</span>                                            <a href="tablecmds.c.html#LN7003"><span class='Ref_To_Local'>opclasses</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN7009"><span class='Ref_To_Local'>numpks</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN315"><span class='Ref_to_Proto'>transformColumnNameList</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6998"><span class='Ref_To_Local'>pkrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <a href="tablecmds.c.html#LN6996"><span class='Ref_to_Parameter'>fkconstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2084"><span class='Ref_to_Member'>pk_attrs</span></a><span class='Delimiter'>, 
</span>                                         <a href="tablecmds.c.html#LN6999"><span class='Ref_To_Local'>pkattnum</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7001"><span class='Ref_To_Local'>pktypoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Look for an index matching the column list */ 
</span>        <a href="tablecmds.c.html#LN7010"><span class='Ref_To_Local'>indexOid</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN321"><span class='Ref_to_Proto'>transformFkeyCheckAttrs</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6998"><span class='Ref_To_Local'>pkrel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7009"><span class='Ref_To_Local'>numpks</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6999"><span class='Ref_To_Local'>pkattnum</span></a><span class='Delimiter'>, 
</span>                                           <a href="tablecmds.c.html#LN7003"><span class='Ref_To_Local'>opclasses</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now we can check permissions. 
     */ 
</span>    <a href="tablecmds.c.html#LN324"><span class='Ref_to_Proto'>checkFkeyPermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6998"><span class='Ref_To_Local'>pkrel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6999"><span class='Ref_To_Local'>pkattnum</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7009"><span class='Ref_To_Local'>numpks</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Look up the equality operators to use in the constraint. 
     * 
     * Note that we have to be careful about the difference between the actual 
     * PK column type and the opclass' declared input type, which might be 
     * only binary-compatible with it.  The declared opcintype is the right 
     * thing to probe pg_amop with. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7008"><span class='Ref_To_Local'>numfks</span></a> <span class='Operator'>!= </span><a href="tablecmds.c.html#LN7009"><span class='Ref_To_Local'>numpks</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_FOREIGN_KEY<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"number of referencing and referenced columns for foreign key disagree"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * On the strength of a previous constraint, we might avoid scanning 
     * tables to validate this one.  See below. 
     */ 
</span>    <a href="tablecmds.c.html#LN7012"><span class='Ref_To_Local'>old_check_ok</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6996"><span class='Ref_to_Parameter'>fkconstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2088"><span class='Ref_to_Member'>old_conpfeqop</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN7012"><span class='Ref_To_Local'>old_check_ok</span></a> <span class='Operator'>|| </span><a href="tablecmds.c.html#LN7008"><span class='Ref_To_Local'>numfks</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6996"><span class='Ref_to_Parameter'>fkconstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2088"><span class='Ref_to_Member'>old_conpfeqop</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7007"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN7007"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tablecmds.c.html#LN7009"><span class='Ref_To_Local'>numpks</span></a><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN7007"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN7149"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>pktype</span> <span class='Operator'>= </span><a href="tablecmds.c.html#LN7001"><span class='Ref_To_Local'>pktypoid</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN7007"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span><a name="LN7150"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>fktype</span> <span class='Operator'>= </span><a href="tablecmds.c.html#LN7002"><span class='Ref_To_Local'>fktypoid</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN7007"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span><a name="LN7151"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>fktyped</span><span class='Delimiter'>; 
</span><a name="LN7152"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>cla_ht</span><span class='Delimiter'>; 
</span><a name="LN7153"></a>        <a href="../../include/catalog/pg_opclass.h.html#LN67"><span class='Ref_to_Typedef'>Form_pg_opclass</span></a> <span class='Declare_Local'>cla_tup</span><span class='Delimiter'>; 
</span><a name="LN7154"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>amid</span><span class='Delimiter'>; 
</span><a name="LN7155"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>opfamily</span><span class='Delimiter'>; 
</span><a name="LN7156"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>opcintype</span><span class='Delimiter'>; 
</span><a name="LN7157"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>pfeqop</span><span class='Delimiter'>; 
</span><a name="LN7158"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ppeqop</span><span class='Delimiter'>; 
</span><a name="LN7159"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ffeqop</span><span class='Delimiter'>; 
</span><a name="LN7160"></a>        <a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>eqstrategy</span><span class='Delimiter'>; 
</span><a name="LN7161"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>pfeqop_right</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* We need several fields out of the pg_opclass entry */ 
</span>        <a href="tablecmds.c.html#LN7152"><span class='Ref_To_Local'>cla_ht</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN47"><span class='Ref_to_EnumConst'>CLAOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7003"><span class='Ref_To_Local'>opclasses</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN7007"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7152"><span class='Ref_To_Local'>cla_ht</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for opclass %u"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7003"><span class='Ref_To_Local'>opclasses</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN7007"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN7153"><span class='Ref_To_Local'>cla_tup</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_opclass.h.html#LN67"><span class='Ref_to_Typedef'>Form_pg_opclass</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7152"><span class='Ref_To_Local'>cla_ht</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN7154"><span class='Ref_To_Local'>amid</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN7153"><span class='Ref_To_Local'>cla_tup</span></a><span class='Operator'>-&GT;</span>opcmethod<span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN7155"><span class='Ref_To_Local'>opfamily</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN7153"><span class='Ref_To_Local'>cla_tup</span></a><span class='Operator'>-&GT;</span>opcfamily<span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN7156"><span class='Ref_To_Local'>opcintype</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN7153"><span class='Ref_To_Local'>cla_tup</span></a><span class='Operator'>-&GT;</span>opcintype<span class='Delimiter'>; 
</span>        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7152"><span class='Ref_To_Local'>cla_ht</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Check it's a btree; currently this can never fail since no other 
         * index AMs support unique indexes.  If we ever did have other types 
         * of unique indexes, we'd need a way to determine which operator 
         * strategy number is equality.  (Is it reasonable to insist that 
         * every such index AM use btree's number for equality?) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7154"><span class='Ref_To_Local'>amid</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_am.h.html#LN69"><span class='Ref_to_Const'>BTREE_AM_OID</span></a><span class='Parentheses'>) 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"only b-tree indexes are supported for foreign keys"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN7160"><span class='Ref_To_Local'>eqstrategy</span></a> <span class='Operator'>= </span><a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * There had better be a primary equality operator for the index. 
         * We'll use it for PK = PK comparisons. 
         */ 
</span>        <a href="tablecmds.c.html#LN7158"><span class='Ref_To_Local'>ppeqop</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN70"><span class='Ref_to_Proto'>get_opfamily_member</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7155"><span class='Ref_To_Local'>opfamily</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7156"><span class='Ref_To_Local'>opcintype</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7156"><span class='Ref_To_Local'>opcintype</span></a><span class='Delimiter'>, 
</span>                                     <a href="tablecmds.c.html#LN7160"><span class='Ref_To_Local'>eqstrategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7158"><span class='Ref_To_Local'>ppeqop</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"missing operator %d(%u,%u) in opfamily %u"</span><span class='Delimiter'>, 
</span>                 <a href="tablecmds.c.html#LN7160"><span class='Ref_To_Local'>eqstrategy</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7156"><span class='Ref_To_Local'>opcintype</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7156"><span class='Ref_To_Local'>opcintype</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7155"><span class='Ref_To_Local'>opfamily</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Are there equality operators that take exactly the FK type? Assume 
         * we should look through any domain here. 
         */ 
</span>        <a href="tablecmds.c.html#LN7151"><span class='Ref_To_Local'>fktyped</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN168"><span class='Ref_to_Proto'>getBaseType</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7150"><span class='Ref_To_Local'>fktype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN7157"><span class='Ref_To_Local'>pfeqop</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN70"><span class='Ref_to_Proto'>get_opfamily_member</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7155"><span class='Ref_To_Local'>opfamily</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7156"><span class='Ref_To_Local'>opcintype</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7151"><span class='Ref_To_Local'>fktyped</span></a><span class='Delimiter'>, 
</span>                                     <a href="tablecmds.c.html#LN7160"><span class='Ref_To_Local'>eqstrategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7157"><span class='Ref_To_Local'>pfeqop</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="tablecmds.c.html#LN7161"><span class='Ref_To_Local'>pfeqop_right</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN7151"><span class='Ref_To_Local'>fktyped</span></a><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN7159"><span class='Ref_To_Local'>ffeqop</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN70"><span class='Ref_to_Proto'>get_opfamily_member</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7155"><span class='Ref_To_Local'>opfamily</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7151"><span class='Ref_To_Local'>fktyped</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7151"><span class='Ref_To_Local'>fktyped</span></a><span class='Delimiter'>, 
</span>                                         <a href="tablecmds.c.html#LN7160"><span class='Ref_To_Local'>eqstrategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* keep compiler quiet */ 
</span>            <a href="tablecmds.c.html#LN7161"><span class='Ref_To_Local'>pfeqop_right</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN7159"><span class='Ref_To_Local'>ffeqop</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7157"><span class='Ref_To_Local'>pfeqop</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7159"><span class='Ref_To_Local'>ffeqop</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Otherwise, look for an implicit cast from the FK type to the 
             * opcintype, and if found, use the primary equality operator. 
             * This is a bit tricky because opcintype might be a polymorphic 
             * type such as ANYARRAY or ANYENUM; so what we have to test is 
             * whether the two actual column types can be concurrently cast to 
             * that type.  (Otherwise, we'd fail to reject combinations such 
             * as int[] and point[].) 
             */ 
</span><a name="LN7227"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>input_typeids</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN7228"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>target_typeids</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span> 
            <a href="tablecmds.c.html#LN7227"><span class='Ref_To_Local'>input_typeids</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="tablecmds.c.html#LN7149"><span class='Ref_To_Local'>pktype</span></a><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN7227"><span class='Ref_To_Local'>input_typeids</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="tablecmds.c.html#LN7150"><span class='Ref_To_Local'>fktype</span></a><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN7228"><span class='Ref_To_Local'>target_typeids</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="tablecmds.c.html#LN7156"><span class='Ref_To_Local'>opcintype</span></a><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN7228"><span class='Ref_To_Local'>target_typeids</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="tablecmds.c.html#LN7156"><span class='Ref_To_Local'>opcintype</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/parser/parse_coerce.h.html#LN43"><span class='Ref_to_Proto'>can_coerce_type</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7227"><span class='Ref_To_Local'>input_typeids</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7228"><span class='Ref_To_Local'>target_typeids</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/nodes/primnodes.h.html#LN420"><span class='Ref_to_EnumConst'>COERCION_IMPLICIT</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="tablecmds.c.html#LN7157"><span class='Ref_To_Local'>pfeqop</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN7159"><span class='Ref_To_Local'>ffeqop</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN7158"><span class='Ref_To_Local'>ppeqop</span></a><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN7161"><span class='Ref_To_Local'>pfeqop_right</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN7156"><span class='Ref_To_Local'>opcintype</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !(OidIsValid(pfeqop)&... &raquo; </span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7157"><span class='Ref_To_Local'>pfeqop</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7159"><span class='Ref_To_Local'>ffeqop</span></a><span class='Parentheses'>)))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"foreign key constraint \"%s\" "</span> 
                            <span class='String'>"cannot be implemented"</span><span class='Delimiter'>, 
</span>                            <a href="tablecmds.c.html#LN6996"><span class='Ref_to_Parameter'>fkconstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2056"><span class='Ref_to_Member'>conname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Key columns \"%s\" and \"%s\" "</span> 
                               <span class='String'>"are of incompatible types: %s and %s."</span><span class='Delimiter'>, 
</span>                               <a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN223"><span class='Ref_to_Proto'>list_nth</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6996"><span class='Ref_to_Parameter'>fkconstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2083"><span class='Ref_to_Member'>fk_attrs</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7007"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                               <a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN223"><span class='Ref_to_Proto'>list_nth</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6996"><span class='Ref_to_Parameter'>fkconstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2084"><span class='Ref_to_Member'>pk_attrs</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7007"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                               <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7150"><span class='Ref_To_Local'>fktype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                               <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7149"><span class='Ref_To_Local'>pktype</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7012"><span class='Ref_To_Local'>old_check_ok</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * When a pfeqop changes, revalidate the constraint.  We could 
             * permit intra-opfamily changes, but that adds subtle complexity 
             * without any concrete benefit for core types.  We need not 
             * assess ppeqop or ffeqop, which RI_Initial_Check() does not use. 
             */ 
</span>            <a href="tablecmds.c.html#LN7012"><span class='Ref_To_Local'>old_check_ok</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7157"><span class='Ref_To_Local'>pfeqop</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7014"><span class='Ref_To_Local'>old_pfeqop_item</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN7014"><span class='Ref_To_Local'>old_pfeqop_item</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7014"><span class='Ref_To_Local'>old_pfeqop_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7012"><span class='Ref_To_Local'>old_check_ok</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN7268"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>old_fktype</span><span class='Delimiter'>; 
</span><a name="LN7269"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>new_fktype</span><span class='Delimiter'>; 
</span><a name="LN7270"></a>            <a href="../../include/parser/parse_coerce.h.html#LN23"><span class='Ref_to_Enum'>CoercionPathType</span></a> <span class='Declare_Local'>old_pathtype</span><span class='Delimiter'>; 
</span><a name="LN7271"></a>            <a href="../../include/parser/parse_coerce.h.html#LN23"><span class='Ref_to_Enum'>CoercionPathType</span></a> <span class='Declare_Local'>new_pathtype</span><span class='Delimiter'>; 
</span><a name="LN7272"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>old_castfunc</span><span class='Delimiter'>; 
</span><a name="LN7273"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>new_castfunc</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Identify coercion pathways from each of the old and new FK-side 
             * column types to the right (foreign) operand type of the pfeqop. 
             * We may assume that pg_constraint.conkey is not changing. 
             */ 
</span>            <a href="tablecmds.c.html#LN7268"><span class='Ref_To_Local'>old_fktype</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN6995"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN158"><span class='Ref_to_Member'>oldDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN7000"><span class='Ref_To_Local'>fkattnum</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN7007"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN7269"><span class='Ref_To_Local'>new_fktype</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN7150"><span class='Ref_To_Local'>fktype</span></a><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN7270"><span class='Ref_To_Local'>old_pathtype</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN325"><span class='Ref_to_Proto'>findFkeyCast</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7161"><span class='Ref_To_Local'>pfeqop_right</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7268"><span class='Ref_To_Local'>old_fktype</span></a><span class='Delimiter'>, 
</span>                                        <span class='Operator'>&</span><a href="tablecmds.c.html#LN7272"><span class='Ref_To_Local'>old_castfunc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN7271"><span class='Ref_To_Local'>new_pathtype</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN325"><span class='Ref_to_Proto'>findFkeyCast</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7161"><span class='Ref_To_Local'>pfeqop_right</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7269"><span class='Ref_To_Local'>new_fktype</span></a><span class='Delimiter'>, 
</span>                                        <span class='Operator'>&</span><a href="tablecmds.c.html#LN7273"><span class='Ref_To_Local'>new_castfunc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Upon a change to the cast from the FK column to its pfeqop 
             * operand, revalidate the constraint.  For this evaluation, a 
             * binary coercion cast is equivalent to no cast at all.  While 
             * type implementors should design implicit casts with an eye 
             * toward consistency of operations like equality, we cannot 
             * assume here that they have done so. 
             * 
             * A function with a polymorphic argument could change behavior 
             * arbitrarily in response to get_fn_expr_argtype().  Therefore, 
             * when the cast destination is polymorphic, we only avoid 
             * revalidation if the input type has not changed at all.  Given 
             * just the core data types and operator classes, this requirement 
             * prevents no would-be optimizations. 
             * 
             * If the cast converts from a base type to a domain thereon, then 
             * that domain type must be the opcintype of the unique index. 
             * Necessarily, the primary key column must then be of the domain 
             * type.  Since the constraint was previously valid, all values on 
             * the foreign side necessarily exist on the primary side and in 
             * turn conform to the domain.  Consequently, we need not treat 
             * domains specially here. 
             * 
             * Since we require that all collations share the same notion of 
             * equality (which they do, because texteq reduces to bitwise 
             * equality), we don't compare collation here. 
             * 
             * We need not directly consider the PK type.  It's necessarily 
             * binary coercible to the opcintype of the unique index column, 
             * and ri_triggers.c will only deal with PK datums in terms of 
             * that opcintype.  Changing the opcintype also changes pfeqop. 
             */ 
</span>            <a href="tablecmds.c.html#LN7012"><span class='Ref_To_Local'>old_check_ok</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7271"><span class='Ref_To_Local'>new_pathtype</span></a> <span class='Operator'>== </span><a href="tablecmds.c.html#LN7270"><span class='Ref_To_Local'>old_pathtype</span></a> <span class='Operator'>&& 
</span>                            <a href="tablecmds.c.html#LN7273"><span class='Ref_To_Local'>new_castfunc</span></a> <span class='Operator'>== </span><a href="tablecmds.c.html#LN7272"><span class='Ref_To_Local'>old_castfunc</span></a> <span class='Operator'>&& 
</span>                            <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/catalog/pg_type.h.html#LN744"><span class='Ref_to_Macro'>IsPolymorphicType</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7161"><span class='Ref_To_Local'>pfeqop_right</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>                             <a href="tablecmds.c.html#LN7269"><span class='Ref_To_Local'>new_fktype</span></a> <span class='Operator'>== </span><a href="tablecmds.c.html#LN7268"><span class='Ref_To_Local'>old_fktype</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if old_check_ok &raquo; </span> 
 
        <a href="tablecmds.c.html#LN7004"><span class='Ref_To_Local'>pfeqoperators</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN7007"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="tablecmds.c.html#LN7157"><span class='Ref_To_Local'>pfeqop</span></a><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN7005"><span class='Ref_To_Local'>ppeqoperators</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN7007"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="tablecmds.c.html#LN7158"><span class='Ref_To_Local'>ppeqop</span></a><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN7006"><span class='Ref_To_Local'>ffeqoperators</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN7007"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="tablecmds.c.html#LN7159"><span class='Ref_To_Local'>ffeqop</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;numpks;i++ &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Record the FK constraint in pg_constraint. 
     */ 
</span>    <a href="tablecmds.c.html#LN7011"><span class='Ref_To_Local'>constrOid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_constraint_fn.h.html#LN29"><span class='Ref_to_Proto'>CreateConstraintEntry</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6996"><span class='Ref_to_Parameter'>fkconstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2056"><span class='Ref_to_Member'>conname</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../include/utils/rel.h.html#LN443"><span class='Ref_to_Macro'>RelationGetNamespace</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6995"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="../../include/catalog/pg_constraint.h.html#LN188"><span class='Ref_to_Const'>CONSTRAINT_FOREIGN</span></a><span class='Delimiter'>, 
</span>                                      <a href="tablecmds.c.html#LN6996"><span class='Ref_to_Parameter'>fkconstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2057"><span class='Ref_to_Member'>deferrable</span></a><span class='Delimiter'>, 
</span>                                      <a href="tablecmds.c.html#LN6996"><span class='Ref_to_Parameter'>fkconstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2058"><span class='Ref_to_Member'>initdeferred</span></a><span class='Delimiter'>, 
</span>                                      <a href="tablecmds.c.html#LN6996"><span class='Ref_to_Parameter'>fkconstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2093"><span class='Ref_to_Member'>initially_valid</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6995"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="tablecmds.c.html#LN7000"><span class='Ref_To_Local'>fkattnum</span></a><span class='Delimiter'>, 
</span>                                      <a href="tablecmds.c.html#LN7008"><span class='Ref_To_Local'>numfks</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>       <span class='Comment_Multi_Line'>/* not a domain 
                                                         * constraint */ 
</span>                                      <a href="tablecmds.c.html#LN7010"><span class='Ref_To_Local'>indexOid</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6998"><span class='Ref_To_Local'>pkrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="tablecmds.c.html#LN6999"><span class='Ref_To_Local'>pkattnum</span></a><span class='Delimiter'>, 
</span>                                      <a href="tablecmds.c.html#LN7004"><span class='Ref_To_Local'>pfeqoperators</span></a><span class='Delimiter'>, 
</span>                                      <a href="tablecmds.c.html#LN7005"><span class='Ref_To_Local'>ppeqoperators</span></a><span class='Delimiter'>, 
</span>                                      <a href="tablecmds.c.html#LN7006"><span class='Ref_To_Local'>ffeqoperators</span></a><span class='Delimiter'>, 
</span>                                      <a href="tablecmds.c.html#LN7009"><span class='Ref_To_Local'>numpks</span></a><span class='Delimiter'>, 
</span>                                      <a href="tablecmds.c.html#LN6996"><span class='Ref_to_Parameter'>fkconstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2086"><span class='Ref_to_Member'>fk_upd_action</span></a><span class='Delimiter'>, 
</span>                                      <a href="tablecmds.c.html#LN6996"><span class='Ref_to_Parameter'>fkconstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2087"><span class='Ref_to_Member'>fk_del_action</span></a><span class='Delimiter'>, 
</span>                                      <a href="tablecmds.c.html#LN6996"><span class='Ref_to_Parameter'>fkconstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2085"><span class='Ref_to_Member'>fk_matchtype</span></a><span class='Delimiter'>, 
</span>                                      <span class='Null_Value'>NULL</span><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* no exclusion constraint */ 
</span>                                      <span class='Null_Value'>NULL</span><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* no check constraint */ 
</span>                                      <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                      <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                      <span class='Boolean'>true</span><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* islocal */ 
</span>                                      <span class='Number'>0</span><span class='Delimiter'>,</span>        <span class='Comment_Single_Line'>/* inhcount */ 
</span>                                      <span class='Boolean'>true</span><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* isnoinherit */ 
</span>                                      <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* is_internal */ 
</span>    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7013"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_constraint.h.html#LN28"><span class='Ref_to_Const'>ConstraintRelationId</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7011"><span class='Ref_To_Local'>constrOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create the triggers that will enforce the constraint. 
     */ 
</span>    <a href="tablecmds.c.html#LN331"><span class='Ref_to_Proto'>createForeignKeyTriggers</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6995"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6998"><span class='Ref_To_Local'>pkrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN6996"><span class='Ref_to_Parameter'>fkconstraint</span></a><span class='Delimiter'>, 
</span>                             <a href="tablecmds.c.html#LN7011"><span class='Ref_To_Local'>constrOid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7010"><span class='Ref_To_Local'>indexOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Tell Phase 3 to check that the constraint is satisfied by existing 
     * rows. We can skip this during table creation, when requested explicitly 
     * by specifying NOT VALID in an ADD FOREIGN KEY command, and when we're 
     * recreating a constraint following a SET DATA TYPE operation that did 
     * not impugn its validity. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN7012"><span class='Ref_To_Local'>old_check_ok</span></a> <span class='Operator'>&& !</span><a href="tablecmds.c.html#LN6996"><span class='Ref_to_Parameter'>fkconstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2092"><span class='Ref_to_Member'>skip_validation</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN7380"></a>        <a href="tablecmds.c.html#LN179"><span class='Ref_to_Struct'>NewConstraint</span></a> <span class='Operator'>*</span><span class='Declare_Local'>newcon</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN7380"><span class='Ref_To_Local'>newcon</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN179"><span class='Ref_to_Struct'>NewConstraint</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN179"><span class='Ref_to_Struct'>NewConstraint</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN7380"><span class='Ref_To_Local'>newcon</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN181"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN6996"><span class='Ref_to_Parameter'>fkconstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2056"><span class='Ref_to_Member'>conname</span></a><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN7380"><span class='Ref_To_Local'>newcon</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN182"><span class='Ref_to_Member'>contype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN2031"><span class='Ref_to_EnumConst'>CONSTR_FOREIGN</span></a><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN7380"><span class='Ref_To_Local'>newcon</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN183"><span class='Ref_to_Member'>refrelid</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6998"><span class='Ref_To_Local'>pkrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN7380"><span class='Ref_To_Local'>newcon</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN184"><span class='Ref_to_Member'>refindid</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN7010"><span class='Ref_To_Local'>indexOid</span></a><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN7380"><span class='Ref_To_Local'>newcon</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN185"><span class='Ref_to_Member'>conid</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN7011"><span class='Ref_To_Local'>constrOid</span></a><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN7380"><span class='Ref_To_Local'>newcon</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN186"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN6996"><span class='Ref_to_Parameter'>fkconstraint</span></a><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN6995"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN162"><span class='Ref_to_Member'>constraints</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6995"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN162"><span class='Ref_to_Member'>constraints</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7380"><span class='Ref_To_Local'>newcon</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Close pk table, but keep lock until we've committed. 
     */ 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN6998"><span class='Ref_To_Local'>pkrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN7013"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATAddForeignKeyConstraint &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ALTER TABLE ALTER CONSTRAINT 
 * 
 * Update the attributes of a constraint. 
 * 
 * Currently only works for Foreign Key constraints. 
 * Foreign keys do not inherit, so we purposely ignore the 
 * recursion bit here, but we keep the API the same for when 
 * other constraint types are supported. 
 * 
 * If the constraint is modified, returns its address; otherwise, return 
 * InvalidObjectAddress. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN7415"></a><span class='Declare_Function'>ATExecAlterConstraint</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cmd</span><span class='Delimiter'>, 
</span><a name="LN7416"></a>                      <span class='Keyword'>bool </span><span class='Declare_Parameter'>recurse</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recursing</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN7418"></a>    <a href="../../include/nodes/parsenodes.h.html#LN2050"><span class='Ref_to_Struct'>Constraint</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cmdcon</span><span class='Delimiter'>; 
</span><a name="LN7419"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>conrel</span><span class='Delimiter'>; 
</span><a name="LN7420"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN7421"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>; 
</span><a name="LN7422"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>contuple</span><span class='Delimiter'>; 
</span><a name="LN7423"></a>    <a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a> <span class='Declare_Local'>currcon</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN7424"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN7425"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN7418"><span class='Ref_To_Local'>cmdcon</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2050"><span class='Ref_to_Struct'>Constraint</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7415"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN7419"><span class='Ref_To_Local'>conrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN28"><span class='Ref_to_Const'>ConstraintRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Find and check the target constraint 
     */ 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN7421"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/catalog/pg_constraint.h.html#LN159"><span class='Ref_to_Const'>Anum_pg_constraint_conrelid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7415"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN7420"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7419"><span class='Ref_To_Local'>conrel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN125"><span class='Ref_to_Const'>ConstraintRelidIndexId</span></a><span class='Delimiter'>, 
</span>                              <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN7421"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7422"><span class='Ref_To_Local'>contuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7420"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN7423"><span class='Ref_To_Local'>currcon</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7422"><span class='Ref_To_Local'>contuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7423"><span class='Ref_To_Local'>currcon</span></a><span class='Operator'>-&GT;</span>conname<span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7418"><span class='Ref_To_Local'>cmdcon</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2056"><span class='Ref_to_Member'>conname</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="tablecmds.c.html#LN7424"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN7424"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"constraint \"%s\" of relation \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN7418"><span class='Ref_To_Local'>cmdcon</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2056"><span class='Ref_to_Member'>conname</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7415"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7423"><span class='Ref_To_Local'>currcon</span></a><span class='Operator'>-&GT;</span>contype <span class='Operator'>!= </span><a href="../../include/catalog/pg_constraint.h.html#LN188"><span class='Ref_to_Const'>CONSTRAINT_FOREIGN</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"constraint \"%s\" of relation \"%s\" is not a foreign key constraint"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN7418"><span class='Ref_To_Local'>cmdcon</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2056"><span class='Ref_to_Member'>conname</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7415"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7423"><span class='Ref_To_Local'>currcon</span></a><span class='Operator'>-&GT;</span>condeferrable <span class='Operator'>!= </span><a href="tablecmds.c.html#LN7418"><span class='Ref_To_Local'>cmdcon</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2057"><span class='Ref_to_Member'>deferrable</span></a> <span class='Operator'>|| 
</span>        <a href="tablecmds.c.html#LN7423"><span class='Ref_To_Local'>currcon</span></a><span class='Operator'>-&GT;</span>condeferred <span class='Operator'>!= </span><a href="tablecmds.c.html#LN7418"><span class='Ref_To_Local'>cmdcon</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2058"><span class='Ref_to_Member'>initdeferred</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN7466"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>copyTuple</span><span class='Delimiter'>; 
</span><a name="LN7467"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tgtuple</span><span class='Delimiter'>; 
</span><a name="LN7468"></a>        <a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a> <span class='Declare_Local'>copy_con</span><span class='Delimiter'>; 
</span><a name="LN7469"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>otherrelids</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN7470"></a>        <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>tgkey</span><span class='Delimiter'>; 
</span><a name="LN7471"></a>        <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>tgscan</span><span class='Delimiter'>; 
</span><a name="LN7472"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>tgrel</span><span class='Delimiter'>; 
</span><a name="LN7473"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Now update the catalog, while we have the door open. 
         */ 
</span>        <a href="tablecmds.c.html#LN7466"><span class='Ref_To_Local'>copyTuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN606"><span class='Ref_to_Func'>heap_copytuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7422"><span class='Ref_To_Local'>contuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN7468"><span class='Ref_To_Local'>copy_con</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7466"><span class='Ref_To_Local'>copyTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN7468"><span class='Ref_To_Local'>copy_con</span></a><span class='Operator'>-&GT;</span>condeferrable <span class='Operator'>= </span><a href="tablecmds.c.html#LN7418"><span class='Ref_To_Local'>cmdcon</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2057"><span class='Ref_to_Member'>deferrable</span></a><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN7468"><span class='Ref_To_Local'>copy_con</span></a><span class='Operator'>-&GT;</span>condeferred <span class='Operator'>= </span><a href="tablecmds.c.html#LN7418"><span class='Ref_To_Local'>cmdcon</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2058"><span class='Ref_to_Member'>initdeferred</span></a><span class='Delimiter'>; 
</span>        <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7419"><span class='Ref_To_Local'>conrel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN7466"><span class='Ref_To_Local'>copyTuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7466"><span class='Ref_To_Local'>copyTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN28"><span class='Ref_to_Const'>ConstraintRelationId</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7422"><span class='Ref_To_Local'>contuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7466"><span class='Ref_To_Local'>copyTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Now we need to update the multiple entries in pg_trigger that 
         * implement the constraint. 
         */ 
</span>        <a href="tablecmds.c.html#LN7472"><span class='Ref_To_Local'>tgrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_trigger.h.html#LN33"><span class='Ref_to_Const'>TriggerRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN7470"><span class='Ref_To_Local'>tgkey</span></a><span class='Delimiter'>, 
</span>                    <a href="../../include/catalog/pg_trigger.h.html#LN86"><span class='Ref_to_Const'>Anum_pg_trigger_tgconstraint</span></a><span class='Delimiter'>, 
</span>                    <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                    <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7422"><span class='Ref_To_Local'>contuple</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN7471"><span class='Ref_To_Local'>tgscan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7472"><span class='Ref_To_Local'>tgrel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN246"><span class='Ref_to_Const'>TriggerConstraintIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                    <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN7470"><span class='Ref_To_Local'>tgkey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7467"><span class='Ref_To_Local'>tgtuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7471"><span class='Ref_To_Local'>tgscan</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN7505"></a>            <a href="../../include/catalog/pg_trigger.h.html#LN71"><span class='Ref_to_Typedef'>Form_pg_trigger</span></a> <span class='Declare_Local'>tgform</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_trigger.h.html#LN71"><span class='Ref_to_Typedef'>Form_pg_trigger</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7467"><span class='Ref_To_Local'>tgtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN7506"></a>            <a href="../../include/catalog/pg_trigger.h.html#LN71"><span class='Ref_to_Typedef'>Form_pg_trigger</span></a> <span class='Declare_Local'>copy_tg</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Remember OIDs of other relation(s) involved in FK constraint. 
             * (Note: it's likely that we could skip forcing a relcache inval 
             * for other rels that don't have a trigger whose properties 
             * change, but let's be conservative.) 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7505"><span class='Ref_To_Local'>tgform</span></a><span class='Operator'>-&GT;</span>tgrelid <span class='Operator'>!= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7415"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span> 
                <a href="tablecmds.c.html#LN7469"><span class='Ref_To_Local'>otherrelids</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN258"><span class='Ref_to_Proto'>list_append_unique_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7469"><span class='Ref_To_Local'>otherrelids</span></a><span class='Delimiter'>, 
</span>                                                     <a href="tablecmds.c.html#LN7505"><span class='Ref_To_Local'>tgform</span></a><span class='Operator'>-&GT;</span>tgrelid<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Update deferrability of RI_FKey_noaction_del, 
             * RI_FKey_noaction_upd, RI_FKey_check_ins and RI_FKey_check_upd 
             * triggers, but not others; see createForeignKeyTriggers and 
             * CreateFKCheckTrigger. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7505"><span class='Ref_To_Local'>tgform</span></a><span class='Operator'>-&GT;</span>tgfoid <span class='Operator'>!= </span>F_RI_FKEY_NOACTION_DEL <span class='Operator'>&& 
</span>                <a href="tablecmds.c.html#LN7505"><span class='Ref_To_Local'>tgform</span></a><span class='Operator'>-&GT;</span>tgfoid <span class='Operator'>!= </span>F_RI_FKEY_NOACTION_UPD <span class='Operator'>&& 
</span>                <a href="tablecmds.c.html#LN7505"><span class='Ref_To_Local'>tgform</span></a><span class='Operator'>-&GT;</span>tgfoid <span class='Operator'>!= </span>F_RI_FKEY_CHECK_INS <span class='Operator'>&& 
</span>                <a href="tablecmds.c.html#LN7505"><span class='Ref_To_Local'>tgform</span></a><span class='Operator'>-&GT;</span>tgfoid <span class='Operator'>!= </span>F_RI_FKEY_CHECK_UPD<span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <a href="tablecmds.c.html#LN7466"><span class='Ref_To_Local'>copyTuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN606"><span class='Ref_to_Func'>heap_copytuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7467"><span class='Ref_To_Local'>tgtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN7506"><span class='Ref_To_Local'>copy_tg</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_trigger.h.html#LN71"><span class='Ref_to_Typedef'>Form_pg_trigger</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7466"><span class='Ref_To_Local'>copyTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="tablecmds.c.html#LN7506"><span class='Ref_To_Local'>copy_tg</span></a><span class='Operator'>-&GT;</span>tgdeferrable <span class='Operator'>= </span><a href="tablecmds.c.html#LN7418"><span class='Ref_To_Local'>cmdcon</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2057"><span class='Ref_to_Member'>deferrable</span></a><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN7506"><span class='Ref_To_Local'>copy_tg</span></a><span class='Operator'>-&GT;</span>tginitdeferred <span class='Operator'>= </span><a href="tablecmds.c.html#LN7418"><span class='Ref_To_Local'>cmdcon</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2058"><span class='Ref_to_Member'>initdeferred</span></a><span class='Delimiter'>; 
</span>            <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7472"><span class='Ref_To_Local'>tgrel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN7466"><span class='Ref_To_Local'>copyTuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7466"><span class='Ref_To_Local'>copyTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_trigger.h.html#LN33"><span class='Ref_to_Const'>TriggerRelationId</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7467"><span class='Ref_To_Local'>tgtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7466"><span class='Ref_To_Local'>copyTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while HeapTupleIsValid(tgtu... &raquo; </span> 
 
        <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7471"><span class='Ref_To_Local'>tgscan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7472"><span class='Ref_To_Local'>tgrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Invalidate relcache so that others see the new attributes.  We must 
         * inval both the named rel and any others having relevant triggers. 
         * (At present there should always be exactly one other rel, but 
         * there's no need to hard-wire such an assumption here.) 
         */ 
</span>        <a href="../../include/utils/inval.h.html#LN43"><span class='Ref_to_Proto'>CacheInvalidateRelcache</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7415"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7473"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7469"><span class='Ref_To_Local'>otherrelids</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/inval.h.html#LN49"><span class='Ref_to_Proto'>CacheInvalidateRelcacheByRelid</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7473"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7425"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_constraint.h.html#LN28"><span class='Ref_to_Const'>ConstraintRelationId</span></a><span class='Delimiter'>, 
</span>                         <a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7422"><span class='Ref_To_Local'>contuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if currcon-&GT;condeferrabl... &raquo; </span> 
    <span class='Control'>else</span> 
        <a href="tablecmds.c.html#LN7425"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="../catalog/objectaddress.c.html#LN718"><span class='Ref_to_Global_Var'>InvalidObjectAddress</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7420"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7419"><span class='Ref_To_Local'>conrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN7425"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATExecAlterConstraint &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ALTER TABLE VALIDATE CONSTRAINT 
 * 
 * XXX The reason we handle recursion here rather than at Phase 1 is because 
 * there's no good way to skip recursing when handling foreign keys: there is 
 * no need to lock children in that case, yet we wouldn't be able to avoid 
 * doing so at that level. 
 * 
 * Return value is the address of the validated constraint.  If the constraint 
 * was already validated, InvalidObjectAddress is returned. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN7584"></a><span class='Declare_Function'>ATExecValidateConstraint</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>constrName</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recurse</span><span class='Delimiter'>, 
</span><a name="LN7585"></a>                         <span class='Keyword'>bool </span><span class='Declare_Parameter'>recursing</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN7587"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>conrel</span><span class='Delimiter'>; 
</span><a name="LN7588"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN7589"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>; 
</span><a name="LN7590"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN7591"></a>    <a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a> <span class='Declare_Local'>con</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN7592"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN7593"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN7587"><span class='Ref_To_Local'>conrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN28"><span class='Ref_to_Const'>ConstraintRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Find and check the target constraint 
     */ 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN7589"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/catalog/pg_constraint.h.html#LN159"><span class='Ref_to_Const'>Anum_pg_constraint_conrelid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7584"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN7588"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7587"><span class='Ref_To_Local'>conrel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN125"><span class='Ref_to_Const'>ConstraintRelidIndexId</span></a><span class='Delimiter'>, 
</span>                              <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN7589"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7590"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7588"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN7591"><span class='Ref_To_Local'>con</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7590"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7591"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>conname<span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7584"><span class='Ref_to_Parameter'>constrName</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="tablecmds.c.html#LN7592"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN7592"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"constraint \"%s\" of relation \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN7584"><span class='Ref_to_Parameter'>constrName</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7584"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7591"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>contype <span class='Operator'>!= </span><a href="../../include/catalog/pg_constraint.h.html#LN188"><span class='Ref_to_Const'>CONSTRAINT_FOREIGN</span></a> <span class='Operator'>&& 
</span>        <a href="tablecmds.c.html#LN7591"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>contype <span class='Operator'>!= </span><a href="../../include/catalog/pg_constraint.h.html#LN187"><span class='Ref_to_Const'>CONSTRAINT_CHECK</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"constraint \"%s\" of relation \"%s\" is not a foreign key or check constraint"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN7584"><span class='Ref_to_Parameter'>constrName</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7584"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN7591"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>convalidated<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN7632"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>copyTuple</span><span class='Delimiter'>; 
</span><a name="LN7633"></a>        <a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a> <span class='Declare_Local'>copy_con</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7591"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>contype <span class='Operator'>== </span><a href="../../include/catalog/pg_constraint.h.html#LN188"><span class='Ref_to_Const'>CONSTRAINT_FOREIGN</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN7637"></a>            <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>refrel</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Triggers are already in place on both tables, so a concurrent 
             * write that alters the result here is not possible. Normally we 
             * can run a query here to do the validation, which would only 
             * require AccessShareLock. In some cases, it is possible that we 
             * might need to fire triggers to perform the check, so we take a 
             * lock at RowShareLock level just in case. 
             */ 
</span>            <a href="tablecmds.c.html#LN7637"><span class='Ref_To_Local'>refrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7591"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>confrelid<span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN36"><span class='Ref_to_Const'>RowShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="tablecmds.c.html#LN328"><span class='Ref_to_Proto'>validateForeignKeyConstraint</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7584"><span class='Ref_to_Parameter'>constrName</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7584"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7637"><span class='Ref_To_Local'>refrel</span></a><span class='Delimiter'>, 
</span>                                         <a href="tablecmds.c.html#LN7591"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>conindid<span class='Delimiter'>, 
</span>                                         <a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7590"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7637"><span class='Ref_To_Local'>refrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Foreign keys do not inherit, so we purposely ignore the 
             * recursion bit here 
             */ 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if con-&GT;contype==CONSTRA... &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7591"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>contype <span class='Operator'>== </span><a href="../../include/catalog/pg_constraint.h.html#LN187"><span class='Ref_to_Const'>CONSTRAINT_CHECK</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN7661"></a>            <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>children</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN7662"></a>            <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>child</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If we're recursing, the parent has already done this, so skip 
             * it.  Also, if the constraint is a NO INHERIT constraint, we 
             * shouldn't try to look for it in the children. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN7585"><span class='Ref_to_Parameter'>recursing</span></a> <span class='Operator'>&& !</span><a href="tablecmds.c.html#LN7591"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>connoinherit<span class='Parentheses'>) 
</span>                <a href="tablecmds.c.html#LN7661"><span class='Ref_To_Local'>children</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_inherits_fn.h.html#LN20"><span class='Ref_to_Proto'>find_all_inheritors</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7584"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                               <a href="tablecmds.c.html#LN7585"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * For CHECK constraints, we must ensure that we only mark the 
             * constraint as validated on the parent if it's already validated 
             * on the children. 
             * 
             * We recurse before validating on the parent, to reduce risk of 
             * deadlocks. 
             */ 
</span>            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7662"><span class='Ref_To_Local'>child</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7661"><span class='Ref_To_Local'>children</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN7683"></a>                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>childoid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7662"><span class='Ref_To_Local'>child</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN7684"></a>                <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>childrel</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7683"><span class='Ref_To_Local'>childoid</span></a> <span class='Operator'>== </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7584"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * If we are told not to recurse, there had better not be any 
                 * child tables, because we can't mark the constraint on the 
                 * parent valid unless it is valid for all child tables. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN7584"><span class='Ref_to_Parameter'>recurse</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TABLE_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"constraint must be validated on child tables too"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* find_all_inheritors already got lock */ 
</span>                <a href="tablecmds.c.html#LN7684"><span class='Ref_To_Local'>childrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7683"><span class='Ref_To_Local'>childoid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="tablecmds.c.html#LN313"><span class='Ref_to_Proto'>ATExecValidateConstraint</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7684"><span class='Ref_To_Local'>childrel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7584"><span class='Ref_to_Parameter'>constrName</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                         <span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7585"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7684"><span class='Ref_To_Local'>childrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="tablecmds.c.html#LN327"><span class='Ref_to_Proto'>validateCheckConstraint</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7584"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7590"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Invalidate relcache so that others see the new validated 
             * constraint. 
             */ 
</span>            <a href="../../include/utils/inval.h.html#LN43"><span class='Ref_to_Proto'>CacheInvalidateRelcache</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7584"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if con-&GT;contype==CONSTRA... &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * Now update the catalog, while we have the door open. 
         */ 
</span>        <a href="tablecmds.c.html#LN7632"><span class='Ref_To_Local'>copyTuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN606"><span class='Ref_to_Func'>heap_copytuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7590"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN7633"><span class='Ref_To_Local'>copy_con</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7632"><span class='Ref_To_Local'>copyTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN7633"><span class='Ref_To_Local'>copy_con</span></a><span class='Operator'>-&GT;</span>convalidated <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7587"><span class='Ref_To_Local'>conrel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN7632"><span class='Ref_To_Local'>copyTuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7632"><span class='Ref_To_Local'>copyTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN28"><span class='Ref_to_Const'>ConstraintRelationId</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7590"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7632"><span class='Ref_To_Local'>copyTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7593"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_constraint.h.html#LN28"><span class='Ref_to_Const'>ConstraintRelationId</span></a><span class='Delimiter'>, 
</span>                         <a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7590"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !con-&GT;convalidated &raquo; </span> 
    <span class='Control'>else</span> 
        <a href="tablecmds.c.html#LN7593"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="../catalog/objectaddress.c.html#LN718"><span class='Ref_to_Global_Var'>InvalidObjectAddress</span></a><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* already validated */ 
</span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7588"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7587"><span class='Ref_To_Local'>conrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN7593"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATExecValidateConstraint &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * transformColumnNameList - transform list of column names 
 * 
 * Lookup each name and return its attnum and type OID 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN7749"></a><span class='Declare_Function'>transformColumnNameList</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relId</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>colList</span><span class='Delimiter'>, 
</span><a name="LN7750"></a>                        <a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>attnums</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>atttypids</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN7752"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span><a name="LN7753"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>attnum</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN7753"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7752"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7749"><span class='Ref_to_Parameter'>colList</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN7758"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>attname</span> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7752"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN7759"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>atttuple</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN7759"><span class='Ref_To_Local'>atttuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN129"><span class='Ref_to_Proto'>SearchSysCacheAttName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7749"><span class='Ref_to_Parameter'>relId</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7758"><span class='Ref_To_Local'>attname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7759"><span class='Ref_To_Local'>atttuple</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" referenced in foreign key constraint does not exist"</span><span class='Delimiter'>, 
</span>                            <a href="tablecmds.c.html#LN7758"><span class='Ref_To_Local'>attname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7753"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>&GT;= </span><a href="../../include/pg_config_manual.h.html#LN45"><span class='Ref_to_Const'>INDEX_MAX_KEYS</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_TOO_MANY_COLUMNS<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot have more than %d keys in a foreign key"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/pg_config_manual.h.html#LN45"><span class='Ref_to_Const'>INDEX_MAX_KEYS</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN7750"><span class='Ref_to_Parameter'>attnums</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN7753"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7759"><span class='Ref_To_Local'>atttuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>attnum<span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN7750"><span class='Ref_to_Parameter'>atttypids</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN7753"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7759"><span class='Ref_To_Local'>atttuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>; 
</span>        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7759"><span class='Ref_To_Local'>atttuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN7753"><span class='Ref_To_Local'>attnum</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN7753"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end transformColumnNameList &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * transformFkeyGetPrimaryKey - 
 * 
 *  Look up the names, attnums, and types of the primary key attributes 
 *  for the pkrel.  Also return the index OID and index opclasses of the 
 *  index supporting the primary key. 
 * 
 *  All parameters except pkrel are output parameters.  Also, the function 
 *  return value is the number of attributes in the primary key. 
 * 
 *  Used when the column list in the REFERENCES specification is omitted. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN7794"></a><span class='Declare_Function'>transformFkeyGetPrimaryKey</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>pkrel</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>indexOid</span><span class='Delimiter'>, 
</span><a name="LN7795"></a>                           <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>attnamelist</span><span class='Delimiter'>, 
</span><a name="LN7796"></a>                           <a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>attnums</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>atttypids</span><span class='Delimiter'>, 
</span><a name="LN7797"></a>                           <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>opclasses</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN7799"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>indexoidlist</span><span class='Delimiter'>; 
</span><a name="LN7800"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>indexoidscan</span><span class='Delimiter'>; 
</span><a name="LN7801"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>indexTuple</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN7802"></a>    <a href="../../include/catalog/pg_index.h.html#LN66"><span class='Ref_to_Typedef'>Form_pg_index</span></a> <span class='Declare_Local'>indexStruct</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN7803"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>indclassDatum</span><span class='Delimiter'>; 
</span><a name="LN7804"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN7805"></a>    <a href="../../include/c.h.html#LN477"><span class='Ref_to_Typedef'>oidvector</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>indclass</span><span class='Delimiter'>; 
</span><a name="LN7806"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get the list of index OIDs for the table from the relcache, and look up 
     * each one in the pg_index syscache until we find one marked primary key 
     * (hopefully there isn't more than one such).  Insist it's valid, too. 
     */ 
</span>    <span class='Operator'>*</span><a href="tablecmds.c.html#LN7794"><span class='Ref_to_Parameter'>indexOid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN7799"><span class='Ref_To_Local'>indexoidlist</span></a> <span class='Operator'>= </span><a href="../../include/utils/relcache.h.html#LN40"><span class='Ref_to_Proto'>RelationGetIndexList</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7794"><span class='Ref_to_Parameter'>pkrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7800"><span class='Ref_To_Local'>indexoidscan</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7799"><span class='Ref_To_Local'>indexoidlist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN7819"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>indexoid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7800"><span class='Ref_To_Local'>indexoidscan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN7801"><span class='Ref_To_Local'>indexTuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN65"><span class='Ref_to_EnumConst'>INDEXRELID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7819"><span class='Ref_To_Local'>indexoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7801"><span class='Ref_To_Local'>indexTuple</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for index %u"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7819"><span class='Ref_To_Local'>indexoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN7802"><span class='Ref_To_Local'>indexStruct</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_index.h.html#LN66"><span class='Ref_to_Typedef'>Form_pg_index</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7801"><span class='Ref_To_Local'>indexTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7802"><span class='Ref_To_Local'>indexStruct</span></a><span class='Operator'>-&GT;</span>indisprimary <span class='Operator'>&& </span><a href="../../include/catalog/pg_index.h.html#LN106"><span class='Ref_to_Macro'>IndexIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7802"><span class='Ref_To_Local'>indexStruct</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Refuse to use a deferrable primary key.  This is per SQL spec, 
             * and there would be a lot of interesting semantic problems if we 
             * tried to allow it. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN7802"><span class='Ref_To_Local'>indexStruct</span></a><span class='Operator'>-&GT;</span>indimmediate<span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot use a deferrable primary key for referenced table \"%s\""</span><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7794"><span class='Ref_to_Parameter'>pkrel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
            <span class='Operator'>*</span><a href="tablecmds.c.html#LN7794"><span class='Ref_to_Parameter'>indexOid</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN7819"><span class='Ref_To_Local'>indexoid</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7801"><span class='Ref_To_Local'>indexTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7799"><span class='Ref_To_Local'>indexoidlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check that we found it 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="tablecmds.c.html#LN7794"><span class='Ref_to_Parameter'>indexOid</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"there is no primary key for referenced table \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7794"><span class='Ref_to_Parameter'>pkrel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Must get indclass the hard way */ 
</span>    <a href="tablecmds.c.html#LN7803"><span class='Ref_To_Local'>indclassDatum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN65"><span class='Ref_to_EnumConst'>INDEXRELID</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7801"><span class='Ref_To_Local'>indexTuple</span></a><span class='Delimiter'>, 
</span>                                    <a href="../../include/catalog/pg_index.h.html#LN88"><span class='Ref_to_Const'>Anum_pg_index_indclass</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN7804"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN7804"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN7805"><span class='Ref_To_Local'>indclass</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN477"><span class='Ref_to_Typedef'>oidvector</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7803"><span class='Ref_To_Local'>indclassDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now build the list of PK attributes from the indkey definition (we 
     * assume a primary key cannot have expressional elements) 
     */ 
</span>    <span class='Operator'>*</span><a href="tablecmds.c.html#LN7795"><span class='Ref_to_Parameter'>attnamelist</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7806"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN7806"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tablecmds.c.html#LN7802"><span class='Ref_To_Local'>indexStruct</span></a><span class='Operator'>-&GT;</span>indnatts<span class='Delimiter'>; </span><a href="tablecmds.c.html#LN7806"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN7868"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>pkattno</span> <span class='Operator'>= </span><a href="tablecmds.c.html#LN7802"><span class='Ref_To_Local'>indexStruct</span></a><span class='Operator'>-&GT;</span>indkey<span class='Operator'>.</span>values<span class='Delimiter'>[</span><a href="tablecmds.c.html#LN7806"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <a href="tablecmds.c.html#LN7796"><span class='Ref_to_Parameter'>attnums</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN7806"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="tablecmds.c.html#LN7868"><span class='Ref_To_Local'>pkattno</span></a><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN7796"><span class='Ref_to_Parameter'>atttypids</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN7806"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/parser/parse_relation.h.html#LN127"><span class='Ref_to_Proto'>attnumTypeId</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7794"><span class='Ref_to_Parameter'>pkrel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7868"><span class='Ref_To_Local'>pkattno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN7797"><span class='Ref_to_Parameter'>opclasses</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN7806"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="tablecmds.c.html#LN7805"><span class='Ref_To_Local'>indclass</span></a><span class='Operator'>-&GT;</span><a href="../../include/c.h.html#LN485"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN7806"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>        <span class='Operator'>*</span><a href="tablecmds.c.html#LN7795"><span class='Ref_to_Parameter'>attnamelist</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="tablecmds.c.html#LN7795"><span class='Ref_to_Parameter'>attnamelist</span></a><span class='Delimiter'>, 
</span>               <a href="../nodes/value.c.html#LN51"><span class='Ref_to_Func'>makeString</span></a><span class='Parentheses'>(</span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="../../include/parser/parse_relation.h.html#LN126"><span class='Ref_to_Proto'>attnumAttName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7794"><span class='Ref_to_Parameter'>pkrel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7868"><span class='Ref_To_Local'>pkattno</span></a><span class='Parentheses'>)))))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7801"><span class='Ref_To_Local'>indexTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN7806"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end transformFkeyGetPrimaryKey &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * transformFkeyCheckAttrs - 
 * 
 *  Make sure that the attributes of a referenced table belong to a unique 
 *  (or primary key) constraint.  Return the OID of the index supporting 
 *  the constraint, as well as the opclasses associated with the index 
 *  columns. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN7891"></a><span class='Declare_Function'>transformFkeyCheckAttrs</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>pkrel</span><span class='Delimiter'>, 
</span><a name="LN7892"></a>                        <span class='Keyword'>int </span><span class='Declare_Parameter'>numattrs</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>attnums</span><span class='Delimiter'>, 
</span><a name="LN7893"></a>                        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>opclasses</span><span class='Parentheses'>) </span><span class='Comment_Single_Line'>/* output parameter */ 
</span><span class='Delimiter'>{ 
</span><a name="LN7895"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>indexoid</span> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span><a name="LN7896"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN7897"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found_deferrable</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN7898"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>indexoidlist</span><span class='Delimiter'>; 
</span><a name="LN7899"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>indexoidscan</span><span class='Delimiter'>; 
</span><a name="LN7900"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN7901"></a>                <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Reject duplicate appearances of columns in the referenced-columns list. 
     * Such a case is forbidden by the SQL standard, and even if we thought it 
     * useful to allow it, there would be ambiguity about how to match the 
     * list to unique indexes (in particular, it'd be unclear which index 
     * opclass goes with which FK column). 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7900"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN7900"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tablecmds.c.html#LN7892"><span class='Ref_to_Parameter'>numattrs</span></a><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN7900"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7901"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN7900"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN7901"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="tablecmds.c.html#LN7892"><span class='Ref_to_Parameter'>numattrs</span></a><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN7901"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7892"><span class='Ref_to_Parameter'>attnums</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN7900"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="tablecmds.c.html#LN7892"><span class='Ref_to_Parameter'>attnums</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN7901"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_FOREIGN_KEY<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"foreign key referenced-columns list must not contain duplicates"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get the list of index OIDs for the table from the relcache, and look up 
     * each one in the pg_index syscache, and match unique indexes to the list 
     * of attnums we are given. 
     */ 
</span>    <a href="tablecmds.c.html#LN7898"><span class='Ref_To_Local'>indexoidlist</span></a> <span class='Operator'>= </span><a href="../../include/utils/relcache.h.html#LN40"><span class='Ref_to_Proto'>RelationGetIndexList</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7891"><span class='Ref_to_Parameter'>pkrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7899"><span class='Ref_To_Local'>indexoidscan</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7898"><span class='Ref_To_Local'>indexoidlist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN7930"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>indexTuple</span><span class='Delimiter'>; 
</span><a name="LN7931"></a>        <a href="../../include/catalog/pg_index.h.html#LN66"><span class='Ref_to_Typedef'>Form_pg_index</span></a> <span class='Declare_Local'>indexStruct</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN7895"><span class='Ref_To_Local'>indexoid</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7899"><span class='Ref_To_Local'>indexoidscan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN7930"><span class='Ref_To_Local'>indexTuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN65"><span class='Ref_to_EnumConst'>INDEXRELID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7895"><span class='Ref_To_Local'>indexoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7930"><span class='Ref_To_Local'>indexTuple</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for index %u"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7895"><span class='Ref_To_Local'>indexoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN7931"><span class='Ref_To_Local'>indexStruct</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_index.h.html#LN66"><span class='Ref_to_Typedef'>Form_pg_index</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7930"><span class='Ref_To_Local'>indexTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Must have the right number of columns; must be unique and not a 
         * partial index; forget it if there are any expressions, too. Invalid 
         * indexes are out as well. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7931"><span class='Ref_To_Local'>indexStruct</span></a><span class='Operator'>-&GT;</span>indnatts <span class='Operator'>== </span><a href="tablecmds.c.html#LN7892"><span class='Ref_to_Parameter'>numattrs</span></a> <span class='Operator'>&& 
</span>            <a href="tablecmds.c.html#LN7931"><span class='Ref_To_Local'>indexStruct</span></a><span class='Operator'>-&GT;</span>indisunique <span class='Operator'>&& 
</span>            <a href="../../include/catalog/pg_index.h.html#LN106"><span class='Ref_to_Macro'>IndexIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7931"><span class='Ref_To_Local'>indexStruct</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>            <a href="../access/common/heaptuple.c.html#LN295"><span class='Ref_to_Func'>heap_attisnull</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7930"><span class='Ref_To_Local'>indexTuple</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_index.h.html#LN91"><span class='Ref_to_Const'>Anum_pg_index_indpred</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>            <a href="../access/common/heaptuple.c.html#LN295"><span class='Ref_to_Func'>heap_attisnull</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7930"><span class='Ref_To_Local'>indexTuple</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_index.h.html#LN90"><span class='Ref_to_Const'>Anum_pg_index_indexprs</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN7950"></a>            <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>indclassDatum</span><span class='Delimiter'>; 
</span><a name="LN7951"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN7952"></a>            <a href="../../include/c.h.html#LN477"><span class='Ref_to_Typedef'>oidvector</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>indclass</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Must get indclass the hard way */ 
</span>            <a href="tablecmds.c.html#LN7950"><span class='Ref_To_Local'>indclassDatum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN65"><span class='Ref_to_EnumConst'>INDEXRELID</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN7930"><span class='Ref_To_Local'>indexTuple</span></a><span class='Delimiter'>, 
</span>                                            <a href="../../include/catalog/pg_index.h.html#LN88"><span class='Ref_to_Const'>Anum_pg_index_indclass</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN7951"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN7951"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN7952"><span class='Ref_To_Local'>indclass</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN477"><span class='Ref_to_Typedef'>oidvector</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7950"><span class='Ref_To_Local'>indclassDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * The given attnum list may match the index columns in any order. 
             * Check for a match, and extract the appropriate opclasses while 
             * we're at it. 
             * 
             * We know that attnums[] is duplicate-free per the test at the 
             * start of this function, and we checked above that the number of 
             * index columns agrees, so if we find a match for each attnums[] 
             * entry then we must have a one-to-one match in some order. 
             */ 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7900"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN7900"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tablecmds.c.html#LN7892"><span class='Ref_to_Parameter'>numattrs</span></a><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN7900"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="tablecmds.c.html#LN7896"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7901"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN7901"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="tablecmds.c.html#LN7892"><span class='Ref_to_Parameter'>numattrs</span></a><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN7901"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7892"><span class='Ref_to_Parameter'>attnums</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN7900"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="tablecmds.c.html#LN7931"><span class='Ref_To_Local'>indexStruct</span></a><span class='Operator'>-&GT;</span>indkey<span class='Operator'>.</span>values<span class='Delimiter'>[</span><a href="tablecmds.c.html#LN7901"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="tablecmds.c.html#LN7893"><span class='Ref_to_Parameter'>opclasses</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN7900"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="tablecmds.c.html#LN7952"><span class='Ref_To_Local'>indclass</span></a><span class='Operator'>-&GT;</span><a href="../../include/c.h.html#LN485"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN7901"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]; 
</span>                        <a href="tablecmds.c.html#LN7896"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN7896"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Refuse to use a deferrable unique/primary key.  This is per SQL 
             * spec, and there would be a lot of interesting semantic problems 
             * if we tried to allow it. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7896"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>&& !</span><a href="tablecmds.c.html#LN7931"><span class='Ref_To_Local'>indexStruct</span></a><span class='Operator'>-&GT;</span>indimmediate<span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Remember that we found an otherwise matching index, so that 
                 * we can generate a more appropriate error message. 
                 */ 
</span>                <a href="tablecmds.c.html#LN7897"><span class='Ref_To_Local'>found_deferrable</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN7896"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if indexStruct-&GT;indnatts... &raquo; </span> 
        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7930"><span class='Ref_To_Local'>indexTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7896"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN7896"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7897"><span class='Ref_To_Local'>found_deferrable</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot use a deferrable unique constraint for referenced table \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7891"><span class='Ref_to_Parameter'>pkrel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_FOREIGN_KEY<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"there is no unique constraint matching given keys for referenced table \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7891"><span class='Ref_to_Parameter'>pkrel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN7898"><span class='Ref_To_Local'>indexoidlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN7895"><span class='Ref_To_Local'>indexoid</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end transformFkeyCheckAttrs &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * findFkeyCast - 
 * 
 *  Wrapper around find_coercion_pathway() for ATAddForeignKeyConstraint(). 
 *  Caller has equal regard for binary coercibility and for an exact match. 
*/ 
</span><span class='Keyword'>static </span><a href="../../include/parser/parse_coerce.h.html#LN23"><span class='Ref_to_Enum'>CoercionPathType</span></a> 
<a name="LN8032"></a><span class='Declare_Function'>findFkeyCast</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>targetTypeId</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>sourceTypeId</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>funcid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN8034"></a>    <a href="../../include/parser/parse_coerce.h.html#LN23"><span class='Ref_to_Enum'>CoercionPathType</span></a> <span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8032"><span class='Ref_to_Parameter'>targetTypeId</span></a> <span class='Operator'>== </span><a href="tablecmds.c.html#LN8032"><span class='Ref_to_Parameter'>sourceTypeId</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN8034"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_coerce.h.html#LN27"><span class='Ref_to_EnumConst'>COERCION_PATH_RELABELTYPE</span></a><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="tablecmds.c.html#LN8032"><span class='Ref_to_Parameter'>funcid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN8034"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_coerce.h.html#LN86"><span class='Ref_to_Proto'>find_coercion_pathway</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8032"><span class='Ref_to_Parameter'>targetTypeId</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8032"><span class='Ref_to_Parameter'>sourceTypeId</span></a><span class='Delimiter'>, 
</span>                                    <a href="../../include/nodes/primnodes.h.html#LN420"><span class='Ref_to_EnumConst'>COERCION_IMPLICIT</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8032"><span class='Ref_to_Parameter'>funcid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8034"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>== </span><a href="../../include/parser/parse_coerce.h.html#LN25"><span class='Ref_to_EnumConst'>COERCION_PATH_NONE</span></a><span class='Parentheses'>) 
</span>            <span class='Comment_Multi_Line'>/* A previously-relied-upon cast is now gone. */ 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not find cast from %u to %u"</span><span class='Delimiter'>, 
</span>                 <a href="tablecmds.c.html#LN8032"><span class='Ref_to_Parameter'>sourceTypeId</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8032"><span class='Ref_to_Parameter'>targetTypeId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN8034"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end findFkeyCast &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Permissions checks on the referenced table for ADD FOREIGN KEY 
 * 
 * Note: we have already checked that the user owns the referencing table, 
 * else we'd have failed much earlier; no additional checks are needed for it. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN8061"></a><span class='Declare_Function'>checkFkeyPermissions</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>attnums</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>natts</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN8063"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span> <span class='Operator'>= </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN8064"></a>    <a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span><a name="LN8065"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Okay if we have relation-level REFERENCES permission */ 
</span>    <a href="tablecmds.c.html#LN8064"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN283"><span class='Ref_to_Proto'>pg_class_aclcheck</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8061"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8063"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/nodes/parsenodes.h.html#LN76"><span class='Ref_to_Const'>ACL_REFERENCES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8064"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Else we must have REFERENCES on each column */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8065"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN8065"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tablecmds.c.html#LN8061"><span class='Ref_to_Parameter'>natts</span></a><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN8065"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN8064"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN279"><span class='Ref_to_Proto'>pg_attribute_aclcheck</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8061"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8061"><span class='Ref_to_Parameter'>attnums</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN8065"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                          <a href="tablecmds.c.html#LN8063"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN76"><span class='Ref_to_Const'>ACL_REFERENCES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8064"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8064"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN181"><span class='Ref_to_EnumConst'>ACL_KIND_CLASS</span></a><span class='Delimiter'>, 
</span>                           <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8061"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end checkFkeyPermissions &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Scan the existing rows in a table to verify they meet a proposed 
 * CHECK constraint. 
 * 
 * The caller must have opened and locked the relation appropriately. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN8090"></a><span class='Declare_Function'>validateCheckConstraint</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>constrtup</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN8092"></a>    <a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>estate</span><span class='Delimiter'>; 
</span><a name="LN8093"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN8094"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>conbin</span><span class='Delimiter'>; 
</span><a name="LN8095"></a>    <a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>origexpr</span><span class='Delimiter'>; 
</span><a name="LN8096"></a>    <a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>exprstate</span><span class='Delimiter'>; 
</span><a name="LN8097"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span><span class='Delimiter'>; 
</span><a name="LN8098"></a>    <a href="../../include/access/heapam.h.html#LN99"><span class='Ref_to_Typedef'>HeapScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN8099"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN8100"></a>    <a href="../../include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>econtext</span><span class='Delimiter'>; 
</span><a name="LN8101"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span><a name="LN8102"></a>    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>slot</span><span class='Delimiter'>; 
</span><a name="LN8103"></a>    <a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a> <span class='Declare_Local'>constrForm</span><span class='Delimiter'>; 
</span><a name="LN8104"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN8105"></a>    <a href="../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a>    <span class='Declare_Local'>snapshot</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * VALIDATE CONSTRAINT is a no-op for foreign tables and partitioned 
     * tables. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8090"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a> <span class='Operator'>|| 
</span>        <a href="tablecmds.c.html#LN8090"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN8103"><span class='Ref_To_Local'>constrForm</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8090"><span class='Ref_to_Parameter'>constrtup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN8092"><span class='Ref_To_Local'>estate</span></a> <span class='Operator'>= </span><a href="../executor/execUtils.c.html#LN78"><span class='Ref_to_Func'>CreateExecutorState</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * XXX this tuple doesn't really come from a syscache, but this doesn't 
     * matter to SysCacheGetAttr, because it only wants to be able to fetch 
     * the tupdesc 
     */ 
</span>    <a href="tablecmds.c.html#LN8093"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN52"><span class='Ref_to_EnumConst'>CONSTROID</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8090"><span class='Ref_to_Parameter'>constrtup</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_constraint.h.html#LN175"><span class='Ref_to_Const'>Anum_pg_constraint_conbin</span></a><span class='Delimiter'>, 
</span>                          <span class='Operator'>&</span><a href="tablecmds.c.html#LN8104"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8104"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"null conbin for constraint %u"</span><span class='Delimiter'>, 
</span>             <a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8090"><span class='Ref_to_Parameter'>constrtup</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8094"><span class='Ref_To_Local'>conbin</span></a> <span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8093"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8095"><span class='Ref_To_Local'>origexpr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../nodes/read.c.html#LN36"><span class='Ref_to_Func'>stringToNode</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8094"><span class='Ref_To_Local'>conbin</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8096"><span class='Ref_To_Local'>exprstate</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN246"><span class='Ref_to_Proto'>ExecPrepareExpr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8095"><span class='Ref_To_Local'>origexpr</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8092"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN8100"><span class='Ref_To_Local'>econtext</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN455"><span class='Ref_to_Macro'>GetPerTupleExprContext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8092"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8097"><span class='Ref_To_Local'>tupdesc</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8090"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8102"><span class='Ref_To_Local'>slot</span></a> <span class='Operator'>= </span><a href="../../include/executor/tuptable.h.html#LN144"><span class='Ref_to_Proto'>MakeSingleTupleTableSlot</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8097"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8100"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN196"><span class='Ref_to_Member'>ecxt_scantuple</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN8102"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN8105"><span class='Ref_To_Local'>snapshot</span></a> <span class='Operator'>= </span><a href="../../include/utils/snapmgr.h.html#LN80"><span class='Ref_to_Proto'>RegisterSnapshot</span></a><span class='Parentheses'>(</span><a href="../../include/utils/snapmgr.h.html#LN64"><span class='Ref_to_Proto'>GetLatestSnapshot</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8098"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN108"><span class='Ref_to_Proto'>heap_beginscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8090"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8105"><span class='Ref_To_Local'>snapshot</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Switch to per-tuple memory context and reset it for each tuple 
     * produced, so we don't leak memory. 
     */ 
</span>    <a href="tablecmds.c.html#LN8101"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../../include/executor/executor.h.html#LN460"><span class='Ref_to_Macro'>GetPerTupleMemoryContext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8092"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="tablecmds.c.html#LN8099"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN127"><span class='Ref_to_Proto'>heap_getnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8098"><span class='Ref_To_Local'>scan</span></a><span class='Delimiter'>, </span><a href="../../include/access/sdir.h.html#LN25"><span class='Ref_to_EnumConst'>ForwardScanDirection</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/executor/tuptable.h.html#LN147"><span class='Ref_to_Proto'>ExecStoreTuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8099"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8102"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>, </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/executor/executor.h.html#LN366"><span class='Ref_to_Proto'>ExecCheck</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8096"><span class='Ref_To_Local'>exprstate</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8100"><span class='Ref_To_Local'>econtext</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CHECK_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"check constraint \"%s\" is violated by some row"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8103"><span class='Ref_To_Local'>constrForm</span></a><span class='Operator'>-&GT;</span>conname<span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                     <a href="../../include/utils/relcache.h.html#LN79"><span class='Ref_to_Proto'>errtableconstraint</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8090"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8103"><span class='Ref_To_Local'>constrForm</span></a><span class='Operator'>-&GT;</span>conname<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/executor/executor.h.html#LN449"><span class='Ref_to_Macro'>ResetExprContext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8100"><span class='Ref_To_Local'>econtext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8101"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN126"><span class='Ref_to_Proto'>heap_endscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8098"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/snapmgr.h.html#LN81"><span class='Ref_to_Proto'>UnregisterSnapshot</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8105"><span class='Ref_To_Local'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/executor/tuptable.h.html#LN145"><span class='Ref_to_Proto'>ExecDropSingleTupleTableSlot</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8102"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../executor/execUtils.c.html#LN176"><span class='Ref_to_Func'>FreeExecutorState</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8092"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end validateCheckConstraint &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Scan the existing rows in a table to verify they meet a proposed FK 
 * constraint. 
 * 
 * Caller must have opened and locked both relations appropriately. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN8175"></a><span class='Declare_Function'>validateForeignKeyConstraint</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>conname</span><span class='Delimiter'>, 
</span><a name="LN8176"></a>                             <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN8177"></a>                             <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>pkrel</span><span class='Delimiter'>, 
</span><a name="LN8178"></a>                             <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>pkindOid</span><span class='Delimiter'>, 
</span><a name="LN8179"></a>                             <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>constraintOid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN8181"></a>    <a href="../../include/access/heapam.h.html#LN99"><span class='Ref_to_Typedef'>HeapScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN8182"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN8183"></a>    <a href="../../include/utils/reltrigger.h.html#LN22"><span class='Ref_to_Struct'>Trigger</span></a>     <span class='Declare_Local'>trig</span><span class='Delimiter'>; 
</span><a name="LN8184"></a>    <a href="../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a>    <span class='Declare_Local'>snapshot</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN24"><span class='Ref_to_Const'>DEBUG1</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"validating foreign key constraint \"%s\""</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8175"><span class='Ref_to_Parameter'>conname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Build a trigger call structure; we'll need it either way. 
     */ 
</span>    <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN8183"><span class='Ref_To_Local'>trig</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8183"><span class='Ref_To_Local'>trig</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8183"><span class='Ref_To_Local'>trig</span></a><span class='Operator'>.</span><a href="../../include/utils/reltrigger.h.html#LN24"><span class='Ref_to_Member'>tgoid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8183"><span class='Ref_To_Local'>trig</span></a><span class='Operator'>.</span><a href="../../include/utils/reltrigger.h.html#LN26"><span class='Ref_to_Member'>tgname</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN8175"><span class='Ref_to_Parameter'>conname</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8183"><span class='Ref_To_Local'>trig</span></a><span class='Operator'>.</span><a href="../../include/utils/reltrigger.h.html#LN29"><span class='Ref_to_Member'>tgenabled</span></a> <span class='Operator'>= </span><a href="../../include/commands/trigger.h.html#LN108"><span class='Ref_to_Const'>TRIGGER_FIRES_ON_ORIGIN</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8183"><span class='Ref_To_Local'>trig</span></a><span class='Operator'>.</span><a href="../../include/utils/reltrigger.h.html#LN30"><span class='Ref_to_Member'>tgisinternal</span></a> <span class='Operator'>= </span><span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8183"><span class='Ref_To_Local'>trig</span></a><span class='Operator'>.</span><a href="../../include/utils/reltrigger.h.html#LN31"><span class='Ref_to_Member'>tgconstrrelid</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8177"><span class='Ref_to_Parameter'>pkrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8183"><span class='Ref_To_Local'>trig</span></a><span class='Operator'>.</span><a href="../../include/utils/reltrigger.h.html#LN32"><span class='Ref_to_Member'>tgconstrindid</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN8178"><span class='Ref_to_Parameter'>pkindOid</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8183"><span class='Ref_To_Local'>trig</span></a><span class='Operator'>.</span><a href="../../include/utils/reltrigger.h.html#LN33"><span class='Ref_to_Member'>tgconstraint</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN8179"><span class='Ref_to_Parameter'>constraintOid</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8183"><span class='Ref_To_Local'>trig</span></a><span class='Operator'>.</span><a href="../../include/utils/reltrigger.h.html#LN34"><span class='Ref_to_Member'>tgdeferrable</span></a> <span class='Operator'>= </span><span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8183"><span class='Ref_To_Local'>trig</span></a><span class='Operator'>.</span><a href="../../include/utils/reltrigger.h.html#LN35"><span class='Ref_to_Member'>tginitdeferred</span></a> <span class='Operator'>= </span><span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* we needn't fill in remaining fields */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * See if we can do it with a single LEFT JOIN query.  A FALSE result 
     * indicates we must proceed with the fire-the-trigger method. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/commands/trigger.h.html#LN204"><span class='Ref_to_Proto'>RI_Initial_Check</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN8183"><span class='Ref_To_Local'>trig</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8176"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8177"><span class='Ref_to_Parameter'>pkrel</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Scan through each tuple, calling RI_FKey_check_ins (insert trigger) as 
     * if that tuple had just been inserted.  If any of those fail, it should 
     * ereport(ERROR) and that's that. 
     */ 
</span>    <a href="tablecmds.c.html#LN8184"><span class='Ref_To_Local'>snapshot</span></a> <span class='Operator'>= </span><a href="../../include/utils/snapmgr.h.html#LN80"><span class='Ref_to_Proto'>RegisterSnapshot</span></a><span class='Parentheses'>(</span><a href="../../include/utils/snapmgr.h.html#LN64"><span class='Ref_to_Proto'>GetLatestSnapshot</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8181"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN108"><span class='Ref_to_Proto'>heap_beginscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8176"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8184"><span class='Ref_To_Local'>snapshot</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="tablecmds.c.html#LN8182"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN127"><span class='Ref_to_Proto'>heap_getnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8181"><span class='Ref_To_Local'>scan</span></a><span class='Delimiter'>, </span><a href="../../include/access/sdir.h.html#LN25"><span class='Ref_to_EnumConst'>ForwardScanDirection</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN8221"></a>        <a href="../../include/fmgr.h.html#LN76"><span class='Ref_to_Struct'>FunctionCallInfoData</span></a> <span class='Declare_Local'>fcinfo</span><span class='Delimiter'>; 
</span><a name="LN8222"></a>        <a href="../../include/commands/trigger.h.html#LN29"><span class='Ref_to_Struct'>TriggerData</span></a> <span class='Declare_Local'>trigdata</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Make a call to the trigger function 
         * 
         * No parameters are passed, but we do set a context 
         */ 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN8221"><span class='Ref_To_Local'>fcinfo</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8221"><span class='Ref_To_Local'>fcinfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We assume RI_FKey_check_ins won't look at flinfo... 
         */ 
</span>        <a href="tablecmds.c.html#LN8222"><span class='Ref_To_Local'>trigdata</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN31"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN490"><span class='Ref_to_EnumConst'>T_TriggerData</span></a><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN8222"><span class='Ref_To_Local'>trigdata</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a> <span class='Operator'>= </span><a href="../../include/commands/trigger.h.html#LN51"><span class='Ref_to_Const'>TRIGGER_EVENT_INSERT</span></a> <span class='Operator'>| </span><a href="../../include/commands/trigger.h.html#LN57"><span class='Ref_to_Const'>TRIGGER_EVENT_ROW</span></a><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN8222"><span class='Ref_To_Local'>trigdata</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN33"><span class='Ref_to_Member'>tg_relation</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN8176"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN8222"><span class='Ref_To_Local'>trigdata</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN34"><span class='Ref_to_Member'>tg_trigtuple</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN8182"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN8222"><span class='Ref_To_Local'>trigdata</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN35"><span class='Ref_to_Member'>tg_newtuple</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN8222"><span class='Ref_To_Local'>trigdata</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN36"><span class='Ref_to_Member'>tg_trigger</span></a> <span class='Operator'>= &</span><a href="tablecmds.c.html#LN8183"><span class='Ref_To_Local'>trig</span></a><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN8222"><span class='Ref_To_Local'>trigdata</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN37"><span class='Ref_to_Member'>tg_trigtuplebuf</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN8181"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN69"><span class='Ref_to_Member'>rs_cbuf</span></a><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN8222"><span class='Ref_To_Local'>trigdata</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN38"><span class='Ref_to_Member'>tg_newtuplebuf</span></a> <span class='Operator'>= </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN8221"><span class='Ref_To_Local'>fcinfo</span></a><span class='Operator'>.</span><a href="../../include/fmgr.h.html#LN79"><span class='Ref_to_Member'>context</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN8222"><span class='Ref_To_Local'>trigdata</span></a><span class='Delimiter'>; 
</span> 
        <a href="../utils/adt/ri_triggers.c.html#LN464"><span class='Ref_to_Func'>RI_FKey_check_ins</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN8221"><span class='Ref_To_Local'>fcinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (tuple=heap_getnext(s... &raquo; </span> 
 
    <a href="../../include/access/heapam.h.html#LN126"><span class='Ref_to_Proto'>heap_endscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8181"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/snapmgr.h.html#LN81"><span class='Ref_to_Proto'>UnregisterSnapshot</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8184"><span class='Ref_To_Local'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end validateForeignKeyConstraint &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN8253"></a><span class='Declare_Function'>CreateFKCheckTrigger</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>myRelOid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>refRelOid</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2050"><span class='Ref_to_Struct'>Constraint</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fkconstraint</span><span class='Delimiter'>, 
</span><a name="LN8254"></a>                     <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>constraintOid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>indexOid</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>on_insert</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN8256"></a>    <a href="../../include/nodes/parsenodes.h.html#LN2322"><span class='Ref_to_Struct'>CreateTrigStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fk_trigger</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Note: for a self-referential FK (referencing and referenced tables are 
     * the same), it is important that the ON UPDATE action fires before the 
     * CHECK action, since both triggers will fire on the same row during an 
     * UPDATE event; otherwise the CHECK trigger will be checking a non-final 
     * state of the row.  Triggers fire in name order, so we ensure this by 
     * using names like "RI_ConstraintTrigger_a_NNNN" for the action triggers 
     * and "RI_ConstraintTrigger_c_NNNN" for the check triggers. 
     */ 
</span>    <a href="tablecmds.c.html#LN8256"><span class='Ref_To_Local'>fk_trigger</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2322"><span class='Ref_to_Struct'>CreateTrigStmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8256"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2325"><span class='Ref_to_Member'>trigname</span></a> <span class='Operator'>= </span><span class='String'>"RI_ConstraintTrigger_c"</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8256"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2326"><span class='Ref_to_Member'>relation</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8256"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2329"><span class='Ref_to_Member'>row</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8256"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2331"><span class='Ref_to_Member'>timing</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_trigger.h.html#LN111"><span class='Ref_to_Const'>TRIGGER_TYPE_AFTER</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Either ON INSERT or ON UPDATE */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8254"><span class='Ref_to_Parameter'>on_insert</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN8256"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2327"><span class='Ref_to_Member'>funcname</span></a> <span class='Operator'>= </span><a href="../../include/parser/parser.h.html#LN37"><span class='Ref_to_Proto'>SystemFuncName</span></a><span class='Parentheses'>(</span><span class='String'>"RI_FKey_check_ins"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN8256"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2333"><span class='Ref_to_Member'>events</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_trigger.h.html#LN99"><span class='Ref_to_Const'>TRIGGER_TYPE_INSERT</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN8256"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2327"><span class='Ref_to_Member'>funcname</span></a> <span class='Operator'>= </span><a href="../../include/parser/parser.h.html#LN37"><span class='Ref_to_Proto'>SystemFuncName</span></a><span class='Parentheses'>(</span><span class='String'>"RI_FKey_check_upd"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN8256"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2333"><span class='Ref_to_Member'>events</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_trigger.h.html#LN101"><span class='Ref_to_Const'>TRIGGER_TYPE_UPDATE</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="tablecmds.c.html#LN8256"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2334"><span class='Ref_to_Member'>columns</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8256"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2338"><span class='Ref_to_Member'>transitionRels</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8256"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2335"><span class='Ref_to_Member'>whenClause</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8256"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2336"><span class='Ref_to_Member'>isconstraint</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8256"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2340"><span class='Ref_to_Member'>deferrable</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN8253"><span class='Ref_to_Parameter'>fkconstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2057"><span class='Ref_to_Member'>deferrable</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8256"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2341"><span class='Ref_to_Member'>initdeferred</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN8253"><span class='Ref_to_Parameter'>fkconstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2058"><span class='Ref_to_Member'>initdeferred</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8256"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2342"><span class='Ref_to_Member'>constrrel</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8256"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2328"><span class='Ref_to_Member'>args</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../include/commands/trigger.h.html#LN113"><span class='Ref_to_Proto'>CreateTrigger</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8256"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8253"><span class='Ref_to_Parameter'>myRelOid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8253"><span class='Ref_to_Parameter'>refRelOid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8254"><span class='Ref_to_Parameter'>constraintOid</span></a><span class='Delimiter'>, 
</span>                         <a href="tablecmds.c.html#LN8254"><span class='Ref_to_Parameter'>indexOid</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make changes-so-far visible */ 
</span>    <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CreateFKCheckTrigger &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Create the triggers that implement an FK constraint. 
 * 
 * NB: if you change any trigger properties here, see also 
 * ATExecAlterConstraint. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN8308"></a><span class='Declare_Function'>createForeignKeyTriggers</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>refRelOid</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2050"><span class='Ref_to_Struct'>Constraint</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fkconstraint</span><span class='Delimiter'>, 
</span><a name="LN8309"></a>                         <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>constraintOid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>indexOid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN8311"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>myRelOid</span><span class='Delimiter'>; 
</span><a name="LN8312"></a>    <a href="../../include/nodes/parsenodes.h.html#LN2322"><span class='Ref_to_Struct'>CreateTrigStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fk_trigger</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN8311"><span class='Ref_To_Local'>myRelOid</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8308"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make changes-so-far visible */ 
</span>    <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Build and execute a CREATE CONSTRAINT TRIGGER statement for the ON 
     * DELETE action on the referenced table. 
     */ 
</span>    <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2322"><span class='Ref_to_Struct'>CreateTrigStmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2325"><span class='Ref_to_Member'>trigname</span></a> <span class='Operator'>= </span><span class='String'>"RI_ConstraintTrigger_a"</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2326"><span class='Ref_to_Member'>relation</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2329"><span class='Ref_to_Member'>row</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2331"><span class='Ref_to_Member'>timing</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_trigger.h.html#LN111"><span class='Ref_to_Const'>TRIGGER_TYPE_AFTER</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2333"><span class='Ref_to_Member'>events</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_trigger.h.html#LN100"><span class='Ref_to_Const'>TRIGGER_TYPE_DELETE</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2334"><span class='Ref_to_Member'>columns</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2338"><span class='Ref_to_Member'>transitionRels</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2335"><span class='Ref_to_Member'>whenClause</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2336"><span class='Ref_to_Member'>isconstraint</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2342"><span class='Ref_to_Member'>constrrel</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8308"><span class='Ref_to_Parameter'>fkconstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2087"><span class='Ref_to_Member'>fk_del_action</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2039"><span class='Ref_to_Const'>FKCONSTR_ACTION_NOACTION</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2340"><span class='Ref_to_Member'>deferrable</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN8308"><span class='Ref_to_Parameter'>fkconstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2057"><span class='Ref_to_Member'>deferrable</span></a><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2341"><span class='Ref_to_Member'>initdeferred</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN8308"><span class='Ref_to_Parameter'>fkconstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2058"><span class='Ref_to_Member'>initdeferred</span></a><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2327"><span class='Ref_to_Member'>funcname</span></a> <span class='Operator'>= </span><a href="../../include/parser/parser.h.html#LN37"><span class='Ref_to_Proto'>SystemFuncName</span></a><span class='Parentheses'>(</span><span class='String'>"RI_FKey_noaction_del"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2040"><span class='Ref_to_Const'>FKCONSTR_ACTION_RESTRICT</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2340"><span class='Ref_to_Member'>deferrable</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2341"><span class='Ref_to_Member'>initdeferred</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2327"><span class='Ref_to_Member'>funcname</span></a> <span class='Operator'>= </span><a href="../../include/parser/parser.h.html#LN37"><span class='Ref_to_Proto'>SystemFuncName</span></a><span class='Parentheses'>(</span><span class='String'>"RI_FKey_restrict_del"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2041"><span class='Ref_to_Const'>FKCONSTR_ACTION_CASCADE</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2340"><span class='Ref_to_Member'>deferrable</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2341"><span class='Ref_to_Member'>initdeferred</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2327"><span class='Ref_to_Member'>funcname</span></a> <span class='Operator'>= </span><a href="../../include/parser/parser.h.html#LN37"><span class='Ref_to_Proto'>SystemFuncName</span></a><span class='Parentheses'>(</span><span class='String'>"RI_FKey_cascade_del"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2042"><span class='Ref_to_Const'>FKCONSTR_ACTION_SETNULL</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2340"><span class='Ref_to_Member'>deferrable</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2341"><span class='Ref_to_Member'>initdeferred</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2327"><span class='Ref_to_Member'>funcname</span></a> <span class='Operator'>= </span><a href="../../include/parser/parser.h.html#LN37"><span class='Ref_to_Proto'>SystemFuncName</span></a><span class='Parentheses'>(</span><span class='String'>"RI_FKey_setnull_del"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2043"><span class='Ref_to_Const'>FKCONSTR_ACTION_SETDEFAULT</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2340"><span class='Ref_to_Member'>deferrable</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2341"><span class='Ref_to_Member'>initdeferred</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2327"><span class='Ref_to_Member'>funcname</span></a> <span class='Operator'>= </span><a href="../../include/parser/parser.h.html#LN37"><span class='Ref_to_Proto'>SystemFuncName</span></a><span class='Parentheses'>(</span><span class='String'>"RI_FKey_setdefault_del"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized FK action type: %d"</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN8308"><span class='Ref_to_Parameter'>fkconstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2087"><span class='Ref_to_Member'>fk_del_action</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch fkconstraint-&GT;fk_del_... &raquo; </span> 
    <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2328"><span class='Ref_to_Member'>args</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../include/commands/trigger.h.html#LN113"><span class='Ref_to_Proto'>CreateTrigger</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8308"><span class='Ref_to_Parameter'>refRelOid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8311"><span class='Ref_To_Local'>myRelOid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8309"><span class='Ref_to_Parameter'>constraintOid</span></a><span class='Delimiter'>, 
</span>                         <a href="tablecmds.c.html#LN8309"><span class='Ref_to_Parameter'>indexOid</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make changes-so-far visible */ 
</span>    <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Build and execute a CREATE CONSTRAINT TRIGGER statement for the ON 
     * UPDATE action on the referenced table. 
     */ 
</span>    <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2322"><span class='Ref_to_Struct'>CreateTrigStmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2325"><span class='Ref_to_Member'>trigname</span></a> <span class='Operator'>= </span><span class='String'>"RI_ConstraintTrigger_a"</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2326"><span class='Ref_to_Member'>relation</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2329"><span class='Ref_to_Member'>row</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2331"><span class='Ref_to_Member'>timing</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_trigger.h.html#LN111"><span class='Ref_to_Const'>TRIGGER_TYPE_AFTER</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2333"><span class='Ref_to_Member'>events</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_trigger.h.html#LN101"><span class='Ref_to_Const'>TRIGGER_TYPE_UPDATE</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2334"><span class='Ref_to_Member'>columns</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2338"><span class='Ref_to_Member'>transitionRels</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2335"><span class='Ref_to_Member'>whenClause</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2336"><span class='Ref_to_Member'>isconstraint</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2342"><span class='Ref_to_Member'>constrrel</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8308"><span class='Ref_to_Parameter'>fkconstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2086"><span class='Ref_to_Member'>fk_upd_action</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2039"><span class='Ref_to_Const'>FKCONSTR_ACTION_NOACTION</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2340"><span class='Ref_to_Member'>deferrable</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN8308"><span class='Ref_to_Parameter'>fkconstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2057"><span class='Ref_to_Member'>deferrable</span></a><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2341"><span class='Ref_to_Member'>initdeferred</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN8308"><span class='Ref_to_Parameter'>fkconstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2058"><span class='Ref_to_Member'>initdeferred</span></a><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2327"><span class='Ref_to_Member'>funcname</span></a> <span class='Operator'>= </span><a href="../../include/parser/parser.h.html#LN37"><span class='Ref_to_Proto'>SystemFuncName</span></a><span class='Parentheses'>(</span><span class='String'>"RI_FKey_noaction_upd"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2040"><span class='Ref_to_Const'>FKCONSTR_ACTION_RESTRICT</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2340"><span class='Ref_to_Member'>deferrable</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2341"><span class='Ref_to_Member'>initdeferred</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2327"><span class='Ref_to_Member'>funcname</span></a> <span class='Operator'>= </span><a href="../../include/parser/parser.h.html#LN37"><span class='Ref_to_Proto'>SystemFuncName</span></a><span class='Parentheses'>(</span><span class='String'>"RI_FKey_restrict_upd"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2041"><span class='Ref_to_Const'>FKCONSTR_ACTION_CASCADE</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2340"><span class='Ref_to_Member'>deferrable</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2341"><span class='Ref_to_Member'>initdeferred</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2327"><span class='Ref_to_Member'>funcname</span></a> <span class='Operator'>= </span><a href="../../include/parser/parser.h.html#LN37"><span class='Ref_to_Proto'>SystemFuncName</span></a><span class='Parentheses'>(</span><span class='String'>"RI_FKey_cascade_upd"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2042"><span class='Ref_to_Const'>FKCONSTR_ACTION_SETNULL</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2340"><span class='Ref_to_Member'>deferrable</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2341"><span class='Ref_to_Member'>initdeferred</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2327"><span class='Ref_to_Member'>funcname</span></a> <span class='Operator'>= </span><a href="../../include/parser/parser.h.html#LN37"><span class='Ref_to_Proto'>SystemFuncName</span></a><span class='Parentheses'>(</span><span class='String'>"RI_FKey_setnull_upd"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2043"><span class='Ref_to_Const'>FKCONSTR_ACTION_SETDEFAULT</span></a><span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2340"><span class='Ref_to_Member'>deferrable</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2341"><span class='Ref_to_Member'>initdeferred</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2327"><span class='Ref_to_Member'>funcname</span></a> <span class='Operator'>= </span><a href="../../include/parser/parser.h.html#LN37"><span class='Ref_to_Proto'>SystemFuncName</span></a><span class='Parentheses'>(</span><span class='String'>"RI_FKey_setdefault_upd"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized FK action type: %d"</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN8308"><span class='Ref_to_Parameter'>fkconstraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2086"><span class='Ref_to_Member'>fk_upd_action</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch fkconstraint-&GT;fk_upd_... &raquo; </span> 
    <a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2328"><span class='Ref_to_Member'>args</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../include/commands/trigger.h.html#LN113"><span class='Ref_to_Proto'>CreateTrigger</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8312"><span class='Ref_To_Local'>fk_trigger</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8308"><span class='Ref_to_Parameter'>refRelOid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8311"><span class='Ref_To_Local'>myRelOid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8309"><span class='Ref_to_Parameter'>constraintOid</span></a><span class='Delimiter'>, 
</span>                         <a href="tablecmds.c.html#LN8309"><span class='Ref_to_Parameter'>indexOid</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make changes-so-far visible */ 
</span>    <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Build and execute CREATE CONSTRAINT TRIGGER statements for the CHECK 
     * action for both INSERTs and UPDATEs on the referencing table. 
     */ 
</span>    <a href="tablecmds.c.html#LN8252"><span class='Ref_to_Func'>CreateFKCheckTrigger</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8311"><span class='Ref_To_Local'>myRelOid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8308"><span class='Ref_to_Parameter'>refRelOid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8308"><span class='Ref_to_Parameter'>fkconstraint</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8309"><span class='Ref_to_Parameter'>constraintOid</span></a><span class='Delimiter'>, 
</span>                         <a href="tablecmds.c.html#LN8309"><span class='Ref_to_Parameter'>indexOid</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8252"><span class='Ref_to_Func'>CreateFKCheckTrigger</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8311"><span class='Ref_To_Local'>myRelOid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8308"><span class='Ref_to_Parameter'>refRelOid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8308"><span class='Ref_to_Parameter'>fkconstraint</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8309"><span class='Ref_to_Parameter'>constraintOid</span></a><span class='Delimiter'>, 
</span>                         <a href="tablecmds.c.html#LN8309"><span class='Ref_to_Parameter'>indexOid</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end createForeignKeyTriggers &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ALTER TABLE DROP CONSTRAINT 
 * 
 * Like DROP COLUMN, we can't use the normal ALTER TABLE recursion mechanism. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN8445"></a><span class='Declare_Function'>ATExecDropConstraint</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>constrName</span><span class='Delimiter'>, 
</span><a name="LN8446"></a>                     <a href="../../include/nodes/parsenodes.h.html#LN1652"><span class='Ref_to_Enum'>DropBehavior</span></a> <span class='Declare_Parameter'>behavior</span><span class='Delimiter'>, 
</span><a name="LN8447"></a>                     <span class='Keyword'>bool </span><span class='Declare_Parameter'>recurse</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recursing</span><span class='Delimiter'>, 
</span><a name="LN8448"></a>                     <span class='Keyword'>bool </span><span class='Declare_Parameter'>missing_ok</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN8450"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>children</span><span class='Delimiter'>; 
</span><a name="LN8451"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>child</span><span class='Delimiter'>; 
</span><a name="LN8452"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>conrel</span><span class='Delimiter'>; 
</span><a name="LN8453"></a>    <a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a> <span class='Declare_Local'>con</span><span class='Delimiter'>; 
</span><a name="LN8454"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN8455"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>; 
</span><a name="LN8456"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN8457"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN8458"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_no_inherit_constraint</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* At top level, permission check was done in ATPrepCmd, else do it */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8447"><span class='Ref_to_Parameter'>recursing</span></a><span class='Parentheses'>) 
</span>        <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8445"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN283"><span class='Ref_to_Const'>ATT_FOREIGN_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN8452"><span class='Ref_To_Local'>conrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN28"><span class='Ref_to_Const'>ConstraintRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Find and drop the target constraint 
     */ 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN8455"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/catalog/pg_constraint.h.html#LN159"><span class='Ref_to_Const'>Anum_pg_constraint_conrelid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8445"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8454"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8452"><span class='Ref_To_Local'>conrel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN125"><span class='Ref_to_Const'>ConstraintRelidIndexId</span></a><span class='Delimiter'>, 
</span>                              <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN8455"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8456"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8454"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN8478"></a>        <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>conobj</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN8453"><span class='Ref_To_Local'>con</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8456"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8453"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>conname<span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8445"><span class='Ref_to_Parameter'>constrName</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Don't drop inherited constraints */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8453"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>coninhcount <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& !</span><a href="tablecmds.c.html#LN8447"><span class='Ref_to_Parameter'>recursing</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TABLE_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot drop inherited constraint \"%s\" of relation \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="tablecmds.c.html#LN8445"><span class='Ref_to_Parameter'>constrName</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8445"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN8458"><span class='Ref_To_Local'>is_no_inherit_constraint</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN8453"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>connoinherit<span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If it's a foreign-key constraint, we'd better lock the referenced 
         * table and check that that's not in use, just as we've already done 
         * for the constrained table (else we might, eg, be dropping a trigger 
         * that has unfired events).  But we can/must skip that in the 
         * self-referential case. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8453"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>contype <span class='Operator'>== </span><a href="../../include/catalog/pg_constraint.h.html#LN188"><span class='Ref_to_Const'>CONSTRAINT_FOREIGN</span></a> <span class='Operator'>&& 
</span>            <a href="tablecmds.c.html#LN8453"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>confrelid <span class='Operator'>!= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8445"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN8504"></a>            <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>frel</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Must match lock taken by RemoveTriggerById: */ 
</span>            <a href="tablecmds.c.html#LN8504"><span class='Ref_To_Local'>frel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8453"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>confrelid<span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/commands/tablecmds.h.html#LN52"><span class='Ref_to_Proto'>CheckTableNotInUse</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8504"><span class='Ref_To_Local'>frel</span></a><span class='Delimiter'>, </span><span class='String'>"ALTER TABLE"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8504"><span class='Ref_To_Local'>frel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Perform the actual constraint deletion 
         */ 
</span>        <a href="tablecmds.c.html#LN8478"><span class='Ref_To_Local'>conobj</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_constraint.h.html#LN28"><span class='Ref_to_Const'>ConstraintRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN8478"><span class='Ref_To_Local'>conobj</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8456"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN8478"><span class='Ref_To_Local'>conobj</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/dependency.h.html#LN182"><span class='Ref_to_Proto'>performDeletion</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN8478"><span class='Ref_To_Local'>conobj</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8446"><span class='Ref_to_Parameter'>behavior</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN8457"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* constraint found and dropped -- no need to keep looping */ 
</span>        <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while HeapTupleIsValid(tupl... &raquo; </span> 
 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8454"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN8457"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN8448"><span class='Ref_to_Parameter'>missing_ok</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"constraint \"%s\" of relation \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                       <a href="tablecmds.c.html#LN8445"><span class='Ref_to_Parameter'>constrName</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8445"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"constraint \"%s\" of relation \"%s\" does not exist, skipping"</span><span class='Delimiter'>, 
</span>                            <a href="tablecmds.c.html#LN8445"><span class='Ref_to_Parameter'>constrName</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8445"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8452"><span class='Ref_To_Local'>conrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Propagate to children as appropriate.  Unlike most other ALTER 
     * routines, we have to do this one level of recursion at a time; we can't 
     * use find_all_inheritors to do it in one pass. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN8458"><span class='Ref_To_Local'>is_no_inherit_constraint</span></a><span class='Parentheses'>) 
</span>        <a href="tablecmds.c.html#LN8450"><span class='Ref_To_Local'>children</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_inherits_fn.h.html#LN19"><span class='Ref_to_Proto'>find_inheritance_children</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8445"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8448"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="tablecmds.c.html#LN8450"><span class='Ref_To_Local'>children</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * For a partitioned table, if partitions exist and we are told not to 
     * recurse, it's a user error.  It doesn't make sense to have a constraint 
     * be defined only on the parent, especially if it's a partitioned table. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8445"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a> <span class='Operator'>&& 
</span>        <a href="tablecmds.c.html#LN8450"><span class='Ref_To_Local'>children</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>&& !</span><a href="tablecmds.c.html#LN8447"><span class='Ref_to_Parameter'>recurse</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TABLE_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot remove constraint from only the partitioned table when partitions exist"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Do not specify the ONLY keyword."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8451"><span class='Ref_To_Local'>child</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8450"><span class='Ref_To_Local'>children</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN8572"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>childrelid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8451"><span class='Ref_To_Local'>child</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN8573"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>childrel</span><span class='Delimiter'>; 
</span><a name="LN8574"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>copy_tuple</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* find_inheritance_children already got lock */ 
</span>        <a href="tablecmds.c.html#LN8573"><span class='Ref_To_Local'>childrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8572"><span class='Ref_To_Local'>childrelid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/commands/tablecmds.h.html#LN52"><span class='Ref_to_Proto'>CheckTableNotInUse</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8573"><span class='Ref_To_Local'>childrel</span></a><span class='Delimiter'>, </span><span class='String'>"ALTER TABLE"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN8455"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, 
</span>                    <a href="../../include/catalog/pg_constraint.h.html#LN159"><span class='Ref_to_Const'>Anum_pg_constraint_conrelid</span></a><span class='Delimiter'>, 
</span>                    <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                    <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8572"><span class='Ref_To_Local'>childrelid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN8454"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8452"><span class='Ref_To_Local'>conrel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN125"><span class='Ref_to_Const'>ConstraintRelidIndexId</span></a><span class='Delimiter'>, 
</span>                                  <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN8455"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* scan for matching tuple - there should only be one */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8456"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8454"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="tablecmds.c.html#LN8453"><span class='Ref_To_Local'>con</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8456"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Right now only CHECK constraints can be inherited */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8453"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>contype <span class='Operator'>!= </span><a href="../../include/catalog/pg_constraint.h.html#LN187"><span class='Ref_to_Const'>CONSTRAINT_CHECK</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8453"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>conname<span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8445"><span class='Ref_to_Parameter'>constrName</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8456"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"constraint \"%s\" of relation \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                       <a href="tablecmds.c.html#LN8445"><span class='Ref_to_Parameter'>constrName</span></a><span class='Delimiter'>, 
</span>                       <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8573"><span class='Ref_To_Local'>childrel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN8574"><span class='Ref_To_Local'>copy_tuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN606"><span class='Ref_to_Func'>heap_copytuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8456"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8454"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN8453"><span class='Ref_To_Local'>con</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8574"><span class='Ref_To_Local'>copy_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8453"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>coninhcount <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span>      <span class='Comment_Single_Line'>/* shouldn't happen */ 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"relation %u has non-inherited constraint \"%s\""</span><span class='Delimiter'>, 
</span>                 <a href="tablecmds.c.html#LN8572"><span class='Ref_To_Local'>childrelid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8445"><span class='Ref_to_Parameter'>constrName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8447"><span class='Ref_to_Parameter'>recurse</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * If the child constraint has other definition sources, just 
             * decrement its inheritance count; if not, recurse to delete it. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8453"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>coninhcount <span class='Operator'>== </span><span class='Number'>1</span> <span class='Operator'>&& !</span><a href="tablecmds.c.html#LN8453"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>conislocal<span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Time to delete this child constraint, too */ 
</span>                <a href="tablecmds.c.html#LN406"><span class='Ref_to_Proto'>ATExecDropConstraint</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8573"><span class='Ref_To_Local'>childrel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8445"><span class='Ref_to_Parameter'>constrName</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8446"><span class='Ref_to_Parameter'>behavior</span></a><span class='Delimiter'>, 
</span>                                     <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                     <span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8448"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Child constraint must survive my deletion */ 
</span>                <a href="tablecmds.c.html#LN8453"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>coninhcount<span class='Operator'>--</span><span class='Delimiter'>; 
</span>                <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8452"><span class='Ref_To_Local'>conrel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN8574"><span class='Ref_To_Local'>copy_tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8574"><span class='Ref_To_Local'>copy_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Make update visible */ 
</span>                <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if recurse &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * If we were told to drop ONLY in this table (no recursion), we 
             * need to mark the inheritors' constraints as locally defined 
             * rather than inherited. 
             */ 
</span>            <a href="tablecmds.c.html#LN8453"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>coninhcount<span class='Operator'>--</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN8453"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>conislocal <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8452"><span class='Ref_To_Local'>conrel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN8574"><span class='Ref_To_Local'>copy_tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8574"><span class='Ref_To_Local'>copy_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Make update visible */ 
</span>            <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8574"><span class='Ref_To_Local'>copy_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8573"><span class='Ref_To_Local'>childrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8452"><span class='Ref_To_Local'>conrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATExecDropConstraint &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ALTER COLUMN TYPE 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN8668"></a><span class='Declare_Function'>ATPrepAlterColumnType</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>wqueue</span><span class='Delimiter'>, 
</span><a name="LN8669"></a>                      <a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tab</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN8670"></a>                      <span class='Keyword'>bool </span><span class='Declare_Parameter'>recurse</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recursing</span><span class='Delimiter'>, 
</span><a name="LN8671"></a>                      <a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cmd</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN8673"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>colName</span> <span class='Operator'>= </span><a href="tablecmds.c.html#LN8671"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1753"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>; 
</span><a name="LN8674"></a>    <a href="../../include/nodes/parsenodes.h.html#LN636"><span class='Ref_to_Struct'>ColumnDef</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>def</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN636"><span class='Ref_to_Struct'>ColumnDef</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN8671"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Delimiter'>; 
</span><a name="LN8675"></a>    <a href="../../include/nodes/parsenodes.h.html#LN205"><span class='Ref_to_Struct'>TypeName</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>typeName</span> <span class='Operator'>= </span><a href="tablecmds.c.html#LN8674"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN640"><span class='Ref_to_Member'>typeName</span></a><span class='Delimiter'>; 
</span><a name="LN8676"></a>    <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>transform</span> <span class='Operator'>= </span><a href="tablecmds.c.html#LN8674"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN648"><span class='Ref_to_Member'>cooked_default</span></a><span class='Delimiter'>; 
</span><a name="LN8677"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN8678"></a>    <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>attTup</span><span class='Delimiter'>; 
</span><a name="LN8679"></a>    <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>attnum</span><span class='Delimiter'>; 
</span><a name="LN8680"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>targettype</span><span class='Delimiter'>; 
</span><a name="LN8681"></a>    <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>targettypmod</span><span class='Delimiter'>; 
</span><a name="LN8682"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>targetcollid</span><span class='Delimiter'>; 
</span><a name="LN8683"></a>    <a href="tablecmds.c.html#LN197"><span class='Ref_to_Struct'>NewColumnValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>newval</span><span class='Delimiter'>; 
</span><a name="LN8684"></a>    <a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pstate</span> <span class='Operator'>= </span><a href="../parser/parse_node.c.html#LN42"><span class='Ref_to_Func'>make_parsestate</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN8685"></a>    <a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span><a name="LN8686"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_expr</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8669"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reloftype <span class='Operator'>&& !</span><a href="tablecmds.c.html#LN8670"><span class='Ref_to_Parameter'>recursing</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot alter column type of typed table"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* lookup the attribute so we can check inheritance status */ 
</span>    <a href="tablecmds.c.html#LN8677"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN129"><span class='Ref_to_Proto'>SearchSysCacheAttName</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8669"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8673"><span class='Ref_To_Local'>colName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8677"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" of relation \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN8673"><span class='Ref_To_Local'>colName</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8669"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8678"><span class='Ref_To_Local'>attTup</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8677"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8679"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN8678"><span class='Ref_To_Local'>attTup</span></a><span class='Operator'>-&GT;</span>attnum<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Can't alter a system attribute */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8679"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot alter system column \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN8673"><span class='Ref_To_Local'>colName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Don't alter inherited columns */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8678"><span class='Ref_To_Local'>attTup</span></a><span class='Operator'>-&GT;</span>attinhcount <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& !</span><a href="tablecmds.c.html#LN8670"><span class='Ref_to_Parameter'>recursing</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TABLE_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot alter inherited column \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN8673"><span class='Ref_To_Local'>colName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Don't alter columns used in the partition key */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN467"><span class='Ref_to_Proto'>is_partition_attr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8669"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8679"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN8686"><span class='Ref_To_Local'>is_expr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN8686"><span class='Ref_To_Local'>is_expr</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TABLE_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot alter type of column named in partition key"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TABLE_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot alter type of column referenced in partition key expression"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Look up the target type */ 
</span>    <a href="../../include/parser/parse_type.h.html#LN28"><span class='Ref_to_Proto'>typenameTypeIdAndMod</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8675"><span class='Ref_To_Local'>typeName</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN8680"><span class='Ref_To_Local'>targettype</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN8681"><span class='Ref_To_Local'>targettypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN8685"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN293"><span class='Ref_to_Proto'>pg_type_aclcheck</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8680"><span class='Ref_To_Local'>targettype</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8685"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/acl.h.html#LN301"><span class='Ref_to_Proto'>aclcheck_error_type</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8685"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8680"><span class='Ref_To_Local'>targettype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* And the collation */ 
</span>    <a href="tablecmds.c.html#LN8682"><span class='Ref_To_Local'>targetcollid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN35"><span class='Ref_to_Proto'>GetColumnDefCollation</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8674"><span class='Ref_To_Local'>def</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8680"><span class='Ref_To_Local'>targettype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* make sure datatype is legal for a column */ 
</span>    <a href="../../include/catalog/heap.h.html#LN131"><span class='Ref_to_Proto'>CheckAttributeType</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8673"><span class='Ref_To_Local'>colName</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8680"><span class='Ref_To_Local'>targettype</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8682"><span class='Ref_To_Local'>targetcollid</span></a><span class='Delimiter'>, 
</span>                       <a href="../../include/nodes/pg_list.h.html#LN150"><span class='Ref_to_Macro'>list_make1_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8669"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltype<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                       <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8669"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN157"><span class='Ref_to_Member'>relkind</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a> <span class='Operator'>|| 
</span>        <a href="tablecmds.c.html#LN8669"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN157"><span class='Ref_to_Member'>relkind</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Set up an expression to transform the old data value to the new 
         * type. If a USING option was given, use the expression as 
         * transformed by transformAlterTableStmt, else just take the old 
         * value and try to coerce it.  We do this first so that type 
         * incompatibility can be detected before we waste effort, and because 
         * we need the expression to be parsed against the original table row 
         * type. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN8676"><span class='Ref_To_Local'>transform</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="tablecmds.c.html#LN8676"><span class='Ref_To_Local'>transform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/makefuncs.h.html#LN25"><span class='Ref_to_Proto'>makeVar</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8679"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>, 
</span>                                         <a href="tablecmds.c.html#LN8678"><span class='Ref_To_Local'>attTup</span></a><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8678"><span class='Ref_To_Local'>attTup</span></a><span class='Operator'>-&GT;</span>atttypmod<span class='Delimiter'>, 
</span>                                         <a href="tablecmds.c.html#LN8678"><span class='Ref_To_Local'>attTup</span></a><span class='Operator'>-&GT;</span>attcollation<span class='Delimiter'>, 
</span>                                         <span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="tablecmds.c.html#LN8676"><span class='Ref_To_Local'>transform</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_coerce.h.html#LN37"><span class='Ref_to_Proto'>coerce_to_target_type</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8684"><span class='Ref_To_Local'>pstate</span></a><span class='Delimiter'>, 
</span>                                          <a href="tablecmds.c.html#LN8676"><span class='Ref_To_Local'>transform</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8676"><span class='Ref_To_Local'>transform</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                          <a href="tablecmds.c.html#LN8680"><span class='Ref_To_Local'>targettype</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8681"><span class='Ref_To_Local'>targettypmod</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../include/nodes/primnodes.h.html#LN421"><span class='Ref_to_EnumConst'>COERCION_ASSIGNMENT</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../include/nodes/primnodes.h.html#LN438"><span class='Ref_to_EnumConst'>COERCE_IMPLICIT_CAST</span></a><span class='Delimiter'>, 
</span>                                          <span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8676"><span class='Ref_To_Local'>transform</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* error text depends on whether USING was specified or not */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8674"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN648"><span class='Ref_to_Member'>cooked_default</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"result of USING clause for column \"%s\""</span> 
                                <span class='String'>" cannot be cast automatically to type %s"</span><span class='Delimiter'>, 
</span>                                <a href="tablecmds.c.html#LN8673"><span class='Ref_To_Local'>colName</span></a><span class='Delimiter'>, </span><a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8680"><span class='Ref_To_Local'>targettype</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"You might need to add an explicit cast."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" cannot be cast automatically to type %s"</span><span class='Delimiter'>, 
</span>                                <a href="tablecmds.c.html#LN8673"><span class='Ref_To_Local'>colName</span></a><span class='Delimiter'>, </span><a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8680"><span class='Ref_To_Local'>targettype</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                <span class='Comment_Multi_Line'>/* translator: USING is SQL, don't translate it */ 
</span>                       <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"You might need to specify \"USING %s::%s\"."</span><span class='Delimiter'>, 
</span>                               <a href="../../include/utils/builtins.h.html#LN77"><span class='Ref_to_Proto'>quote_identifier</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8673"><span class='Ref_To_Local'>colName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                               <a href="../utils/adt/format_type.c.html#LN111"><span class='Ref_to_Func'>format_type_with_typemod</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8680"><span class='Ref_To_Local'>targettype</span></a><span class='Delimiter'>, 
</span>                                                        <a href="tablecmds.c.html#LN8681"><span class='Ref_To_Local'>targettypmod</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if transform==NULL &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* Fix collations after all else */ 
</span>        <a href="../../include/parser/parse_collate.h.html#LN22"><span class='Ref_to_Proto'>assign_expr_collations</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8684"><span class='Ref_To_Local'>pstate</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8676"><span class='Ref_To_Local'>transform</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Plan the expr now so we can accurately assess the need to rewrite. */ 
</span>        <a href="tablecmds.c.html#LN8676"><span class='Ref_To_Local'>transform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/optimizer/planner.h.html#LN53"><span class='Ref_to_Proto'>expression_planner</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN8676"><span class='Ref_To_Local'>transform</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Add a work queue item to make ATRewriteTable update the column 
         * contents. 
         */ 
</span>        <a href="tablecmds.c.html#LN8683"><span class='Ref_To_Local'>newval</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN197"><span class='Ref_to_Struct'>NewColumnValue</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN197"><span class='Ref_to_Struct'>NewColumnValue</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN8683"><span class='Ref_To_Local'>newval</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN199"><span class='Ref_to_Member'>attnum</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN8679"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN8683"><span class='Ref_To_Local'>newval</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN200"><span class='Ref_to_Member'>expr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN8676"><span class='Ref_To_Local'>transform</span></a><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN8669"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN163"><span class='Ref_to_Member'>newvals</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8669"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN163"><span class='Ref_to_Member'>newvals</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8683"><span class='Ref_To_Local'>newval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN414"><span class='Ref_to_Proto'>ATColumnChangeRequiresRewrite</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8676"><span class='Ref_To_Local'>transform</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8679"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>))</span> 
            <a href="tablecmds.c.html#LN8669"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN165"><span class='Ref_to_Member'>rewrite</span></a> <span class='Operator'>|= </span><a href="../../include/commands/event_trigger.h.html#LN32"><span class='Ref_to_Const'>AT_REWRITE_COLUMN_REWRITE</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if tab-&GT;relkind==RELKIND... &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8676"><span class='Ref_To_Local'>transform</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a table"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8669"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8669"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN157"><span class='Ref_to_Member'>relkind</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN165"><span class='Ref_to_Const'>RELKIND_COMPOSITE_TYPE</span></a> <span class='Operator'>|| 
</span>        <a href="tablecmds.c.html#LN8669"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN157"><span class='Ref_to_Member'>relkind</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * For composite types, do this check now.  Tables will check it later 
         * when the table is being rewritten. 
         */ 
</span>        <a href="../../include/commands/tablecmds.h.html#LN69"><span class='Ref_to_Proto'>find_composite_type_dependencies</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8669"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltype<span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8669"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8677"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Recurse manually by queueing a new command for each child, if 
     * necessary. We cannot apply ATSimpleRecursion here because we need to 
     * remap attribute numbers in the USING expression, if any. 
     * 
     * If we are told not to recurse, there had better not be any child 
     * tables; else the alter would put them out of step. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8670"><span class='Ref_to_Parameter'>recurse</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN8839"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8669"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN8840"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>child</span><span class='Delimiter'>; 
</span><a name="LN8841"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>children</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN8841"><span class='Ref_To_Local'>children</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_inherits_fn.h.html#LN20"><span class='Ref_to_Proto'>find_all_inheritors</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8839"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8671"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * find_all_inheritors does the recursive search of the inheritance 
         * hierarchy, so all we have to do is process all of the relids in the 
         * list that it returns. 
         */ 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8840"><span class='Ref_To_Local'>child</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8841"><span class='Ref_To_Local'>children</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN8852"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>childrelid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8840"><span class='Ref_To_Local'>child</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN8853"></a>            <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>childrel</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8852"><span class='Ref_To_Local'>childrelid</span></a> <span class='Operator'>== </span><a href="tablecmds.c.html#LN8839"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* find_all_inheritors already got lock */ 
</span>            <a href="tablecmds.c.html#LN8853"><span class='Ref_To_Local'>childrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN84"><span class='Ref_to_Proto'>relation_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8852"><span class='Ref_To_Local'>childrelid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/commands/tablecmds.h.html#LN52"><span class='Ref_to_Proto'>CheckTableNotInUse</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8853"><span class='Ref_To_Local'>childrel</span></a><span class='Delimiter'>, </span><span class='String'>"ALTER TABLE"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Remap the attribute numbers.  If no USING expression was 
             * specified, there is no need for this step. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8674"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN648"><span class='Ref_to_Member'>cooked_default</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN8868"></a>                <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a> <span class='Operator'>*</span><span class='Declare_Local'>attmap</span><span class='Delimiter'>; 
</span><a name="LN8869"></a>                <span class='Keyword'>bool</span>        <span class='Declare_Local'>found_whole_row</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* create a copy to scribble on */ 
</span>                <a href="tablecmds.c.html#LN8671"><span class='Ref_to_Parameter'>cmd</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8671"><span class='Ref_to_Parameter'>cmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="tablecmds.c.html#LN8868"><span class='Ref_To_Local'>attmap</span></a> <span class='Operator'>= </span><a href="../../include/access/tupconvert.h.html#LN40"><span class='Ref_to_Proto'>convert_tuples_by_name_map</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8853"><span class='Ref_To_Local'>childrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                    <a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8669"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"could not convert row type"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Parentheses'>((</span><a href="../../include/nodes/parsenodes.h.html#LN636"><span class='Ref_to_Struct'>ColumnDef</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN8671"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>cooked_default <span class='Operator'>= 
</span>                    <a href="../../include/rewrite/rewriteManip.h.html#LN71"><span class='Ref_to_Proto'>map_variable_attnos</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8674"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN648"><span class='Ref_to_Member'>cooked_default</span></a><span class='Delimiter'>, 
</span>                                        <span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                        <a href="tablecmds.c.html#LN8868"><span class='Ref_To_Local'>attmap</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8669"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>natts<span class='Delimiter'>, 
</span>                                        <span class='Operator'>&</span><a href="tablecmds.c.html#LN8869"><span class='Ref_To_Local'>found_whole_row</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8869"><span class='Ref_To_Local'>found_whole_row</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                          <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot convert whole-row table reference"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"USING expression contains a whole-row table reference."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8868"><span class='Ref_To_Local'>attmap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if def-&GT;cooked_default &raquo; </span> 
            <a href="tablecmds.c.html#LN336"><span class='Ref_to_Proto'>ATPrepCmd</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8668"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8853"><span class='Ref_To_Local'>childrel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8671"><span class='Ref_to_Parameter'>cmd</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8671"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8853"><span class='Ref_To_Local'>childrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if recurse &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN8670"><span class='Ref_to_Parameter'>recursing</span></a> <span class='Operator'>&& 
</span>             <a href="../../include/catalog/pg_inherits_fn.h.html#LN19"><span class='Ref_to_Proto'>find_inheritance_children</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8669"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TABLE_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"type of inherited column \"%s\" must be changed in child tables too"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN8673"><span class='Ref_To_Local'>colName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8669"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN157"><span class='Ref_to_Member'>relkind</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN165"><span class='Ref_to_Const'>RELKIND_COMPOSITE_TYPE</span></a><span class='Parentheses'>) 
</span>        <a href="tablecmds.c.html#LN349"><span class='Ref_to_Proto'>ATTypedTableRecursion</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8668"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8669"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8671"><span class='Ref_to_Parameter'>cmd</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8671"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATPrepAlterColumnType &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * When the data type of a column is changed, a rewrite might not be required 
 * if the new type is sufficiently identical to the old one, and the USING 
 * clause isn't trying to insert some other value.  It's safe to skip the 
 * rewrite if the old type is binary coercible to the new type, or if the 
 * new type is an unconstrained domain over the old type.  In the case of a 
 * constrained domain, we could get by with scanning the table and checking 
 * the constraint rather than actually rewriting it, but we don't currently 
 * try to do that. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN8915"></a><span class='Declare_Function'>ATColumnChangeRequiresRewrite</span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Delimiter'>, </span><a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a> <span class='Declare_Parameter'>varattno</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8915"><span class='Ref_to_Parameter'>expr</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* only one varno, so no need to check that */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8915"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>)</span> <span class='Operator'>&&</span><span class='Parentheses'>((</span><a href="../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN8915"><span class='Ref_to_Parameter'>expr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>varattno <span class='Operator'>== </span><a href="tablecmds.c.html#LN8915"><span class='Ref_to_Parameter'>varattno</span></a><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8915"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN786"><span class='Ref_to_Struct'>RelabelType</span></a><span class='Parentheses'>))</span> 
            <a href="tablecmds.c.html#LN8915"><span class='Ref_to_Parameter'>expr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) ((</span><a href="../../include/nodes/primnodes.h.html#LN786"><span class='Ref_to_Struct'>RelabelType</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN8915"><span class='Ref_to_Parameter'>expr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>arg<span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8915"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN1215"><span class='Ref_to_Struct'>CoerceToDomain</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN8928"></a>            <a href="../../include/nodes/primnodes.h.html#LN1215"><span class='Ref_to_Struct'>CoerceToDomain</span></a> <span class='Operator'>*</span><span class='Declare_Local'>d</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN1215"><span class='Ref_to_Struct'>CoerceToDomain</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN8915"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/typcache.h.html#LN149"><span class='Ref_to_Proto'>DomainHasConstraints</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8928"><span class='Ref_To_Local'>d</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1219"><span class='Ref_to_Member'>resulttype</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN8915"><span class='Ref_to_Parameter'>expr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN8928"><span class='Ref_To_Local'>d</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1218"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end ATColumnChangeRequiresRewrite &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ALTER COLUMN .. SET DATA TYPE 
 * 
 * Return the address of the modified column. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN8945"></a><span class='Declare_Function'>ATExecAlterColumnType</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tab</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN8946"></a>                      <a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cmd</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN8948"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>colName</span> <span class='Operator'>= </span><a href="tablecmds.c.html#LN8946"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1753"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>; 
</span><a name="LN8949"></a>    <a href="../../include/nodes/parsenodes.h.html#LN636"><span class='Ref_to_Struct'>ColumnDef</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>def</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN636"><span class='Ref_to_Struct'>ColumnDef</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN8946"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Delimiter'>; 
</span><a name="LN8950"></a>    <a href="../../include/nodes/parsenodes.h.html#LN205"><span class='Ref_to_Struct'>TypeName</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>typeName</span> <span class='Operator'>= </span><a href="tablecmds.c.html#LN8949"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN640"><span class='Ref_to_Member'>typeName</span></a><span class='Delimiter'>; 
</span><a name="LN8951"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>heapTup</span><span class='Delimiter'>; 
</span><a name="LN8952"></a>    <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>attTup</span><span class='Delimiter'>; 
</span><a name="LN8953"></a>    <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>attnum</span><span class='Delimiter'>; 
</span><a name="LN8954"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>typeTuple</span><span class='Delimiter'>; 
</span><a name="LN8955"></a>    <a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a> <span class='Declare_Local'>tform</span><span class='Delimiter'>; 
</span><a name="LN8956"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>targettype</span><span class='Delimiter'>; 
</span><a name="LN8957"></a>    <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>targettypmod</span><span class='Delimiter'>; 
</span><a name="LN8958"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>targetcollid</span><span class='Delimiter'>; 
</span><a name="LN8959"></a>    <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>defaultexpr</span><span class='Delimiter'>; 
</span><a name="LN8960"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>attrelation</span><span class='Delimiter'>; 
</span><a name="LN8961"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>depRel</span><span class='Delimiter'>; 
</span><a name="LN8962"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>]; 
</span><a name="LN8963"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN8964"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>depTup</span><span class='Delimiter'>; 
</span><a name="LN8965"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN8960"><span class='Ref_To_Local'>attrelation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN32"><span class='Ref_to_Const'>AttributeRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Look up the target column */ 
</span>    <a href="tablecmds.c.html#LN8951"><span class='Ref_To_Local'>heapTup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN130"><span class='Ref_to_Proto'>SearchSysCacheCopyAttName</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8945"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8948"><span class='Ref_To_Local'>colName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8951"><span class='Ref_To_Local'>heapTup</span></a><span class='Parentheses'>))</span>     <span class='Comment_Single_Line'>/* shouldn't happen */ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" of relation \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN8948"><span class='Ref_To_Local'>colName</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8945"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8952"><span class='Ref_To_Local'>attTup</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8951"><span class='Ref_To_Local'>heapTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8953"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN8952"><span class='Ref_To_Local'>attTup</span></a><span class='Operator'>-&GT;</span>attnum<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check for multiple ALTER TYPE on same column --- can't cope */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8952"><span class='Ref_To_Local'>attTup</span></a><span class='Operator'>-&GT;</span>atttypid <span class='Operator'>!= </span><a href="tablecmds.c.html#LN8945"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN158"><span class='Ref_to_Member'>oldDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN8953"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypid <span class='Operator'>|| 
</span>        <a href="tablecmds.c.html#LN8952"><span class='Ref_To_Local'>attTup</span></a><span class='Operator'>-&GT;</span>atttypmod <span class='Operator'>!= </span><a href="tablecmds.c.html#LN8945"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN158"><span class='Ref_to_Member'>oldDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN8953"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypmod<span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot alter type of column \"%s\" twice"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN8948"><span class='Ref_To_Local'>colName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Look up the target type (should not fail, since prep found it) */ 
</span>    <a href="tablecmds.c.html#LN8954"><span class='Ref_To_Local'>typeTuple</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN25"><span class='Ref_to_Proto'>typenameType</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8950"><span class='Ref_To_Local'>typeName</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN8957"><span class='Ref_To_Local'>targettypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8955"><span class='Ref_To_Local'>tform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8954"><span class='Ref_To_Local'>typeTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8956"><span class='Ref_To_Local'>targettype</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8954"><span class='Ref_To_Local'>typeTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* And the collation */ 
</span>    <a href="tablecmds.c.html#LN8958"><span class='Ref_To_Local'>targetcollid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN35"><span class='Ref_to_Proto'>GetColumnDefCollation</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8949"><span class='Ref_To_Local'>def</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8956"><span class='Ref_To_Local'>targettype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If there is a default expression for the column, get it and ensure we 
     * can coerce it to the new datatype.  (We must do this before changing 
     * the column type, because build_column_default itself will try to 
     * coerce, and will not issue the error message we want if it fails.) 
     * 
     * We remove any implicit coercion steps at the top level of the old 
     * default expression; this has been agreed to satisfy the principle of 
     * least surprise.  (The conversion to the new column type should act like 
     * it started from what the user sees as the stored expression, and the 
     * implicit coercions aren't going to be shown.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8952"><span class='Ref_To_Local'>attTup</span></a><span class='Operator'>-&GT;</span>atthasdef<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN8959"><span class='Ref_To_Local'>defaultexpr</span></a> <span class='Operator'>= </span><a href="../../include/rewrite/rewriteHandler.h.html#LN24"><span class='Ref_to_Proto'>build_column_default</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8945"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8953"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8959"><span class='Ref_To_Local'>defaultexpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN8959"><span class='Ref_To_Local'>defaultexpr</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodeFuncs.h.html#LN35"><span class='Ref_to_Proto'>strip_implicit_coercions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8959"><span class='Ref_To_Local'>defaultexpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN8959"><span class='Ref_To_Local'>defaultexpr</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_coerce.h.html#LN37"><span class='Ref_to_Proto'>coerce_to_target_type</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* no UNKNOWN params */ 
</span>                                          <a href="tablecmds.c.html#LN8959"><span class='Ref_To_Local'>defaultexpr</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8959"><span class='Ref_To_Local'>defaultexpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                            <a href="tablecmds.c.html#LN8956"><span class='Ref_To_Local'>targettype</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8957"><span class='Ref_To_Local'>targettypmod</span></a><span class='Delimiter'>, 
</span>                                            <a href="../../include/nodes/primnodes.h.html#LN421"><span class='Ref_to_EnumConst'>COERCION_ASSIGNMENT</span></a><span class='Delimiter'>, 
</span>                                            <a href="../../include/nodes/primnodes.h.html#LN438"><span class='Ref_to_EnumConst'>COERCE_IMPLICIT_CAST</span></a><span class='Delimiter'>, 
</span>                                            <span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8959"><span class='Ref_To_Local'>defaultexpr</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"default for column \"%s\" cannot be cast automatically to type %s"</span><span class='Delimiter'>, 
</span>                            <a href="tablecmds.c.html#LN8948"><span class='Ref_To_Local'>colName</span></a><span class='Delimiter'>, </span><a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8956"><span class='Ref_To_Local'>targettype</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="tablecmds.c.html#LN8959"><span class='Ref_To_Local'>defaultexpr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Find everything that depends on the column (constraints, indexes, etc), 
     * and record enough information to let us recreate the objects. 
     * 
     * The actual recreation does not happen here, but only after we have 
     * performed all the individual ALTER TYPE operations.  We have to save 
     * the info before executing ALTER TYPE, though, else the deparser will 
     * get confused. 
     * 
     * There could be multiple entries for the same object, so we must check 
     * to ensure we process each one only once.  Note: we assume that an index 
     * that implements a constraint will not show a direct dependency on the 
     * column. 
     */ 
</span>    <a href="tablecmds.c.html#LN8961"><span class='Ref_To_Local'>depRel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_depend.h.html#LN28"><span class='Ref_to_Const'>DependRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN8962"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN70"><span class='Ref_to_Const'>Anum_pg_depend_refclassid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN8962"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN71"><span class='Ref_to_Const'>Anum_pg_depend_refobjid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8945"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN8962"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN72"><span class='Ref_to_Const'>Anum_pg_depend_refobjsubid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_INT4EQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>((</span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN8953"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN8963"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8961"><span class='Ref_To_Local'>depRel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN146"><span class='Ref_to_Const'>DependReferenceIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8962"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8964"><span class='Ref_To_Local'>depTup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8963"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN9060"></a>        <a href="../../include/catalog/pg_depend.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_depend</span></a> <span class='Declare_Local'>foundDep</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_depend.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_depend</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8964"><span class='Ref_To_Local'>depTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN9061"></a>        <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>foundObject</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* We don't expect any PIN dependencies on columns */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9060"><span class='Ref_To_Local'>foundDep</span></a><span class='Operator'>-&GT;</span>deptype <span class='Operator'>== </span><a href="../../include/catalog/dependency.h.html#LN79"><span class='Ref_to_EnumConst'>DEPENDENCY_PIN</span></a><span class='Parentheses'>) 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cannot alter type of a pinned column"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN9061"><span class='Ref_To_Local'>foundObject</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN9060"><span class='Ref_To_Local'>foundDep</span></a><span class='Operator'>-&GT;</span>classid<span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN9061"><span class='Ref_To_Local'>foundObject</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN9060"><span class='Ref_To_Local'>foundDep</span></a><span class='Operator'>-&GT;</span>objid<span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN9061"><span class='Ref_To_Local'>foundObject</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN9060"><span class='Ref_To_Local'>foundDep</span></a><span class='Operator'>-&GT;</span>objsubid<span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="../../include/catalog/dependency.h.html#LN198"><span class='Ref_to_Proto'>getObjectClass</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN9061"><span class='Ref_To_Local'>foundObject</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN130"><span class='Ref_to_EnumConst'>OCLASS_CLASS</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN9075"></a>                    <span class='Keyword'>char</span>        <span class='Declare_Local'>relKind</span> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN127"><span class='Ref_to_Proto'>get_rel_relkind</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9061"><span class='Ref_To_Local'>foundObject</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9075"><span class='Ref_To_Local'>relKind</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN160"><span class='Ref_to_Const'>RELKIND_INDEX</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9061"><span class='Ref_To_Local'>foundObject</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/nodes/pg_list.h.html#LN231"><span class='Ref_to_Proto'>list_member_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8945"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN173"><span class='Ref_to_Member'>changedIndexOids</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9061"><span class='Ref_To_Local'>foundObject</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Parentheses'>))</span> 
                        <span class='Delimiter'>{ 
</span>                            <a href="tablecmds.c.html#LN8945"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN173"><span class='Ref_to_Member'>changedIndexOids</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8945"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN173"><span class='Ref_to_Member'>changedIndexOids</span></a><span class='Delimiter'>, 
</span>                                                       <a href="tablecmds.c.html#LN9061"><span class='Ref_To_Local'>foundObject</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <a href="tablecmds.c.html#LN8945"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN174"><span class='Ref_to_Member'>changedIndexDefs</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8945"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN174"><span class='Ref_to_Member'>changedIndexDefs</span></a><span class='Delimiter'>, 
</span>                               <a href="../../include/utils/ruleutils.h.html#LN20"><span class='Ref_to_Proto'>pg_get_indexdef_string</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9061"><span class='Ref_To_Local'>foundObject</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9075"><span class='Ref_To_Local'>relKind</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * This must be a SERIAL column's sequence.  We need 
                         * not do anything to it. 
                         */ 
</span>                        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9061"><span class='Ref_To_Local'>foundObject</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* Not expecting any other direct dependencies... */ 
</span>                        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected object depending on column: %s"</span><span class='Delimiter'>, 
</span>                             <a href="../../include/catalog/objectaddress.h.html#LN70"><span class='Ref_to_Proto'>getObjectDescription</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN9061"><span class='Ref_To_Local'>foundObject</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN135"><span class='Ref_to_EnumConst'>OCLASS_CONSTRAINT</span></a><span class='Operator'>: 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9061"><span class='Ref_To_Local'>foundObject</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/nodes/pg_list.h.html#LN231"><span class='Ref_to_Proto'>list_member_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8945"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN171"><span class='Ref_to_Member'>changedConstraintOids</span></a><span class='Delimiter'>, 
</span>                                     <a href="tablecmds.c.html#LN9061"><span class='Ref_To_Local'>foundObject</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span><a name="LN9110"></a>                    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>defstring</span> <span class='Operator'>= </span><a href="../../include/utils/ruleutils.h.html#LN25"><span class='Ref_to_Proto'>pg_get_constraintdef_command</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9061"><span class='Ref_To_Local'>foundObject</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Put NORMAL dependencies at the front of the list and 
                     * AUTO dependencies at the back.  This makes sure that 
                     * foreign-key constraints depending on this column will 
                     * be dropped before unique or primary-key constraints of 
                     * the column; which we must have because the FK 
                     * constraints depend on the indexes belonging to the 
                     * unique constraints. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9060"><span class='Ref_To_Local'>foundDep</span></a><span class='Operator'>-&GT;</span>deptype <span class='Operator'>== </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="tablecmds.c.html#LN8945"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN171"><span class='Ref_to_Member'>changedConstraintOids</span></a> <span class='Operator'>= 
</span>                            <a href="../../include/nodes/pg_list.h.html#LN217"><span class='Ref_to_Proto'>lcons_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9061"><span class='Ref_To_Local'>foundObject</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Delimiter'>, 
</span>                                      <a href="tablecmds.c.html#LN8945"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN171"><span class='Ref_to_Member'>changedConstraintOids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="tablecmds.c.html#LN8945"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN172"><span class='Ref_to_Member'>changedConstraintDefs</span></a> <span class='Operator'>= 
</span>                            <a href="../../include/nodes/pg_list.h.html#LN215"><span class='Ref_to_Proto'>lcons</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9110"><span class='Ref_To_Local'>defstring</span></a><span class='Delimiter'>, 
</span>                                  <a href="tablecmds.c.html#LN8945"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN172"><span class='Ref_to_Member'>changedConstraintDefs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="tablecmds.c.html#LN8945"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN171"><span class='Ref_to_Member'>changedConstraintOids</span></a> <span class='Operator'>= 
</span>                            <a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8945"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN171"><span class='Ref_to_Member'>changedConstraintOids</span></a><span class='Delimiter'>, 
</span>                                        <a href="tablecmds.c.html#LN9061"><span class='Ref_To_Local'>foundObject</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="tablecmds.c.html#LN8945"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN172"><span class='Ref_to_Member'>changedConstraintDefs</span></a> <span class='Operator'>= 
</span>                            <a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8945"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN172"><span class='Ref_to_Member'>changedConstraintDefs</span></a><span class='Delimiter'>, 
</span>                                    <a href="tablecmds.c.html#LN9110"><span class='Ref_To_Local'>defstring</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !list_member_oid(tab-... &raquo; </span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN146"><span class='Ref_to_EnumConst'>OCLASS_REWRITE</span></a><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* XXX someday see if we can cope with revising views */ 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot alter type of a column used by a view or rule"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"%s depends on column \"%s\""</span><span class='Delimiter'>, 
</span>                                   <a href="../../include/catalog/objectaddress.h.html#LN70"><span class='Ref_to_Proto'>getObjectDescription</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN9061"><span class='Ref_To_Local'>foundObject</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="tablecmds.c.html#LN8948"><span class='Ref_To_Local'>colName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN147"><span class='Ref_to_EnumConst'>OCLASS_TRIGGER</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * A trigger can depend on a column because the column is 
                 * specified as an update target, or because the column is 
                 * used in the trigger's WHEN condition.  The first case would 
                 * not require any extra work, but the second case would 
                 * require updating the WHEN expression, which will take a 
                 * significant amount of new code.  Since we can't easily tell 
                 * which case applies, we punt for both.  FIXME someday. 
                 */ 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot alter type of a column used in a trigger definition"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"%s depends on column \"%s\""</span><span class='Delimiter'>, 
</span>                                   <a href="../../include/catalog/objectaddress.h.html#LN70"><span class='Ref_to_Proto'>getObjectDescription</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN9061"><span class='Ref_To_Local'>foundObject</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="tablecmds.c.html#LN8948"><span class='Ref_To_Local'>colName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN163"><span class='Ref_to_EnumConst'>OCLASS_POLICY</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * A policy can depend on a column because the column is 
                 * specified in the policy's USING or WITH CHECK qual 
                 * expressions.  It might be possible to rewrite and recheck 
                 * the policy expression, but punt for now.  It's certainly 
                 * easy enough to remove and recreate the policy; still, FIXME 
                 * someday. 
                 */ 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot alter type of a column used in a policy definition"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"%s depends on column \"%s\""</span><span class='Delimiter'>, 
</span>                                   <a href="../../include/catalog/objectaddress.h.html#LN70"><span class='Ref_to_Proto'>getObjectDescription</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN9061"><span class='Ref_To_Local'>foundObject</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="tablecmds.c.html#LN8948"><span class='Ref_To_Local'>colName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN137"><span class='Ref_to_EnumConst'>OCLASS_DEFAULT</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Ignore the column's default expression, since we will fix 
                 * it below. 
                 */ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8959"><span class='Ref_To_Local'>defaultexpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN149"><span class='Ref_to_EnumConst'>OCLASS_STATISTIC_EXT</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Give the extended-stats machinery a chance to fix anything 
                 * that this column type change would break. 
                 */ 
</span>                <a href="../../include/commands/defrem.h.html#LN83"><span class='Ref_to_Proto'>UpdateStatisticsForTypeChange</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9061"><span class='Ref_To_Local'>foundObject</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Delimiter'>, 
</span>                                              <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8945"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8953"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>, 
</span>                                              <a href="tablecmds.c.html#LN8952"><span class='Ref_To_Local'>attTup</span></a><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8956"><span class='Ref_To_Local'>targettype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN131"><span class='Ref_to_EnumConst'>OCLASS_PROC</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN132"><span class='Ref_to_EnumConst'>OCLASS_TYPE</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN133"><span class='Ref_to_EnumConst'>OCLASS_CAST</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN134"><span class='Ref_to_EnumConst'>OCLASS_COLLATION</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN136"><span class='Ref_to_EnumConst'>OCLASS_CONVERSION</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN138"><span class='Ref_to_EnumConst'>OCLASS_LANGUAGE</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN139"><span class='Ref_to_EnumConst'>OCLASS_LARGEOBJECT</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN140"><span class='Ref_to_EnumConst'>OCLASS_OPERATOR</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN141"><span class='Ref_to_EnumConst'>OCLASS_OPCLASS</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN142"><span class='Ref_to_EnumConst'>OCLASS_OPFAMILY</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN143"><span class='Ref_to_EnumConst'>OCLASS_AM</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN144"><span class='Ref_to_EnumConst'>OCLASS_AMOP</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN145"><span class='Ref_to_EnumConst'>OCLASS_AMPROC</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN148"><span class='Ref_to_EnumConst'>OCLASS_SCHEMA</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN150"><span class='Ref_to_EnumConst'>OCLASS_TSPARSER</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN151"><span class='Ref_to_EnumConst'>OCLASS_TSDICT</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN152"><span class='Ref_to_EnumConst'>OCLASS_TSTEMPLATE</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN153"><span class='Ref_to_EnumConst'>OCLASS_TSCONFIG</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN154"><span class='Ref_to_EnumConst'>OCLASS_ROLE</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN155"><span class='Ref_to_EnumConst'>OCLASS_DATABASE</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN156"><span class='Ref_to_EnumConst'>OCLASS_TBLSPACE</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN157"><span class='Ref_to_EnumConst'>OCLASS_FDW</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN158"><span class='Ref_to_EnumConst'>OCLASS_FOREIGN_SERVER</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN159"><span class='Ref_to_EnumConst'>OCLASS_USER_MAPPING</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN160"><span class='Ref_to_EnumConst'>OCLASS_DEFACL</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN161"><span class='Ref_to_EnumConst'>OCLASS_EXTENSION</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN162"><span class='Ref_to_EnumConst'>OCLASS_EVENT_TRIGGER</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN164"><span class='Ref_to_EnumConst'>OCLASS_PUBLICATION</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN165"><span class='Ref_to_EnumConst'>OCLASS_PUBLICATION_REL</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN166"><span class='Ref_to_EnumConst'>OCLASS_SUBSCRIPTION</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN167"><span class='Ref_to_EnumConst'>OCLASS_TRANSFORM</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * We don't expect any of these sorts of objects to depend on 
                 * a column. 
                 */ 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected object depending on column: %s"</span><span class='Delimiter'>, 
</span>                     <a href="../../include/catalog/objectaddress.h.html#LN70"><span class='Ref_to_Proto'>getObjectDescription</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN9061"><span class='Ref_To_Local'>foundObject</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * There's intentionally no default: case here; we want the 
                 * compiler to warn if a new OCLASS hasn't been handled above. 
                 */ 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch getObjectClass(&found... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while HeapTupleIsValid(depT... &raquo; </span> 
 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8963"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now scan for dependencies of this column on other things.  The only 
     * thing we should find is the dependency on the column datatype, which we 
     * want to remove, and possibly a collation dependency. 
     */ 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN8962"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN67"><span class='Ref_to_Const'>Anum_pg_depend_classid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN8962"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN68"><span class='Ref_to_Const'>Anum_pg_depend_objid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8945"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN8962"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN69"><span class='Ref_to_Const'>Anum_pg_depend_objsubid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_INT4EQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>((</span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN8953"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN8963"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8961"><span class='Ref_To_Local'>depRel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN144"><span class='Ref_to_Const'>DependDependerIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8962"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8964"><span class='Ref_To_Local'>depTup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8963"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN9281"></a>        <a href="../../include/catalog/pg_depend.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_depend</span></a> <span class='Declare_Local'>foundDep</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_depend.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_depend</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8964"><span class='Ref_To_Local'>depTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9281"><span class='Ref_To_Local'>foundDep</span></a><span class='Operator'>-&GT;</span>deptype <span class='Operator'>!= </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>) 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"found unexpected dependency type '%c'"</span><span class='Delimiter'>, 
</span>                 <a href="tablecmds.c.html#LN9281"><span class='Ref_To_Local'>foundDep</span></a><span class='Operator'>-&GT;</span>deptype<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9281"><span class='Ref_To_Local'>foundDep</span></a><span class='Operator'>-&GT;</span>refclassid <span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a> <span class='Operator'>&& 
</span>              <a href="tablecmds.c.html#LN9281"><span class='Ref_To_Local'>foundDep</span></a><span class='Operator'>-&GT;</span>refobjid <span class='Operator'>== </span><a href="tablecmds.c.html#LN8952"><span class='Ref_To_Local'>attTup</span></a><span class='Operator'>-&GT;</span>atttypid<span class='Parentheses'>) </span><span class='Operator'>&& 
</span>            <span class='Operator'>!</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9281"><span class='Ref_To_Local'>foundDep</span></a><span class='Operator'>-&GT;</span>refclassid <span class='Operator'>== </span><a href="../../include/catalog/pg_collation.h.html#LN29"><span class='Ref_to_Const'>CollationRelationId</span></a> <span class='Operator'>&& 
</span>              <a href="tablecmds.c.html#LN9281"><span class='Ref_To_Local'>foundDep</span></a><span class='Operator'>-&GT;</span>refobjid <span class='Operator'>== </span><a href="tablecmds.c.html#LN8952"><span class='Ref_To_Local'>attTup</span></a><span class='Operator'>-&GT;</span>attcollation<span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"found unexpected dependency for column"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/indexing.h.html#LN40"><span class='Ref_to_Proto'>CatalogTupleDelete</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8961"><span class='Ref_To_Local'>depRel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN8964"><span class='Ref_To_Local'>depTup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8963"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8961"><span class='Ref_To_Local'>depRel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Here we go --- change the recorded column type and collation.  (Note 
     * heapTup is a copy of the syscache entry, so okay to scribble on.) 
     */ 
</span>    <a href="tablecmds.c.html#LN8952"><span class='Ref_To_Local'>attTup</span></a><span class='Operator'>-&GT;</span>atttypid <span class='Operator'>= </span><a href="tablecmds.c.html#LN8956"><span class='Ref_To_Local'>targettype</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8952"><span class='Ref_To_Local'>attTup</span></a><span class='Operator'>-&GT;</span>atttypmod <span class='Operator'>= </span><a href="tablecmds.c.html#LN8957"><span class='Ref_To_Local'>targettypmod</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8952"><span class='Ref_To_Local'>attTup</span></a><span class='Operator'>-&GT;</span>attcollation <span class='Operator'>= </span><a href="tablecmds.c.html#LN8958"><span class='Ref_To_Local'>targetcollid</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8952"><span class='Ref_To_Local'>attTup</span></a><span class='Operator'>-&GT;</span>attndims <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8950"><span class='Ref_To_Local'>typeName</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN214"><span class='Ref_to_Member'>arrayBounds</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8952"><span class='Ref_To_Local'>attTup</span></a><span class='Operator'>-&GT;</span>attlen <span class='Operator'>= </span><a href="tablecmds.c.html#LN8955"><span class='Ref_To_Local'>tform</span></a><span class='Operator'>-&GT;</span>typlen<span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8952"><span class='Ref_To_Local'>attTup</span></a><span class='Operator'>-&GT;</span>attbyval <span class='Operator'>= </span><a href="tablecmds.c.html#LN8955"><span class='Ref_To_Local'>tform</span></a><span class='Operator'>-&GT;</span>typbyval<span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8952"><span class='Ref_To_Local'>attTup</span></a><span class='Operator'>-&GT;</span>attalign <span class='Operator'>= </span><a href="tablecmds.c.html#LN8955"><span class='Ref_To_Local'>tform</span></a><span class='Operator'>-&GT;</span>typalign<span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN8952"><span class='Ref_To_Local'>attTup</span></a><span class='Operator'>-&GT;</span>attstorage <span class='Operator'>= </span><a href="tablecmds.c.html#LN8955"><span class='Ref_To_Local'>tform</span></a><span class='Operator'>-&GT;</span>typstorage<span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8954"><span class='Ref_To_Local'>typeTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8960"><span class='Ref_To_Local'>attrelation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN8951"><span class='Ref_To_Local'>heapTup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8951"><span class='Ref_To_Local'>heapTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8960"><span class='Ref_To_Local'>attrelation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Install dependencies on new datatype and collation */ 
</span>    <a href="tablecmds.c.html#LN361"><span class='Ref_to_Proto'>add_column_datatype_dependency</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8945"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8953"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8956"><span class='Ref_To_Local'>targettype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN362"><span class='Ref_to_Proto'>add_column_collation_dependency</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8945"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8953"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8958"><span class='Ref_To_Local'>targetcollid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Drop any pg_statistic entry for the column, since it's now wrong type 
     */ 
</span>    <a href="../../include/catalog/heap.h.html#LN120"><span class='Ref_to_Proto'>RemoveStatistics</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8945"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8953"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8945"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8953"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Update the default, if present, by brute force --- remove and re-add 
     * the default.  Probably unsafe to take shortcuts, since the new version 
     * may well have additional dependencies.  (It's okay to do this now, 
     * rather than after other ALTER TYPE commands, since the default won't 
     * depend on other column types.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8959"><span class='Ref_To_Local'>defaultexpr</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Must make new row visible since it will be updated again */ 
</span>        <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We use RESTRICT here for safety, but at present we do not expect 
         * anything to depend on the default. 
         */ 
</span>        <a href="../../include/catalog/heap.h.html#LN117"><span class='Ref_to_Proto'>RemoveAttrDefault</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8945"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8953"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1654"><span class='Ref_to_EnumConst'>DROP_RESTRICT</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                          <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/heap.h.html#LN104"><span class='Ref_to_Proto'>StoreAttrDefault</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8945"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8953"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8959"><span class='Ref_To_Local'>defaultexpr</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN32"><span class='Ref_to_Macro'>ObjectAddressSubSet</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8965"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8945"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN8953"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Cleanup */ 
</span>    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN8951"><span class='Ref_To_Local'>heapTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN8965"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATExecAlterColumnType &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Returns the address of the modified column 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN9365"></a><span class='Declare_Function'>ATExecAlterColumnGenericOptions</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN9366"></a>                                <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colName</span><span class='Delimiter'>, 
</span><a name="LN9367"></a>                                <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>options</span><span class='Delimiter'>, 
</span><a name="LN9368"></a>                                <a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN9370"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>ftrel</span><span class='Delimiter'>; 
</span><a name="LN9371"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>attrel</span><span class='Delimiter'>; 
</span><a name="LN9372"></a>    <a href="../../include/foreign/foreign.h.html#LN44"><span class='Ref_to_Struct'>ForeignServer</span></a> <span class='Operator'>*</span><span class='Declare_Local'>server</span><span class='Delimiter'>; 
</span><a name="LN9373"></a>    <a href="../../include/foreign/foreign.h.html#LN34"><span class='Ref_to_Struct'>ForeignDataWrapper</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fdw</span><span class='Delimiter'>; 
</span><a name="LN9374"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN9375"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newtuple</span><span class='Delimiter'>; 
</span><a name="LN9376"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN9377"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>repl_val</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_attribute.h.html#LN193"><span class='Ref_to_Const'>Natts_pg_attribute</span></a><span class='Delimiter'>]; 
</span><a name="LN9378"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>repl_null</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_attribute.h.html#LN193"><span class='Ref_to_Const'>Natts_pg_attribute</span></a><span class='Delimiter'>]; 
</span><a name="LN9379"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>repl_repl</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_attribute.h.html#LN193"><span class='Ref_to_Const'>Natts_pg_attribute</span></a><span class='Delimiter'>]; 
</span><a name="LN9380"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>datum</span><span class='Delimiter'>; 
</span><a name="LN9381"></a>    <a href="../../include/catalog/pg_foreign_table.h.html#LN43"><span class='Ref_to_Typedef'>Form_pg_foreign_table</span></a> <span class='Declare_Local'>fttableform</span><span class='Delimiter'>; 
</span><a name="LN9382"></a>    <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>atttableform</span><span class='Delimiter'>; 
</span><a name="LN9383"></a>    <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>attnum</span><span class='Delimiter'>; 
</span><a name="LN9384"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9367"><span class='Ref_to_Parameter'>options</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../catalog/objectaddress.c.html#LN718"><span class='Ref_to_Global_Var'>InvalidObjectAddress</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* First, determine FDW validator associated to the foreign table. */ 
</span>    <a href="tablecmds.c.html#LN9370"><span class='Ref_To_Local'>ftrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_table.h.html#LN26"><span class='Ref_to_Const'>ForeignTableRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN9374"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN64"><span class='Ref_to_EnumConst'>FOREIGNTABLEREL</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9365"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN115"><span class='Ref_to_Member'>rd_id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9374"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"foreign table \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9365"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN9381"><span class='Ref_To_Local'>fttableform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_table.h.html#LN43"><span class='Ref_to_Typedef'>Form_pg_foreign_table</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9374"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN9372"><span class='Ref_To_Local'>server</span></a> <span class='Operator'>= </span><a href="../../include/foreign/foreign.h.html#LN71"><span class='Ref_to_Proto'>GetForeignServer</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9381"><span class='Ref_To_Local'>fttableform</span></a><span class='Operator'>-&GT;</span>ftserver<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN9373"><span class='Ref_To_Local'>fdw</span></a> <span class='Operator'>= </span><a href="../foreign/foreign.c.html#LN33"><span class='Ref_to_Func'>GetForeignDataWrapper</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9372"><span class='Ref_To_Local'>server</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN47"><span class='Ref_to_Member'>fdwid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9370"><span class='Ref_To_Local'>ftrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9374"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN9371"><span class='Ref_To_Local'>attrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN32"><span class='Ref_to_Const'>AttributeRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN9374"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN129"><span class='Ref_to_Proto'>SearchSysCacheAttName</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9365"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9366"><span class='Ref_to_Parameter'>colName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9374"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" of relation \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN9366"><span class='Ref_to_Parameter'>colName</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9365"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Prevent them from altering a system attribute */ 
</span>    <a href="tablecmds.c.html#LN9382"><span class='Ref_To_Local'>atttableform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9374"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN9383"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN9382"><span class='Ref_To_Local'>atttableform</span></a><span class='Operator'>-&GT;</span>attnum<span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9383"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot alter system column \"%s\""</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9366"><span class='Ref_to_Parameter'>colName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
 
    <span class='Comment_Multi_Line'>/* Initialize buffers for new tuple values */ 
</span>    memset<span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9377"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9377"><span class='Ref_To_Local'>repl_val</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9378"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9378"><span class='Ref_To_Local'>repl_null</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9379"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9379"><span class='Ref_To_Local'>repl_repl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Extract the current options */ 
</span>    <a href="tablecmds.c.html#LN9380"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN39"><span class='Ref_to_EnumConst'>ATTNAME</span></a><span class='Delimiter'>, 
</span>                            <a href="tablecmds.c.html#LN9374"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, 
</span>                            <a href="../../include/catalog/pg_attribute.h.html#LN215"><span class='Ref_to_Const'>Anum_pg_attribute_attfdwoptions</span></a><span class='Delimiter'>, 
</span>                            <span class='Operator'>&</span><a href="tablecmds.c.html#LN9376"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9376"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>        <a href="tablecmds.c.html#LN9380"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Transform the options */ 
</span>    <a href="tablecmds.c.html#LN9380"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="foreigncmds.c.html#LN107"><span class='Ref_to_Func'>transformGenericOptions</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN32"><span class='Ref_to_Const'>AttributeRelationId</span></a><span class='Delimiter'>, 
</span>                                    <a href="tablecmds.c.html#LN9380"><span class='Ref_To_Local'>datum</span></a><span class='Delimiter'>, 
</span>                                    <a href="tablecmds.c.html#LN9367"><span class='Ref_to_Parameter'>options</span></a><span class='Delimiter'>, 
</span>                                    <a href="tablecmds.c.html#LN9373"><span class='Ref_To_Local'>fdw</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN40"><span class='Ref_to_Member'>fdwvalidator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN525"><span class='Ref_to_Macro'>PointerIsValid</span></a><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9380"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>)))</span> 
        <a href="tablecmds.c.html#LN9377"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_attribute.h.html#LN215"><span class='Ref_to_Const'>Anum_pg_attribute_attfdwoptions</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="tablecmds.c.html#LN9380"><span class='Ref_To_Local'>datum</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="tablecmds.c.html#LN9378"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_attribute.h.html#LN215"><span class='Ref_to_Const'>Anum_pg_attribute_attfdwoptions</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN9379"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_attribute.h.html#LN215"><span class='Ref_to_Const'>Anum_pg_attribute_attfdwoptions</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Everything looks good - update the tuple */ 
</span> 
    <a href="tablecmds.c.html#LN9375"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9374"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9371"><span class='Ref_To_Local'>attrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="tablecmds.c.html#LN9377"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9378"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9379"><span class='Ref_To_Local'>repl_repl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9371"><span class='Ref_To_Local'>attrel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN9375"><span class='Ref_To_Local'>newtuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9375"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9365"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="tablecmds.c.html#LN9382"><span class='Ref_To_Local'>atttableform</span></a><span class='Operator'>-&GT;</span>attnum<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/catalog/objectaddress.h.html#LN32"><span class='Ref_to_Macro'>ObjectAddressSubSet</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9384"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9365"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9383"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9374"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9371"><span class='Ref_To_Local'>attrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9375"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN9384"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATExecAlterColumnGenericOptions &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Cleanup after we've finished all the ALTER TYPE operations for a 
 * particular relation.  We have to drop and recreate all the indexes 
 * and constraints that depend on the altered columns. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN9475"></a><span class='Declare_Function'>ATPostAlterTypeCleanup</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>wqueue</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tab</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN9477"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>obj</span><span class='Delimiter'>; 
</span><a name="LN9478"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>def_item</span><span class='Delimiter'>; 
</span><a name="LN9479"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>oid_item</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Re-parse the index and constraint definitions, and attach them to the 
     * appropriate work queue entries.  We do this before dropping because in 
     * the case of a FOREIGN KEY constraint, we might not yet have exclusive 
     * lock on the table the constraint is attached to, and we need to get 
     * that before dropping.  It's safe because the parser won't actually look 
     * at the catalogs to detect the existing entry. 
     * 
     * We can't rely on the output of deparsing to tell us which relation to 
     * operate on, because concurrent activity might have made the name 
     * resolve differently.  Instead, we've got to use the OID of the 
     * constraint or index we're processing to figure out which relation to 
     * operate on. 
     */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN179"><span class='Ref_to_Macro'>forboth</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9479"><span class='Ref_To_Local'>oid_item</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9475"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN171"><span class='Ref_to_Member'>changedConstraintOids</span></a><span class='Delimiter'>, 
</span>            <a href="tablecmds.c.html#LN9478"><span class='Ref_To_Local'>def_item</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9475"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN172"><span class='Ref_to_Member'>changedConstraintDefs</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN9498"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>oldId</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9479"><span class='Ref_To_Local'>oid_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN9499"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN9500"></a>        <a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a> <span class='Declare_Local'>con</span><span class='Delimiter'>; 
</span><a name="LN9501"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span><span class='Delimiter'>; 
</span><a name="LN9502"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>confrelid</span><span class='Delimiter'>; 
</span><a name="LN9503"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>conislocal</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN9499"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN52"><span class='Ref_to_EnumConst'>CONSTROID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9498"><span class='Ref_To_Local'>oldId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9499"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span>     <span class='Comment_Single_Line'>/* should not happen */ 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for constraint %u"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9498"><span class='Ref_To_Local'>oldId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN9500"><span class='Ref_To_Local'>con</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9499"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN9501"><span class='Ref_To_Local'>relid</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN9500"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>conrelid<span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN9502"><span class='Ref_To_Local'>confrelid</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN9500"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>confrelid<span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN9503"><span class='Ref_To_Local'>conislocal</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN9500"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>conislocal<span class='Delimiter'>; 
</span>        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9499"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If the constraint is inherited (only), we don't want to inject a 
         * new definition here; it'll get recreated when ATAddCheckConstraint 
         * recurses from adding the parent table's constraint.  But we had to 
         * carry the info this far so that we can drop the constraint below. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN9503"><span class='Ref_To_Local'>conislocal</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN421"><span class='Ref_to_Proto'>ATPostAlterTypeParse</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9498"><span class='Ref_To_Local'>oldId</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9501"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9502"><span class='Ref_To_Local'>confrelid</span></a><span class='Delimiter'>, 
</span>                             <span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9478"><span class='Ref_To_Local'>def_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="tablecmds.c.html#LN9475"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9475"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9475"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN165"><span class='Ref_to_Member'>rewrite</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/nodes/pg_list.h.html#LN179"><span class='Ref_to_Macro'>forboth</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9479"><span class='Ref_To_Local'>oid_item</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9475"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN173"><span class='Ref_to_Member'>changedIndexOids</span></a><span class='Delimiter'>, 
</span>            <a href="tablecmds.c.html#LN9478"><span class='Ref_To_Local'>def_item</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9475"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN174"><span class='Ref_to_Member'>changedIndexDefs</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN9530"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>oldId</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9479"><span class='Ref_To_Local'>oid_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN9531"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN9531"><span class='Ref_To_Local'>relid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/index.h.html#LN131"><span class='Ref_to_Proto'>IndexGetRelation</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9530"><span class='Ref_To_Local'>oldId</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN421"><span class='Ref_to_Proto'>ATPostAlterTypeParse</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9530"><span class='Ref_To_Local'>oldId</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9531"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                             <span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9478"><span class='Ref_To_Local'>def_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="tablecmds.c.html#LN9475"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9475"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9475"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN165"><span class='Ref_to_Member'>rewrite</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now we can drop the existing constraints and indexes --- constraints 
     * first, since some of them might depend on the indexes.  In fact, we 
     * have to delete FOREIGN KEY constraints before UNIQUE constraints, but 
     * we already ordered the constraint list to ensure that would happen. It 
     * should be okay to use DROP_RESTRICT here, since nothing else should be 
     * depending on these objects. 
     */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9479"><span class='Ref_To_Local'>oid_item</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9475"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN171"><span class='Ref_to_Member'>changedConstraintOids</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN9477"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_constraint.h.html#LN28"><span class='Ref_to_Const'>ConstraintRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN9477"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9479"><span class='Ref_To_Local'>oid_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN9477"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="../../include/catalog/dependency.h.html#LN182"><span class='Ref_to_Proto'>performDeletion</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN9477"><span class='Ref_To_Local'>obj</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1654"><span class='Ref_to_EnumConst'>DROP_RESTRICT</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN173"><span class='Ref_to_Const'>PERFORM_DELETION_INTERNAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9479"><span class='Ref_To_Local'>oid_item</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9475"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN173"><span class='Ref_to_Member'>changedIndexOids</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN9477"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN9477"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9479"><span class='Ref_To_Local'>oid_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN9477"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="../../include/catalog/dependency.h.html#LN182"><span class='Ref_to_Proto'>performDeletion</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN9477"><span class='Ref_To_Local'>obj</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1654"><span class='Ref_to_EnumConst'>DROP_RESTRICT</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN173"><span class='Ref_to_Const'>PERFORM_DELETION_INTERNAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The objects will get recreated during subsequent passes over the work 
     * queue. 
     */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end ATPostAlterTypeCleanup &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN9570"></a><span class='Declare_Function'>ATPostAlterTypeParse</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oldId</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oldRelId</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>refRelId</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>cmd</span><span class='Delimiter'>, 
</span><a name="LN9571"></a>                     <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>wqueue</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>rewrite</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN9573"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>raw_parsetree_list</span><span class='Delimiter'>; 
</span><a name="LN9574"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>querytree_list</span><span class='Delimiter'>; 
</span><a name="LN9575"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>list_item</span><span class='Delimiter'>; 
</span><a name="LN9576"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We expect that we will get only ALTER TABLE and CREATE INDEX 
     * statements. Hence, there is no need to pass them through 
     * parse_analyze() or the rewriter, but instead we need to pass them 
     * through parse_utilcmd.c to make them ready for execution. 
     */ 
</span>    <a href="tablecmds.c.html#LN9573"><span class='Ref_To_Local'>raw_parsetree_list</span></a> <span class='Operator'>= </span><a href="../parser/parser.c.html#LN34"><span class='Ref_to_Func'>raw_parser</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9570"><span class='Ref_to_Parameter'>cmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN9574"><span class='Ref_To_Local'>querytree_list</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9575"><span class='Ref_To_Local'>list_item</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9573"><span class='Ref_To_Local'>raw_parsetree_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN9588"></a>        <a href="../../include/nodes/parsenodes.h.html#LN1396"><span class='Ref_to_Struct'>RawStmt</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>rs</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1396"><span class='Ref_to_Struct'>RawStmt</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9575"><span class='Ref_To_Local'>list_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN9589"></a>        <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>stmt</span> <span class='Operator'>= </span><a href="tablecmds.c.html#LN9588"><span class='Ref_To_Local'>rs</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1399"><span class='Ref_to_Member'>stmt</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9589"><span class='Ref_To_Local'>stmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2667"><span class='Ref_to_Struct'>IndexStmt</span></a><span class='Parentheses'>))</span> 
            <a href="tablecmds.c.html#LN9574"><span class='Ref_To_Local'>querytree_list</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9574"><span class='Ref_To_Local'>querytree_list</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../include/parser/parse_utilcmd.h.html#LN22"><span class='Ref_to_Proto'>transformIndexStmt</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9570"><span class='Ref_to_Parameter'>oldRelId</span></a><span class='Delimiter'>, 
</span>                                                        <span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2667"><span class='Ref_to_Struct'>IndexStmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN9589"><span class='Ref_To_Local'>stmt</span></a><span class='Delimiter'>, 
</span>                                                        <a href="tablecmds.c.html#LN9570"><span class='Ref_to_Parameter'>cmd</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9589"><span class='Ref_To_Local'>stmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1662"><span class='Ref_to_Struct'>AlterTableStmt</span></a><span class='Parentheses'>))</span> 
            <a href="tablecmds.c.html#LN9574"><span class='Ref_To_Local'>querytree_list</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9574"><span class='Ref_To_Local'>querytree_list</span></a><span class='Delimiter'>, 
</span>                                         <a href="../../include/parser/parse_utilcmd.h.html#LN20"><span class='Ref_to_Proto'>transformAlterTableStmt</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9570"><span class='Ref_to_Parameter'>oldRelId</span></a><span class='Delimiter'>, 
</span>                                                     <span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1662"><span class='Ref_to_Struct'>AlterTableStmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN9589"><span class='Ref_To_Local'>stmt</span></a><span class='Delimiter'>, 
</span>                                                                 <a href="tablecmds.c.html#LN9570"><span class='Ref_to_Parameter'>cmd</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="tablecmds.c.html#LN9574"><span class='Ref_To_Local'>querytree_list</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9574"><span class='Ref_To_Local'>querytree_list</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9589"><span class='Ref_To_Local'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Caller should already have acquired whatever lock we need. */ 
</span>    <a href="tablecmds.c.html#LN9576"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN84"><span class='Ref_to_Proto'>relation_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9570"><span class='Ref_to_Parameter'>oldRelId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Attach each generated command to the proper place in the work queue. 
     * Note this could result in creation of entirely new work-queue entries. 
     * 
     * Also note that we have to tweak the command subtypes, because it turns 
     * out that re-creation of indexes and constraints has to act a bit 
     * differently from initial creation. 
     */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9575"><span class='Ref_To_Local'>list_item</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9574"><span class='Ref_To_Local'>querytree_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN9618"></a>        <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>stm</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9575"><span class='Ref_To_Local'>list_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN9619"></a>        <a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tab</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN9619"><span class='Ref_To_Local'>tab</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN344"><span class='Ref_to_Proto'>ATGetQueueEntry</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9571"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9576"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9618"><span class='Ref_To_Local'>stm</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2667"><span class='Ref_to_Struct'>IndexStmt</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN9625"></a>            <a href="../../include/nodes/parsenodes.h.html#LN2667"><span class='Ref_to_Struct'>IndexStmt</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>stmt</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2667"><span class='Ref_to_Struct'>IndexStmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN9618"><span class='Ref_To_Local'>stm</span></a><span class='Delimiter'>; 
</span><a name="LN9626"></a>            <a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a> <span class='Operator'>*</span><span class='Declare_Local'>newcmd</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN9571"><span class='Ref_to_Parameter'>rewrite</span></a><span class='Parentheses'>) 
</span>                <a href="tablecmds.c.html#LN426"><span class='Ref_to_Proto'>TryReuseIndex</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9570"><span class='Ref_to_Parameter'>oldId</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9625"><span class='Ref_To_Local'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* keep the index's comment */ 
</span>            <a href="tablecmds.c.html#LN9625"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2678"><span class='Ref_to_Member'>idxcomment</span></a> <span class='Operator'>= </span><a href="../../include/commands/comment.h.html#LN42"><span class='Ref_to_Proto'>GetComment</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9570"><span class='Ref_to_Parameter'>oldId</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="tablecmds.c.html#LN9626"><span class='Ref_To_Local'>newcmd</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN9626"><span class='Ref_To_Local'>newcmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1752"><span class='Ref_to_Member'>subtype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN1686"><span class='Ref_to_EnumConst'>AT_ReAddIndex</span></a><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN9626"><span class='Ref_To_Local'>newcmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN9625"><span class='Ref_To_Local'>stmt</span></a><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN9619"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN160"><span class='Ref_to_Member'>subcmds</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN143"><span class='Ref_to_Const'>AT_PASS_OLD_INDEX</span></a><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                <a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9619"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN160"><span class='Ref_to_Member'>subcmds</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN143"><span class='Ref_to_Const'>AT_PASS_OLD_INDEX</span></a><span class='Delimiter'>], </span><a href="tablecmds.c.html#LN9626"><span class='Ref_To_Local'>newcmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9618"><span class='Ref_To_Local'>stm</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1662"><span class='Ref_to_Struct'>AlterTableStmt</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN9641"></a>            <a href="../../include/nodes/parsenodes.h.html#LN1662"><span class='Ref_to_Struct'>AlterTableStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>stmt</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1662"><span class='Ref_to_Struct'>AlterTableStmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN9618"><span class='Ref_To_Local'>stm</span></a><span class='Delimiter'>; 
</span><a name="LN9642"></a>            <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lcmd</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9642"><span class='Ref_To_Local'>lcmd</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9641"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1666"><span class='Ref_to_Member'>cmds</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN9646"></a>                <a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cmd</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9642"><span class='Ref_To_Local'>lcmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9646"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1752"><span class='Ref_to_Member'>subtype</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN1685"><span class='Ref_to_EnumConst'>AT_AddIndex</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN9650"></a>                    <a href="../../include/nodes/parsenodes.h.html#LN2667"><span class='Ref_to_Struct'>IndexStmt</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>indstmt</span><span class='Delimiter'>; 
</span><a name="LN9651"></a>                    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>indoid</span><span class='Delimiter'>; 
</span> 
                    <a href="tablecmds.c.html#LN9650"><span class='Ref_To_Local'>indstmt</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2667"><span class='Ref_to_Struct'>IndexStmt</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9646"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="tablecmds.c.html#LN9651"><span class='Ref_To_Local'>indoid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/dependency.h.html#LN244"><span class='Ref_to_Proto'>get_constraint_index</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9570"><span class='Ref_to_Parameter'>oldId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN9571"><span class='Ref_to_Parameter'>rewrite</span></a><span class='Parentheses'>) 
</span>                        <a href="tablecmds.c.html#LN426"><span class='Ref_to_Proto'>TryReuseIndex</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9651"><span class='Ref_To_Local'>indoid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9650"><span class='Ref_To_Local'>indstmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* keep any comment on the index */ 
</span>                    <a href="tablecmds.c.html#LN9650"><span class='Ref_To_Local'>indstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2678"><span class='Ref_to_Member'>idxcomment</span></a> <span class='Operator'>= </span><a href="../../include/commands/comment.h.html#LN42"><span class='Ref_to_Proto'>GetComment</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9651"><span class='Ref_To_Local'>indoid</span></a><span class='Delimiter'>, 
</span>                                                     <a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="tablecmds.c.html#LN9646"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1752"><span class='Ref_to_Member'>subtype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN1686"><span class='Ref_to_EnumConst'>AT_ReAddIndex</span></a><span class='Delimiter'>; 
</span>                    <a href="tablecmds.c.html#LN9619"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN160"><span class='Ref_to_Member'>subcmds</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN143"><span class='Ref_to_Const'>AT_PASS_OLD_INDEX</span></a><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                        <a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9619"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN160"><span class='Ref_to_Member'>subcmds</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN143"><span class='Ref_to_Const'>AT_PASS_OLD_INDEX</span></a><span class='Delimiter'>], </span><a href="tablecmds.c.html#LN9646"><span class='Ref_To_Local'>cmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* recreate any comment on the constraint */ 
</span>                    <a href="tablecmds.c.html#LN424"><span class='Ref_to_Proto'>RebuildConstraintComment</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9619"><span class='Ref_To_Local'>tab</span></a><span class='Delimiter'>, 
</span>                                             <a href="tablecmds.c.html#LN143"><span class='Ref_to_Const'>AT_PASS_OLD_INDEX</span></a><span class='Delimiter'>, 
</span>                                             <a href="tablecmds.c.html#LN9570"><span class='Ref_to_Parameter'>oldId</span></a><span class='Delimiter'>, 
</span>                                             <a href="tablecmds.c.html#LN9576"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9650"><span class='Ref_To_Local'>indstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2670"><span class='Ref_to_Member'>idxname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if cmd-&GT;subtype==AT_AddI... &raquo; </span> 
                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9646"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1752"><span class='Ref_to_Member'>subtype</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN1687"><span class='Ref_to_EnumConst'>AT_AddConstraint</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN9674"></a>                    <a href="../../include/nodes/parsenodes.h.html#LN2050"><span class='Ref_to_Struct'>Constraint</span></a> <span class='Operator'>*</span><span class='Declare_Local'>con</span><span class='Delimiter'>; 
</span> 
                    <a href="tablecmds.c.html#LN9674"><span class='Ref_To_Local'>con</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2050"><span class='Ref_to_Struct'>Constraint</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9646"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="tablecmds.c.html#LN9674"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2089"><span class='Ref_to_Member'>old_pktable_oid</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN9570"><span class='Ref_to_Parameter'>refRelId</span></a><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* rewriting neither side of a FK */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9674"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2053"><span class='Ref_to_Member'>contype</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN2031"><span class='Ref_to_EnumConst'>CONSTR_FOREIGN</span></a> <span class='Operator'>&& 
</span>                        <span class='Operator'>!</span><a href="tablecmds.c.html#LN9571"><span class='Ref_to_Parameter'>rewrite</span></a> <span class='Operator'>&& </span><a href="tablecmds.c.html#LN9619"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN165"><span class='Ref_to_Member'>rewrite</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                        <a href="tablecmds.c.html#LN427"><span class='Ref_to_Proto'>TryReuseForeignKey</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9570"><span class='Ref_to_Parameter'>oldId</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9674"><span class='Ref_To_Local'>con</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="tablecmds.c.html#LN9646"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1752"><span class='Ref_to_Member'>subtype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN1689"><span class='Ref_to_EnumConst'>AT_ReAddConstraint</span></a><span class='Delimiter'>; 
</span>                    <a href="tablecmds.c.html#LN9619"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN160"><span class='Ref_to_Member'>subcmds</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN144"><span class='Ref_to_Const'>AT_PASS_OLD_CONSTR</span></a><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                        <a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9619"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN160"><span class='Ref_to_Member'>subcmds</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN144"><span class='Ref_to_Const'>AT_PASS_OLD_CONSTR</span></a><span class='Delimiter'>], </span><a href="tablecmds.c.html#LN9646"><span class='Ref_To_Local'>cmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* recreate any comment on the constraint */ 
</span>                    <a href="tablecmds.c.html#LN424"><span class='Ref_to_Proto'>RebuildConstraintComment</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9619"><span class='Ref_To_Local'>tab</span></a><span class='Delimiter'>, 
</span>                                             <a href="tablecmds.c.html#LN144"><span class='Ref_to_Const'>AT_PASS_OLD_CONSTR</span></a><span class='Delimiter'>, 
</span>                                             <a href="tablecmds.c.html#LN9570"><span class='Ref_to_Parameter'>oldId</span></a><span class='Delimiter'>, 
</span>                                             <a href="tablecmds.c.html#LN9576"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9674"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2056"><span class='Ref_to_Member'>conname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if cmd-&GT;subtype==AT_AddC... &raquo; </span> 
                <span class='Control'>else</span> 
                    <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected statement subtype: %d"</span><span class='Delimiter'>, 
</span>                         <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN9646"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1752"><span class='Ref_to_Member'>subtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(stm,AlterTableStm... &raquo; </span> 
        <span class='Control'>else</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected statement type: %d"</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="../../include/nodes/nodes.h.html#LN513"><span class='Ref_to_Macro'>nodeTag</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9618"><span class='Ref_To_Local'>stm</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9576"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATPostAlterTypeParse &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Subroutine for ATPostAlterTypeParse() to recreate a comment entry for 
 * a constraint that is being re-added. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN9710"></a><span class='Declare_Function'>RebuildConstraintComment</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tab</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>pass</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>objid</span><span class='Delimiter'>, 
</span><a name="LN9711"></a>                         <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>conname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN9713"></a>    <a href="../../include/nodes/parsenodes.h.html#LN2572"><span class='Ref_to_Struct'>CommentStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cmd</span><span class='Delimiter'>; 
</span><a name="LN9714"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>comment_str</span><span class='Delimiter'>; 
</span><a name="LN9715"></a>    <a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a> <span class='Operator'>*</span><span class='Declare_Local'>newcmd</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Look for comment for object wanted, and leave if none */ 
</span>    <a href="tablecmds.c.html#LN9714"><span class='Ref_To_Local'>comment_str</span></a> <span class='Operator'>= </span><a href="../../include/commands/comment.h.html#LN42"><span class='Ref_to_Proto'>GetComment</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9710"><span class='Ref_to_Parameter'>objid</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_constraint.h.html#LN28"><span class='Ref_to_Const'>ConstraintRelationId</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9714"><span class='Ref_To_Local'>comment_str</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build node CommentStmt */ 
</span>    <a href="tablecmds.c.html#LN9713"><span class='Ref_To_Local'>cmd</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2572"><span class='Ref_to_Struct'>CommentStmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN9713"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2575"><span class='Ref_to_Member'>objtype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN1621"><span class='Ref_to_EnumConst'>OBJECT_TABCONSTRAINT</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN9713"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2576"><span class='Ref_to_Member'>object</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN140"><span class='Ref_to_Macro'>list_make3</span></a><span class='Parentheses'>(</span><a href="../nodes/value.c.html#LN51"><span class='Ref_to_Func'>makeString</span></a><span class='Parentheses'>(</span><a href="../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN443"><span class='Ref_to_Macro'>RelationGetNamespace</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9711"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>, 
</span>                           <a href="../nodes/value.c.html#LN51"><span class='Ref_to_Func'>makeString</span></a><span class='Parentheses'>(</span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9711"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>, 
</span>                                      <a href="../nodes/value.c.html#LN51"><span class='Ref_to_Func'>makeString</span></a><span class='Parentheses'>(</span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9711"><span class='Ref_to_Parameter'>conname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN9713"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2577"><span class='Ref_to_Member'>comment</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN9714"><span class='Ref_To_Local'>comment_str</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Append it to list of commands */ 
</span>    <a href="tablecmds.c.html#LN9715"><span class='Ref_To_Local'>newcmd</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN9715"><span class='Ref_To_Local'>newcmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1752"><span class='Ref_to_Member'>subtype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN1698"><span class='Ref_to_EnumConst'>AT_ReAddComment</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN9715"><span class='Ref_To_Local'>newcmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN9713"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN9710"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN160"><span class='Ref_to_Member'>subcmds</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN9710"><span class='Ref_to_Parameter'>pass</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9710"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN160"><span class='Ref_to_Member'>subcmds</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN9710"><span class='Ref_to_Parameter'>pass</span></a><span class='Delimiter'>], </span><a href="tablecmds.c.html#LN9715"><span class='Ref_To_Local'>newcmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RebuildConstraintComment &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Subroutine for ATPostAlterTypeParse().  Calls out to CheckIndexCompatible() 
 * for the real analysis, then mutates the IndexStmt based on that verdict. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN9742"></a><span class='Declare_Function'>TryReuseIndex</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oldId</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2667"><span class='Ref_to_Struct'>IndexStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/commands/defrem.h.html#LN40"><span class='Ref_to_Proto'>CheckIndexCompatible</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9742"><span class='Ref_to_Parameter'>oldId</span></a><span class='Delimiter'>, 
</span>                             <a href="tablecmds.c.html#LN9742"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2672"><span class='Ref_to_Member'>accessMethod</span></a><span class='Delimiter'>, 
</span>                             <a href="tablecmds.c.html#LN9742"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2674"><span class='Ref_to_Member'>indexParams</span></a><span class='Delimiter'>, 
</span>                             <a href="tablecmds.c.html#LN9742"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2677"><span class='Ref_to_Member'>excludeOpNames</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN9749"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>irel</span> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN129"><span class='Ref_to_Proto'>index_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9742"><span class='Ref_to_Parameter'>oldId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN9742"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2680"><span class='Ref_to_Member'>oldNode</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN9749"><span class='Ref_To_Local'>irel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN84"><span class='Ref_to_Member'>rd_node</span></a><span class='Operator'>.</span><a href="../../include/storage/relfilenode.h.html#LN60"><span class='Ref_to_Member'>relNode</span></a><span class='Delimiter'>; 
</span>        <a href="../../include/access/genam.h.html#LN130"><span class='Ref_to_Proto'>index_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9749"><span class='Ref_To_Local'>irel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Subroutine for ATPostAlterTypeParse(). 
 * 
 * Stash the old P-F equality operator into the Constraint node, for possible 
 * use by ATAddForeignKeyConstraint() in determining whether revalidation of 
 * this constraint can be skipped. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN9764"></a><span class='Declare_Function'>TryReuseForeignKey</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oldId</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2050"><span class='Ref_to_Struct'>Constraint</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>con</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN9766"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN9767"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>adatum</span><span class='Delimiter'>; 
</span><a name="LN9768"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN9769"></a>    <a href="../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>arr</span><span class='Delimiter'>; 
</span><a name="LN9770"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>rawarr</span><span class='Delimiter'>; 
</span><a name="LN9771"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numkeys</span><span class='Delimiter'>; 
</span><a name="LN9772"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9764"><span class='Ref_to_Parameter'>con</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2053"><span class='Ref_to_Member'>contype</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN2031"><span class='Ref_to_EnumConst'>CONSTR_FOREIGN</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9764"><span class='Ref_to_Parameter'>con</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2088"><span class='Ref_to_Member'>old_conpfeqop</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* already prepared this node */ 
</span> 
    <a href="tablecmds.c.html#LN9766"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN52"><span class='Ref_to_EnumConst'>CONSTROID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9764"><span class='Ref_to_Parameter'>oldId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9766"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> <span class='Comment_Single_Line'>/* should not happen */ 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for constraint %u"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9764"><span class='Ref_to_Parameter'>oldId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN9767"><span class='Ref_To_Local'>adatum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN52"><span class='Ref_to_EnumConst'>CONSTROID</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9766"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>, 
</span>                             <a href="../../include/catalog/pg_constraint.h.html#LN171"><span class='Ref_to_Const'>Anum_pg_constraint_conpfeqop</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN9768"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9768"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"null conpfeqop for constraint %u"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9764"><span class='Ref_to_Parameter'>oldId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN9769"><span class='Ref_To_Local'>arr</span></a> <span class='Operator'>= </span><a href="../../include/utils/array.h.html#LN241"><span class='Ref_to_Macro'>DatumGetArrayTypeP</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9767"><span class='Ref_To_Local'>adatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* ensure not toasted */ 
</span>    <a href="tablecmds.c.html#LN9771"><span class='Ref_To_Local'>numkeys</span></a> <span class='Operator'>= </span><a href="../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9769"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>    <span class='Comment_Multi_Line'>/* test follows the one in ri_FetchConstraintInfo() */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9769"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span> <span class='Operator'>|| 
</span>        <a href="../../include/utils/array.h.html#LN271"><span class='Ref_to_Macro'>ARR_HASNULL</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9769"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <a href="../../include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9769"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN27"><span class='Ref_to_Const'>OIDOID</span></a><span class='Parentheses'>)</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"conpfeqop is not a 1-D Oid array"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN9770"><span class='Ref_To_Local'>rawarr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9769"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* stash a List of the operator Oids in our Constraint node */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9772"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN9772"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tablecmds.c.html#LN9771"><span class='Ref_To_Local'>numkeys</span></a><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN9772"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="tablecmds.c.html#LN9764"><span class='Ref_to_Parameter'>con</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2088"><span class='Ref_to_Member'>old_conpfeqop</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN217"><span class='Ref_to_Proto'>lcons_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9770"><span class='Ref_To_Local'>rawarr</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN9772"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="tablecmds.c.html#LN9764"><span class='Ref_to_Parameter'>con</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2088"><span class='Ref_to_Member'>old_conpfeqop</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9766"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end TryReuseForeignKey &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ALTER TABLE OWNER 
 * 
 * recursing is true if we are recursing from a table to its indexes, 
 * sequences, or toast table.  We don't allow the ownership of those things to 
 * be changed separately from the parent table.  Also, we can skip permission 
 * checks (this is necessary not just an optimization, else we'd fail to 
 * handle toast tables properly). 
 * 
 * recursing is also true if ALTER TYPE OWNER is calling us to fix up a 
 * free-standing composite type. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN9814"></a><span class='Declare_Function'>ATExecChangeOwner</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relationOid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>newOwnerId</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>recursing</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN9816"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>target_rel</span><span class='Delimiter'>; 
</span><a name="LN9817"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>class_rel</span><span class='Delimiter'>; 
</span><a name="LN9818"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN9819"></a>    <a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Local'>tuple_class</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get exclusive lock till end of transaction on the target table. Use 
     * relation_open so that we can work on indexes and sequences. 
     */ 
</span>    <a href="tablecmds.c.html#LN9816"><span class='Ref_To_Local'>target_rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN84"><span class='Ref_to_Proto'>relation_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9814"><span class='Ref_to_Parameter'>relationOid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9814"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get its pg_class tuple, too */ 
</span>    <a href="tablecmds.c.html#LN9817"><span class='Ref_To_Local'>class_rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN9818"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9814"><span class='Ref_to_Parameter'>relationOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9818"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for relation %u"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9814"><span class='Ref_to_Parameter'>relationOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN9819"><span class='Ref_To_Local'>tuple_class</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9818"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Can we change the ownership of this tuple? */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9819"><span class='Ref_To_Local'>tuple_class</span></a><span class='Operator'>-&GT;</span>relkind<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN163"><span class='Ref_to_Const'>RELKIND_VIEW</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* ok to change owner */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN160"><span class='Ref_to_Const'>RELKIND_INDEX</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN9814"><span class='Ref_to_Parameter'>recursing</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Because ALTER INDEX OWNER used to be allowed, and in fact 
                 * is generated by old versions of pg_dump, we give a warning 
                 * and do nothing rather than erroring out.  Also, to avoid 
                 * unnecessary chatter while restoring those old dumps, say 
                 * nothing at all if the command would be a no-op anyway. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9819"><span class='Ref_To_Local'>tuple_class</span></a><span class='Operator'>-&GT;</span>relowner <span class='Operator'>!= </span><a href="tablecmds.c.html#LN9814"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot change owner of index \"%s\""</span><span class='Delimiter'>, 
</span>                                    <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9819"><span class='Ref_To_Local'>tuple_class</span></a><span class='Operator'>-&GT;</span>relname<span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Change the ownership of the index's table, instead."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* quick hack to exit via the no-op path */ 
</span>                <a href="tablecmds.c.html#LN9814"><span class='Ref_to_Parameter'>newOwnerId</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN9819"><span class='Ref_To_Local'>tuple_class</span></a><span class='Operator'>-&GT;</span>relowner<span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN9814"><span class='Ref_to_Parameter'>recursing</span></a> <span class='Operator'>&& 
</span>                <a href="tablecmds.c.html#LN9819"><span class='Ref_To_Local'>tuple_class</span></a><span class='Operator'>-&GT;</span>relowner <span class='Operator'>!= </span><a href="tablecmds.c.html#LN9814"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* if it's an owned sequence, disallow changing it by itself */ 
</span><a name="LN9870"></a>                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tableId</span><span class='Delimiter'>; 
</span><a name="LN9871"></a>                <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>colId</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/dependency.h.html#LN240"><span class='Ref_to_Proto'>sequenceIsOwned</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9814"><span class='Ref_to_Parameter'>relationOid</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN75"><span class='Ref_to_EnumConst'>DEPENDENCY_AUTO</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN9870"><span class='Ref_To_Local'>tableId</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN9871"><span class='Ref_To_Local'>colId</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>                    <a href="../../include/catalog/dependency.h.html#LN240"><span class='Ref_to_Proto'>sequenceIsOwned</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9814"><span class='Ref_to_Parameter'>relationOid</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN76"><span class='Ref_to_EnumConst'>DEPENDENCY_INTERNAL</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN9870"><span class='Ref_To_Local'>tableId</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN9871"><span class='Ref_To_Local'>colId</span></a><span class='Parentheses'>))</span> 
                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot change owner of sequence \"%s\""</span><span class='Delimiter'>, 
</span>                                    <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9819"><span class='Ref_To_Local'>tuple_class</span></a><span class='Operator'>-&GT;</span>relname<span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                      <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Sequence \"%s\" is linked to table \"%s\"."</span><span class='Delimiter'>, 
</span>                                <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9819"><span class='Ref_To_Local'>tuple_class</span></a><span class='Operator'>-&GT;</span>relname<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/lsyscache.h.html#LN124"><span class='Ref_to_Proto'>get_rel_name</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9870"><span class='Ref_To_Local'>tableId</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN165"><span class='Ref_to_Const'>RELKIND_COMPOSITE_TYPE</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9814"><span class='Ref_to_Parameter'>recursing</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is a composite type"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9819"><span class='Ref_To_Local'>tuple_class</span></a><span class='Operator'>-&GT;</span>relname<span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Use ALTER TYPE instead."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN162"><span class='Ref_to_Const'>RELKIND_TOASTVALUE</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9814"><span class='Ref_to_Parameter'>recursing</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* FALL THRU */ 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a table, view, sequence, or foreign table"</span><span class='Delimiter'>, 
</span>                   <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9819"><span class='Ref_To_Local'>tuple_class</span></a><span class='Operator'>-&GT;</span>relname<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch tuple_class-&GT;relkind &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If the new owner is the same as the existing owner, consider the 
     * command to have succeeded.  This is for dump restoration purposes. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9819"><span class='Ref_To_Local'>tuple_class</span></a><span class='Operator'>-&GT;</span>relowner <span class='Operator'>!= </span><a href="tablecmds.c.html#LN9814"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN9910"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>repl_val</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_class.h.html#LN101"><span class='Ref_to_Const'>Natts_pg_class</span></a><span class='Delimiter'>]; 
</span><a name="LN9911"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>repl_null</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_class.h.html#LN101"><span class='Ref_to_Const'>Natts_pg_class</span></a><span class='Delimiter'>]; 
</span><a name="LN9912"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>repl_repl</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_class.h.html#LN101"><span class='Ref_to_Const'>Natts_pg_class</span></a><span class='Delimiter'>]; 
</span><a name="LN9913"></a>        <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>newAcl</span><span class='Delimiter'>; 
</span><a name="LN9914"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN9915"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN9916"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newtuple</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* skip permission checks when recursing to index or toast table */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN9814"><span class='Ref_to_Parameter'>recursing</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Superusers can always do it */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>())</span> 
            <span class='Delimiter'>{ 
</span><a name="LN9924"></a>                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>namespaceOid</span> <span class='Operator'>= </span><a href="tablecmds.c.html#LN9819"><span class='Ref_To_Local'>tuple_class</span></a><span class='Operator'>-&GT;</span>relnamespace<span class='Delimiter'>; 
</span><a name="LN9925"></a>                <a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Otherwise, must be owner of the existing object */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN308"><span class='Ref_to_Proto'>pg_class_ownercheck</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9814"><span class='Ref_to_Parameter'>relationOid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
                    <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN181"><span class='Ref_to_EnumConst'>ACL_KIND_CLASS</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9816"><span class='Ref_To_Local'>target_rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Must be able to become new owner */ 
</span>                <a href="../../include/utils/acl.h.html#LN233"><span class='Ref_to_Proto'>check_is_member_of_role</span></a><span class='Parentheses'>(</span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9814"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* New owner must have CREATE privilege on namespace */ 
</span>                <a href="tablecmds.c.html#LN9925"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN289"><span class='Ref_to_Proto'>pg_namespace_aclcheck</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9924"><span class='Ref_To_Local'>namespaceOid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9814"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Delimiter'>, 
</span>                                                  <a href="../../include/nodes/parsenodes.h.html#LN81"><span class='Ref_to_Const'>ACL_CREATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9925"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9925"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN189"><span class='Ref_to_EnumConst'>ACL_KIND_NAMESPACE</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9924"><span class='Ref_To_Local'>namespaceOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !superuser() &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !recursing &raquo; </span> 
 
        memset<span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9911"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9911"><span class='Ref_To_Local'>repl_null</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memset<span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9912"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9912"><span class='Ref_To_Local'>repl_repl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN9912"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_class.h.html#LN106"><span class='Ref_to_Const'>Anum_pg_class_relowner</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN9910"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_class.h.html#LN106"><span class='Ref_to_Const'>Anum_pg_class_relowner</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9814"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Determine the modified ACL for the new owner.  This is only 
         * necessary when the ACL is non-null. 
         */ 
</span>        <a href="tablecmds.c.html#LN9914"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9818"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../include/catalog/pg_class.h.html#LN132"><span class='Ref_to_Const'>Anum_pg_class_relacl</span></a><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="tablecmds.c.html#LN9915"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN9915"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="tablecmds.c.html#LN9913"><span class='Ref_To_Local'>newAcl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN217"><span class='Ref_to_Proto'>aclnewowner</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN112"><span class='Ref_to_Macro'>DatumGetAclP</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9914"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="tablecmds.c.html#LN9819"><span class='Ref_To_Local'>tuple_class</span></a><span class='Operator'>-&GT;</span>relowner<span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9814"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN9912"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_class.h.html#LN132"><span class='Ref_to_Const'>Anum_pg_class_relacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN9910"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_class.h.html#LN132"><span class='Ref_to_Const'>Anum_pg_class_relacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9913"><span class='Ref_To_Local'>newAcl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="tablecmds.c.html#LN9916"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9818"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9817"><span class='Ref_To_Local'>class_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9910"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9911"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9912"><span class='Ref_To_Local'>repl_repl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9817"><span class='Ref_To_Local'>class_rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN9916"><span class='Ref_To_Local'>newtuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9916"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9916"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We must similarly update any per-column ACLs to reflect the new 
         * owner; for neatness reasons that's split out as a subroutine. 
         */ 
</span>        <a href="tablecmds.c.html#LN428"><span class='Ref_to_Proto'>change_owner_fix_column_acls</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9814"><span class='Ref_to_Parameter'>relationOid</span></a><span class='Delimiter'>, 
</span>                                     <a href="tablecmds.c.html#LN9819"><span class='Ref_To_Local'>tuple_class</span></a><span class='Operator'>-&GT;</span>relowner<span class='Delimiter'>, 
</span>                                     <a href="tablecmds.c.html#LN9814"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Update owner dependency reference, if any.  A composite type has 
         * none, because it's tracked for the pg_type entry instead of here; 
         * indexes and TOAST tables don't have their own entries either. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9819"><span class='Ref_To_Local'>tuple_class</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN165"><span class='Ref_to_Const'>RELKIND_COMPOSITE_TYPE</span></a> <span class='Operator'>&& 
</span>            <a href="tablecmds.c.html#LN9819"><span class='Ref_To_Local'>tuple_class</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN160"><span class='Ref_to_Const'>RELKIND_INDEX</span></a> <span class='Operator'>&& 
</span>            <a href="tablecmds.c.html#LN9819"><span class='Ref_To_Local'>tuple_class</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN162"><span class='Ref_to_Const'>RELKIND_TOASTVALUE</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/catalog/dependency.h.html#LN259"><span class='Ref_to_Proto'>changeDependencyOnOwner</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9814"><span class='Ref_to_Parameter'>relationOid</span></a><span class='Delimiter'>, 
</span>                                    <a href="tablecmds.c.html#LN9814"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Also change the ownership of the table's row type, if it has one 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9819"><span class='Ref_To_Local'>tuple_class</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN160"><span class='Ref_to_Const'>RELKIND_INDEX</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/commands/typecmds.h.html#LN46"><span class='Ref_to_Proto'>AlterTypeOwnerInternal</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9819"><span class='Ref_To_Local'>tuple_class</span></a><span class='Operator'>-&GT;</span>reltype<span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9814"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If we are operating on a table or materialized view, also change 
         * the ownership of any indexes and sequences that belong to the 
         * relation, as well as its toast table (if it has one). 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9819"><span class='Ref_To_Local'>tuple_class</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a> <span class='Operator'>|| 
</span>            <a href="tablecmds.c.html#LN9819"><span class='Ref_To_Local'>tuple_class</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a> <span class='Operator'>|| 
</span>            <a href="tablecmds.c.html#LN9819"><span class='Ref_To_Local'>tuple_class</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN162"><span class='Ref_to_Const'>RELKIND_TOASTVALUE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN10005"></a>            <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>index_oid_list</span><span class='Delimiter'>; 
</span><a name="LN10006"></a>            <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Find all the indexes belonging to this relation */ 
</span>            <a href="tablecmds.c.html#LN10005"><span class='Ref_To_Local'>index_oid_list</span></a> <span class='Operator'>= </span><a href="../../include/utils/relcache.h.html#LN40"><span class='Ref_to_Proto'>RelationGetIndexList</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9816"><span class='Ref_To_Local'>target_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* For each index, recursively change its ownership */ 
</span>            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10006"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10005"><span class='Ref_To_Local'>index_oid_list</span></a><span class='Parentheses'>) 
</span><a name="LN10013"></a>                <span class='Declare_Local'>ATExecChangeOwner</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10006"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9814"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9814"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10005"><span class='Ref_To_Local'>index_oid_list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9819"><span class='Ref_To_Local'>tuple_class</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a> <span class='Operator'>|| 
</span>            <a href="tablecmds.c.html#LN9819"><span class='Ref_To_Local'>tuple_class</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* If it has a toast table, recurse to change its ownership */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9819"><span class='Ref_To_Local'>tuple_class</span></a><span class='Operator'>-&GT;</span>reltoastrelid <span class='Operator'>!= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/commands/tablecmds.h.html#LN35"><span class='Ref_to_Proto'>ATExecChangeOwner</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9819"><span class='Ref_To_Local'>tuple_class</span></a><span class='Operator'>-&GT;</span>reltoastrelid<span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9814"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Delimiter'>, 
</span>                                  <span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9814"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* If it has dependent sequences, recurse to change them too */ 
</span>            <a href="tablecmds.c.html#LN430"><span class='Ref_to_Proto'>change_owner_recurse_to_sequences</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9814"><span class='Ref_to_Parameter'>relationOid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9814"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9814"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if tuple_class-&GT;relowner... &raquo; </span> 
 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN9814"><span class='Ref_to_Parameter'>relationOid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9818"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9817"><span class='Ref_To_Local'>class_rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN9816"><span class='Ref_To_Local'>target_rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATExecChangeOwner &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * change_owner_fix_column_acls 
 * 
 * Helper function for ATExecChangeOwner.  Scan the columns of the table 
 * and fix any non-null column ACLs to reflect the new owner. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN10045"></a><span class='Declare_Function'>change_owner_fix_column_acls</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relationOid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oldOwnerId</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>newOwnerId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN10047"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>attRelation</span><span class='Delimiter'>; 
</span><a name="LN10048"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN10049"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN10050"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>attributeTuple</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN10047"><span class='Ref_To_Local'>attRelation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN32"><span class='Ref_to_Const'>AttributeRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN10049"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_attribute.h.html#LN194"><span class='Ref_to_Const'>Anum_pg_attribute_attrelid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10045"><span class='Ref_to_Parameter'>relationOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN10048"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10047"><span class='Ref_To_Local'>attRelation</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN93"><span class='Ref_to_Const'>AttributeRelidNumIndexId</span></a><span class='Delimiter'>, 
</span>                              <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10049"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10050"><span class='Ref_To_Local'>attributeTuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10048"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN10061"></a>        <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>att</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10050"><span class='Ref_To_Local'>attributeTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN10062"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>repl_val</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_attribute.h.html#LN193"><span class='Ref_to_Const'>Natts_pg_attribute</span></a><span class='Delimiter'>]; 
</span><a name="LN10063"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>repl_null</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_attribute.h.html#LN193"><span class='Ref_to_Const'>Natts_pg_attribute</span></a><span class='Delimiter'>]; 
</span><a name="LN10064"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>repl_repl</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_attribute.h.html#LN193"><span class='Ref_to_Const'>Natts_pg_attribute</span></a><span class='Delimiter'>]; 
</span><a name="LN10065"></a>        <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>newAcl</span><span class='Delimiter'>; 
</span><a name="LN10066"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN10067"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN10068"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newtuple</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Ignore dropped columns */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10061"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN10066"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN768"><span class='Ref_to_Macro'>heap_getattr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10050"><span class='Ref_To_Local'>attributeTuple</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/catalog/pg_attribute.h.html#LN213"><span class='Ref_to_Const'>Anum_pg_attribute_attacl</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10047"><span class='Ref_To_Local'>attRelation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="tablecmds.c.html#LN10067"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Null ACLs do not require changes */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10067"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        memset<span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10063"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10063"><span class='Ref_To_Local'>repl_null</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memset<span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10064"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10064"><span class='Ref_To_Local'>repl_repl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN10065"><span class='Ref_To_Local'>newAcl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN217"><span class='Ref_to_Proto'>aclnewowner</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN112"><span class='Ref_to_Macro'>DatumGetAclP</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10066"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="tablecmds.c.html#LN10045"><span class='Ref_to_Parameter'>oldOwnerId</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10045"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN10064"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_attribute.h.html#LN213"><span class='Ref_to_Const'>Anum_pg_attribute_attacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN10062"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_attribute.h.html#LN213"><span class='Ref_to_Const'>Anum_pg_attribute_attacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10065"><span class='Ref_To_Local'>newAcl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN10068"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10050"><span class='Ref_To_Local'>attributeTuple</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10047"><span class='Ref_To_Local'>attRelation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="tablecmds.c.html#LN10062"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10063"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10064"><span class='Ref_To_Local'>repl_repl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10047"><span class='Ref_To_Local'>attRelation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN10068"><span class='Ref_To_Local'>newtuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10068"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10068"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while HeapTupleIsValid(attr... &raquo; </span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10048"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10047"><span class='Ref_To_Local'>attRelation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end change_owner_fix_column_acls &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * change_owner_recurse_to_sequences 
 * 
 * Helper function for ATExecChangeOwner.  Examines pg_depend searching 
 * for sequences that are dependent on serial columns, and changes their 
 * ownership. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN10110"></a><span class='Declare_Function'>change_owner_recurse_to_sequences</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relationOid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>newOwnerId</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN10112"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>depRel</span><span class='Delimiter'>; 
</span><a name="LN10113"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN10114"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN10115"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * SERIAL sequences are those having an auto dependency on one of the 
     * table's columns (we don't care *which* column, exactly). 
     */ 
</span>    <a href="tablecmds.c.html#LN10112"><span class='Ref_To_Local'>depRel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_depend.h.html#LN28"><span class='Ref_to_Const'>DependRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN10114"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN70"><span class='Ref_to_Const'>Anum_pg_depend_refclassid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN10114"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN71"><span class='Ref_to_Const'>Anum_pg_depend_refobjid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10110"><span class='Ref_to_Parameter'>relationOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* we leave refobjsubid unspecified */ 
</span> 
    <a href="tablecmds.c.html#LN10113"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10112"><span class='Ref_To_Local'>depRel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN146"><span class='Ref_to_Const'>DependReferenceIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10114"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10115"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10113"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN10138"></a>        <a href="../../include/catalog/pg_depend.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_depend</span></a> <span class='Declare_Local'>depForm</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_depend.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_depend</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10115"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN10139"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>seqRel</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* skip dependencies other than auto dependencies on columns */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10138"><span class='Ref_To_Local'>depForm</span></a><span class='Operator'>-&GT;</span>refobjsubid <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            <a href="tablecmds.c.html#LN10138"><span class='Ref_To_Local'>depForm</span></a><span class='Operator'>-&GT;</span>classid <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a> <span class='Operator'>|| 
</span>            <a href="tablecmds.c.html#LN10138"><span class='Ref_To_Local'>depForm</span></a><span class='Operator'>-&GT;</span>objsubid <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            <span class='Operator'>!</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10138"><span class='Ref_To_Local'>depForm</span></a><span class='Operator'>-&GT;</span>deptype <span class='Operator'>== </span><a href="../../include/catalog/dependency.h.html#LN75"><span class='Ref_to_EnumConst'>DEPENDENCY_AUTO</span></a> <span class='Operator'>|| </span><a href="tablecmds.c.html#LN10138"><span class='Ref_To_Local'>depForm</span></a><span class='Operator'>-&GT;</span>deptype <span class='Operator'>== </span><a href="../../include/catalog/dependency.h.html#LN76"><span class='Ref_to_EnumConst'>DEPENDENCY_INTERNAL</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Use relation_open just in case it's an index */ 
</span>        <a href="tablecmds.c.html#LN10139"><span class='Ref_To_Local'>seqRel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN84"><span class='Ref_to_Proto'>relation_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10138"><span class='Ref_To_Local'>depForm</span></a><span class='Operator'>-&GT;</span>objid<span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10110"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* skip non-sequence relations */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN410"><span class='Ref_to_Macro'>RelationGetForm</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10139"><span class='Ref_To_Local'>seqRel</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* No need to keep the lock */ 
</span>            <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10139"><span class='Ref_To_Local'>seqRel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10110"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* We don't need to close the sequence while we alter it. */ 
</span>        <a href="../../include/commands/tablecmds.h.html#LN35"><span class='Ref_to_Proto'>ATExecChangeOwner</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10138"><span class='Ref_To_Local'>depForm</span></a><span class='Operator'>-&GT;</span>objid<span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10110"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10110"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Now we can close it.  Keep the lock till end of transaction. */ 
</span>        <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10139"><span class='Ref_To_Local'>seqRel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while HeapTupleIsValid(tup=... &raquo; </span> 
 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10113"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10112"><span class='Ref_To_Local'>depRel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end change_owner_recurse_to_sequences &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ALTER TABLE CLUSTER ON 
 * 
 * The only thing we have to do is to change the indisclustered bits. 
 * 
 * Return the address of the new clustering index. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN10179"></a><span class='Declare_Function'>ATExecClusterOn</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>indexName</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN10181"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>indexOid</span><span class='Delimiter'>; 
</span><a name="LN10182"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN10181"><span class='Ref_To_Local'>indexOid</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN123"><span class='Ref_to_Proto'>get_relname_relid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10179"><span class='Ref_to_Parameter'>indexName</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10179"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relnamespace<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10181"><span class='Ref_To_Local'>indexOid</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"index \"%s\" for table \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN10179"><span class='Ref_to_Parameter'>indexName</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10179"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check index is valid to cluster on */ 
</span>    <a href="../../include/commands/cluster.h.html#LN23"><span class='Ref_to_Proto'>check_index_is_clusterable</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10179"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10181"><span class='Ref_To_Local'>indexOid</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10179"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* And do the work */ 
</span>    <a href="../../include/commands/cluster.h.html#LN25"><span class='Ref_to_Proto'>mark_index_clustered</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10179"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10181"><span class='Ref_To_Local'>indexOid</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10182"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, 
</span>                     <a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10181"><span class='Ref_To_Local'>indexOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN10182"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATExecClusterOn &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ALTER TABLE SET WITHOUT CLUSTER 
 * 
 * We have to find any indexes on the table that have indisclustered bit 
 * set and turn it off. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN10211"></a><span class='Declare_Function'>ATExecDropCluster</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../include/commands/cluster.h.html#LN25"><span class='Ref_to_Proto'>mark_index_clustered</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10211"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * ALTER TABLE SET TABLESPACE 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN10220"></a><span class='Declare_Function'>ATPrepSetTableSpace</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tab</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>tablespacename</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN10222"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tablespaceId</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check that the tablespace exists */ 
</span>    <a href="tablecmds.c.html#LN10222"><span class='Ref_To_Local'>tablespaceId</span></a> <span class='Operator'>= </span><a href="../../include/commands/tablespace.h.html#LN55"><span class='Ref_to_Proto'>get_tablespace_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10220"><span class='Ref_to_Parameter'>tablespacename</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check permissions except when moving to database's default */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10222"><span class='Ref_To_Local'>tablespaceId</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="tablecmds.c.html#LN10222"><span class='Ref_To_Local'>tablespaceId</span></a> <span class='Operator'>!= </span><a href="../utils/init/globals.c.html#LN78"><span class='Ref_to_Global_Var'>MyDatabaseTableSpace</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN10230"></a>        <a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN10230"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN290"><span class='Ref_to_Proto'>pg_tablespace_aclcheck</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10222"><span class='Ref_To_Local'>tablespaceId</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN81"><span class='Ref_to_Const'>ACL_CREATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10230"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10230"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN195"><span class='Ref_to_EnumConst'>ACL_KIND_TABLESPACE</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10220"><span class='Ref_to_Parameter'>tablespacename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Save info for Phase 3 to do the real work */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10220"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN166"><span class='Ref_to_Member'>newTableSpace</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot have multiple SET TABLESPACE subcommands"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN10220"><span class='Ref_to_Parameter'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN166"><span class='Ref_to_Member'>newTableSpace</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN10222"><span class='Ref_To_Local'>tablespaceId</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATPrepSetTableSpace &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Set, reset, or replace reloptions. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN10250"></a><span class='Declare_Function'>ATExecSetRelOptions</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>defList</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1671"><span class='Ref_to_Enum'>AlterTableType</span></a> <span class='Declare_Parameter'>operation</span><span class='Delimiter'>, 
</span><a name="LN10251"></a>                    <a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN10253"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span><span class='Delimiter'>; 
</span><a name="LN10254"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pgclass</span><span class='Delimiter'>; 
</span><a name="LN10255"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN10256"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newtuple</span><span class='Delimiter'>; 
</span><a name="LN10257"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>datum</span><span class='Delimiter'>; 
</span><a name="LN10258"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN10259"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>newOptions</span><span class='Delimiter'>; 
</span><a name="LN10260"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>repl_val</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_class.h.html#LN101"><span class='Ref_to_Const'>Natts_pg_class</span></a><span class='Delimiter'>]; 
</span><a name="LN10261"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>repl_null</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_class.h.html#LN101"><span class='Ref_to_Const'>Natts_pg_class</span></a><span class='Delimiter'>]; 
</span><a name="LN10262"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>repl_repl</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_class.h.html#LN101"><span class='Ref_to_Const'>Natts_pg_class</span></a><span class='Delimiter'>]; 
</span><a name="LN10263"></a>    <span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Local'>validnsps</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><a href="../../include/access/reloptions.h.html#LN58"><span class='Ref_to_Const'>HEAP_RELOPT_NAMESPACES</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10250"><span class='Ref_to_Parameter'>defList</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>&& </span><a href="tablecmds.c.html#LN10250"><span class='Ref_to_Parameter'>operation</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/parsenodes.h.html#LN1712"><span class='Ref_to_EnumConst'>AT_ReplaceRelOptions</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>;</span>                 <span class='Comment_Single_Line'>/* nothing to do */ 
</span> 
    <a href="tablecmds.c.html#LN10254"><span class='Ref_To_Local'>pgclass</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Fetch heap tuple */ 
</span>    <a href="tablecmds.c.html#LN10253"><span class='Ref_To_Local'>relid</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10250"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN10255"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10253"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10255"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for relation %u"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10253"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10250"><span class='Ref_to_Parameter'>operation</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN1712"><span class='Ref_to_EnumConst'>AT_ReplaceRelOptions</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * If we're supposed to replace the reloptions list, we just pretend 
         * there were none before. 
         */ 
</span>        <a href="tablecmds.c.html#LN10257"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN10258"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Get the old reloptions */ 
</span>        <a href="tablecmds.c.html#LN10257"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10255"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN133"><span class='Ref_to_Const'>Anum_pg_class_reloptions</span></a><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="tablecmds.c.html#LN10258"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Generate new proposed reloptions (text array) */ 
</span>    <a href="tablecmds.c.html#LN10259"><span class='Ref_To_Local'>newOptions</span></a> <span class='Operator'>= </span><a href="../../include/access/reloptions.h.html#LN257"><span class='Ref_to_Proto'>transformRelOptions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10258"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>? </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span> <span class='Operator'>: </span><a href="tablecmds.c.html#LN10257"><span class='Ref_To_Local'>datum</span></a><span class='Delimiter'>, 
</span>                                     <a href="tablecmds.c.html#LN10250"><span class='Ref_to_Parameter'>defList</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10263"><span class='Ref_To_Local'>validnsps</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                     <a href="tablecmds.c.html#LN10250"><span class='Ref_to_Parameter'>operation</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN1711"><span class='Ref_to_EnumConst'>AT_ResetRelOptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Validate */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10250"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN162"><span class='Ref_to_Const'>RELKIND_TOASTVALUE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Operator'>: 
</span>            <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../include/access/reloptions.h.html#LN274"><span class='Ref_to_Proto'>heap_reloptions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10250"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind<span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10259"><span class='Ref_To_Local'>newOptions</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN163"><span class='Ref_to_Const'>RELKIND_VIEW</span></a><span class='Operator'>: 
</span>            <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../include/access/reloptions.h.html#LN275"><span class='Ref_to_Proto'>view_reloptions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10259"><span class='Ref_To_Local'>newOptions</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN160"><span class='Ref_to_Const'>RELKIND_INDEX</span></a><span class='Operator'>: 
</span>            <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../include/access/reloptions.h.html#LN276"><span class='Ref_to_Proto'>index_reloptions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10250"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN180"><span class='Ref_to_Member'>rd_amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/amapi.h.html#LN204"><span class='Ref_to_Member'>amoptions</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10259"><span class='Ref_To_Local'>newOptions</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a table, view, materialized view, index, or TOAST table"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10250"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch rel-&GT;rd_rel-&GT;relkind &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Special-case validation of view options */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10250"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN163"><span class='Ref_to_Const'>RELKIND_VIEW</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN10323"></a>        <a href="../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>view_query</span> <span class='Operator'>= </span><a href="../../include/rewrite/rewriteHandler.h.html#LN25"><span class='Ref_to_Proto'>get_view_query</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10250"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN10324"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>view_options</span> <span class='Operator'>= </span><a href="../../include/access/reloptions.h.html#LN260"><span class='Ref_to_Proto'>untransformRelOptions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10259"><span class='Ref_To_Local'>newOptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN10325"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span><a name="LN10326"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>check_option</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10325"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10324"><span class='Ref_To_Local'>view_options</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN10330"></a>            <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>defel</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10325"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10330"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"check_option"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="tablecmds.c.html#LN10326"><span class='Ref_To_Local'>check_option</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If the check option is specified, look to see if the view is 
         * actually auto-updatable or not. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10326"><span class='Ref_To_Local'>check_option</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN10342"></a>            <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>view_updatable_error</span> <span class='Operator'>= 
</span>            <a href="../../include/rewrite/rewriteHandler.h.html#LN26"><span class='Ref_to_Proto'>view_query_is_auto_updatable</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10323"><span class='Ref_To_Local'>view_query</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10342"><span class='Ref_To_Local'>view_updatable_error</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"WITH CHECK OPTION is supported only on automatically updatable views"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10342"><span class='Ref_To_Local'>view_updatable_error</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if rel-&GT;rd_rel-&GT;relkind=... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * All we need do here is update the pg_class row; the new options will be 
     * propagated into relcaches during post-commit cache inval. 
     */ 
</span>    memset<span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10260"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10260"><span class='Ref_To_Local'>repl_val</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10261"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10261"><span class='Ref_To_Local'>repl_null</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10262"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10262"><span class='Ref_To_Local'>repl_repl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10259"><span class='Ref_To_Local'>newOptions</span></a> <span class='Operator'>!= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="tablecmds.c.html#LN10260"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_class.h.html#LN133"><span class='Ref_to_Const'>Anum_pg_class_reloptions</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="tablecmds.c.html#LN10259"><span class='Ref_To_Local'>newOptions</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="tablecmds.c.html#LN10261"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_class.h.html#LN133"><span class='Ref_to_Const'>Anum_pg_class_reloptions</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN10262"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_class.h.html#LN133"><span class='Ref_to_Const'>Anum_pg_class_reloptions</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN10256"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10255"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10254"><span class='Ref_To_Local'>pgclass</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="tablecmds.c.html#LN10260"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10261"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10262"><span class='Ref_To_Local'>repl_repl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10254"><span class='Ref_To_Local'>pgclass</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN10256"><span class='Ref_To_Local'>newtuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10256"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10250"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10256"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10255"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* repeat the whole exercise for the toast table, if there's one */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10250"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltoastrelid<span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN10382"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>toastrel</span><span class='Delimiter'>; 
</span><a name="LN10383"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>toastid</span> <span class='Operator'>= </span><a href="tablecmds.c.html#LN10250"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltoastrelid<span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN10382"><span class='Ref_To_Local'>toastrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10383"><span class='Ref_To_Local'>toastid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10251"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Fetch heap tuple */ 
</span>        <a href="tablecmds.c.html#LN10255"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10383"><span class='Ref_To_Local'>toastid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10255"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for relation %u"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10383"><span class='Ref_To_Local'>toastid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10250"><span class='Ref_to_Parameter'>operation</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN1712"><span class='Ref_to_EnumConst'>AT_ReplaceRelOptions</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * If we're supposed to replace the reloptions list, we just 
             * pretend there were none before. 
             */ 
</span>            <a href="tablecmds.c.html#LN10257"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN10258"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Get the old reloptions */ 
</span>            <a href="tablecmds.c.html#LN10257"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10255"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN133"><span class='Ref_to_Const'>Anum_pg_class_reloptions</span></a><span class='Delimiter'>, 
</span>                                    <span class='Operator'>&</span><a href="tablecmds.c.html#LN10258"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="tablecmds.c.html#LN10259"><span class='Ref_To_Local'>newOptions</span></a> <span class='Operator'>= </span><a href="../../include/access/reloptions.h.html#LN257"><span class='Ref_to_Proto'>transformRelOptions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10258"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>? </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span> <span class='Operator'>: </span><a href="tablecmds.c.html#LN10257"><span class='Ref_To_Local'>datum</span></a><span class='Delimiter'>, 
</span>                                         <a href="tablecmds.c.html#LN10250"><span class='Ref_to_Parameter'>defList</span></a><span class='Delimiter'>, </span><span class='String'>"toast"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10263"><span class='Ref_To_Local'>validnsps</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                         <a href="tablecmds.c.html#LN10250"><span class='Ref_to_Parameter'>operation</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN1711"><span class='Ref_to_EnumConst'>AT_ResetRelOptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../include/access/reloptions.h.html#LN274"><span class='Ref_to_Proto'>heap_reloptions</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN162"><span class='Ref_to_Const'>RELKIND_TOASTVALUE</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10259"><span class='Ref_To_Local'>newOptions</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        memset<span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10260"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10260"><span class='Ref_To_Local'>repl_val</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memset<span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10261"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10261"><span class='Ref_To_Local'>repl_null</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memset<span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10262"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10262"><span class='Ref_To_Local'>repl_repl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10259"><span class='Ref_To_Local'>newOptions</span></a> <span class='Operator'>!= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="tablecmds.c.html#LN10260"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_class.h.html#LN133"><span class='Ref_to_Const'>Anum_pg_class_reloptions</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="tablecmds.c.html#LN10259"><span class='Ref_To_Local'>newOptions</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="tablecmds.c.html#LN10261"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_class.h.html#LN133"><span class='Ref_to_Const'>Anum_pg_class_reloptions</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN10262"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_class.h.html#LN133"><span class='Ref_to_Const'>Anum_pg_class_reloptions</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN10256"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10255"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10254"><span class='Ref_To_Local'>pgclass</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="tablecmds.c.html#LN10260"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10261"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10262"><span class='Ref_To_Local'>repl_repl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10254"><span class='Ref_To_Local'>pgclass</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN10256"><span class='Ref_To_Local'>newtuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10256"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/objectaccess.h.html#LN165"><span class='Ref_to_Macro'>InvokeObjectPostAlterHookArg</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10382"><span class='Ref_To_Local'>toastrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                     <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10256"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10255"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10382"><span class='Ref_To_Local'>toastrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if OidIsValid(rel-&GT;rd_re... &raquo; </span> 
 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10254"><span class='Ref_To_Local'>pgclass</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATExecSetRelOptions &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Execute ALTER TABLE SET TABLESPACE for cases where there is no tuple 
 * rewriting to be done, so we just want to copy the data as fast as possible. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN10449"></a><span class='Declare_Function'>ATExecSetTableSpace</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>tableOid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>newTableSpace</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN10451"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN10452"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>oldTableSpace</span><span class='Delimiter'>; 
</span><a name="LN10453"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>reltoastrelid</span><span class='Delimiter'>; 
</span><a name="LN10454"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>newrelfilenode</span><span class='Delimiter'>; 
</span><a name="LN10455"></a>    <a href="../../include/storage/relfilenode.h.html#LN56"><span class='Ref_to_Struct'>RelFileNode</span></a> <span class='Declare_Local'>newrnode</span><span class='Delimiter'>; 
</span><a name="LN10456"></a>    <a href="../../include/storage/smgr.h.html#LN77"><span class='Ref_to_Typedef'>SMgrRelation</span></a> <span class='Declare_Local'>dstrel</span><span class='Delimiter'>; 
</span><a name="LN10457"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pg_class</span><span class='Delimiter'>; 
</span><a name="LN10458"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN10459"></a>    <a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Local'>rd_rel</span><span class='Delimiter'>; 
</span><a name="LN10460"></a>    <a href="../../include/common/relpath.h.html#LN23"><span class='Ref_to_Enum'>ForkNumber</span></a>  <span class='Declare_Local'>forkNum</span><span class='Delimiter'>; 
</span><a name="LN10461"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>reltoastidxids</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN10462"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Need lock here in case we are recursing to toast table or index 
     */ 
</span>    <a href="tablecmds.c.html#LN10451"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN84"><span class='Ref_to_Proto'>relation_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10449"><span class='Ref_to_Parameter'>tableOid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10449"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * No work if no change in tablespace. 
     */ 
</span>    <a href="tablecmds.c.html#LN10452"><span class='Ref_To_Local'>oldTableSpace</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN10451"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltablespace<span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10449"><span class='Ref_to_Parameter'>newTableSpace</span></a> <span class='Operator'>== </span><a href="tablecmds.c.html#LN10452"><span class='Ref_To_Local'>oldTableSpace</span></a> <span class='Operator'>|| 
</span>        <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10449"><span class='Ref_to_Parameter'>newTableSpace</span></a> <span class='Operator'>== </span><a href="../utils/init/globals.c.html#LN78"><span class='Ref_to_Global_Var'>MyDatabaseTableSpace</span></a> <span class='Operator'>&& </span><a href="tablecmds.c.html#LN10452"><span class='Ref_To_Local'>oldTableSpace</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10451"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10451"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We cannot support moving mapped relations into different tablespaces. 
     * (In particular this eliminates all shared catalogs.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN453"><span class='Ref_to_Macro'>RelationIsMapped</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10451"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot move system relation \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10451"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Can't move a non-shared relation into pg_global */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10449"><span class='Ref_to_Parameter'>newTableSpace</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_tablespace.h.html#LN63"><span class='Ref_to_Const'>GLOBALTABLESPACE_OID</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"only shared relations can be placed in pg_global tablespace"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Don't allow moving temp tables of other backends ... their local buffer 
     * manager is not going to cope. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN533"><span class='Ref_to_Macro'>RELATION_IS_OTHER_TEMP</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10451"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot move temporary tables of other sessions"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN10453"><span class='Ref_To_Local'>reltoastrelid</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN10451"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltoastrelid<span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Fetch the list of indexes on toast relation if necessary */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10453"><span class='Ref_To_Local'>reltoastrelid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN10512"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>toastRel</span> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN84"><span class='Ref_to_Proto'>relation_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10453"><span class='Ref_To_Local'>reltoastrelid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10449"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN10461"><span class='Ref_To_Local'>reltoastidxids</span></a> <span class='Operator'>= </span><a href="../../include/utils/relcache.h.html#LN40"><span class='Ref_to_Proto'>RelationGetIndexList</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10512"><span class='Ref_To_Local'>toastRel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10512"><span class='Ref_To_Local'>toastRel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10449"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Get a modifiable copy of the relation's pg_class row */ 
</span>    <a href="tablecmds.c.html#LN10457"><span class='Ref_To_Local'>pg_class</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN10458"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10449"><span class='Ref_to_Parameter'>tableOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10458"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for relation %u"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10449"><span class='Ref_to_Parameter'>tableOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN10459"><span class='Ref_To_Local'>rd_rel</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10458"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Since we copy the file directly without looking at the shared buffers, 
     * we'd better first flush out any pages of the source relation that are 
     * in shared buffers.  We assume no new changes will be made while we are 
     * holding exclusive lock on the rel. 
     */ 
</span>    <a href="../../include/storage/bufmgr.h.html#LN191"><span class='Ref_to_Proto'>FlushRelationBuffers</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10451"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Relfilenodes are not unique in databases across tablespaces, so we need 
     * to allocate a new one in the new tablespace. 
     */ 
</span>    <a href="tablecmds.c.html#LN10454"><span class='Ref_To_Local'>newrelfilenode</span></a> <span class='Operator'>= </span><a href="../../include/catalog/catalog.h.html#LN47"><span class='Ref_to_Proto'>GetNewRelFileNode</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10449"><span class='Ref_to_Parameter'>newTableSpace</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                       <a href="tablecmds.c.html#LN10451"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpersistence<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Open old and new relation */ 
</span>    <a href="tablecmds.c.html#LN10455"><span class='Ref_To_Local'>newrnode</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN10451"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN84"><span class='Ref_to_Member'>rd_node</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN10455"><span class='Ref_To_Local'>newrnode</span></a><span class='Operator'>.</span><a href="../../include/storage/relfilenode.h.html#LN60"><span class='Ref_to_Member'>relNode</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN10454"><span class='Ref_To_Local'>newrelfilenode</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN10455"><span class='Ref_To_Local'>newrnode</span></a><span class='Operator'>.</span><a href="../../include/storage/relfilenode.h.html#LN58"><span class='Ref_to_Member'>spcNode</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN10449"><span class='Ref_to_Parameter'>newTableSpace</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN10456"><span class='Ref_To_Local'>dstrel</span></a> <span class='Operator'>= </span><a href="../../include/storage/smgr.h.html#LN83"><span class='Ref_to_Proto'>smgropen</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10455"><span class='Ref_To_Local'>newrnode</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10451"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN88"><span class='Ref_to_Member'>rd_backend</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/rel.h.html#LN460"><span class='Ref_to_Macro'>RelationOpenSmgr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10451"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create and copy all forks of the relation, and schedule unlinking of 
     * old physical files. 
     * 
     * NOTE: any conflict in relfilenode value will be caught in 
     * RelationCreateStorage(). 
     */ 
</span>    <a href="../../include/catalog/storage.h.html#LN20"><span class='Ref_to_Proto'>RelationCreateStorage</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10455"><span class='Ref_To_Local'>newrnode</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10451"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpersistence<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* copy main fork */ 
</span>    <a href="tablecmds.c.html#LN459"><span class='Ref_to_Proto'>copy_relation_data</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10451"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN86"><span class='Ref_to_Member'>rd_smgr</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10456"><span class='Ref_To_Local'>dstrel</span></a><span class='Delimiter'>, </span><a href="../../include/common/relpath.h.html#LN26"><span class='Ref_to_EnumConst'>MAIN_FORKNUM</span></a><span class='Delimiter'>, 
</span>                       <a href="tablecmds.c.html#LN10451"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpersistence<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* copy those extra forks that exist */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10460"><span class='Ref_To_Local'>forkNum</span></a> <span class='Operator'>= </span><a href="../../include/common/relpath.h.html#LN26"><span class='Ref_to_EnumConst'>MAIN_FORKNUM</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN10460"><span class='Ref_To_Local'>forkNum</span></a> <span class='Operator'>&LT;= </span><a href="../../include/common/relpath.h.html#LN38"><span class='Ref_to_Const'>MAX_FORKNUM</span></a><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN10460"><span class='Ref_To_Local'>forkNum</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/storage/smgr.h.html#LN84"><span class='Ref_to_Proto'>smgrexists</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10451"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN86"><span class='Ref_to_Member'>rd_smgr</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10460"><span class='Ref_To_Local'>forkNum</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/storage/smgr.h.html#LN90"><span class='Ref_to_Proto'>smgrcreate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10456"><span class='Ref_To_Local'>dstrel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10460"><span class='Ref_To_Local'>forkNum</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * WAL log creation if the relation is persistent, or this is the 
             * init fork of an unlogged relation. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10451"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpersistence <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN169"><span class='Ref_to_Const'>RELPERSISTENCE_PERMANENT</span></a> <span class='Operator'>|| 
</span>                <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10451"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpersistence <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN170"><span class='Ref_to_Const'>RELPERSISTENCE_UNLOGGED</span></a> <span class='Operator'>&& 
</span>                 <a href="tablecmds.c.html#LN10460"><span class='Ref_To_Local'>forkNum</span></a> <span class='Operator'>== </span><a href="../../include/common/relpath.h.html#LN29"><span class='Ref_to_EnumConst'>INIT_FORKNUM</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/catalog/storage_xlog.h.html#LN52"><span class='Ref_to_Proto'>log_smgrcreate</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN10455"><span class='Ref_To_Local'>newrnode</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10460"><span class='Ref_To_Local'>forkNum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN459"><span class='Ref_to_Proto'>copy_relation_data</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10451"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN86"><span class='Ref_to_Member'>rd_smgr</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10456"><span class='Ref_To_Local'>dstrel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10460"><span class='Ref_To_Local'>forkNum</span></a><span class='Delimiter'>, 
</span>                               <a href="tablecmds.c.html#LN10451"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpersistence<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* drop old relation, and close new one */ 
</span>    <a href="../../include/catalog/storage.h.html#LN21"><span class='Ref_to_Proto'>RelationDropStorage</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10451"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/storage/smgr.h.html#LN87"><span class='Ref_to_Proto'>smgrclose</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10456"><span class='Ref_To_Local'>dstrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* update the pg_class row */ 
</span>    <a href="tablecmds.c.html#LN10459"><span class='Ref_To_Local'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltablespace <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10449"><span class='Ref_to_Parameter'>newTableSpace</span></a> <span class='Operator'>== </span><a href="../utils/init/globals.c.html#LN78"><span class='Ref_to_Global_Var'>MyDatabaseTableSpace</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a> <span class='Operator'>: </span><a href="tablecmds.c.html#LN10449"><span class='Ref_to_Parameter'>newTableSpace</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN10459"><span class='Ref_To_Local'>rd_rel</span></a><span class='Operator'>-&GT;</span>relfilenode <span class='Operator'>= </span><a href="tablecmds.c.html#LN10454"><span class='Ref_To_Local'>newrelfilenode</span></a><span class='Delimiter'>; 
</span>    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10457"><span class='Ref_To_Local'>pg_class</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN10458"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10458"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10451"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10458"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10457"><span class='Ref_To_Local'>pg_class</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10451"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make sure the reltablespace change is visible */ 
</span>    <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Move associated toast relation and/or indexes, too */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10453"><span class='Ref_To_Local'>reltoastrelid</span></a><span class='Parentheses'>))</span> 
        <a href="tablecmds.c.html#LN10606"><span class='Ref_To_Local'>ATExecSetTableSpace</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10453"><span class='Ref_To_Local'>reltoastrelid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10449"><span class='Ref_to_Parameter'>newTableSpace</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10449"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10462"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10461"><span class='Ref_To_Local'>reltoastidxids</span></a><span class='Parentheses'>) 
</span><a name="LN10606"></a>        <span class='Declare_Local'>ATExecSetTableSpace</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10462"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10449"><span class='Ref_to_Parameter'>newTableSpace</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10449"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Clean up */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10461"><span class='Ref_To_Local'>reltoastidxids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATExecSetTableSpace &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Alter Table ALL ... SET TABLESPACE 
 * 
 * Allows a user to move all objects of some type in a given tablespace in the 
 * current database to another tablespace.  Objects can be chosen based on the 
 * owner of the object also, to allow users to move only their objects. 
 * The user must have CREATE rights on the new tablespace, as usual.   The main 
 * permissions handling is done by the lower-level table move function. 
 * 
 * All to-be-moved objects are locked first. If NOWAIT is specified and the 
 * lock can't be acquired then we ereport(ERROR). 
 */ 
</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN10625"></a><span class='Declare_Function'>AlterTableMoveAll</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2125"><span class='Ref_to_Struct'>AlterTableMoveAllStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN10627"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>relations</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN10628"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span><a name="LN10629"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN10630"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN10631"></a>    <a href="../../include/access/heapam.h.html#LN99"><span class='Ref_to_Typedef'>HeapScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN10632"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN10633"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>orig_tablespaceoid</span><span class='Delimiter'>; 
</span><a name="LN10634"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>new_tablespaceoid</span><span class='Delimiter'>; 
</span><a name="LN10635"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>role_oids</span> <span class='Operator'>= </span><a href="../../include/commands/user.h.html#LN34"><span class='Ref_to_Proto'>roleSpecsToIds</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10625"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2130"><span class='Ref_to_Member'>roles</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Ensure we were not asked to move something we can't */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10625"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2129"><span class='Ref_to_Member'>objtype</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/parsenodes.h.html#LN1622"><span class='Ref_to_EnumConst'>OBJECT_TABLE</span></a> <span class='Operator'>&& </span><a href="tablecmds.c.html#LN10625"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2129"><span class='Ref_to_Member'>objtype</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/parsenodes.h.html#LN1605"><span class='Ref_to_EnumConst'>OBJECT_INDEX</span></a> <span class='Operator'>&& 
</span>        <a href="tablecmds.c.html#LN10625"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2129"><span class='Ref_to_Member'>objtype</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/parsenodes.h.html#LN1608"><span class='Ref_to_EnumConst'>OBJECT_MATVIEW</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"only tables, indexes, and materialized views exist in tablespaces"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get the orig and new tablespace OIDs */ 
</span>    <a href="tablecmds.c.html#LN10633"><span class='Ref_To_Local'>orig_tablespaceoid</span></a> <span class='Operator'>= </span><a href="../../include/commands/tablespace.h.html#LN55"><span class='Ref_to_Proto'>get_tablespace_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10625"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2128"><span class='Ref_to_Member'>orig_tablespacename</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN10634"><span class='Ref_To_Local'>new_tablespaceoid</span></a> <span class='Operator'>= </span><a href="../../include/commands/tablespace.h.html#LN55"><span class='Ref_to_Proto'>get_tablespace_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10625"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2131"><span class='Ref_to_Member'>new_tablespacename</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Can't move shared relations in to or out of pg_global */ 
</span>    <span class='Comment_Multi_Line'>/* This is also checked by ATExecSetTableSpace, but nice to stop earlier */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10633"><span class='Ref_To_Local'>orig_tablespaceoid</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_tablespace.h.html#LN63"><span class='Ref_to_Const'>GLOBALTABLESPACE_OID</span></a> <span class='Operator'>|| 
</span>        <a href="tablecmds.c.html#LN10634"><span class='Ref_To_Local'>new_tablespaceoid</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_tablespace.h.html#LN63"><span class='Ref_to_Const'>GLOBALTABLESPACE_OID</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot move relations in to or out of pg_global tablespace"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Must have CREATE rights on the new tablespace, unless it is the 
     * database default tablespace (which all users implicitly have CREATE 
     * rights on). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10634"><span class='Ref_To_Local'>new_tablespaceoid</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="tablecmds.c.html#LN10634"><span class='Ref_To_Local'>new_tablespaceoid</span></a> <span class='Operator'>!= </span><a href="../utils/init/globals.c.html#LN78"><span class='Ref_to_Global_Var'>MyDatabaseTableSpace</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN10663"></a>        <a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN10663"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN290"><span class='Ref_to_Proto'>pg_tablespace_aclcheck</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10634"><span class='Ref_To_Local'>new_tablespaceoid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                                           <a href="../../include/nodes/parsenodes.h.html#LN81"><span class='Ref_to_Const'>ACL_CREATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10663"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10663"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN195"><span class='Ref_to_EnumConst'>ACL_KIND_TABLESPACE</span></a><span class='Delimiter'>, 
</span>                           <a href="../../include/commands/tablespace.h.html#LN56"><span class='Ref_to_Proto'>get_tablespace_name</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10634"><span class='Ref_To_Local'>new_tablespaceoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now that the checks are done, check if we should set either to 
     * InvalidOid because it is our database's default tablespace. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10633"><span class='Ref_To_Local'>orig_tablespaceoid</span></a> <span class='Operator'>== </span><a href="../utils/init/globals.c.html#LN78"><span class='Ref_to_Global_Var'>MyDatabaseTableSpace</span></a><span class='Parentheses'>) 
</span>        <a href="tablecmds.c.html#LN10633"><span class='Ref_To_Local'>orig_tablespaceoid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10634"><span class='Ref_To_Local'>new_tablespaceoid</span></a> <span class='Operator'>== </span><a href="../utils/init/globals.c.html#LN78"><span class='Ref_to_Global_Var'>MyDatabaseTableSpace</span></a><span class='Parentheses'>) 
</span>        <a href="tablecmds.c.html#LN10634"><span class='Ref_To_Local'>new_tablespaceoid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* no-op */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10633"><span class='Ref_To_Local'>orig_tablespaceoid</span></a> <span class='Operator'>== </span><a href="tablecmds.c.html#LN10634"><span class='Ref_To_Local'>new_tablespaceoid</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="tablecmds.c.html#LN10634"><span class='Ref_To_Local'>new_tablespaceoid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Walk the list of objects in the tablespace and move them. This will 
     * only find objects in our database, of course. 
     */ 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN10629"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_class.h.html#LN109"><span class='Ref_to_Const'>Anum_pg_class_reltablespace</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10633"><span class='Ref_To_Local'>orig_tablespaceoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN10630"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN10631"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN110"><span class='Ref_to_Proto'>heap_beginscan_catalog</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10630"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10629"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="tablecmds.c.html#LN10632"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN127"><span class='Ref_to_Proto'>heap_getnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10631"><span class='Ref_To_Local'>scan</span></a><span class='Delimiter'>, </span><a href="../../include/access/sdir.h.html#LN25"><span class='Ref_to_EnumConst'>ForwardScanDirection</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN10699"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relOid</span> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10632"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN10700"></a>        <a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Local'>relForm</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN10700"><span class='Ref_To_Local'>relForm</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10632"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Do not move objects in pg_catalog as part of this, if an admin 
         * really wishes to do so, they can issue the individual ALTER 
         * commands directly. 
         * 
         * Also, explicitly avoid any shared tables, temp tables, or TOAST 
         * (TOAST will be moved with the main table). 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/catalog.h.html#LN37"><span class='Ref_to_Proto'>IsSystemNamespace</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10700"><span class='Ref_To_Local'>relForm</span></a><span class='Operator'>-&GT;</span>relnamespace<span class='Parentheses'>) </span><span class='Operator'>|| </span><a href="tablecmds.c.html#LN10700"><span class='Ref_To_Local'>relForm</span></a><span class='Operator'>-&GT;</span>relisshared <span class='Operator'>|| 
</span>            <a href="../../include/catalog/namespace.h.html#LN126"><span class='Ref_to_Proto'>isAnyTempNamespace</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10700"><span class='Ref_To_Local'>relForm</span></a><span class='Operator'>-&GT;</span>relnamespace<span class='Parentheses'>) </span><span class='Operator'>|| 
</span>            <a href="tablecmds.c.html#LN10700"><span class='Ref_To_Local'>relForm</span></a><span class='Operator'>-&GT;</span>relnamespace <span class='Operator'>== </span><a href="../../include/catalog/pg_namespace.h.html#LN73"><span class='Ref_to_Const'>PG_TOAST_NAMESPACE</span></a><span class='Parentheses'>)</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Only move the object type requested */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="tablecmds.c.html#LN10625"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2129"><span class='Ref_to_Member'>objtype</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN1622"><span class='Ref_to_EnumConst'>OBJECT_TABLE</span></a> <span class='Operator'>&& 
</span>             <a href="tablecmds.c.html#LN10700"><span class='Ref_To_Local'>relForm</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a> <span class='Operator'>&& 
</span>             <a href="tablecmds.c.html#LN10700"><span class='Ref_To_Local'>relForm</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>            <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10625"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2129"><span class='Ref_to_Member'>objtype</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN1605"><span class='Ref_to_EnumConst'>OBJECT_INDEX</span></a> <span class='Operator'>&& 
</span>             <a href="tablecmds.c.html#LN10700"><span class='Ref_To_Local'>relForm</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN160"><span class='Ref_to_Const'>RELKIND_INDEX</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>            <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10625"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2129"><span class='Ref_to_Member'>objtype</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN1608"><span class='Ref_to_EnumConst'>OBJECT_MATVIEW</span></a> <span class='Operator'>&& 
</span>             <a href="tablecmds.c.html#LN10700"><span class='Ref_To_Local'>relForm</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Check if we are only moving objects owned by certain roles */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10635"><span class='Ref_To_Local'>role_oids</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>&& !</span><a href="../../include/nodes/pg_list.h.html#LN231"><span class='Ref_to_Proto'>list_member_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10635"><span class='Ref_To_Local'>role_oids</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10700"><span class='Ref_To_Local'>relForm</span></a><span class='Operator'>-&GT;</span>relowner<span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Handle permissions-checking here since we are locking the tables 
         * and also to avoid doing a bunch of work only to fail part-way. Note 
         * that permissions will also be checked by AlterTableInternal(). 
         * 
         * Caller must be considered an owner on the table to move it. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN308"><span class='Ref_to_Proto'>pg_class_ownercheck</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10699"><span class='Ref_To_Local'>relOid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
            <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN181"><span class='Ref_to_EnumConst'>ACL_KIND_CLASS</span></a><span class='Delimiter'>, 
</span>                           <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10700"><span class='Ref_To_Local'>relForm</span></a><span class='Operator'>-&GT;</span>relname<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10625"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2132"><span class='Ref_to_Member'>nowait</span></a> <span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="../../include/storage/lmgr.h.html#LN40"><span class='Ref_to_Proto'>ConditionalLockRelationOid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10699"><span class='Ref_To_Local'>relOid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_IN_USE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"aborting because lock on relation \"%s.%s\" is not available"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10700"><span class='Ref_To_Local'>relForm</span></a><span class='Operator'>-&GT;</span>relnamespace<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10700"><span class='Ref_To_Local'>relForm</span></a><span class='Operator'>-&GT;</span>relname<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../include/storage/lmgr.h.html#LN39"><span class='Ref_to_Proto'>LockRelationOid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10699"><span class='Ref_To_Local'>relOid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Add to our list of objects to move */ 
</span>        <a href="tablecmds.c.html#LN10627"><span class='Ref_To_Local'>relations</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10627"><span class='Ref_To_Local'>relations</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10699"><span class='Ref_To_Local'>relOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (tuple=heap_getnext(s... &raquo; </span> 
 
    <a href="../../include/access/heapam.h.html#LN126"><span class='Ref_to_Proto'>heap_endscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10631"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10630"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10627"><span class='Ref_To_Local'>relations</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NO_DATA_FOUND<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"no matching relations in tablespace \"%s\" found"</span><span class='Delimiter'>, 
</span>                    <a href="tablecmds.c.html#LN10633"><span class='Ref_To_Local'>orig_tablespaceoid</span></a> <span class='Operator'>== </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a> <span class='Operator'>? </span><span class='String'>"(database default)"</span> <span class='Operator'>: 
</span>                        <a href="../../include/commands/tablespace.h.html#LN56"><span class='Ref_to_Proto'>get_tablespace_name</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10633"><span class='Ref_To_Local'>orig_tablespaceoid</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Everything is locked, loop through and move all of the relations. */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10628"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10627"><span class='Ref_To_Local'>relations</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN10769"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>cmds</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN10770"></a>        <a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cmd</span> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN10770"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1752"><span class='Ref_to_Member'>subtype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN1709"><span class='Ref_to_EnumConst'>AT_SetTableSpace</span></a><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN10770"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1753"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN10625"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2131"><span class='Ref_to_Member'>new_tablespacename</span></a><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN10769"><span class='Ref_To_Local'>cmds</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10769"><span class='Ref_To_Local'>cmds</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10770"><span class='Ref_To_Local'>cmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/commands/event_trigger.h.html#LN71"><span class='Ref_to_Proto'>EventTriggerAlterTableStart</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN10625"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* OID is set by AlterTableInternal */ 
</span>        <a href="../../include/commands/tablecmds.h.html#LN37"><span class='Ref_to_Proto'>AlterTableInternal</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10628"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10769"><span class='Ref_To_Local'>cmds</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/commands/event_trigger.h.html#LN75"><span class='Ref_to_Proto'>EventTriggerAlterTableEnd</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN10634"><span class='Ref_To_Local'>new_tablespaceoid</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterTableMoveAll &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Copy data, block by block 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN10790"></a><span class='Declare_Function'>copy_relation_data</span><span class='Parentheses'>(</span><a href="../../include/storage/smgr.h.html#LN77"><span class='Ref_to_Typedef'>SMgrRelation</span></a> <span class='Declare_Parameter'>src</span><span class='Delimiter'>, </span><a href="../../include/storage/smgr.h.html#LN77"><span class='Ref_to_Typedef'>SMgrRelation</span></a> <span class='Declare_Parameter'>dst</span><span class='Delimiter'>, 
</span><a name="LN10791"></a>                   <a href="../../include/common/relpath.h.html#LN23"><span class='Ref_to_Enum'>ForkNumber</span></a> <span class='Declare_Parameter'>forkNum</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>relpersistence</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN10793"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN10794"></a>    <a href="../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span><a name="LN10795"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>use_wal</span><span class='Delimiter'>; 
</span><a name="LN10796"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>copying_initfork</span><span class='Delimiter'>; 
</span><a name="LN10797"></a>    <a href="../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Local'>nblocks</span><span class='Delimiter'>; 
</span><a name="LN10798"></a>    <a href="../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Local'>blkno</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * palloc the buffer so that it's MAXALIGN'd.  If it were just a local 
     * char[] array, the compiler might align it on any byte boundary, which 
     * can seriously hurt transfer speed to and from the kernel; not to 
     * mention possibly making log_newpage's accesses to the page header fail. 
     */ 
</span>    <a href="tablecmds.c.html#LN10793"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span>BLCKSZ<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN10794"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN10793"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The init fork for an unlogged relation in many respects has to be 
     * treated the same as normal relation, changes need to be WAL logged and 
     * it needs to be synced to disk. 
     */ 
</span>    <a href="tablecmds.c.html#LN10796"><span class='Ref_To_Local'>copying_initfork</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN10791"><span class='Ref_to_Parameter'>relpersistence</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN170"><span class='Ref_to_Const'>RELPERSISTENCE_UNLOGGED</span></a> <span class='Operator'>&& 
</span>        <a href="tablecmds.c.html#LN10791"><span class='Ref_to_Parameter'>forkNum</span></a> <span class='Operator'>== </span><a href="../../include/common/relpath.h.html#LN29"><span class='Ref_to_EnumConst'>INIT_FORKNUM</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We need to log the copied data in WAL iff WAL archiving/streaming is 
     * enabled AND it's a permanent relation. 
     */ 
</span>    <a href="tablecmds.c.html#LN10795"><span class='Ref_To_Local'>use_wal</span></a> <span class='Operator'>= </span><a href="../../include/access/xlog.h.html#LN144"><span class='Ref_to_Macro'>XLogIsNeeded</span></a><span class='Parentheses'>() </span><span class='Operator'>&& 
</span>        <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10791"><span class='Ref_to_Parameter'>relpersistence</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN169"><span class='Ref_to_Const'>RELPERSISTENCE_PERMANENT</span></a> <span class='Operator'>|| </span><a href="tablecmds.c.html#LN10796"><span class='Ref_To_Local'>copying_initfork</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN10797"><span class='Ref_To_Local'>nblocks</span></a> <span class='Operator'>= </span><a href="../../include/storage/smgr.h.html#LN104"><span class='Ref_to_Proto'>smgrnblocks</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10790"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10791"><span class='Ref_to_Parameter'>forkNum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10798"><span class='Ref_To_Local'>blkno</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN10798"><span class='Ref_To_Local'>blkno</span></a> <span class='Operator'>&LT; </span><a href="tablecmds.c.html#LN10797"><span class='Ref_To_Local'>nblocks</span></a><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN10798"><span class='Ref_To_Local'>blkno</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* If we got a cancel signal during the copy of the data, quit */ 
</span>        <a href="../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/storage/smgr.h.html#LN98"><span class='Ref_to_Proto'>smgrread</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10790"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10791"><span class='Ref_to_Parameter'>forkNum</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10798"><span class='Ref_To_Local'>blkno</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10793"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../storage/page/bufpage.c.html#LN79"><span class='Ref_to_Func'>PageIsVerified</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10794"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10798"><span class='Ref_To_Local'>blkno</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATA_CORRUPTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid page in block %u of relation %s"</span><span class='Delimiter'>, 
</span>                            <a href="tablecmds.c.html#LN10798"><span class='Ref_To_Local'>blkno</span></a><span class='Delimiter'>, 
</span>                            <a href="../../include/common/relpath.h.html#LN61"><span class='Ref_to_Macro'>relpathbackend</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10790"><span class='Ref_to_Parameter'>src</span></a><span class='Operator'>-&GT;</span><a href="../../include/storage/smgr.h.html#LN42"><span class='Ref_to_Member'>smgr_rnode</span></a><span class='Operator'>.</span><a href="../../include/storage/relfilenode.h.html#LN73"><span class='Ref_to_Member'>node</span></a><span class='Delimiter'>, 
</span>                                           <a href="tablecmds.c.html#LN10790"><span class='Ref_to_Parameter'>src</span></a><span class='Operator'>-&GT;</span><a href="../../include/storage/smgr.h.html#LN42"><span class='Ref_to_Member'>smgr_rnode</span></a><span class='Operator'>.</span><a href="../../include/storage/relfilenode.h.html#LN74"><span class='Ref_to_Member'>backend</span></a><span class='Delimiter'>, 
</span>                                           <a href="tablecmds.c.html#LN10791"><span class='Ref_to_Parameter'>forkNum</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * WAL-log the copied page. Unfortunately we don't know what kind of a 
         * page this is, so we have to log the full page including any unused 
         * space. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10795"><span class='Ref_To_Local'>use_wal</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/access/xloginsert.h.html#LN54"><span class='Ref_to_Proto'>log_newpage</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN10790"><span class='Ref_to_Parameter'>dst</span></a><span class='Operator'>-&GT;</span><a href="../../include/storage/smgr.h.html#LN42"><span class='Ref_to_Member'>smgr_rnode</span></a><span class='Operator'>.</span><a href="../../include/storage/relfilenode.h.html#LN73"><span class='Ref_to_Member'>node</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10791"><span class='Ref_to_Parameter'>forkNum</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10798"><span class='Ref_To_Local'>blkno</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10794"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/storage/bufpage.h.html#LN436"><span class='Ref_to_Proto'>PageSetChecksumInplace</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10794"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10798"><span class='Ref_To_Local'>blkno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Now write the page.  We say isTemp = true even if it's not a temp 
         * rel, because there's no need for smgr to schedule an fsync for this 
         * write; we'll do it ourselves below. 
         */ 
</span>        <a href="../../include/storage/smgr.h.html#LN94"><span class='Ref_to_Proto'>smgrextend</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10790"><span class='Ref_to_Parameter'>dst</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10791"><span class='Ref_to_Parameter'>forkNum</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10798"><span class='Ref_To_Local'>blkno</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10793"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for blkno=0;blkno&LT;nblocks... &raquo; </span> 
 
    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10793"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the rel is WAL-logged, must fsync before commit.  We use heap_sync 
     * to ensure that the toast table gets fsync'd too.  (For a temp or 
     * unlogged rel we don't care since the data will be gone after a crash 
     * anyway.) 
     * 
     * It's obvious that we must do this when not WAL-logging the copy. It's 
     * less obvious that we have to do it even if we did WAL-log the copied 
     * pages. The reason is that since we're copying outside shared buffers, a 
     * CHECKPOINT occurring during the copy has no way to flush the previously 
     * written data to disk (indeed it won't know the new rel even exists).  A 
     * crash later on would replay WAL from the checkpoint, therefore it 
     * wouldn't replay our earlier WAL entries. If we do not fsync those pages 
     * here, they might still not be on disk when the crash occurs. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10791"><span class='Ref_to_Parameter'>relpersistence</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN169"><span class='Ref_to_Const'>RELPERSISTENCE_PERMANENT</span></a> <span class='Operator'>|| </span><a href="tablecmds.c.html#LN10796"><span class='Ref_To_Local'>copying_initfork</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/storage/smgr.h.html#LN107"><span class='Ref_to_Proto'>smgrimmedsync</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10790"><span class='Ref_to_Parameter'>dst</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10791"><span class='Ref_to_Parameter'>forkNum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end copy_relation_data &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ALTER TABLE ENABLE/DISABLE TRIGGER 
 * 
 * We just pass this off to trigger.c. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN10887"></a><span class='Declare_Function'>ATExecEnableDisableTrigger</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>trigname</span><span class='Delimiter'>, 
</span><a name="LN10888"></a>                        <span class='Keyword'>char </span><span class='Declare_Parameter'>fires_when</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>skip_system</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../include/commands/trigger.h.html#LN122"><span class='Ref_to_Proto'>EnableDisableTrigger</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10887"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10887"><span class='Ref_to_Parameter'>trigname</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10888"><span class='Ref_to_Parameter'>fires_when</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10888"><span class='Ref_to_Parameter'>skip_system</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * ALTER TABLE ENABLE/DISABLE RULE 
 * 
 * We just pass this off to rewriteDefine.c. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN10899"></a><span class='Declare_Function'>ATExecEnableDisableRule</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>rulename</span><span class='Delimiter'>, 
</span><a name="LN10900"></a>                        <span class='Keyword'>char </span><span class='Declare_Parameter'>fires_when</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../include/rewrite/rewriteDefine.h.html#LN40"><span class='Ref_to_Proto'>EnableDisableRule</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10899"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10899"><span class='Ref_to_Parameter'>rulename</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10900"><span class='Ref_to_Parameter'>fires_when</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * ALTER TABLE INHERIT 
 * 
 * Add a parent to the child's parents. This verifies that all the columns and 
 * check constraints of the parent appear in the child and that they have the 
 * same data types and expressions. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN10913"></a><span class='Declare_Function'>ATPrepAddInherit</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>child_rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10913"><span class='Ref_to_Parameter'>child_rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reloftype<span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot change inheritance of typed table"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10913"><span class='Ref_to_Parameter'>child_rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relispartition<span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot change inheritance of a partition"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10913"><span class='Ref_to_Parameter'>child_rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot change inheritance of partitioned table"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Return the address of the new parent relation. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN10935"></a><span class='Declare_Function'>ATExecAddInherit</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>child_rel</span><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parent</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN10937"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>parent_rel</span><span class='Delimiter'>; 
</span><a name="LN10938"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>children</span><span class='Delimiter'>; 
</span><a name="LN10939"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * A self-exclusive lock is needed here.  See the similar case in 
     * MergeAttributes() for a full explanation. 
     */ 
</span>    <a href="tablecmds.c.html#LN10937"><span class='Ref_To_Local'>parent_rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN92"><span class='Ref_to_Proto'>heap_openrv</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10935"><span class='Ref_to_Parameter'>parent</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN38"><span class='Ref_to_Const'>ShareUpdateExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Must be owner of both parent and child -- child was checked by 
     * ATSimplePermissions call in ATPrepCmd 
     */ 
</span>    <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10937"><span class='Ref_To_Local'>parent_rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN283"><span class='Ref_to_Const'>ATT_FOREIGN_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Permanent rels cannot inherit from temporary ones */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10937"><span class='Ref_To_Local'>parent_rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpersistence <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN171"><span class='Ref_to_Const'>RELPERSISTENCE_TEMP</span></a> <span class='Operator'>&& 
</span>        <a href="tablecmds.c.html#LN10935"><span class='Ref_to_Parameter'>child_rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpersistence <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN171"><span class='Ref_to_Const'>RELPERSISTENCE_TEMP</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot inherit from temporary relation \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10937"><span class='Ref_To_Local'>parent_rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If parent rel is temp, it must belong to this session */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10937"><span class='Ref_To_Local'>parent_rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpersistence <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN171"><span class='Ref_to_Const'>RELPERSISTENCE_TEMP</span></a> <span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="tablecmds.c.html#LN10937"><span class='Ref_To_Local'>parent_rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN89"><span class='Ref_to_Member'>rd_islocaltemp</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot inherit from temporary relation of another session"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Ditto for the child */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10935"><span class='Ref_to_Parameter'>child_rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpersistence <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN171"><span class='Ref_to_Const'>RELPERSISTENCE_TEMP</span></a> <span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="tablecmds.c.html#LN10935"><span class='Ref_to_Parameter'>child_rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN89"><span class='Ref_to_Member'>rd_islocaltemp</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot inherit to temporary relation of another session"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Prevent partitioned tables from becoming inheritance parents */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10937"><span class='Ref_To_Local'>parent_rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot inherit from partitioned table \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN10935"><span class='Ref_to_Parameter'>parent</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Likewise for partitions */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10937"><span class='Ref_To_Local'>parent_rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relispartition<span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot inherit from a partition"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Prevent circularity by seeing if proposed parent inherits from child. 
     * (In particular, this disallows making a rel inherit from itself.) 
     * 
     * This is not completely bulletproof because of race conditions: in 
     * multi-level inheritance trees, someone else could concurrently be 
     * making another inheritance link that closes the loop but does not join 
     * either of the rels we have locked.  Preventing that seems to require 
     * exclusive locks on the entire inheritance tree, which is a cure worse 
     * than the disease.  find_all_inheritors() will cope with circularity 
     * anyway, so don't sweat it too much. 
     * 
     * We use weakest lock we can on child's children, namely AccessShareLock. 
     */ 
</span>    <a href="tablecmds.c.html#LN10938"><span class='Ref_To_Local'>children</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_inherits_fn.h.html#LN20"><span class='Ref_to_Proto'>find_all_inheritors</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10935"><span class='Ref_to_Parameter'>child_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN231"><span class='Ref_to_Proto'>list_member_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10938"><span class='Ref_To_Local'>children</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10937"><span class='Ref_To_Local'>parent_rel</span></a><span class='Parentheses'>)))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DUPLICATE_TABLE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"circular inheritance not allowed"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is already a child of \"%s\"."</span><span class='Delimiter'>, 
</span>                           <a href="tablecmds.c.html#LN10935"><span class='Ref_to_Parameter'>parent</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Delimiter'>, 
</span>                           <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10935"><span class='Ref_to_Parameter'>child_rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If parent has OIDs then child must have OIDs */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10937"><span class='Ref_To_Local'>parent_rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relhasoids <span class='Operator'>&& !</span><a href="tablecmds.c.html#LN10935"><span class='Ref_to_Parameter'>child_rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relhasoids<span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"table \"%s\" without OIDs cannot inherit from table \"%s\" with OIDs"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10935"><span class='Ref_to_Parameter'>child_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10937"><span class='Ref_To_Local'>parent_rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* OK to create inheritance */ 
</span>    <a href="tablecmds.c.html#LN471"><span class='Ref_to_Proto'>CreateInheritance</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10935"><span class='Ref_to_Parameter'>child_rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN10937"><span class='Ref_To_Local'>parent_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10939"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, 
</span>                     <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10937"><span class='Ref_To_Local'>parent_rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* keep our lock on the parent relation until commit */ 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN10937"><span class='Ref_To_Local'>parent_rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN10939"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATExecAddInherit &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * CreateInheritance 
 *      Catalog manipulation portion of creating inheritance between a child 
 *      table and a parent table. 
 * 
 * Common to ATExecAddInherit() and ATExecAttachPartition(). 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN11041"></a><span class='Declare_Function'>CreateInheritance</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>child_rel</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>parent_rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN11043"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>catalogRelation</span><span class='Delimiter'>; 
</span><a name="LN11044"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN11045"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>; 
</span><a name="LN11046"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>inheritsTuple</span><span class='Delimiter'>; 
</span><a name="LN11047"></a>    <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>inhseqno</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Note: get RowExclusiveLock because we will write pg_inherits below. */ 
</span>    <a href="tablecmds.c.html#LN11043"><span class='Ref_To_Local'>catalogRelation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_inherits.h.html#LN28"><span class='Ref_to_Const'>InheritsRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check for duplicates in the list of parents, and determine the highest 
     * inhseqno already present; we'll use the next one for the new parent. 
     * Also, if proposed child is a partition, it cannot already be 
     * inheriting. 
     * 
     * Note: we do not reject the case where the child already inherits from 
     * the parent indirectly; CREATE TABLE doesn't reject comparable cases. 
     */ 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN11045"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/catalog/pg_inherits.h.html#LN49"><span class='Ref_to_Const'>Anum_pg_inherits_inhrelid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11041"><span class='Ref_to_Parameter'>child_rel</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN11044"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11043"><span class='Ref_To_Local'>catalogRelation</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN166"><span class='Ref_to_Const'>InheritsRelidSeqnoIndexId</span></a><span class='Delimiter'>, 
</span>                              <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN11045"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* inhseqno sequences start at 1 */ 
</span>    <a href="tablecmds.c.html#LN11047"><span class='Ref_To_Local'>inhseqno</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11046"><span class='Ref_To_Local'>inheritsTuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11044"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN11072"></a>        <a href="../../include/catalog/pg_inherits.h.html#LN42"><span class='Ref_to_Typedef'>Form_pg_inherits</span></a> <span class='Declare_Local'>inh</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_inherits.h.html#LN42"><span class='Ref_to_Typedef'>Form_pg_inherits</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11046"><span class='Ref_To_Local'>inheritsTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11072"><span class='Ref_To_Local'>inh</span></a><span class='Operator'>-&GT;</span>inhparent <span class='Operator'>== </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11041"><span class='Ref_to_Parameter'>parent_rel</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DUPLICATE_TABLE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"relation \"%s\" would be inherited from more than once"</span><span class='Delimiter'>, 
</span>                    <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11041"><span class='Ref_to_Parameter'>parent_rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11072"><span class='Ref_To_Local'>inh</span></a><span class='Operator'>-&GT;</span>inhseqno <span class='Operator'>&GT; </span><a href="tablecmds.c.html#LN11047"><span class='Ref_To_Local'>inhseqno</span></a><span class='Parentheses'>) 
</span>            <a href="tablecmds.c.html#LN11047"><span class='Ref_To_Local'>inhseqno</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN11072"><span class='Ref_To_Local'>inh</span></a><span class='Operator'>-&GT;</span>inhseqno<span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11044"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Match up the columns and bump attinhcount as needed */ 
</span>    <a href="tablecmds.c.html#LN298"><span class='Ref_to_Proto'>MergeAttributesIntoExisting</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11041"><span class='Ref_to_Parameter'>child_rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11041"><span class='Ref_to_Parameter'>parent_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Match up the constraints and bump coninhcount as needed */ 
</span>    <a href="tablecmds.c.html#LN299"><span class='Ref_to_Proto'>MergeConstraintsIntoExisting</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11041"><span class='Ref_to_Parameter'>child_rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11041"><span class='Ref_to_Parameter'>parent_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * OK, it looks valid.  Make the catalog entries that show inheritance. 
     */ 
</span>    <a href="tablecmds.c.html#LN302"><span class='Ref_to_Proto'>StoreCatalogInheritance1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11041"><span class='Ref_to_Parameter'>child_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11041"><span class='Ref_to_Parameter'>parent_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="tablecmds.c.html#LN11047"><span class='Ref_To_Local'>inhseqno</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                             <a href="tablecmds.c.html#LN11043"><span class='Ref_To_Local'>catalogRelation</span></a><span class='Delimiter'>, 
</span>                             <a href="tablecmds.c.html#LN11041"><span class='Ref_to_Parameter'>parent_rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== 
</span>                             <a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Now we're done with pg_inherits */ 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11043"><span class='Ref_To_Local'>catalogRelation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CreateInheritance &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Obtain the source-text form of the constraint expression for a check 
 * constraint, given its pg_constraint tuple 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN11110"></a><span class='Declare_Function'>decompile_conbin</span><span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>contup</span><span class='Delimiter'>, </span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupdesc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN11112"></a>    <a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a> <span class='Declare_Local'>con</span><span class='Delimiter'>; 
</span><a name="LN11113"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN11114"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>attr</span><span class='Delimiter'>; 
</span><a name="LN11115"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>expr</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN11112"><span class='Ref_To_Local'>con</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11110"><span class='Ref_to_Parameter'>contup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN11114"><span class='Ref_To_Local'>attr</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN768"><span class='Ref_to_Macro'>heap_getattr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11110"><span class='Ref_to_Parameter'>contup</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_constraint.h.html#LN175"><span class='Ref_to_Const'>Anum_pg_constraint_conbin</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11110"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN11113"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11113"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"null conbin for constraint %u"</span><span class='Delimiter'>, </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11110"><span class='Ref_to_Parameter'>contup</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN11115"><span class='Ref_To_Local'>expr</span></a> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="../utils/adt/ruleutils.c.html#LN2194"><span class='Ref_to_Func'>pg_get_expr</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11114"><span class='Ref_To_Local'>attr</span></a><span class='Delimiter'>, 
</span>                               <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11112"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>conrelid<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11115"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Determine whether two check constraints are functionally equivalent 
 * 
 * The test we apply is to see whether they reverse-compile to the same 
 * source string.  This insulates us from issues like whether attributes 
 * have the same physical column numbers in parent and child relations. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN11135"></a><span class='Declare_Function'>constraints_equivalent</span><span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>b</span><span class='Delimiter'>, </span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupleDesc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN11137"></a>    <a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a> <span class='Declare_Local'>acon</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11135"><span class='Ref_to_Parameter'>a</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN11138"></a>    <a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a> <span class='Declare_Local'>bcon</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11135"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11137"><span class='Ref_To_Local'>acon</span></a><span class='Operator'>-&GT;</span>condeferrable <span class='Operator'>!= </span><a href="tablecmds.c.html#LN11138"><span class='Ref_To_Local'>bcon</span></a><span class='Operator'>-&GT;</span>condeferrable <span class='Operator'>|| 
</span>        <a href="tablecmds.c.html#LN11137"><span class='Ref_To_Local'>acon</span></a><span class='Operator'>-&GT;</span>condeferred <span class='Operator'>!= </span><a href="tablecmds.c.html#LN11138"><span class='Ref_To_Local'>bcon</span></a><span class='Operator'>-&GT;</span>condeferred <span class='Operator'>|| 
</span>        strcmp<span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11109"><span class='Ref_to_Func'>decompile_conbin</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11135"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11135"><span class='Ref_to_Parameter'>tupleDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="tablecmds.c.html#LN11109"><span class='Ref_to_Func'>decompile_conbin</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11135"><span class='Ref_to_Parameter'>b</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11135"><span class='Ref_to_Parameter'>tupleDesc</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Check columns in child table match up with columns in parent, and increment 
 * their attinhcount. 
 * 
 * Called by CreateInheritance 
 * 
 * Currently all parent columns must be found in child. Missing columns are an 
 * error.  One day we might consider creating new columns like CREATE TABLE 
 * does.  However, that is widely unpopular --- in the common use case of 
 * partitioned tables it's a foot-gun. 
 * 
 * The data type must match exactly. If the parent column is NOT NULL then 
 * the child must be as well. Defaults are not compared, however. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN11164"></a><span class='Declare_Function'>MergeAttributesIntoExisting</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>child_rel</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>parent_rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN11166"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>attrrel</span><span class='Delimiter'>; 
</span><a name="LN11167"></a>    <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>parent_attno</span><span class='Delimiter'>; 
</span><a name="LN11168"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>parent_natts</span><span class='Delimiter'>; 
</span><a name="LN11169"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupleDesc</span><span class='Delimiter'>; 
</span><a name="LN11170"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN11171"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>child_is_partition</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN11166"><span class='Ref_To_Local'>attrrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN32"><span class='Ref_to_Const'>AttributeRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN11169"><span class='Ref_To_Local'>tupleDesc</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11164"><span class='Ref_to_Parameter'>parent_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN11168"><span class='Ref_To_Local'>parent_natts</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN11169"><span class='Ref_To_Local'>tupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If parent_rel is a partitioned table, child_rel must be a partition */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11164"><span class='Ref_to_Parameter'>parent_rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>        <a href="tablecmds.c.html#LN11171"><span class='Ref_To_Local'>child_is_partition</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11167"><span class='Ref_To_Local'>parent_attno</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN11167"><span class='Ref_To_Local'>parent_attno</span></a> <span class='Operator'>&LT;= </span><a href="tablecmds.c.html#LN11168"><span class='Ref_To_Local'>parent_natts</span></a><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN11167"><span class='Ref_To_Local'>parent_attno</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN11184"></a>        <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>attribute</span> <span class='Operator'>= </span><a href="tablecmds.c.html#LN11169"><span class='Ref_To_Local'>tupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN11167"><span class='Ref_To_Local'>parent_attno</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN11185"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>attributeName</span> <span class='Operator'>= </span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11184"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Ignore dropped columns in the parent. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11184"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Find same column in child (matching on column name). */ 
</span>        <a href="tablecmds.c.html#LN11170"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN130"><span class='Ref_to_Proto'>SearchSysCacheCopyAttName</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11164"><span class='Ref_to_Parameter'>child_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                          <a href="tablecmds.c.html#LN11185"><span class='Ref_To_Local'>attributeName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11170"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Check they are same type, typmod, and collation */ 
</span><a name="LN11197"></a>            <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>childatt</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11170"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11184"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>-&GT;</span>atttypid <span class='Operator'>!= </span><a href="tablecmds.c.html#LN11197"><span class='Ref_To_Local'>childatt</span></a><span class='Operator'>-&GT;</span>atttypid <span class='Operator'>|| 
</span>                <a href="tablecmds.c.html#LN11184"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>-&GT;</span>atttypmod <span class='Operator'>!= </span><a href="tablecmds.c.html#LN11197"><span class='Ref_To_Local'>childatt</span></a><span class='Operator'>-&GT;</span>atttypmod<span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"child table \"%s\" has different type for column \"%s\""</span><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11164"><span class='Ref_to_Parameter'>child_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="tablecmds.c.html#LN11185"><span class='Ref_To_Local'>attributeName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11184"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>-&GT;</span>attcollation <span class='Operator'>!= </span><a href="tablecmds.c.html#LN11197"><span class='Ref_To_Local'>childatt</span></a><span class='Operator'>-&GT;</span>attcollation<span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_COLLATION_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"child table \"%s\" has different collation for column \"%s\""</span><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11164"><span class='Ref_to_Parameter'>child_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="tablecmds.c.html#LN11185"><span class='Ref_To_Local'>attributeName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Check child doesn't discard NOT NULL property.  (Other 
             * constraints are checked elsewhere.) 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11184"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>-&GT;</span>attnotnull <span class='Operator'>&& !</span><a href="tablecmds.c.html#LN11197"><span class='Ref_To_Local'>childatt</span></a><span class='Operator'>-&GT;</span>attnotnull<span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" in child table must be marked NOT NULL"</span><span class='Delimiter'>, 
</span>                       <a href="tablecmds.c.html#LN11185"><span class='Ref_To_Local'>attributeName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * OK, bump the child column's inheritance count.  (If we fail 
             * later on, this change will just roll back.) 
             */ 
</span>            <a href="tablecmds.c.html#LN11197"><span class='Ref_To_Local'>childatt</span></a><span class='Operator'>-&GT;</span>attinhcount<span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * In case of partitions, we must enforce that value of attislocal 
             * is same in all partitions. (Note: there are only inherited 
             * attributes in partitions) 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11171"><span class='Ref_To_Local'>child_is_partition</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11197"><span class='Ref_To_Local'>childatt</span></a><span class='Operator'>-&GT;</span>attinhcount <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN11197"><span class='Ref_To_Local'>childatt</span></a><span class='Operator'>-&GT;</span>attislocal <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11166"><span class='Ref_To_Local'>attrrel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN11170"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11170"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11170"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if HeapTupleIsValid(tupl... &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"child table is missing column \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="tablecmds.c.html#LN11185"><span class='Ref_To_Local'>attributeName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for parent_attno=1;parent... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If the parent has an OID column, so must the child, and we'd better 
     * update the child's attinhcount and attislocal the same as for normal 
     * columns.  We needn't check data type or not-nullness though. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11169"><span class='Ref_To_Local'>tupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN78"><span class='Ref_to_Member'>tdhasoid</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Here we match by column number not name; the match *must* be the 
         * system column, not some random column named "oid". 
         */ 
</span>        <a href="tablecmds.c.html#LN11170"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN166"><span class='Ref_to_Macro'>SearchSysCacheCopy2</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN40"><span class='Ref_to_EnumConst'>ATTNUM</span></a><span class='Delimiter'>, 
</span>                               <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11164"><span class='Ref_to_Parameter'>child_rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                                    <a href="../../include/postgres.h.html#LN456"><span class='Ref_to_Macro'>Int16GetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11170"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN11269"></a>            <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>childatt</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11170"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* See comments above; these changes should be the same */ 
</span>            <a href="tablecmds.c.html#LN11269"><span class='Ref_To_Local'>childatt</span></a><span class='Operator'>-&GT;</span>attinhcount<span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11171"><span class='Ref_To_Local'>child_is_partition</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11269"><span class='Ref_To_Local'>childatt</span></a><span class='Operator'>-&GT;</span>attinhcount <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN11269"><span class='Ref_To_Local'>childatt</span></a><span class='Operator'>-&GT;</span>attislocal <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11166"><span class='Ref_To_Local'>attrrel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN11170"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11170"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11170"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"child table is missing column \"%s\""</span><span class='Delimiter'>, 
</span>                            <span class='String'>"oid"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if tupleDesc-&GT;tdhasoid &raquo; </span> 
 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11166"><span class='Ref_To_Local'>attrrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end MergeAttributesIntoExisting &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Check constraints in child table match up with constraints in parent, 
 * and increment their coninhcount. 
 * 
 * Constraints that are marked ONLY in the parent are ignored. 
 * 
 * Called by CreateInheritance 
 * 
 * Currently all constraints in parent must be present in the child. One day we 
 * may consider adding new constraints like CREATE TABLE does. 
 * 
 * XXX This is O(N^2) which may be an issue with tables with hundreds of 
 * constraints. As long as tables have more like 10 constraints it shouldn't be 
 * a problem though. Even 100 constraints ought not be the end of the world. 
 * 
 * XXX See MergeWithExistingConstraint too if you change this code. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN11313"></a><span class='Declare_Function'>MergeConstraintsIntoExisting</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>child_rel</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>parent_rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN11315"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>catalog_relation</span><span class='Delimiter'>; 
</span><a name="LN11316"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tuple_desc</span><span class='Delimiter'>; 
</span><a name="LN11317"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>parent_scan</span><span class='Delimiter'>; 
</span><a name="LN11318"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>parent_key</span><span class='Delimiter'>; 
</span><a name="LN11319"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>parent_tuple</span><span class='Delimiter'>; 
</span><a name="LN11320"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>child_is_partition</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN11315"><span class='Ref_To_Local'>catalog_relation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN28"><span class='Ref_to_Const'>ConstraintRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN11316"><span class='Ref_To_Local'>tuple_desc</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11315"><span class='Ref_To_Local'>catalog_relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If parent_rel is a partitioned table, child_rel must be a partition */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11313"><span class='Ref_to_Parameter'>parent_rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>        <a href="tablecmds.c.html#LN11320"><span class='Ref_To_Local'>child_is_partition</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Outer loop scans through the parent's constraint definitions */ 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN11318"><span class='Ref_To_Local'>parent_key</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/catalog/pg_constraint.h.html#LN159"><span class='Ref_to_Const'>Anum_pg_constraint_conrelid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11313"><span class='Ref_to_Parameter'>parent_rel</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN11317"><span class='Ref_To_Local'>parent_scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11315"><span class='Ref_To_Local'>catalog_relation</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN125"><span class='Ref_to_Const'>ConstraintRelidIndexId</span></a><span class='Delimiter'>, 
</span>                                     <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN11318"><span class='Ref_To_Local'>parent_key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11319"><span class='Ref_To_Local'>parent_tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11317"><span class='Ref_To_Local'>parent_scan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN11339"></a>        <a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a> <span class='Declare_Local'>parent_con</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11319"><span class='Ref_To_Local'>parent_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN11340"></a>        <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>child_scan</span><span class='Delimiter'>; 
</span><a name="LN11341"></a>        <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>child_key</span><span class='Delimiter'>; 
</span><a name="LN11342"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>child_tuple</span><span class='Delimiter'>; 
</span><a name="LN11343"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11339"><span class='Ref_To_Local'>parent_con</span></a><span class='Operator'>-&GT;</span>contype <span class='Operator'>!= </span><a href="../../include/catalog/pg_constraint.h.html#LN187"><span class='Ref_to_Const'>CONSTRAINT_CHECK</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* if the parent's constraint is marked NO INHERIT, it's not inherited */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11339"><span class='Ref_To_Local'>parent_con</span></a><span class='Operator'>-&GT;</span>connoinherit<span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Search for a child constraint matching this one */ 
</span>        <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN11341"><span class='Ref_To_Local'>child_key</span></a><span class='Delimiter'>, 
</span>                    <a href="../../include/catalog/pg_constraint.h.html#LN159"><span class='Ref_to_Const'>Anum_pg_constraint_conrelid</span></a><span class='Delimiter'>, 
</span>                    <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                    <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11313"><span class='Ref_to_Parameter'>child_rel</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN11340"><span class='Ref_To_Local'>child_scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11315"><span class='Ref_To_Local'>catalog_relation</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN125"><span class='Ref_to_Const'>ConstraintRelidIndexId</span></a><span class='Delimiter'>, 
</span>                                        <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN11341"><span class='Ref_To_Local'>child_key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11342"><span class='Ref_To_Local'>child_tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11340"><span class='Ref_To_Local'>child_scan</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN11362"></a>            <a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a> <span class='Declare_Local'>child_con</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11342"><span class='Ref_To_Local'>child_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN11363"></a>            <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>child_copy</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11362"><span class='Ref_To_Local'>child_con</span></a><span class='Operator'>-&GT;</span>contype <span class='Operator'>!= </span><a href="../../include/catalog/pg_constraint.h.html#LN187"><span class='Ref_to_Const'>CONSTRAINT_CHECK</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11339"><span class='Ref_To_Local'>parent_con</span></a><span class='Operator'>-&GT;</span>conname<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                       <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11362"><span class='Ref_To_Local'>child_con</span></a><span class='Operator'>-&GT;</span>conname<span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN11134"><span class='Ref_to_Func'>constraints_equivalent</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11319"><span class='Ref_To_Local'>parent_tuple</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11342"><span class='Ref_To_Local'>child_tuple</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11316"><span class='Ref_To_Local'>tuple_desc</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"child table \"%s\" has different definition for check constraint \"%s\""</span><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11313"><span class='Ref_to_Parameter'>child_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11339"><span class='Ref_To_Local'>parent_con</span></a><span class='Operator'>-&GT;</span>conname<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* If the child constraint is "no inherit" then cannot merge */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11362"><span class='Ref_To_Local'>child_con</span></a><span class='Operator'>-&GT;</span>connoinherit<span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"constraint \"%s\" conflicts with non-inherited constraint on child table \"%s\""</span><span class='Delimiter'>, 
</span>                                <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11362"><span class='Ref_To_Local'>child_con</span></a><span class='Operator'>-&GT;</span>conname<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11313"><span class='Ref_to_Parameter'>child_rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If the child constraint is "not valid" then cannot merge with a 
             * valid parent constraint 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11339"><span class='Ref_To_Local'>parent_con</span></a><span class='Operator'>-&GT;</span>convalidated <span class='Operator'>&& !</span><a href="tablecmds.c.html#LN11362"><span class='Ref_To_Local'>child_con</span></a><span class='Operator'>-&GT;</span>convalidated<span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"constraint \"%s\" conflicts with NOT VALID constraint on child table \"%s\""</span><span class='Delimiter'>, 
</span>                                <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11362"><span class='Ref_To_Local'>child_con</span></a><span class='Operator'>-&GT;</span>conname<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11313"><span class='Ref_to_Parameter'>child_rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * OK, bump the child constraint's inheritance count.  (If we fail 
             * later on, this change will just roll back.) 
             */ 
</span>            <a href="tablecmds.c.html#LN11363"><span class='Ref_To_Local'>child_copy</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN606"><span class='Ref_to_Func'>heap_copytuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11342"><span class='Ref_To_Local'>child_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN11362"><span class='Ref_To_Local'>child_con</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11363"><span class='Ref_To_Local'>child_copy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN11362"><span class='Ref_To_Local'>child_con</span></a><span class='Operator'>-&GT;</span>coninhcount<span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * In case of partitions, an inherited constraint must be 
             * inherited only once since it cannot have multiple parents and 
             * it is never considered local. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11320"><span class='Ref_To_Local'>child_is_partition</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11362"><span class='Ref_To_Local'>child_con</span></a><span class='Operator'>-&GT;</span>coninhcount <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="tablecmds.c.html#LN11362"><span class='Ref_To_Local'>child_con</span></a><span class='Operator'>-&GT;</span>conislocal <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11315"><span class='Ref_To_Local'>catalog_relation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN11363"><span class='Ref_To_Local'>child_copy</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11363"><span class='Ref_To_Local'>child_copy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11363"><span class='Ref_To_Local'>child_copy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="tablecmds.c.html#LN11343"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while HeapTupleIsValid(chil... &raquo; </span> 
 
        <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11340"><span class='Ref_To_Local'>child_scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN11343"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"child table is missing constraint \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11339"><span class='Ref_To_Local'>parent_con</span></a><span class='Operator'>-&GT;</span>conname<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while HeapTupleIsValid(pare... &raquo; </span> 
 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11317"><span class='Ref_To_Local'>parent_scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11315"><span class='Ref_To_Local'>catalog_relation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end MergeConstraintsIntoExisting &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ALTER TABLE NO INHERIT 
 * 
 * Return value is the address of the relation that is no longer parent. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN11443"></a><span class='Declare_Function'>ATExecDropInherit</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parent</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN11445"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span><a name="LN11446"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>parent_rel</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11443"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relispartition<span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot change inheritance of a partition"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * AccessShareLock on the parent is probably enough, seeing that DROP 
     * TABLE doesn't lock parent tables at all.  We need some lock since we'll 
     * be inspecting the parent's schema. 
     */ 
</span>    <a href="tablecmds.c.html#LN11446"><span class='Ref_To_Local'>parent_rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN92"><span class='Ref_to_Proto'>heap_openrv</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11443"><span class='Ref_to_Parameter'>parent</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We don't bother to check ownership of the parent table --- ownership of 
     * the child is presumed enough rights. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* Off to RemoveInheritance() where most of the work happens */ 
</span>    <a href="tablecmds.c.html#LN472"><span class='Ref_to_Proto'>RemoveInheritance</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11443"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11446"><span class='Ref_To_Local'>parent_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* keep our lock on the parent relation until commit */ 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11446"><span class='Ref_To_Local'>parent_rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11445"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, 
</span>                     <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11446"><span class='Ref_To_Local'>parent_rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN11445"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATExecDropInherit &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * RemoveInheritance 
 * 
 * Drop a parent from the child's parents. This just adjusts the attinhcount 
 * and attislocal of the columns and removes the pg_inherit and pg_depend 
 * entries. 
 * 
 * If attinhcount goes to 0 then attislocal gets set to true. If it goes back 
 * up attislocal stays true, which means if a child is ever removed from a 
 * parent then its columns will never be automatically dropped which may 
 * surprise. But at least we'll never surprise by dropping columns someone 
 * isn't expecting to be dropped which would actually mean data loss. 
 * 
 * coninhcount and conislocal for inherited constraints are adjusted in 
 * exactly the same way. 
 * 
 * Common to ATExecDropInherit() and ATExecDetachPartition(). 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN11496"></a><span class='Declare_Function'>RemoveInheritance</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>child_rel</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>parent_rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN11498"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>catalogRelation</span><span class='Delimiter'>; 
</span><a name="LN11499"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN11500"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>]; 
</span><a name="LN11501"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>inheritsTuple</span><span class='Delimiter'>, 
</span><a name="LN11502"></a>                <span class='Declare_Local'>attributeTuple</span><span class='Delimiter'>, 
</span><a name="LN11503"></a>                <span class='Declare_Local'>constraintTuple</span><span class='Delimiter'>; 
</span><a name="LN11504"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>connames</span><span class='Delimiter'>; 
</span><a name="LN11505"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN11506"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>child_is_partition</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If parent_rel is a partitioned table, child_rel must be a partition */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11496"><span class='Ref_to_Parameter'>parent_rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>        <a href="tablecmds.c.html#LN11506"><span class='Ref_To_Local'>child_is_partition</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Find and destroy the pg_inherits entry linking the two, or error out if 
     * there is none. 
     */ 
</span>    <a href="tablecmds.c.html#LN11498"><span class='Ref_To_Local'>catalogRelation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_inherits.h.html#LN28"><span class='Ref_to_Const'>InheritsRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN11500"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_inherits.h.html#LN49"><span class='Ref_to_Const'>Anum_pg_inherits_inhrelid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11496"><span class='Ref_to_Parameter'>child_rel</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN11499"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11498"><span class='Ref_To_Local'>catalogRelation</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN166"><span class='Ref_to_Const'>InheritsRelidSeqnoIndexId</span></a><span class='Delimiter'>, 
</span>                              <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11500"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11501"><span class='Ref_To_Local'>inheritsTuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11499"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN11526"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>inhparent</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN11526"><span class='Ref_To_Local'>inhparent</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_inherits.h.html#LN42"><span class='Ref_to_Typedef'>Form_pg_inherits</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11501"><span class='Ref_To_Local'>inheritsTuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>inhparent<span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11526"><span class='Ref_To_Local'>inhparent</span></a> <span class='Operator'>== </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11496"><span class='Ref_to_Parameter'>parent_rel</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/catalog/indexing.h.html#LN40"><span class='Ref_to_Proto'>CatalogTupleDelete</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11498"><span class='Ref_To_Local'>catalogRelation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN11501"><span class='Ref_To_Local'>inheritsTuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN11505"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11499"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11498"><span class='Ref_To_Local'>catalogRelation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN11505"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11506"><span class='Ref_To_Local'>child_is_partition</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/scripts/vacuumdb.c.html#LN25"><span class='Ref_to_Const'>ERRCODE_UNDEFINED_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"relation \"%s\" is not a partition of relation \"%s\""</span><span class='Delimiter'>, 
</span>                     <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11496"><span class='Ref_to_Parameter'>child_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11496"><span class='Ref_to_Parameter'>parent_rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/scripts/vacuumdb.c.html#LN25"><span class='Ref_to_Const'>ERRCODE_UNDEFINED_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"relation \"%s\" is not a parent of relation \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11496"><span class='Ref_to_Parameter'>parent_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11496"><span class='Ref_to_Parameter'>child_rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Search through child columns looking for ones matching parent rel 
     */ 
</span>    <a href="tablecmds.c.html#LN11498"><span class='Ref_To_Local'>catalogRelation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN32"><span class='Ref_to_Const'>AttributeRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN11500"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_attribute.h.html#LN194"><span class='Ref_to_Const'>Anum_pg_attribute_attrelid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11496"><span class='Ref_to_Parameter'>child_rel</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN11499"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11498"><span class='Ref_To_Local'>catalogRelation</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN93"><span class='Ref_to_Const'>AttributeRelidNumIndexId</span></a><span class='Delimiter'>, 
</span>                              <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11500"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11502"><span class='Ref_To_Local'>attributeTuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11499"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN11568"></a>        <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>att</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11502"><span class='Ref_To_Local'>attributeTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Ignore if dropped or not inherited */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11568"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11568"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>attinhcount <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN131"><span class='Ref_to_Proto'>SearchSysCacheExistsAttName</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11496"><span class='Ref_to_Parameter'>parent_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                        <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11568"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Decrement inhcount and possibly set islocal to true */ 
</span><a name="LN11580"></a>            <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>copyTuple</span> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN606"><span class='Ref_to_Func'>heap_copytuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11502"><span class='Ref_To_Local'>attributeTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN11581"></a>            <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>copy_att</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11580"><span class='Ref_To_Local'>copyTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="tablecmds.c.html#LN11581"><span class='Ref_To_Local'>copy_att</span></a><span class='Operator'>-&GT;</span>attinhcount<span class='Operator'>--</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11581"><span class='Ref_To_Local'>copy_att</span></a><span class='Operator'>-&GT;</span>attinhcount <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="tablecmds.c.html#LN11581"><span class='Ref_To_Local'>copy_att</span></a><span class='Operator'>-&GT;</span>attislocal <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11498"><span class='Ref_To_Local'>catalogRelation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN11580"><span class='Ref_To_Local'>copyTuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11580"><span class='Ref_To_Local'>copyTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11580"><span class='Ref_To_Local'>copyTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while HeapTupleIsValid(attr... &raquo; </span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11499"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11498"><span class='Ref_To_Local'>catalogRelation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Likewise, find inherited check constraints and disinherit them. To do 
     * this, we first need a list of the names of the parent's check 
     * constraints.  (We cheat a bit by only checking for name matches, 
     * assuming that the expressions will match.) 
     */ 
</span>    <a href="tablecmds.c.html#LN11498"><span class='Ref_To_Local'>catalogRelation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN28"><span class='Ref_to_Const'>ConstraintRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN11500"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_constraint.h.html#LN159"><span class='Ref_to_Const'>Anum_pg_constraint_conrelid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11496"><span class='Ref_to_Parameter'>parent_rel</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN11499"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11498"><span class='Ref_To_Local'>catalogRelation</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN125"><span class='Ref_to_Const'>ConstraintRelidIndexId</span></a><span class='Delimiter'>, 
</span>                              <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11500"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN11504"><span class='Ref_To_Local'>connames</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11503"><span class='Ref_To_Local'>constraintTuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11499"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN11612"></a>        <a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a> <span class='Declare_Local'>con</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11503"><span class='Ref_To_Local'>constraintTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11612"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>contype <span class='Operator'>== </span><a href="../../include/catalog/pg_constraint.h.html#LN187"><span class='Ref_to_Const'>CONSTRAINT_CHECK</span></a><span class='Parentheses'>) 
</span>            <a href="tablecmds.c.html#LN11504"><span class='Ref_To_Local'>connames</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11504"><span class='Ref_To_Local'>connames</span></a><span class='Delimiter'>, </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11612"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>conname<span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11499"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Now scan the child's constraints */ 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN11500"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_constraint.h.html#LN159"><span class='Ref_to_Const'>Anum_pg_constraint_conrelid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11496"><span class='Ref_to_Parameter'>child_rel</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN11499"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11498"><span class='Ref_To_Local'>catalogRelation</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN125"><span class='Ref_to_Const'>ConstraintRelidIndexId</span></a><span class='Delimiter'>, 
</span>                              <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11500"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11503"><span class='Ref_To_Local'>constraintTuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11499"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN11630"></a>        <a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a> <span class='Declare_Local'>con</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11503"><span class='Ref_To_Local'>constraintTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN11631"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>match</span><span class='Delimiter'>; 
</span><a name="LN11632"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11630"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>contype <span class='Operator'>!= </span><a href="../../include/catalog/pg_constraint.h.html#LN187"><span class='Ref_to_Const'>CONSTRAINT_CHECK</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN11631"><span class='Ref_To_Local'>match</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11632"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11504"><span class='Ref_To_Local'>connames</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11630"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>conname<span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11632"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="tablecmds.c.html#LN11631"><span class='Ref_To_Local'>match</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11631"><span class='Ref_To_Local'>match</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Decrement inhcount and possibly set islocal to true */ 
</span><a name="LN11650"></a>            <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>copyTuple</span> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN606"><span class='Ref_to_Func'>heap_copytuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11503"><span class='Ref_To_Local'>constraintTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN11651"></a>            <a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a> <span class='Declare_Local'>copy_con</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11650"><span class='Ref_To_Local'>copyTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11651"><span class='Ref_To_Local'>copy_con</span></a><span class='Operator'>-&GT;</span>coninhcount <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span>     <span class='Comment_Single_Line'>/* shouldn't happen */ 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"relation %u has non-inherited constraint \"%s\""</span><span class='Delimiter'>, 
</span>                     <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11496"><span class='Ref_to_Parameter'>child_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11651"><span class='Ref_To_Local'>copy_con</span></a><span class='Operator'>-&GT;</span>conname<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <a href="tablecmds.c.html#LN11651"><span class='Ref_To_Local'>copy_con</span></a><span class='Operator'>-&GT;</span>coninhcount<span class='Operator'>--</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11651"><span class='Ref_To_Local'>copy_con</span></a><span class='Operator'>-&GT;</span>coninhcount <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="tablecmds.c.html#LN11651"><span class='Ref_To_Local'>copy_con</span></a><span class='Operator'>-&GT;</span>conislocal <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11498"><span class='Ref_To_Local'>catalogRelation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN11650"><span class='Ref_To_Local'>copyTuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11650"><span class='Ref_To_Local'>copyTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11650"><span class='Ref_To_Local'>copyTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while HeapTupleIsValid(cons... &raquo; </span> 
 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11499"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11498"><span class='Ref_To_Local'>catalogRelation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN449"><span class='Ref_to_Proto'>drop_parent_dependency</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11496"><span class='Ref_to_Parameter'>child_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, 
</span>                           <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11496"><span class='Ref_to_Parameter'>parent_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="tablecmds.c.html#LN290"><span class='Ref_to_Macro'>child_dependency_type</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11506"><span class='Ref_To_Local'>child_is_partition</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Post alter hook of this inherits. Since object_access_hook doesn't take 
     * multiple object identifiers, we relay oid of parent relation using 
     * auxiliary_id argument. 
     */ 
</span>    <a href="../../include/catalog/objectaccess.h.html#LN165"><span class='Ref_to_Macro'>InvokeObjectPostAlterHookArg</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_inherits.h.html#LN28"><span class='Ref_to_Const'>InheritsRelationId</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11496"><span class='Ref_to_Parameter'>child_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                 <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11496"><span class='Ref_to_Parameter'>parent_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RemoveInheritance &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Drop the dependency created by StoreCatalogInheritance1 (CREATE TABLE 
 * INHERITS/ALTER TABLE INHERIT -- refclassid will be RelationRelationId) or 
 * heap_create_with_catalog (CREATE TABLE OF/ALTER TABLE OF -- refclassid will 
 * be TypeRelationId).  There's no convenient way to do this, so go trawling 
 * through pg_depend. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN11692"></a><span class='Declare_Function'>drop_parent_dependency</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>refclassid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>refobjid</span><span class='Delimiter'>, 
</span><a name="LN11693"></a>                       <a href="../../include/catalog/dependency.h.html#LN72"><span class='Ref_to_Enum'>DependencyType</span></a> <span class='Declare_Parameter'>deptype</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN11695"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>catalogRelation</span><span class='Delimiter'>; 
</span><a name="LN11696"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN11697"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>]; 
</span><a name="LN11698"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>depTuple</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN11695"><span class='Ref_To_Local'>catalogRelation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_depend.h.html#LN28"><span class='Ref_to_Const'>DependRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN11697"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN67"><span class='Ref_to_Const'>Anum_pg_depend_classid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN11697"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN68"><span class='Ref_to_Const'>Anum_pg_depend_objid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11692"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN11697"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN69"><span class='Ref_to_Const'>Anum_pg_depend_objsubid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_INT4EQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN11696"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11695"><span class='Ref_To_Local'>catalogRelation</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN144"><span class='Ref_to_Const'>DependDependerIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11697"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11698"><span class='Ref_To_Local'>depTuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11696"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN11720"></a>        <a href="../../include/catalog/pg_depend.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_depend</span></a> <span class='Declare_Local'>dep</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_depend.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_depend</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11698"><span class='Ref_To_Local'>depTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11720"><span class='Ref_To_Local'>dep</span></a><span class='Operator'>-&GT;</span>refclassid <span class='Operator'>== </span><a href="tablecmds.c.html#LN11692"><span class='Ref_to_Parameter'>refclassid</span></a> <span class='Operator'>&& 
</span>            <a href="tablecmds.c.html#LN11720"><span class='Ref_To_Local'>dep</span></a><span class='Operator'>-&GT;</span>refobjid <span class='Operator'>== </span><a href="tablecmds.c.html#LN11692"><span class='Ref_to_Parameter'>refobjid</span></a> <span class='Operator'>&& 
</span>            <a href="tablecmds.c.html#LN11720"><span class='Ref_To_Local'>dep</span></a><span class='Operator'>-&GT;</span>refobjsubid <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>            <a href="tablecmds.c.html#LN11720"><span class='Ref_To_Local'>dep</span></a><span class='Operator'>-&GT;</span>deptype <span class='Operator'>== </span><a href="tablecmds.c.html#LN11693"><span class='Ref_to_Parameter'>deptype</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/catalog/indexing.h.html#LN40"><span class='Ref_to_Proto'>CatalogTupleDelete</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11695"><span class='Ref_To_Local'>catalogRelation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN11698"><span class='Ref_To_Local'>depTuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11696"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11695"><span class='Ref_To_Local'>catalogRelation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end drop_parent_dependency &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ALTER TABLE OF 
 * 
 * Attach a table to a composite type, as though it had been created with CREATE 
 * TABLE OF.  All attname, atttypid, atttypmod and attcollation must match.  The 
 * subject table must not have inheritance parents.  These restrictions ensure 
 * that you cannot create a configuration impossible with CREATE TABLE OF alone. 
 * 
 * The address of the type is returned. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN11744"></a><span class='Declare_Function'>ATExecAddOf</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="../../include/nodes/parsenodes.h.html#LN205"><span class='Ref_to_Struct'>TypeName</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ofTypename</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN11746"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11744"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN11747"></a>    <a href="../../include/parser/parse_type.h.html#LN19"><span class='Ref_to_Typedef'>Type</span></a>        <span class='Declare_Local'>typetuple</span><span class='Delimiter'>; 
</span><a name="LN11748"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typeid</span><span class='Delimiter'>; 
</span><a name="LN11749"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>inheritsRelation</span><span class='Delimiter'>, 
</span><a name="LN11750"></a>                <span class='Declare_Local'>relationRelation</span><span class='Delimiter'>; 
</span><a name="LN11751"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN11752"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>; 
</span><a name="LN11753"></a>    <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>table_attno</span><span class='Delimiter'>, 
</span><a name="LN11754"></a>                <span class='Declare_Local'>type_attno</span><span class='Delimiter'>; 
</span><a name="LN11755"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>typeTupleDesc</span><span class='Delimiter'>, 
</span><a name="LN11756"></a>                <span class='Declare_Local'>tableTupleDesc</span><span class='Delimiter'>; 
</span><a name="LN11757"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>tableobj</span><span class='Delimiter'>, 
</span><a name="LN11758"></a>                <span class='Declare_Local'>typeobj</span><span class='Delimiter'>; 
</span><a name="LN11759"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>classtuple</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Validate the type. */ 
</span>    <a href="tablecmds.c.html#LN11747"><span class='Ref_To_Local'>typetuple</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN25"><span class='Ref_to_Proto'>typenameType</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11744"><span class='Ref_to_Parameter'>ofTypename</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/commands/tablecmds.h.html#LN73"><span class='Ref_to_Proto'>check_of_type</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11747"><span class='Ref_To_Local'>typetuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>typeid </span><span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11747"><span class='Ref_To_Local'>typetuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Fail if the table has any inheritance parents. */ 
</span>    <a href="tablecmds.c.html#LN11749"><span class='Ref_To_Local'>inheritsRelation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_inherits.h.html#LN28"><span class='Ref_to_Const'>InheritsRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN11752"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/catalog/pg_inherits.h.html#LN49"><span class='Ref_to_Const'>Anum_pg_inherits_inhrelid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11746"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN11751"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11749"><span class='Ref_To_Local'>inheritsRelation</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN166"><span class='Ref_to_Const'>InheritsRelidSeqnoIndexId</span></a><span class='Delimiter'>, 
</span>                              <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN11752"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11751"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"typed tables cannot inherit"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11751"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11749"><span class='Ref_To_Local'>inheritsRelation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check the tuple descriptors for compatibility.  Unlike inheritance, we 
     * require that the order also match.  However, attnotnull need not match. 
     * Also unlike inheritance, we do not require matching relhasoids. 
     */ 
</span>    <a href="tablecmds.c.html#LN11755"><span class='Ref_To_Local'>typeTupleDesc</span></a> <span class='Operator'>= </span><a href="../../include/utils/typcache.h.html#LN151"><span class='Ref_to_Proto'>lookup_rowtype_tupdesc</span></a><span class='Parentheses'>(</span><span class='Keyword'>typeid</span><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN11756"><span class='Ref_To_Local'>tableTupleDesc</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11744"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN11753"><span class='Ref_To_Local'>table_attno</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11754"><span class='Ref_To_Local'>type_attno</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN11754"><span class='Ref_To_Local'>type_attno</span></a> <span class='Operator'>&LT;= </span><a href="tablecmds.c.html#LN11755"><span class='Ref_To_Local'>typeTupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN11754"><span class='Ref_To_Local'>type_attno</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN11791"></a>        <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>type_attr</span><span class='Delimiter'>, 
</span><a name="LN11792"></a>                    <span class='Declare_Local'>table_attr</span><span class='Delimiter'>; 
</span><a name="LN11793"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>type_attname</span><span class='Delimiter'>, 
</span><a name="LN11794"></a>                   <span class='Operator'>*</span><span class='Declare_Local'>table_attname</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Get the next non-dropped type attribute. */ 
</span>        <a href="tablecmds.c.html#LN11791"><span class='Ref_To_Local'>type_attr</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN11755"><span class='Ref_To_Local'>typeTupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN11754"><span class='Ref_To_Local'>type_attno</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11791"><span class='Ref_To_Local'>type_attr</span></a><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN11793"><span class='Ref_To_Local'>type_attname</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11791"><span class='Ref_To_Local'>type_attr</span></a><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Get the next non-dropped table attribute. */ 
</span>        <span class='Control'>do</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11753"><span class='Ref_To_Local'>table_attno</span></a> <span class='Operator'>&GT; </span><a href="tablecmds.c.html#LN11756"><span class='Ref_To_Local'>tableTupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"table is missing column \"%s\""</span><span class='Delimiter'>, 
</span>                                <a href="tablecmds.c.html#LN11793"><span class='Ref_To_Local'>type_attname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN11792"><span class='Ref_To_Local'>table_attr</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN11756"><span class='Ref_To_Local'>tableTupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN11753"><span class='Ref_To_Local'>table_attno</span></a><span class='Operator'>++ - </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>        <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11792"><span class='Ref_To_Local'>table_attr</span></a><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN11794"><span class='Ref_To_Local'>table_attname</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11792"><span class='Ref_To_Local'>table_attr</span></a><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Compare name. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11794"><span class='Ref_To_Local'>table_attname</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11793"><span class='Ref_To_Local'>type_attname</span></a><span class='Delimiter'>, </span><a href="../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"table has column \"%s\" where type requires \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN11794"><span class='Ref_To_Local'>table_attname</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11793"><span class='Ref_To_Local'>type_attname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Compare type. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11792"><span class='Ref_To_Local'>table_attr</span></a><span class='Operator'>-&GT;</span>atttypid <span class='Operator'>!= </span><a href="tablecmds.c.html#LN11791"><span class='Ref_To_Local'>type_attr</span></a><span class='Operator'>-&GT;</span>atttypid <span class='Operator'>|| 
</span>            <a href="tablecmds.c.html#LN11792"><span class='Ref_To_Local'>table_attr</span></a><span class='Operator'>-&GT;</span>atttypmod <span class='Operator'>!= </span><a href="tablecmds.c.html#LN11791"><span class='Ref_To_Local'>type_attr</span></a><span class='Operator'>-&GT;</span>atttypmod <span class='Operator'>|| 
</span>            <a href="tablecmds.c.html#LN11792"><span class='Ref_To_Local'>table_attr</span></a><span class='Operator'>-&GT;</span>attcollation <span class='Operator'>!= </span><a href="tablecmds.c.html#LN11791"><span class='Ref_To_Local'>type_attr</span></a><span class='Operator'>-&GT;</span>attcollation<span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                  <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"table \"%s\" has different type for column \"%s\""</span><span class='Delimiter'>, 
</span>                         <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11744"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11793"><span class='Ref_To_Local'>type_attname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for type_attno=1;type_att... &raquo; </span> 
    <a href="../../include/access/tupdesc.h.html#LN98"><span class='Ref_to_Proto'>DecrTupleDescRefCount</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11755"><span class='Ref_To_Local'>typeTupleDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Any remaining columns at the end of the table had better be dropped. */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN11753"><span class='Ref_To_Local'>table_attno</span></a> <span class='Operator'>&LT;= </span><a href="tablecmds.c.html#LN11756"><span class='Ref_To_Local'>tableTupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN11753"><span class='Ref_To_Local'>table_attno</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN11835"></a>        <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>table_attr</span> <span class='Operator'>= </span><a href="tablecmds.c.html#LN11756"><span class='Ref_To_Local'>tableTupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN11753"><span class='Ref_To_Local'>table_attno</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN11835"><span class='Ref_To_Local'>table_attr</span></a><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"table has extra column \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11835"><span class='Ref_To_Local'>table_attr</span></a><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* If the table was already typed, drop the existing dependency. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11744"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reloftype<span class='Parentheses'>) 
</span>        <a href="tablecmds.c.html#LN449"><span class='Ref_to_Proto'>drop_parent_dependency</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11746"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11744"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reloftype<span class='Delimiter'>, 
</span>                               <a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Record a dependency on the new type. */ 
</span>    <a href="tablecmds.c.html#LN11757"><span class='Ref_To_Local'>tableobj</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN11757"><span class='Ref_To_Local'>tableobj</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN11746"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN11757"><span class='Ref_To_Local'>tableobj</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN11758"><span class='Ref_To_Local'>typeobj</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN11758"><span class='Ref_To_Local'>typeobj</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><span class='Keyword'>typeid</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN11758"><span class='Ref_To_Local'>typeobj</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN11757"><span class='Ref_To_Local'>tableobj</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN11758"><span class='Ref_To_Local'>typeobj</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Update pg_class.reloftype */ 
</span>    <a href="tablecmds.c.html#LN11750"><span class='Ref_To_Local'>relationRelation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN11759"><span class='Ref_To_Local'>classtuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11746"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11759"><span class='Ref_To_Local'>classtuple</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for relation %u"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11746"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Parentheses'>((</span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11759"><span class='Ref_To_Local'>classtuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>reloftype <span class='Operator'>= </span><span class='Keyword'>typeid</span><span class='Delimiter'>; 
</span>    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11750"><span class='Ref_To_Local'>relationRelation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN11759"><span class='Ref_To_Local'>classtuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11759"><span class='Ref_To_Local'>classtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11746"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11759"><span class='Ref_To_Local'>classtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11750"><span class='Ref_To_Local'>relationRelation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11747"><span class='Ref_To_Local'>typetuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN11758"><span class='Ref_To_Local'>typeobj</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATExecAddOf &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ALTER TABLE NOT OF 
 * 
 * Detach a typed table from its originating type.  Just clear reloftype and 
 * remove the dependency. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN11883"></a><span class='Declare_Function'>ATExecDropOf</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN11885"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11883"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN11886"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relationRelation</span><span class='Delimiter'>; 
</span><a name="LN11887"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11883"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reloftype<span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a typed table"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11883"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We don't bother to check ownership of the type --- ownership of the 
     * table is presumed enough rights.  No lock required on the type, either. 
     */ 
</span> 
    <a href="tablecmds.c.html#LN449"><span class='Ref_to_Proto'>drop_parent_dependency</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11885"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11883"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reloftype<span class='Delimiter'>, 
</span>                           <a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Clear pg_class.reloftype */ 
</span>    <a href="tablecmds.c.html#LN11886"><span class='Ref_To_Local'>relationRelation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN11887"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11885"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11887"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for relation %u"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11885"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Parentheses'>((</span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11887"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>reloftype <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11886"><span class='Ref_To_Local'>relationRelation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN11887"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11887"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11885"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11887"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11886"><span class='Ref_To_Local'>relationRelation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATExecDropOf &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * relation_mark_replica_identity: Update a table's replica identity 
 * 
 * Iff ri_type = REPLICA_IDENTITY_INDEX, indexOid must be the Oid of a suitable 
 * index. Otherwise, it should be InvalidOid. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN11924"></a><span class='Declare_Function'>relation_mark_replica_identity</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>ri_type</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>indexOid</span><span class='Delimiter'>, 
</span><a name="LN11925"></a>                               <span class='Keyword'>bool </span><span class='Declare_Parameter'>is_internal</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN11927"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pg_index</span><span class='Delimiter'>; 
</span><a name="LN11928"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pg_class</span><span class='Delimiter'>; 
</span><a name="LN11929"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>pg_class_tuple</span><span class='Delimiter'>; 
</span><a name="LN11930"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>pg_index_tuple</span><span class='Delimiter'>; 
</span><a name="LN11931"></a>    <a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Local'>pg_class_form</span><span class='Delimiter'>; 
</span><a name="LN11932"></a>    <a href="../../include/catalog/pg_index.h.html#LN66"><span class='Ref_to_Typedef'>Form_pg_index</span></a> <span class='Declare_Local'>pg_index_form</span><span class='Delimiter'>; 
</span> 
<a name="LN11934"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>index</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check whether relreplident has changed, and update it if so. 
     */ 
</span>    <a href="tablecmds.c.html#LN11928"><span class='Ref_To_Local'>pg_class</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN11929"><span class='Ref_To_Local'>pg_class_tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, 
</span>                                    <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11924"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11929"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for relation \"%s\""</span><span class='Delimiter'>, 
</span>             <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11924"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN11931"><span class='Ref_To_Local'>pg_class_form</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11929"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11931"><span class='Ref_To_Local'>pg_class_form</span></a><span class='Operator'>-&GT;</span>relreplident <span class='Operator'>!= </span><a href="tablecmds.c.html#LN11924"><span class='Ref_to_Parameter'>ri_type</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN11931"><span class='Ref_To_Local'>pg_class_form</span></a><span class='Operator'>-&GT;</span>relreplident <span class='Operator'>= </span><a href="tablecmds.c.html#LN11924"><span class='Ref_to_Parameter'>ri_type</span></a><span class='Delimiter'>; 
</span>        <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11928"><span class='Ref_To_Local'>pg_class</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN11929"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11929"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11928"><span class='Ref_To_Local'>pg_class</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11929"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check whether the correct index is marked indisreplident; if so, we're 
     * done. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11924"><span class='Ref_to_Parameter'>indexOid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11924"><span class='Ref_to_Parameter'>ri_type</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN184"><span class='Ref_to_Const'>REPLICA_IDENTITY_INDEX</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN11930"><span class='Ref_To_Local'>pg_index_tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN65"><span class='Ref_to_EnumConst'>INDEXRELID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11924"><span class='Ref_to_Parameter'>indexOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11930"><span class='Ref_To_Local'>pg_index_tuple</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for index %u"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11924"><span class='Ref_to_Parameter'>indexOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN11932"><span class='Ref_To_Local'>pg_index_form</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_index.h.html#LN66"><span class='Ref_to_Typedef'>Form_pg_index</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11930"><span class='Ref_To_Local'>pg_index_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11932"><span class='Ref_To_Local'>pg_index_form</span></a><span class='Operator'>-&GT;</span>indisreplident<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11930"><span class='Ref_To_Local'>pg_index_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11930"><span class='Ref_To_Local'>pg_index_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Clear the indisreplident flag from any index that had it previously, 
     * and set it for any index that should have it now. 
     */ 
</span>    <a href="tablecmds.c.html#LN11927"><span class='Ref_To_Local'>pg_index</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_index.h.html#LN28"><span class='Ref_to_Const'>IndexRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11934"><span class='Ref_To_Local'>index</span></a><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN40"><span class='Ref_to_Proto'>RelationGetIndexList</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11924"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN11982"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>thisIndexOid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11934"><span class='Ref_To_Local'>index</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN11983"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>dirty</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN11930"><span class='Ref_To_Local'>pg_index_tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN65"><span class='Ref_to_EnumConst'>INDEXRELID</span></a><span class='Delimiter'>, 
</span>                                             <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11982"><span class='Ref_To_Local'>thisIndexOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11930"><span class='Ref_To_Local'>pg_index_tuple</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for index %u"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11982"><span class='Ref_To_Local'>thisIndexOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN11932"><span class='Ref_To_Local'>pg_index_form</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_index.h.html#LN66"><span class='Ref_to_Typedef'>Form_pg_index</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11930"><span class='Ref_To_Local'>pg_index_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Unset the bit if set.  We know it's wrong because we checked this 
         * earlier. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11932"><span class='Ref_To_Local'>pg_index_form</span></a><span class='Operator'>-&GT;</span>indisreplident<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="tablecmds.c.html#LN11983"><span class='Ref_To_Local'>dirty</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN11932"><span class='Ref_To_Local'>pg_index_form</span></a><span class='Operator'>-&GT;</span>indisreplident <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11982"><span class='Ref_To_Local'>thisIndexOid</span></a> <span class='Operator'>== </span><a href="tablecmds.c.html#LN11924"><span class='Ref_to_Parameter'>indexOid</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="tablecmds.c.html#LN11983"><span class='Ref_To_Local'>dirty</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN11932"><span class='Ref_To_Local'>pg_index_form</span></a><span class='Operator'>-&GT;</span>indisreplident <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11983"><span class='Ref_To_Local'>dirty</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11927"><span class='Ref_To_Local'>pg_index</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN11930"><span class='Ref_To_Local'>pg_index_tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11930"><span class='Ref_To_Local'>pg_index_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/catalog/objectaccess.h.html#LN165"><span class='Ref_to_Macro'>InvokeObjectPostAlterHookArg</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_index.h.html#LN28"><span class='Ref_to_Const'>IndexRelationId</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11982"><span class='Ref_To_Local'>thisIndexOid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                         <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN11925"><span class='Ref_to_Parameter'>is_internal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11930"><span class='Ref_To_Local'>pg_index_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN11927"><span class='Ref_To_Local'>pg_index</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end relation_mark_replica_identity &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ALTER TABLE &LT;name&GT; REPLICA IDENTITY ... 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN12022"></a><span class='Declare_Function'>ATExecReplicaIdentity</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1742"><span class='Ref_to_Struct'>ReplicaIdentityStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN12024"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>indexOid</span><span class='Delimiter'>; 
</span><a name="LN12025"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>indexRel</span><span class='Delimiter'>; 
</span><a name="LN12026"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>key</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12022"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1745"><span class='Ref_to_Member'>identity_type</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN174"><span class='Ref_to_Const'>REPLICA_IDENTITY_DEFAULT</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN11923"><span class='Ref_to_Func'>relation_mark_replica_identity</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12022"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12022"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1745"><span class='Ref_to_Member'>identity_type</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12022"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1745"><span class='Ref_to_Member'>identity_type</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN178"><span class='Ref_to_Const'>REPLICA_IDENTITY_FULL</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN11923"><span class='Ref_to_Func'>relation_mark_replica_identity</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12022"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12022"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1745"><span class='Ref_to_Member'>identity_type</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12022"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1745"><span class='Ref_to_Member'>identity_type</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN176"><span class='Ref_to_Const'>REPLICA_IDENTITY_NOTHING</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN11923"><span class='Ref_to_Func'>relation_mark_replica_identity</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12022"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12022"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1745"><span class='Ref_to_Member'>identity_type</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12022"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1745"><span class='Ref_to_Member'>identity_type</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN184"><span class='Ref_to_Const'>REPLICA_IDENTITY_INDEX</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>         <span class='Comment_Multi_Line'>/* fallthrough */ </span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected identity type %u"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12022"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1745"><span class='Ref_to_Member'>identity_type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
    <span class='Comment_Multi_Line'>/* Check that the index exists */ 
</span>    <a href="tablecmds.c.html#LN12024"><span class='Ref_To_Local'>indexOid</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN123"><span class='Ref_to_Proto'>get_relname_relid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12022"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1746"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12022"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relnamespace<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12024"><span class='Ref_To_Local'>indexOid</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"index \"%s\" for table \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN12022"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1746"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12022"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN12025"><span class='Ref_To_Local'>indexRel</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN129"><span class='Ref_to_Proto'>index_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12024"><span class='Ref_To_Local'>indexOid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN40"><span class='Ref_to_Const'>ShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check that the index is on the relation we're altering. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12025"><span class='Ref_To_Local'>indexRel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN158"><span class='Ref_to_Member'>rd_index</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>        <a href="tablecmds.c.html#LN12025"><span class='Ref_To_Local'>indexRel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN158"><span class='Ref_to_Member'>rd_index</span></a><span class='Operator'>-&GT;</span>indrelid <span class='Operator'>!= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12022"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not an index for table \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12025"><span class='Ref_To_Local'>indexRel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12022"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* The AM must support uniqueness, and the index must in fact be unique. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN12025"><span class='Ref_To_Local'>indexRel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN180"><span class='Ref_to_Member'>rd_amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/amapi.h.html#LN176"><span class='Ref_to_Member'>amcanunique</span></a> <span class='Operator'>|| 
</span>        <span class='Operator'>!</span><a href="tablecmds.c.html#LN12025"><span class='Ref_To_Local'>indexRel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN158"><span class='Ref_to_Member'>rd_index</span></a><span class='Operator'>-&GT;</span>indisunique<span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot use non-unique index \"%s\" as replica identity"</span><span class='Delimiter'>, 
</span>                    <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12025"><span class='Ref_To_Local'>indexRel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Deferred indexes are not guaranteed to be always unique. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN12025"><span class='Ref_To_Local'>indexRel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN158"><span class='Ref_to_Member'>rd_index</span></a><span class='Operator'>-&GT;</span>indimmediate<span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>          <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot use non-immediate index \"%s\" as replica identity"</span><span class='Delimiter'>, 
</span>                 <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12025"><span class='Ref_To_Local'>indexRel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Expression indexes aren't supported. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN45"><span class='Ref_to_Proto'>RelationGetIndexExpressions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12025"><span class='Ref_To_Local'>indexRel</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot use expression index \"%s\" as replica identity"</span><span class='Delimiter'>, 
</span>                    <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12025"><span class='Ref_To_Local'>indexRel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Predicate indexes aren't supported. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN46"><span class='Ref_to_Proto'>RelationGetIndexPredicate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12025"><span class='Ref_To_Local'>indexRel</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot use partial index \"%s\" as replica identity"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12025"><span class='Ref_To_Local'>indexRel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* And neither are invalid indexes. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/catalog/pg_index.h.html#LN106"><span class='Ref_to_Macro'>IndexIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12025"><span class='Ref_To_Local'>indexRel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN158"><span class='Ref_to_Member'>rd_index</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot use invalid index \"%s\" as replica identity"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12025"><span class='Ref_To_Local'>indexRel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check index for nullable columns. */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12026"><span class='Ref_To_Local'>key</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN12026"><span class='Ref_To_Local'>key</span></a> <span class='Operator'>&LT; </span><a href="tablecmds.c.html#LN12025"><span class='Ref_To_Local'>indexRel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN158"><span class='Ref_to_Member'>rd_index</span></a><span class='Operator'>-&GT;</span>indnatts<span class='Delimiter'>; </span><a href="tablecmds.c.html#LN12026"><span class='Ref_To_Local'>key</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN12104"></a>        <a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>attno</span> <span class='Operator'>= </span><a href="tablecmds.c.html#LN12025"><span class='Ref_To_Local'>indexRel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN158"><span class='Ref_to_Member'>rd_index</span></a><span class='Operator'>-&GT;</span>indkey<span class='Operator'>.</span>values<span class='Delimiter'>[</span><a href="tablecmds.c.html#LN12026"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>]; 
</span><a name="LN12105"></a>        <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>attr</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Allow OID column to be indexed; it's certainly not nullable */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12104"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>== </span><a href="../../include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Reject any other system columns.  (Going forward, we'll disallow 
         * indexes containing such columns in the first place, but they might 
         * exist in older branches.) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12104"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_COLUMN_REFERENCE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"index \"%s\" cannot be used as replica identity because column %d is a system column"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12025"><span class='Ref_To_Local'>indexRel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12104"><span class='Ref_To_Local'>attno</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN12105"><span class='Ref_To_Local'>attr</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN12022"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN12104"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN12105"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attnotnull<span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"index \"%s\" cannot be used as replica identity because column \"%s\" is nullable"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12025"><span class='Ref_To_Local'>indexRel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12105"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for key=0;key&LT;indexRel-&GT;r... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* This index is suitable for use as a replica identity. Mark it. */ 
</span>    <a href="tablecmds.c.html#LN11923"><span class='Ref_to_Func'>relation_mark_replica_identity</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12022"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12022"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1745"><span class='Ref_to_Member'>identity_type</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12024"><span class='Ref_To_Local'>indexOid</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/genam.h.html#LN130"><span class='Ref_to_Proto'>index_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12025"><span class='Ref_To_Local'>indexRel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATExecReplicaIdentity &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ALTER TABLE ENABLE/DISABLE ROW LEVEL SECURITY 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN12141"></a><span class='Declare_Function'>ATExecEnableRowSecurity</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN12143"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pg_class</span><span class='Delimiter'>; 
</span><a name="LN12144"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span><span class='Delimiter'>; 
</span><a name="LN12145"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN12144"><span class='Ref_To_Local'>relid</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12141"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN12143"><span class='Ref_To_Local'>pg_class</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN12145"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12144"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12145"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for relation %u"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12144"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>((</span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12145"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>relrowsecurity <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12143"><span class='Ref_To_Local'>pg_class</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN12145"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12145"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12143"><span class='Ref_To_Local'>pg_class</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12145"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATExecEnableRowSecurity &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN12164"></a><span class='Declare_Function'>ATExecDisableRowSecurity</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN12166"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pg_class</span><span class='Delimiter'>; 
</span><a name="LN12167"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span><span class='Delimiter'>; 
</span><a name="LN12168"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN12167"><span class='Ref_To_Local'>relid</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12164"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Pull the record for this relation and update it */ 
</span>    <a href="tablecmds.c.html#LN12166"><span class='Ref_To_Local'>pg_class</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN12168"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12167"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12168"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for relation %u"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12167"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>((</span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12168"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>relrowsecurity <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12166"><span class='Ref_To_Local'>pg_class</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN12168"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12168"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12166"><span class='Ref_To_Local'>pg_class</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12168"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATExecDisableRowSecurity &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ALTER TABLE FORCE/NO FORCE ROW LEVEL SECURITY 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN12191"></a><span class='Declare_Function'>ATExecForceNoForceRowSecurity</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>force_rls</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN12193"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pg_class</span><span class='Delimiter'>; 
</span><a name="LN12194"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span><span class='Delimiter'>; 
</span><a name="LN12195"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN12194"><span class='Ref_To_Local'>relid</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12191"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN12193"><span class='Ref_To_Local'>pg_class</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN12195"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12194"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12195"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for relation %u"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12194"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>((</span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12195"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>relforcerowsecurity <span class='Operator'>= </span><a href="tablecmds.c.html#LN12191"><span class='Ref_to_Parameter'>force_rls</span></a><span class='Delimiter'>; 
</span>    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12193"><span class='Ref_To_Local'>pg_class</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN12195"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12195"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12193"><span class='Ref_To_Local'>pg_class</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12195"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATExecForceNoForceRowSecurity &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ALTER FOREIGN TABLE &LT;name&GT; OPTIONS (...) 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN12217"></a><span class='Declare_Function'>ATExecGenericOptions</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>options</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN12219"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>ftrel</span><span class='Delimiter'>; 
</span><a name="LN12220"></a>    <a href="../../include/foreign/foreign.h.html#LN44"><span class='Ref_to_Struct'>ForeignServer</span></a> <span class='Operator'>*</span><span class='Declare_Local'>server</span><span class='Delimiter'>; 
</span><a name="LN12221"></a>    <a href="../../include/foreign/foreign.h.html#LN34"><span class='Ref_to_Struct'>ForeignDataWrapper</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fdw</span><span class='Delimiter'>; 
</span><a name="LN12222"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN12223"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN12224"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>repl_val</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_table.h.html#LN50"><span class='Ref_to_Const'>Natts_pg_foreign_table</span></a><span class='Delimiter'>]; 
</span><a name="LN12225"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>repl_null</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_table.h.html#LN50"><span class='Ref_to_Const'>Natts_pg_foreign_table</span></a><span class='Delimiter'>]; 
</span><a name="LN12226"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>repl_repl</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_table.h.html#LN50"><span class='Ref_to_Const'>Natts_pg_foreign_table</span></a><span class='Delimiter'>]; 
</span><a name="LN12227"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>datum</span><span class='Delimiter'>; 
</span><a name="LN12228"></a>    <a href="../../include/catalog/pg_foreign_table.h.html#LN43"><span class='Ref_to_Typedef'>Form_pg_foreign_table</span></a> <span class='Declare_Local'>tableform</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12217"><span class='Ref_to_Parameter'>options</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN12219"><span class='Ref_To_Local'>ftrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_table.h.html#LN26"><span class='Ref_to_Const'>ForeignTableRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN12222"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN64"><span class='Ref_to_EnumConst'>FOREIGNTABLEREL</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12217"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN115"><span class='Ref_to_Member'>rd_id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12222"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"foreign table \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12217"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN12228"><span class='Ref_To_Local'>tableform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_table.h.html#LN43"><span class='Ref_to_Typedef'>Form_pg_foreign_table</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12222"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN12220"><span class='Ref_To_Local'>server</span></a> <span class='Operator'>= </span><a href="../../include/foreign/foreign.h.html#LN71"><span class='Ref_to_Proto'>GetForeignServer</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12228"><span class='Ref_To_Local'>tableform</span></a><span class='Operator'>-&GT;</span>ftserver<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN12221"><span class='Ref_To_Local'>fdw</span></a> <span class='Operator'>= </span><a href="../foreign/foreign.c.html#LN33"><span class='Ref_to_Func'>GetForeignDataWrapper</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12220"><span class='Ref_To_Local'>server</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN47"><span class='Ref_to_Member'>fdwid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    memset<span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12224"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12224"><span class='Ref_To_Local'>repl_val</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12225"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12225"><span class='Ref_To_Local'>repl_null</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12226"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12226"><span class='Ref_To_Local'>repl_repl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Extract the current options */ 
</span>    <a href="tablecmds.c.html#LN12227"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN64"><span class='Ref_to_EnumConst'>FOREIGNTABLEREL</span></a><span class='Delimiter'>, 
</span>                            <a href="tablecmds.c.html#LN12222"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, 
</span>                            <a href="../../include/catalog/pg_foreign_table.h.html#LN53"><span class='Ref_to_Const'>Anum_pg_foreign_table_ftoptions</span></a><span class='Delimiter'>, 
</span>                            <span class='Operator'>&</span><a href="tablecmds.c.html#LN12223"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12223"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>        <a href="tablecmds.c.html#LN12227"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Transform the options */ 
</span>    <a href="tablecmds.c.html#LN12227"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="foreigncmds.c.html#LN107"><span class='Ref_to_Func'>transformGenericOptions</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_table.h.html#LN26"><span class='Ref_to_Const'>ForeignTableRelationId</span></a><span class='Delimiter'>, 
</span>                                    <a href="tablecmds.c.html#LN12227"><span class='Ref_To_Local'>datum</span></a><span class='Delimiter'>, 
</span>                                    <a href="tablecmds.c.html#LN12217"><span class='Ref_to_Parameter'>options</span></a><span class='Delimiter'>, 
</span>                                    <a href="tablecmds.c.html#LN12221"><span class='Ref_To_Local'>fdw</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/foreign.h.html#LN40"><span class='Ref_to_Member'>fdwvalidator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN525"><span class='Ref_to_Macro'>PointerIsValid</span></a><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12227"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>)))</span> 
        <a href="tablecmds.c.html#LN12224"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_table.h.html#LN53"><span class='Ref_to_Const'>Anum_pg_foreign_table_ftoptions</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="tablecmds.c.html#LN12227"><span class='Ref_To_Local'>datum</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="tablecmds.c.html#LN12225"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_table.h.html#LN53"><span class='Ref_to_Const'>Anum_pg_foreign_table_ftoptions</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN12226"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_table.h.html#LN53"><span class='Ref_to_Const'>Anum_pg_foreign_table_ftoptions</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Everything looks good - update the tuple */ 
</span> 
    <a href="tablecmds.c.html#LN12222"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12222"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12219"><span class='Ref_To_Local'>ftrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="tablecmds.c.html#LN12224"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12225"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12226"><span class='Ref_To_Local'>repl_repl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12219"><span class='Ref_To_Local'>ftrel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN12222"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12222"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Invalidate relcache so that all sessions will refresh any cached plans 
     * that might depend on the old options. 
     */ 
</span>    <a href="../../include/utils/inval.h.html#LN43"><span class='Ref_to_Proto'>CacheInvalidateRelcache</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12217"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_table.h.html#LN26"><span class='Ref_to_Const'>ForeignTableRelationId</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12217"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12219"><span class='Ref_To_Local'>ftrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12222"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATExecGenericOptions &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Preparation phase for SET LOGGED/UNLOGGED 
 * 
 * This verifies that we're not trying to change a temp table.  Also, 
 * existing foreign key constraints are checked to avoid ending up with 
 * permanent tables referencing unlogged tables. 
 * 
 * Return value is false if the operation is a no-op (in which case the 
 * checks are skipped), otherwise true. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN12302"></a><span class='Declare_Function'>ATPrepChangePersistence</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>toLogged</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN12304"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pg_constraint</span><span class='Delimiter'>; 
</span><a name="LN12305"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN12306"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN12307"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>skey</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Disallow changing status for a temp table.  Also verify whether we can 
     * get away with doing nothing; in such cases we don't need to run the 
     * checks below, either. 
     */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12302"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpersistence<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN171"><span class='Ref_to_Const'>RELPERSISTENCE_TEMP</span></a><span class='Operator'>: 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TABLE_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot change logged status of table \"%s\" because it is temporary"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12302"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                     <a href="../../include/utils/relcache.h.html#LN76"><span class='Ref_to_Proto'>errtable</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12302"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN169"><span class='Ref_to_Const'>RELPERSISTENCE_PERMANENT</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12302"><span class='Ref_to_Parameter'>toLogged</span></a><span class='Parentheses'>) 
</span>                <span class='Comment_Multi_Line'>/* nothing to do */ 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN170"><span class='Ref_to_Const'>RELPERSISTENCE_UNLOGGED</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN12302"><span class='Ref_to_Parameter'>toLogged</span></a><span class='Parentheses'>) 
</span>                <span class='Comment_Multi_Line'>/* nothing to do */ 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch rel-&GT;rd_rel-&GT;relpersi... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Check that the table is not part any publication when changing to 
     * UNLOGGED as UNLOGGED tables can't be published. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN12302"><span class='Ref_to_Parameter'>toLogged</span></a> <span class='Operator'>&& 
</span>        <a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_publication.h.html#LN90"><span class='Ref_to_Proto'>GetRelationPublications</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12302"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)))</span> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot change table \"%s\" to unlogged because it is part of a publication"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12302"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Unlogged relations cannot be replicated."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check existing foreign key constraints to preserve the invariant that 
     * permanent tables cannot reference unlogged ones.  Self-referencing 
     * foreign keys can safely be ignored. 
     */ 
</span>    <a href="tablecmds.c.html#LN12304"><span class='Ref_To_Local'>pg_constraint</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN28"><span class='Ref_to_Const'>ConstraintRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Scan conrelid if changing to permanent, else confrelid.  This also 
     * determines whether a useful index exists. 
     */ 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN12307"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="tablecmds.c.html#LN12302"><span class='Ref_to_Parameter'>toLogged</span></a> <span class='Operator'>? </span><a href="../../include/catalog/pg_constraint.h.html#LN159"><span class='Ref_to_Const'>Anum_pg_constraint_conrelid</span></a> <span class='Operator'>: 
</span>                <a href="../../include/catalog/pg_constraint.h.html#LN162"><span class='Ref_to_Const'>Anum_pg_constraint_confrelid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12302"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN12306"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12304"><span class='Ref_To_Local'>pg_constraint</span></a><span class='Delimiter'>, 
</span>                              <a href="tablecmds.c.html#LN12302"><span class='Ref_to_Parameter'>toLogged</span></a> <span class='Operator'>? </span><a href="../../include/catalog/indexing.h.html#LN125"><span class='Ref_to_Const'>ConstraintRelidIndexId</span></a> <span class='Operator'>: </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                              <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12307"><span class='Ref_To_Local'>skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12305"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12306"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN12369"></a>        <a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a> <span class='Declare_Local'>con</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12305"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12369"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>contype <span class='Operator'>== </span><a href="../../include/catalog/pg_constraint.h.html#LN188"><span class='Ref_to_Const'>CONSTRAINT_FOREIGN</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN12373"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>foreignrelid</span><span class='Delimiter'>; 
</span><a name="LN12374"></a>            <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>foreignrel</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* the opposite end of what we used as scankey */ 
</span>            <a href="tablecmds.c.html#LN12373"><span class='Ref_To_Local'>foreignrelid</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN12302"><span class='Ref_to_Parameter'>toLogged</span></a> <span class='Operator'>? </span><a href="tablecmds.c.html#LN12369"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>confrelid <span class='Operator'>: </span><a href="tablecmds.c.html#LN12369"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>conrelid<span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* ignore if self-referencing */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12302"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="tablecmds.c.html#LN12373"><span class='Ref_To_Local'>foreignrelid</span></a><span class='Parentheses'>)</span> 
                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <a href="tablecmds.c.html#LN12374"><span class='Ref_To_Local'>foreignrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN84"><span class='Ref_to_Proto'>relation_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12373"><span class='Ref_To_Local'>foreignrelid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12302"><span class='Ref_to_Parameter'>toLogged</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12374"><span class='Ref_To_Local'>foreignrel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpersistence <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN169"><span class='Ref_to_Const'>RELPERSISTENCE_PERMANENT</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TABLE_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not change table \"%s\" to logged because it references unlogged table \"%s\""</span><span class='Delimiter'>, 
</span>                                    <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12302"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                    <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12374"><span class='Ref_To_Local'>foreignrel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                             <a href="../../include/utils/relcache.h.html#LN79"><span class='Ref_to_Proto'>errtableconstraint</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12302"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12369"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>conname<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12374"><span class='Ref_To_Local'>foreignrel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpersistence <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN169"><span class='Ref_to_Const'>RELPERSISTENCE_PERMANENT</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TABLE_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not change table \"%s\" to unlogged because it references logged table \"%s\""</span><span class='Delimiter'>, 
</span>                                    <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12302"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                    <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12374"><span class='Ref_To_Local'>foreignrel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                             <a href="../../include/utils/relcache.h.html#LN79"><span class='Ref_to_Proto'>errtableconstraint</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12302"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12369"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>conname<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12374"><span class='Ref_To_Local'>foreignrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if con-&GT;contype==CONSTRA... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while HeapTupleIsValid(tupl... &raquo; </span> 
 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12306"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12304"><span class='Ref_To_Local'>pg_constraint</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATPrepChangePersistence &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Execute ALTER TABLE SET SCHEMA 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN12421"></a><span class='Declare_Function'>AlterTableNamespace</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2801"><span class='Ref_to_Struct'>AlterObjectSchemaStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>oldschema</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN12423"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN12424"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span><span class='Delimiter'>; 
</span><a name="LN12425"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>oldNspOid</span><span class='Delimiter'>; 
</span><a name="LN12426"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>nspOid</span><span class='Delimiter'>; 
</span><a name="LN12427"></a>    <a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>newrv</span><span class='Delimiter'>; 
</span><a name="LN12428"></a>    <a href="../catalog/dependency.c.html#LN108"><span class='Ref_to_Struct'>ObjectAddresses</span></a> <span class='Operator'>*</span><span class='Declare_Local'>objsMoved</span><span class='Delimiter'>; 
</span><a name="LN12429"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>myself</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN12424"><span class='Ref_To_Local'>relid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN55"><span class='Ref_to_Proto'>RangeVarGetRelidExtended</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12421"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2805"><span class='Ref_to_Member'>relation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Delimiter'>, 
</span>                                     <a href="tablecmds.c.html#LN12421"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2808"><span class='Ref_to_Member'>missing_ok</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                     <a href="tablecmds.c.html#LN465"><span class='Ref_to_Proto'>RangeVarCallbackForAlterRelation</span></a><span class='Delimiter'>, 
</span>                                     <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN12421"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12424"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"relation \"%s\" does not exist, skipping"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN12421"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2805"><span class='Ref_to_Member'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../catalog/objectaddress.c.html#LN718"><span class='Ref_to_Global_Var'>InvalidObjectAddress</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="tablecmds.c.html#LN12423"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN84"><span class='Ref_to_Proto'>relation_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12424"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN12425"><span class='Ref_To_Local'>oldNspOid</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN443"><span class='Ref_to_Macro'>RelationGetNamespace</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12423"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If it's an owned sequence, disallow moving it by itself. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12423"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN12451"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tableId</span><span class='Delimiter'>; 
</span><a name="LN12452"></a>        <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>colId</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/dependency.h.html#LN240"><span class='Ref_to_Proto'>sequenceIsOwned</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12424"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN75"><span class='Ref_to_EnumConst'>DEPENDENCY_AUTO</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN12451"><span class='Ref_To_Local'>tableId</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN12452"><span class='Ref_To_Local'>colId</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>            <a href="../../include/catalog/dependency.h.html#LN240"><span class='Ref_to_Proto'>sequenceIsOwned</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12424"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN76"><span class='Ref_to_EnumConst'>DEPENDENCY_INTERNAL</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN12451"><span class='Ref_To_Local'>tableId</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN12452"><span class='Ref_To_Local'>colId</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot move an owned sequence into another schema"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Sequence \"%s\" is linked to table \"%s\"."</span><span class='Delimiter'>, 
</span>                               <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12423"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                               <a href="../../include/utils/lsyscache.h.html#LN124"><span class='Ref_to_Proto'>get_rel_name</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12451"><span class='Ref_To_Local'>tableId</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Get and lock schema OID and check its permissions. */ 
</span>    <a href="tablecmds.c.html#LN12427"><span class='Ref_To_Local'>newrv</span></a> <span class='Operator'>= </span><a href="../../include/nodes/makefuncs.h.html#LN68"><span class='Ref_to_Proto'>makeRangeVar</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12421"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2807"><span class='Ref_to_Member'>newschema</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12423"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN12426"><span class='Ref_To_Local'>nspOid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN60"><span class='Ref_to_Proto'>RangeVarGetAndCheckCreationNamespace</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12427"><span class='Ref_To_Local'>newrv</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* common checks on switching namespaces */ 
</span>    <a href="../../include/catalog/namespace.h.html#LN117"><span class='Ref_to_Proto'>CheckSetNamespace</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12425"><span class='Ref_To_Local'>oldNspOid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12426"><span class='Ref_To_Local'>nspOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN12428"><span class='Ref_To_Local'>objsMoved</span></a> <span class='Operator'>= </span><a href="../../include/catalog/dependency.h.html#LN200"><span class='Ref_to_Proto'>new_object_addresses</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="../../include/commands/tablecmds.h.html#LN44"><span class='Ref_to_Proto'>AlterTableNamespaceInternal</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12423"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12425"><span class='Ref_To_Local'>oldNspOid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12426"><span class='Ref_To_Local'>nspOid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12428"><span class='Ref_To_Local'>objsMoved</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/catalog/dependency.h.html#LN212"><span class='Ref_to_Proto'>free_object_addresses</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12428"><span class='Ref_To_Local'>objsMoved</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12429"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12424"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12421"><span class='Ref_to_Parameter'>oldschema</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="tablecmds.c.html#LN12421"><span class='Ref_to_Parameter'>oldschema</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN12425"><span class='Ref_To_Local'>oldNspOid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* close rel, but keep lock until commit */ 
</span>    <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12423"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN12429"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterTableNamespace &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * The guts of relocating a table or materialized view to another namespace: 
 * besides moving the relation itself, its dependent objects are relocated to 
 * the new schema. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN12492"></a><span class='Declare_Function'>AlterTableNamespaceInternal</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oldNspOid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>nspOid</span><span class='Delimiter'>, 
</span><a name="LN12493"></a>                            <a href="../catalog/dependency.c.html#LN108"><span class='Ref_to_Struct'>ObjectAddresses</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>objsMoved</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN12495"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>classRel</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12493"><span class='Ref_to_Parameter'>objsMoved</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* OK, modify the pg_class row and pg_depend entry */ 
</span>    <a href="tablecmds.c.html#LN12495"><span class='Ref_To_Local'>classRel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/commands/tablecmds.h.html#LN47"><span class='Ref_to_Proto'>AlterRelationNamespaceInternal</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12495"><span class='Ref_To_Local'>classRel</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12492"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12492"><span class='Ref_to_Parameter'>oldNspOid</span></a><span class='Delimiter'>, 
</span>                                   <a href="tablecmds.c.html#LN12492"><span class='Ref_to_Parameter'>nspOid</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12493"><span class='Ref_to_Parameter'>objsMoved</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Fix the table's row type too */ 
</span>    <a href="../../include/commands/typecmds.h.html#LN51"><span class='Ref_to_Proto'>AlterTypeNamespaceInternal</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12492"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltype<span class='Delimiter'>, 
</span>                               <a href="tablecmds.c.html#LN12492"><span class='Ref_to_Parameter'>nspOid</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12493"><span class='Ref_to_Parameter'>objsMoved</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Fix other dependent stuff */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12492"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a> <span class='Operator'>|| 
</span>        <a href="tablecmds.c.html#LN12492"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a> <span class='Operator'>|| 
</span>        <a href="tablecmds.c.html#LN12492"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN306"><span class='Ref_to_Proto'>AlterIndexNamespaces</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12495"><span class='Ref_To_Local'>classRel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12492"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12492"><span class='Ref_to_Parameter'>oldNspOid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12492"><span class='Ref_to_Parameter'>nspOid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12493"><span class='Ref_to_Parameter'>objsMoved</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN308"><span class='Ref_to_Proto'>AlterSeqNamespaces</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12495"><span class='Ref_To_Local'>classRel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12492"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12492"><span class='Ref_to_Parameter'>oldNspOid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12492"><span class='Ref_to_Parameter'>nspOid</span></a><span class='Delimiter'>, 
</span>                           <a href="tablecmds.c.html#LN12493"><span class='Ref_to_Parameter'>objsMoved</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/catalog/pg_constraint_fn.h.html#LN68"><span class='Ref_to_Proto'>AlterConstraintNamespaces</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12492"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12492"><span class='Ref_to_Parameter'>oldNspOid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12492"><span class='Ref_to_Parameter'>nspOid</span></a><span class='Delimiter'>, 
</span>                                  <span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12493"><span class='Ref_to_Parameter'>objsMoved</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12495"><span class='Ref_To_Local'>classRel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterTableNamespaceInternal &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * The guts of relocating a relation to another namespace: fix the pg_class 
 * entry, and the pg_depend entry if any.  Caller must already have 
 * opened and write-locked pg_class. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN12530"></a><span class='Declare_Function'>AlterRelationNamespaceInternal</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>classRel</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relOid</span><span class='Delimiter'>, 
</span><a name="LN12531"></a>                               <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oldNspOid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>newNspOid</span><span class='Delimiter'>, 
</span><a name="LN12532"></a>                               <span class='Keyword'>bool </span><span class='Declare_Parameter'>hasDependEntry</span><span class='Delimiter'>, 
</span><a name="LN12533"></a>                               <a href="../catalog/dependency.c.html#LN108"><span class='Ref_to_Struct'>ObjectAddresses</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>objsMoved</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN12535"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>classTup</span><span class='Delimiter'>; 
</span><a name="LN12536"></a>    <a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Local'>classForm</span><span class='Delimiter'>; 
</span><a name="LN12537"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>thisobj</span><span class='Delimiter'>; 
</span><a name="LN12538"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>already_done</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN12535"><span class='Ref_To_Local'>classTup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12530"><span class='Ref_to_Parameter'>relOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12535"><span class='Ref_To_Local'>classTup</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for relation %u"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12530"><span class='Ref_to_Parameter'>relOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN12536"><span class='Ref_To_Local'>classForm</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12535"><span class='Ref_To_Local'>classTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12536"><span class='Ref_To_Local'>classForm</span></a><span class='Operator'>-&GT;</span>relnamespace <span class='Operator'>== </span><a href="tablecmds.c.html#LN12531"><span class='Ref_to_Parameter'>oldNspOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN12537"><span class='Ref_To_Local'>thisobj</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN12537"><span class='Ref_To_Local'>thisobj</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN12530"><span class='Ref_to_Parameter'>relOid</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN12537"><span class='Ref_To_Local'>thisobj</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the object has already been moved, don't move it again.  If it's 
     * already in the right place, don't move it, but still fire the object 
     * access hook. 
     */ 
</span>    <a href="tablecmds.c.html#LN12538"><span class='Ref_To_Local'>already_done</span></a> <span class='Operator'>= </span><a href="../../include/catalog/dependency.h.html#LN205"><span class='Ref_to_Proto'>object_address_present</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN12537"><span class='Ref_To_Local'>thisobj</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12533"><span class='Ref_to_Parameter'>objsMoved</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN12538"><span class='Ref_To_Local'>already_done</span></a> <span class='Operator'>&& </span><a href="tablecmds.c.html#LN12531"><span class='Ref_to_Parameter'>oldNspOid</span></a> <span class='Operator'>!= </span><a href="tablecmds.c.html#LN12531"><span class='Ref_to_Parameter'>newNspOid</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* check for duplicate name (more friendly than unique-index failure) */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/lsyscache.h.html#LN123"><span class='Ref_to_Proto'>get_relname_relid</span></a><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12536"><span class='Ref_To_Local'>classForm</span></a><span class='Operator'>-&GT;</span>relname<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="tablecmds.c.html#LN12531"><span class='Ref_to_Parameter'>newNspOid</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DUPLICATE_TABLE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"relation \"%s\" already exists in schema \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12536"><span class='Ref_To_Local'>classForm</span></a><span class='Operator'>-&GT;</span>relname<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12531"><span class='Ref_to_Parameter'>newNspOid</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* classTup is a copy, so OK to scribble on */ 
</span>        <a href="tablecmds.c.html#LN12536"><span class='Ref_To_Local'>classForm</span></a><span class='Operator'>-&GT;</span>relnamespace <span class='Operator'>= </span><a href="tablecmds.c.html#LN12531"><span class='Ref_to_Parameter'>newNspOid</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12530"><span class='Ref_to_Parameter'>classRel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN12535"><span class='Ref_To_Local'>classTup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12535"><span class='Ref_To_Local'>classTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Update dependency on schema if caller said so */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12532"><span class='Ref_to_Parameter'>hasDependEntry</span></a> <span class='Operator'>&& 
</span>            <a href="../../include/catalog/dependency.h.html#LN234"><span class='Ref_to_Proto'>changeDependencyFor</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, 
</span>                                <a href="tablecmds.c.html#LN12530"><span class='Ref_to_Parameter'>relOid</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/catalog/pg_namespace.h.html#LN33"><span class='Ref_to_Const'>NamespaceRelationId</span></a><span class='Delimiter'>, 
</span>                                <a href="tablecmds.c.html#LN12531"><span class='Ref_to_Parameter'>oldNspOid</span></a><span class='Delimiter'>, 
</span>                                <a href="tablecmds.c.html#LN12531"><span class='Ref_to_Parameter'>newNspOid</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"failed to change schema dependency for relation \"%s\""</span><span class='Delimiter'>, 
</span>                 <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12536"><span class='Ref_To_Local'>classForm</span></a><span class='Operator'>-&GT;</span>relname<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !already_done&&oldNsp... &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN12538"><span class='Ref_To_Local'>already_done</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/catalog/dependency.h.html#LN202"><span class='Ref_to_Proto'>add_exact_object_address</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN12537"><span class='Ref_To_Local'>thisobj</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12533"><span class='Ref_to_Parameter'>objsMoved</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12530"><span class='Ref_to_Parameter'>relOid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12535"><span class='Ref_To_Local'>classTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterRelationNamespaceInternal &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Move all indexes for the specified relation to another namespace. 
 * 
 * Note: we assume adequate permission checking was done by the caller, 
 * and that the caller has a suitable lock on the owning relation. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN12600"></a><span class='Declare_Function'>AlterIndexNamespaces</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>classRel</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN12601"></a>                     <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oldNspOid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>newNspOid</span><span class='Delimiter'>, </span><a href="../catalog/dependency.c.html#LN108"><span class='Ref_to_Struct'>ObjectAddresses</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>objsMoved</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN12603"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>indexList</span><span class='Delimiter'>; 
</span><a name="LN12604"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN12603"><span class='Ref_To_Local'>indexList</span></a> <span class='Operator'>= </span><a href="../../include/utils/relcache.h.html#LN40"><span class='Ref_to_Proto'>RelationGetIndexList</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12600"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12604"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12603"><span class='Ref_To_Local'>indexList</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN12610"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>indexOid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12604"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN12611"></a>        <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>thisobj</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN12611"><span class='Ref_To_Local'>thisobj</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN12611"><span class='Ref_To_Local'>thisobj</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN12610"><span class='Ref_To_Local'>indexOid</span></a><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN12611"><span class='Ref_To_Local'>thisobj</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Note: currently, the index will not have its own dependency on the 
         * namespace, so we don't need to do changeDependencyFor(). There's no 
         * row type in pg_type, either. 
         * 
         * XXX this objsMoved test may be pointless -- surely we have a single 
         * dependency link from a relation to each index? 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/catalog/dependency.h.html#LN205"><span class='Ref_to_Proto'>object_address_present</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN12611"><span class='Ref_To_Local'>thisobj</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12601"><span class='Ref_to_Parameter'>objsMoved</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/commands/tablecmds.h.html#LN47"><span class='Ref_to_Proto'>AlterRelationNamespaceInternal</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12600"><span class='Ref_to_Parameter'>classRel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12610"><span class='Ref_To_Local'>indexOid</span></a><span class='Delimiter'>, 
</span>                                           <a href="tablecmds.c.html#LN12601"><span class='Ref_to_Parameter'>oldNspOid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12601"><span class='Ref_to_Parameter'>newNspOid</span></a><span class='Delimiter'>, 
</span>                                           <span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12601"><span class='Ref_to_Parameter'>objsMoved</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/catalog/dependency.h.html#LN202"><span class='Ref_to_Proto'>add_exact_object_address</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN12611"><span class='Ref_To_Local'>thisobj</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12601"><span class='Ref_to_Parameter'>objsMoved</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12603"><span class='Ref_To_Local'>indexList</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterIndexNamespaces &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Move all identity and SERIAL-column sequences of the specified relation to another 
 * namespace. 
 * 
 * Note: we assume adequate permission checking was done by the caller, 
 * and that the caller has a suitable lock on the owning relation. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN12645"></a><span class='Declare_Function'>AlterSeqNamespaces</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>classRel</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN12646"></a>                   <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oldNspOid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>newNspOid</span><span class='Delimiter'>, </span><a href="../catalog/dependency.c.html#LN108"><span class='Ref_to_Struct'>ObjectAddresses</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>objsMoved</span><span class='Delimiter'>, 
</span><a name="LN12647"></a>                   <a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN12649"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>depRel</span><span class='Delimiter'>; 
</span><a name="LN12650"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN12651"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN12652"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * SERIAL sequences are those having an auto dependency on one of the 
     * table's columns (we don't care *which* column, exactly). 
     */ 
</span>    <a href="tablecmds.c.html#LN12649"><span class='Ref_To_Local'>depRel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_depend.h.html#LN28"><span class='Ref_to_Const'>DependRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN12651"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN70"><span class='Ref_to_Const'>Anum_pg_depend_refclassid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN12651"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN71"><span class='Ref_to_Const'>Anum_pg_depend_refobjid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12645"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* we leave refobjsubid unspecified */ 
</span> 
    <a href="tablecmds.c.html#LN12650"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12649"><span class='Ref_To_Local'>depRel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN146"><span class='Ref_to_Const'>DependReferenceIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12651"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12652"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12650"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN12675"></a>        <a href="../../include/catalog/pg_depend.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_depend</span></a> <span class='Declare_Local'>depForm</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_depend.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_depend</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12652"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN12676"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>seqRel</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* skip dependencies other than auto dependencies on columns */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12675"><span class='Ref_To_Local'>depForm</span></a><span class='Operator'>-&GT;</span>refobjsubid <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            <a href="tablecmds.c.html#LN12675"><span class='Ref_To_Local'>depForm</span></a><span class='Operator'>-&GT;</span>classid <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a> <span class='Operator'>|| 
</span>            <a href="tablecmds.c.html#LN12675"><span class='Ref_To_Local'>depForm</span></a><span class='Operator'>-&GT;</span>objsubid <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            <span class='Operator'>!</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12675"><span class='Ref_To_Local'>depForm</span></a><span class='Operator'>-&GT;</span>deptype <span class='Operator'>== </span><a href="../../include/catalog/dependency.h.html#LN75"><span class='Ref_to_EnumConst'>DEPENDENCY_AUTO</span></a> <span class='Operator'>|| </span><a href="tablecmds.c.html#LN12675"><span class='Ref_To_Local'>depForm</span></a><span class='Operator'>-&GT;</span>deptype <span class='Operator'>== </span><a href="../../include/catalog/dependency.h.html#LN76"><span class='Ref_to_EnumConst'>DEPENDENCY_INTERNAL</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Use relation_open just in case it's an index */ 
</span>        <a href="tablecmds.c.html#LN12676"><span class='Ref_To_Local'>seqRel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN84"><span class='Ref_to_Proto'>relation_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12675"><span class='Ref_To_Local'>depForm</span></a><span class='Operator'>-&GT;</span>objid<span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12647"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* skip non-sequence relations */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN410"><span class='Ref_to_Macro'>RelationGetForm</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12676"><span class='Ref_To_Local'>seqRel</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* No need to keep the lock */ 
</span>            <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12676"><span class='Ref_To_Local'>seqRel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12647"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Fix the pg_class and pg_depend entries */ 
</span>        <a href="../../include/commands/tablecmds.h.html#LN47"><span class='Ref_to_Proto'>AlterRelationNamespaceInternal</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12645"><span class='Ref_to_Parameter'>classRel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12675"><span class='Ref_To_Local'>depForm</span></a><span class='Operator'>-&GT;</span>objid<span class='Delimiter'>, 
</span>                                       <a href="tablecmds.c.html#LN12646"><span class='Ref_to_Parameter'>oldNspOid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12646"><span class='Ref_to_Parameter'>newNspOid</span></a><span class='Delimiter'>, 
</span>                                       <span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12646"><span class='Ref_to_Parameter'>objsMoved</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Sequences have entries in pg_type. We need to be careful to move 
         * them to the new namespace, too. 
         */ 
</span>        <a href="../../include/commands/typecmds.h.html#LN51"><span class='Ref_to_Proto'>AlterTypeNamespaceInternal</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN410"><span class='Ref_to_Macro'>RelationGetForm</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12676"><span class='Ref_To_Local'>seqRel</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>reltype<span class='Delimiter'>, 
</span>                                   <a href="tablecmds.c.html#LN12646"><span class='Ref_to_Parameter'>newNspOid</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12646"><span class='Ref_to_Parameter'>objsMoved</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Now we can close it.  Keep the lock till end of transaction. */ 
</span>        <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12676"><span class='Ref_To_Local'>seqRel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while HeapTupleIsValid(tup=... &raquo; </span> 
 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12650"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12649"><span class='Ref_To_Local'>depRel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterSeqNamespaces &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * This code supports 
 *  CREATE TEMP TABLE ... ON COMMIT { DROP | PRESERVE ROWS | DELETE ROWS } 
 * 
 * Because we only support this for TEMP tables, it's sufficient to remember 
 * the state in a backend-local data structure. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Register a newly-created relation's ON COMMIT action. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN12730"></a><span class='Declare_Function'>register_on_commit_action</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN46"><span class='Ref_to_Enum'>OnCommitAction</span></a> <span class='Declare_Parameter'>action</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN12732"></a>    <a href="tablecmds.c.html#LN107"><span class='Ref_to_Struct'>OnCommitItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>oc</span><span class='Delimiter'>; 
</span><a name="LN12733"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We needn't bother registering the relation unless there is an ON COMMIT 
     * action we need to take. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12730"><span class='Ref_to_Parameter'>action</span></a> <span class='Operator'>== </span><a href="../../include/nodes/primnodes.h.html#LN48"><span class='Ref_to_EnumConst'>ONCOMMIT_NOOP</span></a> <span class='Operator'>|| </span><a href="tablecmds.c.html#LN12730"><span class='Ref_to_Parameter'>action</span></a> <span class='Operator'>== </span><a href="../../include/nodes/primnodes.h.html#LN49"><span class='Ref_to_EnumConst'>ONCOMMIT_PRESERVE_ROWS</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN12733"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN12732"><span class='Ref_To_Local'>oc</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN107"><span class='Ref_to_Struct'>OnCommitItem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN107"><span class='Ref_to_Struct'>OnCommitItem</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN12732"><span class='Ref_To_Local'>oc</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN109"><span class='Ref_to_Member'>relid</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN12730"><span class='Ref_to_Parameter'>relid</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN12732"><span class='Ref_To_Local'>oc</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN110"><span class='Ref_to_Member'>oncommit</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN12730"><span class='Ref_to_Parameter'>action</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN12732"><span class='Ref_To_Local'>oc</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN119"><span class='Ref_to_Member'>creating_subid</span></a> <span class='Operator'>= </span><a href="../../include/access/xact.h.html#LN336"><span class='Ref_to_Proto'>GetCurrentSubTransactionId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN12732"><span class='Ref_To_Local'>oc</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN120"><span class='Ref_to_Member'>deleting_subid</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN402"><span class='Ref_to_Const'>InvalidSubTransactionId</span></a><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN123"><span class='Ref_to_Global_Var'>on_commits</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN215"><span class='Ref_to_Proto'>lcons</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12732"><span class='Ref_To_Local'>oc</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN123"><span class='Ref_to_Global_Var'>on_commits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12733"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end register_on_commit_action &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Unregister any ON COMMIT action when a relation is deleted. 
 * 
 * Actually, we only mark the OnCommitItem entry as to be deleted after commit. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN12761"></a><span class='Declare_Function'>remove_on_commit_action</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN12763"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12763"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN123"><span class='Ref_to_Global_Var'>on_commits</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN12767"></a>        <a href="tablecmds.c.html#LN107"><span class='Ref_to_Struct'>OnCommitItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>oc</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN107"><span class='Ref_to_Struct'>OnCommitItem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12763"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12767"><span class='Ref_To_Local'>oc</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN109"><span class='Ref_to_Member'>relid</span></a> <span class='Operator'>== </span><a href="tablecmds.c.html#LN12761"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="tablecmds.c.html#LN12767"><span class='Ref_To_Local'>oc</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN120"><span class='Ref_to_Member'>deleting_subid</span></a> <span class='Operator'>= </span><a href="../../include/access/xact.h.html#LN336"><span class='Ref_to_Proto'>GetCurrentSubTransactionId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Perform ON COMMIT actions. 
 * 
 * This is invoked just before actually committing, since it's possible 
 * to encounter errors. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN12784"></a><span class='Declare_Function'>PreCommit_on_commit_actions</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN12786"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span><a name="LN12787"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>oids_to_truncate</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12786"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN123"><span class='Ref_to_Global_Var'>on_commits</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN12791"></a>        <a href="tablecmds.c.html#LN107"><span class='Ref_to_Struct'>OnCommitItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>oc</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN107"><span class='Ref_to_Struct'>OnCommitItem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12786"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Ignore entry if already dropped in this xact */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12791"><span class='Ref_To_Local'>oc</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN120"><span class='Ref_to_Member'>deleting_subid</span></a> <span class='Operator'>!= </span><a href="../../include/c.h.html#LN402"><span class='Ref_to_Const'>InvalidSubTransactionId</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12791"><span class='Ref_To_Local'>oc</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN110"><span class='Ref_to_Member'>oncommit</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/primnodes.h.html#LN48"><span class='Ref_to_EnumConst'>ONCOMMIT_NOOP</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/primnodes.h.html#LN49"><span class='Ref_to_EnumConst'>ONCOMMIT_PRESERVE_ROWS</span></a><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* Do nothing (there shouldn't be such entries, actually) */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/primnodes.h.html#LN50"><span class='Ref_to_EnumConst'>ONCOMMIT_DELETE_ROWS</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * If this transaction hasn't accessed any temporary 
                 * relations, we can skip truncating ON COMMIT DELETE ROWS 
                 * tables, as they must still be empty. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="../access/transam/xact.c.html#LN117"><span class='Ref_to_Global_Var'>MyXactFlags</span></a> <span class='Operator'>& </span><a href="../../include/access/xact.h.html#LN86"><span class='Ref_to_Const'>XACT_FLAGS_ACCESSEDTEMPREL</span></a><span class='Parentheses'>))</span> 
                    <a href="tablecmds.c.html#LN12787"><span class='Ref_To_Local'>oids_to_truncate</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12787"><span class='Ref_To_Local'>oids_to_truncate</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12791"><span class='Ref_To_Local'>oc</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN109"><span class='Ref_to_Member'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/primnodes.h.html#LN51"><span class='Ref_to_EnumConst'>ONCOMMIT_DROP</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN12815"></a>                    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>object</span><span class='Delimiter'>; 
</span> 
                    <a href="tablecmds.c.html#LN12815"><span class='Ref_To_Local'>object</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>; 
</span>                    <a href="tablecmds.c.html#LN12815"><span class='Ref_To_Local'>object</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN12791"><span class='Ref_To_Local'>oc</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN109"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>; 
</span>                    <a href="tablecmds.c.html#LN12815"><span class='Ref_To_Local'>object</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Since this is an automatic drop, rather than one 
                     * directly initiated by the user, we pass the 
                     * PERFORM_DELETION_INTERNAL flag. 
                     */ 
</span>                    <a href="../../include/catalog/dependency.h.html#LN182"><span class='Ref_to_Proto'>performDeletion</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN12815"><span class='Ref_To_Local'>object</span></a><span class='Delimiter'>, 
</span>                                    <a href="../../include/nodes/parsenodes.h.html#LN1655"><span class='Ref_to_EnumConst'>DROP_CASCADE</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN173"><span class='Ref_to_Const'>PERFORM_DELETION_INTERNAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Note that table deletion will call 
                     * remove_on_commit_action, so the entry should get marked 
                     * as deleted. 
                     */ 
</span>                    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12791"><span class='Ref_To_Local'>oc</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN120"><span class='Ref_to_Member'>deleting_subid</span></a> <span class='Operator'>!= </span><a href="../../include/c.h.html#LN402"><span class='Ref_to_Const'>InvalidSubTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch oc-&GT;oncommit &raquo; </span> 
    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12787"><span class='Ref_To_Local'>oids_to_truncate</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/catalog/heap.h.html#LN79"><span class='Ref_to_Proto'>heap_truncate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12787"><span class='Ref_To_Local'>oids_to_truncate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* XXX needed? */ 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end PreCommit_on_commit_actions &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Post-commit or post-abort cleanup for ON COMMIT management. 
 * 
 * All we do here is remove no-longer-needed OnCommitItem entries. 
 * 
 * During commit, remove entries that were deleted during this transaction; 
 * during abort, remove those created during this transaction. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN12855"></a><span class='Declare_Function'>AtEOXact_on_commit_actions</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isCommit</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN12857"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cur_item</span><span class='Delimiter'>; 
</span><a name="LN12858"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>prev_item</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN12858"><span class='Ref_To_Local'>prev_item</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN12857"><span class='Ref_To_Local'>cur_item</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN123"><span class='Ref_to_Global_Var'>on_commits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12857"><span class='Ref_To_Local'>cur_item</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN12865"></a>        <a href="tablecmds.c.html#LN107"><span class='Ref_to_Struct'>OnCommitItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>oc</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN107"><span class='Ref_to_Struct'>OnCommitItem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12857"><span class='Ref_To_Local'>cur_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12855"><span class='Ref_to_Parameter'>isCommit</span></a> <span class='Operator'>? </span><a href="tablecmds.c.html#LN12865"><span class='Ref_To_Local'>oc</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN120"><span class='Ref_to_Member'>deleting_subid</span></a> <span class='Operator'>!= </span><a href="../../include/c.h.html#LN402"><span class='Ref_to_Const'>InvalidSubTransactionId</span></a> <span class='Operator'>: 
</span>            <a href="tablecmds.c.html#LN12865"><span class='Ref_To_Local'>oc</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN119"><span class='Ref_to_Member'>creating_subid</span></a> <span class='Operator'>!= </span><a href="../../include/c.h.html#LN402"><span class='Ref_to_Const'>InvalidSubTransactionId</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* cur_item must be removed */ 
</span>            <a href="tablecmds.c.html#LN123"><span class='Ref_to_Global_Var'>on_commits</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN238"><span class='Ref_to_Proto'>list_delete_cell</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN123"><span class='Ref_to_Global_Var'>on_commits</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12857"><span class='Ref_To_Local'>cur_item</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12858"><span class='Ref_To_Local'>prev_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12865"><span class='Ref_To_Local'>oc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12858"><span class='Ref_To_Local'>prev_item</span></a><span class='Parentheses'>) 
</span>                <a href="tablecmds.c.html#LN12857"><span class='Ref_To_Local'>cur_item</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12858"><span class='Ref_To_Local'>prev_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="tablecmds.c.html#LN12857"><span class='Ref_To_Local'>cur_item</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN123"><span class='Ref_to_Global_Var'>on_commits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* cur_item must be preserved */ 
</span>            <a href="tablecmds.c.html#LN12865"><span class='Ref_To_Local'>oc</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN119"><span class='Ref_to_Member'>creating_subid</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN402"><span class='Ref_to_Const'>InvalidSubTransactionId</span></a><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN12865"><span class='Ref_To_Local'>oc</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN120"><span class='Ref_to_Member'>deleting_subid</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN402"><span class='Ref_to_Const'>InvalidSubTransactionId</span></a><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN12858"><span class='Ref_To_Local'>prev_item</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN12857"><span class='Ref_To_Local'>cur_item</span></a><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN12857"><span class='Ref_To_Local'>cur_item</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12858"><span class='Ref_To_Local'>prev_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while cur_item!=NULL &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end AtEOXact_on_commit_actions &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Post-subcommit or post-subabort cleanup for ON COMMIT management. 
 * 
 * During subabort, we can immediately remove entries created during this 
 * subtransaction.  During subcommit, just relabel entries marked during 
 * this subtransaction as being the parent's responsibility. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN12897"></a><span class='Declare_Function'>AtEOSubXact_on_commit_actions</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isCommit</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN400"><span class='Ref_to_Typedef'>SubTransactionId</span></a> <span class='Declare_Parameter'>mySubid</span><span class='Delimiter'>, 
</span><a name="LN12898"></a>                              <a href="../../include/c.h.html#LN400"><span class='Ref_to_Typedef'>SubTransactionId</span></a> <span class='Declare_Parameter'>parentSubid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN12900"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cur_item</span><span class='Delimiter'>; 
</span><a name="LN12901"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>prev_item</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN12901"><span class='Ref_To_Local'>prev_item</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN12900"><span class='Ref_To_Local'>cur_item</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN123"><span class='Ref_to_Global_Var'>on_commits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12900"><span class='Ref_To_Local'>cur_item</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN12908"></a>        <a href="tablecmds.c.html#LN107"><span class='Ref_to_Struct'>OnCommitItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>oc</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN107"><span class='Ref_to_Struct'>OnCommitItem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12900"><span class='Ref_To_Local'>cur_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN12897"><span class='Ref_to_Parameter'>isCommit</span></a> <span class='Operator'>&& </span><a href="tablecmds.c.html#LN12908"><span class='Ref_To_Local'>oc</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN119"><span class='Ref_to_Member'>creating_subid</span></a> <span class='Operator'>== </span><a href="tablecmds.c.html#LN12897"><span class='Ref_to_Parameter'>mySubid</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* cur_item must be removed */ 
</span>            <a href="tablecmds.c.html#LN123"><span class='Ref_to_Global_Var'>on_commits</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN238"><span class='Ref_to_Proto'>list_delete_cell</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN123"><span class='Ref_to_Global_Var'>on_commits</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12900"><span class='Ref_To_Local'>cur_item</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12901"><span class='Ref_To_Local'>prev_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12908"><span class='Ref_To_Local'>oc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12901"><span class='Ref_To_Local'>prev_item</span></a><span class='Parentheses'>) 
</span>                <a href="tablecmds.c.html#LN12900"><span class='Ref_To_Local'>cur_item</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12901"><span class='Ref_To_Local'>prev_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="tablecmds.c.html#LN12900"><span class='Ref_To_Local'>cur_item</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN123"><span class='Ref_to_Global_Var'>on_commits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* cur_item must be preserved */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12908"><span class='Ref_To_Local'>oc</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN119"><span class='Ref_to_Member'>creating_subid</span></a> <span class='Operator'>== </span><a href="tablecmds.c.html#LN12897"><span class='Ref_to_Parameter'>mySubid</span></a><span class='Parentheses'>) 
</span>                <a href="tablecmds.c.html#LN12908"><span class='Ref_To_Local'>oc</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN119"><span class='Ref_to_Member'>creating_subid</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN12898"><span class='Ref_to_Parameter'>parentSubid</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12908"><span class='Ref_To_Local'>oc</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN120"><span class='Ref_to_Member'>deleting_subid</span></a> <span class='Operator'>== </span><a href="tablecmds.c.html#LN12897"><span class='Ref_to_Parameter'>mySubid</span></a><span class='Parentheses'>) 
</span>                <a href="tablecmds.c.html#LN12908"><span class='Ref_To_Local'>oc</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN120"><span class='Ref_to_Member'>deleting_subid</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN12897"><span class='Ref_to_Parameter'>isCommit</span></a> <span class='Operator'>? </span><a href="tablecmds.c.html#LN12898"><span class='Ref_to_Parameter'>parentSubid</span></a> <span class='Operator'>: </span><a href="../../include/c.h.html#LN402"><span class='Ref_to_Const'>InvalidSubTransactionId</span></a><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN12901"><span class='Ref_To_Local'>prev_item</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN12900"><span class='Ref_To_Local'>cur_item</span></a><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN12900"><span class='Ref_To_Local'>cur_item</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12901"><span class='Ref_To_Local'>prev_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while cur_item!=NULL &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end AtEOSubXact_on_commit_actions &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * This is intended as a callback for RangeVarGetRelidExtended().  It allows 
 * the relation to be locked only if (1) it's a plain table, materialized 
 * view, or TOAST table and (2) the current user is the owner (or the 
 * superuser).  This meets the permission-checking needs of CLUSTER, REINDEX 
 * TABLE, and REFRESH MATERIALIZED VIEW; we expose it here so that it can be 
 * used by all. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN12942"></a><span class='Declare_Function'>RangeVarCallbackOwnsTable</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>relation</span><span class='Delimiter'>, 
</span><a name="LN12943"></a>                          <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relId</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oldRelId</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN12945"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>relkind</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Nothing to do if the relation was not found. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12943"><span class='Ref_to_Parameter'>relId</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the relation does exist, check whether it's an index.  But note that 
     * the relation might have been dropped between the time we did the name 
     * lookup and now.  In that case, there's nothing to do. 
     */ 
</span>    <a href="tablecmds.c.html#LN12945"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN127"><span class='Ref_to_Proto'>get_rel_relkind</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12943"><span class='Ref_to_Parameter'>relId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN12945"><span class='Ref_To_Local'>relkind</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12945"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a> <span class='Operator'>&& </span><a href="tablecmds.c.html#LN12945"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN162"><span class='Ref_to_Const'>RELKIND_TOASTVALUE</span></a> <span class='Operator'>&& 
</span>        <a href="tablecmds.c.html#LN12945"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a> <span class='Operator'>&& </span><a href="tablecmds.c.html#LN12945"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a table or materialized view"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12942"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check permissions */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN308"><span class='Ref_to_Proto'>pg_class_ownercheck</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12943"><span class='Ref_to_Parameter'>relId</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN181"><span class='Ref_to_EnumConst'>ACL_KIND_CLASS</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12942"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RangeVarCallbackOwnsTable &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Callback to RangeVarGetRelidExtended(), similar to 
 * RangeVarCallbackOwnsTable() but without checks on the type of the relation. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN12975"></a><span class='Declare_Function'>RangeVarCallbackOwnsRelation</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>relation</span><span class='Delimiter'>, 
</span><a name="LN12976"></a>                             <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relId</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oldRelId</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN12978"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Nothing to do if the relation was not found. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12976"><span class='Ref_to_Parameter'>relId</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN12978"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12976"><span class='Ref_to_Parameter'>relId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12978"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span>       <span class='Comment_Single_Line'>/* should not happen */ 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for relation %u"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN12976"><span class='Ref_to_Parameter'>relId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN308"><span class='Ref_to_Proto'>pg_class_ownercheck</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12976"><span class='Ref_to_Parameter'>relId</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN181"><span class='Ref_to_EnumConst'>ACL_KIND_CLASS</span></a><span class='Delimiter'>, 
</span>                       <a href="tablecmds.c.html#LN12975"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/init/globals.c.html#LN111"><span class='Ref_to_Global_Var'>allowSystemTableMods</span></a> <span class='Operator'>&& 
</span>        <a href="../../include/catalog/catalog.h.html#LN33"><span class='Ref_to_Proto'>IsSystemClass</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12976"><span class='Ref_to_Parameter'>relId</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12978"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied: \"%s\" is a system catalog"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN12975"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN12978"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RangeVarCallbackOwnsRelation &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Common RangeVarGetRelid callback for rename, set schema, and alter table 
 * processing. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN13007"></a><span class='Declare_Function'>RangeVarCallbackForAlterRelation</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rv</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oldrelid</span><span class='Delimiter'>, 
</span><a name="LN13008"></a>                                 <span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN13010"></a>    <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>stmt</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN13008"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>; 
</span><a name="LN13011"></a>    <a href="../../include/nodes/parsenodes.h.html#LN1583"><span class='Ref_to_Enum'>ObjectType</span></a>  <span class='Declare_Local'>reltype</span><span class='Delimiter'>; 
</span><a name="LN13012"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN13013"></a>    <a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Local'>classform</span><span class='Delimiter'>; 
</span><a name="LN13014"></a>    <a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span><a name="LN13015"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>relkind</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN13012"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13007"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13012"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span><span class='Delimiter'>;</span>                 <span class='Comment_Single_Line'>/* concurrently dropped */ 
</span>    <a href="tablecmds.c.html#LN13013"><span class='Ref_To_Local'>classform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13012"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN13015"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN13013"><span class='Ref_To_Local'>classform</span></a><span class='Operator'>-&GT;</span>relkind<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Must own relation. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN308"><span class='Ref_to_Proto'>pg_class_ownercheck</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13007"><span class='Ref_to_Parameter'>relid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN181"><span class='Ref_to_EnumConst'>ACL_KIND_CLASS</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13007"><span class='Ref_to_Parameter'>rv</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* No system table modifications unless explicitly allowed. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/init/globals.c.html#LN111"><span class='Ref_to_Global_Var'>allowSystemTableMods</span></a> <span class='Operator'>&& </span><a href="../../include/catalog/catalog.h.html#LN33"><span class='Ref_to_Proto'>IsSystemClass</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13007"><span class='Ref_to_Parameter'>relid</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13013"><span class='Ref_To_Local'>classform</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied: \"%s\" is a system catalog"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN13007"><span class='Ref_to_Parameter'>rv</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Extract the specified relation type from the statement parse tree. 
     * 
     * Also, for ALTER .. RENAME, check permissions: the user must (still) 
     * have CREATE rights on the containing namespace. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13010"><span class='Ref_To_Local'>stmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2770"><span class='Ref_to_Struct'>RenameStmt</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN13014"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN289"><span class='Ref_to_Proto'>pg_namespace_aclcheck</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13013"><span class='Ref_To_Local'>classform</span></a><span class='Operator'>-&GT;</span>relnamespace<span class='Delimiter'>, 
</span>                                          <a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN81"><span class='Ref_to_Const'>ACL_CREATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13014"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13014"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN189"><span class='Ref_to_EnumConst'>ACL_KIND_NAMESPACE</span></a><span class='Delimiter'>, 
</span>                           <a href="../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13013"><span class='Ref_To_Local'>classform</span></a><span class='Operator'>-&GT;</span>relnamespace<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN13011"><span class='Ref_To_Local'>reltype</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/nodes/parsenodes.h.html#LN2770"><span class='Ref_to_Struct'>RenameStmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN13010"><span class='Ref_To_Local'>stmt</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>renameType<span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13010"><span class='Ref_To_Local'>stmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2801"><span class='Ref_to_Struct'>AlterObjectSchemaStmt</span></a><span class='Parentheses'>))</span> 
        <a href="tablecmds.c.html#LN13011"><span class='Ref_To_Local'>reltype</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/nodes/parsenodes.h.html#LN2801"><span class='Ref_to_Struct'>AlterObjectSchemaStmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN13010"><span class='Ref_To_Local'>stmt</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>objectType<span class='Delimiter'>; 
</span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13010"><span class='Ref_To_Local'>stmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1662"><span class='Ref_to_Struct'>AlterTableStmt</span></a><span class='Parentheses'>))</span> 
        <a href="tablecmds.c.html#LN13011"><span class='Ref_To_Local'>reltype</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/nodes/parsenodes.h.html#LN1662"><span class='Ref_to_Struct'>AlterTableStmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN13010"><span class='Ref_To_Local'>stmt</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>relkind<span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="tablecmds.c.html#LN13011"><span class='Ref_To_Local'>reltype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN1622"><span class='Ref_to_EnumConst'>OBJECT_TABLE</span></a><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* placate compiler */ 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized node type: %d"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="../../include/nodes/nodes.h.html#LN513"><span class='Ref_to_Macro'>nodeTag</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13010"><span class='Ref_To_Local'>stmt</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * For compatibility with prior releases, we allow ALTER TABLE to be used 
     * with most other types of relations (but not composite types). We allow 
     * similar flexibility for ALTER INDEX in the case of RENAME, but not 
     * otherwise.  Otherwise, the user must select the correct form of the 
     * command for the relation at issue. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13011"><span class='Ref_To_Local'>reltype</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN1618"><span class='Ref_to_EnumConst'>OBJECT_SEQUENCE</span></a> <span class='Operator'>&& </span><a href="tablecmds.c.html#LN13015"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a sequence"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13007"><span class='Ref_to_Parameter'>rv</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13011"><span class='Ref_To_Local'>reltype</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN1632"><span class='Ref_to_EnumConst'>OBJECT_VIEW</span></a> <span class='Operator'>&& </span><a href="tablecmds.c.html#LN13015"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN163"><span class='Ref_to_Const'>RELKIND_VIEW</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a view"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13007"><span class='Ref_to_Parameter'>rv</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13011"><span class='Ref_To_Local'>reltype</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN1608"><span class='Ref_to_EnumConst'>OBJECT_MATVIEW</span></a> <span class='Operator'>&& </span><a href="tablecmds.c.html#LN13015"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a materialized view"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13007"><span class='Ref_to_Parameter'>rv</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13011"><span class='Ref_To_Local'>reltype</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN1603"><span class='Ref_to_EnumConst'>OBJECT_FOREIGN_TABLE</span></a> <span class='Operator'>&& </span><a href="tablecmds.c.html#LN13015"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a foreign table"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13007"><span class='Ref_to_Parameter'>rv</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13011"><span class='Ref_To_Local'>reltype</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN1630"><span class='Ref_to_EnumConst'>OBJECT_TYPE</span></a> <span class='Operator'>&& </span><a href="tablecmds.c.html#LN13015"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN165"><span class='Ref_to_Const'>RELKIND_COMPOSITE_TYPE</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a composite type"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13007"><span class='Ref_to_Parameter'>rv</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13011"><span class='Ref_To_Local'>reltype</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN1605"><span class='Ref_to_EnumConst'>OBJECT_INDEX</span></a> <span class='Operator'>&& </span><a href="tablecmds.c.html#LN13015"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN160"><span class='Ref_to_Const'>RELKIND_INDEX</span></a> 
        <span class='Operator'>&& !</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13010"><span class='Ref_To_Local'>stmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2770"><span class='Ref_to_Struct'>RenameStmt</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not an index"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13007"><span class='Ref_to_Parameter'>rv</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Don't allow ALTER TABLE on composite types. We want people to use ALTER 
     * TYPE for that. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13011"><span class='Ref_To_Local'>reltype</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/parsenodes.h.html#LN1630"><span class='Ref_to_EnumConst'>OBJECT_TYPE</span></a> <span class='Operator'>&& </span><a href="tablecmds.c.html#LN13015"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN165"><span class='Ref_to_Const'>RELKIND_COMPOSITE_TYPE</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is a composite type"</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13007"><span class='Ref_to_Parameter'>rv</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Use ALTER TYPE instead."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Don't allow ALTER TABLE .. SET SCHEMA on relations that can't be moved 
     * to a different schema, such as indexes and TOAST tables. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13010"><span class='Ref_To_Local'>stmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2801"><span class='Ref_to_Struct'>AlterObjectSchemaStmt</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <a href="tablecmds.c.html#LN13015"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a> <span class='Operator'>&& 
</span>        <a href="tablecmds.c.html#LN13015"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN163"><span class='Ref_to_Const'>RELKIND_VIEW</span></a> <span class='Operator'>&& 
</span>        <a href="tablecmds.c.html#LN13015"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a> <span class='Operator'>&& 
</span>        <a href="tablecmds.c.html#LN13015"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a> <span class='Operator'>&& 
</span>        <a href="tablecmds.c.html#LN13015"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a> <span class='Operator'>&& 
</span>        <a href="tablecmds.c.html#LN13015"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a table, view, materialized view, sequence, or foreign table"</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN13007"><span class='Ref_to_Parameter'>rv</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13012"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RangeVarCallbackForAlterRelation &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Transform any expressions present in the partition key 
 * 
 * Returns a transformed PartitionSpec, as well as the strategy code 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/nodes/parsenodes.h.html#LN777"><span class='Ref_to_Struct'>PartitionSpec</span></a> <span class='Operator'>* 
</span><a name="LN13133"></a><span class='Declare_Function'>transformPartitionSpec</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN777"><span class='Ref_to_Struct'>PartitionSpec</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>partspec</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>strategy</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN13135"></a>    <a href="../../include/nodes/parsenodes.h.html#LN777"><span class='Ref_to_Struct'>PartitionSpec</span></a> <span class='Operator'>*</span><span class='Declare_Local'>newspec</span><span class='Delimiter'>; 
</span><a name="LN13136"></a>    <a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pstate</span><span class='Delimiter'>; 
</span><a name="LN13137"></a>    <a href="../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rte</span><span class='Delimiter'>; 
</span><a name="LN13138"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN13135"><span class='Ref_To_Local'>newspec</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN777"><span class='Ref_to_Struct'>PartitionSpec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN13135"><span class='Ref_To_Local'>newspec</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN780"><span class='Ref_to_Member'>strategy</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN13133"><span class='Ref_to_Parameter'>partspec</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN780"><span class='Ref_to_Member'>strategy</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN13135"><span class='Ref_To_Local'>newspec</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN781"><span class='Ref_to_Member'>partParams</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN13135"><span class='Ref_To_Local'>newspec</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN782"><span class='Ref_to_Member'>location</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN13133"><span class='Ref_to_Parameter'>partspec</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN782"><span class='Ref_to_Member'>location</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Parse partitioning strategy name */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13133"><span class='Ref_to_Parameter'>partspec</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN780"><span class='Ref_to_Member'>strategy</span></a><span class='Delimiter'>, </span><span class='String'>"list"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Operator'>*</span><a href="tablecmds.c.html#LN13133"><span class='Ref_to_Parameter'>strategy</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN786"><span class='Ref_to_Const'>PARTITION_STRATEGY_LIST</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13133"><span class='Ref_to_Parameter'>partspec</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN780"><span class='Ref_to_Member'>strategy</span></a><span class='Delimiter'>, </span><span class='String'>"range"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Operator'>*</span><a href="tablecmds.c.html#LN13133"><span class='Ref_to_Parameter'>strategy</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN787"><span class='Ref_to_Const'>PARTITION_STRATEGY_RANGE</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unrecognized partitioning strategy \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="tablecmds.c.html#LN13133"><span class='Ref_to_Parameter'>partspec</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN780"><span class='Ref_to_Member'>strategy</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check valid number of columns for strategy */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="tablecmds.c.html#LN13133"><span class='Ref_to_Parameter'>strategy</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN786"><span class='Ref_to_Const'>PARTITION_STRATEGY_LIST</span></a> <span class='Operator'>&& 
</span>        <a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13133"><span class='Ref_to_Parameter'>partspec</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN781"><span class='Ref_to_Member'>partParams</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot use \"list\" partition strategy with more than one column"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create a dummy ParseState and insert the target relation as its sole 
     * rangetable entry.  We need a ParseState for transformExpr. 
     */ 
</span>    <a href="tablecmds.c.html#LN13136"><span class='Ref_To_Local'>pstate</span></a> <span class='Operator'>= </span><a href="../parser/parse_node.c.html#LN42"><span class='Ref_to_Func'>make_parsestate</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN13137"><span class='Ref_To_Local'>rte</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_relation.h.html#LN69"><span class='Ref_to_Proto'>addRangeTableEntryForRelation</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13136"><span class='Ref_To_Local'>pstate</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13133"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/parser/parse_relation.h.html#LN114"><span class='Ref_to_Proto'>addRTEtoQuery</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13136"><span class='Ref_To_Local'>pstate</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13137"><span class='Ref_To_Local'>rte</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* take care of any partition expressions */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13138"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13133"><span class='Ref_to_Parameter'>partspec</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN781"><span class='Ref_to_Member'>partParams</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN13175"></a>        <a href="../../include/nodes/parsenodes.h.html#LN762"><span class='Ref_to_Struct'>PartitionElem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pelem</span> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN762"><span class='Ref_to_Struct'>PartitionElem</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13138"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN13176"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Check for PARTITION BY ... (foo, foo) */ 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13176"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13135"><span class='Ref_To_Local'>newspec</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN781"><span class='Ref_to_Member'>partParams</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN13181"></a>            <a href="../../include/nodes/parsenodes.h.html#LN762"><span class='Ref_to_Struct'>PartitionElem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pparam</span> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN762"><span class='Ref_to_Struct'>PartitionElem</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13176"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13175"><span class='Ref_To_Local'>pelem</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN765"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>&& </span><a href="tablecmds.c.html#LN13181"><span class='Ref_To_Local'>pparam</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN765"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>&& 
</span>                strcmp<span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13175"><span class='Ref_To_Local'>pelem</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN765"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13181"><span class='Ref_To_Local'>pparam</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN765"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DUPLICATE_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" appears more than once in partition key"</span><span class='Delimiter'>, 
</span>                                <a href="tablecmds.c.html#LN13175"><span class='Ref_To_Local'>pelem</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN765"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13136"><span class='Ref_To_Local'>pstate</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13175"><span class='Ref_To_Local'>pelem</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN769"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13175"><span class='Ref_To_Local'>pelem</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN766"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Copy, to avoid scribbling on the input */ 
</span>            <a href="tablecmds.c.html#LN13175"><span class='Ref_To_Local'>pelem</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13175"><span class='Ref_To_Local'>pelem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Now do parse transformation of the expression */ 
</span>            <a href="tablecmds.c.html#LN13175"><span class='Ref_To_Local'>pelem</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN766"><span class='Ref_to_Member'>expr</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_expr.h.html#LN21"><span class='Ref_to_Proto'>transformExpr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13136"><span class='Ref_To_Local'>pstate</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13175"><span class='Ref_To_Local'>pelem</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN766"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../include/parser/parse_node.h.html#LN69"><span class='Ref_to_EnumConst'>EXPR_KIND_PARTITION_EXPRESSION</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* we have to fix its collations too */ 
</span>            <a href="../../include/parser/parse_collate.h.html#LN22"><span class='Ref_to_Proto'>assign_expr_collations</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13136"><span class='Ref_To_Local'>pstate</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13175"><span class='Ref_To_Local'>pelem</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN766"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="tablecmds.c.html#LN13135"><span class='Ref_To_Local'>newspec</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN781"><span class='Ref_to_Member'>partParams</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13135"><span class='Ref_To_Local'>newspec</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN781"><span class='Ref_to_Member'>partParams</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13175"><span class='Ref_To_Local'>pelem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN13135"><span class='Ref_To_Local'>newspec</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end transformPartitionSpec &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Compute per-partition-column information from a list of PartitionElems. 
 * Expressions in the PartitionElems must be parse-analyzed already. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN13216"></a><span class='Declare_Function'>ComputePartitionAttrs</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>partParams</span><span class='Delimiter'>, </span><a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>partattrs</span><span class='Delimiter'>, 
</span><a name="LN13217"></a>                      <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>partexprs</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>partopclass</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>partcollation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN13219"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>attn</span><span class='Delimiter'>; 
</span><a name="LN13220"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN13219"><span class='Ref_To_Local'>attn</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13220"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13216"><span class='Ref_to_Parameter'>partParams</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN13225"></a>        <a href="../../include/nodes/parsenodes.h.html#LN762"><span class='Ref_to_Struct'>PartitionElem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pelem</span> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN762"><span class='Ref_to_Struct'>PartitionElem</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13220"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN13226"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>atttype</span><span class='Delimiter'>; 
</span><a name="LN13227"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>attcollation</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13225"><span class='Ref_To_Local'>pelem</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN765"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Simple attribute reference */ 
</span><a name="LN13232"></a>            <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>atttuple</span><span class='Delimiter'>; 
</span><a name="LN13233"></a>            <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>attform</span><span class='Delimiter'>; 
</span> 
            <a href="tablecmds.c.html#LN13232"><span class='Ref_To_Local'>atttuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN129"><span class='Ref_to_Proto'>SearchSysCacheAttName</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13216"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                             <a href="tablecmds.c.html#LN13225"><span class='Ref_To_Local'>pelem</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN765"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13232"><span class='Ref_To_Local'>atttuple</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" named in partition key does not exist"</span><span class='Delimiter'>, 
</span>                       <a href="tablecmds.c.html#LN13225"><span class='Ref_To_Local'>pelem</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN765"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN13233"><span class='Ref_To_Local'>attform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13232"><span class='Ref_To_Local'>atttuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13233"><span class='Ref_To_Local'>attform</span></a><span class='Operator'>-&GT;</span>attnum <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                   <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot use system column \"%s\" in partition key"</span><span class='Delimiter'>, 
</span>                          <a href="tablecmds.c.html#LN13225"><span class='Ref_To_Local'>pelem</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN765"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <a href="tablecmds.c.html#LN13216"><span class='Ref_to_Parameter'>partattrs</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN13219"><span class='Ref_To_Local'>attn</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="tablecmds.c.html#LN13233"><span class='Ref_To_Local'>attform</span></a><span class='Operator'>-&GT;</span>attnum<span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN13226"><span class='Ref_To_Local'>atttype</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN13233"><span class='Ref_To_Local'>attform</span></a><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN13227"><span class='Ref_To_Local'>attcollation</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN13233"><span class='Ref_To_Local'>attform</span></a><span class='Operator'>-&GT;</span>attcollation<span class='Delimiter'>; 
</span>            <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13232"><span class='Ref_To_Local'>atttuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if pelem-&GT;name!=NULL &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Expression */ 
</span><a name="LN13258"></a>            <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><a href="tablecmds.c.html#LN13225"><span class='Ref_To_Local'>pelem</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN766"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>; 
</span> 
            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13258"><span class='Ref_To_Local'>expr</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN13226"><span class='Ref_To_Local'>atttype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13258"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN13227"><span class='Ref_To_Local'>attcollation</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodeFuncs.h.html#LN38"><span class='Ref_to_Proto'>exprCollation</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13258"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Strip any top-level COLLATE clause.  This ensures that we treat 
             * "x COLLATE y" and "(x COLLATE y)" alike. 
             */ 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13258"><span class='Ref_To_Local'>expr</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN871"><span class='Ref_to_Struct'>CollateExpr</span></a><span class='Parentheses'>))</span> 
                <a href="tablecmds.c.html#LN13258"><span class='Ref_To_Local'>expr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) ((</span><a href="../../include/nodes/primnodes.h.html#LN871"><span class='Ref_to_Struct'>CollateExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN13258"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>arg<span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13258"><span class='Ref_To_Local'>expr</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>                <span class='Parentheses'>((</span><a href="../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN13258"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>varattno <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * User wrote "(column)" or "(column COLLATE something)". 
                 * Treat it like simple attribute anyway. 
                 */ 
</span>                <a href="tablecmds.c.html#LN13216"><span class='Ref_to_Parameter'>partattrs</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN13219"><span class='Ref_To_Local'>attn</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN13258"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>varattno<span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span><a name="LN13282"></a>                <a href="../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>expr_attrs</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN13283"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
                <a href="tablecmds.c.html#LN13216"><span class='Ref_to_Parameter'>partattrs</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN13219"><span class='Ref_To_Local'>attn</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* marks the column as expression */ 
</span>                <span class='Operator'>*</span><a href="tablecmds.c.html#LN13217"><span class='Ref_to_Parameter'>partexprs</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="tablecmds.c.html#LN13217"><span class='Ref_to_Parameter'>partexprs</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13258"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Try to simplify the expression before checking for 
                 * mutability.  The main practical value of doing it in this 
                 * order is that an inline-able SQL-language function will be 
                 * accepted if its expansion is immutable, whether or not the 
                 * function itself is marked immutable. 
                 * 
                 * Note that expression_planner does not change the passed in 
                 * expression destructively and we have already saved the 
                 * expression to be stored into the catalog above. 
                 */ 
</span>                <a href="tablecmds.c.html#LN13258"><span class='Ref_To_Local'>expr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/optimizer/planner.h.html#LN53"><span class='Ref_to_Proto'>expression_planner</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN13258"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Partition expression cannot contain mutable functions, 
                 * because a given row must always map to the same partition 
                 * as long as there is no change in the partition boundary 
                 * structure. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/optimizer/clauses.h.html#LN59"><span class='Ref_to_Proto'>contain_mutable_functions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13258"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>))</span> 
                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"functions in partition key expression must be marked IMMUTABLE"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * transformPartitionSpec() should have already rejected 
                 * subqueries, aggregates, window functions, and SRFs, based 
                 * on the EXPR_KIND_ for partition expressions. 
                 */ 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Cannot have expressions containing whole-row references or 
                 * system column references. 
                 */ 
</span>                <a href="../../include/optimizer/var.h.html#LN31"><span class='Ref_to_Proto'>pull_varattnos</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13258"><span class='Ref_To_Local'>expr</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN13282"><span class='Ref_To_Local'>expr_attrs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/bitmapset.h.html#LN75"><span class='Ref_to_Proto'>bms_is_member</span></a><span class='Parentheses'>(</span><span class='Number'>0</span> <span class='Operator'>- </span><a href="../../include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a><span class='Delimiter'>, 
</span>                                  <a href="tablecmds.c.html#LN13282"><span class='Ref_To_Local'>expr_attrs</span></a><span class='Parentheses'>))</span> 
                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"partition key expressions cannot contain whole-row references"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13283"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="../../include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN13283"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN13283"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/bitmapset.h.html#LN75"><span class='Ref_to_Proto'>bms_is_member</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13283"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><a href="../../include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a><span class='Delimiter'>, 
</span>                                      <a href="tablecmds.c.html#LN13282"><span class='Ref_To_Local'>expr_attrs</span></a><span class='Parentheses'>))</span> 
                        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"partition key expressions cannot contain system column references"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * While it is not exactly *wrong* for a partition expression 
                 * to be a constant, it seems better to reject such keys. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13258"><span class='Ref_To_Local'>expr</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a><span class='Parentheses'>))</span> 
                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot use constant expression as partition key"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * Apply collation override if any 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13225"><span class='Ref_To_Local'>pelem</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN767"><span class='Ref_to_Member'>collation</span></a><span class='Parentheses'>) 
</span>            <a href="tablecmds.c.html#LN13227"><span class='Ref_To_Local'>attcollation</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN142"><span class='Ref_to_Proto'>get_collation_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13225"><span class='Ref_To_Local'>pelem</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN767"><span class='Ref_to_Member'>collation</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Check we have a collation iff it's a collatable type.  The only 
         * expected failures here are (1) COLLATE applied to a noncollatable 
         * type, or (2) partition expression had an unresolved collation. But 
         * we might as well code this to be a complete consistency check. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/lsyscache.h.html#LN167"><span class='Ref_to_Proto'>type_is_collatable</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13226"><span class='Ref_To_Local'>atttype</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13227"><span class='Ref_To_Local'>attcollation</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INDETERMINATE_COLLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not determine which collation to use for partition expression"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Use the COLLATE clause to set the collation explicitly."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13227"><span class='Ref_To_Local'>attcollation</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"collations are not supported by type %s"</span><span class='Delimiter'>, 
</span>                                <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13226"><span class='Ref_To_Local'>atttype</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="tablecmds.c.html#LN13217"><span class='Ref_to_Parameter'>partcollation</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN13219"><span class='Ref_To_Local'>attn</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="tablecmds.c.html#LN13227"><span class='Ref_To_Local'>attcollation</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Identify a btree opclass to use. Currently, we use only btree 
         * operators, which seems enough for list and range partitioning. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN13225"><span class='Ref_To_Local'>pelem</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN768"><span class='Ref_to_Member'>opclass</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="tablecmds.c.html#LN13217"><span class='Ref_to_Parameter'>partopclass</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN13219"><span class='Ref_To_Local'>attn</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/commands/defrem.h.html#LN44"><span class='Ref_to_Proto'>GetDefaultOpClass</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13226"><span class='Ref_To_Local'>atttype</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_am.h.html#LN69"><span class='Ref_to_Const'>BTREE_AM_OID</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13217"><span class='Ref_to_Parameter'>partopclass</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN13219"><span class='Ref_To_Local'>attn</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                   <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"data type %s has no default btree operator class"</span><span class='Delimiter'>, 
</span>                          <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13226"><span class='Ref_To_Local'>atttype</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"You must specify a btree operator class or define a default btree operator class for the data type."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="tablecmds.c.html#LN13217"><span class='Ref_to_Parameter'>partopclass</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN13219"><span class='Ref_To_Local'>attn</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/commands/defrem.h.html#LN45"><span class='Ref_to_Proto'>ResolveOpClass</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13225"><span class='Ref_To_Local'>pelem</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN768"><span class='Ref_to_Member'>opclass</span></a><span class='Delimiter'>, 
</span>                                               <a href="tablecmds.c.html#LN13226"><span class='Ref_To_Local'>atttype</span></a><span class='Delimiter'>, 
</span>                                               <span class='String'>"btree"</span><span class='Delimiter'>, 
</span>                                               <a href="../../include/catalog/pg_am.h.html#LN69"><span class='Ref_to_Const'>BTREE_AM_OID</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="tablecmds.c.html#LN13219"><span class='Ref_To_Local'>attn</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end ComputePartitionAttrs &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ALTER TABLE &LT;name&GT; ATTACH PARTITION &LT;partition-name&GT; FOR VALUES 
 * 
 * Return the address of the newly attached partition. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN13410"></a><span class='Declare_Function'>ATExecAttachPartition</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>wqueue</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN829"><span class='Ref_to_Struct'>PartitionCmd</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cmd</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN13412"></a>    <a href="../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Local'>key</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN584"><span class='Ref_to_Macro'>RelationGetPartitionKey</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13410"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN13413"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>attachRel</span><span class='Delimiter'>, 
</span><a name="LN13414"></a>                <span class='Declare_Local'>catalog</span><span class='Delimiter'>; 
</span><a name="LN13415"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>childrels</span><span class='Delimiter'>; 
</span><a name="LN13416"></a>    <a href="../../include/access/tupdesc.h.html#LN36"><span class='Ref_to_Typedef'>TupleConstr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>attachRel_constr</span><span class='Delimiter'>; 
</span><a name="LN13417"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>partConstraint</span><span class='Delimiter'>, 
</span><a name="LN13418"></a>               <span class='Operator'>*</span><span class='Declare_Local'>existConstraint</span><span class='Delimiter'>; 
</span><a name="LN13419"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN13420"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>skey</span><span class='Delimiter'>; 
</span><a name="LN13421"></a>    <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>attno</span><span class='Delimiter'>; 
</span><a name="LN13422"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>natts</span><span class='Delimiter'>; 
</span><a name="LN13423"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupleDesc</span><span class='Delimiter'>; 
</span><a name="LN13424"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>skip_validate</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN13425"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN13413"><span class='Ref_To_Local'>attachRel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN92"><span class='Ref_to_Proto'>heap_openrv</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13410"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN832"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Must be owner of both parent and source table -- parent was checked by 
     * ATSimplePermissions call in ATPrepCmd 
     */ 
</span>    <a href="tablecmds.c.html#LN345"><span class='Ref_to_Proto'>ATSimplePermissions</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13413"><span class='Ref_To_Local'>attachRel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN278"><span class='Ref_to_Const'>ATT_TABLE</span></a> <span class='Operator'>| </span><a href="tablecmds.c.html#LN283"><span class='Ref_to_Const'>ATT_FOREIGN_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* A partition can only have one parent */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13413"><span class='Ref_To_Local'>attachRel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relispartition<span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is already a partition"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13413"><span class='Ref_To_Local'>attachRel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13413"><span class='Ref_To_Local'>attachRel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reloftype<span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot attach a typed table as partition"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Table being attached should not already be part of inheritance; either 
     * as a child table... 
     */ 
</span>    <a href="tablecmds.c.html#LN13414"><span class='Ref_To_Local'>catalog</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_inherits.h.html#LN28"><span class='Ref_to_Const'>InheritsRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN13420"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/catalog/pg_inherits.h.html#LN49"><span class='Ref_to_Const'>Anum_pg_inherits_inhrelid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13413"><span class='Ref_To_Local'>attachRel</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN13419"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13414"><span class='Ref_To_Local'>catalog</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN166"><span class='Ref_to_Const'>InheritsRelidSeqnoIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN13420"><span class='Ref_To_Local'>skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13419"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot attach inheritance child as partition"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13419"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* ...or as a parent table (except the case when it is partitioned) */ 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tablecmds.c.html#LN13420"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/catalog/pg_inherits.h.html#LN50"><span class='Ref_to_Const'>Anum_pg_inherits_inhparent</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13413"><span class='Ref_To_Local'>attachRel</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN13419"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13414"><span class='Ref_To_Local'>catalog</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN168"><span class='Ref_to_Const'>InheritsParentIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                              <span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN13420"><span class='Ref_To_Local'>skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13419"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>))</span> <span class='Operator'>&& 
</span>        <a href="tablecmds.c.html#LN13413"><span class='Ref_To_Local'>attachRel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot attach inheritance parent as partition"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13419"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13414"><span class='Ref_To_Local'>catalog</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Prevent circularity by seeing if rel is a partition of attachRel. (In 
     * particular, this disallows making a rel a partition of itself.) 
     */ 
</span>    <a href="tablecmds.c.html#LN13415"><span class='Ref_To_Local'>childrels</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_inherits_fn.h.html#LN20"><span class='Ref_to_Proto'>find_all_inheritors</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13413"><span class='Ref_To_Local'>attachRel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                    <a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN231"><span class='Ref_to_Proto'>list_member_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13415"><span class='Ref_To_Local'>childrels</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13410"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DUPLICATE_TABLE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"circular inheritance not allowed"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is already a child of \"%s\"."</span><span class='Delimiter'>, 
</span>                           <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13410"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13413"><span class='Ref_To_Local'>attachRel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Temp parent cannot have a partition that is itself not a temp */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13410"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpersistence <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN171"><span class='Ref_to_Const'>RELPERSISTENCE_TEMP</span></a> <span class='Operator'>&& 
</span>        <a href="tablecmds.c.html#LN13413"><span class='Ref_To_Local'>attachRel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpersistence <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN171"><span class='Ref_to_Const'>RELPERSISTENCE_TEMP</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot attach a permanent relation as partition of temporary relation \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13410"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If the parent is temp, it must belong to this session */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13410"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpersistence <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN171"><span class='Ref_to_Const'>RELPERSISTENCE_TEMP</span></a> <span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="tablecmds.c.html#LN13410"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN89"><span class='Ref_to_Member'>rd_islocaltemp</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot attach as partition of temporary relation of another session"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Ditto for the partition */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13413"><span class='Ref_To_Local'>attachRel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relpersistence <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN171"><span class='Ref_to_Const'>RELPERSISTENCE_TEMP</span></a> <span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="tablecmds.c.html#LN13413"><span class='Ref_To_Local'>attachRel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN89"><span class='Ref_to_Member'>rd_islocaltemp</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot attach temporary relation of another session as partition"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If parent has OIDs then child must have OIDs */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13410"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relhasoids <span class='Operator'>&& !</span><a href="tablecmds.c.html#LN13413"><span class='Ref_To_Local'>attachRel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relhasoids<span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot attach table \"%s\" without OIDs as partition of"</span> 
               <span class='String'>" table \"%s\" with OIDs"</span><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13413"><span class='Ref_To_Local'>attachRel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13410"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* OTOH, if parent doesn't have them, do not allow in attachRel either */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13413"><span class='Ref_To_Local'>attachRel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relhasoids <span class='Operator'>&& !</span><a href="tablecmds.c.html#LN13410"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relhasoids<span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>          <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot attach table \"%s\" with OIDs as partition of table"</span> 
                 <span class='String'>" \"%s\" without OIDs"</span><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13413"><span class='Ref_To_Local'>attachRel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13410"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check if there are any columns in attachRel that aren't in the parent */ 
</span>    <a href="tablecmds.c.html#LN13423"><span class='Ref_To_Local'>tupleDesc</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13413"><span class='Ref_To_Local'>attachRel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN13422"><span class='Ref_To_Local'>natts</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN13423"><span class='Ref_To_Local'>tupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13421"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN13421"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>&LT;= </span><a href="tablecmds.c.html#LN13422"><span class='Ref_To_Local'>natts</span></a><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN13421"><span class='Ref_To_Local'>attno</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN13536"></a>        <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>attribute</span> <span class='Operator'>= </span><a href="tablecmds.c.html#LN13423"><span class='Ref_To_Local'>tupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN13421"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN13537"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>attributeName</span> <span class='Operator'>= </span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13536"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Ignore dropped */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13536"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Try to find the column in parent (matching on column name) */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/syscache.h.html#LN175"><span class='Ref_to_Macro'>SearchSysCacheExists2</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN39"><span class='Ref_to_EnumConst'>ATTNAME</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13410"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                                   <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13537"><span class='Ref_To_Local'>attributeName</span></a><span class='Parentheses'>)))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"table \"%s\" contains column \"%s\" not found in parent \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13413"><span class='Ref_To_Local'>attachRel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13537"><span class='Ref_To_Local'>attributeName</span></a><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13410"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"New partition should contain only the columns present in parent."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for attno=1;attno&LT;=natts;... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* OK to create inheritance.  Rest of the checks performed there */ 
</span>    <a href="tablecmds.c.html#LN471"><span class='Ref_to_Proto'>CreateInheritance</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13413"><span class='Ref_To_Local'>attachRel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13410"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check that the new partition's bound is valid and does not overlap any 
     * of existing partitions of the parent - note that it does not return on 
     * error. 
     */ 
</span>    <a href="../../include/catalog/partition.h.html#LN76"><span class='Ref_to_Proto'>check_new_partition_bound</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13413"><span class='Ref_To_Local'>attachRel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13410"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, 
</span>                              <a href="tablecmds.c.html#LN13410"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN833"><span class='Ref_to_Member'>bound</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Update the pg_class entry. */ 
</span>    <a href="../../include/catalog/heap.h.html#LN145"><span class='Ref_to_Proto'>StorePartitionBound</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13413"><span class='Ref_To_Local'>attachRel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13410"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13410"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN833"><span class='Ref_to_Member'>bound</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Generate partition constraint from the partition bound specification. 
     * If the parent itself is a partition, make sure to include its 
     * constraint as well. 
     */ 
</span>    <a href="tablecmds.c.html#LN13417"><span class='Ref_To_Local'>partConstraint</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/partition.h.html#LN79"><span class='Ref_to_Proto'>get_qual_from_partbound</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13413"><span class='Ref_To_Local'>attachRel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13410"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, 
</span>                                                         <a href="tablecmds.c.html#LN13410"><span class='Ref_to_Parameter'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN833"><span class='Ref_to_Member'>bound</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../../include/catalog/partition.h.html#LN83"><span class='Ref_to_Proto'>RelationGetPartitionQual</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13410"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN13417"><span class='Ref_To_Local'>partConstraint</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/optimizer/clauses.h.html#LN80"><span class='Ref_to_Proto'>eval_const_expressions</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                                     <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN13417"><span class='Ref_To_Local'>partConstraint</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN13417"><span class='Ref_To_Local'>partConstraint</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/optimizer/prep.h.html#LN35"><span class='Ref_to_Proto'>canonicalize_qual</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN13417"><span class='Ref_To_Local'>partConstraint</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN13417"><span class='Ref_To_Local'>partConstraint</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="../../include/optimizer/clauses.h.html#LN45"><span class='Ref_to_Proto'>make_ands_explicit</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13417"><span class='Ref_To_Local'>partConstraint</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check if we can do away with having to scan the table being attached to 
     * validate the partition constraint, by *proving* that the existing 
     * constraints of the table *imply* the partition predicate.  We include 
     * the table's check constraints and NOT NULL constraints in the list of 
     * clauses passed to predicate_implied_by(). 
     * 
     * There is a case in which we cannot rely on just the result of the 
     * proof. 
     */ 
</span>    <a href="tablecmds.c.html#LN13416"><span class='Ref_To_Local'>attachRel_constr</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN13423"><span class='Ref_To_Local'>tupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN75"><span class='Ref_to_Member'>constr</span></a><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN13418"><span class='Ref_To_Local'>existConstraint</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13416"><span class='Ref_To_Local'>attachRel_constr</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN13596"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>num_check</span> <span class='Operator'>= </span><a href="tablecmds.c.html#LN13416"><span class='Ref_To_Local'>attachRel_constr</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN41"><span class='Ref_to_Member'>num_check</span></a><span class='Delimiter'>; 
</span><a name="LN13597"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN13598"></a>        <a href="../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>not_null_attrs</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN13599"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>part_constr</span><span class='Delimiter'>; 
</span><a name="LN13600"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span><a name="LN13601"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>partition_accepts_null</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span><a name="LN13602"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>partnatts</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13416"><span class='Ref_To_Local'>attachRel_constr</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN42"><span class='Ref_to_Member'>has_not_null</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN13606"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>natts</span> <span class='Operator'>= </span><a href="tablecmds.c.html#LN13413"><span class='Ref_To_Local'>attachRel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13597"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN13597"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="tablecmds.c.html#LN13606"><span class='Ref_To_Local'>natts</span></a><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN13597"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN13610"></a>                <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>att</span> <span class='Operator'>= </span><a href="tablecmds.c.html#LN13413"><span class='Ref_To_Local'>attachRel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN13597"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13610"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>attnotnull <span class='Operator'>&& !</span><a href="tablecmds.c.html#LN13610"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN13614"></a>                    <a href="../../include/nodes/primnodes.h.html#LN1175"><span class='Ref_to_Struct'>NullTest</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>ntest</span> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN1175"><span class='Ref_to_Struct'>NullTest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="tablecmds.c.html#LN13614"><span class='Ref_To_Local'>ntest</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1178"><span class='Ref_to_Member'>arg</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/makefuncs.h.html#LN25"><span class='Ref_to_Proto'>makeVar</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                                  <a href="tablecmds.c.html#LN13597"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, 
</span>                                                  <a href="tablecmds.c.html#LN13610"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>, 
</span>                                                  <a href="tablecmds.c.html#LN13610"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>atttypmod<span class='Delimiter'>, 
</span>                                                  <a href="tablecmds.c.html#LN13610"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>attcollation<span class='Delimiter'>, 
</span>                                                  <span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="tablecmds.c.html#LN13614"><span class='Ref_To_Local'>ntest</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1179"><span class='Ref_to_Member'>nulltesttype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/primnodes.h.html#LN1172"><span class='Ref_to_EnumConst'>IS_NOT_NULL</span></a><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * argisrow=false is correct even for a composite column, 
                     * because attnotnull does not represent a SQL-spec IS NOT 
                     * NULL test in such a case, just IS DISTINCT FROM NULL. 
                     */ 
</span>                    <a href="tablecmds.c.html#LN13614"><span class='Ref_To_Local'>ntest</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1180"><span class='Ref_to_Member'>argisrow</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                    <a href="tablecmds.c.html#LN13614"><span class='Ref_To_Local'>ntest</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1181"><span class='Ref_to_Member'>location</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                    <a href="tablecmds.c.html#LN13418"><span class='Ref_To_Local'>existConstraint</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13418"><span class='Ref_To_Local'>existConstraint</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13614"><span class='Ref_To_Local'>ntest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="tablecmds.c.html#LN13598"><span class='Ref_To_Local'>not_null_attrs</span></a> <span class='Operator'>= </span><a href="../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13598"><span class='Ref_To_Local'>not_null_attrs</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13597"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if att-&GT;attnotnull&&!att... &raquo; </span> 
            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=1;i&LT;=natts;i++ &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if attachRel_constr-&GT;has... &raquo; </span> 
 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13597"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN13597"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tablecmds.c.html#LN13596"><span class='Ref_To_Local'>num_check</span></a><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN13597"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN13639"></a>            <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>cexpr</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If this constraint hasn't been fully validated yet, we must 
             * ignore it here. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN13416"><span class='Ref_To_Local'>attachRel_constr</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN39"><span class='Ref_to_Member'>check</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN13597"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/access/tupdesc.h.html#LN31"><span class='Ref_to_Member'>ccvalid</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <a href="tablecmds.c.html#LN13639"><span class='Ref_To_Local'>cexpr</span></a> <span class='Operator'>= </span><a href="../nodes/read.c.html#LN36"><span class='Ref_to_Func'>stringToNode</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13416"><span class='Ref_To_Local'>attachRel_constr</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN39"><span class='Ref_to_Member'>check</span></a><span class='Delimiter'>[</span><a href="tablecmds.c.html#LN13597"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/access/tupdesc.h.html#LN30"><span class='Ref_to_Member'>ccbin</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Run each expression through const-simplification and 
             * canonicalization.  It is necessary, because we will be 
             * comparing it to similarly-processed qual clauses, and may fail 
             * to detect valid matches without this. 
             */ 
</span>            <a href="tablecmds.c.html#LN13639"><span class='Ref_To_Local'>cexpr</span></a> <span class='Operator'>= </span><a href="../../include/optimizer/clauses.h.html#LN80"><span class='Ref_to_Proto'>eval_const_expressions</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13639"><span class='Ref_To_Local'>cexpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN13639"><span class='Ref_To_Local'>cexpr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/optimizer/prep.h.html#LN35"><span class='Ref_to_Proto'>canonicalize_qual</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN13639"><span class='Ref_To_Local'>cexpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="tablecmds.c.html#LN13418"><span class='Ref_To_Local'>existConstraint</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13418"><span class='Ref_To_Local'>existConstraint</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../include/optimizer/clauses.h.html#LN46"><span class='Ref_to_Proto'>make_ands_implicit</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN13639"><span class='Ref_To_Local'>cexpr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;num_check;i++ &raquo; </span> 
 
        <a href="tablecmds.c.html#LN13418"><span class='Ref_To_Local'>existConstraint</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="../../include/optimizer/clauses.h.html#LN45"><span class='Ref_to_Proto'>make_ands_explicit</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13418"><span class='Ref_To_Local'>existConstraint</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* And away we go ... */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/optimizer/predtest.h.html#LN19"><span class='Ref_to_Proto'>predicate_implied_by</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13417"><span class='Ref_To_Local'>partConstraint</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13418"><span class='Ref_To_Local'>existConstraint</span></a><span class='Parentheses'>))</span> 
            <a href="tablecmds.c.html#LN13424"><span class='Ref_To_Local'>skip_validate</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We choose to err on the safer side, i.e., give up on skipping the 
         * validation scan, if the partition key column doesn't have the NOT 
         * NULL constraint and the table is to become a list partition that 
         * does not accept nulls.  In this case, the partition predicate 
         * (partConstraint) does include an 'key IS NOT NULL' expression, 
         * however, because of the way predicate_implied_by_simple_clause() is 
         * designed to handle IS NOT NULL predicates in the absence of a IS 
         * NOT NULL clause, we cannot rely on just the above proof. 
         * 
         * That is not an issue in case of a range partition, because if there 
         * were no NOT NULL constraint defined on the key columns, an error 
         * would be thrown before we get here anyway.  That is not true, 
         * however, if any of the partition keys is an expression, which is 
         * handled below. 
         */ 
</span>        <a href="tablecmds.c.html#LN13599"><span class='Ref_To_Local'>part_constr</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13417"><span class='Ref_To_Local'>partConstraint</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tablecmds.c.html#LN13599"><span class='Ref_To_Local'>part_constr</span></a> <span class='Operator'>= </span><a href="../../include/optimizer/clauses.h.html#LN46"><span class='Ref_to_Proto'>make_ands_implicit</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN13599"><span class='Ref_To_Local'>part_constr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * part_constr contains an IS NOT NULL expression, if this is a list 
         * partition that does not accept nulls (in fact, also if this is a 
         * range partition and some partition key is an expression, but we 
         * never skip validation in that case anyway; see below) 
         */ 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13600"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13599"><span class='Ref_To_Local'>part_constr</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN13696"></a>            <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13600"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13696"><span class='Ref_To_Local'>expr</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN1175"><span class='Ref_to_Struct'>NullTest</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>                <span class='Parentheses'>((</span><a href="../../include/nodes/primnodes.h.html#LN1175"><span class='Ref_to_Struct'>NullTest</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN13696"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>nulltesttype <span class='Operator'>== </span><a href="../../include/nodes/primnodes.h.html#LN1172"><span class='Ref_to_EnumConst'>IS_NOT_NULL</span></a><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="tablecmds.c.html#LN13601"><span class='Ref_To_Local'>partition_accepts_null</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="tablecmds.c.html#LN13602"><span class='Ref_To_Local'>partnatts</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN595"><span class='Ref_to_Func'>get_partition_natts</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13412"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13597"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN13597"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tablecmds.c.html#LN13602"><span class='Ref_To_Local'>partnatts</span></a><span class='Delimiter'>; </span><a href="tablecmds.c.html#LN13597"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN13709"></a>            <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>partattno</span><span class='Delimiter'>; 
</span> 
            <a href="tablecmds.c.html#LN13709"><span class='Ref_To_Local'>partattno</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN610"><span class='Ref_to_Func'>get_partition_col_attnum</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13412"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13597"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* If partition key is an expression, must not skip validation */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN13601"><span class='Ref_To_Local'>partition_accepts_null</span></a> <span class='Operator'>&& 
</span>                <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13709"><span class='Ref_To_Local'>partattno</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                 <span class='Operator'>!</span><a href="../../include/nodes/bitmapset.h.html#LN75"><span class='Ref_to_Proto'>bms_is_member</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13709"><span class='Ref_To_Local'>partattno</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13598"><span class='Ref_To_Local'>not_null_attrs</span></a><span class='Parentheses'>)))</span> 
                <a href="tablecmds.c.html#LN13424"><span class='Ref_To_Local'>skip_validate</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if attachRel_constr!=NUL... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* It's safe to skip the validation scan after all */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13424"><span class='Ref_To_Local'>skip_validate</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN32"><span class='Ref_to_Const'>INFO</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"partition constraint for table \"%s\" is implied by existing constraints"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13413"><span class='Ref_To_Local'>attachRel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set up to have the table be scanned to validate the partition 
     * constraint (see partConstraint above).  If it's a partitioned table, we 
     * instead schedule its leaf partitions to be scanned. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN13424"><span class='Ref_To_Local'>skip_validate</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN13734"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>all_parts</span><span class='Delimiter'>; 
</span><a name="LN13735"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Take an exclusive lock on the partitions to be checked */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13413"><span class='Ref_To_Local'>attachRel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>            <a href="tablecmds.c.html#LN13734"><span class='Ref_To_Local'>all_parts</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_inherits_fn.h.html#LN20"><span class='Ref_to_Proto'>find_all_inheritors</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13413"><span class='Ref_To_Local'>attachRel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                            <a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="tablecmds.c.html#LN13734"><span class='Ref_To_Local'>all_parts</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN150"><span class='Ref_to_Macro'>list_make1_oid</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13413"><span class='Ref_To_Local'>attachRel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13735"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13734"><span class='Ref_To_Local'>all_parts</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN13746"></a>            <a href="tablecmds.c.html#LN153"><span class='Ref_to_Struct'>AlteredTableInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tab</span><span class='Delimiter'>; 
</span><a name="LN13747"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>part_relid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13735"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN13748"></a>            <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>part_rel</span><span class='Delimiter'>; 
</span><a name="LN13749"></a>            <a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>constr</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Lock already taken */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13747"><span class='Ref_To_Local'>part_relid</span></a> <span class='Operator'>!= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13413"><span class='Ref_To_Local'>attachRel</span></a><span class='Parentheses'>))</span> 
                <a href="tablecmds.c.html#LN13748"><span class='Ref_To_Local'>part_rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13747"><span class='Ref_To_Local'>part_relid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="tablecmds.c.html#LN13748"><span class='Ref_To_Local'>part_rel</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN13413"><span class='Ref_To_Local'>attachRel</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Skip if it's a partitioned table.  Only RELKIND_RELATION 
             * relations (ie, leaf partitions) need to be scanned. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13748"><span class='Ref_To_Local'>part_rel</span></a> <span class='Operator'>!= </span><a href="tablecmds.c.html#LN13413"><span class='Ref_To_Local'>attachRel</span></a> <span class='Operator'>&& 
</span>                <a href="tablecmds.c.html#LN13748"><span class='Ref_To_Local'>part_rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13748"><span class='Ref_To_Local'>part_rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* Grab a work queue entry */ 
</span>            <a href="tablecmds.c.html#LN13746"><span class='Ref_To_Local'>tab</span></a> <span class='Operator'>= </span><a href="tablecmds.c.html#LN344"><span class='Ref_to_Proto'>ATGetQueueEntry</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13410"><span class='Ref_to_Parameter'>wqueue</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13748"><span class='Ref_To_Local'>part_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Adjust constraint to match this partition */ 
</span>            <a href="tablecmds.c.html#LN13749"><span class='Ref_To_Local'>constr</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13417"><span class='Ref_To_Local'>partConstraint</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tablecmds.c.html#LN13746"><span class='Ref_To_Local'>tab</span></a><span class='Operator'>-&GT;</span><a href="tablecmds.c.html#LN169"><span class='Ref_to_Member'>partition_constraint</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                <a href="../../include/catalog/partition.h.html#LN81"><span class='Ref_to_Proto'>map_partition_varattnos</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tablecmds.c.html#LN13749"><span class='Ref_To_Local'>constr</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                        <a href="tablecmds.c.html#LN13748"><span class='Ref_To_Local'>part_rel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13410"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* keep our lock until commit */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13748"><span class='Ref_To_Local'>part_rel</span></a> <span class='Operator'>!= </span><a href="tablecmds.c.html#LN13413"><span class='Ref_To_Local'>attachRel</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13748"><span class='Ref_To_Local'>part_rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !skip_validate &raquo; </span> 
 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13425"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13413"><span class='Ref_To_Local'>attachRel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* keep our lock until commit */ 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13413"><span class='Ref_To_Local'>attachRel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN13425"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATExecAttachPartition &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ALTER TABLE DETACH PARTITION 
 * 
 * Return the address of the relation that is no longer a partition of rel. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN13796"></a><span class='Declare_Function'>ATExecDetachPartition</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN13798"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>partRel</span><span class='Delimiter'>, 
</span><a name="LN13799"></a>                <span class='Declare_Local'>classRel</span><span class='Delimiter'>; 
</span><a name="LN13800"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>, 
</span><a name="LN13801"></a>                <span class='Declare_Local'>newtuple</span><span class='Delimiter'>; 
</span><a name="LN13802"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>new_val</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_class.h.html#LN101"><span class='Ref_to_Const'>Natts_pg_class</span></a><span class='Delimiter'>]; 
</span><a name="LN13803"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>, 
</span><a name="LN13804"></a>                <span class='Declare_Local'>new_null</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_class.h.html#LN101"><span class='Ref_to_Const'>Natts_pg_class</span></a><span class='Delimiter'>], 
</span><a name="LN13805"></a>                <span class='Declare_Local'>new_repl</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_class.h.html#LN101"><span class='Ref_to_Const'>Natts_pg_class</span></a><span class='Delimiter'>]; 
</span><a name="LN13806"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <a href="tablecmds.c.html#LN13798"><span class='Ref_To_Local'>partRel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN92"><span class='Ref_to_Proto'>heap_openrv</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13796"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* All inheritance related checks are performed within the function */ 
</span>    <a href="tablecmds.c.html#LN472"><span class='Ref_to_Proto'>RemoveInheritance</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13798"><span class='Ref_To_Local'>partRel</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13796"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Update pg_class tuple */ 
</span>    <a href="tablecmds.c.html#LN13799"><span class='Ref_To_Local'>classRel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN13800"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13798"><span class='Ref_To_Local'>partRel</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(((</span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13800"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>relispartition<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13800"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN134"><span class='Ref_to_Const'>Anum_pg_class_relpartbound</span></a><span class='Delimiter'>, 
</span>                           <span class='Operator'>&</span><a href="tablecmds.c.html#LN13803"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tablecmds.c.html#LN13803"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Clear relpartbound and reset relispartition */ 
</span>    memset<span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13802"><span class='Ref_To_Local'>new_val</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13802"><span class='Ref_To_Local'>new_val</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13804"><span class='Ref_To_Local'>new_null</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13804"><span class='Ref_To_Local'>new_null</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13805"><span class='Ref_To_Local'>new_repl</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13805"><span class='Ref_To_Local'>new_repl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN13802"><span class='Ref_To_Local'>new_val</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_class.h.html#LN134"><span class='Ref_to_Const'>Anum_pg_class_relpartbound</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN13804"><span class='Ref_To_Local'>new_null</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_class.h.html#LN134"><span class='Ref_to_Const'>Anum_pg_class_relpartbound</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN13805"><span class='Ref_To_Local'>new_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_class.h.html#LN134"><span class='Ref_to_Const'>Anum_pg_class_relpartbound</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="tablecmds.c.html#LN13801"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13800"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13799"><span class='Ref_To_Local'>classRel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="tablecmds.c.html#LN13802"><span class='Ref_To_Local'>new_val</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13804"><span class='Ref_To_Local'>new_null</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13805"><span class='Ref_To_Local'>new_repl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>((</span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13801"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>relispartition <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13799"><span class='Ref_To_Local'>classRel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tablecmds.c.html#LN13801"><span class='Ref_To_Local'>newtuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="tablecmds.c.html#LN13801"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13801"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13799"><span class='Ref_To_Local'>classRel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Invalidate the parent's relcache so that the partition is no longer 
     * included in its partition descriptor. 
     */ 
</span>    <a href="../../include/utils/inval.h.html#LN43"><span class='Ref_to_Proto'>CacheInvalidateRelcache</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13796"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13806"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13798"><span class='Ref_To_Local'>partRel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* keep our lock until commit */ 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="tablecmds.c.html#LN13798"><span class='Ref_To_Local'>partRel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="tablecmds.c.html#LN13806"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ATExecDetachPartition &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>