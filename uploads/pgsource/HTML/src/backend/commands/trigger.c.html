<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\commands\trigger.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\commands\trigger.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:37 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * trigger.c 
 *    PostgreSQL TRIGGERs support code. 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * IDENTIFICATION 
 *    src/backend/commands/trigger.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/genam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/heapam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/sysattr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xact.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/catalog.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/dependency.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/indexing.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/objectaccess.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_constraint.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_constraint_fn.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_proc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_trigger.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/dbcommands.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/defrem.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/trigger.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"executor/executor.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/bitmapset.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/makefuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/clauses.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/var.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_clause.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_collate.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_func.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_relation.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parsetree.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"pgstat.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"rewrite/rewriteManip.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/bufmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/lmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"tcop/utility.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/acl.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/bytea.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/fmgroids.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/inval.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/snapmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/tqual.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/tuplestore.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* GUC variables */ 
</span><a name="LN63"></a><span class='Keyword'>int</span>         <span class='Declare_Var'>SessionReplicationRole</span> <span class='Operator'>= </span><a href="../../include/commands/trigger.h.html#LN99"><span class='Ref_to_Const'>SESSION_REPLICATION_ROLE_ORIGIN</span></a><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* How many levels deep into trigger execution are we? */ 
</span><a name="LN66"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>MyTriggerDepth</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Note that similar macros also exist in executor/execMain.c.  There does not 
 * appear to be any good header to put them into, given the structures that 
 * they use, so we let them be duplicated.  Be sure to update all if one needs 
 * to be changed, however. 
 */ 
</span><a name="LN74"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>GetUpdatedColumns</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>relinfo</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>estate</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>(</span><a href="../../include/parser/parsetree.h.html#LN30"><span class='Ref_to_Macro'>rt_fetch</span></a><span class='Parentheses'>((</span><a href="trigger.c.html#LN74"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>ri_RangeTableIndex<span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="trigger.c.html#LN74"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>es_range_table<span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>updatedCols<span class='Parentheses'>)</span> 
 
<span class='Comment_Multi_Line'>/* Local function prototypes */ 
</span><a name="LN78"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ConvertTriggerToFK</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2322"><span class='Ref_to_Struct'>CreateTrigStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>funcoid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN79"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>SetTriggerFlags</span><span class='Parentheses'>(</span><a href="../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>trigdesc</span><span class='Delimiter'>, </span><a href="../../include/utils/reltrigger.h.html#LN22"><span class='Ref_to_Struct'>Trigger</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>trigger</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN80"></a><span class='Keyword'>static </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Prototype'>GetTupleForTrigger</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN81"></a>                   <a href="../../include/nodes/execnodes.h.html#LN873"><span class='Ref_to_Struct'>EPQState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>epqstate</span><span class='Delimiter'>, 
</span><a name="LN82"></a>                   <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>relinfo</span><span class='Delimiter'>, 
</span><a name="LN83"></a>                   <a href="../../include/storage/itemptr.h.html#LN47"><span class='Ref_to_Typedef'>ItemPointer</span></a> <span class='Declare_Parameter'>tid</span><span class='Delimiter'>, 
</span><a name="LN84"></a>                   <a href="../../include/access/heapam.h.html#LN37"><span class='Ref_to_Enum'>LockTupleMode</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Delimiter'>, 
</span><a name="LN85"></a>                   <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>newSlot</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN86"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>TriggerEnabled</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>relinfo</span><span class='Delimiter'>, 
</span><a name="LN87"></a>               <a href="../../include/utils/reltrigger.h.html#LN22"><span class='Ref_to_Struct'>Trigger</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>trigger</span><span class='Delimiter'>, </span><a href="../../include/commands/trigger.h.html#LN27"><span class='Ref_to_Typedef'>TriggerEvent</span></a> <span class='Declare_Parameter'>event</span><span class='Delimiter'>, 
</span><a name="LN88"></a>               <a href="../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>modifiedCols</span><span class='Delimiter'>, 
</span><a name="LN89"></a>               <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>oldtup</span><span class='Delimiter'>, </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>newtup</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN90"></a><span class='Keyword'>static </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Prototype'>ExecCallTriggerFunc</span><span class='Parentheses'>(</span><a href="../../include/commands/trigger.h.html#LN29"><span class='Ref_to_Struct'>TriggerData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>trigdata</span><span class='Delimiter'>, 
</span><a name="LN91"></a>                    <span class='Keyword'>int </span><span class='Declare_Parameter'>tgindx</span><span class='Delimiter'>, 
</span><a name="LN92"></a>                    <a href="../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>finfo</span><span class='Delimiter'>, 
</span><a name="LN93"></a>                    <a href="../../include/executor/instrument.h.html#LN43"><span class='Ref_to_Struct'>Instrumentation</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>instr</span><span class='Delimiter'>, 
</span><a name="LN94"></a>                    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>per_tuple_context</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN95"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>AfterTriggerSaveEvent</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>relinfo</span><span class='Delimiter'>, 
</span><a name="LN96"></a>                      <span class='Keyword'>int </span><span class='Declare_Parameter'>event</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>row_trigger</span><span class='Delimiter'>, 
</span><a name="LN97"></a>                      <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>oldtup</span><span class='Delimiter'>, </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>newtup</span><span class='Delimiter'>, 
</span><a name="LN98"></a>                      <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>recheckIndexes</span><span class='Delimiter'>, </span><a href="../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>modifiedCols</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN99"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>AfterTriggerEnlargeQueryState</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Create a trigger.  Returns the address of the created trigger. 
 * 
 * queryString is the source text of the CREATE TRIGGER command. 
 * This must be supplied if a whenClause is specified, else it can be NULL. 
 * 
 * relOid, if nonzero, is the relation on which the trigger should be 
 * created.  If zero, the name provided in the statement will be looked up. 
 * 
 * refRelOid, if nonzero, is the relation to which the constraint trigger 
 * refers.  If zero, the constraint relation name provided in the statement 
 * will be looked up as needed. 
 * 
 * constraintOid, if nonzero, says that this trigger is being created 
 * internally to implement that constraint.  A suitable pg_depend entry will 
 * be made to link the trigger to that constraint.  constraintOid is zero when 
 * executing a user-entered CREATE TRIGGER command.  (For CREATE CONSTRAINT 
 * TRIGGER, we build a pg_constraint entry internally.) 
 * 
 * indexOid, if nonzero, is the OID of an index associated with the constraint. 
 * We do nothing with this except store it into pg_trigger.tgconstrindid. 
 * 
 * If isInternal is true then this is an internally-generated trigger. 
 * This argument sets the tgisinternal field of the pg_trigger entry, and 
 * if TRUE causes us to modify the given trigger name to ensure uniqueness. 
 * 
 * When isInternal is not true we require ACL_TRIGGER permissions on the 
 * relation, as well as ACL_EXECUTE on the trigger function.  For internal 
 * triggers the caller must apply any required permission checks. 
 * 
 * Note: can return InvalidObjectAddress if we decided to not create a trigger 
 * at all, but a foreign-key constraint.  This is a kluge for backwards 
 * compatibility. 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN137"></a><span class='Declare_Function'>CreateTrigger</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2322"><span class='Ref_to_Struct'>CreateTrigStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>queryString</span><span class='Delimiter'>, 
</span><a name="LN138"></a>              <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relOid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>refRelOid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>constraintOid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>indexOid</span><span class='Delimiter'>, 
</span><a name="LN139"></a>              <span class='Keyword'>bool </span><span class='Declare_Parameter'>isInternal</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN141"></a>    <a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>tgtype</span><span class='Delimiter'>; 
</span><a name="LN142"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ncolumns</span><span class='Delimiter'>; 
</span><a name="LN143"></a>    <a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>columns</span><span class='Delimiter'>; 
</span><a name="LN144"></a>    <a href="../../include/c.h.html#LN466"><span class='Ref_to_Typedef'>int2vector</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tgattr</span><span class='Delimiter'>; 
</span><a name="LN145"></a>    <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>whenClause</span><span class='Delimiter'>; 
</span><a name="LN146"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>whenRtable</span><span class='Delimiter'>; 
</span><a name="LN147"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>qual</span><span class='Delimiter'>; 
</span><a name="LN148"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_trigger.h.html#LN77"><span class='Ref_to_Const'>Natts_pg_trigger</span></a><span class='Delimiter'>]; 
</span><a name="LN149"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_trigger.h.html#LN77"><span class='Ref_to_Const'>Natts_pg_trigger</span></a><span class='Delimiter'>]; 
</span><a name="LN150"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN151"></a>    <a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span><a name="LN152"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>tgrel</span><span class='Delimiter'>; 
</span><a name="LN153"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>tgscan</span><span class='Delimiter'>; 
</span><a name="LN154"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>; 
</span><a name="LN155"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pgrel</span><span class='Delimiter'>; 
</span><a name="LN156"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN157"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>fargtypes</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>];</span>   <span class='Comment_Single_Line'>/* dummy */ 
</span><a name="LN158"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>funcoid</span><span class='Delimiter'>; 
</span><a name="LN159"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>funcrettype</span><span class='Delimiter'>; 
</span><a name="LN160"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>trigoid</span><span class='Delimiter'>; 
</span><a name="LN161"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>internaltrigname</span><span class='Delimiter'>[</span><a href="../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a><span class='Delimiter'>]; 
</span><a name="LN162"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>trigname</span><span class='Delimiter'>; 
</span><a name="LN163"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>constrrelid</span> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span><a name="LN164"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>myself</span><span class='Delimiter'>, 
</span><a name="LN165"></a>                <span class='Declare_Local'>referenced</span><span class='Delimiter'>; 
</span><a name="LN166"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>oldtablename</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN167"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>newtablename</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN138"><span class='Ref_to_Parameter'>relOid</span></a><span class='Parentheses'>))</span> 
        <a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN138"><span class='Ref_to_Parameter'>relOid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN41"><span class='Ref_to_Const'>ShareRowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN92"><span class='Ref_to_Proto'>heap_openrv</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2326"><span class='Ref_to_Member'>relation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN41"><span class='Ref_to_Const'>ShareRowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Triggers must be on tables or views, and there are additional 
     * relation-type-specific restrictions. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a> <span class='Operator'>|| 
</span>        <a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Tables can't have INSTEAD OF triggers */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2331"><span class='Ref_to_Member'>timing</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_trigger.h.html#LN98"><span class='Ref_to_Const'>TRIGGER_TYPE_BEFORE</span></a> <span class='Operator'>&& 
</span>            <a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2331"><span class='Ref_to_Member'>timing</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_trigger.h.html#LN111"><span class='Ref_to_Const'>TRIGGER_TYPE_AFTER</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is a table"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Tables cannot have INSTEAD OF triggers."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Disallow ROW triggers on partitioned tables */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2329"><span class='Ref_to_Member'>row</span></a> <span class='Operator'>&& </span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is a partitioned table"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Partitioned tables cannot have ROW triggers."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN163"><span class='Ref_to_Const'>RELKIND_VIEW</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Views can have INSTEAD OF triggers (which we check below are 
         * row-level), or statement-level BEFORE/AFTER triggers. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2331"><span class='Ref_to_Member'>timing</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_trigger.h.html#LN103"><span class='Ref_to_Const'>TRIGGER_TYPE_INSTEAD</span></a> <span class='Operator'>&& </span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2329"><span class='Ref_to_Member'>row</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is a view"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Views cannot have row-level BEFORE or AFTER triggers."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Disallow TRUNCATE triggers on VIEWs */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/pg_trigger.h.html#LN136"><span class='Ref_to_Macro'>TRIGGER_FOR_TRUNCATE</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2333"><span class='Ref_to_Member'>events</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is a view"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Views cannot have TRUNCATE triggers."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if rel-&GT;rd_rel-&GT;relkind=... &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2331"><span class='Ref_to_Member'>timing</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_trigger.h.html#LN98"><span class='Ref_to_Const'>TRIGGER_TYPE_BEFORE</span></a> <span class='Operator'>&& 
</span>            <a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2331"><span class='Ref_to_Member'>timing</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_trigger.h.html#LN111"><span class='Ref_to_Const'>TRIGGER_TYPE_AFTER</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is a foreign table"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>              <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Foreign tables cannot have INSTEAD OF triggers."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/pg_trigger.h.html#LN136"><span class='Ref_to_Macro'>TRIGGER_FOR_TRUNCATE</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2333"><span class='Ref_to_Member'>events</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is a foreign table"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Foreign tables cannot have TRUNCATE triggers."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2336"><span class='Ref_to_Member'>isconstraint</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is a foreign table"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>              <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Foreign tables cannot have constraint triggers."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if rel-&GT;rd_rel-&GT;relkind=... &raquo; </span> 
    <span class='Control'>else</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a table or view"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/init/globals.c.html#LN111"><span class='Ref_to_Global_Var'>allowSystemTableMods</span></a> <span class='Operator'>&& </span><a href="../../include/catalog/catalog.h.html#LN29"><span class='Ref_to_Proto'>IsSystemRelation</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied: \"%s\" is a system catalog"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2336"><span class='Ref_to_Member'>isconstraint</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * We must take a lock on the target relation to protect against 
         * concurrent drop.  It's not clear that AccessShareLock is strong 
         * enough, but we certainly need at least that much... otherwise, we 
         * might end up creating a pg_constraint entry referencing a 
         * nonexistent table. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN138"><span class='Ref_to_Parameter'>refRelOid</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/storage/lmgr.h.html#LN39"><span class='Ref_to_Proto'>LockRelationOid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN138"><span class='Ref_to_Parameter'>refRelOid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="trigger.c.html#LN163"><span class='Ref_To_Local'>constrrelid</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN138"><span class='Ref_to_Parameter'>refRelOid</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2342"><span class='Ref_to_Member'>constrrel</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="trigger.c.html#LN163"><span class='Ref_To_Local'>constrrelid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN52"><span class='Ref_to_Macro'>RangeVarGetRelid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2342"><span class='Ref_to_Member'>constrrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Delimiter'>, 
</span>                                           <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* permission checks */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="trigger.c.html#LN139"><span class='Ref_to_Parameter'>isInternal</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="trigger.c.html#LN151"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN283"><span class='Ref_to_Proto'>pg_class_aclcheck</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                                      <a href="../../include/nodes/parsenodes.h.html#LN77"><span class='Ref_to_Const'>ACL_TRIGGER</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN151"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN151"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN181"><span class='Ref_to_EnumConst'>ACL_KIND_CLASS</span></a><span class='Delimiter'>, 
</span>                           <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN163"><span class='Ref_To_Local'>constrrelid</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="trigger.c.html#LN151"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN283"><span class='Ref_to_Proto'>pg_class_aclcheck</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN163"><span class='Ref_To_Local'>constrrelid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                                          <a href="../../include/nodes/parsenodes.h.html#LN77"><span class='Ref_to_Const'>ACL_TRIGGER</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN151"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN151"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN181"><span class='Ref_to_EnumConst'>ACL_KIND_CLASS</span></a><span class='Delimiter'>, 
</span>                               <a href="../../include/utils/lsyscache.h.html#LN124"><span class='Ref_to_Proto'>get_rel_name</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN163"><span class='Ref_To_Local'>constrrelid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Compute tgtype */ 
</span>    <a href="../../include/catalog/pg_trigger.h.html#LN117"><span class='Ref_to_Macro'>TRIGGER_CLEAR_TYPE</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN141"><span class='Ref_To_Local'>tgtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2329"><span class='Ref_to_Member'>row</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/catalog/pg_trigger.h.html#LN119"><span class='Ref_to_Macro'>TRIGGER_SETT_ROW</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN141"><span class='Ref_To_Local'>tgtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN141"><span class='Ref_To_Local'>tgtype</span></a> <span class='Operator'>|= </span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2331"><span class='Ref_to_Member'>timing</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN141"><span class='Ref_To_Local'>tgtype</span></a> <span class='Operator'>|= </span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2333"><span class='Ref_to_Member'>events</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Disallow ROW-level TRUNCATE triggers */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/pg_trigger.h.html#LN129"><span class='Ref_to_Macro'>TRIGGER_FOR_ROW</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN141"><span class='Ref_To_Local'>tgtype</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="../../include/catalog/pg_trigger.h.html#LN136"><span class='Ref_to_Macro'>TRIGGER_FOR_TRUNCATE</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN141"><span class='Ref_To_Local'>tgtype</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"TRUNCATE FOR EACH ROW triggers are not supported"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* INSTEAD triggers must be row-level, and can't have WHEN or columns */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/pg_trigger.h.html#LN132"><span class='Ref_to_Macro'>TRIGGER_FOR_INSTEAD</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN141"><span class='Ref_To_Local'>tgtype</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/catalog/pg_trigger.h.html#LN129"><span class='Ref_to_Macro'>TRIGGER_FOR_ROW</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN141"><span class='Ref_To_Local'>tgtype</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"INSTEAD OF triggers must be FOR EACH ROW"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2335"><span class='Ref_to_Member'>whenClause</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"INSTEAD OF triggers cannot have WHEN conditions"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2334"><span class='Ref_to_Member'>columns</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"INSTEAD OF triggers cannot have column lists"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We don't yet support naming ROW transition variables, but the parser 
     * recognizes the syntax so we can give a nicer message here. 
     * 
     * Per standard, REFERENCING TABLE names are only allowed on AFTER 
     * triggers.  Per standard, REFERENCING ROW names are not allowed with FOR 
     * EACH STATEMENT.  Per standard, each OLD/NEW, ROW/TABLE permutation is 
     * only allowed once.  Per standard, OLD may not be specified when 
     * creating a trigger only for INSERT, and NEW may not be specified when 
     * creating a trigger only for DELETE. 
     * 
     * Notice that the standard allows an AFTER ... FOR EACH ROW trigger to 
     * reference both ROW and TABLE transition data. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2338"><span class='Ref_to_Member'>transitionRels</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN337"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>varList</span> <span class='Operator'>= </span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2338"><span class='Ref_to_Member'>transitionRels</span></a><span class='Delimiter'>; 
</span><a name="LN338"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN338"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN337"><span class='Ref_To_Local'>varList</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN342"></a>            <a href="../../include/nodes/parsenodes.h.html#LN1372"><span class='Ref_to_Struct'>TriggerTransition</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tt</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1372"><span class='Ref_to_Struct'>TriggerTransition</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN338"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN342"><span class='Ref_To_Local'>tt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1377"><span class='Ref_to_Member'>isTable</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"ROW variable naming in the REFERENCING clause is not supported"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Use OLD TABLE or NEW TABLE for naming transition tables."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Because of the above test, we omit further ROW-related testing 
             * below.  If we later allow naming OLD and NEW ROW variables, 
             * adjustments will be needed below. 
             */ 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is a partitioned table"</span><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Triggers on partitioned tables cannot have transition tables."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is a foreign table"</span><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Triggers on foreign tables cannot have transition tables."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN163"><span class='Ref_to_Const'>RELKIND_VIEW</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is a view"</span><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Triggers on views cannot have transition tables."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2331"><span class='Ref_to_Member'>timing</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_trigger.h.html#LN111"><span class='Ref_to_Const'>TRIGGER_TYPE_AFTER</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"transition table name can only be specified for an AFTER trigger"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/pg_trigger.h.html#LN136"><span class='Ref_to_Macro'>TRIGGER_FOR_TRUNCATE</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN141"><span class='Ref_To_Local'>tgtype</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"TRUNCATE triggers with transition tables are not supported"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN342"><span class='Ref_To_Local'>tt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1376"><span class='Ref_to_Member'>isNew</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_trigger.h.html#LN133"><span class='Ref_to_Macro'>TRIGGER_FOR_INSERT</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN141"><span class='Ref_To_Local'>tgtype</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>                      <a href="../../include/catalog/pg_trigger.h.html#LN135"><span class='Ref_to_Macro'>TRIGGER_FOR_UPDATE</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN141"><span class='Ref_To_Local'>tgtype</span></a><span class='Parentheses'>)))</span> 
                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"NEW TABLE can only be specified for an INSERT or UPDATE trigger"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN167"><span class='Ref_To_Local'>newtablename</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"NEW TABLE cannot be specified multiple times"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                <a href="trigger.c.html#LN167"><span class='Ref_To_Local'>newtablename</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN342"><span class='Ref_To_Local'>tt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1375"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_trigger.h.html#LN134"><span class='Ref_to_Macro'>TRIGGER_FOR_DELETE</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN141"><span class='Ref_To_Local'>tgtype</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>                      <a href="../../include/catalog/pg_trigger.h.html#LN135"><span class='Ref_to_Macro'>TRIGGER_FOR_UPDATE</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN141"><span class='Ref_To_Local'>tgtype</span></a><span class='Parentheses'>)))</span> 
                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"OLD TABLE can only be specified for a DELETE or UPDATE trigger"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN166"><span class='Ref_To_Local'>oldtablename</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"OLD TABLE cannot be specified multiple times"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                <a href="trigger.c.html#LN166"><span class='Ref_To_Local'>oldtablename</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN342"><span class='Ref_To_Local'>tt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1375"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN167"><span class='Ref_To_Local'>newtablename</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="trigger.c.html#LN166"><span class='Ref_To_Local'>oldtablename</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>            strcmp<span class='Parentheses'>(</span><a href="trigger.c.html#LN167"><span class='Ref_To_Local'>newtablename</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN166"><span class='Ref_To_Local'>oldtablename</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"OLD TABLE name and NEW TABLE name cannot be the same"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if stmt-&GT;transitionRels!... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Parse the WHEN clause, if any 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2335"><span class='Ref_to_Member'>whenClause</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN431"></a>        <a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pstate</span><span class='Delimiter'>; 
</span><a name="LN432"></a>        <a href="../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rte</span><span class='Delimiter'>; 
</span><a name="LN433"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>varList</span><span class='Delimiter'>; 
</span><a name="LN434"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Set up a pstate to parse with */ 
</span>        <a href="trigger.c.html#LN431"><span class='Ref_To_Local'>pstate</span></a> <span class='Operator'>= </span><a href="../parser/parse_node.c.html#LN42"><span class='Ref_to_Func'>make_parsestate</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN431"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/parser/parse_node.h.html#LN167"><span class='Ref_to_Member'>p_sourcetext</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>queryString</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Set up RTEs for OLD and NEW references. 
         * 
         * 'OLD' must always have varno equal to 1 and 'NEW' equal to 2. 
         */ 
</span>        <a href="trigger.c.html#LN432"><span class='Ref_To_Local'>rte</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_relation.h.html#LN69"><span class='Ref_to_Proto'>addRangeTableEntryForRelation</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN431"><span class='Ref_To_Local'>pstate</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, 
</span>                                            <a href="../../include/nodes/makefuncs.h.html#LN63"><span class='Ref_to_Proto'>makeAlias</span></a><span class='Parentheses'>(</span><span class='String'>"old"</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                            <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/parser/parse_relation.h.html#LN114"><span class='Ref_to_Proto'>addRTEtoQuery</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN431"><span class='Ref_To_Local'>pstate</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN432"><span class='Ref_To_Local'>rte</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN432"><span class='Ref_To_Local'>rte</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_relation.h.html#LN69"><span class='Ref_to_Proto'>addRangeTableEntryForRelation</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN431"><span class='Ref_To_Local'>pstate</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, 
</span>                                            <a href="../../include/nodes/makefuncs.h.html#LN63"><span class='Ref_to_Proto'>makeAlias</span></a><span class='Parentheses'>(</span><span class='String'>"new"</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                            <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/parser/parse_relation.h.html#LN114"><span class='Ref_to_Proto'>addRTEtoQuery</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN431"><span class='Ref_To_Local'>pstate</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN432"><span class='Ref_To_Local'>rte</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Transform expression.  Copy to be sure we don't modify original */ 
</span>        <a href="trigger.c.html#LN145"><span class='Ref_To_Local'>whenClause</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_clause.h.html#LN23"><span class='Ref_to_Proto'>transformWhereClause</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN431"><span class='Ref_To_Local'>pstate</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2335"><span class='Ref_to_Member'>whenClause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                          <a href="../../include/parser/parse_node.h.html#LN67"><span class='Ref_to_EnumConst'>EXPR_KIND_TRIGGER_WHEN</span></a><span class='Delimiter'>, 
</span>                                          <span class='String'>"WHEN"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* we have to fix its collations too */ 
</span>        <a href="../../include/parser/parse_collate.h.html#LN22"><span class='Ref_to_Proto'>assign_expr_collations</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN431"><span class='Ref_To_Local'>pstate</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN145"><span class='Ref_To_Local'>whenClause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Check for disallowed references to OLD/NEW. 
         * 
         * NB: pull_var_clause is okay here only because we don't allow 
         * subselects in WHEN clauses; it would fail to examine the contents 
         * of subselects. 
         */ 
</span>        <a href="trigger.c.html#LN433"><span class='Ref_To_Local'>varList</span></a> <span class='Operator'>= </span><a href="../../include/optimizer/var.h.html#LN36"><span class='Ref_to_Proto'>pull_var_clause</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN145"><span class='Ref_To_Local'>whenClause</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN434"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN433"><span class='Ref_To_Local'>varList</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN472"></a>            <a href="../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>var</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN434"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN472"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN165"><span class='Ref_to_Member'>varno</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>case</span> <a href="../../include/nodes/primnodes.h.html#LN159"><span class='Ref_to_Const'>PRS2_OLD_VARNO</span></a><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/catalog/pg_trigger.h.html#LN129"><span class='Ref_to_Macro'>TRIGGER_FOR_ROW</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN141"><span class='Ref_To_Local'>tgtype</span></a><span class='Parentheses'>))</span> 
                        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"statement trigger's WHEN condition cannot reference column values"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN431"><span class='Ref_To_Local'>pstate</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN472"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN177"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/pg_trigger.h.html#LN133"><span class='Ref_to_Macro'>TRIGGER_FOR_INSERT</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN141"><span class='Ref_To_Local'>tgtype</span></a><span class='Parentheses'>))</span> 
                        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"INSERT trigger's WHEN condition cannot reference OLD values"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN431"><span class='Ref_To_Local'>pstate</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN472"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN177"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* system columns are okay here */ 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <a href="../../include/nodes/primnodes.h.html#LN160"><span class='Ref_to_Const'>PRS2_NEW_VARNO</span></a><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/catalog/pg_trigger.h.html#LN129"><span class='Ref_to_Macro'>TRIGGER_FOR_ROW</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN141"><span class='Ref_To_Local'>tgtype</span></a><span class='Parentheses'>))</span> 
                        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"statement trigger's WHEN condition cannot reference column values"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN431"><span class='Ref_To_Local'>pstate</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN472"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN177"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/pg_trigger.h.html#LN134"><span class='Ref_to_Macro'>TRIGGER_FOR_DELETE</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN141"><span class='Ref_To_Local'>tgtype</span></a><span class='Parentheses'>))</span> 
                        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"DELETE trigger's WHEN condition cannot reference NEW values"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN431"><span class='Ref_To_Local'>pstate</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN472"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN177"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN472"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN167"><span class='Ref_to_Member'>varattno</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="../../include/catalog/pg_trigger.h.html#LN130"><span class='Ref_to_Macro'>TRIGGER_FOR_BEFORE</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN141"><span class='Ref_To_Local'>tgtype</span></a><span class='Parentheses'>))</span> 
                        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"BEFORE trigger's WHEN condition cannot reference NEW system columns"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN431"><span class='Ref_To_Local'>pstate</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN472"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN177"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>default</span><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* can't happen without add_missing_from, so just elog */ 
</span>                    <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"trigger WHEN condition cannot contain references to other relations"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch var-&GT;varno &raquo; </span> 
        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* we'll need the rtable for recordDependencyOnExpr */ 
</span>        <a href="trigger.c.html#LN146"><span class='Ref_To_Local'>whenRtable</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN431"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/parser/parse_node.h.html#LN168"><span class='Ref_to_Member'>p_rtable</span></a><span class='Delimiter'>; 
</span> 
        <a href="trigger.c.html#LN147"><span class='Ref_To_Local'>qual</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN598"><span class='Ref_to_Proto'>nodeToString</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN145"><span class='Ref_To_Local'>whenClause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../parser/parse_node.c.html#LN75"><span class='Ref_to_Func'>free_parsestate</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN431"><span class='Ref_To_Local'>pstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if stmt-&GT;whenClause &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="trigger.c.html#LN145"><span class='Ref_To_Local'>whenClause</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN146"><span class='Ref_To_Local'>whenRtable</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN147"><span class='Ref_To_Local'>qual</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Find and validate the trigger function. 
     */ 
</span>    <a href="trigger.c.html#LN158"><span class='Ref_To_Local'>funcoid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_func.h.html#LN62"><span class='Ref_to_Proto'>LookupFuncName</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2327"><span class='Ref_to_Member'>funcname</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="trigger.c.html#LN157"><span class='Ref_To_Local'>fargtypes</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="trigger.c.html#LN139"><span class='Ref_to_Parameter'>isInternal</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="trigger.c.html#LN151"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN285"><span class='Ref_to_Proto'>pg_proc_aclcheck</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN158"><span class='Ref_To_Local'>funcoid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN78"><span class='Ref_to_Const'>ACL_EXECUTE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN151"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN151"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN184"><span class='Ref_to_EnumConst'>ACL_KIND_PROC</span></a><span class='Delimiter'>, 
</span>                           <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2327"><span class='Ref_to_Member'>funcname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="trigger.c.html#LN159"><span class='Ref_To_Local'>funcrettype</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN112"><span class='Ref_to_Proto'>get_func_rettype</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN158"><span class='Ref_To_Local'>funcoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN159"><span class='Ref_To_Local'>funcrettype</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_type.h.html#LN691"><span class='Ref_to_Const'>TRIGGEROID</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * We allow OPAQUE just so we can load old dump files.  When we see a 
         * trigger function declared OPAQUE, change it to TRIGGER. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN159"><span class='Ref_To_Local'>funcrettype</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN699"><span class='Ref_to_Const'>OPAQUEOID</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"changing return type of function %s from %s to %s"</span><span class='Delimiter'>, 
</span>                         <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2327"><span class='Ref_to_Member'>funcname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <span class='String'>"opaque"</span><span class='Delimiter'>, </span><span class='String'>"trigger"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="../../include/commands/defrem.h.html#LN51"><span class='Ref_to_Proto'>SetFunctionReturnType</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN158"><span class='Ref_To_Local'>funcoid</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_type.h.html#LN691"><span class='Ref_to_Const'>TRIGGEROID</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"function %s must return type %s"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2327"><span class='Ref_to_Member'>funcname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"trigger"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if funcrettype!=TRIGGERO... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If the command is a user-entered CREATE CONSTRAINT TRIGGER command that 
     * references one of the built-in RI_FKey trigger functions, assume it is 
     * from a dump of a pre-7.3 foreign key constraint, and take steps to 
     * convert this legacy representation into a regular foreign key 
     * constraint.  Ugly, but necessary for loading old dump files. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2336"><span class='Ref_to_Member'>isconstraint</span></a> <span class='Operator'>&& !</span><a href="trigger.c.html#LN139"><span class='Ref_to_Parameter'>isInternal</span></a> <span class='Operator'>&& 
</span>        <a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2328"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>)</span> <span class='Operator'>&GT;= </span><span class='Number'>6</span> <span class='Operator'>&& 
</span>        <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2328"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>) </span><span class='Operator'>% </span><span class='Number'>2</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>        <a href="../../include/commands/trigger.h.html#LN212"><span class='Ref_to_Proto'>RI_FKey_trigger_type</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN158"><span class='Ref_To_Local'>funcoid</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><a href="../../include/commands/trigger.h.html#LN210"><span class='Ref_to_Const'>RI_TRIGGER_NONE</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Keep lock on target rel until end of xact */ 
</span>        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="trigger.c.html#LN78"><span class='Ref_to_Proto'>ConvertTriggerToFK</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN158"><span class='Ref_To_Local'>funcoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span> <a href="../catalog/objectaddress.c.html#LN718"><span class='Ref_to_Global_Var'>InvalidObjectAddress</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If it's a user-entered CREATE CONSTRAINT TRIGGER command, make a 
     * corresponding pg_constraint entry. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2336"><span class='Ref_to_Member'>isconstraint</span></a> <span class='Operator'>&& !</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN138"><span class='Ref_to_Parameter'>constraintOid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Internal callers should have made their own constraints */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="trigger.c.html#LN139"><span class='Ref_to_Parameter'>isInternal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN138"><span class='Ref_to_Parameter'>constraintOid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_constraint_fn.h.html#LN29"><span class='Ref_to_Proto'>CreateConstraintEntry</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2325"><span class='Ref_to_Member'>trigname</span></a><span class='Delimiter'>, 
</span>                                              <a href="../../include/utils/rel.h.html#LN443"><span class='Ref_to_Macro'>RelationGetNamespace</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                              <a href="../../include/catalog/pg_constraint.h.html#LN191"><span class='Ref_to_Const'>CONSTRAINT_TRIGGER</span></a><span class='Delimiter'>, 
</span>                                              <a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2340"><span class='Ref_to_Member'>deferrable</span></a><span class='Delimiter'>, 
</span>                                              <a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2341"><span class='Ref_to_Member'>initdeferred</span></a><span class='Delimiter'>, 
</span>                                              <span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                              <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                              <span class='Null_Value'>NULL</span><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* no conkey */ 
</span>                                              <span class='Number'>0</span><span class='Delimiter'>, 
</span>                                              <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* no domain */ 
</span>                                              <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* no index */ 
</span>                                              <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* no foreign key */ 
</span>                                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                              <span class='Number'>0</span><span class='Delimiter'>, 
</span>                                              <span class='String'>' '</span><span class='Delimiter'>, 
</span>                                              <span class='String'>' '</span><span class='Delimiter'>, 
</span>                                              <span class='String'>' '</span><span class='Delimiter'>, 
</span>                                              <span class='Null_Value'>NULL</span><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* no exclusion */ 
</span>                                              <span class='Null_Value'>NULL</span><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* no check constraint */ 
</span>                                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                              <span class='Boolean'>true</span><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* islocal */ 
</span>                                              <span class='Number'>0</span><span class='Delimiter'>,</span>        <span class='Comment_Single_Line'>/* inhcount */ 
</span>                                              <span class='Boolean'>true</span><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* isnoinherit */ 
</span>                                              <a href="trigger.c.html#LN139"><span class='Ref_to_Parameter'>isInternal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* is_internal */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if stmt-&GT;isconstraint&&!... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Generate the trigger's OID now, so that we can use it in the name if 
     * needed. 
     */ 
</span>    <a href="trigger.c.html#LN152"><span class='Ref_To_Local'>tgrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_trigger.h.html#LN33"><span class='Ref_to_Const'>TriggerRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN160"><span class='Ref_To_Local'>trigoid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/catalog.h.html#LN44"><span class='Ref_to_Proto'>GetNewOid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN152"><span class='Ref_To_Local'>tgrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If trigger is internally generated, modify the provided trigger name to 
     * ensure uniqueness by appending the trigger OID.  (Callers will usually 
     * supply a simple constant trigger name in these cases.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN139"><span class='Ref_to_Parameter'>isInternal</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN161"><span class='Ref_To_Local'>internaltrigname</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN161"><span class='Ref_To_Local'>internaltrigname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <span class='String'>"%s_%u"</span><span class='Delimiter'>, </span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2325"><span class='Ref_to_Member'>trigname</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN160"><span class='Ref_To_Local'>trigoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN162"><span class='Ref_To_Local'>trigname</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN161"><span class='Ref_To_Local'>internaltrigname</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* user-defined trigger; use the specified trigger name as-is */ 
</span>        <a href="trigger.c.html#LN162"><span class='Ref_To_Local'>trigname</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2325"><span class='Ref_to_Member'>trigname</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Scan pg_trigger for existing triggers on relation.  We do this only to 
     * give a nice error message if there's already a trigger of the same 
     * name.  (The unique index on tgrelid/tgname would complain anyway.) We 
     * can skip this for internally generated triggers, since the name 
     * modification above should be sufficient. 
     * 
     * NOTE that this is cool only because we have ShareRowExclusiveLock on 
     * the relation, so the trigger set won't be changing underneath us. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="trigger.c.html#LN139"><span class='Ref_to_Parameter'>isInternal</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN154"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, 
</span>                    <a href="../../include/catalog/pg_trigger.h.html#LN78"><span class='Ref_to_Const'>Anum_pg_trigger_tgrelid</span></a><span class='Delimiter'>, 
</span>                    <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                    <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN153"><span class='Ref_To_Local'>tgscan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN152"><span class='Ref_To_Local'>tgrel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN248"><span class='Ref_to_Const'>TriggerRelidNameIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                    <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="trigger.c.html#LN154"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN156"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN153"><span class='Ref_To_Local'>tgscan</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN663"></a>            <a href="../../include/catalog/pg_trigger.h.html#LN71"><span class='Ref_to_Typedef'>Form_pg_trigger</span></a> <span class='Declare_Local'>pg_trigger</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_trigger.h.html#LN71"><span class='Ref_to_Typedef'>Form_pg_trigger</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN156"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/builtins.h.html#LN41"><span class='Ref_to_Proto'>namestrcmp</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN663"><span class='Ref_To_Local'>pg_trigger</span></a><span class='Operator'>-&GT;</span>tgname<span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="trigger.c.html#LN162"><span class='Ref_To_Local'>trigname</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/pg_basebackup/streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                  <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"trigger \"%s\" for relation \"%s\" already exists"</span><span class='Delimiter'>, 
</span>                         <a href="trigger.c.html#LN162"><span class='Ref_To_Local'>trigname</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN153"><span class='Ref_To_Local'>tgscan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !isInternal &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Build the new pg_trigger tuple. 
     */ 
</span>    memset<span class='Parentheses'>(</span><a href="trigger.c.html#LN149"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN149"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN148"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_trigger.h.html#LN78"><span class='Ref_to_Const'>Anum_pg_trigger_tgrelid</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN148"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_trigger.h.html#LN79"><span class='Ref_to_Const'>Anum_pg_trigger_tgname</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../utils/adt/name.c.html#LN44"><span class='Ref_to_Func'>namein</span></a><span class='Delimiter'>, 
</span>                                                  <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN162"><span class='Ref_To_Local'>trigname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN148"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_trigger.h.html#LN80"><span class='Ref_to_Const'>Anum_pg_trigger_tgfoid</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN158"><span class='Ref_To_Local'>funcoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN148"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_trigger.h.html#LN81"><span class='Ref_to_Const'>Anum_pg_trigger_tgtype</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN456"><span class='Ref_to_Macro'>Int16GetDatum</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN141"><span class='Ref_To_Local'>tgtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN148"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_trigger.h.html#LN82"><span class='Ref_to_Const'>Anum_pg_trigger_tgenabled</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN421"><span class='Ref_to_Macro'>CharGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/commands/trigger.h.html#LN108"><span class='Ref_to_Const'>TRIGGER_FIRES_ON_ORIGIN</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN148"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_trigger.h.html#LN83"><span class='Ref_to_Const'>Anum_pg_trigger_tgisinternal</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN139"><span class='Ref_to_Parameter'>isInternal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN148"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_trigger.h.html#LN84"><span class='Ref_to_Const'>Anum_pg_trigger_tgconstrrelid</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN163"><span class='Ref_To_Local'>constrrelid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN148"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_trigger.h.html#LN85"><span class='Ref_to_Const'>Anum_pg_trigger_tgconstrindid</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN138"><span class='Ref_to_Parameter'>indexOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN148"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_trigger.h.html#LN86"><span class='Ref_to_Const'>Anum_pg_trigger_tgconstraint</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN138"><span class='Ref_to_Parameter'>constraintOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN148"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_trigger.h.html#LN87"><span class='Ref_to_Const'>Anum_pg_trigger_tgdeferrable</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2340"><span class='Ref_to_Member'>deferrable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN148"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_trigger.h.html#LN88"><span class='Ref_to_Const'>Anum_pg_trigger_tginitdeferred</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2341"><span class='Ref_to_Member'>initdeferred</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2328"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN694"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>le</span><span class='Delimiter'>; 
</span><a name="LN695"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>args</span><span class='Delimiter'>; 
</span><a name="LN696"></a>        <a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>nargs</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2328"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN697"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN694"><span class='Ref_To_Local'>le</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2328"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN701"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ar</span> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN694"><span class='Ref_To_Local'>le</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <a href="trigger.c.html#LN697"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+= </span>strlen<span class='Parentheses'>(</span><a href="trigger.c.html#LN701"><span class='Ref_To_Local'>ar</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>4</span><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="trigger.c.html#LN701"><span class='Ref_To_Local'>ar</span></a><span class='Delimiter'>; </span><a href="trigger.c.html#LN701"><span class='Ref_To_Local'>ar</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="trigger.c.html#LN701"><span class='Ref_To_Local'>ar</span></a> <span class='Operator'>== </span><span class='String'>'\\'</span><span class='Parentheses'>) 
</span>                    <a href="trigger.c.html#LN697"><span class='Ref_To_Local'>len</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <a href="trigger.c.html#LN695"><span class='Ref_To_Local'>args</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN697"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN695"><span class='Ref_To_Local'>args</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN694"><span class='Ref_To_Local'>le</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2328"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN714"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>s</span> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN694"><span class='Ref_To_Local'>le</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN715"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>d</span> <span class='Operator'>= </span><a href="trigger.c.html#LN695"><span class='Ref_To_Local'>args</span></a> <span class='Operator'>+ </span>strlen<span class='Parentheses'>(</span><a href="trigger.c.html#LN695"><span class='Ref_To_Local'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="trigger.c.html#LN714"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="trigger.c.html#LN714"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>== </span><span class='String'>'\\'</span><span class='Parentheses'>) 
</span>                    <span class='Operator'>*</span><a href="trigger.c.html#LN715"><span class='Ref_To_Local'>d</span></a><span class='Operator'>++ = </span><span class='String'>'\\'</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="trigger.c.html#LN715"><span class='Ref_To_Local'>d</span></a><span class='Operator'>++ = *</span><a href="trigger.c.html#LN714"><span class='Ref_To_Local'>s</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN715"><span class='Ref_To_Local'>d</span></a><span class='Delimiter'>, </span><span class='String'>"\\000"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="trigger.c.html#LN148"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_trigger.h.html#LN89"><span class='Ref_to_Const'>Anum_pg_trigger_tgnargs</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN456"><span class='Ref_to_Macro'>Int16GetDatum</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN696"><span class='Ref_To_Local'>nargs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN148"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_trigger.h.html#LN91"><span class='Ref_to_Const'>Anum_pg_trigger_tgargs</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../utils/adt/varlena.c.html#LN253"><span class='Ref_to_Func'>byteain</span></a><span class='Delimiter'>, 
</span>                                                      <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN695"><span class='Ref_To_Local'>args</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if stmt-&GT;args &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="trigger.c.html#LN148"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_trigger.h.html#LN89"><span class='Ref_to_Const'>Anum_pg_trigger_tgnargs</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN456"><span class='Ref_to_Macro'>Int16GetDatum</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN148"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_trigger.h.html#LN91"><span class='Ref_to_Const'>Anum_pg_trigger_tgargs</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../utils/adt/varlena.c.html#LN253"><span class='Ref_to_Func'>byteain</span></a><span class='Delimiter'>, 
</span>                                                        <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><span class='String'>""</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* build column number array if it's a column-specific trigger */ 
</span>    <a href="trigger.c.html#LN142"><span class='Ref_To_Local'>ncolumns</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2334"><span class='Ref_to_Member'>columns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN142"><span class='Ref_To_Local'>ncolumns</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="trigger.c.html#LN143"><span class='Ref_To_Local'>columns</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN742"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span><a name="LN743"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <a href="trigger.c.html#LN143"><span class='Ref_To_Local'>columns</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN142"><span class='Ref_To_Local'>ncolumns</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN742"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN137"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2334"><span class='Ref_to_Member'>columns</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN748"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>name</span> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN742"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN749"></a>            <a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>attnum</span><span class='Delimiter'>; 
</span><a name="LN750"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Lookup column name.  System columns are not allowed */ 
</span>            <a href="trigger.c.html#LN749"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_relation.h.html#LN125"><span class='Ref_to_Proto'>attnameAttNum</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN748"><span class='Ref_To_Local'>name</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN749"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>== </span><a href="../../include/access/attnum.h.html#LN22"><span class='Ref_to_Const'>InvalidAttrNumber</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" of relation \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                           <a href="trigger.c.html#LN748"><span class='Ref_To_Local'>name</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Check for duplicates */ 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN750"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN743"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="trigger.c.html#LN750"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="trigger.c.html#LN750"><span class='Ref_To_Local'>j</span></a><span class='Operator'>--</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN143"><span class='Ref_To_Local'>columns</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN750"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="trigger.c.html#LN749"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DUPLICATE_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" specified more than once"</span><span class='Delimiter'>, 
</span>                                    <a href="trigger.c.html#LN748"><span class='Ref_To_Local'>name</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="trigger.c.html#LN143"><span class='Ref_To_Local'>columns</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN743"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="trigger.c.html#LN749"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <a href="trigger.c.html#LN144"><span class='Ref_To_Local'>tgattr</span></a> <span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN36"><span class='Ref_to_Proto'>buildint2vector</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN143"><span class='Ref_To_Local'>columns</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN142"><span class='Ref_To_Local'>ncolumns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN148"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_trigger.h.html#LN90"><span class='Ref_to_Const'>Anum_pg_trigger_tgattr</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN144"><span class='Ref_To_Local'>tgattr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* set tgqual if trigger has WHEN clause */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN147"><span class='Ref_To_Local'>qual</span></a><span class='Parentheses'>) 
</span>        <a href="trigger.c.html#LN148"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_trigger.h.html#LN92"><span class='Ref_to_Const'>Anum_pg_trigger_tgqual</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN147"><span class='Ref_To_Local'>qual</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="trigger.c.html#LN149"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_trigger.h.html#LN92"><span class='Ref_to_Const'>Anum_pg_trigger_tgqual</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN166"><span class='Ref_To_Local'>oldtablename</span></a><span class='Parentheses'>) 
</span>        <a href="trigger.c.html#LN148"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_trigger.h.html#LN93"><span class='Ref_to_Const'>Anum_pg_trigger_tgoldtable</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../utils/adt/name.c.html#LN44"><span class='Ref_to_Func'>namein</span></a><span class='Delimiter'>, 
</span>                                              <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN166"><span class='Ref_To_Local'>oldtablename</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="trigger.c.html#LN149"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_trigger.h.html#LN93"><span class='Ref_to_Const'>Anum_pg_trigger_tgoldtable</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN167"><span class='Ref_To_Local'>newtablename</span></a><span class='Parentheses'>) 
</span>        <a href="trigger.c.html#LN148"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_trigger.h.html#LN94"><span class='Ref_to_Const'>Anum_pg_trigger_tgnewtable</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../utils/adt/name.c.html#LN44"><span class='Ref_to_Func'>namein</span></a><span class='Delimiter'>, 
</span>                                              <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN167"><span class='Ref_To_Local'>newtablename</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="trigger.c.html#LN149"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_trigger.h.html#LN94"><span class='Ref_to_Const'>Anum_pg_trigger_tgnewtable</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN156"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN152"><span class='Ref_To_Local'>tgrel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN148"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN149"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* force tuple to have the desired OID */ 
</span>    <a href="../../include/access/htup_details.h.html#LN697"><span class='Ref_to_Macro'>HeapTupleSetOid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN156"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN160"><span class='Ref_To_Local'>trigoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Insert tuple into pg_trigger. 
     */ 
</span>    <a href="../../include/catalog/indexing.h.html#LN32"><span class='Ref_to_Proto'>CatalogTupleInsert</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN152"><span class='Ref_To_Local'>tgrel</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN156"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN156"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN152"><span class='Ref_To_Local'>tgrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN148"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_trigger.h.html#LN79"><span class='Ref_to_Const'>Anum_pg_trigger_tgname</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN148"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_trigger.h.html#LN91"><span class='Ref_to_Const'>Anum_pg_trigger_tgargs</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN148"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_trigger.h.html#LN90"><span class='Ref_to_Const'>Anum_pg_trigger_tgattr</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN166"><span class='Ref_To_Local'>oldtablename</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN148"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_trigger.h.html#LN93"><span class='Ref_to_Const'>Anum_pg_trigger_tgoldtable</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN167"><span class='Ref_To_Local'>newtablename</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN148"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_trigger.h.html#LN94"><span class='Ref_to_Const'>Anum_pg_trigger_tgnewtable</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Update relation's pg_class entry.  Crucial side-effect: other backends 
     * (and this one too!) are sent SI message to make them rebuild relcache 
     * entries. 
     */ 
</span>    <a href="trigger.c.html#LN155"><span class='Ref_To_Local'>pgrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN156"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN156"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for relation %u"</span><span class='Delimiter'>, 
</span>             <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>((</span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN156"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>relhastriggers <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN155"><span class='Ref_To_Local'>pgrel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="trigger.c.html#LN156"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN156"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN156"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN155"><span class='Ref_To_Local'>pgrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We used to try to update the rel's relcache entry here, but that's 
     * fairly pointless since it will happen as a byproduct of the upcoming 
     * CommandCounterIncrement... 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Record dependencies for trigger.  Always place a normal dependency on 
     * the function. 
     */ 
</span>    <a href="trigger.c.html#LN164"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_trigger.h.html#LN33"><span class='Ref_to_Const'>TriggerRelationId</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN164"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN160"><span class='Ref_To_Local'>trigoid</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN164"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN165"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_proc.h.html#LN32"><span class='Ref_to_Const'>ProcedureRelationId</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN165"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN158"><span class='Ref_To_Local'>funcoid</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN165"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN164"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="trigger.c.html#LN165"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN139"><span class='Ref_to_Parameter'>isInternal</span></a> <span class='Operator'>&& </span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN138"><span class='Ref_to_Parameter'>constraintOid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Internally-generated trigger for a constraint, so make it an 
         * internal dependency of the constraint.  We can skip depending on 
         * the relation(s), as there'll be an indirect dependency via the 
         * constraint. 
         */ 
</span>        <a href="trigger.c.html#LN165"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_constraint.h.html#LN28"><span class='Ref_to_Const'>ConstraintRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN165"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN138"><span class='Ref_to_Parameter'>constraintOid</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN165"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN164"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="trigger.c.html#LN165"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN76"><span class='Ref_to_EnumConst'>DEPENDENCY_INTERNAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * User CREATE TRIGGER, so place dependencies.  We make trigger be 
         * auto-dropped if its relation is dropped or if the FK relation is 
         * dropped.  (Auto drop is compatible with our pre-7.3 behavior.) 
         */ 
</span>        <a href="trigger.c.html#LN165"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN165"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN165"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN164"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="trigger.c.html#LN165"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN75"><span class='Ref_to_EnumConst'>DEPENDENCY_AUTO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN163"><span class='Ref_To_Local'>constrrelid</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="trigger.c.html#LN165"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>; 
</span>            <a href="trigger.c.html#LN165"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN163"><span class='Ref_To_Local'>constrrelid</span></a><span class='Delimiter'>; 
</span>            <a href="trigger.c.html#LN165"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN164"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="trigger.c.html#LN165"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN75"><span class='Ref_to_EnumConst'>DEPENDENCY_AUTO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* Not possible to have an index dependency in this case */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN138"><span class='Ref_to_Parameter'>indexOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If it's a user-specified constraint trigger, make the constraint 
         * internally dependent on the trigger instead of vice versa. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN138"><span class='Ref_to_Parameter'>constraintOid</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="trigger.c.html#LN165"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_constraint.h.html#LN28"><span class='Ref_to_Const'>ConstraintRelationId</span></a><span class='Delimiter'>; 
</span>            <a href="trigger.c.html#LN165"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN138"><span class='Ref_to_Parameter'>constraintOid</span></a><span class='Delimiter'>; 
</span>            <a href="trigger.c.html#LN165"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN165"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="trigger.c.html#LN164"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN76"><span class='Ref_to_EnumConst'>DEPENDENCY_INTERNAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* If column-specific trigger, add normal dependencies on columns */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN143"><span class='Ref_To_Local'>columns</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN902"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <a href="trigger.c.html#LN165"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN165"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN902"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="trigger.c.html#LN902"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="trigger.c.html#LN142"><span class='Ref_To_Local'>ncolumns</span></a><span class='Delimiter'>; </span><a href="trigger.c.html#LN902"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="trigger.c.html#LN165"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN143"><span class='Ref_To_Local'>columns</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN902"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>            <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN164"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="trigger.c.html#LN165"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If it has a WHEN clause, add dependencies on objects mentioned in the 
     * expression (eg, functions, as well as any columns used). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN145"><span class='Ref_To_Local'>whenClause</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../include/catalog/dependency.h.html#LN188"><span class='Ref_to_Proto'>recordDependencyOnExpr</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN164"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN145"><span class='Ref_To_Local'>whenClause</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN146"><span class='Ref_To_Local'>whenRtable</span></a><span class='Delimiter'>, 
</span>                               <a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Post creation hook for new trigger */ 
</span>    <a href="../../include/catalog/objectaccess.h.html#LN146"><span class='Ref_to_Macro'>InvokeObjectPostCreateHookArg</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_trigger.h.html#LN33"><span class='Ref_to_Const'>TriggerRelationId</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN160"><span class='Ref_To_Local'>trigoid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                  <a href="trigger.c.html#LN139"><span class='Ref_to_Parameter'>isInternal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Keep lock on target rel until end of xact */ 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN150"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="trigger.c.html#LN164"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CreateTrigger &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Convert legacy (pre-7.3) CREATE CONSTRAINT TRIGGER commands into 
 * full-fledged foreign key constraints. 
 * 
 * The conversion is complex because a pre-7.3 foreign key involved three 
 * separate triggers, which were reported separately in dumps.  While the 
 * single trigger on the referencing table adds no new information, we need 
 * to know the trigger functions of both of the triggers on the referenced 
 * table to build the constraint declaration.  Also, due to lack of proper 
 * dependency checking pre-7.3, it is possible that the source database had 
 * an incomplete set of triggers resulting in an only partially enforced 
 * FK constraint.  (This would happen if one of the tables had been dropped 
 * and re-created, but only if the DB had been affected by a 7.0 pg_dump bug 
 * that caused loss of tgconstrrelid information.)  We choose to translate to 
 * an FK constraint only when we've seen all three triggers of a set.  This is 
 * implemented by storing unmatched items in a list in TopMemoryContext. 
 * We match triggers together by comparing the trigger arguments (which 
 * include constraint name, table and column names, so should be good enough). 
 */ 
</span><span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN953"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>args</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* list of (T_String) Values or NIL */ 
</span><a name="LN954"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>funcoids</span><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>];</span>    <span class='Comment_Single_Line'>/* OIDs of trigger functions */ 
</span>    <span class='Comment_Multi_Line'>/* The three function OIDs are stored in the order update, delete, child */ 
</span><a name="LN956"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>OldTriggerInfo</span><span class='Delimiter'>; 
</span> 
<span class='Keyword'>static void 
</span><a name="LN959"></a><span class='Declare_Function'>ConvertTriggerToFK</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2322"><span class='Ref_to_Struct'>CreateTrigStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>funcoid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN961"></a>    <span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Local'>info_list</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
<a name="LN963"></a>    <span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Keyword'>const </span><span class='Declare_Local'>funcdescr</span><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>        <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"Found referenced table's UPDATE trigger."</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"Found referenced table's DELETE trigger."</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"Found referencing table's trigger."</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>}; 
</span> 
<a name="LN969"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>constr_name</span><span class='Delimiter'>; 
</span><a name="LN970"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>fk_table_name</span><span class='Delimiter'>; 
</span><a name="LN971"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>pk_table_name</span><span class='Delimiter'>; 
</span><a name="LN972"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>fk_matchtype</span> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN2048"><span class='Ref_to_Const'>FKCONSTR_MATCH_SIMPLE</span></a><span class='Delimiter'>; 
</span><a name="LN973"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>fk_attrs</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN974"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>pk_attrs</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN975"></a>    <a href="../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN976"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>funcnum</span><span class='Delimiter'>; 
</span><a name="LN977"></a>    <a href="trigger.c.html#LN951"><span class='Ref_to_Typedef'>OldTriggerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>info</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN978"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span><a name="LN979"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Parse out the trigger arguments */ 
</span>    <a href="trigger.c.html#LN969"><span class='Ref_To_Local'>constr_name</span></a> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN959"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2328"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN970"><span class='Ref_To_Local'>fk_table_name</span></a> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN115"><span class='Ref_to_Macro'>lsecond</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN959"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2328"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN971"><span class='Ref_To_Local'>pk_table_name</span></a> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN120"><span class='Ref_to_Macro'>lthird</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN959"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2328"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN979"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN978"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN959"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2328"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN988"></a>        <a href="../../include/nodes/value.h.html#LN41"><span class='Ref_to_Struct'>Value</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>arg</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/value.h.html#LN41"><span class='Ref_to_Struct'>Value</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN978"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="trigger.c.html#LN979"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN979"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><span class='Number'>4</span><span class='Parentheses'>)</span>              <span class='Comment_Single_Line'>/* skip constraint and table names */ 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN979"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>== </span><span class='Number'>4</span><span class='Parentheses'>)</span>             <span class='Comment_Single_Line'>/* handle match type */ 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN988"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"FULL"</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="trigger.c.html#LN972"><span class='Ref_To_Local'>fk_matchtype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN2046"><span class='Ref_to_Const'>FKCONSTR_MATCH_FULL</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="trigger.c.html#LN972"><span class='Ref_To_Local'>fk_matchtype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN2048"><span class='Ref_to_Const'>FKCONSTR_MATCH_SIMPLE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN979"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>% </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>            <a href="trigger.c.html#LN973"><span class='Ref_To_Local'>fk_attrs</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN973"><span class='Ref_To_Local'>fk_attrs</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN988"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="trigger.c.html#LN974"><span class='Ref_To_Local'>pk_attrs</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN974"><span class='Ref_To_Local'>pk_attrs</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN988"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Prepare description of constraint for use in messages */ 
</span>    <a href="../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN975"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN975"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"FOREIGN KEY %s("</span><span class='Delimiter'>, 
</span>                     <a href="../../include/utils/builtins.h.html#LN77"><span class='Ref_to_Proto'>quote_identifier</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN970"><span class='Ref_To_Local'>fk_table_name</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN979"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN978"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN973"><span class='Ref_To_Local'>fk_attrs</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1014"></a>        <a href="../../include/nodes/value.h.html#LN41"><span class='Ref_to_Struct'>Value</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>arg</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/value.h.html#LN41"><span class='Ref_to_Struct'>Value</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN978"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN979"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++ &GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN975"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>','</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN975"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../../include/utils/builtins.h.html#LN77"><span class='Ref_to_Proto'>quote_identifier</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1014"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN975"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>") REFERENCES %s("</span><span class='Delimiter'>, 
</span>                     <a href="../../include/utils/builtins.h.html#LN77"><span class='Ref_to_Proto'>quote_identifier</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN971"><span class='Ref_To_Local'>pk_table_name</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN979"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN978"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN974"><span class='Ref_To_Local'>pk_attrs</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1025"></a>        <a href="../../include/nodes/value.h.html#LN41"><span class='Ref_to_Struct'>Value</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>arg</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/value.h.html#LN41"><span class='Ref_to_Struct'>Value</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN978"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN979"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++ &GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN975"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>','</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN975"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../../include/utils/builtins.h.html#LN77"><span class='Ref_to_Proto'>quote_identifier</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1025"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN975"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>')'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Identify class of trigger --- update, delete, or referencing-table */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN959"><span class='Ref_to_Parameter'>funcoid</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> F_RI_FKEY_CASCADE_UPD<span class='Operator'>: 
</span>        <span class='Control'>case</span> F_RI_FKEY_RESTRICT_UPD<span class='Operator'>: 
</span>        <span class='Control'>case</span> F_RI_FKEY_SETNULL_UPD<span class='Operator'>: 
</span>        <span class='Control'>case</span> F_RI_FKEY_SETDEFAULT_UPD<span class='Operator'>: 
</span>        <span class='Control'>case</span> F_RI_FKEY_NOACTION_UPD<span class='Operator'>: 
</span>            <a href="trigger.c.html#LN976"><span class='Ref_To_Local'>funcnum</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> F_RI_FKEY_CASCADE_DEL<span class='Operator'>: 
</span>        <span class='Control'>case</span> F_RI_FKEY_RESTRICT_DEL<span class='Operator'>: 
</span>        <span class='Control'>case</span> F_RI_FKEY_SETNULL_DEL<span class='Operator'>: 
</span>        <span class='Control'>case</span> F_RI_FKEY_SETDEFAULT_DEL<span class='Operator'>: 
</span>        <span class='Control'>case</span> F_RI_FKEY_NOACTION_DEL<span class='Operator'>: 
</span>            <a href="trigger.c.html#LN976"><span class='Ref_To_Local'>funcnum</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="trigger.c.html#LN976"><span class='Ref_To_Local'>funcnum</span></a> <span class='Operator'>= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch funcoid &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* See if we have a match to this trigger */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN978"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN961"><span class='Ref_To_Local'>info_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="trigger.c.html#LN977"><span class='Ref_To_Local'>info</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="trigger.c.html#LN951"><span class='Ref_to_Typedef'>OldTriggerInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN978"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN977"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN954"><span class='Ref_to_Member'>funcoids</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN976"><span class='Ref_To_Local'>funcnum</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a> <span class='Operator'>&& 
</span>            <a href="../../include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN977"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN953"><span class='Ref_to_Member'>args</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN959"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2328"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="trigger.c.html#LN977"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN954"><span class='Ref_to_Member'>funcoids</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN976"><span class='Ref_To_Local'>funcnum</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="trigger.c.html#LN959"><span class='Ref_to_Parameter'>funcoid</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN978"><span class='Ref_To_Local'>l</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* First trigger of set, so create a new list entry */ 
</span><a name="LN1072"></a>        <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldContext</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"ignoring incomplete trigger group for constraint \"%s\" %s"</span><span class='Delimiter'>, 
</span>                <a href="trigger.c.html#LN969"><span class='Ref_To_Local'>constr_name</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN975"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>         <a href="../utils/error/elog.c.html#LN898"><span class='Ref_to_Func'>errdetail_internal</span></a><span class='Parentheses'>(</span><span class='String'>"%s"</span><span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><a href="trigger.c.html#LN963"><span class='Ref_To_Local'>funcdescr</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN976"><span class='Ref_To_Local'>funcnum</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN1072"><span class='Ref_To_Local'>oldContext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN42"><span class='Ref_to_Global_Var'>TopMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN977"><span class='Ref_To_Local'>info</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="trigger.c.html#LN951"><span class='Ref_to_Typedef'>OldTriggerInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN951"><span class='Ref_to_Typedef'>OldTriggerInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN977"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN953"><span class='Ref_to_Member'>args</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN959"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2328"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN977"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN954"><span class='Ref_to_Member'>funcoids</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN976"><span class='Ref_To_Local'>funcnum</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="trigger.c.html#LN959"><span class='Ref_to_Parameter'>funcoid</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN961"><span class='Ref_To_Local'>info_list</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN961"><span class='Ref_To_Local'>info_list</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN977"><span class='Ref_To_Local'>info</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1072"><span class='Ref_To_Local'>oldContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN977"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN954"><span class='Ref_to_Member'>funcoids</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a> <span class='Operator'>|| 
</span>             <a href="trigger.c.html#LN977"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN954"><span class='Ref_to_Member'>funcoids</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a> <span class='Operator'>|| 
</span>             <a href="trigger.c.html#LN977"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN954"><span class='Ref_to_Member'>funcoids</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Second trigger of set */ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"ignoring incomplete trigger group for constraint \"%s\" %s"</span><span class='Delimiter'>, 
</span>                <a href="trigger.c.html#LN969"><span class='Ref_To_Local'>constr_name</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN975"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>         <a href="../utils/error/elog.c.html#LN898"><span class='Ref_to_Func'>errdetail_internal</span></a><span class='Parentheses'>(</span><span class='String'>"%s"</span><span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><a href="trigger.c.html#LN963"><span class='Ref_To_Local'>funcdescr</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN976"><span class='Ref_To_Local'>funcnum</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* OK, we have a set, so make the FK constraint ALTER TABLE cmd */ 
</span><a name="LN1098"></a>        <a href="../../include/nodes/parsenodes.h.html#LN1662"><span class='Ref_to_Struct'>AlterTableStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>atstmt</span> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1662"><span class='Ref_to_Struct'>AlterTableStmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1099"></a>        <a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a> <span class='Operator'>*</span><span class='Declare_Local'>atcmd</span> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1100"></a>        <a href="../../include/nodes/parsenodes.h.html#LN2050"><span class='Ref_to_Struct'>Constraint</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fkcon</span> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2050"><span class='Ref_to_Struct'>Constraint</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1101"></a>        <a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>wrapper</span> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"converting trigger group into constraint \"%s\" %s"</span><span class='Delimiter'>, 
</span>                        <a href="trigger.c.html#LN969"><span class='Ref_To_Local'>constr_name</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN975"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN898"><span class='Ref_to_Func'>errdetail_internal</span></a><span class='Parentheses'>(</span><span class='String'>"%s"</span><span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><a href="trigger.c.html#LN963"><span class='Ref_To_Local'>funcdescr</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN976"><span class='Ref_To_Local'>funcnum</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN1100"><span class='Ref_To_Local'>fkcon</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2053"><span class='Ref_to_Member'>contype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN2031"><span class='Ref_to_EnumConst'>CONSTR_FOREIGN</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN1100"><span class='Ref_To_Local'>fkcon</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2059"><span class='Ref_to_Member'>location</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN976"><span class='Ref_To_Local'>funcnum</span></a> <span class='Operator'>== </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* This trigger is on the FK table */ 
</span>            <a href="trigger.c.html#LN1098"><span class='Ref_To_Local'>atstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1665"><span class='Ref_to_Member'>relation</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN959"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2326"><span class='Ref_to_Member'>relation</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN959"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2342"><span class='Ref_to_Member'>constrrel</span></a><span class='Parentheses'>) 
</span>                <a href="trigger.c.html#LN1100"><span class='Ref_To_Local'>fkcon</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2082"><span class='Ref_to_Member'>pktable</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN959"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2342"><span class='Ref_to_Member'>constrrel</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Work around ancient pg_dump bug that omitted constrrel */ 
</span>                <a href="trigger.c.html#LN1100"><span class='Ref_To_Local'>fkcon</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2082"><span class='Ref_to_Member'>pktable</span></a> <span class='Operator'>= </span><a href="../../include/nodes/makefuncs.h.html#LN68"><span class='Ref_to_Proto'>makeRangeVar</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="trigger.c.html#LN971"><span class='Ref_To_Local'>pk_table_name</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* This trigger is on the PK table */ 
</span>            <a href="trigger.c.html#LN1100"><span class='Ref_To_Local'>fkcon</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2082"><span class='Ref_to_Member'>pktable</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN959"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2326"><span class='Ref_to_Member'>relation</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN959"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2342"><span class='Ref_to_Member'>constrrel</span></a><span class='Parentheses'>) 
</span>                <a href="trigger.c.html#LN1098"><span class='Ref_To_Local'>atstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1665"><span class='Ref_to_Member'>relation</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN959"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2342"><span class='Ref_to_Member'>constrrel</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Work around ancient pg_dump bug that omitted constrrel */ 
</span>                <a href="trigger.c.html#LN1098"><span class='Ref_To_Local'>atstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1665"><span class='Ref_to_Member'>relation</span></a> <span class='Operator'>= </span><a href="../../include/nodes/makefuncs.h.html#LN68"><span class='Ref_to_Proto'>makeRangeVar</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="trigger.c.html#LN970"><span class='Ref_To_Local'>fk_table_name</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <a href="trigger.c.html#LN1098"><span class='Ref_To_Local'>atstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1666"><span class='Ref_to_Member'>cmds</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1099"><span class='Ref_To_Local'>atcmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN1098"><span class='Ref_To_Local'>atstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1667"><span class='Ref_to_Member'>relkind</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN1622"><span class='Ref_to_EnumConst'>OBJECT_TABLE</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN1099"><span class='Ref_To_Local'>atcmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1752"><span class='Ref_to_Member'>subtype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN1687"><span class='Ref_to_EnumConst'>AT_AddConstraint</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN1099"><span class='Ref_To_Local'>atcmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1756"><span class='Ref_to_Member'>def</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="trigger.c.html#LN1100"><span class='Ref_To_Local'>fkcon</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="trigger.c.html#LN969"><span class='Ref_To_Local'>constr_name</span></a><span class='Delimiter'>, </span><span class='String'>"&LT;unnamed&GT;"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="trigger.c.html#LN1100"><span class='Ref_To_Local'>fkcon</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2056"><span class='Ref_to_Member'>conname</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="trigger.c.html#LN1100"><span class='Ref_To_Local'>fkcon</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2056"><span class='Ref_to_Member'>conname</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN969"><span class='Ref_To_Local'>constr_name</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN1100"><span class='Ref_To_Local'>fkcon</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2083"><span class='Ref_to_Member'>fk_attrs</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN973"><span class='Ref_To_Local'>fk_attrs</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN1100"><span class='Ref_To_Local'>fkcon</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2084"><span class='Ref_to_Member'>pk_attrs</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN974"><span class='Ref_To_Local'>pk_attrs</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN1100"><span class='Ref_To_Local'>fkcon</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2085"><span class='Ref_to_Member'>fk_matchtype</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN972"><span class='Ref_To_Local'>fk_matchtype</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN977"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN954"><span class='Ref_to_Member'>funcoids</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> F_RI_FKEY_NOACTION_UPD<span class='Operator'>: 
</span>                <a href="trigger.c.html#LN1100"><span class='Ref_To_Local'>fkcon</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2086"><span class='Ref_to_Member'>fk_upd_action</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN2039"><span class='Ref_to_Const'>FKCONSTR_ACTION_NOACTION</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> F_RI_FKEY_CASCADE_UPD<span class='Operator'>: 
</span>                <a href="trigger.c.html#LN1100"><span class='Ref_To_Local'>fkcon</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2086"><span class='Ref_to_Member'>fk_upd_action</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN2041"><span class='Ref_to_Const'>FKCONSTR_ACTION_CASCADE</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> F_RI_FKEY_RESTRICT_UPD<span class='Operator'>: 
</span>                <a href="trigger.c.html#LN1100"><span class='Ref_To_Local'>fkcon</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2086"><span class='Ref_to_Member'>fk_upd_action</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN2040"><span class='Ref_to_Const'>FKCONSTR_ACTION_RESTRICT</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> F_RI_FKEY_SETNULL_UPD<span class='Operator'>: 
</span>                <a href="trigger.c.html#LN1100"><span class='Ref_To_Local'>fkcon</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2086"><span class='Ref_to_Member'>fk_upd_action</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN2042"><span class='Ref_to_Const'>FKCONSTR_ACTION_SETNULL</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> F_RI_FKEY_SETDEFAULT_UPD<span class='Operator'>: 
</span>                <a href="trigger.c.html#LN1100"><span class='Ref_To_Local'>fkcon</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2086"><span class='Ref_to_Member'>fk_upd_action</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN2043"><span class='Ref_to_Const'>FKCONSTR_ACTION_SETDEFAULT</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* can't get here because of earlier checks */ 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"confused about RI update function"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch info-&GT;funcoids[0] &raquo; </span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN977"><span class='Ref_To_Local'>info</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN954"><span class='Ref_to_Member'>funcoids</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> F_RI_FKEY_NOACTION_DEL<span class='Operator'>: 
</span>                <a href="trigger.c.html#LN1100"><span class='Ref_To_Local'>fkcon</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2087"><span class='Ref_to_Member'>fk_del_action</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN2039"><span class='Ref_to_Const'>FKCONSTR_ACTION_NOACTION</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> F_RI_FKEY_CASCADE_DEL<span class='Operator'>: 
</span>                <a href="trigger.c.html#LN1100"><span class='Ref_To_Local'>fkcon</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2087"><span class='Ref_to_Member'>fk_del_action</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN2041"><span class='Ref_to_Const'>FKCONSTR_ACTION_CASCADE</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> F_RI_FKEY_RESTRICT_DEL<span class='Operator'>: 
</span>                <a href="trigger.c.html#LN1100"><span class='Ref_To_Local'>fkcon</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2087"><span class='Ref_to_Member'>fk_del_action</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN2040"><span class='Ref_to_Const'>FKCONSTR_ACTION_RESTRICT</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> F_RI_FKEY_SETNULL_DEL<span class='Operator'>: 
</span>                <a href="trigger.c.html#LN1100"><span class='Ref_To_Local'>fkcon</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2087"><span class='Ref_to_Member'>fk_del_action</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN2042"><span class='Ref_to_Const'>FKCONSTR_ACTION_SETNULL</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> F_RI_FKEY_SETDEFAULT_DEL<span class='Operator'>: 
</span>                <a href="trigger.c.html#LN1100"><span class='Ref_To_Local'>fkcon</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2087"><span class='Ref_to_Member'>fk_del_action</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN2043"><span class='Ref_to_Const'>FKCONSTR_ACTION_SETDEFAULT</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* can't get here because of earlier checks */ 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"confused about RI delete function"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch info-&GT;funcoids[1] &raquo; </span> 
        <a href="trigger.c.html#LN1100"><span class='Ref_To_Local'>fkcon</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2057"><span class='Ref_to_Member'>deferrable</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN959"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2340"><span class='Ref_to_Member'>deferrable</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN1100"><span class='Ref_To_Local'>fkcon</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2058"><span class='Ref_to_Member'>initdeferred</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN959"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2341"><span class='Ref_to_Member'>initdeferred</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN1100"><span class='Ref_To_Local'>fkcon</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2092"><span class='Ref_to_Member'>skip_validation</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN1100"><span class='Ref_To_Local'>fkcon</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2093"><span class='Ref_to_Member'>initially_valid</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* finally, wrap it in a dummy PlannedStmt */ 
</span>        <a href="trigger.c.html#LN1101"><span class='Ref_To_Local'>wrapper</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN44"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN654"><span class='Ref_to_EnumConst'>CMD_UTILITY</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN1101"><span class='Ref_To_Local'>wrapper</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN52"><span class='Ref_to_Member'>canSetTag</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN1101"><span class='Ref_To_Local'>wrapper</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN93"><span class='Ref_to_Member'>utilityStmt</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="trigger.c.html#LN1098"><span class='Ref_To_Local'>atstmt</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN1101"><span class='Ref_To_Local'>wrapper</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN96"><span class='Ref_to_Member'>stmt_location</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN1101"><span class='Ref_To_Local'>wrapper</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN97"><span class='Ref_to_Member'>stmt_len</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* ... and execute it */ 
</span>        <a href="../../include/tcop/utility.h.html#LN33"><span class='Ref_to_Proto'>ProcessUtility</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1101"><span class='Ref_To_Local'>wrapper</span></a><span class='Delimiter'>, 
</span>                       <span class='String'>"(generated ALTER TABLE ADD FOREIGN KEY command)"</span><span class='Delimiter'>, 
</span>                       <a href="../../include/tcop/utility.h.html#LN22"><span class='Ref_to_EnumConst'>PROCESS_UTILITY_SUBCOMMAND</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                       <a href="../tcop/dest.c.html#LN90"><span class='Ref_to_Global_Var'>None_Receiver</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Remove the matched item from the list */ 
</span>        <a href="trigger.c.html#LN961"><span class='Ref_To_Local'>info_list</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN234"><span class='Ref_to_Proto'>list_delete_ptr</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN961"><span class='Ref_To_Local'>info_list</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN977"><span class='Ref_To_Local'>info</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN977"><span class='Ref_To_Local'>info</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* We leak the copied args ... not worth worrying about */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end ConvertTriggerToFK &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Guts of trigger deletion. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1215"></a><span class='Declare_Function'>RemoveTriggerById</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>trigOid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1217"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>tgrel</span><span class='Delimiter'>; 
</span><a name="LN1218"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>tgscan</span><span class='Delimiter'>; 
</span><a name="LN1219"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>skey</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN1220"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN1221"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span><span class='Delimiter'>; 
</span><a name="LN1222"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN1217"><span class='Ref_To_Local'>tgrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_trigger.h.html#LN33"><span class='Ref_to_Const'>TriggerRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Find the trigger to delete. 
     */ 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN1219"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1215"><span class='Ref_to_Parameter'>trigOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN1218"><span class='Ref_To_Local'>tgscan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1217"><span class='Ref_To_Local'>tgrel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN250"><span class='Ref_to_Const'>TriggerOidIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="trigger.c.html#LN1219"><span class='Ref_To_Local'>skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN1220"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1218"><span class='Ref_To_Local'>tgscan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1220"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not find tuple for trigger %u"</span><span class='Delimiter'>, </span><a href="trigger.c.html#LN1215"><span class='Ref_to_Parameter'>trigOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Open and exclusive-lock the relation the trigger belongs to. 
     */ 
</span>    <a href="trigger.c.html#LN1221"><span class='Ref_To_Local'>relid</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_trigger.h.html#LN71"><span class='Ref_to_Typedef'>Form_pg_trigger</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1220"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>tgrelid<span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN1222"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1221"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1222"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a> <span class='Operator'>&& 
</span>        <a href="trigger.c.html#LN1222"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN163"><span class='Ref_to_Const'>RELKIND_VIEW</span></a> <span class='Operator'>&& 
</span>        <a href="trigger.c.html#LN1222"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a> <span class='Operator'>&& 
</span>        <a href="trigger.c.html#LN1222"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a table, view, or foreign table"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1222"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/init/globals.c.html#LN111"><span class='Ref_to_Global_Var'>allowSystemTableMods</span></a> <span class='Operator'>&& </span><a href="../../include/catalog/catalog.h.html#LN29"><span class='Ref_to_Proto'>IsSystemRelation</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1222"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied: \"%s\" is a system catalog"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1222"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Delete the pg_trigger tuple. 
     */ 
</span>    <a href="../../include/catalog/indexing.h.html#LN40"><span class='Ref_to_Proto'>CatalogTupleDelete</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1217"><span class='Ref_To_Local'>tgrel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="trigger.c.html#LN1220"><span class='Ref_To_Local'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1218"><span class='Ref_To_Local'>tgscan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1217"><span class='Ref_To_Local'>tgrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We do not bother to try to determine whether any other triggers remain, 
     * which would be needed in order to decide whether it's safe to clear the 
     * relation's relhastriggers.  (In any case, there might be a concurrent 
     * process adding new triggers.)  Instead, just force a relcache inval to 
     * make other backends (and this one too!) rebuild their relcache entries. 
     * There's no great harm in leaving relhastriggers true even if there are 
     * no triggers left. 
     */ 
</span>    <a href="../../include/utils/inval.h.html#LN43"><span class='Ref_to_Proto'>CacheInvalidateRelcache</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1222"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Keep lock on trigger's rel until end of xact */ 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1222"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RemoveTriggerById &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * get_trigger_oid - Look up a trigger by name to find its OID. 
 * 
 * If missing_ok is false, throw an error if trigger not found.  If 
 * true, just return InvalidOid. 
 */ 
</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN1293"></a><span class='Declare_Function'>get_trigger_oid</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>trigname</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>missing_ok</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1295"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>tgrel</span><span class='Delimiter'>; 
</span><a name="LN1296"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>skey</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN1297"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>tgscan</span><span class='Delimiter'>; 
</span><a name="LN1298"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN1299"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>oid</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Find the trigger, verify permissions, set up object address 
     */ 
</span>    <a href="trigger.c.html#LN1295"><span class='Ref_To_Local'>tgrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_trigger.h.html#LN33"><span class='Ref_to_Const'>TriggerRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN1296"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_trigger.h.html#LN78"><span class='Ref_to_Const'>Anum_pg_trigger_tgrelid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1293"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN1296"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_trigger.h.html#LN79"><span class='Ref_to_Const'>Anum_pg_trigger_tgname</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_NAMEEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1293"><span class='Ref_to_Parameter'>trigname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN1297"><span class='Ref_To_Local'>tgscan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1295"><span class='Ref_To_Local'>tgrel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN248"><span class='Ref_to_Const'>TriggerRelidNameIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="trigger.c.html#LN1296"><span class='Ref_To_Local'>skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN1298"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1297"><span class='Ref_To_Local'>tgscan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1298"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="trigger.c.html#LN1293"><span class='Ref_to_Parameter'>missing_ok</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"trigger \"%s\" for table \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                            <a href="trigger.c.html#LN1293"><span class='Ref_to_Parameter'>trigname</span></a><span class='Delimiter'>, </span><a href="../../include/utils/lsyscache.h.html#LN124"><span class='Ref_to_Proto'>get_rel_name</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1293"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN1299"><span class='Ref_To_Local'>oid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="trigger.c.html#LN1299"><span class='Ref_To_Local'>oid</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1298"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1297"><span class='Ref_To_Local'>tgscan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1295"><span class='Ref_To_Local'>tgrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="trigger.c.html#LN1299"><span class='Ref_To_Local'>oid</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_trigger_oid &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Perform permissions and integrity checks before acquiring a relation lock. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1343"></a><span class='Declare_Function'>RangeVarCallbackForRenameTrigger</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rv</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oldrelid</span><span class='Delimiter'>, 
</span><a name="LN1344"></a>                                 <span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1346"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN1347"></a>    <a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Local'>form</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN1346"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1343"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1346"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span><span class='Delimiter'>;</span>                 <span class='Comment_Single_Line'>/* concurrently dropped */ 
</span>    <a href="trigger.c.html#LN1347"><span class='Ref_To_Local'>form</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1346"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* only tables and views can have triggers */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1347"><span class='Ref_To_Local'>form</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a> <span class='Operator'>&& </span><a href="trigger.c.html#LN1347"><span class='Ref_To_Local'>form</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN163"><span class='Ref_to_Const'>RELKIND_VIEW</span></a> <span class='Operator'>&& 
</span>        <a href="trigger.c.html#LN1347"><span class='Ref_To_Local'>form</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a> <span class='Operator'>&& 
</span>        <a href="trigger.c.html#LN1347"><span class='Ref_To_Local'>form</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a table, view, or foreign table"</span><span class='Delimiter'>, 
</span>                        <a href="trigger.c.html#LN1343"><span class='Ref_to_Parameter'>rv</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* you must own the table to rename one of its triggers */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN308"><span class='Ref_to_Proto'>pg_class_ownercheck</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1343"><span class='Ref_to_Parameter'>relid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN181"><span class='Ref_to_EnumConst'>ACL_KIND_CLASS</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN1343"><span class='Ref_to_Parameter'>rv</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/init/globals.c.html#LN111"><span class='Ref_to_Global_Var'>allowSystemTableMods</span></a> <span class='Operator'>&& </span><a href="../../include/catalog/catalog.h.html#LN33"><span class='Ref_to_Proto'>IsSystemClass</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1343"><span class='Ref_to_Parameter'>relid</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN1347"><span class='Ref_To_Local'>form</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied: \"%s\" is a system catalog"</span><span class='Delimiter'>, 
</span>                        <a href="trigger.c.html#LN1343"><span class='Ref_to_Parameter'>rv</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1346"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RangeVarCallbackForRenameTrigger &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *      renametrig      - changes the name of a trigger on a relation 
 * 
 *      trigger name is changed in trigger catalog. 
 *      No record of the previous name is kept. 
 * 
 *      get proper relrelation from relation catalog (if not arg) 
 *      scan trigger catalog 
 *              for name conflict (within rel) 
 *              for original trigger (if not arg) 
 *      modify tgname in trigger tuple 
 *      update row in catalog 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN1389"></a><span class='Declare_Function'>renametrig</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2770"><span class='Ref_to_Struct'>RenameStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1391"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tgoid</span><span class='Delimiter'>; 
</span><a name="LN1392"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>targetrel</span><span class='Delimiter'>; 
</span><a name="LN1393"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>tgrel</span><span class='Delimiter'>; 
</span><a name="LN1394"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN1395"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>tgscan</span><span class='Delimiter'>; 
</span><a name="LN1396"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN1397"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span><span class='Delimiter'>; 
</span><a name="LN1398"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Look up name, check permissions, and acquire lock (which we will NOT 
     * release until end of transaction). 
     */ 
</span>    <a href="trigger.c.html#LN1397"><span class='Ref_To_Local'>relid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN55"><span class='Ref_to_Proto'>RangeVarGetRelidExtended</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1389"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2775"><span class='Ref_to_Member'>relation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Delimiter'>, 
</span>                                     <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                     <a href="trigger.c.html#LN1342"><span class='Ref_to_Func'>RangeVarCallbackForRenameTrigger</span></a><span class='Delimiter'>, 
</span>                                     <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Have lock already, so just need to build relcache entry. */ 
</span>    <a href="trigger.c.html#LN1392"><span class='Ref_To_Local'>targetrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN84"><span class='Ref_to_Proto'>relation_open</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1397"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Scan pg_trigger twice for existing triggers on relation.  We do this in 
     * order to ensure a trigger does not exist with newname (The unique index 
     * on tgrelid/tgname would complain anyway) and to ensure a trigger does 
     * exist with oldname. 
     * 
     * NOTE that this is cool only because we have AccessExclusiveLock on the 
     * relation, so the trigger set won't be changing underneath us. 
     */ 
</span>    <a href="trigger.c.html#LN1393"><span class='Ref_To_Local'>tgrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_trigger.h.html#LN33"><span class='Ref_to_Const'>TriggerRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * First pass -- look for name conflict 
     */ 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN1396"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_trigger.h.html#LN78"><span class='Ref_to_Const'>Anum_pg_trigger_tgrelid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1397"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN1396"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_trigger.h.html#LN79"><span class='Ref_to_Const'>Anum_pg_trigger_tgname</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_NAMEEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1389"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2779"><span class='Ref_to_Member'>newname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN1395"><span class='Ref_To_Local'>tgscan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1393"><span class='Ref_To_Local'>tgrel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN248"><span class='Ref_to_Const'>TriggerRelidNameIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="trigger.c.html#LN1396"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1394"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1395"><span class='Ref_To_Local'>tgscan</span></a><span class='Parentheses'>)))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/pg_basebackup/streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"trigger \"%s\" for relation \"%s\" already exists"</span><span class='Delimiter'>, 
</span>                        <a href="trigger.c.html#LN1389"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2779"><span class='Ref_to_Member'>newname</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1392"><span class='Ref_To_Local'>targetrel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1395"><span class='Ref_To_Local'>tgscan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Second pass -- look for trigger existing with oldname and update 
     */ 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN1396"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_trigger.h.html#LN78"><span class='Ref_to_Const'>Anum_pg_trigger_tgrelid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1397"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN1396"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_trigger.h.html#LN79"><span class='Ref_to_Const'>Anum_pg_trigger_tgname</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_NAMEEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1389"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2777"><span class='Ref_to_Member'>subname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN1395"><span class='Ref_To_Local'>tgscan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1393"><span class='Ref_To_Local'>tgrel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN248"><span class='Ref_to_Const'>TriggerRelidNameIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="trigger.c.html#LN1396"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1394"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1395"><span class='Ref_To_Local'>tgscan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="trigger.c.html#LN1391"><span class='Ref_To_Local'>tgoid</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1394"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Update pg_trigger tuple with new tgname. 
         */ 
</span>        <a href="trigger.c.html#LN1394"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN606"><span class='Ref_to_Func'>heap_copytuple</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1394"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* need a modifiable copy */ 
</span> 
        <a href="../../include/utils/builtins.h.html#LN40"><span class='Ref_to_Proto'>namestrcpy</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_trigger.h.html#LN71"><span class='Ref_to_Typedef'>Form_pg_trigger</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1394"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>tgname<span class='Delimiter'>, 
</span>                   <a href="trigger.c.html#LN1389"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2779"><span class='Ref_to_Member'>newname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1393"><span class='Ref_To_Local'>tgrel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="trigger.c.html#LN1394"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN1394"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_trigger.h.html#LN33"><span class='Ref_to_Const'>TriggerRelationId</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1394"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Invalidate relation's relcache entry so that other backends (and 
         * this one too!) are sent SI message to make them rebuild relcache 
         * entries.  (Ideally this should happen automatically...) 
         */ 
</span>        <a href="../../include/utils/inval.h.html#LN43"><span class='Ref_to_Proto'>CacheInvalidateRelcache</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1392"><span class='Ref_To_Local'>targetrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if HeapTupleIsValid(tupl... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"trigger \"%s\" for table \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="trigger.c.html#LN1389"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2777"><span class='Ref_to_Member'>subname</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1392"><span class='Ref_To_Local'>targetrel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1398"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN33"><span class='Ref_to_Const'>TriggerRelationId</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN1391"><span class='Ref_To_Local'>tgoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1395"><span class='Ref_To_Local'>tgscan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1393"><span class='Ref_To_Local'>tgrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Close rel, but keep exclusive lock! 
     */ 
</span>    <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1392"><span class='Ref_To_Local'>targetrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="trigger.c.html#LN1398"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end renametrig &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * EnableDisableTrigger() 
 * 
 *  Called by ALTER TABLE ENABLE/DISABLE [ REPLICA | ALWAYS ] TRIGGER 
 *  to change 'tgenabled' field for the specified trigger(s) 
 * 
 * rel: relation to process (caller must hold suitable lock on it) 
 * tgname: trigger to process, or NULL to scan all triggers 
 * fires_when: new value for tgenabled field. In addition to generic 
 *             enablement/disablement, this also defines when the trigger 
 *             should be fired in session replication roles. 
 * skip_system: if true, skip "system" triggers (constraint triggers) 
 * 
 * Caller should have checked permissions for the table; here we also 
 * enforce that superuser privilege is required to alter the state of 
 * system triggers 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1521"></a><span class='Declare_Function'>EnableDisableTrigger</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>tgname</span><span class='Delimiter'>, 
</span><a name="LN1522"></a>                     <span class='Keyword'>char </span><span class='Declare_Parameter'>fires_when</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>skip_system</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1524"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>tgrel</span><span class='Delimiter'>; 
</span><a name="LN1525"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nkeys</span><span class='Delimiter'>; 
</span><a name="LN1526"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>keys</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN1527"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>tgscan</span><span class='Delimiter'>; 
</span><a name="LN1528"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN1529"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span><span class='Delimiter'>; 
</span><a name="LN1530"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>changed</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Scan the relevant entries in pg_triggers */ 
</span>    <a href="trigger.c.html#LN1524"><span class='Ref_To_Local'>tgrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_trigger.h.html#LN33"><span class='Ref_to_Const'>TriggerRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN1526"><span class='Ref_To_Local'>keys</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_trigger.h.html#LN78"><span class='Ref_to_Const'>Anum_pg_trigger_tgrelid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1521"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1521"><span class='Ref_to_Parameter'>tgname</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN1526"><span class='Ref_To_Local'>keys</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                    <a href="../../include/catalog/pg_trigger.h.html#LN79"><span class='Ref_to_Const'>Anum_pg_trigger_tgname</span></a><span class='Delimiter'>, 
</span>                    <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_NAMEEQ<span class='Delimiter'>, 
</span>                    <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1521"><span class='Ref_to_Parameter'>tgname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN1525"><span class='Ref_To_Local'>nkeys</span></a> <span class='Operator'>= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="trigger.c.html#LN1525"><span class='Ref_To_Local'>nkeys</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN1527"><span class='Ref_To_Local'>tgscan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1524"><span class='Ref_To_Local'>tgrel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN248"><span class='Ref_to_Const'>TriggerRelidNameIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="trigger.c.html#LN1525"><span class='Ref_To_Local'>nkeys</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN1526"><span class='Ref_To_Local'>keys</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN1529"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN1530"><span class='Ref_To_Local'>changed</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1528"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1527"><span class='Ref_To_Local'>tgscan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1557"></a>        <a href="../../include/catalog/pg_trigger.h.html#LN71"><span class='Ref_to_Typedef'>Form_pg_trigger</span></a> <span class='Declare_Local'>oldtrig</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_trigger.h.html#LN71"><span class='Ref_to_Typedef'>Form_pg_trigger</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1528"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1557"><span class='Ref_To_Local'>oldtrig</span></a><span class='Operator'>-&GT;</span>tgisinternal<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* system trigger ... ok to process? */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1522"><span class='Ref_to_Parameter'>skip_system</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>())</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                      <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied: \"%s\" is a system trigger"</span><span class='Delimiter'>, 
</span>                             <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1557"><span class='Ref_To_Local'>oldtrig</span></a><span class='Operator'>-&GT;</span>tgname<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="trigger.c.html#LN1529"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1557"><span class='Ref_To_Local'>oldtrig</span></a><span class='Operator'>-&GT;</span>tgenabled <span class='Operator'>!= </span><a href="trigger.c.html#LN1522"><span class='Ref_to_Parameter'>fires_when</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* need to change this one ... make a copy to scribble on */ 
</span><a name="LN1576"></a>            <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newtup</span> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN606"><span class='Ref_to_Func'>heap_copytuple</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1528"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1577"></a>            <a href="../../include/catalog/pg_trigger.h.html#LN71"><span class='Ref_to_Typedef'>Form_pg_trigger</span></a> <span class='Declare_Local'>newtrig</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_trigger.h.html#LN71"><span class='Ref_to_Typedef'>Form_pg_trigger</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1576"><span class='Ref_To_Local'>newtup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="trigger.c.html#LN1577"><span class='Ref_To_Local'>newtrig</span></a><span class='Operator'>-&GT;</span>tgenabled <span class='Operator'>= </span><a href="trigger.c.html#LN1522"><span class='Ref_to_Parameter'>fires_when</span></a><span class='Delimiter'>; 
</span> 
            <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1524"><span class='Ref_To_Local'>tgrel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="trigger.c.html#LN1576"><span class='Ref_To_Local'>newtup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN1576"><span class='Ref_To_Local'>newtup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1576"><span class='Ref_To_Local'>newtup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="trigger.c.html#LN1530"><span class='Ref_To_Local'>changed</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_trigger.h.html#LN33"><span class='Ref_to_Const'>TriggerRelationId</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1528"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while HeapTupleIsValid(tupl... &raquo; </span> 
 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1527"><span class='Ref_To_Local'>tgscan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1524"><span class='Ref_To_Local'>tgrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1521"><span class='Ref_to_Parameter'>tgname</span></a> <span class='Operator'>&& !</span><a href="trigger.c.html#LN1529"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"trigger \"%s\" for table \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="trigger.c.html#LN1521"><span class='Ref_to_Parameter'>tgname</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1521"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we changed anything, broadcast a SI inval message to force each 
     * backend (including our own!) to rebuild relation's relcache entry. 
     * Otherwise they will fail to apply the change promptly. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1530"><span class='Ref_To_Local'>changed</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/inval.h.html#LN43"><span class='Ref_to_Proto'>CacheInvalidateRelcache</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1521"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end EnableDisableTrigger &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Build trigger data to attach to the given relcache entry. 
 * 
 * Note that trigger data attached to a relcache entry must be stored in 
 * CacheMemoryContext to ensure it survives as long as the relcache entry. 
 * But we should be running in a less long-lived working context.  To avoid 
 * leaking cache memory if this routine fails partway through, we build a 
 * temporary TriggerDesc in working memory and then copy the completed 
 * structure into cache memory. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1623"></a><span class='Declare_Function'>RelationBuildTriggers</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1625"></a>    <a href="../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a> <span class='Operator'>*</span><span class='Declare_Local'>trigdesc</span><span class='Delimiter'>; 
</span><a name="LN1626"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numtrigs</span><span class='Delimiter'>; 
</span><a name="LN1627"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>maxtrigs</span><span class='Delimiter'>; 
</span><a name="LN1628"></a>    <a href="../../include/utils/reltrigger.h.html#LN22"><span class='Ref_to_Struct'>Trigger</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>triggers</span><span class='Delimiter'>; 
</span><a name="LN1629"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>tgrel</span><span class='Delimiter'>; 
</span><a name="LN1630"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>skey</span><span class='Delimiter'>; 
</span><a name="LN1631"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>tgscan</span><span class='Delimiter'>; 
</span><a name="LN1632"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>htup</span><span class='Delimiter'>; 
</span><a name="LN1633"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldContext</span><span class='Delimiter'>; 
</span><a name="LN1634"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Allocate a working array to hold the triggers (the array is extended if 
     * necessary) 
     */ 
</span>    <a href="trigger.c.html#LN1627"><span class='Ref_To_Local'>maxtrigs</span></a> <span class='Operator'>= </span><span class='Number'>16</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN1628"><span class='Ref_To_Local'>triggers</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/utils/reltrigger.h.html#LN22"><span class='Ref_to_Struct'>Trigger</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1627"><span class='Ref_To_Local'>maxtrigs</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/utils/reltrigger.h.html#LN22"><span class='Ref_to_Struct'>Trigger</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN1626"><span class='Ref_To_Local'>numtrigs</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Note: since we scan the triggers using TriggerRelidNameIndexId, we will 
     * be reading the triggers in name order, except possibly during 
     * emergency-recovery operations (ie, IgnoreSystemIndexes). This in turn 
     * ensures that triggers will be fired in name order. 
     */ 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN1630"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/catalog/pg_trigger.h.html#LN78"><span class='Ref_to_Const'>Anum_pg_trigger_tgrelid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1623"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN1629"><span class='Ref_To_Local'>tgrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_trigger.h.html#LN33"><span class='Ref_to_Const'>TriggerRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN1631"><span class='Ref_To_Local'>tgscan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1629"><span class='Ref_To_Local'>tgrel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN248"><span class='Ref_to_Const'>TriggerRelidNameIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="trigger.c.html#LN1630"><span class='Ref_To_Local'>skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1632"><span class='Ref_To_Local'>htup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1631"><span class='Ref_To_Local'>tgscan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1661"></a>        <a href="../../include/catalog/pg_trigger.h.html#LN71"><span class='Ref_to_Typedef'>Form_pg_trigger</span></a> <span class='Declare_Local'>pg_trigger</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_trigger.h.html#LN71"><span class='Ref_to_Typedef'>Form_pg_trigger</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1632"><span class='Ref_To_Local'>htup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1662"></a>        <a href="../../include/utils/reltrigger.h.html#LN22"><span class='Ref_to_Struct'>Trigger</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>build</span><span class='Delimiter'>; 
</span><a name="LN1663"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>datum</span><span class='Delimiter'>; 
</span><a name="LN1664"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1626"><span class='Ref_To_Local'>numtrigs</span></a> <span class='Operator'>&GT;= </span><a href="trigger.c.html#LN1627"><span class='Ref_To_Local'>maxtrigs</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="trigger.c.html#LN1627"><span class='Ref_To_Local'>maxtrigs</span></a> <span class='Operator'>*= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>            <a href="trigger.c.html#LN1628"><span class='Ref_To_Local'>triggers</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/utils/reltrigger.h.html#LN22"><span class='Ref_to_Struct'>Trigger</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1628"><span class='Ref_To_Local'>triggers</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN1627"><span class='Ref_To_Local'>maxtrigs</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/utils/reltrigger.h.html#LN22"><span class='Ref_to_Struct'>Trigger</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="trigger.c.html#LN1662"><span class='Ref_To_Local'>build</span></a> <span class='Operator'>= &</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN1628"><span class='Ref_To_Local'>triggers</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN1626"><span class='Ref_To_Local'>numtrigs</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="trigger.c.html#LN1662"><span class='Ref_To_Local'>build</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN24"><span class='Ref_to_Member'>tgoid</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1632"><span class='Ref_To_Local'>htup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN1662"><span class='Ref_To_Local'>build</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN26"><span class='Ref_to_Member'>tgname</span></a> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN571"><span class='Ref_to_Macro'>DatumGetCString</span></a><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../utils/adt/name.c.html#LN67"><span class='Ref_to_Func'>nameout</span></a><span class='Delimiter'>, 
</span>                                         <a href="../../include/postgres.h.html#LN600"><span class='Ref_to_Macro'>NameGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN1661"><span class='Ref_To_Local'>pg_trigger</span></a><span class='Operator'>-&GT;</span>tgname<span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN1662"><span class='Ref_To_Local'>build</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN27"><span class='Ref_to_Member'>tgfoid</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN1661"><span class='Ref_To_Local'>pg_trigger</span></a><span class='Operator'>-&GT;</span>tgfoid<span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN1662"><span class='Ref_To_Local'>build</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN28"><span class='Ref_to_Member'>tgtype</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN1661"><span class='Ref_To_Local'>pg_trigger</span></a><span class='Operator'>-&GT;</span>tgtype<span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN1662"><span class='Ref_To_Local'>build</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN29"><span class='Ref_to_Member'>tgenabled</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN1661"><span class='Ref_To_Local'>pg_trigger</span></a><span class='Operator'>-&GT;</span>tgenabled<span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN1662"><span class='Ref_To_Local'>build</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN30"><span class='Ref_to_Member'>tgisinternal</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN1661"><span class='Ref_To_Local'>pg_trigger</span></a><span class='Operator'>-&GT;</span>tgisinternal<span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN1662"><span class='Ref_To_Local'>build</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN31"><span class='Ref_to_Member'>tgconstrrelid</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN1661"><span class='Ref_To_Local'>pg_trigger</span></a><span class='Operator'>-&GT;</span>tgconstrrelid<span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN1662"><span class='Ref_To_Local'>build</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN32"><span class='Ref_to_Member'>tgconstrindid</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN1661"><span class='Ref_To_Local'>pg_trigger</span></a><span class='Operator'>-&GT;</span>tgconstrindid<span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN1662"><span class='Ref_To_Local'>build</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN33"><span class='Ref_to_Member'>tgconstraint</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN1661"><span class='Ref_To_Local'>pg_trigger</span></a><span class='Operator'>-&GT;</span>tgconstraint<span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN1662"><span class='Ref_To_Local'>build</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN34"><span class='Ref_to_Member'>tgdeferrable</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN1661"><span class='Ref_To_Local'>pg_trigger</span></a><span class='Operator'>-&GT;</span>tgdeferrable<span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN1662"><span class='Ref_To_Local'>build</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN35"><span class='Ref_to_Member'>tginitdeferred</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN1661"><span class='Ref_To_Local'>pg_trigger</span></a><span class='Operator'>-&GT;</span>tginitdeferred<span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN1662"><span class='Ref_To_Local'>build</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN36"><span class='Ref_to_Member'>tgnargs</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN1661"><span class='Ref_To_Local'>pg_trigger</span></a><span class='Operator'>-&GT;</span>tgnargs<span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* tgattr is first var-width field, so OK to access directly */ 
</span>        <a href="trigger.c.html#LN1662"><span class='Ref_To_Local'>build</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN37"><span class='Ref_to_Member'>tgnattr</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN1661"><span class='Ref_To_Local'>pg_trigger</span></a><span class='Operator'>-&GT;</span>tgattr<span class='Operator'>.</span>dim1<span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1662"><span class='Ref_To_Local'>build</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN37"><span class='Ref_to_Member'>tgnattr</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="trigger.c.html#LN1662"><span class='Ref_To_Local'>build</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN38"><span class='Ref_to_Member'>tgattr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1662"><span class='Ref_To_Local'>build</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN37"><span class='Ref_to_Member'>tgnattr</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            memcpy<span class='Parentheses'>(</span><a href="trigger.c.html#LN1662"><span class='Ref_To_Local'>build</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN38"><span class='Ref_to_Member'>tgattr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN1661"><span class='Ref_To_Local'>pg_trigger</span></a><span class='Operator'>-&GT;</span>tgattr<span class='Operator'>.</span>values<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                   <a href="trigger.c.html#LN1662"><span class='Ref_To_Local'>build</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN37"><span class='Ref_to_Member'>tgnattr</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="trigger.c.html#LN1662"><span class='Ref_To_Local'>build</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN38"><span class='Ref_to_Member'>tgattr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1662"><span class='Ref_To_Local'>build</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN36"><span class='Ref_to_Member'>tgnargs</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1698"></a>            <a href="../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN1699"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span> 
            <a href="trigger.c.html#LN1698"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN254"><span class='Ref_to_Macro'>DatumGetByteaPP</span></a><span class='Parentheses'>(</span><a href="../../include/access/htup_details.h.html#LN718"><span class='Ref_to_Macro'>fastgetattr</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1632"><span class='Ref_To_Local'>htup</span></a><span class='Delimiter'>, 
</span>                                              <a href="../../include/catalog/pg_trigger.h.html#LN91"><span class='Ref_to_Const'>Anum_pg_trigger_tgargs</span></a><span class='Delimiter'>, 
</span>                                              <a href="trigger.c.html#LN1629"><span class='Ref_To_Local'>tgrel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="trigger.c.html#LN1664"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1664"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"tgargs is null in trigger for relation \"%s\""</span><span class='Delimiter'>, 
</span>                     <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1623"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="trigger.c.html#LN1699"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1698"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="trigger.c.html#LN1662"><span class='Ref_To_Local'>build</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN39"><span class='Ref_to_Member'>tgargs</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1662"><span class='Ref_To_Local'>build</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN36"><span class='Ref_to_Member'>tgnargs</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1634"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="trigger.c.html#LN1634"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="trigger.c.html#LN1662"><span class='Ref_To_Local'>build</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN36"><span class='Ref_to_Member'>tgnargs</span></a><span class='Delimiter'>; </span><a href="trigger.c.html#LN1634"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="trigger.c.html#LN1662"><span class='Ref_To_Local'>build</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN39"><span class='Ref_to_Member'>tgargs</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN1634"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1699"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="trigger.c.html#LN1699"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+= </span>strlen<span class='Parentheses'>(</span><a href="trigger.c.html#LN1699"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="trigger.c.html#LN1662"><span class='Ref_To_Local'>build</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN39"><span class='Ref_to_Member'>tgargs</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <a href="trigger.c.html#LN1663"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN718"><span class='Ref_to_Macro'>fastgetattr</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1632"><span class='Ref_To_Local'>htup</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN93"><span class='Ref_to_Const'>Anum_pg_trigger_tgoldtable</span></a><span class='Delimiter'>, 
</span>                            <a href="trigger.c.html#LN1629"><span class='Ref_To_Local'>tgrel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="trigger.c.html#LN1664"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="trigger.c.html#LN1664"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>            <a href="trigger.c.html#LN1662"><span class='Ref_To_Local'>build</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN41"><span class='Ref_to_Member'>tgoldtable</span></a> <span class='Operator'>= 
</span>                <a href="../../include/postgres.h.html#LN571"><span class='Ref_to_Macro'>DatumGetCString</span></a><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../utils/adt/name.c.html#LN67"><span class='Ref_to_Func'>nameout</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN1663"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="trigger.c.html#LN1662"><span class='Ref_To_Local'>build</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN41"><span class='Ref_to_Member'>tgoldtable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <a href="trigger.c.html#LN1663"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN718"><span class='Ref_to_Macro'>fastgetattr</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1632"><span class='Ref_To_Local'>htup</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN94"><span class='Ref_to_Const'>Anum_pg_trigger_tgnewtable</span></a><span class='Delimiter'>, 
</span>                            <a href="trigger.c.html#LN1629"><span class='Ref_To_Local'>tgrel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="trigger.c.html#LN1664"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="trigger.c.html#LN1664"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>            <a href="trigger.c.html#LN1662"><span class='Ref_To_Local'>build</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN42"><span class='Ref_to_Member'>tgnewtable</span></a> <span class='Operator'>= 
</span>                <a href="../../include/postgres.h.html#LN571"><span class='Ref_to_Macro'>DatumGetCString</span></a><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../utils/adt/name.c.html#LN67"><span class='Ref_to_Func'>nameout</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN1663"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="trigger.c.html#LN1662"><span class='Ref_To_Local'>build</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN42"><span class='Ref_to_Member'>tgnewtable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <a href="trigger.c.html#LN1663"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN718"><span class='Ref_to_Macro'>fastgetattr</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1632"><span class='Ref_To_Local'>htup</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN92"><span class='Ref_to_Const'>Anum_pg_trigger_tgqual</span></a><span class='Delimiter'>, 
</span>                            <a href="trigger.c.html#LN1629"><span class='Ref_To_Local'>tgrel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="trigger.c.html#LN1664"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="trigger.c.html#LN1664"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>            <a href="trigger.c.html#LN1662"><span class='Ref_To_Local'>build</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN40"><span class='Ref_to_Member'>tgqual</span></a> <span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1663"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="trigger.c.html#LN1662"><span class='Ref_To_Local'>build</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN40"><span class='Ref_to_Member'>tgqual</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <a href="trigger.c.html#LN1626"><span class='Ref_To_Local'>numtrigs</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while HeapTupleIsValid(htup... &raquo; </span> 
 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1631"><span class='Ref_To_Local'>tgscan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1629"><span class='Ref_To_Local'>tgrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* There might not be any triggers */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1626"><span class='Ref_To_Local'>numtrigs</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1628"><span class='Ref_To_Local'>triggers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Build trigdesc */ 
</span>    <a href="trigger.c.html#LN1625"><span class='Ref_To_Local'>trigdesc</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN1625"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN47"><span class='Ref_to_Member'>triggers</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN1628"><span class='Ref_To_Local'>triggers</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN1625"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN48"><span class='Ref_to_Member'>numtriggers</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN1626"><span class='Ref_To_Local'>numtrigs</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1634"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="trigger.c.html#LN1634"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="trigger.c.html#LN1626"><span class='Ref_To_Local'>numtrigs</span></a><span class='Delimiter'>; </span><a href="trigger.c.html#LN1634"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="trigger.c.html#LN79"><span class='Ref_to_Proto'>SetTriggerFlags</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1625"><span class='Ref_To_Local'>trigdesc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN1628"><span class='Ref_To_Local'>triggers</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN1634"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Copy completed trigdesc into cache storage */ 
</span>    <a href="trigger.c.html#LN1633"><span class='Ref_To_Local'>oldContext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN1623"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN119"><span class='Ref_to_Member'>trigdesc</span></a> <span class='Operator'>= </span><a href="../../include/commands/trigger.h.html#LN127"><span class='Ref_to_Proto'>CopyTriggerDesc</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1625"><span class='Ref_To_Local'>trigdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1633"><span class='Ref_To_Local'>oldContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Release working memory */ 
</span>    <a href="../../include/commands/trigger.h.html#LN129"><span class='Ref_to_Proto'>FreeTriggerDesc</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1625"><span class='Ref_To_Local'>trigdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RelationBuildTriggers &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Update the TriggerDesc's hint flags to include the specified trigger 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1774"></a><span class='Declare_Function'>SetTriggerFlags</span><span class='Parentheses'>(</span><a href="../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>trigdesc</span><span class='Delimiter'>, </span><a href="../../include/utils/reltrigger.h.html#LN22"><span class='Ref_to_Struct'>Trigger</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>trigger</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1776"></a>    <a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>tgtype</span> <span class='Operator'>= </span><a href="trigger.c.html#LN1774"><span class='Ref_to_Parameter'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN28"><span class='Ref_to_Member'>tgtype</span></a><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN1774"><span class='Ref_to_Parameter'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN54"><span class='Ref_to_Member'>trig_insert_before_row</span></a> <span class='Operator'>|= 
</span>        <a href="../../include/catalog/pg_trigger.h.html#LN145"><span class='Ref_to_Macro'>TRIGGER_TYPE_MATCHES</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1776"><span class='Ref_To_Local'>tgtype</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN97"><span class='Ref_to_Const'>TRIGGER_TYPE_ROW</span></a><span class='Delimiter'>, 
</span>                             <a href="../../include/catalog/pg_trigger.h.html#LN98"><span class='Ref_to_Const'>TRIGGER_TYPE_BEFORE</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN99"><span class='Ref_to_Const'>TRIGGER_TYPE_INSERT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN1774"><span class='Ref_to_Parameter'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN55"><span class='Ref_to_Member'>trig_insert_after_row</span></a> <span class='Operator'>|= 
</span>        <a href="../../include/catalog/pg_trigger.h.html#LN145"><span class='Ref_to_Macro'>TRIGGER_TYPE_MATCHES</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1776"><span class='Ref_To_Local'>tgtype</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN97"><span class='Ref_to_Const'>TRIGGER_TYPE_ROW</span></a><span class='Delimiter'>, 
</span>                             <a href="../../include/catalog/pg_trigger.h.html#LN111"><span class='Ref_to_Const'>TRIGGER_TYPE_AFTER</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN99"><span class='Ref_to_Const'>TRIGGER_TYPE_INSERT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN1774"><span class='Ref_to_Parameter'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN56"><span class='Ref_to_Member'>trig_insert_instead_row</span></a> <span class='Operator'>|= 
</span>        <a href="../../include/catalog/pg_trigger.h.html#LN145"><span class='Ref_to_Macro'>TRIGGER_TYPE_MATCHES</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1776"><span class='Ref_To_Local'>tgtype</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN97"><span class='Ref_to_Const'>TRIGGER_TYPE_ROW</span></a><span class='Delimiter'>, 
</span>                             <a href="../../include/catalog/pg_trigger.h.html#LN103"><span class='Ref_to_Const'>TRIGGER_TYPE_INSTEAD</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN99"><span class='Ref_to_Const'>TRIGGER_TYPE_INSERT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN1774"><span class='Ref_to_Parameter'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN57"><span class='Ref_to_Member'>trig_insert_before_statement</span></a> <span class='Operator'>|= 
</span>        <a href="../../include/catalog/pg_trigger.h.html#LN145"><span class='Ref_to_Macro'>TRIGGER_TYPE_MATCHES</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1776"><span class='Ref_To_Local'>tgtype</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN106"><span class='Ref_to_Const'>TRIGGER_TYPE_STATEMENT</span></a><span class='Delimiter'>, 
</span>                             <a href="../../include/catalog/pg_trigger.h.html#LN98"><span class='Ref_to_Const'>TRIGGER_TYPE_BEFORE</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN99"><span class='Ref_to_Const'>TRIGGER_TYPE_INSERT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN1774"><span class='Ref_to_Parameter'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN58"><span class='Ref_to_Member'>trig_insert_after_statement</span></a> <span class='Operator'>|= 
</span>        <a href="../../include/catalog/pg_trigger.h.html#LN145"><span class='Ref_to_Macro'>TRIGGER_TYPE_MATCHES</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1776"><span class='Ref_To_Local'>tgtype</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN106"><span class='Ref_to_Const'>TRIGGER_TYPE_STATEMENT</span></a><span class='Delimiter'>, 
</span>                             <a href="../../include/catalog/pg_trigger.h.html#LN111"><span class='Ref_to_Const'>TRIGGER_TYPE_AFTER</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN99"><span class='Ref_to_Const'>TRIGGER_TYPE_INSERT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN1774"><span class='Ref_to_Parameter'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN59"><span class='Ref_to_Member'>trig_update_before_row</span></a> <span class='Operator'>|= 
</span>        <a href="../../include/catalog/pg_trigger.h.html#LN145"><span class='Ref_to_Macro'>TRIGGER_TYPE_MATCHES</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1776"><span class='Ref_To_Local'>tgtype</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN97"><span class='Ref_to_Const'>TRIGGER_TYPE_ROW</span></a><span class='Delimiter'>, 
</span>                             <a href="../../include/catalog/pg_trigger.h.html#LN98"><span class='Ref_to_Const'>TRIGGER_TYPE_BEFORE</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN101"><span class='Ref_to_Const'>TRIGGER_TYPE_UPDATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN1774"><span class='Ref_to_Parameter'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN60"><span class='Ref_to_Member'>trig_update_after_row</span></a> <span class='Operator'>|= 
</span>        <a href="../../include/catalog/pg_trigger.h.html#LN145"><span class='Ref_to_Macro'>TRIGGER_TYPE_MATCHES</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1776"><span class='Ref_To_Local'>tgtype</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN97"><span class='Ref_to_Const'>TRIGGER_TYPE_ROW</span></a><span class='Delimiter'>, 
</span>                             <a href="../../include/catalog/pg_trigger.h.html#LN111"><span class='Ref_to_Const'>TRIGGER_TYPE_AFTER</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN101"><span class='Ref_to_Const'>TRIGGER_TYPE_UPDATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN1774"><span class='Ref_to_Parameter'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN61"><span class='Ref_to_Member'>trig_update_instead_row</span></a> <span class='Operator'>|= 
</span>        <a href="../../include/catalog/pg_trigger.h.html#LN145"><span class='Ref_to_Macro'>TRIGGER_TYPE_MATCHES</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1776"><span class='Ref_To_Local'>tgtype</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN97"><span class='Ref_to_Const'>TRIGGER_TYPE_ROW</span></a><span class='Delimiter'>, 
</span>                             <a href="../../include/catalog/pg_trigger.h.html#LN103"><span class='Ref_to_Const'>TRIGGER_TYPE_INSTEAD</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN101"><span class='Ref_to_Const'>TRIGGER_TYPE_UPDATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN1774"><span class='Ref_to_Parameter'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN62"><span class='Ref_to_Member'>trig_update_before_statement</span></a> <span class='Operator'>|= 
</span>        <a href="../../include/catalog/pg_trigger.h.html#LN145"><span class='Ref_to_Macro'>TRIGGER_TYPE_MATCHES</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1776"><span class='Ref_To_Local'>tgtype</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN106"><span class='Ref_to_Const'>TRIGGER_TYPE_STATEMENT</span></a><span class='Delimiter'>, 
</span>                             <a href="../../include/catalog/pg_trigger.h.html#LN98"><span class='Ref_to_Const'>TRIGGER_TYPE_BEFORE</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN101"><span class='Ref_to_Const'>TRIGGER_TYPE_UPDATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN1774"><span class='Ref_to_Parameter'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN63"><span class='Ref_to_Member'>trig_update_after_statement</span></a> <span class='Operator'>|= 
</span>        <a href="../../include/catalog/pg_trigger.h.html#LN145"><span class='Ref_to_Macro'>TRIGGER_TYPE_MATCHES</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1776"><span class='Ref_To_Local'>tgtype</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN106"><span class='Ref_to_Const'>TRIGGER_TYPE_STATEMENT</span></a><span class='Delimiter'>, 
</span>                             <a href="../../include/catalog/pg_trigger.h.html#LN111"><span class='Ref_to_Const'>TRIGGER_TYPE_AFTER</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN101"><span class='Ref_to_Const'>TRIGGER_TYPE_UPDATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN1774"><span class='Ref_to_Parameter'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN64"><span class='Ref_to_Member'>trig_delete_before_row</span></a> <span class='Operator'>|= 
</span>        <a href="../../include/catalog/pg_trigger.h.html#LN145"><span class='Ref_to_Macro'>TRIGGER_TYPE_MATCHES</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1776"><span class='Ref_To_Local'>tgtype</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN97"><span class='Ref_to_Const'>TRIGGER_TYPE_ROW</span></a><span class='Delimiter'>, 
</span>                             <a href="../../include/catalog/pg_trigger.h.html#LN98"><span class='Ref_to_Const'>TRIGGER_TYPE_BEFORE</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN100"><span class='Ref_to_Const'>TRIGGER_TYPE_DELETE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN1774"><span class='Ref_to_Parameter'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN65"><span class='Ref_to_Member'>trig_delete_after_row</span></a> <span class='Operator'>|= 
</span>        <a href="../../include/catalog/pg_trigger.h.html#LN145"><span class='Ref_to_Macro'>TRIGGER_TYPE_MATCHES</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1776"><span class='Ref_To_Local'>tgtype</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN97"><span class='Ref_to_Const'>TRIGGER_TYPE_ROW</span></a><span class='Delimiter'>, 
</span>                             <a href="../../include/catalog/pg_trigger.h.html#LN111"><span class='Ref_to_Const'>TRIGGER_TYPE_AFTER</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN100"><span class='Ref_to_Const'>TRIGGER_TYPE_DELETE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN1774"><span class='Ref_to_Parameter'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN66"><span class='Ref_to_Member'>trig_delete_instead_row</span></a> <span class='Operator'>|= 
</span>        <a href="../../include/catalog/pg_trigger.h.html#LN145"><span class='Ref_to_Macro'>TRIGGER_TYPE_MATCHES</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1776"><span class='Ref_To_Local'>tgtype</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN97"><span class='Ref_to_Const'>TRIGGER_TYPE_ROW</span></a><span class='Delimiter'>, 
</span>                             <a href="../../include/catalog/pg_trigger.h.html#LN103"><span class='Ref_to_Const'>TRIGGER_TYPE_INSTEAD</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN100"><span class='Ref_to_Const'>TRIGGER_TYPE_DELETE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN1774"><span class='Ref_to_Parameter'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN67"><span class='Ref_to_Member'>trig_delete_before_statement</span></a> <span class='Operator'>|= 
</span>        <a href="../../include/catalog/pg_trigger.h.html#LN145"><span class='Ref_to_Macro'>TRIGGER_TYPE_MATCHES</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1776"><span class='Ref_To_Local'>tgtype</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN106"><span class='Ref_to_Const'>TRIGGER_TYPE_STATEMENT</span></a><span class='Delimiter'>, 
</span>                             <a href="../../include/catalog/pg_trigger.h.html#LN98"><span class='Ref_to_Const'>TRIGGER_TYPE_BEFORE</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN100"><span class='Ref_to_Const'>TRIGGER_TYPE_DELETE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN1774"><span class='Ref_to_Parameter'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN68"><span class='Ref_to_Member'>trig_delete_after_statement</span></a> <span class='Operator'>|= 
</span>        <a href="../../include/catalog/pg_trigger.h.html#LN145"><span class='Ref_to_Macro'>TRIGGER_TYPE_MATCHES</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1776"><span class='Ref_To_Local'>tgtype</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN106"><span class='Ref_to_Const'>TRIGGER_TYPE_STATEMENT</span></a><span class='Delimiter'>, 
</span>                             <a href="../../include/catalog/pg_trigger.h.html#LN111"><span class='Ref_to_Const'>TRIGGER_TYPE_AFTER</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN100"><span class='Ref_to_Const'>TRIGGER_TYPE_DELETE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* there are no row-level truncate triggers */ 
</span>    <a href="trigger.c.html#LN1774"><span class='Ref_to_Parameter'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN70"><span class='Ref_to_Member'>trig_truncate_before_statement</span></a> <span class='Operator'>|= 
</span>        <a href="../../include/catalog/pg_trigger.h.html#LN145"><span class='Ref_to_Macro'>TRIGGER_TYPE_MATCHES</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1776"><span class='Ref_To_Local'>tgtype</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN106"><span class='Ref_to_Const'>TRIGGER_TYPE_STATEMENT</span></a><span class='Delimiter'>, 
</span>                             <a href="../../include/catalog/pg_trigger.h.html#LN98"><span class='Ref_to_Const'>TRIGGER_TYPE_BEFORE</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN102"><span class='Ref_to_Const'>TRIGGER_TYPE_TRUNCATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN1774"><span class='Ref_to_Parameter'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN71"><span class='Ref_to_Member'>trig_truncate_after_statement</span></a> <span class='Operator'>|= 
</span>        <a href="../../include/catalog/pg_trigger.h.html#LN145"><span class='Ref_to_Macro'>TRIGGER_TYPE_MATCHES</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1776"><span class='Ref_To_Local'>tgtype</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN106"><span class='Ref_to_Const'>TRIGGER_TYPE_STATEMENT</span></a><span class='Delimiter'>, 
</span>                             <a href="../../include/catalog/pg_trigger.h.html#LN111"><span class='Ref_to_Const'>TRIGGER_TYPE_AFTER</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_trigger.h.html#LN102"><span class='Ref_to_Const'>TRIGGER_TYPE_TRUNCATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN1774"><span class='Ref_to_Parameter'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN73"><span class='Ref_to_Member'>trig_insert_new_table</span></a> <span class='Operator'>|= 
</span>        <span class='Parentheses'>(</span><a href="../../include/catalog/pg_trigger.h.html#LN133"><span class='Ref_to_Macro'>TRIGGER_FOR_INSERT</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1776"><span class='Ref_To_Local'>tgtype</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>         <a href="../../include/catalog/pg_trigger.h.html#LN152"><span class='Ref_to_Macro'>TRIGGER_USES_TRANSITION_TABLE</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1774"><span class='Ref_to_Parameter'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN42"><span class='Ref_to_Member'>tgnewtable</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN1774"><span class='Ref_to_Parameter'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN74"><span class='Ref_to_Member'>trig_update_old_table</span></a> <span class='Operator'>|= 
</span>        <span class='Parentheses'>(</span><a href="../../include/catalog/pg_trigger.h.html#LN135"><span class='Ref_to_Macro'>TRIGGER_FOR_UPDATE</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1776"><span class='Ref_To_Local'>tgtype</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>         <a href="../../include/catalog/pg_trigger.h.html#LN152"><span class='Ref_to_Macro'>TRIGGER_USES_TRANSITION_TABLE</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1774"><span class='Ref_to_Parameter'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN41"><span class='Ref_to_Member'>tgoldtable</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN1774"><span class='Ref_to_Parameter'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN75"><span class='Ref_to_Member'>trig_update_new_table</span></a> <span class='Operator'>|= 
</span>        <span class='Parentheses'>(</span><a href="../../include/catalog/pg_trigger.h.html#LN135"><span class='Ref_to_Macro'>TRIGGER_FOR_UPDATE</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1776"><span class='Ref_To_Local'>tgtype</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>         <a href="../../include/catalog/pg_trigger.h.html#LN152"><span class='Ref_to_Macro'>TRIGGER_USES_TRANSITION_TABLE</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1774"><span class='Ref_to_Parameter'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN42"><span class='Ref_to_Member'>tgnewtable</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN1774"><span class='Ref_to_Parameter'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN76"><span class='Ref_to_Member'>trig_delete_old_table</span></a> <span class='Operator'>|= 
</span>        <span class='Parentheses'>(</span><a href="../../include/catalog/pg_trigger.h.html#LN134"><span class='Ref_to_Macro'>TRIGGER_FOR_DELETE</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1776"><span class='Ref_To_Local'>tgtype</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>         <a href="../../include/catalog/pg_trigger.h.html#LN152"><span class='Ref_to_Macro'>TRIGGER_USES_TRANSITION_TABLE</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1774"><span class='Ref_to_Parameter'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN41"><span class='Ref_to_Member'>tgoldtable</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SetTriggerFlags &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Copy a TriggerDesc data structure. 
 * 
 * The copy is allocated in the current memory context. 
 */ 
</span><a href="../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a> <span class='Operator'>* 
</span><a name="LN1851"></a><span class='Declare_Function'>CopyTriggerDesc</span><span class='Parentheses'>(</span><a href="../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>trigdesc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1853"></a>    <a href="../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a> <span class='Operator'>*</span><span class='Declare_Local'>newdesc</span><span class='Delimiter'>; 
</span><a name="LN1854"></a>    <a href="../../include/utils/reltrigger.h.html#LN22"><span class='Ref_to_Struct'>Trigger</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>trigger</span><span class='Delimiter'>; 
</span><a name="LN1855"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1851"><span class='Ref_to_Parameter'>trigdesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="trigger.c.html#LN1851"><span class='Ref_to_Parameter'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN48"><span class='Ref_to_Member'>numtriggers</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN1853"><span class='Ref_To_Local'>newdesc</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="trigger.c.html#LN1853"><span class='Ref_To_Local'>newdesc</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN1851"><span class='Ref_to_Parameter'>trigdesc</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN1854"><span class='Ref_To_Local'>trigger</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/utils/reltrigger.h.html#LN22"><span class='Ref_to_Struct'>Trigger</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1851"><span class='Ref_to_Parameter'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN48"><span class='Ref_to_Member'>numtriggers</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/utils/reltrigger.h.html#LN22"><span class='Ref_to_Struct'>Trigger</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="trigger.c.html#LN1854"><span class='Ref_To_Local'>trigger</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN1851"><span class='Ref_to_Parameter'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN47"><span class='Ref_to_Member'>triggers</span></a><span class='Delimiter'>, 
</span>           <a href="trigger.c.html#LN1851"><span class='Ref_to_Parameter'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN48"><span class='Ref_to_Member'>numtriggers</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/utils/reltrigger.h.html#LN22"><span class='Ref_to_Struct'>Trigger</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN1853"><span class='Ref_To_Local'>newdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN47"><span class='Ref_to_Member'>triggers</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN1854"><span class='Ref_To_Local'>trigger</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1855"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="trigger.c.html#LN1855"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="trigger.c.html#LN1851"><span class='Ref_to_Parameter'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN48"><span class='Ref_to_Member'>numtriggers</span></a><span class='Delimiter'>; </span><a href="trigger.c.html#LN1855"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="trigger.c.html#LN1854"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN26"><span class='Ref_to_Member'>tgname</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1854"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN26"><span class='Ref_to_Member'>tgname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1854"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN37"><span class='Ref_to_Member'>tgnattr</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1873"></a>            <a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>newattr</span><span class='Delimiter'>; 
</span> 
            <a href="trigger.c.html#LN1873"><span class='Ref_To_Local'>newattr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1854"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN37"><span class='Ref_to_Member'>tgnattr</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            memcpy<span class='Parentheses'>(</span><a href="trigger.c.html#LN1873"><span class='Ref_To_Local'>newattr</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN1854"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN38"><span class='Ref_to_Member'>tgattr</span></a><span class='Delimiter'>, 
</span>                   <a href="trigger.c.html#LN1854"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN37"><span class='Ref_to_Member'>tgnattr</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="trigger.c.html#LN1854"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN38"><span class='Ref_to_Member'>tgattr</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN1873"><span class='Ref_To_Local'>newattr</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1854"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN36"><span class='Ref_to_Member'>tgnargs</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1882"></a>            <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>newargs</span><span class='Delimiter'>; 
</span><a name="LN1883"></a>            <a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span> 
            <a href="trigger.c.html#LN1882"><span class='Ref_To_Local'>newargs</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1854"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN36"><span class='Ref_to_Member'>tgnargs</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1883"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="trigger.c.html#LN1883"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="trigger.c.html#LN1854"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN36"><span class='Ref_to_Member'>tgnargs</span></a><span class='Delimiter'>; </span><a href="trigger.c.html#LN1883"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <a href="trigger.c.html#LN1882"><span class='Ref_To_Local'>newargs</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN1883"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1854"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN39"><span class='Ref_to_Member'>tgargs</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN1883"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="trigger.c.html#LN1854"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN39"><span class='Ref_to_Member'>tgargs</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN1882"><span class='Ref_To_Local'>newargs</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1854"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN40"><span class='Ref_to_Member'>tgqual</span></a><span class='Parentheses'>) 
</span>            <a href="trigger.c.html#LN1854"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN40"><span class='Ref_to_Member'>tgqual</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1854"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN40"><span class='Ref_to_Member'>tgqual</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1854"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN41"><span class='Ref_to_Member'>tgoldtable</span></a><span class='Parentheses'>) 
</span>            <a href="trigger.c.html#LN1854"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN41"><span class='Ref_to_Member'>tgoldtable</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1854"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN41"><span class='Ref_to_Member'>tgoldtable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1854"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN42"><span class='Ref_to_Member'>tgnewtable</span></a><span class='Parentheses'>) 
</span>            <a href="trigger.c.html#LN1854"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN42"><span class='Ref_to_Member'>tgnewtable</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1854"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN42"><span class='Ref_to_Member'>tgnewtable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN1854"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;trigdesc-&GT;numtr... &raquo; </span> 
 
    <span class='Control'>return</span> <a href="trigger.c.html#LN1853"><span class='Ref_To_Local'>newdesc</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CopyTriggerDesc &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Free a TriggerDesc data structure. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1906"></a><span class='Declare_Function'>FreeTriggerDesc</span><span class='Parentheses'>(</span><a href="../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>trigdesc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1908"></a>    <a href="../../include/utils/reltrigger.h.html#LN22"><span class='Ref_to_Struct'>Trigger</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>trigger</span><span class='Delimiter'>; 
</span><a name="LN1909"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1906"><span class='Ref_to_Parameter'>trigdesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN1908"><span class='Ref_To_Local'>trigger</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN1906"><span class='Ref_to_Parameter'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN47"><span class='Ref_to_Member'>triggers</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1909"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="trigger.c.html#LN1909"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="trigger.c.html#LN1906"><span class='Ref_to_Parameter'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN48"><span class='Ref_to_Member'>numtriggers</span></a><span class='Delimiter'>; </span><a href="trigger.c.html#LN1909"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1908"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN26"><span class='Ref_to_Member'>tgname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1908"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN37"><span class='Ref_to_Member'>tgnattr</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1908"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN38"><span class='Ref_to_Member'>tgattr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1908"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN36"><span class='Ref_to_Member'>tgnargs</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>--</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN1908"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN36"><span class='Ref_to_Member'>tgnargs</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1908"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN39"><span class='Ref_to_Member'>tgargs</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN1908"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN36"><span class='Ref_to_Member'>tgnargs</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1908"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN39"><span class='Ref_to_Member'>tgargs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1908"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN40"><span class='Ref_to_Member'>tgqual</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1908"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN40"><span class='Ref_to_Member'>tgqual</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1908"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN41"><span class='Ref_to_Member'>tgoldtable</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1908"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN41"><span class='Ref_to_Member'>tgoldtable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1908"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN42"><span class='Ref_to_Member'>tgnewtable</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1908"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN42"><span class='Ref_to_Member'>tgnewtable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN1908"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1906"><span class='Ref_to_Parameter'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN47"><span class='Ref_to_Member'>triggers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN1906"><span class='Ref_to_Parameter'>trigdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end FreeTriggerDesc &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Compare two TriggerDesc structures for logical equality. 
 */ 
</span><span class='Directive'>#ifdef</span> NOT_USED 
<span class='Keyword'>bool 
</span><a name="LN1943"></a><span class='Declare_Function'>equalTriggerDescs</span><span class='Parentheses'>(</span><a href="../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>trigdesc1</span><span class='Delimiter'>, </span><a href="../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>trigdesc2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1945"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN1946"></a>                <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We need not examine the hint flags, just the trigger array itself; if 
     * we have the same triggers with the same types, the flags should match. 
     * 
     * As of 7.3 we assume trigger set ordering is significant in the 
     * comparison; so we just compare corresponding slots of the two sets. 
     * 
     * Note: comparing the stringToNode forms of the WHEN clauses means that 
     * parse column locations will affect the result.  This is okay as long as 
     * this function is only used for detecting exact equality, as for example 
     * in checking for staleness of a cache entry. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1943"><span class='Ref_to_Parameter'>trigdesc1</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1943"><span class='Ref_to_Parameter'>trigdesc2</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1943"><span class='Ref_to_Parameter'>trigdesc1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN48"><span class='Ref_to_Member'>numtriggers</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN1943"><span class='Ref_to_Parameter'>trigdesc2</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN48"><span class='Ref_to_Member'>numtriggers</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1945"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="trigger.c.html#LN1945"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="trigger.c.html#LN1943"><span class='Ref_to_Parameter'>trigdesc1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN48"><span class='Ref_to_Member'>numtriggers</span></a><span class='Delimiter'>; </span><a href="trigger.c.html#LN1945"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1968"></a>            <a href="../../include/utils/reltrigger.h.html#LN22"><span class='Ref_to_Struct'>Trigger</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>trig1</span> <span class='Operator'>= </span><a href="trigger.c.html#LN1943"><span class='Ref_to_Parameter'>trigdesc1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN47"><span class='Ref_to_Member'>triggers</span></a> <span class='Operator'>+ </span><a href="trigger.c.html#LN1945"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span><a name="LN1969"></a>            <a href="../../include/utils/reltrigger.h.html#LN22"><span class='Ref_to_Struct'>Trigger</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>trig2</span> <span class='Operator'>= </span><a href="trigger.c.html#LN1943"><span class='Ref_to_Parameter'>trigdesc2</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN47"><span class='Ref_to_Member'>triggers</span></a> <span class='Operator'>+ </span><a href="trigger.c.html#LN1945"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1968"><span class='Ref_To_Local'>trig1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN24"><span class='Ref_to_Member'>tgoid</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN1969"><span class='Ref_To_Local'>trig2</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN24"><span class='Ref_to_Member'>tgoid</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="trigger.c.html#LN1968"><span class='Ref_To_Local'>trig1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN26"><span class='Ref_to_Member'>tgname</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN1969"><span class='Ref_To_Local'>trig2</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN26"><span class='Ref_to_Member'>tgname</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1968"><span class='Ref_To_Local'>trig1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN27"><span class='Ref_to_Member'>tgfoid</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN1969"><span class='Ref_To_Local'>trig2</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN27"><span class='Ref_to_Member'>tgfoid</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1968"><span class='Ref_To_Local'>trig1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN28"><span class='Ref_to_Member'>tgtype</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN1969"><span class='Ref_To_Local'>trig2</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN28"><span class='Ref_to_Member'>tgtype</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1968"><span class='Ref_To_Local'>trig1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN29"><span class='Ref_to_Member'>tgenabled</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN1969"><span class='Ref_To_Local'>trig2</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN29"><span class='Ref_to_Member'>tgenabled</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1968"><span class='Ref_To_Local'>trig1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN30"><span class='Ref_to_Member'>tgisinternal</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN1969"><span class='Ref_To_Local'>trig2</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN30"><span class='Ref_to_Member'>tgisinternal</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1968"><span class='Ref_To_Local'>trig1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN31"><span class='Ref_to_Member'>tgconstrrelid</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN1969"><span class='Ref_To_Local'>trig2</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN31"><span class='Ref_to_Member'>tgconstrrelid</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1968"><span class='Ref_To_Local'>trig1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN32"><span class='Ref_to_Member'>tgconstrindid</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN1969"><span class='Ref_To_Local'>trig2</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN32"><span class='Ref_to_Member'>tgconstrindid</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1968"><span class='Ref_To_Local'>trig1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN33"><span class='Ref_to_Member'>tgconstraint</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN1969"><span class='Ref_To_Local'>trig2</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN33"><span class='Ref_to_Member'>tgconstraint</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1968"><span class='Ref_To_Local'>trig1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN34"><span class='Ref_to_Member'>tgdeferrable</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN1969"><span class='Ref_To_Local'>trig2</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN34"><span class='Ref_to_Member'>tgdeferrable</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1968"><span class='Ref_To_Local'>trig1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN35"><span class='Ref_to_Member'>tginitdeferred</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN1969"><span class='Ref_To_Local'>trig2</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN35"><span class='Ref_to_Member'>tginitdeferred</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1968"><span class='Ref_To_Local'>trig1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN36"><span class='Ref_to_Member'>tgnargs</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN1969"><span class='Ref_To_Local'>trig2</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN36"><span class='Ref_to_Member'>tgnargs</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1968"><span class='Ref_To_Local'>trig1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN37"><span class='Ref_to_Member'>tgnattr</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN1969"><span class='Ref_To_Local'>trig2</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN37"><span class='Ref_to_Member'>tgnattr</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1968"><span class='Ref_To_Local'>trig1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN37"><span class='Ref_to_Member'>tgnattr</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>                memcmp<span class='Parentheses'>(</span><a href="trigger.c.html#LN1968"><span class='Ref_To_Local'>trig1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN38"><span class='Ref_to_Member'>tgattr</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN1969"><span class='Ref_To_Local'>trig2</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN38"><span class='Ref_to_Member'>tgattr</span></a><span class='Delimiter'>, 
</span>                       <a href="trigger.c.html#LN1968"><span class='Ref_To_Local'>trig1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN37"><span class='Ref_to_Member'>tgnattr</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1946"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="trigger.c.html#LN1946"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="trigger.c.html#LN1968"><span class='Ref_To_Local'>trig1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN36"><span class='Ref_to_Member'>tgnargs</span></a><span class='Delimiter'>; </span><a href="trigger.c.html#LN1946"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="trigger.c.html#LN1968"><span class='Ref_To_Local'>trig1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN39"><span class='Ref_to_Member'>tgargs</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN1946"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>], </span><a href="trigger.c.html#LN1969"><span class='Ref_To_Local'>trig2</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN39"><span class='Ref_to_Member'>tgargs</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN1946"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1968"><span class='Ref_To_Local'>trig1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN40"><span class='Ref_to_Member'>tgqual</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="trigger.c.html#LN1969"><span class='Ref_To_Local'>trig2</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN40"><span class='Ref_to_Member'>tgqual</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                 <span class='Comment_Multi_Line'>/* ok */ </span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1968"><span class='Ref_To_Local'>trig1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN40"><span class='Ref_to_Member'>tgqual</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="trigger.c.html#LN1969"><span class='Ref_To_Local'>trig2</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN40"><span class='Ref_to_Member'>tgqual</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="trigger.c.html#LN1968"><span class='Ref_To_Local'>trig1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN40"><span class='Ref_to_Member'>tgqual</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN1969"><span class='Ref_To_Local'>trig2</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN40"><span class='Ref_to_Member'>tgqual</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1968"><span class='Ref_To_Local'>trig1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN41"><span class='Ref_to_Member'>tgoldtable</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="trigger.c.html#LN1969"><span class='Ref_To_Local'>trig2</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN41"><span class='Ref_to_Member'>tgoldtable</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                 <span class='Comment_Multi_Line'>/* ok */ </span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1968"><span class='Ref_To_Local'>trig1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN41"><span class='Ref_to_Member'>tgoldtable</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="trigger.c.html#LN1969"><span class='Ref_To_Local'>trig2</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN41"><span class='Ref_to_Member'>tgoldtable</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="trigger.c.html#LN1968"><span class='Ref_To_Local'>trig1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN41"><span class='Ref_to_Member'>tgoldtable</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN1969"><span class='Ref_To_Local'>trig2</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN41"><span class='Ref_to_Member'>tgoldtable</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1968"><span class='Ref_To_Local'>trig1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN42"><span class='Ref_to_Member'>tgnewtable</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="trigger.c.html#LN1969"><span class='Ref_To_Local'>trig2</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN42"><span class='Ref_to_Member'>tgnewtable</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                 <span class='Comment_Multi_Line'>/* ok */ </span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1968"><span class='Ref_To_Local'>trig1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN42"><span class='Ref_to_Member'>tgnewtable</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="trigger.c.html#LN1969"><span class='Ref_To_Local'>trig2</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN42"><span class='Ref_to_Member'>tgnewtable</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="trigger.c.html#LN1968"><span class='Ref_To_Local'>trig1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN42"><span class='Ref_to_Member'>tgnewtable</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN1969"><span class='Ref_To_Local'>trig2</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN42"><span class='Ref_to_Member'>tgnewtable</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;trigdesc1-&GT;numt... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if trigdesc1!=NULL &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN1943"><span class='Ref_to_Parameter'>trigdesc2</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end equalTriggerDescs &raquo; </span> 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* NOT_USED */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Call a trigger function. 
 * 
 *      trigdata: trigger descriptor. 
 *      tgindx: trigger's index in finfo and instr arrays. 
 *      finfo: array of cached trigger function call information. 
 *      instr: optional array of EXPLAIN ANALYZE instrumentation state. 
 *      per_tuple_context: memory context to execute the function in. 
 * 
 * Returns the tuple (or NULL) as returned by the function. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> 
<a name="LN2042"></a><span class='Declare_Function'>ExecCallTriggerFunc</span><span class='Parentheses'>(</span><a href="../../include/commands/trigger.h.html#LN29"><span class='Ref_to_Struct'>TriggerData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>trigdata</span><span class='Delimiter'>, 
</span><a name="LN2043"></a>                    <span class='Keyword'>int </span><span class='Declare_Parameter'>tgindx</span><span class='Delimiter'>, 
</span><a name="LN2044"></a>                    <a href="../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>finfo</span><span class='Delimiter'>, 
</span><a name="LN2045"></a>                    <a href="../../include/executor/instrument.h.html#LN43"><span class='Ref_to_Struct'>Instrumentation</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>instr</span><span class='Delimiter'>, 
</span><a name="LN2046"></a>                    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>per_tuple_context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2048"></a>    <a href="../../include/fmgr.h.html#LN76"><span class='Ref_to_Struct'>FunctionCallInfoData</span></a> <span class='Declare_Local'>fcinfo</span><span class='Delimiter'>; 
</span><a name="LN2049"></a>    <a href="../../include/pgstat.h.html#LN1086"><span class='Ref_to_Struct'>PgStat_FunctionCallUsage</span></a> <span class='Declare_Local'>fcusage</span><span class='Delimiter'>; 
</span><a name="LN2050"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN2051"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldContext</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Protect against code paths that may fail to initialize transition table 
     * info. 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(((</span><a href="../../include/commands/trigger.h.html#LN69"><span class='Ref_to_Macro'>TRIGGER_FIRED_BY_INSERT</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2042"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>             <a href="../../include/commands/trigger.h.html#LN75"><span class='Ref_to_Macro'>TRIGGER_FIRED_BY_UPDATE</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2042"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>             <a href="../../include/commands/trigger.h.html#LN72"><span class='Ref_to_Macro'>TRIGGER_FIRED_BY_DELETE</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2042"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Parentheses'>))</span> <span class='Operator'>&& 
</span>            <a href="../../include/commands/trigger.h.html#LN90"><span class='Ref_to_Macro'>TRIGGER_FIRED_AFTER</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2042"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>            <span class='Operator'>!</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN2042"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a> <span class='Operator'>& </span><a href="../../include/commands/trigger.h.html#LN66"><span class='Ref_to_Const'>AFTER_TRIGGER_DEFERRABLE</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>            <span class='Operator'>!</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN2042"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a> <span class='Operator'>& </span><a href="../../include/commands/trigger.h.html#LN67"><span class='Ref_to_Const'>AFTER_TRIGGER_INITDEFERRED</span></a><span class='Parentheses'>))</span> <span class='Operator'>|| 
</span>           <span class='Parentheses'>(</span><a href="trigger.c.html#LN2042"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/trigger.h.html#LN39"><span class='Ref_to_Member'>tg_oldtable</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="trigger.c.html#LN2042"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/trigger.h.html#LN40"><span class='Ref_to_Member'>tg_newtable</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN2044"><span class='Ref_to_Parameter'>finfo</span></a> <span class='Operator'>+= </span><a href="trigger.c.html#LN2043"><span class='Ref_to_Parameter'>tgindx</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We cache fmgr lookup info, to avoid making the lookup again on each 
     * call. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2044"><span class='Ref_to_Parameter'>finfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a> <span class='Operator'>== </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/fmgr.h.html#LN92"><span class='Ref_to_Proto'>fmgr_info</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2042"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/trigger.h.html#LN36"><span class='Ref_to_Member'>tg_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN27"><span class='Ref_to_Member'>tgfoid</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2044"><span class='Ref_to_Parameter'>finfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN2044"><span class='Ref_to_Parameter'>finfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a> <span class='Operator'>== </span><a href="trigger.c.html#LN2042"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/trigger.h.html#LN36"><span class='Ref_to_Member'>tg_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN27"><span class='Ref_to_Member'>tgfoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If doing EXPLAIN ANALYZE, start charging time to this trigger. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2045"><span class='Ref_to_Parameter'>instr</span></a><span class='Parentheses'>) 
</span>        <a href="../executor/instrument.c.html#LN61"><span class='Ref_to_Func'>InstrStartNode</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2045"><span class='Ref_to_Parameter'>instr</span></a> <span class='Operator'>+ </span><a href="trigger.c.html#LN2043"><span class='Ref_to_Parameter'>tgindx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Do the function evaluation in the per-tuple memory context, so that 
     * leaked memory will be reclaimed once per tuple. Note in particular that 
     * any new tuple created by the trigger function will live till the end of 
     * the tuple cycle. 
     */ 
</span>    <a href="trigger.c.html#LN2051"><span class='Ref_To_Local'>oldContext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2046"><span class='Ref_to_Parameter'>per_tuple_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Call the function, passing no arguments but setting a context. 
     */ 
</span>    <a href="../../include/fmgr.h.html#LN119"><span class='Ref_to_Macro'>InitFunctionCallInfoData</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2048"><span class='Ref_To_Local'>fcinfo</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2044"><span class='Ref_to_Parameter'>finfo</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                             <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="trigger.c.html#LN2042"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/pgstat.h.html#LN1293"><span class='Ref_to_Proto'>pgstat_init_function_usage</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN2048"><span class='Ref_To_Local'>fcinfo</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="trigger.c.html#LN2049"><span class='Ref_To_Local'>fcusage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN66"><span class='Ref_to_Global_Var'>MyTriggerDepth</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <a href="trigger.c.html#LN2050"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN136"><span class='Ref_to_Macro'>FunctionCallInvoke</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN2048"><span class='Ref_To_Local'>fcinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <a href="trigger.c.html#LN66"><span class='Ref_to_Global_Var'>MyTriggerDepth</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN66"><span class='Ref_to_Global_Var'>MyTriggerDepth</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/pgstat.h.html#LN1295"><span class='Ref_to_Proto'>pgstat_end_function_usage</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN2049"><span class='Ref_To_Local'>fcusage</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2051"><span class='Ref_To_Local'>oldContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Trigger protocol allows function to return a null pointer, but NOT to 
     * set the isnull result flag. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2048"><span class='Ref_To_Local'>fcinfo</span></a><span class='Operator'>.</span><a href="../../include/fmgr.h.html#LN82"><span class='Ref_to_Member'>isnull</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_E_R_I_E_TRIGGER_PROTOCOL_VIOLATED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"trigger function %u returned null value"</span><span class='Delimiter'>, 
</span>                        <a href="trigger.c.html#LN2048"><span class='Ref_To_Local'>fcinfo</span></a><span class='Operator'>.</span><a href="../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If doing EXPLAIN ANALYZE, stop charging time to this trigger, and count 
     * one "tuple returned" (really the number of firings). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2045"><span class='Ref_to_Parameter'>instr</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/executor/instrument.h.html#LN76"><span class='Ref_to_Proto'>InstrStopNode</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2045"><span class='Ref_to_Parameter'>instr</span></a> <span class='Operator'>+ </span><a href="trigger.c.html#LN2043"><span class='Ref_to_Parameter'>tgindx</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a><span class='Parentheses'>) </span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2050"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecCallTriggerFunc &raquo; </span> 
 
<span class='Keyword'>void 
</span><a name="LN2136"></a><span class='Declare_Function'>ExecBSInsertTriggers</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>relinfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2138"></a>    <a href="../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a> <span class='Operator'>*</span><span class='Declare_Local'>trigdesc</span><span class='Delimiter'>; 
</span><a name="LN2139"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN2140"></a>    <a href="../../include/commands/trigger.h.html#LN29"><span class='Ref_to_Struct'>TriggerData</span></a> <span class='Declare_Local'>LocTriggerData</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN2138"><span class='Ref_To_Local'>trigdesc</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2136"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2138"><span class='Ref_To_Local'>trigdesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="trigger.c.html#LN2138"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN57"><span class='Ref_to_Member'>trig_insert_before_statement</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN2140"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN31"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN490"><span class='Ref_to_EnumConst'>T_TriggerData</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2140"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a> <span class='Operator'>= </span><a href="../../include/commands/trigger.h.html#LN51"><span class='Ref_to_Const'>TRIGGER_EVENT_INSERT</span></a> <span class='Operator'>| 
</span>        <a href="../../include/commands/trigger.h.html#LN59"><span class='Ref_to_Const'>TRIGGER_EVENT_BEFORE</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2140"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN33"><span class='Ref_to_Member'>tg_relation</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2136"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2140"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN34"><span class='Ref_to_Member'>tg_trigtuple</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2140"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN35"><span class='Ref_to_Member'>tg_newtuple</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2140"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN39"><span class='Ref_to_Member'>tg_oldtable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2140"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN40"><span class='Ref_to_Member'>tg_newtable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2140"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN37"><span class='Ref_to_Member'>tg_trigtuplebuf</span></a> <span class='Operator'>= </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2140"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN38"><span class='Ref_to_Member'>tg_newtuplebuf</span></a> <span class='Operator'>= </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2139"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="trigger.c.html#LN2139"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="trigger.c.html#LN2138"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN48"><span class='Ref_to_Member'>numtriggers</span></a><span class='Delimiter'>; </span><a href="trigger.c.html#LN2139"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2161"></a>        <a href="../../include/utils/reltrigger.h.html#LN22"><span class='Ref_to_Struct'>Trigger</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>trigger</span> <span class='Operator'>= &</span><a href="trigger.c.html#LN2138"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN47"><span class='Ref_to_Member'>triggers</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN2139"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span><a name="LN2162"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newtuple</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/catalog/pg_trigger.h.html#LN145"><span class='Ref_to_Macro'>TRIGGER_TYPE_MATCHES</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2161"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN28"><span class='Ref_to_Member'>tgtype</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/catalog/pg_trigger.h.html#LN106"><span class='Ref_to_Const'>TRIGGER_TYPE_STATEMENT</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/catalog/pg_trigger.h.html#LN98"><span class='Ref_to_Const'>TRIGGER_TYPE_BEFORE</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/catalog/pg_trigger.h.html#LN99"><span class='Ref_to_Const'>TRIGGER_TYPE_INSERT</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="trigger.c.html#LN86"><span class='Ref_to_Proto'>TriggerEnabled</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2136"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2136"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2161"><span class='Ref_To_Local'>trigger</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2140"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Delimiter'>, 
</span>                            <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="trigger.c.html#LN2140"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN36"><span class='Ref_to_Member'>tg_trigger</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2161"><span class='Ref_To_Local'>trigger</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2162"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN90"><span class='Ref_to_Proto'>ExecCallTriggerFunc</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN2140"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Delimiter'>, 
</span>                                       <a href="trigger.c.html#LN2139"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, 
</span>                                       <a href="trigger.c.html#LN2136"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN378"><span class='Ref_to_Member'>ri_TrigFunctions</span></a><span class='Delimiter'>, 
</span>                                       <a href="trigger.c.html#LN2136"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN380"><span class='Ref_to_Member'>ri_TrigInstrument</span></a><span class='Delimiter'>, 
</span>                                       <a href="../../include/executor/executor.h.html#LN460"><span class='Ref_to_Macro'>GetPerTupleMemoryContext</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2136"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2162"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_E_R_I_E_TRIGGER_PROTOCOL_VIOLATED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                  <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"BEFORE STATEMENT trigger cannot return a value"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;trigdesc-&GT;numtr... &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end ExecBSInsertTriggers &raquo; </span> 
 
<span class='Keyword'>void 
</span><a name="LN2188"></a><span class='Declare_Function'>ExecASInsertTriggers</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>relinfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2190"></a>    <a href="../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a> <span class='Operator'>*</span><span class='Declare_Local'>trigdesc</span> <span class='Operator'>= </span><a href="trigger.c.html#LN2188"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2190"><span class='Ref_To_Local'>trigdesc</span></a> <span class='Operator'>&& </span><a href="trigger.c.html#LN2190"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN58"><span class='Ref_to_Member'>trig_insert_after_statement</span></a><span class='Parentheses'>) 
</span>        <a href="trigger.c.html#LN95"><span class='Ref_to_Proto'>AfterTriggerSaveEvent</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2188"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2188"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Delimiter'>, </span><a href="../../include/commands/trigger.h.html#LN51"><span class='Ref_to_Const'>TRIGGER_EVENT_INSERT</span></a><span class='Delimiter'>, 
</span>                              <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>* 
</span><a name="LN2198"></a><span class='Declare_Function'>ExecBRInsertTriggers</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>relinfo</span><span class='Delimiter'>, 
</span><a name="LN2199"></a>                     <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2201"></a>    <a href="../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a> <span class='Operator'>*</span><span class='Declare_Local'>trigdesc</span> <span class='Operator'>= </span><a href="trigger.c.html#LN2198"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a><span class='Delimiter'>; 
</span><a name="LN2202"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>slottuple</span> <span class='Operator'>= </span><a href="../../include/executor/tuptable.h.html#LN162"><span class='Ref_to_Proto'>ExecMaterializeSlot</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2199"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2203"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newtuple</span> <span class='Operator'>= </span><a href="trigger.c.html#LN2202"><span class='Ref_To_Local'>slottuple</span></a><span class='Delimiter'>; 
</span><a name="LN2204"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>oldtuple</span><span class='Delimiter'>; 
</span><a name="LN2205"></a>    <a href="../../include/commands/trigger.h.html#LN29"><span class='Ref_to_Struct'>TriggerData</span></a> <span class='Declare_Local'>LocTriggerData</span><span class='Delimiter'>; 
</span><a name="LN2206"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN2205"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN31"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN490"><span class='Ref_to_EnumConst'>T_TriggerData</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2205"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a> <span class='Operator'>= </span><a href="../../include/commands/trigger.h.html#LN51"><span class='Ref_to_Const'>TRIGGER_EVENT_INSERT</span></a> <span class='Operator'>| 
</span>        <a href="../../include/commands/trigger.h.html#LN57"><span class='Ref_to_Const'>TRIGGER_EVENT_ROW</span></a> <span class='Operator'>| 
</span>        <a href="../../include/commands/trigger.h.html#LN59"><span class='Ref_to_Const'>TRIGGER_EVENT_BEFORE</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2205"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN33"><span class='Ref_to_Member'>tg_relation</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2198"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2205"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN35"><span class='Ref_to_Member'>tg_newtuple</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2205"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN39"><span class='Ref_to_Member'>tg_oldtable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2205"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN40"><span class='Ref_to_Member'>tg_newtable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2205"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN38"><span class='Ref_to_Member'>tg_newtuplebuf</span></a> <span class='Operator'>= </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2206"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="trigger.c.html#LN2206"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="trigger.c.html#LN2201"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN48"><span class='Ref_to_Member'>numtriggers</span></a><span class='Delimiter'>; </span><a href="trigger.c.html#LN2206"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2219"></a>        <a href="../../include/utils/reltrigger.h.html#LN22"><span class='Ref_to_Struct'>Trigger</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>trigger</span> <span class='Operator'>= &</span><a href="trigger.c.html#LN2201"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN47"><span class='Ref_to_Member'>triggers</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN2206"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/catalog/pg_trigger.h.html#LN145"><span class='Ref_to_Macro'>TRIGGER_TYPE_MATCHES</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2219"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN28"><span class='Ref_to_Member'>tgtype</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/catalog/pg_trigger.h.html#LN97"><span class='Ref_to_Const'>TRIGGER_TYPE_ROW</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/catalog/pg_trigger.h.html#LN98"><span class='Ref_to_Const'>TRIGGER_TYPE_BEFORE</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/catalog/pg_trigger.h.html#LN99"><span class='Ref_to_Const'>TRIGGER_TYPE_INSERT</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="trigger.c.html#LN86"><span class='Ref_to_Proto'>TriggerEnabled</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2198"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2198"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2219"><span class='Ref_To_Local'>trigger</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2205"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Delimiter'>, 
</span>                            <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="trigger.c.html#LN2203"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="trigger.c.html#LN2205"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN34"><span class='Ref_to_Member'>tg_trigtuple</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2204"><span class='Ref_To_Local'>oldtuple</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2203"><span class='Ref_To_Local'>newtuple</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2205"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN37"><span class='Ref_to_Member'>tg_trigtuplebuf</span></a> <span class='Operator'>= </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2205"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN36"><span class='Ref_to_Member'>tg_trigger</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2219"><span class='Ref_To_Local'>trigger</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2203"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN90"><span class='Ref_to_Proto'>ExecCallTriggerFunc</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN2205"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Delimiter'>, 
</span>                                       <a href="trigger.c.html#LN2206"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, 
</span>                                       <a href="trigger.c.html#LN2198"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN378"><span class='Ref_to_Member'>ri_TrigFunctions</span></a><span class='Delimiter'>, 
</span>                                       <a href="trigger.c.html#LN2198"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN380"><span class='Ref_to_Member'>ri_TrigInstrument</span></a><span class='Delimiter'>, 
</span>                                       <a href="../../include/executor/executor.h.html#LN460"><span class='Ref_to_Macro'>GetPerTupleMemoryContext</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2198"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2204"><span class='Ref_To_Local'>oldtuple</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN2203"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>&& </span><a href="trigger.c.html#LN2204"><span class='Ref_To_Local'>oldtuple</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN2202"><span class='Ref_To_Local'>slottuple</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2204"><span class='Ref_To_Local'>oldtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2203"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* "do nothing" */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;trigdesc-&GT;numtr... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2203"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN2202"><span class='Ref_To_Local'>slottuple</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Return the modified tuple using the es_trig_tuple_slot.  We assume 
         * the tuple was allocated in per-tuple memory context, and therefore 
         * will go away by itself. The tuple table slot should not try to 
         * clear it. 
         */ 
</span><a name="LN2252"></a>        <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>newslot</span> <span class='Operator'>= </span><a href="trigger.c.html#LN2198"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN436"><span class='Ref_to_Member'>es_trig_tuple_slot</span></a><span class='Delimiter'>; 
</span><a name="LN2253"></a>        <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2198"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2252"><span class='Ref_To_Local'>newslot</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/tuptable.h.html#LN120"><span class='Ref_to_Member'>tts_tupleDescriptor</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN2253"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/executor/tuptable.h.html#LN146"><span class='Ref_to_Proto'>ExecSetSlotDescriptor</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2252"><span class='Ref_To_Local'>newslot</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2253"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/executor/tuptable.h.html#LN147"><span class='Ref_to_Proto'>ExecStoreTuple</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2203"><span class='Ref_To_Local'>newtuple</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2252"><span class='Ref_To_Local'>newslot</span></a><span class='Delimiter'>, </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2199"><span class='Ref_to_Parameter'>slot</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2252"><span class='Ref_To_Local'>newslot</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="trigger.c.html#LN2199"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecBRInsertTriggers &raquo; </span> 
 
<span class='Keyword'>void 
</span><a name="LN2264"></a><span class='Declare_Function'>ExecARInsertTriggers</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>relinfo</span><span class='Delimiter'>, 
</span><a name="LN2265"></a>                     <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>trigtuple</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>recheckIndexes</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2267"></a>    <a href="../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a> <span class='Operator'>*</span><span class='Declare_Local'>trigdesc</span> <span class='Operator'>= </span><a href="trigger.c.html#LN2264"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2267"><span class='Ref_To_Local'>trigdesc</span></a> <span class='Operator'>&& 
</span>        <span class='Parentheses'>(</span><a href="trigger.c.html#LN2267"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN55"><span class='Ref_to_Member'>trig_insert_after_row</span></a> <span class='Operator'>|| </span><a href="trigger.c.html#LN2267"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN73"><span class='Ref_to_Member'>trig_insert_new_table</span></a><span class='Parentheses'>))</span> 
        <a href="trigger.c.html#LN95"><span class='Ref_to_Proto'>AfterTriggerSaveEvent</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2264"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2264"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Delimiter'>, </span><a href="../../include/commands/trigger.h.html#LN51"><span class='Ref_to_Const'>TRIGGER_EVENT_INSERT</span></a><span class='Delimiter'>, 
</span>                              <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="trigger.c.html#LN2265"><span class='Ref_to_Parameter'>trigtuple</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2265"><span class='Ref_to_Parameter'>recheckIndexes</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>* 
</span><a name="LN2276"></a><span class='Declare_Function'>ExecIRInsertTriggers</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>relinfo</span><span class='Delimiter'>, 
</span><a name="LN2277"></a>                     <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2279"></a>    <a href="../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a> <span class='Operator'>*</span><span class='Declare_Local'>trigdesc</span> <span class='Operator'>= </span><a href="trigger.c.html#LN2276"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a><span class='Delimiter'>; 
</span><a name="LN2280"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>slottuple</span> <span class='Operator'>= </span><a href="../../include/executor/tuptable.h.html#LN162"><span class='Ref_to_Proto'>ExecMaterializeSlot</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2277"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2281"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newtuple</span> <span class='Operator'>= </span><a href="trigger.c.html#LN2280"><span class='Ref_To_Local'>slottuple</span></a><span class='Delimiter'>; 
</span><a name="LN2282"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>oldtuple</span><span class='Delimiter'>; 
</span><a name="LN2283"></a>    <a href="../../include/commands/trigger.h.html#LN29"><span class='Ref_to_Struct'>TriggerData</span></a> <span class='Declare_Local'>LocTriggerData</span><span class='Delimiter'>; 
</span><a name="LN2284"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN2283"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN31"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN490"><span class='Ref_to_EnumConst'>T_TriggerData</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2283"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a> <span class='Operator'>= </span><a href="../../include/commands/trigger.h.html#LN51"><span class='Ref_to_Const'>TRIGGER_EVENT_INSERT</span></a> <span class='Operator'>| 
</span>        <a href="../../include/commands/trigger.h.html#LN57"><span class='Ref_to_Const'>TRIGGER_EVENT_ROW</span></a> <span class='Operator'>| 
</span>        <a href="../../include/commands/trigger.h.html#LN61"><span class='Ref_to_Const'>TRIGGER_EVENT_INSTEAD</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2283"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN33"><span class='Ref_to_Member'>tg_relation</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2276"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2283"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN35"><span class='Ref_to_Member'>tg_newtuple</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2283"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN39"><span class='Ref_to_Member'>tg_oldtable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2283"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN40"><span class='Ref_to_Member'>tg_newtable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2283"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN38"><span class='Ref_to_Member'>tg_newtuplebuf</span></a> <span class='Operator'>= </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2284"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="trigger.c.html#LN2284"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="trigger.c.html#LN2279"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN48"><span class='Ref_to_Member'>numtriggers</span></a><span class='Delimiter'>; </span><a href="trigger.c.html#LN2284"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2297"></a>        <a href="../../include/utils/reltrigger.h.html#LN22"><span class='Ref_to_Struct'>Trigger</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>trigger</span> <span class='Operator'>= &</span><a href="trigger.c.html#LN2279"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN47"><span class='Ref_to_Member'>triggers</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN2284"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/catalog/pg_trigger.h.html#LN145"><span class='Ref_to_Macro'>TRIGGER_TYPE_MATCHES</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2297"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN28"><span class='Ref_to_Member'>tgtype</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/catalog/pg_trigger.h.html#LN97"><span class='Ref_to_Const'>TRIGGER_TYPE_ROW</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/catalog/pg_trigger.h.html#LN103"><span class='Ref_to_Const'>TRIGGER_TYPE_INSTEAD</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/catalog/pg_trigger.h.html#LN99"><span class='Ref_to_Const'>TRIGGER_TYPE_INSERT</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="trigger.c.html#LN86"><span class='Ref_to_Proto'>TriggerEnabled</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2276"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2276"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2297"><span class='Ref_To_Local'>trigger</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2283"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Delimiter'>, 
</span>                            <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="trigger.c.html#LN2281"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="trigger.c.html#LN2283"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN34"><span class='Ref_to_Member'>tg_trigtuple</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2282"><span class='Ref_To_Local'>oldtuple</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2281"><span class='Ref_To_Local'>newtuple</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2283"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN37"><span class='Ref_to_Member'>tg_trigtuplebuf</span></a> <span class='Operator'>= </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2283"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN36"><span class='Ref_to_Member'>tg_trigger</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2297"><span class='Ref_To_Local'>trigger</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2281"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN90"><span class='Ref_to_Proto'>ExecCallTriggerFunc</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN2283"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Delimiter'>, 
</span>                                       <a href="trigger.c.html#LN2284"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, 
</span>                                       <a href="trigger.c.html#LN2276"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN378"><span class='Ref_to_Member'>ri_TrigFunctions</span></a><span class='Delimiter'>, 
</span>                                       <a href="trigger.c.html#LN2276"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN380"><span class='Ref_to_Member'>ri_TrigInstrument</span></a><span class='Delimiter'>, 
</span>                                       <a href="../../include/executor/executor.h.html#LN460"><span class='Ref_to_Macro'>GetPerTupleMemoryContext</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2276"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2282"><span class='Ref_To_Local'>oldtuple</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN2281"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>&& </span><a href="trigger.c.html#LN2282"><span class='Ref_To_Local'>oldtuple</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN2280"><span class='Ref_To_Local'>slottuple</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2282"><span class='Ref_To_Local'>oldtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2281"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* "do nothing" */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;trigdesc-&GT;numtr... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2281"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN2280"><span class='Ref_To_Local'>slottuple</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Return the modified tuple using the es_trig_tuple_slot.  We assume 
         * the tuple was allocated in per-tuple memory context, and therefore 
         * will go away by itself. The tuple table slot should not try to 
         * clear it. 
         */ 
</span><a name="LN2330"></a>        <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>newslot</span> <span class='Operator'>= </span><a href="trigger.c.html#LN2276"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN436"><span class='Ref_to_Member'>es_trig_tuple_slot</span></a><span class='Delimiter'>; 
</span><a name="LN2331"></a>        <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2276"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2330"><span class='Ref_To_Local'>newslot</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/tuptable.h.html#LN120"><span class='Ref_to_Member'>tts_tupleDescriptor</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN2331"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/executor/tuptable.h.html#LN146"><span class='Ref_to_Proto'>ExecSetSlotDescriptor</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2330"><span class='Ref_To_Local'>newslot</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2331"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/executor/tuptable.h.html#LN147"><span class='Ref_to_Proto'>ExecStoreTuple</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2281"><span class='Ref_To_Local'>newtuple</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2330"><span class='Ref_To_Local'>newslot</span></a><span class='Delimiter'>, </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2277"><span class='Ref_to_Parameter'>slot</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2330"><span class='Ref_To_Local'>newslot</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="trigger.c.html#LN2277"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecIRInsertTriggers &raquo; </span> 
 
<span class='Keyword'>void 
</span><a name="LN2342"></a><span class='Declare_Function'>ExecBSDeleteTriggers</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>relinfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2344"></a>    <a href="../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a> <span class='Operator'>*</span><span class='Declare_Local'>trigdesc</span><span class='Delimiter'>; 
</span><a name="LN2345"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN2346"></a>    <a href="../../include/commands/trigger.h.html#LN29"><span class='Ref_to_Struct'>TriggerData</span></a> <span class='Declare_Local'>LocTriggerData</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN2344"><span class='Ref_To_Local'>trigdesc</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2342"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2344"><span class='Ref_To_Local'>trigdesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="trigger.c.html#LN2344"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN67"><span class='Ref_to_Member'>trig_delete_before_statement</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN2346"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN31"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN490"><span class='Ref_to_EnumConst'>T_TriggerData</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2346"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a> <span class='Operator'>= </span><a href="../../include/commands/trigger.h.html#LN52"><span class='Ref_to_Const'>TRIGGER_EVENT_DELETE</span></a> <span class='Operator'>| 
</span>        <a href="../../include/commands/trigger.h.html#LN59"><span class='Ref_to_Const'>TRIGGER_EVENT_BEFORE</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2346"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN33"><span class='Ref_to_Member'>tg_relation</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2342"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2346"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN34"><span class='Ref_to_Member'>tg_trigtuple</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2346"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN35"><span class='Ref_to_Member'>tg_newtuple</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2346"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN39"><span class='Ref_to_Member'>tg_oldtable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2346"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN40"><span class='Ref_to_Member'>tg_newtable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2346"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN37"><span class='Ref_to_Member'>tg_trigtuplebuf</span></a> <span class='Operator'>= </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2346"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN38"><span class='Ref_to_Member'>tg_newtuplebuf</span></a> <span class='Operator'>= </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2345"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="trigger.c.html#LN2345"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="trigger.c.html#LN2344"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN48"><span class='Ref_to_Member'>numtriggers</span></a><span class='Delimiter'>; </span><a href="trigger.c.html#LN2345"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2367"></a>        <a href="../../include/utils/reltrigger.h.html#LN22"><span class='Ref_to_Struct'>Trigger</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>trigger</span> <span class='Operator'>= &</span><a href="trigger.c.html#LN2344"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN47"><span class='Ref_to_Member'>triggers</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN2345"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span><a name="LN2368"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newtuple</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/catalog/pg_trigger.h.html#LN145"><span class='Ref_to_Macro'>TRIGGER_TYPE_MATCHES</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2367"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN28"><span class='Ref_to_Member'>tgtype</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/catalog/pg_trigger.h.html#LN106"><span class='Ref_to_Const'>TRIGGER_TYPE_STATEMENT</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/catalog/pg_trigger.h.html#LN98"><span class='Ref_to_Const'>TRIGGER_TYPE_BEFORE</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/catalog/pg_trigger.h.html#LN100"><span class='Ref_to_Const'>TRIGGER_TYPE_DELETE</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="trigger.c.html#LN86"><span class='Ref_to_Proto'>TriggerEnabled</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2342"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2342"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2367"><span class='Ref_To_Local'>trigger</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2346"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Delimiter'>, 
</span>                            <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="trigger.c.html#LN2346"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN36"><span class='Ref_to_Member'>tg_trigger</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2367"><span class='Ref_To_Local'>trigger</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2368"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN90"><span class='Ref_to_Proto'>ExecCallTriggerFunc</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN2346"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Delimiter'>, 
</span>                                       <a href="trigger.c.html#LN2345"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, 
</span>                                       <a href="trigger.c.html#LN2342"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN378"><span class='Ref_to_Member'>ri_TrigFunctions</span></a><span class='Delimiter'>, 
</span>                                       <a href="trigger.c.html#LN2342"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN380"><span class='Ref_to_Member'>ri_TrigInstrument</span></a><span class='Delimiter'>, 
</span>                                       <a href="../../include/executor/executor.h.html#LN460"><span class='Ref_to_Macro'>GetPerTupleMemoryContext</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2342"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2368"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_E_R_I_E_TRIGGER_PROTOCOL_VIOLATED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                  <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"BEFORE STATEMENT trigger cannot return a value"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;trigdesc-&GT;numtr... &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end ExecBSDeleteTriggers &raquo; </span> 
 
<span class='Keyword'>void 
</span><a name="LN2394"></a><span class='Declare_Function'>ExecASDeleteTriggers</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>relinfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2396"></a>    <a href="../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a> <span class='Operator'>*</span><span class='Declare_Local'>trigdesc</span> <span class='Operator'>= </span><a href="trigger.c.html#LN2394"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2396"><span class='Ref_To_Local'>trigdesc</span></a> <span class='Operator'>&& </span><a href="trigger.c.html#LN2396"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN68"><span class='Ref_to_Member'>trig_delete_after_statement</span></a><span class='Parentheses'>) 
</span>        <a href="trigger.c.html#LN95"><span class='Ref_to_Proto'>AfterTriggerSaveEvent</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2394"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2394"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Delimiter'>, </span><a href="../../include/commands/trigger.h.html#LN52"><span class='Ref_to_Const'>TRIGGER_EVENT_DELETE</span></a><span class='Delimiter'>, 
</span>                              <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>bool 
</span><a name="LN2404"></a><span class='Declare_Function'>ExecBRDeleteTriggers</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN873"><span class='Ref_to_Struct'>EPQState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>epqstate</span><span class='Delimiter'>, 
</span><a name="LN2405"></a>                     <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>relinfo</span><span class='Delimiter'>, 
</span><a name="LN2406"></a>                     <a href="../../include/storage/itemptr.h.html#LN47"><span class='Ref_to_Typedef'>ItemPointer</span></a> <span class='Declare_Parameter'>tupleid</span><span class='Delimiter'>, 
</span><a name="LN2407"></a>                     <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>fdw_trigtuple</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2409"></a>    <a href="../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a> <span class='Operator'>*</span><span class='Declare_Local'>trigdesc</span> <span class='Operator'>= </span><a href="trigger.c.html#LN2405"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a><span class='Delimiter'>; 
</span><a name="LN2410"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span><a name="LN2411"></a>    <a href="../../include/commands/trigger.h.html#LN29"><span class='Ref_to_Struct'>TriggerData</span></a> <span class='Declare_Local'>LocTriggerData</span><span class='Delimiter'>; 
</span><a name="LN2412"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>trigtuple</span><span class='Delimiter'>; 
</span><a name="LN2413"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newtuple</span><span class='Delimiter'>; 
</span><a name="LN2414"></a>    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>newSlot</span><span class='Delimiter'>; 
</span><a name="LN2415"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2407"><span class='Ref_to_Parameter'>fdw_trigtuple</span></a><span class='Parentheses'>) </span><span class='Operator'>^ </span><a href="../../include/storage/itemptr.h.html#LN58"><span class='Ref_to_Macro'>ItemPointerIsValid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2406"><span class='Ref_to_Parameter'>tupleid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2407"><span class='Ref_to_Parameter'>fdw_trigtuple</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="trigger.c.html#LN2412"><span class='Ref_To_Local'>trigtuple</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN80"><span class='Ref_to_Proto'>GetTupleForTrigger</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2404"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2404"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2405"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2406"><span class='Ref_to_Parameter'>tupleid</span></a><span class='Delimiter'>, 
</span>                                       <a href="../../include/access/heapam.h.html#LN46"><span class='Ref_to_EnumConst'>LockTupleExclusive</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="trigger.c.html#LN2414"><span class='Ref_To_Local'>newSlot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2412"><span class='Ref_To_Local'>trigtuple</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="trigger.c.html#LN2412"><span class='Ref_To_Local'>trigtuple</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2407"><span class='Ref_to_Parameter'>fdw_trigtuple</span></a><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN2411"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN31"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN490"><span class='Ref_to_EnumConst'>T_TriggerData</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2411"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a> <span class='Operator'>= </span><a href="../../include/commands/trigger.h.html#LN52"><span class='Ref_to_Const'>TRIGGER_EVENT_DELETE</span></a> <span class='Operator'>| 
</span>        <a href="../../include/commands/trigger.h.html#LN57"><span class='Ref_to_Const'>TRIGGER_EVENT_ROW</span></a> <span class='Operator'>| 
</span>        <a href="../../include/commands/trigger.h.html#LN59"><span class='Ref_to_Const'>TRIGGER_EVENT_BEFORE</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2411"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN33"><span class='Ref_to_Member'>tg_relation</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2405"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2411"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN35"><span class='Ref_to_Member'>tg_newtuple</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2411"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN39"><span class='Ref_to_Member'>tg_oldtable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2411"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN40"><span class='Ref_to_Member'>tg_newtable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2411"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN38"><span class='Ref_to_Member'>tg_newtuplebuf</span></a> <span class='Operator'>= </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2415"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="trigger.c.html#LN2415"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="trigger.c.html#LN2409"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN48"><span class='Ref_to_Member'>numtriggers</span></a><span class='Delimiter'>; </span><a href="trigger.c.html#LN2415"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2439"></a>        <a href="../../include/utils/reltrigger.h.html#LN22"><span class='Ref_to_Struct'>Trigger</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>trigger</span> <span class='Operator'>= &</span><a href="trigger.c.html#LN2409"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN47"><span class='Ref_to_Member'>triggers</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN2415"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/catalog/pg_trigger.h.html#LN145"><span class='Ref_to_Macro'>TRIGGER_TYPE_MATCHES</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2439"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN28"><span class='Ref_to_Member'>tgtype</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/catalog/pg_trigger.h.html#LN97"><span class='Ref_to_Const'>TRIGGER_TYPE_ROW</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/catalog/pg_trigger.h.html#LN98"><span class='Ref_to_Const'>TRIGGER_TYPE_BEFORE</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/catalog/pg_trigger.h.html#LN100"><span class='Ref_to_Const'>TRIGGER_TYPE_DELETE</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="trigger.c.html#LN86"><span class='Ref_to_Proto'>TriggerEnabled</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2404"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2405"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2439"><span class='Ref_To_Local'>trigger</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2411"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Delimiter'>, 
</span>                            <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="trigger.c.html#LN2412"><span class='Ref_To_Local'>trigtuple</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="trigger.c.html#LN2411"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN34"><span class='Ref_to_Member'>tg_trigtuple</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2412"><span class='Ref_To_Local'>trigtuple</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2411"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN37"><span class='Ref_to_Member'>tg_trigtuplebuf</span></a> <span class='Operator'>= </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2411"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN36"><span class='Ref_to_Member'>tg_trigger</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2439"><span class='Ref_To_Local'>trigger</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2413"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN90"><span class='Ref_to_Proto'>ExecCallTriggerFunc</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN2411"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Delimiter'>, 
</span>                                       <a href="trigger.c.html#LN2415"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, 
</span>                                       <a href="trigger.c.html#LN2405"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN378"><span class='Ref_to_Member'>ri_TrigFunctions</span></a><span class='Delimiter'>, 
</span>                                       <a href="trigger.c.html#LN2405"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN380"><span class='Ref_to_Member'>ri_TrigInstrument</span></a><span class='Delimiter'>, 
</span>                                       <a href="../../include/executor/executor.h.html#LN460"><span class='Ref_to_Macro'>GetPerTupleMemoryContext</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2404"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2413"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="trigger.c.html#LN2410"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* tell caller to suppress delete */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2413"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN2412"><span class='Ref_To_Local'>trigtuple</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2413"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;trigdesc-&GT;numtr... &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2412"><span class='Ref_To_Local'>trigtuple</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN2407"><span class='Ref_to_Parameter'>fdw_trigtuple</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2412"><span class='Ref_To_Local'>trigtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="trigger.c.html#LN2410"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecBRDeleteTriggers &raquo; </span> 
 
<span class='Keyword'>void 
</span><a name="LN2473"></a><span class='Declare_Function'>ExecARDeleteTriggers</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>relinfo</span><span class='Delimiter'>, 
</span><a name="LN2474"></a>                     <a href="../../include/storage/itemptr.h.html#LN47"><span class='Ref_to_Typedef'>ItemPointer</span></a> <span class='Declare_Parameter'>tupleid</span><span class='Delimiter'>, 
</span><a name="LN2475"></a>                     <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>fdw_trigtuple</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2477"></a>    <a href="../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a> <span class='Operator'>*</span><span class='Declare_Local'>trigdesc</span> <span class='Operator'>= </span><a href="trigger.c.html#LN2473"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2477"><span class='Ref_To_Local'>trigdesc</span></a> <span class='Operator'>&& 
</span>        <span class='Parentheses'>(</span><a href="trigger.c.html#LN2477"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN65"><span class='Ref_to_Member'>trig_delete_after_row</span></a> <span class='Operator'>|| </span><a href="trigger.c.html#LN2477"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN76"><span class='Ref_to_Member'>trig_delete_old_table</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2482"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>trigtuple</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2475"><span class='Ref_to_Parameter'>fdw_trigtuple</span></a><span class='Parentheses'>) </span><span class='Operator'>^ </span><a href="../../include/storage/itemptr.h.html#LN58"><span class='Ref_to_Macro'>ItemPointerIsValid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2474"><span class='Ref_to_Parameter'>tupleid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2475"><span class='Ref_to_Parameter'>fdw_trigtuple</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="trigger.c.html#LN2482"><span class='Ref_To_Local'>trigtuple</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN80"><span class='Ref_to_Proto'>GetTupleForTrigger</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2473"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, 
</span>                                           <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                           <a href="trigger.c.html#LN2473"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Delimiter'>, 
</span>                                           <a href="trigger.c.html#LN2474"><span class='Ref_to_Parameter'>tupleid</span></a><span class='Delimiter'>, 
</span>                                           <a href="../../include/access/heapam.h.html#LN46"><span class='Ref_to_EnumConst'>LockTupleExclusive</span></a><span class='Delimiter'>, 
</span>                                           <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="trigger.c.html#LN2482"><span class='Ref_To_Local'>trigtuple</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2475"><span class='Ref_to_Parameter'>fdw_trigtuple</span></a><span class='Delimiter'>; 
</span> 
        <a href="trigger.c.html#LN95"><span class='Ref_to_Proto'>AfterTriggerSaveEvent</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2473"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2473"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Delimiter'>, </span><a href="../../include/commands/trigger.h.html#LN52"><span class='Ref_to_Const'>TRIGGER_EVENT_DELETE</span></a><span class='Delimiter'>, 
</span>                              <span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="trigger.c.html#LN2482"><span class='Ref_To_Local'>trigtuple</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2482"><span class='Ref_To_Local'>trigtuple</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN2475"><span class='Ref_to_Parameter'>fdw_trigtuple</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2482"><span class='Ref_To_Local'>trigtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if trigdesc&&(trigdesc-&GT;... &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end ExecARDeleteTriggers &raquo; </span> 
 
<span class='Keyword'>bool 
</span><a name="LN2503"></a><span class='Declare_Function'>ExecIRDeleteTriggers</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>relinfo</span><span class='Delimiter'>, 
</span><a name="LN2504"></a>                     <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>trigtuple</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2506"></a>    <a href="../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a> <span class='Operator'>*</span><span class='Declare_Local'>trigdesc</span> <span class='Operator'>= </span><a href="trigger.c.html#LN2503"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a><span class='Delimiter'>; 
</span><a name="LN2507"></a>    <a href="../../include/commands/trigger.h.html#LN29"><span class='Ref_to_Struct'>TriggerData</span></a> <span class='Declare_Local'>LocTriggerData</span><span class='Delimiter'>; 
</span><a name="LN2508"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>rettuple</span><span class='Delimiter'>; 
</span><a name="LN2509"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN2507"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN31"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN490"><span class='Ref_to_EnumConst'>T_TriggerData</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2507"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a> <span class='Operator'>= </span><a href="../../include/commands/trigger.h.html#LN52"><span class='Ref_to_Const'>TRIGGER_EVENT_DELETE</span></a> <span class='Operator'>| 
</span>        <a href="../../include/commands/trigger.h.html#LN57"><span class='Ref_to_Const'>TRIGGER_EVENT_ROW</span></a> <span class='Operator'>| 
</span>        <a href="../../include/commands/trigger.h.html#LN61"><span class='Ref_to_Const'>TRIGGER_EVENT_INSTEAD</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2507"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN33"><span class='Ref_to_Member'>tg_relation</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2503"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2507"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN35"><span class='Ref_to_Member'>tg_newtuple</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2507"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN39"><span class='Ref_to_Member'>tg_oldtable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2507"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN40"><span class='Ref_to_Member'>tg_newtable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2507"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN38"><span class='Ref_to_Member'>tg_newtuplebuf</span></a> <span class='Operator'>= </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2509"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="trigger.c.html#LN2509"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="trigger.c.html#LN2506"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN48"><span class='Ref_to_Member'>numtriggers</span></a><span class='Delimiter'>; </span><a href="trigger.c.html#LN2509"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2522"></a>        <a href="../../include/utils/reltrigger.h.html#LN22"><span class='Ref_to_Struct'>Trigger</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>trigger</span> <span class='Operator'>= &</span><a href="trigger.c.html#LN2506"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN47"><span class='Ref_to_Member'>triggers</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN2509"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/catalog/pg_trigger.h.html#LN145"><span class='Ref_to_Macro'>TRIGGER_TYPE_MATCHES</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2522"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN28"><span class='Ref_to_Member'>tgtype</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/catalog/pg_trigger.h.html#LN97"><span class='Ref_to_Const'>TRIGGER_TYPE_ROW</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/catalog/pg_trigger.h.html#LN103"><span class='Ref_to_Const'>TRIGGER_TYPE_INSTEAD</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/catalog/pg_trigger.h.html#LN100"><span class='Ref_to_Const'>TRIGGER_TYPE_DELETE</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="trigger.c.html#LN86"><span class='Ref_to_Proto'>TriggerEnabled</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2503"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2503"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2522"><span class='Ref_To_Local'>trigger</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2507"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Delimiter'>, 
</span>                            <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="trigger.c.html#LN2504"><span class='Ref_to_Parameter'>trigtuple</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="trigger.c.html#LN2507"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN34"><span class='Ref_to_Member'>tg_trigtuple</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2504"><span class='Ref_to_Parameter'>trigtuple</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2507"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN37"><span class='Ref_to_Member'>tg_trigtuplebuf</span></a> <span class='Operator'>= </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2507"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN36"><span class='Ref_to_Member'>tg_trigger</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2522"><span class='Ref_To_Local'>trigger</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2508"><span class='Ref_To_Local'>rettuple</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN90"><span class='Ref_to_Proto'>ExecCallTriggerFunc</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN2507"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Delimiter'>, 
</span>                                       <a href="trigger.c.html#LN2509"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, 
</span>                                       <a href="trigger.c.html#LN2503"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN378"><span class='Ref_to_Member'>ri_TrigFunctions</span></a><span class='Delimiter'>, 
</span>                                       <a href="trigger.c.html#LN2503"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN380"><span class='Ref_to_Member'>ri_TrigInstrument</span></a><span class='Delimiter'>, 
</span>                                       <a href="../../include/executor/executor.h.html#LN460"><span class='Ref_to_Macro'>GetPerTupleMemoryContext</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2503"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2508"><span class='Ref_To_Local'>rettuple</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* Delete was suppressed */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2508"><span class='Ref_To_Local'>rettuple</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN2504"><span class='Ref_to_Parameter'>trigtuple</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2508"><span class='Ref_To_Local'>rettuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;trigdesc-&GT;numtr... &raquo; </span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecIRDeleteTriggers &raquo; </span> 
 
<span class='Keyword'>void 
</span><a name="LN2550"></a><span class='Declare_Function'>ExecBSUpdateTriggers</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>relinfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2552"></a>    <a href="../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a> <span class='Operator'>*</span><span class='Declare_Local'>trigdesc</span><span class='Delimiter'>; 
</span><a name="LN2553"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN2554"></a>    <a href="../../include/commands/trigger.h.html#LN29"><span class='Ref_to_Struct'>TriggerData</span></a> <span class='Declare_Local'>LocTriggerData</span><span class='Delimiter'>; 
</span><a name="LN2555"></a>    <a href="../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>updatedCols</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN2552"><span class='Ref_To_Local'>trigdesc</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2550"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2552"><span class='Ref_To_Local'>trigdesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="trigger.c.html#LN2552"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN62"><span class='Ref_to_Member'>trig_update_before_statement</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN2555"><span class='Ref_To_Local'>updatedCols</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN74"><span class='Ref_to_Macro'>GetUpdatedColumns</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2550"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2550"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN2554"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN31"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN490"><span class='Ref_to_EnumConst'>T_TriggerData</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2554"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a> <span class='Operator'>= </span><a href="../../include/commands/trigger.h.html#LN53"><span class='Ref_to_Const'>TRIGGER_EVENT_UPDATE</span></a> <span class='Operator'>| 
</span>        <a href="../../include/commands/trigger.h.html#LN59"><span class='Ref_to_Const'>TRIGGER_EVENT_BEFORE</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2554"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN33"><span class='Ref_to_Member'>tg_relation</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2550"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2554"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN34"><span class='Ref_to_Member'>tg_trigtuple</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2554"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN35"><span class='Ref_to_Member'>tg_newtuple</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2554"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN39"><span class='Ref_to_Member'>tg_oldtable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2554"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN40"><span class='Ref_to_Member'>tg_newtable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2554"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN37"><span class='Ref_to_Member'>tg_trigtuplebuf</span></a> <span class='Operator'>= </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2554"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN38"><span class='Ref_to_Member'>tg_newtuplebuf</span></a> <span class='Operator'>= </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2553"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="trigger.c.html#LN2553"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="trigger.c.html#LN2552"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN48"><span class='Ref_to_Member'>numtriggers</span></a><span class='Delimiter'>; </span><a href="trigger.c.html#LN2553"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2578"></a>        <a href="../../include/utils/reltrigger.h.html#LN22"><span class='Ref_to_Struct'>Trigger</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>trigger</span> <span class='Operator'>= &</span><a href="trigger.c.html#LN2552"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN47"><span class='Ref_to_Member'>triggers</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN2553"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span><a name="LN2579"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newtuple</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/catalog/pg_trigger.h.html#LN145"><span class='Ref_to_Macro'>TRIGGER_TYPE_MATCHES</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2578"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN28"><span class='Ref_to_Member'>tgtype</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/catalog/pg_trigger.h.html#LN106"><span class='Ref_to_Const'>TRIGGER_TYPE_STATEMENT</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/catalog/pg_trigger.h.html#LN98"><span class='Ref_to_Const'>TRIGGER_TYPE_BEFORE</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/catalog/pg_trigger.h.html#LN101"><span class='Ref_to_Const'>TRIGGER_TYPE_UPDATE</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="trigger.c.html#LN86"><span class='Ref_to_Proto'>TriggerEnabled</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2550"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2550"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2578"><span class='Ref_To_Local'>trigger</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2554"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Delimiter'>, 
</span>                            <a href="trigger.c.html#LN2555"><span class='Ref_To_Local'>updatedCols</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="trigger.c.html#LN2554"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN36"><span class='Ref_to_Member'>tg_trigger</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2578"><span class='Ref_To_Local'>trigger</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2579"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN90"><span class='Ref_to_Proto'>ExecCallTriggerFunc</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN2554"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Delimiter'>, 
</span>                                       <a href="trigger.c.html#LN2553"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, 
</span>                                       <a href="trigger.c.html#LN2550"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN378"><span class='Ref_to_Member'>ri_TrigFunctions</span></a><span class='Delimiter'>, 
</span>                                       <a href="trigger.c.html#LN2550"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN380"><span class='Ref_to_Member'>ri_TrigInstrument</span></a><span class='Delimiter'>, 
</span>                                       <a href="../../include/executor/executor.h.html#LN460"><span class='Ref_to_Macro'>GetPerTupleMemoryContext</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2550"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2579"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_E_R_I_E_TRIGGER_PROTOCOL_VIOLATED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                  <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"BEFORE STATEMENT trigger cannot return a value"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;trigdesc-&GT;numtr... &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end ExecBSUpdateTriggers &raquo; </span> 
 
<span class='Keyword'>void 
</span><a name="LN2605"></a><span class='Declare_Function'>ExecASUpdateTriggers</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>relinfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2607"></a>    <a href="../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a> <span class='Operator'>*</span><span class='Declare_Local'>trigdesc</span> <span class='Operator'>= </span><a href="trigger.c.html#LN2605"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2607"><span class='Ref_To_Local'>trigdesc</span></a> <span class='Operator'>&& </span><a href="trigger.c.html#LN2607"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN63"><span class='Ref_to_Member'>trig_update_after_statement</span></a><span class='Parentheses'>) 
</span>        <a href="trigger.c.html#LN95"><span class='Ref_to_Proto'>AfterTriggerSaveEvent</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2605"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2605"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Delimiter'>, </span><a href="../../include/commands/trigger.h.html#LN53"><span class='Ref_to_Const'>TRIGGER_EVENT_UPDATE</span></a><span class='Delimiter'>, 
</span>                              <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, 
</span>                              <a href="trigger.c.html#LN74"><span class='Ref_to_Macro'>GetUpdatedColumns</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2605"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2605"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>* 
</span><a name="LN2616"></a><span class='Declare_Function'>ExecBRUpdateTriggers</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN873"><span class='Ref_to_Struct'>EPQState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>epqstate</span><span class='Delimiter'>, 
</span><a name="LN2617"></a>                     <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>relinfo</span><span class='Delimiter'>, 
</span><a name="LN2618"></a>                     <a href="../../include/storage/itemptr.h.html#LN47"><span class='Ref_to_Typedef'>ItemPointer</span></a> <span class='Declare_Parameter'>tupleid</span><span class='Delimiter'>, 
</span><a name="LN2619"></a>                     <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>fdw_trigtuple</span><span class='Delimiter'>, 
</span><a name="LN2620"></a>                     <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2622"></a>    <a href="../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a> <span class='Operator'>*</span><span class='Declare_Local'>trigdesc</span> <span class='Operator'>= </span><a href="trigger.c.html#LN2617"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a><span class='Delimiter'>; 
</span><a name="LN2623"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>slottuple</span> <span class='Operator'>= </span><a href="../../include/executor/tuptable.h.html#LN162"><span class='Ref_to_Proto'>ExecMaterializeSlot</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2620"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2624"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newtuple</span> <span class='Operator'>= </span><a href="trigger.c.html#LN2623"><span class='Ref_To_Local'>slottuple</span></a><span class='Delimiter'>; 
</span><a name="LN2625"></a>    <a href="../../include/commands/trigger.h.html#LN29"><span class='Ref_to_Struct'>TriggerData</span></a> <span class='Declare_Local'>LocTriggerData</span><span class='Delimiter'>; 
</span><a name="LN2626"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>trigtuple</span><span class='Delimiter'>; 
</span><a name="LN2627"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>oldtuple</span><span class='Delimiter'>; 
</span><a name="LN2628"></a>    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>newSlot</span><span class='Delimiter'>; 
</span><a name="LN2629"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN2630"></a>    <a href="../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>updatedCols</span><span class='Delimiter'>; 
</span><a name="LN2631"></a>    <a href="../../include/access/heapam.h.html#LN37"><span class='Ref_to_Enum'>LockTupleMode</span></a> <span class='Declare_Local'>lockmode</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Determine lock mode to use */ 
</span>    <a href="trigger.c.html#LN2631"><span class='Ref_To_Local'>lockmode</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN192"><span class='Ref_to_Proto'>ExecUpdateLockMode</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2616"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2617"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2619"><span class='Ref_to_Parameter'>fdw_trigtuple</span></a><span class='Parentheses'>) </span><span class='Operator'>^ </span><a href="../../include/storage/itemptr.h.html#LN58"><span class='Ref_to_Macro'>ItemPointerIsValid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2618"><span class='Ref_to_Parameter'>tupleid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2619"><span class='Ref_to_Parameter'>fdw_trigtuple</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* get a copy of the on-disk tuple we are planning to update */ 
</span>        <a href="trigger.c.html#LN2626"><span class='Ref_To_Local'>trigtuple</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN80"><span class='Ref_to_Proto'>GetTupleForTrigger</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2616"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2616"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2617"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2618"><span class='Ref_to_Parameter'>tupleid</span></a><span class='Delimiter'>, 
</span>                                       <a href="trigger.c.html#LN2631"><span class='Ref_To_Local'>lockmode</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="trigger.c.html#LN2628"><span class='Ref_To_Local'>newSlot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2626"><span class='Ref_To_Local'>trigtuple</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* cancel the update action */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="trigger.c.html#LN2626"><span class='Ref_To_Local'>trigtuple</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2619"><span class='Ref_to_Parameter'>fdw_trigtuple</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2628"><span class='Ref_To_Local'>newSlot</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * In READ COMMITTED isolation level it's possible that target tuple was 
     * changed due to concurrent update.  In that case we have a raw subplan 
     * output tuple in newSlot, and need to run it through the junk filter to 
     * produce an insertable tuple. 
     * 
     * Caution: more than likely, the passed-in slot is the same as the 
     * junkfilter's output slot, so we are clobbering the original value of 
     * slottuple by doing the filtering.  This is OK since neither we nor our 
     * caller have any more interest in the prior contents of that slot. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2628"><span class='Ref_To_Local'>newSlot</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="trigger.c.html#LN2620"><span class='Ref_to_Parameter'>slot</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN160"><span class='Ref_to_Proto'>ExecFilterJunk</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2617"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN387"><span class='Ref_to_Member'>ri_junkFilter</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2628"><span class='Ref_To_Local'>newSlot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2623"><span class='Ref_To_Local'>slottuple</span></a> <span class='Operator'>= </span><a href="../../include/executor/tuptable.h.html#LN162"><span class='Ref_to_Proto'>ExecMaterializeSlot</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2620"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2624"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2623"><span class='Ref_To_Local'>slottuple</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
 
    <a href="trigger.c.html#LN2625"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN31"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN490"><span class='Ref_to_EnumConst'>T_TriggerData</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2625"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a> <span class='Operator'>= </span><a href="../../include/commands/trigger.h.html#LN53"><span class='Ref_to_Const'>TRIGGER_EVENT_UPDATE</span></a> <span class='Operator'>| 
</span>        <a href="../../include/commands/trigger.h.html#LN57"><span class='Ref_to_Const'>TRIGGER_EVENT_ROW</span></a> <span class='Operator'>| 
</span>        <a href="../../include/commands/trigger.h.html#LN59"><span class='Ref_to_Const'>TRIGGER_EVENT_BEFORE</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2625"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN33"><span class='Ref_to_Member'>tg_relation</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2617"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2625"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN39"><span class='Ref_to_Member'>tg_oldtable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2625"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN40"><span class='Ref_to_Member'>tg_newtable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2630"><span class='Ref_To_Local'>updatedCols</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN74"><span class='Ref_to_Macro'>GetUpdatedColumns</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2617"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2616"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2629"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="trigger.c.html#LN2629"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="trigger.c.html#LN2622"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN48"><span class='Ref_to_Member'>numtriggers</span></a><span class='Delimiter'>; </span><a href="trigger.c.html#LN2629"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2680"></a>        <a href="../../include/utils/reltrigger.h.html#LN22"><span class='Ref_to_Struct'>Trigger</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>trigger</span> <span class='Operator'>= &</span><a href="trigger.c.html#LN2622"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN47"><span class='Ref_to_Member'>triggers</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN2629"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/catalog/pg_trigger.h.html#LN145"><span class='Ref_to_Macro'>TRIGGER_TYPE_MATCHES</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2680"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN28"><span class='Ref_to_Member'>tgtype</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/catalog/pg_trigger.h.html#LN97"><span class='Ref_to_Const'>TRIGGER_TYPE_ROW</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/catalog/pg_trigger.h.html#LN98"><span class='Ref_to_Const'>TRIGGER_TYPE_BEFORE</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/catalog/pg_trigger.h.html#LN101"><span class='Ref_to_Const'>TRIGGER_TYPE_UPDATE</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="trigger.c.html#LN86"><span class='Ref_to_Proto'>TriggerEnabled</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2616"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2617"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2680"><span class='Ref_To_Local'>trigger</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2625"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Delimiter'>, 
</span>                            <a href="trigger.c.html#LN2630"><span class='Ref_To_Local'>updatedCols</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2626"><span class='Ref_To_Local'>trigtuple</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2624"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="trigger.c.html#LN2625"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN34"><span class='Ref_to_Member'>tg_trigtuple</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2626"><span class='Ref_To_Local'>trigtuple</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2625"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN35"><span class='Ref_to_Member'>tg_newtuple</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2627"><span class='Ref_To_Local'>oldtuple</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2624"><span class='Ref_To_Local'>newtuple</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2625"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN37"><span class='Ref_to_Member'>tg_trigtuplebuf</span></a> <span class='Operator'>= </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2625"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN38"><span class='Ref_to_Member'>tg_newtuplebuf</span></a> <span class='Operator'>= </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2625"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN36"><span class='Ref_to_Member'>tg_trigger</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2680"><span class='Ref_To_Local'>trigger</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2624"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN90"><span class='Ref_to_Proto'>ExecCallTriggerFunc</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN2625"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Delimiter'>, 
</span>                                       <a href="trigger.c.html#LN2629"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, 
</span>                                       <a href="trigger.c.html#LN2617"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN378"><span class='Ref_to_Member'>ri_TrigFunctions</span></a><span class='Delimiter'>, 
</span>                                       <a href="trigger.c.html#LN2617"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN380"><span class='Ref_to_Member'>ri_TrigInstrument</span></a><span class='Delimiter'>, 
</span>                                       <a href="../../include/executor/executor.h.html#LN460"><span class='Ref_to_Macro'>GetPerTupleMemoryContext</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2616"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2627"><span class='Ref_To_Local'>oldtuple</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN2624"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>&& </span><a href="trigger.c.html#LN2627"><span class='Ref_To_Local'>oldtuple</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN2623"><span class='Ref_To_Local'>slottuple</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2627"><span class='Ref_To_Local'>oldtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2624"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2626"><span class='Ref_To_Local'>trigtuple</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN2619"><span class='Ref_to_Parameter'>fdw_trigtuple</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2626"><span class='Ref_To_Local'>trigtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* "do nothing" */ 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;trigdesc-&GT;numtr... &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2626"><span class='Ref_To_Local'>trigtuple</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN2619"><span class='Ref_to_Parameter'>fdw_trigtuple</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2626"><span class='Ref_To_Local'>trigtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2624"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN2623"><span class='Ref_To_Local'>slottuple</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Return the modified tuple using the es_trig_tuple_slot.  We assume 
         * the tuple was allocated in per-tuple memory context, and therefore 
         * will go away by itself. The tuple table slot should not try to 
         * clear it. 
         */ 
</span><a name="LN2721"></a>        <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>newslot</span> <span class='Operator'>= </span><a href="trigger.c.html#LN2616"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN436"><span class='Ref_to_Member'>es_trig_tuple_slot</span></a><span class='Delimiter'>; 
</span><a name="LN2722"></a>        <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2617"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2721"><span class='Ref_To_Local'>newslot</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/tuptable.h.html#LN120"><span class='Ref_to_Member'>tts_tupleDescriptor</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN2722"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/executor/tuptable.h.html#LN146"><span class='Ref_to_Proto'>ExecSetSlotDescriptor</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2721"><span class='Ref_To_Local'>newslot</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2722"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/executor/tuptable.h.html#LN147"><span class='Ref_to_Proto'>ExecStoreTuple</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2624"><span class='Ref_To_Local'>newtuple</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2721"><span class='Ref_To_Local'>newslot</span></a><span class='Delimiter'>, </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2620"><span class='Ref_to_Parameter'>slot</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2721"><span class='Ref_To_Local'>newslot</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="trigger.c.html#LN2620"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecBRUpdateTriggers &raquo; </span> 
 
<span class='Keyword'>void 
</span><a name="LN2733"></a><span class='Declare_Function'>ExecARUpdateTriggers</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>relinfo</span><span class='Delimiter'>, 
</span><a name="LN2734"></a>                     <a href="../../include/storage/itemptr.h.html#LN47"><span class='Ref_to_Typedef'>ItemPointer</span></a> <span class='Declare_Parameter'>tupleid</span><span class='Delimiter'>, 
</span><a name="LN2735"></a>                     <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>fdw_trigtuple</span><span class='Delimiter'>, 
</span><a name="LN2736"></a>                     <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>newtuple</span><span class='Delimiter'>, 
</span><a name="LN2737"></a>                     <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>recheckIndexes</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2739"></a>    <a href="../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a> <span class='Operator'>*</span><span class='Declare_Local'>trigdesc</span> <span class='Operator'>= </span><a href="trigger.c.html#LN2733"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2739"><span class='Ref_To_Local'>trigdesc</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="trigger.c.html#LN2739"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN60"><span class='Ref_to_Member'>trig_update_after_row</span></a> <span class='Operator'>|| 
</span>         <a href="trigger.c.html#LN2739"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN74"><span class='Ref_to_Member'>trig_update_old_table</span></a> <span class='Operator'>|| </span><a href="trigger.c.html#LN2739"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN75"><span class='Ref_to_Member'>trig_update_new_table</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2744"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>trigtuple</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2735"><span class='Ref_to_Parameter'>fdw_trigtuple</span></a><span class='Parentheses'>) </span><span class='Operator'>^ </span><a href="../../include/storage/itemptr.h.html#LN58"><span class='Ref_to_Macro'>ItemPointerIsValid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2734"><span class='Ref_to_Parameter'>tupleid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2735"><span class='Ref_to_Parameter'>fdw_trigtuple</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="trigger.c.html#LN2744"><span class='Ref_To_Local'>trigtuple</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN80"><span class='Ref_to_Proto'>GetTupleForTrigger</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2733"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, 
</span>                                           <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                           <a href="trigger.c.html#LN2733"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Delimiter'>, 
</span>                                           <a href="trigger.c.html#LN2734"><span class='Ref_to_Parameter'>tupleid</span></a><span class='Delimiter'>, 
</span>                                           <a href="../../include/access/heapam.h.html#LN46"><span class='Ref_to_EnumConst'>LockTupleExclusive</span></a><span class='Delimiter'>, 
</span>                                           <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="trigger.c.html#LN2744"><span class='Ref_To_Local'>trigtuple</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2735"><span class='Ref_to_Parameter'>fdw_trigtuple</span></a><span class='Delimiter'>; 
</span> 
        <a href="trigger.c.html#LN95"><span class='Ref_to_Proto'>AfterTriggerSaveEvent</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2733"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2733"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Delimiter'>, </span><a href="../../include/commands/trigger.h.html#LN53"><span class='Ref_to_Const'>TRIGGER_EVENT_UPDATE</span></a><span class='Delimiter'>, 
</span>                              <span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="trigger.c.html#LN2744"><span class='Ref_To_Local'>trigtuple</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2736"><span class='Ref_to_Parameter'>newtuple</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2737"><span class='Ref_to_Parameter'>recheckIndexes</span></a><span class='Delimiter'>, 
</span>                              <a href="trigger.c.html#LN74"><span class='Ref_to_Macro'>GetUpdatedColumns</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2733"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2733"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2744"><span class='Ref_To_Local'>trigtuple</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN2735"><span class='Ref_to_Parameter'>fdw_trigtuple</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2744"><span class='Ref_To_Local'>trigtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if trigdesc&&(trigdesc-&GT;... &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end ExecARUpdateTriggers &raquo; </span> 
 
<a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>* 
</span><a name="LN2766"></a><span class='Declare_Function'>ExecIRUpdateTriggers</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>relinfo</span><span class='Delimiter'>, 
</span><a name="LN2767"></a>                     <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>trigtuple</span><span class='Delimiter'>, </span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2769"></a>    <a href="../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a> <span class='Operator'>*</span><span class='Declare_Local'>trigdesc</span> <span class='Operator'>= </span><a href="trigger.c.html#LN2766"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a><span class='Delimiter'>; 
</span><a name="LN2770"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>slottuple</span> <span class='Operator'>= </span><a href="../../include/executor/tuptable.h.html#LN162"><span class='Ref_to_Proto'>ExecMaterializeSlot</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2767"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2771"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newtuple</span> <span class='Operator'>= </span><a href="trigger.c.html#LN2770"><span class='Ref_To_Local'>slottuple</span></a><span class='Delimiter'>; 
</span><a name="LN2772"></a>    <a href="../../include/commands/trigger.h.html#LN29"><span class='Ref_to_Struct'>TriggerData</span></a> <span class='Declare_Local'>LocTriggerData</span><span class='Delimiter'>; 
</span><a name="LN2773"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>oldtuple</span><span class='Delimiter'>; 
</span><a name="LN2774"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN2772"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN31"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN490"><span class='Ref_to_EnumConst'>T_TriggerData</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2772"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a> <span class='Operator'>= </span><a href="../../include/commands/trigger.h.html#LN53"><span class='Ref_to_Const'>TRIGGER_EVENT_UPDATE</span></a> <span class='Operator'>| 
</span>        <a href="../../include/commands/trigger.h.html#LN57"><span class='Ref_to_Const'>TRIGGER_EVENT_ROW</span></a> <span class='Operator'>| 
</span>        <a href="../../include/commands/trigger.h.html#LN61"><span class='Ref_to_Const'>TRIGGER_EVENT_INSTEAD</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2772"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN33"><span class='Ref_to_Member'>tg_relation</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2766"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2772"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN39"><span class='Ref_to_Member'>tg_oldtable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2772"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN40"><span class='Ref_to_Member'>tg_newtable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2774"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="trigger.c.html#LN2774"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="trigger.c.html#LN2769"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN48"><span class='Ref_to_Member'>numtriggers</span></a><span class='Delimiter'>; </span><a href="trigger.c.html#LN2774"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2785"></a>        <a href="../../include/utils/reltrigger.h.html#LN22"><span class='Ref_to_Struct'>Trigger</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>trigger</span> <span class='Operator'>= &</span><a href="trigger.c.html#LN2769"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN47"><span class='Ref_to_Member'>triggers</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN2774"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/catalog/pg_trigger.h.html#LN145"><span class='Ref_to_Macro'>TRIGGER_TYPE_MATCHES</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2785"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN28"><span class='Ref_to_Member'>tgtype</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/catalog/pg_trigger.h.html#LN97"><span class='Ref_to_Const'>TRIGGER_TYPE_ROW</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/catalog/pg_trigger.h.html#LN103"><span class='Ref_to_Const'>TRIGGER_TYPE_INSTEAD</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/catalog/pg_trigger.h.html#LN101"><span class='Ref_to_Const'>TRIGGER_TYPE_UPDATE</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="trigger.c.html#LN86"><span class='Ref_to_Proto'>TriggerEnabled</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2766"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2766"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2785"><span class='Ref_To_Local'>trigger</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2772"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Delimiter'>, 
</span>                            <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="trigger.c.html#LN2767"><span class='Ref_to_Parameter'>trigtuple</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2771"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="trigger.c.html#LN2772"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN34"><span class='Ref_to_Member'>tg_trigtuple</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2767"><span class='Ref_to_Parameter'>trigtuple</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2772"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN35"><span class='Ref_to_Member'>tg_newtuple</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2773"><span class='Ref_To_Local'>oldtuple</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2771"><span class='Ref_To_Local'>newtuple</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2772"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN37"><span class='Ref_to_Member'>tg_trigtuplebuf</span></a> <span class='Operator'>= </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2772"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN38"><span class='Ref_to_Member'>tg_newtuplebuf</span></a> <span class='Operator'>= </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2772"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN36"><span class='Ref_to_Member'>tg_trigger</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2785"><span class='Ref_To_Local'>trigger</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2771"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN90"><span class='Ref_to_Proto'>ExecCallTriggerFunc</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN2772"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Delimiter'>, 
</span>                                       <a href="trigger.c.html#LN2774"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, 
</span>                                       <a href="trigger.c.html#LN2766"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN378"><span class='Ref_to_Member'>ri_TrigFunctions</span></a><span class='Delimiter'>, 
</span>                                       <a href="trigger.c.html#LN2766"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN380"><span class='Ref_to_Member'>ri_TrigInstrument</span></a><span class='Delimiter'>, 
</span>                                       <a href="../../include/executor/executor.h.html#LN460"><span class='Ref_to_Macro'>GetPerTupleMemoryContext</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2766"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2773"><span class='Ref_To_Local'>oldtuple</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN2771"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>&& </span><a href="trigger.c.html#LN2773"><span class='Ref_To_Local'>oldtuple</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN2770"><span class='Ref_To_Local'>slottuple</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2773"><span class='Ref_To_Local'>oldtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2771"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* "do nothing" */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;trigdesc-&GT;numtr... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2771"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN2770"><span class='Ref_To_Local'>slottuple</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Return the modified tuple using the es_trig_tuple_slot.  We assume 
         * the tuple was allocated in per-tuple memory context, and therefore 
         * will go away by itself. The tuple table slot should not try to 
         * clear it. 
         */ 
</span><a name="LN2820"></a>        <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>newslot</span> <span class='Operator'>= </span><a href="trigger.c.html#LN2766"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN436"><span class='Ref_to_Member'>es_trig_tuple_slot</span></a><span class='Delimiter'>; 
</span><a name="LN2821"></a>        <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2766"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2820"><span class='Ref_To_Local'>newslot</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/tuptable.h.html#LN120"><span class='Ref_to_Member'>tts_tupleDescriptor</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN2821"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/executor/tuptable.h.html#LN146"><span class='Ref_to_Proto'>ExecSetSlotDescriptor</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2820"><span class='Ref_To_Local'>newslot</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2821"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/executor/tuptable.h.html#LN147"><span class='Ref_to_Proto'>ExecStoreTuple</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2771"><span class='Ref_To_Local'>newtuple</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2820"><span class='Ref_To_Local'>newslot</span></a><span class='Delimiter'>, </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2767"><span class='Ref_to_Parameter'>slot</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2820"><span class='Ref_To_Local'>newslot</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="trigger.c.html#LN2767"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecIRUpdateTriggers &raquo; </span> 
 
<span class='Keyword'>void 
</span><a name="LN2832"></a><span class='Declare_Function'>ExecBSTruncateTriggers</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>relinfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2834"></a>    <a href="../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a> <span class='Operator'>*</span><span class='Declare_Local'>trigdesc</span><span class='Delimiter'>; 
</span><a name="LN2835"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN2836"></a>    <a href="../../include/commands/trigger.h.html#LN29"><span class='Ref_to_Struct'>TriggerData</span></a> <span class='Declare_Local'>LocTriggerData</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN2834"><span class='Ref_To_Local'>trigdesc</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2832"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2834"><span class='Ref_To_Local'>trigdesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="trigger.c.html#LN2834"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN70"><span class='Ref_to_Member'>trig_truncate_before_statement</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN2836"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN31"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN490"><span class='Ref_to_EnumConst'>T_TriggerData</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2836"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a> <span class='Operator'>= </span><a href="../../include/commands/trigger.h.html#LN54"><span class='Ref_to_Const'>TRIGGER_EVENT_TRUNCATE</span></a> <span class='Operator'>| 
</span>        <a href="../../include/commands/trigger.h.html#LN59"><span class='Ref_to_Const'>TRIGGER_EVENT_BEFORE</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2836"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN33"><span class='Ref_to_Member'>tg_relation</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2832"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2836"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN34"><span class='Ref_to_Member'>tg_trigtuple</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2836"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN35"><span class='Ref_to_Member'>tg_newtuple</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2836"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN39"><span class='Ref_to_Member'>tg_oldtable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2836"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN40"><span class='Ref_to_Member'>tg_newtable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2836"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN37"><span class='Ref_to_Member'>tg_trigtuplebuf</span></a> <span class='Operator'>= </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN2836"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN38"><span class='Ref_to_Member'>tg_newtuplebuf</span></a> <span class='Operator'>= </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2835"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="trigger.c.html#LN2835"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="trigger.c.html#LN2834"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN48"><span class='Ref_to_Member'>numtriggers</span></a><span class='Delimiter'>; </span><a href="trigger.c.html#LN2835"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2857"></a>        <a href="../../include/utils/reltrigger.h.html#LN22"><span class='Ref_to_Struct'>Trigger</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>trigger</span> <span class='Operator'>= &</span><a href="trigger.c.html#LN2834"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN47"><span class='Ref_to_Member'>triggers</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN2835"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span><a name="LN2858"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newtuple</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/catalog/pg_trigger.h.html#LN145"><span class='Ref_to_Macro'>TRIGGER_TYPE_MATCHES</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2857"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN28"><span class='Ref_to_Member'>tgtype</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/catalog/pg_trigger.h.html#LN106"><span class='Ref_to_Const'>TRIGGER_TYPE_STATEMENT</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/catalog/pg_trigger.h.html#LN98"><span class='Ref_to_Const'>TRIGGER_TYPE_BEFORE</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/catalog/pg_trigger.h.html#LN102"><span class='Ref_to_Const'>TRIGGER_TYPE_TRUNCATE</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="trigger.c.html#LN86"><span class='Ref_to_Proto'>TriggerEnabled</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2832"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2832"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2857"><span class='Ref_To_Local'>trigger</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2836"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Delimiter'>, 
</span>                            <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="trigger.c.html#LN2836"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN36"><span class='Ref_to_Member'>tg_trigger</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2857"><span class='Ref_To_Local'>trigger</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2858"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN90"><span class='Ref_to_Proto'>ExecCallTriggerFunc</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN2836"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Delimiter'>, 
</span>                                       <a href="trigger.c.html#LN2835"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, 
</span>                                       <a href="trigger.c.html#LN2832"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN378"><span class='Ref_to_Member'>ri_TrigFunctions</span></a><span class='Delimiter'>, 
</span>                                       <a href="trigger.c.html#LN2832"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN380"><span class='Ref_to_Member'>ri_TrigInstrument</span></a><span class='Delimiter'>, 
</span>                                       <a href="../../include/executor/executor.h.html#LN460"><span class='Ref_to_Macro'>GetPerTupleMemoryContext</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2832"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2858"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_E_R_I_E_TRIGGER_PROTOCOL_VIOLATED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                  <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"BEFORE STATEMENT trigger cannot return a value"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;trigdesc-&GT;numtr... &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end ExecBSTruncateTriggers &raquo; </span> 
 
<span class='Keyword'>void 
</span><a name="LN2884"></a><span class='Declare_Function'>ExecASTruncateTriggers</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>relinfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2886"></a>    <a href="../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a> <span class='Operator'>*</span><span class='Declare_Local'>trigdesc</span> <span class='Operator'>= </span><a href="trigger.c.html#LN2884"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2886"><span class='Ref_To_Local'>trigdesc</span></a> <span class='Operator'>&& </span><a href="trigger.c.html#LN2886"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN71"><span class='Ref_to_Member'>trig_truncate_after_statement</span></a><span class='Parentheses'>) 
</span>        <a href="trigger.c.html#LN95"><span class='Ref_to_Proto'>AfterTriggerSaveEvent</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2884"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN2884"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Delimiter'>, </span><a href="../../include/commands/trigger.h.html#LN54"><span class='Ref_to_Const'>TRIGGER_EVENT_TRUNCATE</span></a><span class='Delimiter'>, 
</span>                              <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Keyword'>static </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> 
<a name="LN2895"></a><span class='Declare_Function'>GetTupleForTrigger</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN2896"></a>                   <a href="../../include/nodes/execnodes.h.html#LN873"><span class='Ref_to_Struct'>EPQState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>epqstate</span><span class='Delimiter'>, 
</span><a name="LN2897"></a>                   <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>relinfo</span><span class='Delimiter'>, 
</span><a name="LN2898"></a>                   <a href="../../include/storage/itemptr.h.html#LN47"><span class='Ref_to_Typedef'>ItemPointer</span></a> <span class='Declare_Parameter'>tid</span><span class='Delimiter'>, 
</span><a name="LN2899"></a>                   <a href="../../include/access/heapam.h.html#LN37"><span class='Ref_to_Enum'>LockTupleMode</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Delimiter'>, 
</span><a name="LN2900"></a>                   <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>newSlot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2902"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span> <span class='Operator'>= </span><a href="trigger.c.html#LN2897"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>; 
</span><a name="LN2903"></a>    <a href="../../include/access/htup.h.html#LN61"><span class='Ref_to_Struct'>HeapTupleData</span></a> <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN2904"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN2905"></a>    <a href="../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>buffer</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2900"><span class='Ref_to_Parameter'>newSlot</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2909"></a>        <a href="../../include/utils/snapshot.h.html#LN118"><span class='Ref_to_Typedef'>HTSU_Result</span></a> <span class='Declare_Local'>test</span><span class='Delimiter'>; 
</span><a name="LN2910"></a>        <a href="../../include/access/heapam.h.html#LN67"><span class='Ref_to_Struct'>HeapUpdateFailureData</span></a> <span class='Declare_Local'>hufd</span><span class='Delimiter'>; 
</span> 
        <span class='Operator'>*</span><a href="trigger.c.html#LN2900"><span class='Ref_to_Parameter'>newSlot</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* caller must pass an epqstate if EvalPlanQual is possible */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN2896"><span class='Ref_to_Parameter'>epqstate</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * lock tuple for update 
         */ 
</span><a name="LN2920"></a><span class='Label'>ltrmark</span><span class='Operator'>:</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2903"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a> <span class='Operator'>= *</span><a href="trigger.c.html#LN2898"><span class='Ref_to_Parameter'>tid</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2909"><span class='Ref_To_Local'>test</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN164"><span class='Ref_to_Proto'>heap_lock_tuple</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2902"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="trigger.c.html#LN2903"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, 
</span>                               <a href="trigger.c.html#LN2895"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN417"><span class='Ref_to_Member'>es_output_cid</span></a><span class='Delimiter'>, 
</span>                               <a href="trigger.c.html#LN2899"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/lockoptions.h.html#LN38"><span class='Ref_to_EnumConst'>LockWaitBlock</span></a><span class='Delimiter'>, 
</span>                               <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="trigger.c.html#LN2905"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="trigger.c.html#LN2910"><span class='Ref_To_Local'>hufd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2909"><span class='Ref_To_Local'>test</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../include/utils/snapshot.h.html#LN122"><span class='Ref_to_EnumConst'>HeapTupleSelfUpdated</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * The target tuple was already updated or deleted by the 
                 * current command, or by a later command in the current 
                 * transaction.  We ignore the tuple in the former case, and 
                 * throw error in the latter case, for the same reasons 
                 * enumerated in ExecUpdate and ExecDelete in 
                 * nodeModifyTable.c. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN2910"><span class='Ref_To_Local'>hufd</span></a><span class='Operator'>.</span><a href="../../include/access/heapam.h.html#LN71"><span class='Ref_to_Member'>cmax</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN2895"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN417"><span class='Ref_to_Member'>es_output_cid</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_TRIGGERED_DATA_CHANGE_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"tuple to be updated was already modified by an operation triggered by the current command"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Consider using an AFTER trigger instead of a BEFORE trigger to propagate changes to other rows."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* treat it as deleted; do not process */ 
</span>                <a href="../../include/storage/bufmgr.h.html#LN174"><span class='Ref_to_Proto'>ReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2905"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../include/utils/snapshot.h.html#LN120"><span class='Ref_to_EnumConst'>HeapTupleMayBeUpdated</span></a><span class='Operator'>: 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../include/utils/snapshot.h.html#LN123"><span class='Ref_to_EnumConst'>HeapTupleUpdated</span></a><span class='Operator'>: 
</span>                <a href="../../include/storage/bufmgr.h.html#LN174"><span class='Ref_to_Proto'>ReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2905"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/xact.h.html#LN42"><span class='Ref_to_Macro'>IsolationUsesXactSnapshot</span></a><span class='Parentheses'>())</span> 
                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_T_R_SERIALIZATION_FAILURE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not serialize access due to concurrent update"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../storage/page/itemptr.c.html#LN27"><span class='Ref_to_Func'>ItemPointerEquals</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN2910"><span class='Ref_To_Local'>hufd</span></a><span class='Operator'>.</span><a href="../../include/access/heapam.h.html#LN69"><span class='Ref_to_Member'>ctid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="trigger.c.html#LN2903"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* it was updated, so look at the updated version */ 
</span><a name="LN2960"></a>                    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>epqslot</span><span class='Delimiter'>; 
</span> 
                    <a href="trigger.c.html#LN2960"><span class='Ref_To_Local'>epqslot</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN195"><span class='Ref_to_Proto'>EvalPlanQual</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2895"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, 
</span>                                           <a href="trigger.c.html#LN2896"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Delimiter'>, 
</span>                                           <a href="trigger.c.html#LN2902"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, 
</span>                                           <a href="trigger.c.html#LN2897"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN372"><span class='Ref_to_Member'>ri_RangeTableIndex</span></a><span class='Delimiter'>, 
</span>                                           <a href="trigger.c.html#LN2899"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Delimiter'>, 
</span>                                           <span class='Operator'>&</span><a href="trigger.c.html#LN2910"><span class='Ref_To_Local'>hufd</span></a><span class='Operator'>.</span><a href="../../include/access/heapam.h.html#LN69"><span class='Ref_to_Member'>ctid</span></a><span class='Delimiter'>, 
</span>                                           <a href="trigger.c.html#LN2910"><span class='Ref_To_Local'>hufd</span></a><span class='Operator'>.</span><a href="../../include/access/heapam.h.html#LN70"><span class='Ref_to_Member'>xmax</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/executor/tuptable.h.html#LN137"><span class='Ref_to_Macro'>TupIsNull</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2960"><span class='Ref_To_Local'>epqslot</span></a><span class='Parentheses'>))</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Operator'>*</span><a href="trigger.c.html#LN2898"><span class='Ref_to_Parameter'>tid</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2910"><span class='Ref_To_Local'>hufd</span></a><span class='Operator'>.</span><a href="../../include/access/heapam.h.html#LN69"><span class='Ref_to_Member'>ctid</span></a><span class='Delimiter'>; 
</span>                        <span class='Operator'>*</span><a href="trigger.c.html#LN2900"><span class='Ref_to_Parameter'>newSlot</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN2960"><span class='Ref_To_Local'>epqslot</span></a><span class='Delimiter'>; 
</span> 
                        <span class='Comment_Multi_Line'>/* 
                         * EvalPlanQual already locked the tuple, but we 
                         * re-call heap_lock_tuple anyway as an easy way of 
                         * re-fetching the correct tuple.  Speed is hardly a 
                         * criterion in this path anyhow. 
                         */ 
</span>                        <span class='Control'>goto</span> <span class='Symbol_Characters'>&uarr;</span><a href="trigger.c.html#LN2920"><span class='Ref_to_Label'>ltrmark</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !ItemPointerEquals(&h... &raquo; </span> 
 
                <span class='Comment_Multi_Line'>/* 
                 * if tuple was deleted or PlanQual failed for updated tuple - 
                 * we must not process this tuple! 
                 */ 
</span>                <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../include/utils/snapshot.h.html#LN121"><span class='Ref_to_EnumConst'>HeapTupleInvisible</span></a><span class='Operator'>: 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"attempted to lock invisible tuple"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../include/storage/bufmgr.h.html#LN174"><span class='Ref_to_Proto'>ReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2905"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized heap_lock_tuple status: %u"</span><span class='Delimiter'>, </span><a href="trigger.c.html#LN2909"><span class='Ref_To_Local'>test</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch test &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if newSlot!=NULL &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN3001"></a>        <a href="../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span><a name="LN3002"></a>        <a href="../../include/storage/itemid.h.html#LN30"><span class='Ref_to_Typedef'>ItemId</span></a>      <span class='Declare_Local'>lp</span><span class='Delimiter'>; 
</span> 
        <a href="trigger.c.html#LN2905"><span class='Ref_To_Local'>buffer</span></a> <span class='Operator'>= </span><a href="../../include/storage/bufmgr.h.html#LN167"><span class='Ref_to_Proto'>ReadBuffer</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2902"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/itemptr.h.html#LN74"><span class='Ref_to_Macro'>ItemPointerGetBlockNumber</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2898"><span class='Ref_to_Parameter'>tid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Although we already know this tuple is valid, we must lock the 
         * buffer to ensure that no one has a buffer cleanup lock; otherwise 
         * they might move the tuple while we try to copy it.  But we can 
         * release the lock before actually doing the heap_copytuple call, 
         * since holding pin is sufficient to prevent anyone from getting a 
         * cleanup lock they don't already hold. 
         */ 
</span>        <a href="../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2905"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><a href="../../include/storage/bufmgr.h.html#LN87"><span class='Ref_to_Const'>BUFFER_LOCK_SHARE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="trigger.c.html#LN3001"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2905"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN3002"><span class='Ref_To_Local'>lp</span></a> <span class='Operator'>= </span><a href="../../include/storage/bufpage.h.html#LN231"><span class='Ref_to_Macro'>PageGetItemId</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3001"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="../../include/storage/itemptr.h.html#LN93"><span class='Ref_to_Macro'>ItemPointerGetOffsetNumber</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2898"><span class='Ref_to_Parameter'>tid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/storage/itemid.h.html#LN97"><span class='Ref_to_Macro'>ItemIdIsNormal</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3002"><span class='Ref_To_Local'>lp</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="trigger.c.html#LN2903"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a><span class='Parentheses'>) </span><a href="../../include/storage/bufpage.h.html#LN336"><span class='Ref_to_Macro'>PageGetItem</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3001"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN3002"><span class='Ref_To_Local'>lp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2903"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a> <span class='Operator'>= </span><a href="../../include/storage/itemid.h.html#LN57"><span class='Ref_to_Macro'>ItemIdGetLength</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3002"><span class='Ref_To_Local'>lp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2903"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a> <span class='Operator'>= *</span><a href="trigger.c.html#LN2898"><span class='Ref_to_Parameter'>tid</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN2903"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2902"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2905"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><a href="../../include/storage/bufmgr.h.html#LN86"><span class='Ref_to_Const'>BUFFER_LOCK_UNLOCK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <a href="trigger.c.html#LN2904"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN606"><span class='Ref_to_Func'>heap_copytuple</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN2903"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/storage/bufmgr.h.html#LN174"><span class='Ref_to_Proto'>ReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN2905"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="trigger.c.html#LN2904"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end GetTupleForTrigger &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Is trigger enabled to fire? 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN3039"></a><span class='Declare_Function'>TriggerEnabled</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>relinfo</span><span class='Delimiter'>, 
</span><a name="LN3040"></a>               <a href="../../include/utils/reltrigger.h.html#LN22"><span class='Ref_to_Struct'>Trigger</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>trigger</span><span class='Delimiter'>, </span><a href="../../include/commands/trigger.h.html#LN27"><span class='Ref_to_Typedef'>TriggerEvent</span></a> <span class='Declare_Parameter'>event</span><span class='Delimiter'>, 
</span><a name="LN3041"></a>               <a href="../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>modifiedCols</span><span class='Delimiter'>, 
</span><a name="LN3042"></a>               <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>oldtup</span><span class='Delimiter'>, </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>newtup</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Check replication-role-dependent enable state */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN63"><span class='Ref_to_Global_Var'>SessionReplicationRole</span></a> <span class='Operator'>== </span><a href="../../include/commands/trigger.h.html#LN100"><span class='Ref_to_Const'>SESSION_REPLICATION_ROLE_REPLICA</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3040"><span class='Ref_to_Parameter'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN29"><span class='Ref_to_Member'>tgenabled</span></a> <span class='Operator'>== </span><a href="../../include/commands/trigger.h.html#LN108"><span class='Ref_to_Const'>TRIGGER_FIRES_ON_ORIGIN</span></a> <span class='Operator'>|| 
</span>            <a href="trigger.c.html#LN3040"><span class='Ref_to_Parameter'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN29"><span class='Ref_to_Member'>tgenabled</span></a> <span class='Operator'>== </span><a href="../../include/commands/trigger.h.html#LN111"><span class='Ref_to_Const'>TRIGGER_DISABLED</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span>    <span class='Comment_Single_Line'>/* ORIGIN or LOCAL role */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3040"><span class='Ref_to_Parameter'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN29"><span class='Ref_to_Member'>tgenabled</span></a> <span class='Operator'>== </span><a href="../../include/commands/trigger.h.html#LN110"><span class='Ref_to_Const'>TRIGGER_FIRES_ON_REPLICA</span></a> <span class='Operator'>|| 
</span>            <a href="trigger.c.html#LN3040"><span class='Ref_to_Parameter'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN29"><span class='Ref_to_Member'>tgenabled</span></a> <span class='Operator'>== </span><a href="../../include/commands/trigger.h.html#LN111"><span class='Ref_to_Const'>TRIGGER_DISABLED</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check for column-specific trigger (only possible for UPDATE, and in 
     * fact we *must* ignore tgattr for other event types) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3040"><span class='Ref_to_Parameter'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN37"><span class='Ref_to_Member'>tgnattr</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="../../include/commands/trigger.h.html#LN75"><span class='Ref_to_Macro'>TRIGGER_FIRED_BY_UPDATE</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3040"><span class='Ref_to_Parameter'>event</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN3064"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN3065"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>modified</span><span class='Delimiter'>; 
</span> 
        <a href="trigger.c.html#LN3065"><span class='Ref_To_Local'>modified</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3064"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="trigger.c.html#LN3064"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="trigger.c.html#LN3040"><span class='Ref_to_Parameter'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN37"><span class='Ref_to_Member'>tgnattr</span></a><span class='Delimiter'>; </span><a href="trigger.c.html#LN3064"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/bitmapset.h.html#LN75"><span class='Ref_to_Proto'>bms_is_member</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3040"><span class='Ref_to_Parameter'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN38"><span class='Ref_to_Member'>tgattr</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN3064"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>- </span><a href="../../include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a><span class='Delimiter'>, 
</span>                              <a href="trigger.c.html#LN3041"><span class='Ref_to_Parameter'>modifiedCols</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="trigger.c.html#LN3065"><span class='Ref_To_Local'>modified</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="trigger.c.html#LN3065"><span class='Ref_To_Local'>modified</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Check for WHEN clause */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3040"><span class='Ref_to_Parameter'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN40"><span class='Ref_to_Member'>tgqual</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3084"></a>        <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3039"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3085"></a>        <a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a> <span class='Operator'>**</span><span class='Declare_Local'>predicate</span><span class='Delimiter'>; 
</span><a name="LN3086"></a>        <a href="../../include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>econtext</span><span class='Delimiter'>; 
</span><a name="LN3087"></a>        <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>oldslot</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN3088"></a>        <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>newslot</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN3089"></a>        <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldContext</span><span class='Delimiter'>; 
</span><a name="LN3090"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3039"><span class='Ref_to_Parameter'>estate</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * trigger is an element of relinfo-&GT;ri_TrigDesc-&GT;triggers[]; find the 
         * matching element of relinfo-&GT;ri_TrigWhenExprs[] 
         */ 
</span>        <a href="trigger.c.html#LN3090"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3040"><span class='Ref_to_Parameter'>trigger</span></a> <span class='Operator'>- </span><a href="trigger.c.html#LN3039"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN47"><span class='Ref_to_Member'>triggers</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN3085"><span class='Ref_To_Local'>predicate</span></a> <span class='Operator'>= &</span><a href="trigger.c.html#LN3039"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN379"><span class='Ref_to_Member'>ri_TrigWhenExprs</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN3090"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If first time through for this WHEN expression, build expression 
         * nodetrees for it.  Keep them in the per-query memory context so 
         * they'll survive throughout the query. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="trigger.c.html#LN3085"><span class='Ref_To_Local'>predicate</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN3108"></a>            <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tgqual</span><span class='Delimiter'>; 
</span> 
            <a href="trigger.c.html#LN3089"><span class='Ref_To_Local'>oldContext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3039"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN447"><span class='Ref_to_Member'>es_query_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="trigger.c.html#LN3108"><span class='Ref_To_Local'>tgqual</span></a> <span class='Operator'>= </span><a href="../nodes/read.c.html#LN36"><span class='Ref_to_Func'>stringToNode</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3040"><span class='Ref_to_Parameter'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN40"><span class='Ref_to_Member'>tgqual</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Change references to OLD and NEW to INNER_VAR and OUTER_VAR */ 
</span>            <a href="../../include/rewrite/rewriteManip.h.html#LN42"><span class='Ref_to_Proto'>ChangeVarNodes</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3108"><span class='Ref_To_Local'>tgqual</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN159"><span class='Ref_to_Const'>PRS2_OLD_VARNO</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN152"><span class='Ref_to_Const'>INNER_VAR</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/rewrite/rewriteManip.h.html#LN42"><span class='Ref_to_Proto'>ChangeVarNodes</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3108"><span class='Ref_To_Local'>tgqual</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN160"><span class='Ref_to_Const'>PRS2_NEW_VARNO</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN153"><span class='Ref_to_Const'>OUTER_VAR</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* ExecPrepareQual wants implicit-AND form */ 
</span>            <a href="trigger.c.html#LN3108"><span class='Ref_To_Local'>tgqual</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/optimizer/clauses.h.html#LN46"><span class='Ref_to_Proto'>make_ands_implicit</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="trigger.c.html#LN3108"><span class='Ref_To_Local'>tgqual</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="trigger.c.html#LN3085"><span class='Ref_To_Local'>predicate</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN247"><span class='Ref_to_Proto'>ExecPrepareQual</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="trigger.c.html#LN3108"><span class='Ref_To_Local'>tgqual</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN3039"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3089"><span class='Ref_To_Local'>oldContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We will use the EState's per-tuple context for evaluating WHEN 
         * expressions (creating it if it's not already there). 
         */ 
</span>        <a href="trigger.c.html#LN3086"><span class='Ref_To_Local'>econtext</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN455"><span class='Ref_to_Macro'>GetPerTupleExprContext</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3039"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Put OLD and NEW tuples into tupleslots for expression evaluation. 
         * These slots can be shared across the whole estate, but be careful 
         * that they have the current resultrel's tupdesc. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3042"><span class='Ref_to_Parameter'>oldtup</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3039"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN437"><span class='Ref_to_Member'>es_trig_oldtup_slot</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="trigger.c.html#LN3089"><span class='Ref_To_Local'>oldContext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3039"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN447"><span class='Ref_to_Member'>es_query_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="trigger.c.html#LN3039"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN437"><span class='Ref_to_Member'>es_trig_oldtup_slot</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN402"><span class='Ref_to_Proto'>ExecInitExtraTupleSlot</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3039"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3089"><span class='Ref_To_Local'>oldContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="trigger.c.html#LN3087"><span class='Ref_To_Local'>oldslot</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3039"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN437"><span class='Ref_to_Member'>es_trig_oldtup_slot</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3087"><span class='Ref_To_Local'>oldslot</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/tuptable.h.html#LN120"><span class='Ref_to_Member'>tts_tupleDescriptor</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN3084"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/executor/tuptable.h.html#LN146"><span class='Ref_to_Proto'>ExecSetSlotDescriptor</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3087"><span class='Ref_To_Local'>oldslot</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN3084"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/executor/tuptable.h.html#LN147"><span class='Ref_to_Proto'>ExecStoreTuple</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3042"><span class='Ref_to_Parameter'>oldtup</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN3087"><span class='Ref_To_Local'>oldslot</span></a><span class='Delimiter'>, </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3042"><span class='Ref_to_Parameter'>newtup</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3039"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN438"><span class='Ref_to_Member'>es_trig_newtup_slot</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="trigger.c.html#LN3089"><span class='Ref_To_Local'>oldContext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3039"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN447"><span class='Ref_to_Member'>es_query_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="trigger.c.html#LN3039"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN438"><span class='Ref_to_Member'>es_trig_newtup_slot</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN402"><span class='Ref_to_Proto'>ExecInitExtraTupleSlot</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3039"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3089"><span class='Ref_To_Local'>oldContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="trigger.c.html#LN3088"><span class='Ref_To_Local'>newslot</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3039"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN438"><span class='Ref_to_Member'>es_trig_newtup_slot</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3088"><span class='Ref_To_Local'>newslot</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/tuptable.h.html#LN120"><span class='Ref_to_Member'>tts_tupleDescriptor</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN3084"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/executor/tuptable.h.html#LN146"><span class='Ref_to_Proto'>ExecSetSlotDescriptor</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3088"><span class='Ref_To_Local'>newslot</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN3084"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/executor/tuptable.h.html#LN147"><span class='Ref_to_Proto'>ExecStoreTuple</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3042"><span class='Ref_to_Parameter'>newtup</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN3088"><span class='Ref_To_Local'>newslot</span></a><span class='Delimiter'>, </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Finally evaluate the expression, making the old and/or new tuples 
         * available as INNER_VAR/OUTER_VAR respectively. 
         */ 
</span>        <a href="trigger.c.html#LN3086"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN197"><span class='Ref_to_Member'>ecxt_innertuple</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3087"><span class='Ref_To_Local'>oldslot</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN3086"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN198"><span class='Ref_to_Member'>ecxt_outertuple</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3088"><span class='Ref_To_Local'>newslot</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/executor/executor.h.html#LN344"><span class='Ref_to_Func'>ExecQual</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="trigger.c.html#LN3085"><span class='Ref_To_Local'>predicate</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN3086"><span class='Ref_To_Local'>econtext</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if trigger-&GT;tgqual &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end TriggerEnabled &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * After-trigger stuff 
 * 
 * The AfterTriggersData struct holds data about pending AFTER trigger events 
 * during the current transaction tree.  (BEFORE triggers are fired 
 * immediately so we don't need any persistent state about them.)  The struct 
 * and most of its subsidiary data are kept in TopTransactionContext; however 
 * the individual event records are kept in a separate sub-context.  This is 
 * done mainly so that it's easy to tell from a memory context dump how much 
 * space is being eaten by trigger events. 
 * 
 * Because the list of pending events can grow large, we go to some 
 * considerable effort to minimize per-event memory consumption.  The event 
 * records are grouped into chunks and common data for similar events in the 
 * same chunk is only stored once. 
 * 
 * XXX We need to be able to save the per-event data in a file if it grows too 
 * large. 
 * ---------- 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* Per-trigger SET CONSTRAINT status */ 
</span><a name="LN3195"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>SetConstraintTriggerData</span> 
<span class='Delimiter'>{ 
</span><a name="LN3197"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>sct_tgoid</span><span class='Delimiter'>; 
</span><a name="LN3198"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>sct_tgisdeferred</span><span class='Delimiter'>; 
</span><a name="LN3199"></a>} <span class='Declare_Typedef'>SetConstraintTriggerData</span><span class='Delimiter'>; 
</span> 
<a name="LN3201"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <a href="trigger.c.html#LN3195"><span class='Ref_to_Struct'>SetConstraintTriggerData</span></a> <span class='Operator'>*</span><span class='Declare_Typedef'>SetConstraintTrigger</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * SET CONSTRAINT intra-transaction status. 
 * 
 * We make this a single palloc'd object so it can be copied and freed easily. 
 * 
 * all_isset and all_isdeferred are used to keep track 
 * of SET CONSTRAINTS ALL {DEFERRED, IMMEDIATE}. 
 * 
 * trigstates[] stores per-trigger tgisdeferred settings. 
 */ 
</span><a name="LN3213"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>SetConstraintStateData</span> 
<span class='Delimiter'>{ 
</span><a name="LN3215"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>all_isset</span><span class='Delimiter'>; 
</span><a name="LN3216"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>all_isdeferred</span><span class='Delimiter'>; 
</span><a name="LN3217"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>numstates</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* number of trigstates[] entries in use */ 
</span><a name="LN3218"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>numalloc</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* allocated size of trigstates[] */ 
</span><a name="LN3219"></a>    <a href="trigger.c.html#LN3195"><span class='Ref_to_Struct'>SetConstraintTriggerData</span></a> <span class='Declare_Member'>trigstates</span><span class='Delimiter'>[</span>FLEXIBLE_ARRAY_MEMBER<span class='Delimiter'>]; 
</span><a name="LN3220"></a>} <span class='Declare_Typedef'>SetConstraintStateData</span><span class='Delimiter'>; 
</span> 
<a name="LN3222"></a><span class='Control'>typedef</span> <a href="trigger.c.html#LN3213"><span class='Ref_to_Struct'>SetConstraintStateData</span></a> <span class='Operator'>*</span><span class='Declare_Typedef'>SetConstraintState</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Per-trigger-event data 
 * 
 * The actual per-event data, AfterTriggerEventData, includes DONE/IN_PROGRESS 
 * status bits and up to two tuple CTIDs.  Each event record also has an 
 * associated AfterTriggerSharedData that is shared across all instances of 
 * similar events within a "chunk". 
 * 
 * For row-level triggers, we arrange not to waste storage on unneeded ctid 
 * fields.  Updates of regular tables use two; inserts and deletes of regular 
 * tables use one; foreign tables always use zero and save the tuple(s) to a 
 * tuplestore.  AFTER_TRIGGER_FDW_FETCH directs AfterTriggerExecute() to 
 * retrieve a fresh tuple or pair of tuples from that tuplestore, while 
 * AFTER_TRIGGER_FDW_REUSE directs it to use the most-recently-retrieved 
 * tuple(s).  This permits storing tuples once regardless of the number of 
 * row-level triggers on a foreign table. 
 * 
 * Statement-level triggers always bear AFTER_TRIGGER_1CTID, though they 
 * require no ctid field.  We lack the flag bit space to neatly represent that 
 * distinct case, and it seems unlikely to be worth much trouble. 
 * 
 * Note: ats_firing_id is initially zero and is set to something else when 
 * AFTER_TRIGGER_IN_PROGRESS is set.  It indicates which trigger firing 
 * cycle the trigger will be fired in (or was fired in, if DONE is set). 
 * Although this is mutable state, we can keep it in AfterTriggerSharedData 
 * because all instances of the same type of event in a given event list will 
 * be fired at the same time, if they were queued between the same firing 
 * cycles.  So we need only ensure that ats_firing_id is zero when attaching 
 * a new event to an existing AfterTriggerSharedData record. 
 */ 
</span><a name="LN3255"></a><span class='Control'>typedef</span> <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Typedef'>TriggerFlags</span><span class='Delimiter'>; 
</span> 
<a name="LN3257"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>AFTER_TRIGGER_OFFSET</span>            <span class='Number'>0x0FFFFFFF</span>      <span class='Comment_Multi_Line'>/* must be low-order 
                                                         * bits */ 
</span><a name="LN3259"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>AFTER_TRIGGER_DONE</span>              <span class='Number'>0x10000000</span> 
<a name="LN3260"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>AFTER_TRIGGER_IN_PROGRESS</span>       <span class='Number'>0x20000000</span> 
<span class='Comment_Multi_Line'>/* bits describing the size and tuple sources of this event */ 
</span><a name="LN3262"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>AFTER_TRIGGER_FDW_REUSE</span>         <span class='Number'>0x00000000</span> 
<a name="LN3263"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>AFTER_TRIGGER_FDW_FETCH</span>         <span class='Number'>0x80000000</span> 
<a name="LN3264"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>AFTER_TRIGGER_1CTID</span>             <span class='Number'>0x40000000</span> 
<a name="LN3265"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>AFTER_TRIGGER_2CTID</span>             <span class='Number'>0xC0000000</span> 
<a name="LN3266"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>AFTER_TRIGGER_TUP_BITS</span>          <span class='Number'>0xC0000000</span> 
 
<a name="LN3268"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <a href="trigger.c.html#LN3270"><span class='Ref_to_Struct'>AfterTriggerSharedData</span></a> <span class='Operator'>*</span><span class='Declare_Typedef'>AfterTriggerShared</span><span class='Delimiter'>; 
</span> 
<a name="LN3270"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>AfterTriggerSharedData</span> 
<span class='Delimiter'>{ 
</span><a name="LN3272"></a>    <a href="../../include/commands/trigger.h.html#LN27"><span class='Ref_to_Typedef'>TriggerEvent</span></a> <span class='Declare_Member'>ats_event</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* event type indicator, see trigger.h */ 
</span><a name="LN3273"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>ats_tgoid</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* the trigger's ID */ 
</span><a name="LN3274"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>ats_relid</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* the relation it's on */ 
</span><a name="LN3275"></a>    <a href="../../include/c.h.html#LN410"><span class='Ref_to_Typedef'>CommandId</span></a>   <span class='Declare_Member'>ats_firing_id</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* ID for firing cycle */ 
</span><a name="LN3276"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>AfterTriggerSharedData</span><span class='Delimiter'>; 
</span> 
<a name="LN3278"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <a href="trigger.c.html#LN3280"><span class='Ref_to_Struct'>AfterTriggerEventData</span></a> <span class='Operator'>*</span><span class='Declare_Typedef'>AfterTriggerEvent</span><span class='Delimiter'>; 
</span> 
<a name="LN3280"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>AfterTriggerEventData</span> 
<span class='Delimiter'>{ 
</span><a name="LN3282"></a>    <a href="trigger.c.html#LN3255"><span class='Ref_to_Typedef'>TriggerFlags</span></a> <span class='Declare_Member'>ate_flags</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* status bits and offset to shared data */ 
</span><a name="LN3283"></a>    <a href="../../include/storage/itemptr.h.html#LN35"><span class='Ref_to_Struct'>ItemPointerData</span></a> <span class='Declare_Member'>ate_ctid1</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* inserted, deleted, or old updated tuple */ 
</span><a name="LN3284"></a>    <a href="../../include/storage/itemptr.h.html#LN35"><span class='Ref_to_Struct'>ItemPointerData</span></a> <span class='Declare_Member'>ate_ctid2</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* new updated tuple */ 
</span><a name="LN3285"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>AfterTriggerEventData</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* AfterTriggerEventData, minus ate_ctid2 */ 
</span><a name="LN3288"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>AfterTriggerEventDataOneCtid</span> 
<span class='Delimiter'>{ 
</span><a name="LN3290"></a>    <a href="trigger.c.html#LN3255"><span class='Ref_to_Typedef'>TriggerFlags</span></a> <span class='Declare_Member'>ate_flags</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* status bits and offset to shared data */ 
</span><a name="LN3291"></a>    <a href="../../include/storage/itemptr.h.html#LN35"><span class='Ref_to_Struct'>ItemPointerData</span></a> <span class='Declare_Member'>ate_ctid1</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* inserted, deleted, or old updated tuple */ 
</span><a name="LN3292"></a><span class='Delimiter'>}</span>   <span class='Declare_Typedef'>AfterTriggerEventDataOneCtid</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* AfterTriggerEventData, minus ate_ctid1 and ate_ctid2 */ 
</span><a name="LN3295"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>AfterTriggerEventDataZeroCtids</span> 
<span class='Delimiter'>{ 
</span><a name="LN3297"></a>    <a href="trigger.c.html#LN3255"><span class='Ref_to_Typedef'>TriggerFlags</span></a> <span class='Declare_Member'>ate_flags</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* status bits and offset to shared data */ 
</span><a name="LN3298"></a><span class='Delimiter'>}</span>   <span class='Declare_Typedef'>AfterTriggerEventDataZeroCtids</span><span class='Delimiter'>; 
</span> 
<a name="LN3300"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>SizeofTriggerEvent</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>evt</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>(((</span><a href="trigger.c.html#LN3300"><span class='Ref_to_Parameter'>evt</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>ate_flags <span class='Operator'>& </span><a href="trigger.c.html#LN3266"><span class='Ref_to_Const'>AFTER_TRIGGER_TUP_BITS</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><a href="trigger.c.html#LN3265"><span class='Ref_to_Const'>AFTER_TRIGGER_2CTID</span></a> <span class='Operator'>? \ 
</span>     <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3280"><span class='Ref_to_Struct'>AfterTriggerEventData</span></a><span class='Parentheses'>)</span> <span class='Operator'>: \ 
</span>        <span class='Parentheses'>((</span><a href="trigger.c.html#LN3300"><span class='Ref_to_Parameter'>evt</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>ate_flags <span class='Operator'>& </span><a href="trigger.c.html#LN3266"><span class='Ref_to_Const'>AFTER_TRIGGER_TUP_BITS</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><a href="trigger.c.html#LN3264"><span class='Ref_to_Const'>AFTER_TRIGGER_1CTID</span></a> <span class='Operator'>? \ 
</span>        <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3288"><span class='Ref_to_Struct'>AfterTriggerEventDataOneCtid</span></a><span class='Parentheses'>)</span> <span class='Operator'>: \ 
</span>            <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3295"><span class='Ref_to_Struct'>AfterTriggerEventDataZeroCtids</span></a><span class='Parentheses'>))</span> 
 
<a name="LN3307"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>GetTriggerSharedData</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>evt</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="trigger.c.html#LN3268"><span class='Ref_to_Typedef'>AfterTriggerShared</span></a><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3307"><span class='Ref_to_Parameter'>evt</span></a><span class='Parentheses'>)</span> <span class='Operator'>+ </span><span class='Parentheses'>((</span><a href="trigger.c.html#LN3307"><span class='Ref_to_Parameter'>evt</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>ate_flags <span class='Operator'>& </span><a href="trigger.c.html#LN3257"><span class='Ref_to_Const'>AFTER_TRIGGER_OFFSET</span></a><span class='Parentheses'>)))</span> 
 
<span class='Comment_Multi_Line'>/* 
 * To avoid palloc overhead, we keep trigger events in arrays in successively- 
 * larger chunks (a slightly more sophisticated version of an expansible 
 * array).  The space between CHUNK_DATA_START and freeptr is occupied by 
 * AfterTriggerEventData records; the space between endfree and endptr is 
 * occupied by AfterTriggerSharedData records. 
 */ 
</span><a name="LN3317"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>AfterTriggerEventChunk</span> 
<span class='Delimiter'>{ 
</span><a name="LN3319"></a>    <span class='Control'>struct</span> <a href="trigger.c.html#LN3317"><span class='Ref_to_Struct'>AfterTriggerEventChunk</span></a> <span class='Operator'>*</span><span class='Declare_Member'>next</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* list link */ 
</span><a name="LN3320"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>freeptr</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* start of free space in chunk */ 
</span><a name="LN3321"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>endfree</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* end of free space in chunk */ 
</span><a name="LN3322"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>endptr</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* end of chunk */ 
</span>    <span class='Comment_Multi_Line'>/* event data follows here */ 
</span><a name="LN3324"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>AfterTriggerEventChunk</span><span class='Delimiter'>; 
</span> 
<a name="LN3326"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>CHUNK_DATA_START</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>cptr</span><span class='Parentheses'>) ((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3326"><span class='Ref_to_Parameter'>cptr</span></a><span class='Parentheses'>)</span> <span class='Operator'>+ </span><a href="../../include/c.h.html#LN587"><span class='Ref_to_Macro'>MAXALIGN</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3317"><span class='Ref_to_Struct'>AfterTriggerEventChunk</span></a><span class='Parentheses'>)))</span> 
 
<span class='Comment_Multi_Line'>/* A list of events */ 
</span><a name="LN3329"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>AfterTriggerEventList</span> 
<span class='Delimiter'>{ 
</span><a name="LN3331"></a>    <a href="trigger.c.html#LN3317"><span class='Ref_to_Struct'>AfterTriggerEventChunk</span></a> <span class='Operator'>*</span><span class='Declare_Member'>head</span><span class='Delimiter'>; 
</span><a name="LN3332"></a>    <a href="trigger.c.html#LN3317"><span class='Ref_to_Struct'>AfterTriggerEventChunk</span></a> <span class='Operator'>*</span><span class='Declare_Member'>tail</span><span class='Delimiter'>; 
</span><a name="LN3333"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>tailfree</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* freeptr of tail chunk */ 
</span><a name="LN3334"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>AfterTriggerEventList</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* Macros to help in iterating over a list of events */ 
</span><a name="LN3337"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>for_each_chunk</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>cptr</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>evtlist</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3337"><span class='Ref_to_Parameter'>cptr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3337"><span class='Ref_to_Parameter'>evtlist</span></a><span class='Parentheses'>)</span><span class='Operator'>.</span>head<span class='Delimiter'>; </span><a href="trigger.c.html#LN3337"><span class='Ref_to_Parameter'>cptr</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="trigger.c.html#LN3337"><span class='Ref_to_Parameter'>cptr</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3337"><span class='Ref_to_Parameter'>cptr</span></a><span class='Operator'>-&GT;</span>next<span class='Parentheses'>)</span> 
<a name="LN3339"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>for_each_event</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>eptr</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>cptr</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3339"><span class='Ref_to_Parameter'>eptr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3278"><span class='Ref_to_Typedef'>AfterTriggerEvent</span></a><span class='Parentheses'>)</span> <a href="trigger.c.html#LN3326"><span class='Ref_to_Macro'>CHUNK_DATA_START</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3339"><span class='Ref_to_Parameter'>cptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>         <span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>)</span> <a href="trigger.c.html#LN3339"><span class='Ref_to_Parameter'>eptr</span></a> <span class='Operator'>&LT; </span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3339"><span class='Ref_to_Parameter'>cptr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>freeptr<span class='Delimiter'>; </span><span class='Operator'>\ 
</span>         <a href="trigger.c.html#LN3339"><span class='Ref_to_Parameter'>eptr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3278"><span class='Ref_to_Typedef'>AfterTriggerEvent</span></a><span class='Parentheses'>)</span> <span class='Parentheses'>(((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="trigger.c.html#LN3339"><span class='Ref_to_Parameter'>eptr</span></a><span class='Parentheses'>)</span> <span class='Operator'>+ </span><a href="trigger.c.html#LN3300"><span class='Ref_to_Macro'>SizeofTriggerEvent</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3339"><span class='Ref_to_Parameter'>eptr</span></a><span class='Parentheses'>)))</span> 
<span class='Comment_Multi_Line'>/* Use this if no special per-chunk processing is needed */ 
</span><a name="LN3344"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>for_each_event_chunk</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>eptr</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>cptr</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>evtlist</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <a href="trigger.c.html#LN3337"><span class='Ref_to_Macro'>for_each_chunk</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3344"><span class='Ref_to_Parameter'>cptr</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN3344"><span class='Ref_to_Parameter'>evtlist</span></a><span class='Parentheses'>) </span><a href="trigger.c.html#LN3339"><span class='Ref_to_Macro'>for_each_event</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3344"><span class='Ref_to_Parameter'>eptr</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN3344"><span class='Ref_to_Parameter'>cptr</span></a><span class='Parentheses'>) 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * All per-transaction data for the AFTER TRIGGERS module. 
 * 
 * AfterTriggersData has the following fields: 
 * 
 * firing_counter is incremented for each call of afterTriggerInvokeEvents. 
 * We mark firable events with the current firing cycle's ID so that we can 
 * tell which ones to work on.  This ensures sane behavior if a trigger 
 * function chooses to do SET CONSTRAINTS: the inner SET CONSTRAINTS will 
 * only fire those events that weren't already scheduled for firing. 
 * 
 * state keeps track of the transaction-local effects of SET CONSTRAINTS. 
 * This is saved and restored across failed subtransactions. 
 * 
 * events is the current list of deferred events.  This is global across 
 * all subtransactions of the current transaction.  In a subtransaction 
 * abort, we know that the events added by the subtransaction are at the 
 * end of the list, so it is relatively easy to discard them.  The event 
 * list chunks themselves are stored in event_cxt. 
 * 
 * query_depth is the current depth of nested AfterTriggerBeginQuery calls 
 * (-1 when the stack is empty). 
 * 
 * query_stack[query_depth] is a list of AFTER trigger events queued by the 
 * current query (and the query_stack entries below it are lists of trigger 
 * events queued by calling queries).  None of these are valid until the 
 * matching AfterTriggerEndQuery call occurs.  At that point we fire 
 * immediate-mode triggers, and append any deferred events to the main events 
 * list. 
 * 
 * fdw_tuplestores[query_depth] is a tuplestore containing the foreign tuples 
 * needed for the current query. 
 * 
 * old_tuplestores[query_depth] and new_tuplestores[query_depth] hold the 
 * transition relations for the current query. 
 * 
 * maxquerydepth is just the allocated length of query_stack and the 
 * tuplestores. 
 * 
 * state_stack is a stack of pointers to saved copies of the SET CONSTRAINTS 
 * state data; each subtransaction level that modifies that state first 
 * saves a copy, which we use to restore the state if we abort. 
 * 
 * events_stack is a stack of copies of the events head/tail pointers, 
 * which we use to restore those values during subtransaction abort. 
 * 
 * depth_stack is a stack of copies of subtransaction-start-time query_depth, 
 * which we similarly use to clean up at subtransaction abort. 
 * 
 * firing_stack is a stack of copies of subtransaction-start-time 
 * firing_counter.  We use this to recognize which deferred triggers were 
 * fired (or marked for firing) within an aborted subtransaction. 
 * 
 * We use GetCurrentTransactionNestLevel() to determine the correct array 
 * index in these stacks.  maxtransdepth is the number of allocated entries in 
 * each stack.  (By not keeping our own stack pointer, we can avoid trouble 
 * in cases where errors during subxact abort cause multiple invocations 
 * of AfterTriggerEndSubXact() at the same nesting depth.) 
 */ 
</span><a name="LN3407"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>AfterTriggersData</span> 
<span class='Delimiter'>{ 
</span><a name="LN3409"></a>    <a href="../../include/c.h.html#LN410"><span class='Ref_to_Typedef'>CommandId</span></a>   <span class='Declare_Member'>firing_counter</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* next firing ID to assign */ 
</span><a name="LN3410"></a>    <a href="trigger.c.html#LN3222"><span class='Ref_to_Typedef'>SetConstraintState</span></a> <span class='Declare_Member'>state</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* the active S C state */ 
</span><a name="LN3411"></a>    <a href="trigger.c.html#LN3329"><span class='Ref_to_Struct'>AfterTriggerEventList</span></a> <span class='Declare_Member'>events</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* deferred-event list */ 
</span><a name="LN3412"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>query_depth</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* current query list index */ 
</span><a name="LN3413"></a>    <a href="trigger.c.html#LN3329"><span class='Ref_to_Struct'>AfterTriggerEventList</span></a> <span class='Operator'>*</span><span class='Declare_Member'>query_stack</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* events pending from each query */ 
</span><a name="LN3414"></a>    <a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>**</span><span class='Declare_Member'>fdw_tuplestores</span><span class='Delimiter'>;</span>  <span class='Comment_Multi_Line'>/* foreign tuples for one row from 
                                         * each query */ 
</span><a name="LN3416"></a>    <a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>**</span><span class='Declare_Member'>old_tuplestores</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* all old tuples from each query */ 
</span><a name="LN3417"></a>    <a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>**</span><span class='Declare_Member'>new_tuplestores</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* all new tuples from each query */ 
</span><a name="LN3418"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>maxquerydepth</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* allocated len of above array */ 
</span><a name="LN3419"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Member'>event_cxt</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* memory context for events, if any */ 
</span> 
    <span class='Comment_Multi_Line'>/* these fields are just for resetting at subtrans abort: */ 
</span> 
<a name="LN3423"></a>    <a href="trigger.c.html#LN3222"><span class='Ref_to_Typedef'>SetConstraintState</span></a> <span class='Operator'>*</span><span class='Declare_Member'>state_stack</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* stacked S C states */ 
</span><a name="LN3424"></a>    <a href="trigger.c.html#LN3329"><span class='Ref_to_Struct'>AfterTriggerEventList</span></a> <span class='Operator'>*</span><span class='Declare_Member'>events_stack</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* stacked list pointers */ 
</span><a name="LN3425"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Member'>depth_stack</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* stacked query_depths */ 
</span><a name="LN3426"></a>    <a href="../../include/c.h.html#LN410"><span class='Ref_to_Typedef'>CommandId</span></a>  <span class='Operator'>*</span><span class='Declare_Member'>firing_stack</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* stacked firing_counters */ 
</span><a name="LN3427"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>maxtransdepth</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* allocated len of above arrays */ 
</span><a name="LN3428"></a><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end AfterTriggersData &raquo; </span> <span class='Declare_Typedef'>AfterTriggersData</span><span class='Delimiter'>; 
</span> 
<a name="LN3430"></a><span class='Keyword'>static </span><a href="trigger.c.html#LN3407"><span class='Ref_to_Struct'>AfterTriggersData</span></a> <span class='Declare_Var'>afterTriggers</span><span class='Delimiter'>; 
</span> 
<a name="LN3432"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>AfterTriggerExecute</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3278"><span class='Ref_to_Typedef'>AfterTriggerEvent</span></a> <span class='Declare_Parameter'>event</span><span class='Delimiter'>, 
</span><a name="LN3433"></a>                    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>trigdesc</span><span class='Delimiter'>, 
</span><a name="LN3434"></a>                    <a href="../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>finfo</span><span class='Delimiter'>, 
</span><a name="LN3435"></a>                    <a href="../../include/executor/instrument.h.html#LN43"><span class='Ref_to_Struct'>Instrumentation</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>instr</span><span class='Delimiter'>, 
</span><a name="LN3436"></a>                    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>per_tuple_context</span><span class='Delimiter'>, 
</span><a name="LN3437"></a>                    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>trig_tuple_slot1</span><span class='Delimiter'>, 
</span><a name="LN3438"></a>                    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>trig_tuple_slot2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3439"></a><span class='Keyword'>static </span><a href="trigger.c.html#LN3222"><span class='Ref_to_Typedef'>SetConstraintState</span></a> <span class='Declare_Prototype'>SetConstraintStateCreate</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>numalloc</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3440"></a><span class='Keyword'>static </span><a href="trigger.c.html#LN3222"><span class='Ref_to_Typedef'>SetConstraintState</span></a> <span class='Declare_Prototype'>SetConstraintStateCopy</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3222"><span class='Ref_to_Typedef'>SetConstraintState</span></a> <span class='Declare_Parameter'>state</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3441"></a><span class='Keyword'>static </span><a href="trigger.c.html#LN3222"><span class='Ref_to_Typedef'>SetConstraintState</span></a> <span class='Declare_Prototype'>SetConstraintStateAddItem</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3222"><span class='Ref_to_Typedef'>SetConstraintState</span></a> <span class='Declare_Parameter'>state</span><span class='Delimiter'>, 
</span><a name="LN3442"></a>                          <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>tgoid</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>tgisdeferred</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Gets a current query transition tuplestore and initializes it if necessary. 
 * This can be holding a single transition row tuple (in the case of an FDW) 
 * or a transition table (for an AFTER trigger). 
 */ 
</span><span class='Keyword'>static </span><a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>* 
</span><a name="LN3451"></a><span class='Declare_Function'>GetTriggerTransitionTuplestore</span><span class='Parentheses'>(</span><a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>tss</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3453"></a>    <a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN3453"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3451"><span class='Ref_to_Parameter'>tss</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a><span class='Delimiter'>]; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3453"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3458"></a>        <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span><a name="LN3459"></a>        <a href="../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Local'>saveResourceOwner</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Make the tuplestore valid until end of transaction.  This is the 
         * allocation lifespan of the associated events list, but we really 
         * only need it until AfterTriggerEndQuery(). 
         */ 
</span>        <a href="trigger.c.html#LN3458"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN47"><span class='Ref_to_Global_Var'>TopTransactionContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN3459"><span class='Ref_To_Local'>saveResourceOwner</span></a> <span class='Operator'>= </span><a href="../utils/resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a><span class='Delimiter'>; 
</span>        <a href="../../include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../utils/resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a> <span class='Operator'>= </span><a href="../utils/resowner/resowner.c.html#LN139"><span class='Ref_to_Global_Var'>TopTransactionResourceOwner</span></a><span class='Delimiter'>; 
</span>            <a href="trigger.c.html#LN3453"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="../../include/utils/tuplestore.h.html#LN46"><span class='Ref_to_Proto'>tuplestore_begin_heap</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="../utils/init/globals.c.html#LN112"><span class='Ref_to_Global_Var'>work_mem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../utils/resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3459"><span class='Ref_To_Local'>saveResourceOwner</span></a><span class='Delimiter'>; 
</span>            <a href="../../include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="../utils/resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3459"><span class='Ref_To_Local'>saveResourceOwner</span></a><span class='Delimiter'>; 
</span>        <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3458"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="trigger.c.html#LN3451"><span class='Ref_to_Parameter'>tss</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="trigger.c.html#LN3453"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ret==NULL &raquo; </span> 
 
    <span class='Control'>return</span> <a href="trigger.c.html#LN3453"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end GetTriggerTransitionTuplestore &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * afterTriggerCheckState() 
 * 
 *  Returns true if the trigger event is actually in state DEFERRED. 
 * ---------- 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN3495"></a><span class='Declare_Function'>afterTriggerCheckState</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3268"><span class='Ref_to_Typedef'>AfterTriggerShared</span></a> <span class='Declare_Parameter'>evtshared</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3497"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tgoid</span> <span class='Operator'>= </span><a href="trigger.c.html#LN3495"><span class='Ref_to_Parameter'>evtshared</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3273"><span class='Ref_to_Member'>ats_tgoid</span></a><span class='Delimiter'>; 
</span><a name="LN3498"></a>    <a href="trigger.c.html#LN3222"><span class='Ref_to_Typedef'>SetConstraintState</span></a> <span class='Declare_Local'>state</span> <span class='Operator'>= </span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3410"><span class='Ref_to_Member'>state</span></a><span class='Delimiter'>; 
</span><a name="LN3499"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * For not-deferrable triggers (i.e. normal AFTER ROW triggers and 
     * constraints declared NOT DEFERRABLE), the state is always false. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="trigger.c.html#LN3495"><span class='Ref_to_Parameter'>evtshared</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3272"><span class='Ref_to_Member'>ats_event</span></a> <span class='Operator'>& </span><a href="../../include/commands/trigger.h.html#LN66"><span class='Ref_to_Const'>AFTER_TRIGGER_DEFERRABLE</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If constraint state exists, SET CONSTRAINTS might have been executed 
     * either for this trigger or for all triggers. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3498"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Check for SET CONSTRAINTS for this specific trigger. */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3499"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="trigger.c.html#LN3499"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="trigger.c.html#LN3498"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3217"><span class='Ref_to_Member'>numstates</span></a><span class='Delimiter'>; </span><a href="trigger.c.html#LN3499"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3498"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3219"><span class='Ref_to_Member'>trigstates</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN3499"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="trigger.c.html#LN3197"><span class='Ref_to_Member'>sct_tgoid</span></a> <span class='Operator'>== </span><a href="trigger.c.html#LN3497"><span class='Ref_To_Local'>tgoid</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <a href="trigger.c.html#LN3498"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3219"><span class='Ref_to_Member'>trigstates</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN3499"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="trigger.c.html#LN3198"><span class='Ref_to_Member'>sct_tgisdeferred</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Check for SET CONSTRAINTS ALL. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3498"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3215"><span class='Ref_to_Member'>all_isset</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="trigger.c.html#LN3498"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3216"><span class='Ref_to_Member'>all_isdeferred</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Otherwise return the default state for the trigger. 
     */ 
</span>    <span class='Control'>return</span> <span class='Parentheses'>((</span><a href="trigger.c.html#LN3495"><span class='Ref_to_Parameter'>evtshared</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3272"><span class='Ref_to_Member'>ats_event</span></a> <span class='Operator'>& </span><a href="../../include/commands/trigger.h.html#LN67"><span class='Ref_to_Const'>AFTER_TRIGGER_INITDEFERRED</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end afterTriggerCheckState &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * afterTriggerAddEvent() 
 * 
 *  Add a new trigger event to the specified queue. 
 *  The passed-in event data is copied. 
 * ---------- 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3541"></a><span class='Declare_Function'>afterTriggerAddEvent</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3329"><span class='Ref_to_Struct'>AfterTriggerEventList</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>events</span><span class='Delimiter'>, 
</span><a name="LN3542"></a>                     <a href="trigger.c.html#LN3278"><span class='Ref_to_Typedef'>AfterTriggerEvent</span></a> <span class='Declare_Parameter'>event</span><span class='Delimiter'>, </span><a href="trigger.c.html#LN3268"><span class='Ref_to_Typedef'>AfterTriggerShared</span></a> <span class='Declare_Parameter'>evtshared</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3544"></a>    <a href="../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>eventsize</span> <span class='Operator'>= </span><a href="trigger.c.html#LN3300"><span class='Ref_to_Macro'>SizeofTriggerEvent</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3542"><span class='Ref_to_Parameter'>event</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3545"></a>    <a href="../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>needed</span> <span class='Operator'>= </span><a href="trigger.c.html#LN3544"><span class='Ref_To_Local'>eventsize</span></a> <span class='Operator'>+ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3270"><span class='Ref_to_Struct'>AfterTriggerSharedData</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3546"></a>    <a href="trigger.c.html#LN3317"><span class='Ref_to_Struct'>AfterTriggerEventChunk</span></a> <span class='Operator'>*</span><span class='Declare_Local'>chunk</span><span class='Delimiter'>; 
</span><a name="LN3547"></a>    <a href="trigger.c.html#LN3268"><span class='Ref_to_Typedef'>AfterTriggerShared</span></a> <span class='Declare_Local'>newshared</span><span class='Delimiter'>; 
</span><a name="LN3548"></a>    <a href="trigger.c.html#LN3278"><span class='Ref_to_Typedef'>AfterTriggerEvent</span></a> <span class='Declare_Local'>newevent</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If empty list or not enough room in the tail chunk, make a new chunk. 
     * We assume here that a new shared record will always be needed. 
     */ 
</span>    <a href="trigger.c.html#LN3546"><span class='Ref_To_Local'>chunk</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3541"><span class='Ref_to_Parameter'>events</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3332"><span class='Ref_to_Member'>tail</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3546"><span class='Ref_To_Local'>chunk</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>        <a href="trigger.c.html#LN3546"><span class='Ref_To_Local'>chunk</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3321"><span class='Ref_to_Member'>endfree</span></a> <span class='Operator'>- </span><a href="trigger.c.html#LN3546"><span class='Ref_To_Local'>chunk</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3320"><span class='Ref_to_Member'>freeptr</span></a> <span class='Operator'>&LT; </span><a href="trigger.c.html#LN3545"><span class='Ref_To_Local'>needed</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3558"></a>        <a href="../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>chunksize</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Create event context if we didn't already */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3419"><span class='Ref_to_Member'>event_cxt</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3419"><span class='Ref_to_Member'>event_cxt</span></a> <span class='Operator'>= 
</span>                <a href="../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN47"><span class='Ref_to_Global_Var'>TopTransactionContext</span></a><span class='Delimiter'>, 
</span>                                      <span class='String'>"AfterTriggerEvents"</span><span class='Delimiter'>, 
</span>                                      <a href="../../include/utils/memutils.h.html#LN164"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Chunk size starts at 1KB and is allowed to increase up to 1MB. 
         * These numbers are fairly arbitrary, though there is a hard limit at 
         * AFTER_TRIGGER_OFFSET; else we couldn't link event records to their 
         * shared records using the available space in ate_flags.  Another 
         * constraint is that if the chunk size gets too huge, the search loop 
         * below would get slow given a (not too common) usage pattern with 
         * many distinct event types in a chunk.  Therefore, we double the 
         * preceding chunk size only if there weren't too many shared records 
         * in the preceding chunk; otherwise we halve it.  This gives us some 
         * ability to adapt to the actual usage pattern of the current query 
         * while still having large chunk sizes in typical usage.  All chunk 
         * sizes used should be MAXALIGN multiples, to ensure that the shared 
         * records will be aligned safely. 
         */ 
</span><a name="LN3582"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MIN_CHUNK_SIZE</span> <span class='Number'>1024</span> 
<a name="LN3583"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MAX_CHUNK_SIZE</span> <span class='Parentheses'>(</span><span class='Number'>1024</span><span class='Operator'>*</span><span class='Number'>1024</span><span class='Parentheses'>) 
</span> 
<span class='Directive'>#if</span> <a href="trigger.c.html#LN3583"><span class='Ref_to_Const'>MAX_CHUNK_SIZE</span></a> <span class='Operator'>&GT; </span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3257"><span class='Ref_to_Const'>AFTER_TRIGGER_OFFSET</span></a><span class='Operator'>+</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>#error <a href="trigger.c.html#LN3583"><span class='Ref_to_Const'>MAX_CHUNK_SIZE</span></a> must not exceed <a href="trigger.c.html#LN3257"><span class='Ref_to_Const'>AFTER_TRIGGER_OFFSET</span></a> 
<span class='Directive'>#endif</span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3546"><span class='Ref_To_Local'>chunk</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="trigger.c.html#LN3558"><span class='Ref_To_Local'>chunksize</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3582"><span class='Ref_to_Const'>MIN_CHUNK_SIZE</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* preceding chunk size... */ 
</span>            <a href="trigger.c.html#LN3558"><span class='Ref_To_Local'>chunksize</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3546"><span class='Ref_To_Local'>chunk</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3322"><span class='Ref_to_Member'>endptr</span></a> <span class='Operator'>- </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="trigger.c.html#LN3546"><span class='Ref_To_Local'>chunk</span></a><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* check number of shared records in preceding chunk */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="trigger.c.html#LN3546"><span class='Ref_To_Local'>chunk</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3322"><span class='Ref_to_Member'>endptr</span></a> <span class='Operator'>- </span><a href="trigger.c.html#LN3546"><span class='Ref_To_Local'>chunk</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3321"><span class='Ref_to_Member'>endfree</span></a><span class='Parentheses'>)</span> <span class='Operator'>&LT;= 
</span>                <span class='Parentheses'>(</span><span class='Number'>100</span> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3270"><span class='Ref_to_Struct'>AfterTriggerSharedData</span></a><span class='Parentheses'>)))</span> 
                <a href="trigger.c.html#LN3558"><span class='Ref_To_Local'>chunksize</span></a> <span class='Operator'>*= </span><span class='Number'>2</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* okay, double it */ 
</span>            <span class='Control'>else</span> 
                <a href="trigger.c.html#LN3558"><span class='Ref_To_Local'>chunksize</span></a> <span class='Operator'>/= </span><span class='Number'>2</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* too many shared records */ 
</span>            <a href="trigger.c.html#LN3558"><span class='Ref_To_Local'>chunksize</span></a> <span class='Operator'>= </span><a href="../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3558"><span class='Ref_To_Local'>chunksize</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN3583"><span class='Ref_to_Const'>MAX_CHUNK_SIZE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="trigger.c.html#LN3546"><span class='Ref_To_Local'>chunk</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3419"><span class='Ref_to_Member'>event_cxt</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN3558"><span class='Ref_To_Local'>chunksize</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN3546"><span class='Ref_To_Local'>chunk</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3319"><span class='Ref_to_Member'>next</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN3546"><span class='Ref_To_Local'>chunk</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3320"><span class='Ref_to_Member'>freeptr</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3326"><span class='Ref_to_Macro'>CHUNK_DATA_START</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3546"><span class='Ref_To_Local'>chunk</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN3546"><span class='Ref_To_Local'>chunk</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3322"><span class='Ref_to_Member'>endptr</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3546"><span class='Ref_To_Local'>chunk</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3321"><span class='Ref_to_Member'>endfree</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="trigger.c.html#LN3546"><span class='Ref_To_Local'>chunk</span></a> <span class='Operator'>+ </span><a href="trigger.c.html#LN3558"><span class='Ref_To_Local'>chunksize</span></a><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3546"><span class='Ref_To_Local'>chunk</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3321"><span class='Ref_to_Member'>endfree</span></a> <span class='Operator'>- </span><a href="trigger.c.html#LN3546"><span class='Ref_To_Local'>chunk</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3320"><span class='Ref_to_Member'>freeptr</span></a> <span class='Operator'>&GT;= </span><a href="trigger.c.html#LN3545"><span class='Ref_To_Local'>needed</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3541"><span class='Ref_to_Parameter'>events</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3331"><span class='Ref_to_Member'>head</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="trigger.c.html#LN3541"><span class='Ref_to_Parameter'>events</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3331"><span class='Ref_to_Member'>head</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3546"><span class='Ref_To_Local'>chunk</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="trigger.c.html#LN3541"><span class='Ref_to_Parameter'>events</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3332"><span class='Ref_to_Member'>tail</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3319"><span class='Ref_to_Member'>next</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3546"><span class='Ref_To_Local'>chunk</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN3541"><span class='Ref_to_Parameter'>events</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3332"><span class='Ref_to_Member'>tail</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3546"><span class='Ref_To_Local'>chunk</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* events-&GT;tailfree is now out of sync, but we'll fix it below */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if chunk==NULL||chunk-&GT;e... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Try to locate a matching shared-data record already in the chunk. If 
     * none, make a new one. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3547"><span class='Ref_To_Local'>newshared</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="trigger.c.html#LN3268"><span class='Ref_to_Typedef'>AfterTriggerShared</span></a><span class='Parentheses'>) </span><a href="trigger.c.html#LN3546"><span class='Ref_To_Local'>chunk</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3322"><span class='Ref_to_Member'>endptr</span></a><span class='Parentheses'>)</span> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>         <span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>)</span> <a href="trigger.c.html#LN3547"><span class='Ref_To_Local'>newshared</span></a> <span class='Operator'>&GT;= </span><a href="trigger.c.html#LN3546"><span class='Ref_To_Local'>chunk</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3321"><span class='Ref_to_Member'>endfree</span></a><span class='Delimiter'>; 
</span>         <a href="trigger.c.html#LN3547"><span class='Ref_To_Local'>newshared</span></a><span class='Operator'>--</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3547"><span class='Ref_To_Local'>newshared</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3273"><span class='Ref_to_Member'>ats_tgoid</span></a> <span class='Operator'>== </span><a href="trigger.c.html#LN3542"><span class='Ref_to_Parameter'>evtshared</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3273"><span class='Ref_to_Member'>ats_tgoid</span></a> <span class='Operator'>&& 
</span>            <a href="trigger.c.html#LN3547"><span class='Ref_To_Local'>newshared</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3274"><span class='Ref_to_Member'>ats_relid</span></a> <span class='Operator'>== </span><a href="trigger.c.html#LN3542"><span class='Ref_to_Parameter'>evtshared</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3274"><span class='Ref_to_Member'>ats_relid</span></a> <span class='Operator'>&& 
</span>            <a href="trigger.c.html#LN3547"><span class='Ref_To_Local'>newshared</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3272"><span class='Ref_to_Member'>ats_event</span></a> <span class='Operator'>== </span><a href="trigger.c.html#LN3542"><span class='Ref_to_Parameter'>evtshared</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3272"><span class='Ref_to_Member'>ats_event</span></a> <span class='Operator'>&& 
</span>            <a href="trigger.c.html#LN3547"><span class='Ref_To_Local'>newshared</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3275"><span class='Ref_to_Member'>ats_firing_id</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="trigger.c.html#LN3547"><span class='Ref_To_Local'>newshared</span></a> <span class='Operator'>&LT; </span><a href="trigger.c.html#LN3546"><span class='Ref_To_Local'>chunk</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3321"><span class='Ref_to_Member'>endfree</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="trigger.c.html#LN3547"><span class='Ref_To_Local'>newshared</span></a> <span class='Operator'>= *</span><a href="trigger.c.html#LN3542"><span class='Ref_to_Parameter'>evtshared</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN3547"><span class='Ref_To_Local'>newshared</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3275"><span class='Ref_to_Member'>ats_firing_id</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* just to be sure */ 
</span>        <a href="trigger.c.html#LN3546"><span class='Ref_To_Local'>chunk</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3321"><span class='Ref_to_Member'>endfree</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="trigger.c.html#LN3547"><span class='Ref_To_Local'>newshared</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Insert the data */ 
</span>    <a href="trigger.c.html#LN3548"><span class='Ref_To_Local'>newevent</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3278"><span class='Ref_to_Typedef'>AfterTriggerEvent</span></a><span class='Parentheses'>) </span><a href="trigger.c.html#LN3546"><span class='Ref_To_Local'>chunk</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3320"><span class='Ref_to_Member'>freeptr</span></a><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="trigger.c.html#LN3548"><span class='Ref_To_Local'>newevent</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN3542"><span class='Ref_to_Parameter'>event</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN3544"><span class='Ref_To_Local'>eventsize</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* ... and link the new event to its shared record */ 
</span>    <a href="trigger.c.html#LN3548"><span class='Ref_To_Local'>newevent</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3282"><span class='Ref_to_Member'>ate_flags</span></a> <span class='Operator'>&= ~</span><a href="trigger.c.html#LN3257"><span class='Ref_to_Const'>AFTER_TRIGGER_OFFSET</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN3548"><span class='Ref_To_Local'>newevent</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3282"><span class='Ref_to_Member'>ate_flags</span></a> <span class='Operator'>|= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="trigger.c.html#LN3547"><span class='Ref_To_Local'>newshared</span></a> <span class='Operator'>- </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="trigger.c.html#LN3548"><span class='Ref_To_Local'>newevent</span></a><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN3546"><span class='Ref_To_Local'>chunk</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3320"><span class='Ref_to_Member'>freeptr</span></a> <span class='Operator'>+= </span><a href="trigger.c.html#LN3544"><span class='Ref_To_Local'>eventsize</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN3541"><span class='Ref_to_Parameter'>events</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3333"><span class='Ref_to_Member'>tailfree</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3546"><span class='Ref_To_Local'>chunk</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3320"><span class='Ref_to_Member'>freeptr</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end afterTriggerAddEvent &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * afterTriggerFreeEventList() 
 * 
 *  Free all the event storage in the given list. 
 * ---------- 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3656"></a><span class='Declare_Function'>afterTriggerFreeEventList</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3329"><span class='Ref_to_Struct'>AfterTriggerEventList</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>events</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3658"></a>    <a href="trigger.c.html#LN3317"><span class='Ref_to_Struct'>AfterTriggerEventChunk</span></a> <span class='Operator'>*</span><span class='Declare_Local'>chunk</span><span class='Delimiter'>; 
</span><a name="LN3659"></a>    <a href="trigger.c.html#LN3317"><span class='Ref_to_Struct'>AfterTriggerEventChunk</span></a> <span class='Operator'>*</span><span class='Declare_Local'>next_chunk</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3658"><span class='Ref_To_Local'>chunk</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3656"><span class='Ref_to_Parameter'>events</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3331"><span class='Ref_to_Member'>head</span></a><span class='Delimiter'>; </span><a href="trigger.c.html#LN3658"><span class='Ref_To_Local'>chunk</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="trigger.c.html#LN3658"><span class='Ref_To_Local'>chunk</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3659"><span class='Ref_To_Local'>next_chunk</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="trigger.c.html#LN3659"><span class='Ref_To_Local'>next_chunk</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3658"><span class='Ref_To_Local'>chunk</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3319"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; 
</span>        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3658"><span class='Ref_To_Local'>chunk</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="trigger.c.html#LN3656"><span class='Ref_to_Parameter'>events</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3331"><span class='Ref_to_Member'>head</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN3656"><span class='Ref_to_Parameter'>events</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3332"><span class='Ref_to_Member'>tail</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN3656"><span class='Ref_to_Parameter'>events</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3333"><span class='Ref_to_Member'>tailfree</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* ---------- 
 * afterTriggerRestoreEventList() 
 * 
 *  Restore an event list to its prior length, removing all the events 
 *  added since it had the value old_events. 
 * ---------- 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3679"></a><span class='Declare_Function'>afterTriggerRestoreEventList</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3329"><span class='Ref_to_Struct'>AfterTriggerEventList</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>events</span><span class='Delimiter'>, 
</span><a name="LN3680"></a>                             <span class='Keyword'>const </span><a href="trigger.c.html#LN3329"><span class='Ref_to_Struct'>AfterTriggerEventList</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>old_events</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3682"></a>    <a href="trigger.c.html#LN3317"><span class='Ref_to_Struct'>AfterTriggerEventChunk</span></a> <span class='Operator'>*</span><span class='Declare_Local'>chunk</span><span class='Delimiter'>; 
</span><a name="LN3683"></a>    <a href="trigger.c.html#LN3317"><span class='Ref_to_Struct'>AfterTriggerEventChunk</span></a> <span class='Operator'>*</span><span class='Declare_Local'>next_chunk</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3680"><span class='Ref_to_Parameter'>old_events</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3332"><span class='Ref_to_Member'>tail</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* restoring to a completely empty state, so free everything */ 
</span>        <a href="trigger.c.html#LN3655"><span class='Ref_to_Func'>afterTriggerFreeEventList</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3679"><span class='Ref_to_Parameter'>events</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="trigger.c.html#LN3679"><span class='Ref_to_Parameter'>events</span></a> <span class='Operator'>= *</span><a href="trigger.c.html#LN3680"><span class='Ref_to_Parameter'>old_events</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* free any chunks after the last one we want to keep */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3682"><span class='Ref_To_Local'>chunk</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3679"><span class='Ref_to_Parameter'>events</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3332"><span class='Ref_to_Member'>tail</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3319"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; </span><a href="trigger.c.html#LN3682"><span class='Ref_To_Local'>chunk</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="trigger.c.html#LN3682"><span class='Ref_To_Local'>chunk</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3683"><span class='Ref_To_Local'>next_chunk</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="trigger.c.html#LN3683"><span class='Ref_To_Local'>next_chunk</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3682"><span class='Ref_To_Local'>chunk</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3319"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; 
</span>            <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3682"><span class='Ref_To_Local'>chunk</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* and clean up the tail chunk to be the right length */ 
</span>        <a href="trigger.c.html#LN3679"><span class='Ref_to_Parameter'>events</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3332"><span class='Ref_to_Member'>tail</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3319"><span class='Ref_to_Member'>next</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN3679"><span class='Ref_to_Parameter'>events</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3332"><span class='Ref_to_Member'>tail</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3320"><span class='Ref_to_Member'>freeptr</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3679"><span class='Ref_to_Parameter'>events</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3333"><span class='Ref_to_Member'>tailfree</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We don't make any effort to remove now-unused shared data records. 
         * They might still be useful, anyway. 
         */ 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end afterTriggerRestoreEventList &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * AfterTriggerExecute() 
 * 
 *  Fetch the required tuples back from the heap and fire one 
 *  single trigger function. 
 * 
 *  Frequently, this will be fired many times in a row for triggers of 
 *  a single relation.  Therefore, we cache the open relation and provide 
 *  fmgr lookup cache space at the caller level.  (For triggers fired at 
 *  the end of a query, we can even piggyback on the executor's state.) 
 * 
 *  event: event currently being fired. 
 *  rel: open relation for event. 
 *  trigdesc: working copy of rel's trigger info. 
 *  finfo: array of fmgr lookup cache entries (one per trigger in trigdesc). 
 *  instr: array of EXPLAIN ANALYZE instrumentation nodes (one per trigger), 
 *      or NULL if no instrumentation is wanted. 
 *  per_tuple_context: memory context to call trigger function in. 
 *  trig_tuple_slot1: scratch slot for tg_trigtuple (foreign tables only) 
 *  trig_tuple_slot2: scratch slot for tg_newtuple (foreign tables only) 
 * ---------- 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3734"></a><span class='Declare_Function'>AfterTriggerExecute</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3278"><span class='Ref_to_Typedef'>AfterTriggerEvent</span></a> <span class='Declare_Parameter'>event</span><span class='Delimiter'>, 
</span><a name="LN3735"></a>                    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>trigdesc</span><span class='Delimiter'>, 
</span><a name="LN3736"></a>                    <a href="../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>finfo</span><span class='Delimiter'>, </span><a href="../../include/executor/instrument.h.html#LN43"><span class='Ref_to_Struct'>Instrumentation</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>instr</span><span class='Delimiter'>, 
</span><a name="LN3737"></a>                    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>per_tuple_context</span><span class='Delimiter'>, 
</span><a name="LN3738"></a>                    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>trig_tuple_slot1</span><span class='Delimiter'>, 
</span><a name="LN3739"></a>                    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>trig_tuple_slot2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3741"></a>    <a href="trigger.c.html#LN3268"><span class='Ref_to_Typedef'>AfterTriggerShared</span></a> <span class='Declare_Local'>evtshared</span> <span class='Operator'>= </span><a href="trigger.c.html#LN3307"><span class='Ref_to_Macro'>GetTriggerSharedData</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3734"><span class='Ref_to_Parameter'>event</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3742"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tgoid</span> <span class='Operator'>= </span><a href="trigger.c.html#LN3741"><span class='Ref_To_Local'>evtshared</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3273"><span class='Ref_to_Member'>ats_tgoid</span></a><span class='Delimiter'>; 
</span><a name="LN3743"></a>    <a href="../../include/commands/trigger.h.html#LN29"><span class='Ref_to_Struct'>TriggerData</span></a> <span class='Declare_Local'>LocTriggerData</span><span class='Delimiter'>; 
</span><a name="LN3744"></a>    <a href="../../include/access/htup.h.html#LN61"><span class='Ref_to_Struct'>HeapTupleData</span></a> <span class='Declare_Local'>tuple1</span><span class='Delimiter'>; 
</span><a name="LN3745"></a>    <a href="../../include/access/htup.h.html#LN61"><span class='Ref_to_Struct'>HeapTupleData</span></a> <span class='Declare_Local'>tuple2</span><span class='Delimiter'>; 
</span><a name="LN3746"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>rettuple</span><span class='Delimiter'>; 
</span><a name="LN3747"></a>    <a href="../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>buffer1</span> <span class='Operator'>= </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span><a name="LN3748"></a>    <a href="../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>buffer2</span> <span class='Operator'>= </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span><a name="LN3749"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>tgindx</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Locate trigger in trigdesc. 
     */ 
</span>    <a href="trigger.c.html#LN3743"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN36"><span class='Ref_to_Member'>tg_trigger</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3749"><span class='Ref_To_Local'>tgindx</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="trigger.c.html#LN3749"><span class='Ref_To_Local'>tgindx</span></a> <span class='Operator'>&LT; </span><a href="trigger.c.html#LN3735"><span class='Ref_to_Parameter'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN48"><span class='Ref_to_Member'>numtriggers</span></a><span class='Delimiter'>; </span><a href="trigger.c.html#LN3749"><span class='Ref_To_Local'>tgindx</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3735"><span class='Ref_to_Parameter'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN47"><span class='Ref_to_Member'>triggers</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN3749"><span class='Ref_To_Local'>tgindx</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/utils/reltrigger.h.html#LN24"><span class='Ref_to_Member'>tgoid</span></a> <span class='Operator'>== </span><a href="trigger.c.html#LN3742"><span class='Ref_To_Local'>tgoid</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="trigger.c.html#LN3743"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN36"><span class='Ref_to_Member'>tg_trigger</span></a> <span class='Operator'>= &</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3735"><span class='Ref_to_Parameter'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN47"><span class='Ref_to_Member'>triggers</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN3749"><span class='Ref_To_Local'>tgindx</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3743"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN36"><span class='Ref_to_Member'>tg_trigger</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not find trigger %u"</span><span class='Delimiter'>, </span><a href="trigger.c.html#LN3742"><span class='Ref_To_Local'>tgoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If doing EXPLAIN ANALYZE, start charging time to this trigger. We want 
     * to include time spent re-fetching tuples in the trigger cost. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3736"><span class='Ref_to_Parameter'>instr</span></a><span class='Parentheses'>) 
</span>        <a href="../executor/instrument.c.html#LN61"><span class='Ref_to_Func'>InstrStartNode</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3736"><span class='Ref_to_Parameter'>instr</span></a> <span class='Operator'>+ </span><a href="trigger.c.html#LN3749"><span class='Ref_To_Local'>tgindx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Fetch the required tuple(s). 
     */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3734"><span class='Ref_to_Parameter'>event</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3282"><span class='Ref_to_Member'>ate_flags</span></a> <span class='Operator'>& </span><a href="trigger.c.html#LN3266"><span class='Ref_to_Const'>AFTER_TRIGGER_TUP_BITS</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="trigger.c.html#LN3263"><span class='Ref_to_Const'>AFTER_TRIGGER_FDW_FETCH</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN3780"></a>                <a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fdw_tuplestore</span> <span class='Operator'>= 
</span>                <a href="trigger.c.html#LN3450"><span class='Ref_to_Func'>GetTriggerTransitionTuplestore</span></a> 
                <span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3414"><span class='Ref_to_Member'>fdw_tuplestores</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/tuplestore.h.html#LN72"><span class='Ref_to_Proto'>tuplestore_gettupleslot</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3780"><span class='Ref_To_Local'>fdw_tuplestore</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                             <a href="trigger.c.html#LN3738"><span class='Ref_to_Parameter'>trig_tuple_slot1</span></a><span class='Parentheses'>))</span> 
                    <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"failed to fetch tuple1 for AFTER trigger"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="trigger.c.html#LN3741"><span class='Ref_To_Local'>evtshared</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3272"><span class='Ref_to_Member'>ats_event</span></a> <span class='Operator'>& </span><a href="../../include/commands/trigger.h.html#LN55"><span class='Ref_to_Const'>TRIGGER_EVENT_OPMASK</span></a><span class='Parentheses'>) </span><span class='Operator'>== 
</span>                    <a href="../../include/commands/trigger.h.html#LN53"><span class='Ref_to_Const'>TRIGGER_EVENT_UPDATE</span></a> <span class='Operator'>&& 
</span>                    <span class='Operator'>!</span><a href="../../include/utils/tuplestore.h.html#LN72"><span class='Ref_to_Proto'>tuplestore_gettupleslot</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3780"><span class='Ref_To_Local'>fdw_tuplestore</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                             <a href="trigger.c.html#LN3739"><span class='Ref_to_Parameter'>trig_tuple_slot2</span></a><span class='Parentheses'>))</span> 
                    <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"failed to fetch tuple2 for AFTER trigger"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Comment_Multi_Line'>/* fall through */ 
</span>        <span class='Control'>case</span> <a href="trigger.c.html#LN3262"><span class='Ref_to_Const'>AFTER_TRIGGER_FDW_REUSE</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Using ExecMaterializeSlot() rather than ExecFetchSlotTuple() 
             * ensures that tg_trigtuple does not reference tuplestore memory. 
             * (It is formally possible for the trigger function to queue 
             * trigger events that add to the same tuplestore, which can push 
             * other tuples out of memory.)  The distinction is academic, 
             * because we start with a minimal tuple that ExecFetchSlotTuple() 
             * must materialize anyway. 
             */ 
</span>            <a href="trigger.c.html#LN3743"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN34"><span class='Ref_to_Member'>tg_trigtuple</span></a> <span class='Operator'>= 
</span>                <a href="../../include/executor/tuptable.h.html#LN162"><span class='Ref_to_Proto'>ExecMaterializeSlot</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3738"><span class='Ref_to_Parameter'>trig_tuple_slot1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="trigger.c.html#LN3743"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN37"><span class='Ref_to_Member'>tg_trigtuplebuf</span></a> <span class='Operator'>= </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span> 
            <a href="trigger.c.html#LN3743"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN35"><span class='Ref_to_Member'>tg_newtuple</span></a> <span class='Operator'>= 
</span>                <span class='Parentheses'>((</span><a href="trigger.c.html#LN3741"><span class='Ref_To_Local'>evtshared</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3272"><span class='Ref_to_Member'>ats_event</span></a> <span class='Operator'>& </span><a href="../../include/commands/trigger.h.html#LN55"><span class='Ref_to_Const'>TRIGGER_EVENT_OPMASK</span></a><span class='Parentheses'>) </span><span class='Operator'>== 
</span>                 <a href="../../include/commands/trigger.h.html#LN53"><span class='Ref_to_Const'>TRIGGER_EVENT_UPDATE</span></a><span class='Parentheses'>)</span> <span class='Operator'>? 
</span>                <a href="../../include/executor/tuptable.h.html#LN162"><span class='Ref_to_Proto'>ExecMaterializeSlot</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3739"><span class='Ref_to_Parameter'>trig_tuple_slot2</span></a><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="trigger.c.html#LN3743"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN38"><span class='Ref_to_Member'>tg_newtuplebuf</span></a> <span class='Operator'>= </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/storage/itemptr.h.html#LN58"><span class='Ref_to_Macro'>ItemPointerIsValid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3734"><span class='Ref_to_Parameter'>event</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3283"><span class='Ref_to_Member'>ate_ctid1</span></a><span class='Parentheses'>)))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../include/storage/itemptr.h.html#LN137"><span class='Ref_to_Macro'>ItemPointerCopy</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3734"><span class='Ref_to_Parameter'>event</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3283"><span class='Ref_to_Member'>ate_ctid1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3744"><span class='Ref_To_Local'>tuple1</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/heapam.h.html#LN134"><span class='Ref_to_Proto'>heap_fetch</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3735"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/utils/tqual.h.html#LN27"><span class='Ref_to_Const'>SnapshotAny</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="trigger.c.html#LN3744"><span class='Ref_To_Local'>tuple1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="trigger.c.html#LN3747"><span class='Ref_To_Local'>buffer1</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
                    <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"failed to fetch tuple1 for AFTER trigger"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="trigger.c.html#LN3743"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN34"><span class='Ref_to_Member'>tg_trigtuple</span></a> <span class='Operator'>= &</span><a href="trigger.c.html#LN3744"><span class='Ref_To_Local'>tuple1</span></a><span class='Delimiter'>; 
</span>                <a href="trigger.c.html#LN3743"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN37"><span class='Ref_to_Member'>tg_trigtuplebuf</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3747"><span class='Ref_To_Local'>buffer1</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="trigger.c.html#LN3743"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN34"><span class='Ref_to_Member'>tg_trigtuple</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <a href="trigger.c.html#LN3743"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN37"><span class='Ref_to_Member'>tg_trigtuplebuf</span></a> <span class='Operator'>= </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* don't touch ctid2 if not there */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="trigger.c.html#LN3734"><span class='Ref_to_Parameter'>event</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3282"><span class='Ref_to_Member'>ate_flags</span></a> <span class='Operator'>& </span><a href="trigger.c.html#LN3266"><span class='Ref_to_Const'>AFTER_TRIGGER_TUP_BITS</span></a><span class='Parentheses'>)</span> <span class='Operator'>== 
</span>                <a href="trigger.c.html#LN3265"><span class='Ref_to_Const'>AFTER_TRIGGER_2CTID</span></a> <span class='Operator'>&& 
</span>                <a href="../../include/storage/itemptr.h.html#LN58"><span class='Ref_to_Macro'>ItemPointerIsValid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3734"><span class='Ref_to_Parameter'>event</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3284"><span class='Ref_to_Member'>ate_ctid2</span></a><span class='Parentheses'>)))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../include/storage/itemptr.h.html#LN137"><span class='Ref_to_Macro'>ItemPointerCopy</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3734"><span class='Ref_to_Parameter'>event</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3284"><span class='Ref_to_Member'>ate_ctid2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3745"><span class='Ref_To_Local'>tuple2</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/heapam.h.html#LN134"><span class='Ref_to_Proto'>heap_fetch</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3735"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/utils/tqual.h.html#LN27"><span class='Ref_to_Const'>SnapshotAny</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="trigger.c.html#LN3745"><span class='Ref_To_Local'>tuple2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="trigger.c.html#LN3748"><span class='Ref_To_Local'>buffer2</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
                    <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"failed to fetch tuple2 for AFTER trigger"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="trigger.c.html#LN3743"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN35"><span class='Ref_to_Member'>tg_newtuple</span></a> <span class='Operator'>= &</span><a href="trigger.c.html#LN3745"><span class='Ref_To_Local'>tuple2</span></a><span class='Delimiter'>; 
</span>                <a href="trigger.c.html#LN3743"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN38"><span class='Ref_to_Member'>tg_newtuplebuf</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3748"><span class='Ref_To_Local'>buffer2</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="trigger.c.html#LN3743"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN35"><span class='Ref_to_Member'>tg_newtuple</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <a href="trigger.c.html#LN3743"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN38"><span class='Ref_to_Member'>tg_newtuplebuf</span></a> <span class='Operator'>= </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch event-&GT;ate_flags&AFTE... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Set up the tuplestore information. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3743"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN36"><span class='Ref_to_Member'>tg_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN41"><span class='Ref_to_Member'>tgoldtable</span></a><span class='Parentheses'>) 
</span>        <a href="trigger.c.html#LN3743"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN39"><span class='Ref_to_Member'>tg_oldtable</span></a> <span class='Operator'>= 
</span>            <a href="trigger.c.html#LN3450"><span class='Ref_to_Func'>GetTriggerTransitionTuplestore</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3416"><span class='Ref_to_Member'>old_tuplestores</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="trigger.c.html#LN3743"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN39"><span class='Ref_to_Member'>tg_oldtable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3743"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN36"><span class='Ref_to_Member'>tg_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN42"><span class='Ref_to_Member'>tgnewtable</span></a><span class='Parentheses'>) 
</span>        <a href="trigger.c.html#LN3743"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN40"><span class='Ref_to_Member'>tg_newtable</span></a> <span class='Operator'>= 
</span>            <a href="trigger.c.html#LN3450"><span class='Ref_to_Func'>GetTriggerTransitionTuplestore</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3417"><span class='Ref_to_Member'>new_tuplestores</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="trigger.c.html#LN3743"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN40"><span class='Ref_to_Member'>tg_newtable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Setup the remaining trigger information 
     */ 
</span>    <a href="trigger.c.html#LN3743"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN31"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN490"><span class='Ref_to_EnumConst'>T_TriggerData</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN3743"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a> <span class='Operator'>= 
</span>        <a href="trigger.c.html#LN3741"><span class='Ref_To_Local'>evtshared</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3272"><span class='Ref_to_Member'>ats_event</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><a href="../../include/commands/trigger.h.html#LN55"><span class='Ref_to_Const'>TRIGGER_EVENT_OPMASK</span></a> <span class='Operator'>| </span><a href="../../include/commands/trigger.h.html#LN57"><span class='Ref_to_Const'>TRIGGER_EVENT_ROW</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN3743"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN33"><span class='Ref_to_Member'>tg_relation</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3735"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/memutils.h.html#LN73"><span class='Ref_to_Proto'>MemoryContextReset</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3737"><span class='Ref_to_Parameter'>per_tuple_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Call the trigger and throw away any possibly returned updated tuple. 
     * (Don't let ExecCallTriggerFunc measure EXPLAIN time.) 
     */ 
</span>    <a href="trigger.c.html#LN3746"><span class='Ref_To_Local'>rettuple</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN90"><span class='Ref_to_Proto'>ExecCallTriggerFunc</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN3743"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Delimiter'>, 
</span>                                   <a href="trigger.c.html#LN3749"><span class='Ref_To_Local'>tgindx</span></a><span class='Delimiter'>, 
</span>                                   <a href="trigger.c.html#LN3736"><span class='Ref_to_Parameter'>finfo</span></a><span class='Delimiter'>, 
</span>                                   <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                   <a href="trigger.c.html#LN3737"><span class='Ref_to_Parameter'>per_tuple_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3746"><span class='Ref_To_Local'>rettuple</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>        <a href="trigger.c.html#LN3746"><span class='Ref_To_Local'>rettuple</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN3743"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN34"><span class='Ref_to_Member'>tg_trigtuple</span></a> <span class='Operator'>&& 
</span>        <a href="trigger.c.html#LN3746"><span class='Ref_To_Local'>rettuple</span></a> <span class='Operator'>!= </span><a href="trigger.c.html#LN3743"><span class='Ref_To_Local'>LocTriggerData</span></a><span class='Operator'>.</span><a href="../../include/commands/trigger.h.html#LN35"><span class='Ref_to_Member'>tg_newtuple</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3746"><span class='Ref_To_Local'>rettuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Release buffers 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3747"><span class='Ref_To_Local'>buffer1</span></a> <span class='Operator'>!= </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/storage/bufmgr.h.html#LN174"><span class='Ref_to_Proto'>ReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3747"><span class='Ref_To_Local'>buffer1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3748"><span class='Ref_To_Local'>buffer2</span></a> <span class='Operator'>!= </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/storage/bufmgr.h.html#LN174"><span class='Ref_to_Proto'>ReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3748"><span class='Ref_To_Local'>buffer2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If doing EXPLAIN ANALYZE, stop charging time to this trigger, and count 
     * one "tuple returned" (really the number of firings). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3736"><span class='Ref_to_Parameter'>instr</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/executor/instrument.h.html#LN76"><span class='Ref_to_Proto'>InstrStopNode</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3736"><span class='Ref_to_Parameter'>instr</span></a> <span class='Operator'>+ </span><a href="trigger.c.html#LN3749"><span class='Ref_To_Local'>tgindx</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AfterTriggerExecute &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * afterTriggerMarkEvents() 
 * 
 *  Scan the given event list for not yet invoked events.  Mark the ones 
 *  that can be invoked now with the current firing ID. 
 * 
 *  If move_list isn't NULL, events that are not to be invoked now are 
 *  transferred to move_list. 
 * 
 *  When immediate_only is TRUE, do not invoke currently-deferred triggers. 
 *  (This will be FALSE only at main transaction exit.) 
 * 
 *  Returns TRUE if any invokable events were found. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN3921"></a><span class='Declare_Function'>afterTriggerMarkEvents</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3329"><span class='Ref_to_Struct'>AfterTriggerEventList</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>events</span><span class='Delimiter'>, 
</span><a name="LN3922"></a>                       <a href="trigger.c.html#LN3329"><span class='Ref_to_Struct'>AfterTriggerEventList</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>move_list</span><span class='Delimiter'>, 
</span><a name="LN3923"></a>                       <span class='Keyword'>bool </span><span class='Declare_Parameter'>immediate_only</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3925"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN3926"></a>    <a href="trigger.c.html#LN3278"><span class='Ref_to_Typedef'>AfterTriggerEvent</span></a> <span class='Declare_Local'>event</span><span class='Delimiter'>; 
</span><a name="LN3927"></a>    <a href="trigger.c.html#LN3317"><span class='Ref_to_Struct'>AfterTriggerEventChunk</span></a> <span class='Operator'>*</span><span class='Declare_Local'>chunk</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN3344"><span class='Ref_to_Macro'>for_each_event_chunk</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3926"><span class='Ref_To_Local'>event</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN3927"><span class='Ref_To_Local'>chunk</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="trigger.c.html#LN3921"><span class='Ref_to_Parameter'>events</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3931"></a>        <a href="trigger.c.html#LN3268"><span class='Ref_to_Typedef'>AfterTriggerShared</span></a> <span class='Declare_Local'>evtshared</span> <span class='Operator'>= </span><a href="trigger.c.html#LN3307"><span class='Ref_to_Macro'>GetTriggerSharedData</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3926"><span class='Ref_To_Local'>event</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3932"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>defer_it</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3926"><span class='Ref_To_Local'>event</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3282"><span class='Ref_to_Member'>ate_flags</span></a> <span class='Operator'>& 
</span>              <span class='Parentheses'>(</span><a href="trigger.c.html#LN3259"><span class='Ref_to_Const'>AFTER_TRIGGER_DONE</span></a> <span class='Operator'>| </span><a href="trigger.c.html#LN3260"><span class='Ref_to_Const'>AFTER_TRIGGER_IN_PROGRESS</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * This trigger hasn't been called or scheduled yet. Check if we 
             * should call it now. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3923"><span class='Ref_to_Parameter'>immediate_only</span></a> <span class='Operator'>&& </span><a href="trigger.c.html#LN3494"><span class='Ref_to_Func'>afterTriggerCheckState</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3931"><span class='Ref_To_Local'>evtshared</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="trigger.c.html#LN3932"><span class='Ref_To_Local'>defer_it</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Mark it as to be fired in this firing cycle. 
                 */ 
</span>                <a href="trigger.c.html#LN3931"><span class='Ref_To_Local'>evtshared</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3275"><span class='Ref_to_Member'>ats_firing_id</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3409"><span class='Ref_to_Member'>firing_counter</span></a><span class='Delimiter'>; 
</span>                <a href="trigger.c.html#LN3926"><span class='Ref_To_Local'>event</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3282"><span class='Ref_to_Member'>ate_flags</span></a> <span class='Operator'>|= </span><a href="trigger.c.html#LN3260"><span class='Ref_to_Const'>AFTER_TRIGGER_IN_PROGRESS</span></a><span class='Delimiter'>; 
</span>                <a href="trigger.c.html#LN3925"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !(event-&GT;ate_flags&(A... &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * If it's deferred, move it to move_list, if requested. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3932"><span class='Ref_To_Local'>defer_it</span></a> <span class='Operator'>&& </span><a href="trigger.c.html#LN3922"><span class='Ref_to_Parameter'>move_list</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* add it to move_list */ 
</span>            <a href="trigger.c.html#LN3540"><span class='Ref_to_Func'>afterTriggerAddEvent</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3922"><span class='Ref_to_Parameter'>move_list</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN3926"><span class='Ref_To_Local'>event</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN3931"><span class='Ref_To_Local'>evtshared</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* mark original copy "done" so we don't do it again */ 
</span>            <a href="trigger.c.html#LN3926"><span class='Ref_To_Local'>event</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3282"><span class='Ref_to_Member'>ate_flags</span></a> <span class='Operator'>|= </span><a href="trigger.c.html#LN3259"><span class='Ref_to_Const'>AFTER_TRIGGER_DONE</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="trigger.c.html#LN3925"><span class='Ref_To_Local'>found</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end afterTriggerMarkEvents &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * afterTriggerInvokeEvents() 
 * 
 *  Scan the given event list for events that are marked as to be fired 
 *  in the current firing cycle, and fire them. 
 * 
 *  If estate isn't NULL, we use its result relation info to avoid repeated 
 *  openings and closing of trigger target relations.  If it is NULL, we 
 *  make one locally to cache the info in case there are multiple trigger 
 *  events per rel. 
 * 
 *  When delete_ok is TRUE, it's safe to delete fully-processed events. 
 *  (We are not very tense about that: we simply reset a chunk to be empty 
 *  if all its events got fired.  The objective here is just to avoid useless 
 *  rescanning of events when a trigger queues new events during transaction 
 *  end, so it's not necessary to worry much about the case where only 
 *  some events are fired.) 
 * 
 *  Returns TRUE if no unfired events remain in the list (this allows us 
 *  to avoid repeating afterTriggerMarkEvents). 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN3993"></a><span class='Declare_Function'>afterTriggerInvokeEvents</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3329"><span class='Ref_to_Struct'>AfterTriggerEventList</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>events</span><span class='Delimiter'>, 
</span><a name="LN3994"></a>                         <a href="../../include/c.h.html#LN410"><span class='Ref_to_Typedef'>CommandId</span></a> <span class='Declare_Parameter'>firing_id</span><span class='Delimiter'>, 
</span><a name="LN3995"></a>                         <a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN3996"></a>                         <span class='Keyword'>bool </span><span class='Declare_Parameter'>delete_ok</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3998"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>all_fired</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span><a name="LN3999"></a>    <a href="trigger.c.html#LN3317"><span class='Ref_to_Struct'>AfterTriggerEventChunk</span></a> <span class='Operator'>*</span><span class='Declare_Local'>chunk</span><span class='Delimiter'>; 
</span><a name="LN4000"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>per_tuple_context</span><span class='Delimiter'>; 
</span><a name="LN4001"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>local_estate</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN4002"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN4003"></a>    <a href="../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a> <span class='Operator'>*</span><span class='Declare_Local'>trigdesc</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN4004"></a>    <a href="../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>finfo</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN4005"></a>    <a href="../../include/executor/instrument.h.html#LN43"><span class='Ref_to_Struct'>Instrumentation</span></a> <span class='Operator'>*</span><span class='Declare_Local'>instr</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN4006"></a>    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>slot1</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span><a name="LN4007"></a>               <span class='Operator'>*</span><span class='Declare_Local'>slot2</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make a local EState if need be */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3995"><span class='Ref_to_Parameter'>estate</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="trigger.c.html#LN3995"><span class='Ref_to_Parameter'>estate</span></a> <span class='Operator'>= </span><a href="../executor/execUtils.c.html#LN78"><span class='Ref_to_Func'>CreateExecutorState</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN4001"><span class='Ref_To_Local'>local_estate</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Make a per-tuple memory context for trigger function calls */ 
</span>    <a href="trigger.c.html#LN4000"><span class='Ref_To_Local'>per_tuple_context</span></a> <span class='Operator'>= 
</span>        <a href="../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, 
</span>                              <span class='String'>"AfterTriggerTupleContext"</span><span class='Delimiter'>, 
</span>                              <a href="../../include/utils/memutils.h.html#LN164"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN3337"><span class='Ref_to_Macro'>for_each_chunk</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3999"><span class='Ref_To_Local'>chunk</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="trigger.c.html#LN3993"><span class='Ref_to_Parameter'>events</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4024"></a>        <a href="trigger.c.html#LN3278"><span class='Ref_to_Typedef'>AfterTriggerEvent</span></a> <span class='Declare_Local'>event</span><span class='Delimiter'>; 
</span><a name="LN4025"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>all_fired_in_chunk</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <a href="trigger.c.html#LN3339"><span class='Ref_to_Macro'>for_each_event</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4024"><span class='Ref_To_Local'>event</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN3999"><span class='Ref_To_Local'>chunk</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN4029"></a>            <a href="trigger.c.html#LN3268"><span class='Ref_to_Typedef'>AfterTriggerShared</span></a> <span class='Declare_Local'>evtshared</span> <span class='Operator'>= </span><a href="trigger.c.html#LN3307"><span class='Ref_to_Macro'>GetTriggerSharedData</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4024"><span class='Ref_To_Local'>event</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Is it one for me to fire? 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="trigger.c.html#LN4024"><span class='Ref_To_Local'>event</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3282"><span class='Ref_to_Member'>ate_flags</span></a> <span class='Operator'>& </span><a href="trigger.c.html#LN3260"><span class='Ref_to_Const'>AFTER_TRIGGER_IN_PROGRESS</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                <a href="trigger.c.html#LN4029"><span class='Ref_To_Local'>evtshared</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3275"><span class='Ref_to_Member'>ats_firing_id</span></a> <span class='Operator'>== </span><a href="trigger.c.html#LN3994"><span class='Ref_to_Parameter'>firing_id</span></a><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * So let's fire it... but first, find the correct relation if 
                 * this is not the same relation as before. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN4002"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4002"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="trigger.c.html#LN4029"><span class='Ref_To_Local'>evtshared</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3274"><span class='Ref_to_Member'>ats_relid</span></a><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span><a name="LN4043"></a>                    <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rInfo</span><span class='Delimiter'>; 
</span> 
                    <a href="trigger.c.html#LN4043"><span class='Ref_To_Local'>rInfo</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN185"><span class='Ref_to_Proto'>ExecGetTriggerResultRel</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3995"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN4029"><span class='Ref_To_Local'>evtshared</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3274"><span class='Ref_to_Member'>ats_relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="trigger.c.html#LN4002"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN4043"><span class='Ref_To_Local'>rInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>; 
</span>                    <a href="trigger.c.html#LN4003"><span class='Ref_To_Local'>trigdesc</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN4043"><span class='Ref_To_Local'>rInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a><span class='Delimiter'>; 
</span>                    <a href="trigger.c.html#LN4004"><span class='Ref_To_Local'>finfo</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN4043"><span class='Ref_To_Local'>rInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN378"><span class='Ref_to_Member'>ri_TrigFunctions</span></a><span class='Delimiter'>; 
</span>                    <a href="trigger.c.html#LN4005"><span class='Ref_To_Local'>instr</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN4043"><span class='Ref_To_Local'>rInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN380"><span class='Ref_to_Member'>ri_TrigInstrument</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN4002"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN4006"><span class='Ref_To_Local'>slot1</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <a href="../../include/executor/tuptable.h.html#LN145"><span class='Ref_to_Proto'>ExecDropSingleTupleTableSlot</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4006"><span class='Ref_To_Local'>slot1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <a href="../../include/executor/tuptable.h.html#LN145"><span class='Ref_to_Proto'>ExecDropSingleTupleTableSlot</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4007"><span class='Ref_To_Local'>slot2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                        <a href="trigger.c.html#LN4006"><span class='Ref_To_Local'>slot1</span></a> <span class='Operator'>= </span><a href="../../include/executor/tuptable.h.html#LN144"><span class='Ref_to_Proto'>MakeSingleTupleTableSlot</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4002"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="trigger.c.html#LN4007"><span class='Ref_To_Local'>slot2</span></a> <span class='Operator'>= </span><a href="../../include/executor/tuptable.h.html#LN144"><span class='Ref_to_Proto'>MakeSingleTupleTableSlot</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4002"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN4003"><span class='Ref_To_Local'>trigdesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span>       <span class='Comment_Single_Line'>/* should not happen */ 
</span>                        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"relation %u has no triggers"</span><span class='Delimiter'>, 
</span>                             <a href="trigger.c.html#LN4029"><span class='Ref_To_Local'>evtshared</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3274"><span class='Ref_to_Member'>ats_relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if rel==NULL||RelationGe... &raquo; </span> 
 
                <span class='Comment_Multi_Line'>/* 
                 * Fire it.  Note that the AFTER_TRIGGER_IN_PROGRESS flag is 
                 * still set, so recursive examinations of the event list 
                 * won't try to re-fire it. 
                 */ 
</span>                <a href="trigger.c.html#LN3432"><span class='Ref_to_Proto'>AfterTriggerExecute</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4024"><span class='Ref_To_Local'>event</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN4002"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN4003"><span class='Ref_To_Local'>trigdesc</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN4004"><span class='Ref_To_Local'>finfo</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN4005"><span class='Ref_To_Local'>instr</span></a><span class='Delimiter'>, 
</span>                                    <a href="trigger.c.html#LN4000"><span class='Ref_To_Local'>per_tuple_context</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN4006"><span class='Ref_To_Local'>slot1</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN4007"><span class='Ref_To_Local'>slot2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Mark the event as done. 
                 */ 
</span>                <a href="trigger.c.html#LN4024"><span class='Ref_To_Local'>event</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3282"><span class='Ref_to_Member'>ate_flags</span></a> <span class='Operator'>&= ~</span><a href="trigger.c.html#LN3260"><span class='Ref_to_Const'>AFTER_TRIGGER_IN_PROGRESS</span></a><span class='Delimiter'>; 
</span>                <a href="trigger.c.html#LN4024"><span class='Ref_To_Local'>event</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3282"><span class='Ref_to_Member'>ate_flags</span></a> <span class='Operator'>|= </span><a href="trigger.c.html#LN3259"><span class='Ref_to_Const'>AFTER_TRIGGER_DONE</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if (event-&GT;ate_flags&AFT... &raquo; </span> 
            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN4024"><span class='Ref_To_Local'>event</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3282"><span class='Ref_to_Member'>ate_flags</span></a> <span class='Operator'>& </span><a href="trigger.c.html#LN3259"><span class='Ref_to_Const'>AFTER_TRIGGER_DONE</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* something remains to be done */ 
</span>                <a href="trigger.c.html#LN3998"><span class='Ref_To_Local'>all_fired</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN4025"><span class='Ref_To_Local'>all_fired_in_chunk</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Clear the chunk if delete_ok and nothing left of interest */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3996"><span class='Ref_to_Parameter'>delete_ok</span></a> <span class='Operator'>&& </span><a href="trigger.c.html#LN4025"><span class='Ref_To_Local'>all_fired_in_chunk</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="trigger.c.html#LN3999"><span class='Ref_To_Local'>chunk</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3320"><span class='Ref_to_Member'>freeptr</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3326"><span class='Ref_to_Macro'>CHUNK_DATA_START</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3999"><span class='Ref_To_Local'>chunk</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="trigger.c.html#LN3999"><span class='Ref_To_Local'>chunk</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3321"><span class='Ref_to_Member'>endfree</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3999"><span class='Ref_To_Local'>chunk</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3322"><span class='Ref_to_Member'>endptr</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If it's last chunk, must sync event list's tailfree too.  Note 
             * that delete_ok must NOT be passed as true if there could be 
             * stacked AfterTriggerEventList values pointing at this event 
             * list, since we'd fail to fix their copies of tailfree. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3999"><span class='Ref_To_Local'>chunk</span></a> <span class='Operator'>== </span><a href="trigger.c.html#LN3993"><span class='Ref_to_Parameter'>events</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3332"><span class='Ref_to_Member'>tail</span></a><span class='Parentheses'>) 
</span>                <a href="trigger.c.html#LN3993"><span class='Ref_to_Parameter'>events</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3333"><span class='Ref_to_Member'>tailfree</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3999"><span class='Ref_To_Local'>chunk</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3320"><span class='Ref_to_Member'>freeptr</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN4006"><span class='Ref_To_Local'>slot1</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/executor/tuptable.h.html#LN145"><span class='Ref_to_Proto'>ExecDropSingleTupleTableSlot</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4006"><span class='Ref_To_Local'>slot1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/executor/tuptable.h.html#LN145"><span class='Ref_to_Proto'>ExecDropSingleTupleTableSlot</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4007"><span class='Ref_To_Local'>slot2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Release working resources */ 
</span>    <a href="../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4000"><span class='Ref_To_Local'>per_tuple_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN4001"><span class='Ref_To_Local'>local_estate</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/executor/executor.h.html#LN186"><span class='Ref_to_Proto'>ExecCleanUpTriggerState</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3995"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../executor/execUtils.c.html#LN176"><span class='Ref_to_Func'>FreeExecutorState</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3995"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="trigger.c.html#LN3998"><span class='Ref_To_Local'>all_fired</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end afterTriggerInvokeEvents &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * AfterTriggerBeginXact() 
 * 
 *  Called at transaction start (either BEGIN or implicit for single 
 *  statement outside of transaction block). 
 * ---------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN4129"></a><span class='Declare_Function'>AfterTriggerBeginXact</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * Initialize after-trigger state structure to empty 
     */ 
</span>    <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3409"><span class='Ref_to_Member'>firing_counter</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN410"><span class='Ref_to_Typedef'>CommandId</span></a><span class='Parentheses'>) </span><span class='Number'>1</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* mustn't be 0 */ 
</span>    <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Verify that there is no leftover state remaining.  If these assertions 
     * trip, it means that AfterTriggerEndXact wasn't called or didn't clean 
     * up properly. 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3410"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3413"><span class='Ref_to_Member'>query_stack</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3414"><span class='Ref_to_Member'>fdw_tuplestores</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3416"><span class='Ref_to_Member'>old_tuplestores</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3417"><span class='Ref_to_Member'>new_tuplestores</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3418"><span class='Ref_to_Member'>maxquerydepth</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3419"><span class='Ref_to_Member'>event_cxt</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3411"><span class='Ref_to_Member'>events</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3331"><span class='Ref_to_Member'>head</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3423"><span class='Ref_to_Member'>state_stack</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3424"><span class='Ref_to_Member'>events_stack</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3425"><span class='Ref_to_Member'>depth_stack</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3426"><span class='Ref_to_Member'>firing_stack</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3427"><span class='Ref_to_Member'>maxtransdepth</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AfterTriggerBeginXact &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * AfterTriggerBeginQuery() 
 * 
 *  Called just before we start processing a single query within a 
 *  transaction (or subtransaction).  Most of the real work gets deferred 
 *  until somebody actually tries to queue a trigger event. 
 * ---------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN4167"></a><span class='Declare_Function'>AfterTriggerBeginQuery</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Increase the query stack depth */ 
</span>    <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * AfterTriggerEndQuery() 
 * 
 *  Called after one query has been completely processed. At this time 
 *  we invoke all AFTER IMMEDIATE trigger events queued by the query, and 
 *  transfer deferred trigger events to the global deferred-trigger list. 
 * 
 *  Note that this must be called BEFORE closing down the executor 
 *  with ExecutorEnd, because we make use of the EState's info about 
 *  target relations.  Normally it is called from ExecutorFinish. 
 * ---------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN4187"></a><span class='Declare_Function'>AfterTriggerEndQuery</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4189"></a>    <a href="trigger.c.html#LN3329"><span class='Ref_to_Struct'>AfterTriggerEventList</span></a> <span class='Operator'>*</span><span class='Declare_Local'>events</span><span class='Delimiter'>; 
</span><a name="LN4190"></a>    <a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fdw_tuplestore</span><span class='Delimiter'>; 
</span><a name="LN4191"></a>    <a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Declare_Local'>old_tuplestore</span><span class='Delimiter'>; 
</span><a name="LN4192"></a>    <a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Declare_Local'>new_tuplestore</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Must be inside a query, too */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we never even got as far as initializing the event stack, there 
     * certainly won't be any events, so exit quickly. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a> <span class='Operator'>&GT;= </span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3418"><span class='Ref_to_Member'>maxquerydepth</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Process all immediate-mode triggers queued by the query, and move the 
     * deferred ones to the main list of deferred events. 
     * 
     * Notice that we decide which ones will be fired, and put the deferred 
     * ones on the main list, before anything is actually fired.  This ensures 
     * reasonably sane behavior if a trigger function does SET CONSTRAINTS ... 
     * IMMEDIATE: all events we have decided to defer will be available for it 
     * to fire. 
     * 
     * We loop in case a trigger queues more events at the same query level. 
     * Ordinary trigger functions, including all PL/pgSQL trigger functions, 
     * will instead fire any triggers in a dedicated query level.  Foreign key 
     * enforcement triggers do add to the current query level, thanks to their 
     * passing fire_triggers = false to SPI_execute_snapshot().  Other 
     * C-language triggers might do likewise.  Be careful here: firing a 
     * trigger could result in query_stack being repalloc'd, so we can't save 
     * its address across afterTriggerInvokeEvents calls. 
     * 
     * If we find no firable events, we don't have to increment 
     * firing_counter. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="trigger.c.html#LN4189"><span class='Ref_To_Local'>events</span></a> <span class='Operator'>= &</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3413"><span class='Ref_to_Member'>query_stack</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a><span class='Delimiter'>]; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3920"><span class='Ref_to_Func'>afterTriggerMarkEvents</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4189"><span class='Ref_To_Local'>events</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3411"><span class='Ref_to_Member'>events</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN4234"></a>            <a href="../../include/c.h.html#LN410"><span class='Ref_to_Typedef'>CommandId</span></a>   <span class='Declare_Local'>firing_id</span> <span class='Operator'>= </span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3409"><span class='Ref_to_Member'>firing_counter</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* OK to delete the immediate events after processing them */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3992"><span class='Ref_to_Func'>afterTriggerInvokeEvents</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4189"><span class='Ref_To_Local'>events</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN4234"><span class='Ref_To_Local'>firing_id</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN4187"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> 
                <span class='Control'>break</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* all fired */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Release query-local storage for events, including tuplestore if any */ 
</span>    <a href="trigger.c.html#LN4190"><span class='Ref_To_Local'>fdw_tuplestore</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3414"><span class='Ref_to_Member'>fdw_tuplestores</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a><span class='Delimiter'>]; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN4190"><span class='Ref_To_Local'>fdw_tuplestore</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/tuplestore.h.html#LN88"><span class='Ref_to_Proto'>tuplestore_end</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4190"><span class='Ref_To_Local'>fdw_tuplestore</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3414"><span class='Ref_to_Member'>fdw_tuplestores</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="trigger.c.html#LN4191"><span class='Ref_To_Local'>old_tuplestore</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3416"><span class='Ref_to_Member'>old_tuplestores</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a><span class='Delimiter'>]; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN4191"><span class='Ref_To_Local'>old_tuplestore</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/tuplestore.h.html#LN88"><span class='Ref_to_Proto'>tuplestore_end</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4191"><span class='Ref_To_Local'>old_tuplestore</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3416"><span class='Ref_to_Member'>old_tuplestores</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="trigger.c.html#LN4192"><span class='Ref_To_Local'>new_tuplestore</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3417"><span class='Ref_to_Member'>new_tuplestores</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a><span class='Delimiter'>]; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN4192"><span class='Ref_To_Local'>new_tuplestore</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/tuplestore.h.html#LN88"><span class='Ref_to_Proto'>tuplestore_end</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4192"><span class='Ref_To_Local'>new_tuplestore</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3417"><span class='Ref_to_Member'>new_tuplestores</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="trigger.c.html#LN3655"><span class='Ref_to_Func'>afterTriggerFreeEventList</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3413"><span class='Ref_to_Member'>query_stack</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AfterTriggerEndQuery &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * AfterTriggerFireDeferred() 
 * 
 *  Called just before the current transaction is committed. At this 
 *  time we invoke all pending DEFERRED triggers. 
 * 
 *  It is possible for other modules to queue additional deferred triggers 
 *  during pre-commit processing; therefore xact.c may have to call this 
 *  multiple times. 
 * ---------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN4281"></a><span class='Declare_Function'>AfterTriggerFireDeferred</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4283"></a>    <a href="trigger.c.html#LN3329"><span class='Ref_to_Struct'>AfterTriggerEventList</span></a> <span class='Operator'>*</span><span class='Declare_Local'>events</span><span class='Delimiter'>; 
</span><a name="LN4284"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>snap_pushed</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Must not be inside a query */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If there are any triggers to fire, make sure we have set a snapshot for 
     * them to use.  (Since PortalRunUtility doesn't set a snap for COMMIT, we 
     * can't assume ActiveSnapshot is valid on entry.) 
     */ 
</span>    <a href="trigger.c.html#LN4283"><span class='Ref_To_Local'>events</span></a> <span class='Operator'>= &</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3411"><span class='Ref_to_Member'>events</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN4283"><span class='Ref_To_Local'>events</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3331"><span class='Ref_to_Member'>head</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/snapmgr.h.html#LN73"><span class='Ref_to_Proto'>PushActiveSnapshot</span></a><span class='Parentheses'>(</span><a href="../../include/utils/snapmgr.h.html#LN63"><span class='Ref_to_Proto'>GetTransactionSnapshot</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN4284"><span class='Ref_To_Local'>snap_pushed</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Run all the remaining triggers.  Loop until they are all gone, in case 
     * some trigger queues more for us to do. 
     */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3920"><span class='Ref_to_Func'>afterTriggerMarkEvents</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4283"><span class='Ref_To_Local'>events</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN4307"></a>        <a href="../../include/c.h.html#LN410"><span class='Ref_to_Typedef'>CommandId</span></a>   <span class='Declare_Local'>firing_id</span> <span class='Operator'>= </span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3409"><span class='Ref_to_Member'>firing_counter</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3992"><span class='Ref_to_Func'>afterTriggerInvokeEvents</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4283"><span class='Ref_To_Local'>events</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN4307"><span class='Ref_To_Local'>firing_id</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> 
            <span class='Control'>break</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* all fired */ 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We don't bother freeing the event list, since it will go away anyway 
     * (and more efficiently than via pfree) in AfterTriggerEndXact. 
     */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN4284"><span class='Ref_To_Local'>snap_pushed</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/snapmgr.h.html#LN76"><span class='Ref_to_Proto'>PopActiveSnapshot</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AfterTriggerFireDeferred &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * AfterTriggerEndXact() 
 * 
 *  The current transaction is finishing. 
 * 
 *  Any unfired triggers are canceled so we simply throw 
 *  away anything we know. 
 * 
 *  Note: it is possible for this to be called repeatedly in case of 
 *  error during transaction abort; therefore, do not complain if 
 *  already closed down. 
 * ---------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN4337"></a><span class='Declare_Function'>AfterTriggerEndXact</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isCommit</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * Forget the pending-events list. 
     * 
     * Since all the info is in TopTransactionContext or children thereof, we 
     * don't really need to do anything to reclaim memory.  However, the 
     * pending-events list could be large, and so it's useful to discard it as 
     * soon as possible --- especially if we are aborting because we ran out 
     * of memory for the list! 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3419"><span class='Ref_to_Member'>event_cxt</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3419"><span class='Ref_to_Member'>event_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3419"><span class='Ref_to_Member'>event_cxt</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3411"><span class='Ref_to_Member'>events</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3331"><span class='Ref_to_Member'>head</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3411"><span class='Ref_to_Member'>events</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3332"><span class='Ref_to_Member'>tail</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3411"><span class='Ref_to_Member'>events</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3333"><span class='Ref_to_Member'>tailfree</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Forget any subtransaction state as well.  Since this can't be very 
     * large, we let the eventual reset of TopTransactionContext free the 
     * memory instead of doing it here. 
     */ 
</span>    <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3423"><span class='Ref_to_Member'>state_stack</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3424"><span class='Ref_to_Member'>events_stack</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3425"><span class='Ref_to_Member'>depth_stack</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3426"><span class='Ref_to_Member'>firing_stack</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3427"><span class='Ref_to_Member'>maxtransdepth</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Forget the query stack and constraint-related state information.  As 
     * with the subtransaction state information, we don't bother freeing the 
     * memory here. 
     */ 
</span>    <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3413"><span class='Ref_to_Member'>query_stack</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3414"><span class='Ref_to_Member'>fdw_tuplestores</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3416"><span class='Ref_to_Member'>old_tuplestores</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3417"><span class='Ref_to_Member'>new_tuplestores</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3418"><span class='Ref_to_Member'>maxquerydepth</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3410"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* No more afterTriggers manipulation until next transaction starts. */ 
</span>    <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AfterTriggerEndXact &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * AfterTriggerBeginSubXact() 
 * 
 *  Start a subtransaction. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN4391"></a><span class='Declare_Function'>AfterTriggerBeginSubXact</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4393"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>my_level</span> <span class='Operator'>= </span><a href="../../include/access/xact.h.html#LN344"><span class='Ref_to_Proto'>GetCurrentTransactionNestLevel</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Allocate more space in the stacks if needed.  (Note: because the 
     * minimum nest level of a subtransaction is 2, we waste the first couple 
     * entries of each array; not worth the notational effort to avoid it.) 
     */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN4393"><span class='Ref_To_Local'>my_level</span></a> <span class='Operator'>&GT;= </span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3427"><span class='Ref_to_Member'>maxtransdepth</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3427"><span class='Ref_to_Member'>maxtransdepth</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN4404"></a>            <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>old_cxt</span><span class='Delimiter'>; 
</span> 
            <a href="trigger.c.html#LN4404"><span class='Ref_To_Local'>old_cxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN47"><span class='Ref_to_Global_Var'>TopTransactionContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN4408"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>DEFTRIG_INITALLOC</span> <span class='Number'>8</span> 
            <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3423"><span class='Ref_to_Member'>state_stack</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3222"><span class='Ref_to_Typedef'>SetConstraintState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                <a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4408"><span class='Ref_to_Const'>DEFTRIG_INITALLOC</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3222"><span class='Ref_to_Typedef'>SetConstraintState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3424"><span class='Ref_to_Member'>events_stack</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3329"><span class='Ref_to_Struct'>AfterTriggerEventList</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                <a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4408"><span class='Ref_to_Const'>DEFTRIG_INITALLOC</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3329"><span class='Ref_to_Struct'>AfterTriggerEventList</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3425"><span class='Ref_to_Member'>depth_stack</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) 
</span>                <a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4408"><span class='Ref_to_Const'>DEFTRIG_INITALLOC</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3426"><span class='Ref_to_Member'>firing_stack</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN410"><span class='Ref_to_Typedef'>CommandId</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                <a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4408"><span class='Ref_to_Const'>DEFTRIG_INITALLOC</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN410"><span class='Ref_to_Typedef'>CommandId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3427"><span class='Ref_to_Member'>maxtransdepth</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN4408"><span class='Ref_to_Const'>DEFTRIG_INITALLOC</span></a><span class='Delimiter'>; 
</span> 
            <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4404"><span class='Ref_To_Local'>old_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* repalloc will keep the stacks in the same context */ 
</span><a name="LN4424"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>new_alloc</span> <span class='Operator'>= </span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3427"><span class='Ref_to_Member'>maxtransdepth</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Delimiter'>; 
</span> 
            <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3423"><span class='Ref_to_Member'>state_stack</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3222"><span class='Ref_to_Typedef'>SetConstraintState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                <a href="../../include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3423"><span class='Ref_to_Member'>state_stack</span></a><span class='Delimiter'>, 
</span>                         <a href="trigger.c.html#LN4424"><span class='Ref_To_Local'>new_alloc</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3222"><span class='Ref_to_Typedef'>SetConstraintState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3424"><span class='Ref_to_Member'>events_stack</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3329"><span class='Ref_to_Struct'>AfterTriggerEventList</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                <a href="../../include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3424"><span class='Ref_to_Member'>events_stack</span></a><span class='Delimiter'>, 
</span>                         <a href="trigger.c.html#LN4424"><span class='Ref_To_Local'>new_alloc</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3329"><span class='Ref_to_Struct'>AfterTriggerEventList</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3425"><span class='Ref_to_Member'>depth_stack</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) 
</span>                <a href="../../include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3425"><span class='Ref_to_Member'>depth_stack</span></a><span class='Delimiter'>, 
</span>                         <a href="trigger.c.html#LN4424"><span class='Ref_To_Local'>new_alloc</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3426"><span class='Ref_to_Member'>firing_stack</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN410"><span class='Ref_to_Typedef'>CommandId</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                <a href="../../include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3426"><span class='Ref_to_Member'>firing_stack</span></a><span class='Delimiter'>, 
</span>                         <a href="trigger.c.html#LN4424"><span class='Ref_To_Local'>new_alloc</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN410"><span class='Ref_to_Typedef'>CommandId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3427"><span class='Ref_to_Member'>maxtransdepth</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN4424"><span class='Ref_To_Local'>new_alloc</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while my_level&GT;=afterTrigge... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Push the current information into the stack.  The SET CONSTRAINTS state 
     * is not saved until/unless changed.  Likewise, we don't make a 
     * per-subtransaction event context until needed. 
     */ 
</span>    <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3423"><span class='Ref_to_Member'>state_stack</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN4393"><span class='Ref_To_Local'>my_level</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3424"><span class='Ref_to_Member'>events_stack</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN4393"><span class='Ref_To_Local'>my_level</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3411"><span class='Ref_to_Member'>events</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3425"><span class='Ref_to_Member'>depth_stack</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN4393"><span class='Ref_To_Local'>my_level</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3426"><span class='Ref_to_Member'>firing_stack</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN4393"><span class='Ref_To_Local'>my_level</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3409"><span class='Ref_to_Member'>firing_counter</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AfterTriggerBeginSubXact &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * AfterTriggerEndSubXact() 
 * 
 *  The current subtransaction is ending. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN4459"></a><span class='Declare_Function'>AfterTriggerEndSubXact</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isCommit</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4461"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>my_level</span> <span class='Operator'>= </span><a href="../../include/access/xact.h.html#LN344"><span class='Ref_to_Proto'>GetCurrentTransactionNestLevel</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN4462"></a>    <a href="trigger.c.html#LN3222"><span class='Ref_to_Typedef'>SetConstraintState</span></a> <span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN4463"></a>    <a href="trigger.c.html#LN3278"><span class='Ref_to_Typedef'>AfterTriggerEvent</span></a> <span class='Declare_Local'>event</span><span class='Delimiter'>; 
</span><a name="LN4464"></a>    <a href="trigger.c.html#LN3317"><span class='Ref_to_Struct'>AfterTriggerEventChunk</span></a> <span class='Operator'>*</span><span class='Declare_Local'>chunk</span><span class='Delimiter'>; 
</span><a name="LN4465"></a>    <a href="../../include/c.h.html#LN410"><span class='Ref_to_Typedef'>CommandId</span></a>   <span class='Declare_Local'>subxact_firing_id</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Pop the prior state if needed. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN4459"><span class='Ref_to_Parameter'>isCommit</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN4461"><span class='Ref_To_Local'>my_level</span></a> <span class='Operator'>&LT; </span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3427"><span class='Ref_to_Member'>maxtransdepth</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* If we saved a prior state, we don't need it anymore */ 
</span>        <a href="trigger.c.html#LN4462"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3423"><span class='Ref_to_Member'>state_stack</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN4461"><span class='Ref_To_Local'>my_level</span></a><span class='Delimiter'>]; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN4462"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4462"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* this avoids double pfree if error later: */ 
</span>        <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3423"><span class='Ref_to_Member'>state_stack</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN4461"><span class='Ref_To_Local'>my_level</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a> <span class='Operator'>== 
</span>               <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3425"><span class='Ref_to_Member'>depth_stack</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN4461"><span class='Ref_To_Local'>my_level</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Aborting.  It is possible subxact start failed before calling 
         * AfterTriggerBeginSubXact, in which case we mustn't risk touching 
         * stack levels that aren't there. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN4461"><span class='Ref_To_Local'>my_level</span></a> <span class='Operator'>&GT;= </span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3427"><span class='Ref_to_Member'>maxtransdepth</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Release any event lists from queries being aborted, and restore 
         * query_depth to its pre-subxact value.  This assumes that a 
         * subtransaction will not add events to query levels started in a 
         * earlier transaction state. 
         */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a> <span class='Operator'>&GT; </span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3425"><span class='Ref_to_Member'>depth_stack</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN4461"><span class='Ref_To_Local'>my_level</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a> <span class='Operator'>&LT; </span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3418"><span class='Ref_to_Member'>maxquerydepth</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN4502"></a>                <a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ts</span><span class='Delimiter'>; 
</span> 
                <a href="trigger.c.html#LN4502"><span class='Ref_To_Local'>ts</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3414"><span class='Ref_to_Member'>fdw_tuplestores</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a><span class='Delimiter'>]; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN4502"><span class='Ref_To_Local'>ts</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../include/utils/tuplestore.h.html#LN88"><span class='Ref_to_Proto'>tuplestore_end</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4502"><span class='Ref_To_Local'>ts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3414"><span class='Ref_to_Member'>fdw_tuplestores</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="trigger.c.html#LN4502"><span class='Ref_To_Local'>ts</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3416"><span class='Ref_to_Member'>old_tuplestores</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a><span class='Delimiter'>]; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN4502"><span class='Ref_To_Local'>ts</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../include/utils/tuplestore.h.html#LN88"><span class='Ref_to_Proto'>tuplestore_end</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4502"><span class='Ref_To_Local'>ts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3416"><span class='Ref_to_Member'>old_tuplestores</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="trigger.c.html#LN4502"><span class='Ref_To_Local'>ts</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3417"><span class='Ref_to_Member'>new_tuplestores</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a><span class='Delimiter'>]; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN4502"><span class='Ref_To_Local'>ts</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../include/utils/tuplestore.h.html#LN88"><span class='Ref_to_Proto'>tuplestore_end</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4502"><span class='Ref_To_Local'>ts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3417"><span class='Ref_to_Member'>new_tuplestores</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <a href="trigger.c.html#LN3655"><span class='Ref_to_Func'>afterTriggerFreeEventList</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3413"><span class='Ref_to_Member'>query_stack</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if afterTriggers.query_d... &raquo; </span> 
 
            <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while afterTriggers.query_d... &raquo; </span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a> <span class='Operator'>== 
</span>               <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3425"><span class='Ref_to_Member'>depth_stack</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN4461"><span class='Ref_To_Local'>my_level</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Restore the global deferred-event list to its former length, 
         * discarding any events queued by the subxact. 
         */ 
</span>        <a href="trigger.c.html#LN3678"><span class='Ref_to_Func'>afterTriggerRestoreEventList</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3411"><span class='Ref_to_Member'>events</span></a><span class='Delimiter'>, 
</span>                                     <span class='Operator'>&</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3424"><span class='Ref_to_Member'>events_stack</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN4461"><span class='Ref_To_Local'>my_level</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Restore the trigger state.  If the saved state is NULL, then this 
         * subxact didn't save it, so it doesn't need restoring. 
         */ 
</span>        <a href="trigger.c.html#LN4462"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3423"><span class='Ref_to_Member'>state_stack</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN4461"><span class='Ref_To_Local'>my_level</span></a><span class='Delimiter'>]; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN4462"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3410"><span class='Ref_to_Member'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3410"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN4462"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* this avoids double pfree if error later: */ 
</span>        <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3423"><span class='Ref_to_Member'>state_stack</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN4461"><span class='Ref_To_Local'>my_level</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Scan for any remaining deferred events that were marked DONE or IN 
         * PROGRESS by this subxact or a child, and un-mark them. We can 
         * recognize such events because they have a firing ID greater than or 
         * equal to the firing_counter value we saved at subtransaction start. 
         * (This essentially assumes that the current subxact includes all 
         * subxacts started after it.) 
         */ 
</span>        <a href="trigger.c.html#LN4465"><span class='Ref_To_Local'>subxact_firing_id</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3426"><span class='Ref_to_Member'>firing_stack</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN4461"><span class='Ref_To_Local'>my_level</span></a><span class='Delimiter'>]; 
</span>        <a href="trigger.c.html#LN3344"><span class='Ref_to_Macro'>for_each_event_chunk</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4463"><span class='Ref_To_Local'>event</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN4464"><span class='Ref_To_Local'>chunk</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3411"><span class='Ref_to_Member'>events</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN4562"></a>            <a href="trigger.c.html#LN3268"><span class='Ref_to_Typedef'>AfterTriggerShared</span></a> <span class='Declare_Local'>evtshared</span> <span class='Operator'>= </span><a href="trigger.c.html#LN3307"><span class='Ref_to_Macro'>GetTriggerSharedData</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4463"><span class='Ref_To_Local'>event</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN4463"><span class='Ref_To_Local'>event</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3282"><span class='Ref_to_Member'>ate_flags</span></a> <span class='Operator'>& 
</span>                <span class='Parentheses'>(</span><a href="trigger.c.html#LN3259"><span class='Ref_to_Const'>AFTER_TRIGGER_DONE</span></a> <span class='Operator'>| </span><a href="trigger.c.html#LN3260"><span class='Ref_to_Const'>AFTER_TRIGGER_IN_PROGRESS</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN4562"><span class='Ref_To_Local'>evtshared</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3275"><span class='Ref_to_Member'>ats_firing_id</span></a> <span class='Operator'>&GT;= </span><a href="trigger.c.html#LN4465"><span class='Ref_To_Local'>subxact_firing_id</span></a><span class='Parentheses'>) 
</span>                    <a href="trigger.c.html#LN4463"><span class='Ref_To_Local'>event</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3282"><span class='Ref_to_Member'>ate_flags</span></a> <span class='Operator'>&= 
</span>                        <span class='Operator'>~</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3259"><span class='Ref_to_Const'>AFTER_TRIGGER_DONE</span></a> <span class='Operator'>| </span><a href="trigger.c.html#LN3260"><span class='Ref_to_Const'>AFTER_TRIGGER_IN_PROGRESS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end AfterTriggerEndSubXact &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * AfterTriggerEnlargeQueryState() 
 * 
 *  Prepare the necessary state so that we can record AFTER trigger events 
 *  queued by a query.  It is allowed to have nested queries within a 
 *  (sub)transaction, so we need to have separate state for each query 
 *  nesting level. 
 * ---------- 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4585"></a><span class='Declare_Function'>AfterTriggerEnlargeQueryState</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4587"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>init_depth</span> <span class='Operator'>= </span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3418"><span class='Ref_to_Member'>maxquerydepth</span></a><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a> <span class='Operator'>&GT;= </span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3418"><span class='Ref_to_Member'>maxquerydepth</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3418"><span class='Ref_to_Member'>maxquerydepth</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4593"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>new_alloc</span> <span class='Operator'>= </span><a href="../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>8</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3413"><span class='Ref_to_Member'>query_stack</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3329"><span class='Ref_to_Struct'>AfterTriggerEventList</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN47"><span class='Ref_to_Global_Var'>TopTransactionContext</span></a><span class='Delimiter'>, 
</span>                               <a href="trigger.c.html#LN4593"><span class='Ref_To_Local'>new_alloc</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3329"><span class='Ref_to_Struct'>AfterTriggerEventList</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3414"><span class='Ref_to_Member'>fdw_tuplestores</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>**</span><span class='Parentheses'>) 
</span>            <a href="../../include/utils/palloc.h.html#LN71"><span class='Ref_to_Proto'>MemoryContextAllocZero</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN47"><span class='Ref_to_Global_Var'>TopTransactionContext</span></a><span class='Delimiter'>, 
</span>                                   <a href="trigger.c.html#LN4593"><span class='Ref_To_Local'>new_alloc</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3416"><span class='Ref_to_Member'>old_tuplestores</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>**</span><span class='Parentheses'>) 
</span>            <a href="../../include/utils/palloc.h.html#LN71"><span class='Ref_to_Proto'>MemoryContextAllocZero</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN47"><span class='Ref_to_Global_Var'>TopTransactionContext</span></a><span class='Delimiter'>, 
</span>                                   <a href="trigger.c.html#LN4593"><span class='Ref_To_Local'>new_alloc</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3417"><span class='Ref_to_Member'>new_tuplestores</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>**</span><span class='Parentheses'>) 
</span>            <a href="../../include/utils/palloc.h.html#LN71"><span class='Ref_to_Proto'>MemoryContextAllocZero</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN47"><span class='Ref_to_Global_Var'>TopTransactionContext</span></a><span class='Delimiter'>, 
</span>                                   <a href="trigger.c.html#LN4593"><span class='Ref_To_Local'>new_alloc</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3418"><span class='Ref_to_Member'>maxquerydepth</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN4593"><span class='Ref_To_Local'>new_alloc</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* repalloc will keep the stack in the same context */ 
</span><a name="LN4612"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>old_alloc</span> <span class='Operator'>= </span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3418"><span class='Ref_to_Member'>maxquerydepth</span></a><span class='Delimiter'>; 
</span><a name="LN4613"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>new_alloc</span> <span class='Operator'>= </span><a href="../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                    <a href="trigger.c.html#LN4612"><span class='Ref_To_Local'>old_alloc</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3413"><span class='Ref_to_Member'>query_stack</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3329"><span class='Ref_to_Struct'>AfterTriggerEventList</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="../../include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3413"><span class='Ref_to_Member'>query_stack</span></a><span class='Delimiter'>, 
</span>                     <a href="trigger.c.html#LN4613"><span class='Ref_To_Local'>new_alloc</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3329"><span class='Ref_to_Struct'>AfterTriggerEventList</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3414"><span class='Ref_to_Member'>fdw_tuplestores</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>**</span><span class='Parentheses'>) 
</span>            <a href="../../include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3414"><span class='Ref_to_Member'>fdw_tuplestores</span></a><span class='Delimiter'>, 
</span>                     <a href="trigger.c.html#LN4613"><span class='Ref_To_Local'>new_alloc</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3416"><span class='Ref_to_Member'>old_tuplestores</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>**</span><span class='Parentheses'>) 
</span>            <a href="../../include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3416"><span class='Ref_to_Member'>old_tuplestores</span></a><span class='Delimiter'>, 
</span>                     <a href="trigger.c.html#LN4613"><span class='Ref_To_Local'>new_alloc</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3417"><span class='Ref_to_Member'>new_tuplestores</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>**</span><span class='Parentheses'>) 
</span>            <a href="../../include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3417"><span class='Ref_to_Member'>new_tuplestores</span></a><span class='Delimiter'>, 
</span>                     <a href="trigger.c.html#LN4613"><span class='Ref_To_Local'>new_alloc</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Clear newly-allocated slots for subsequent lazy initialization. */ 
</span>        memset<span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3414"><span class='Ref_to_Member'>fdw_tuplestores</span></a> <span class='Operator'>+ </span><a href="trigger.c.html#LN4612"><span class='Ref_To_Local'>old_alloc</span></a><span class='Delimiter'>, 
</span>               <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="trigger.c.html#LN4613"><span class='Ref_To_Local'>new_alloc</span></a> <span class='Operator'>- </span><a href="trigger.c.html#LN4612"><span class='Ref_To_Local'>old_alloc</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memset<span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3416"><span class='Ref_to_Member'>old_tuplestores</span></a> <span class='Operator'>+ </span><a href="trigger.c.html#LN4612"><span class='Ref_To_Local'>old_alloc</span></a><span class='Delimiter'>, 
</span>               <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="trigger.c.html#LN4613"><span class='Ref_To_Local'>new_alloc</span></a> <span class='Operator'>- </span><a href="trigger.c.html#LN4612"><span class='Ref_To_Local'>old_alloc</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memset<span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3417"><span class='Ref_to_Member'>new_tuplestores</span></a> <span class='Operator'>+ </span><a href="trigger.c.html#LN4612"><span class='Ref_To_Local'>old_alloc</span></a><span class='Delimiter'>, 
</span>               <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="trigger.c.html#LN4613"><span class='Ref_To_Local'>new_alloc</span></a> <span class='Operator'>- </span><a href="trigger.c.html#LN4612"><span class='Ref_To_Local'>old_alloc</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3418"><span class='Ref_to_Member'>maxquerydepth</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN4613"><span class='Ref_To_Local'>new_alloc</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Initialize new query lists to empty */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN4587"><span class='Ref_To_Local'>init_depth</span></a> <span class='Operator'>&LT; </span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3418"><span class='Ref_to_Member'>maxquerydepth</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4641"></a>        <a href="trigger.c.html#LN3329"><span class='Ref_to_Struct'>AfterTriggerEventList</span></a> <span class='Operator'>*</span><span class='Declare_Local'>events</span><span class='Delimiter'>; 
</span> 
        <a href="trigger.c.html#LN4641"><span class='Ref_To_Local'>events</span></a> <span class='Operator'>= &</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3413"><span class='Ref_to_Member'>query_stack</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN4587"><span class='Ref_To_Local'>init_depth</span></a><span class='Delimiter'>]; 
</span>        <a href="trigger.c.html#LN4641"><span class='Ref_To_Local'>events</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3331"><span class='Ref_to_Member'>head</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN4641"><span class='Ref_To_Local'>events</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3332"><span class='Ref_to_Member'>tail</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN4641"><span class='Ref_To_Local'>events</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3333"><span class='Ref_to_Member'>tailfree</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Operator'>++</span><a href="trigger.c.html#LN4587"><span class='Ref_To_Local'>init_depth</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end AfterTriggerEnlargeQueryState &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Create an empty SetConstraintState with room for numalloc trigstates 
 */ 
</span><span class='Keyword'>static </span><a href="trigger.c.html#LN3222"><span class='Ref_to_Typedef'>SetConstraintState</span></a> 
<a name="LN4656"></a><span class='Declare_Function'>SetConstraintStateCreate</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>numalloc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4658"></a>    <a href="trigger.c.html#LN3222"><span class='Ref_to_Typedef'>SetConstraintState</span></a> <span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Behave sanely with numalloc == 0 */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN4656"><span class='Ref_to_Parameter'>numalloc</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="trigger.c.html#LN4656"><span class='Ref_to_Parameter'>numalloc</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We assume that zeroing will correctly initialize the state values. 
     */ 
</span>    <a href="trigger.c.html#LN4658"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3222"><span class='Ref_to_Typedef'>SetConstraintState</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/palloc.h.html#LN71"><span class='Ref_to_Proto'>MemoryContextAllocZero</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN47"><span class='Ref_to_Global_Var'>TopTransactionContext</span></a><span class='Delimiter'>, 
</span>                               <a href="../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3213"><span class='Ref_to_Struct'>SetConstraintStateData</span></a><span class='Delimiter'>, </span>trigstates<span class='Parentheses'>) </span><span class='Operator'>+ 
</span>                               <a href="trigger.c.html#LN4656"><span class='Ref_to_Parameter'>numalloc</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3195"><span class='Ref_to_Struct'>SetConstraintTriggerData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN4658"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3218"><span class='Ref_to_Member'>numalloc</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN4656"><span class='Ref_to_Parameter'>numalloc</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="trigger.c.html#LN4658"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SetConstraintStateCreate &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Copy a SetConstraintState 
 */ 
</span><span class='Keyword'>static </span><a href="trigger.c.html#LN3222"><span class='Ref_to_Typedef'>SetConstraintState</span></a> 
<a name="LN4681"></a><span class='Declare_Function'>SetConstraintStateCopy</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3222"><span class='Ref_to_Typedef'>SetConstraintState</span></a> <span class='Declare_Parameter'>origstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4683"></a>    <a href="trigger.c.html#LN3222"><span class='Ref_to_Typedef'>SetConstraintState</span></a> <span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN4683"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3439"><span class='Ref_to_Proto'>SetConstraintStateCreate</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4681"><span class='Ref_to_Parameter'>origstate</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3217"><span class='Ref_to_Member'>numstates</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="trigger.c.html#LN4683"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3215"><span class='Ref_to_Member'>all_isset</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN4681"><span class='Ref_to_Parameter'>origstate</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3215"><span class='Ref_to_Member'>all_isset</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN4683"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3216"><span class='Ref_to_Member'>all_isdeferred</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN4681"><span class='Ref_to_Parameter'>origstate</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3216"><span class='Ref_to_Member'>all_isdeferred</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN4683"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3217"><span class='Ref_to_Member'>numstates</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN4681"><span class='Ref_to_Parameter'>origstate</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3217"><span class='Ref_to_Member'>numstates</span></a><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="trigger.c.html#LN4683"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3219"><span class='Ref_to_Member'>trigstates</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN4681"><span class='Ref_to_Parameter'>origstate</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3219"><span class='Ref_to_Member'>trigstates</span></a><span class='Delimiter'>, 
</span>           <a href="trigger.c.html#LN4681"><span class='Ref_to_Parameter'>origstate</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3217"><span class='Ref_to_Member'>numstates</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3195"><span class='Ref_to_Struct'>SetConstraintTriggerData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="trigger.c.html#LN4683"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Add a per-trigger item to a SetConstraintState.  Returns possibly-changed 
 * pointer to the state object (it will change if we have to repalloc). 
 */ 
</span><span class='Keyword'>static </span><a href="trigger.c.html#LN3222"><span class='Ref_to_Typedef'>SetConstraintState</span></a> 
<a name="LN4701"></a><span class='Declare_Function'>SetConstraintStateAddItem</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3222"><span class='Ref_to_Typedef'>SetConstraintState</span></a> <span class='Declare_Parameter'>state</span><span class='Delimiter'>, 
</span><a name="LN4702"></a>                          <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>tgoid</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>tgisdeferred</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN4701"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3217"><span class='Ref_to_Member'>numstates</span></a> <span class='Operator'>&GT;= </span><a href="trigger.c.html#LN4701"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3218"><span class='Ref_to_Member'>numalloc</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4706"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>newalloc</span> <span class='Operator'>= </span><a href="trigger.c.html#LN4701"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3218"><span class='Ref_to_Member'>numalloc</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Delimiter'>; 
</span> 
        <a href="trigger.c.html#LN4706"><span class='Ref_To_Local'>newalloc</span></a> <span class='Operator'>= </span><a href="../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4706"><span class='Ref_To_Local'>newalloc</span></a><span class='Delimiter'>, </span><span class='Number'>8</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* in case original has size 0 */ 
</span>        <a href="trigger.c.html#LN4701"><span class='Ref_to_Parameter'>state</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3222"><span class='Ref_to_Typedef'>SetConstraintState</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4701"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>, 
</span>                     <a href="../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3213"><span class='Ref_to_Struct'>SetConstraintStateData</span></a><span class='Delimiter'>, </span>trigstates<span class='Parentheses'>) </span><span class='Operator'>+ 
</span>                     <a href="trigger.c.html#LN4706"><span class='Ref_To_Local'>newalloc</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN3195"><span class='Ref_to_Struct'>SetConstraintTriggerData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN4701"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3218"><span class='Ref_to_Member'>numalloc</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN4706"><span class='Ref_To_Local'>newalloc</span></a><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN4701"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3217"><span class='Ref_to_Member'>numstates</span></a> <span class='Operator'>&LT; </span><a href="trigger.c.html#LN4701"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3218"><span class='Ref_to_Member'>numalloc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="trigger.c.html#LN4701"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3219"><span class='Ref_to_Member'>trigstates</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN4701"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3217"><span class='Ref_to_Member'>numstates</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="trigger.c.html#LN3197"><span class='Ref_to_Member'>sct_tgoid</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN4702"><span class='Ref_to_Parameter'>tgoid</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN4701"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3219"><span class='Ref_to_Member'>trigstates</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN4701"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3217"><span class='Ref_to_Member'>numstates</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="trigger.c.html#LN3198"><span class='Ref_to_Member'>sct_tgisdeferred</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN4702"><span class='Ref_to_Parameter'>tgisdeferred</span></a><span class='Delimiter'>; 
</span>    <a href="trigger.c.html#LN4701"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3217"><span class='Ref_to_Member'>numstates</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="trigger.c.html#LN4701"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SetConstraintStateAddItem &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * AfterTriggerSetState() 
 * 
 *  Execute the SET CONSTRAINTS ... utility command. 
 * ---------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN4731"></a><span class='Declare_Function'>AfterTriggerSetState</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN3174"><span class='Ref_to_Struct'>ConstraintsSetStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4733"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>my_level</span> <span class='Operator'>= </span><a href="../../include/access/xact.h.html#LN344"><span class='Ref_to_Proto'>GetCurrentTransactionNestLevel</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If we haven't already done so, initialize our state. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3410"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3410"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3439"><span class='Ref_to_Proto'>SetConstraintStateCreate</span></a><span class='Parentheses'>(</span><span class='Number'>8</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If in a subtransaction, and we didn't save the current state already, 
     * save it so it can be restored if the subtransaction aborts. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN4733"><span class='Ref_To_Local'>my_level</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span> <span class='Operator'>&& 
</span>        <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3423"><span class='Ref_to_Member'>state_stack</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN4733"><span class='Ref_To_Local'>my_level</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3423"><span class='Ref_to_Member'>state_stack</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN4733"><span class='Ref_To_Local'>my_level</span></a><span class='Delimiter'>] </span><span class='Operator'>= 
</span>            <a href="trigger.c.html#LN3440"><span class='Ref_to_Proto'>SetConstraintStateCopy</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3410"><span class='Ref_to_Member'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Handle SET CONSTRAINTS ALL ... 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN4731"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3177"><span class='Ref_to_Member'>constraints</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Forget any previous SET CONSTRAINTS commands in this transaction. 
         */ 
</span>        <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3410"><span class='Ref_to_Member'>state</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3217"><span class='Ref_to_Member'>numstates</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Set the per-transaction ALL state to known. 
         */ 
</span>        <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3410"><span class='Ref_to_Member'>state</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3215"><span class='Ref_to_Member'>all_isset</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3410"><span class='Ref_to_Member'>state</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3216"><span class='Ref_to_Member'>all_isdeferred</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN4731"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3178"><span class='Ref_to_Member'>deferred</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN4768"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>conrel</span><span class='Delimiter'>; 
</span><a name="LN4769"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>tgrel</span><span class='Delimiter'>; 
</span><a name="LN4770"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>conoidlist</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN4771"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tgoidlist</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN4772"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Handle SET CONSTRAINTS constraint-name [, ...] 
         * 
         * First, identify all the named constraints and make a list of their 
         * OIDs.  Since, unlike the SQL spec, we allow multiple constraints of 
         * the same name within a schema, the specifications are not 
         * necessarily unique.  Our strategy is to target all matching 
         * constraints within the first search-path schema that has any 
         * matches, but disregard matches in schemas beyond the first match. 
         * (This is a bit odd but it's the historical behavior.) 
         */ 
</span>        <a href="trigger.c.html#LN4768"><span class='Ref_To_Local'>conrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN28"><span class='Ref_to_Const'>ConstraintRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4772"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN4731"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3177"><span class='Ref_to_Member'>constraints</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN4789"></a>            <a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>constraint</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4772"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4790"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span><span class='Delimiter'>; 
</span><a name="LN4791"></a>            <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>namespacelist</span><span class='Delimiter'>; 
</span><a name="LN4792"></a>            <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>nslc</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN4789"><span class='Ref_To_Local'>constraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN65"><span class='Ref_to_Member'>catalogname</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="trigger.c.html#LN4789"><span class='Ref_To_Local'>constraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN65"><span class='Ref_to_Member'>catalogname</span></a><span class='Delimiter'>, </span><a href="../../include/commands/dbcommands.h.html#LN29"><span class='Ref_to_Proto'>get_database_name</span></a><span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cross-database references are not implemented: \"%s.%s.%s\""</span><span class='Delimiter'>, 
</span>                             <a href="trigger.c.html#LN4789"><span class='Ref_To_Local'>constraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN65"><span class='Ref_to_Member'>catalogname</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN4789"><span class='Ref_To_Local'>constraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN66"><span class='Ref_to_Member'>schemaname</span></a><span class='Delimiter'>, 
</span>                                    <a href="trigger.c.html#LN4789"><span class='Ref_To_Local'>constraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If we're given the schema name with the constraint, look only 
             * in that schema.  If given a bare constraint name, use the 
             * search path to find the first matching constraint. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN4789"><span class='Ref_To_Local'>constraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN66"><span class='Ref_to_Member'>schemaname</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN4811"></a>                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>namespaceId</span> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN113"><span class='Ref_to_Proto'>LookupExplicitNamespace</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4789"><span class='Ref_To_Local'>constraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN66"><span class='Ref_to_Member'>schemaname</span></a><span class='Delimiter'>, 
</span>                                                                  <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="trigger.c.html#LN4791"><span class='Ref_To_Local'>namespacelist</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN150"><span class='Ref_to_Macro'>list_make1_oid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4811"><span class='Ref_To_Local'>namespaceId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="trigger.c.html#LN4791"><span class='Ref_To_Local'>namespacelist</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN156"><span class='Ref_to_Proto'>fetch_search_path</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="trigger.c.html#LN4790"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4792"><span class='Ref_To_Local'>nslc</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN4791"><span class='Ref_To_Local'>namespacelist</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN4824"></a>                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>namespaceId</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4792"><span class='Ref_To_Local'>nslc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4825"></a>                <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>conscan</span><span class='Delimiter'>; 
</span><a name="LN4826"></a>                <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>skey</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN4827"></a>                <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span> 
                <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN4826"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                            <a href="../../include/catalog/pg_constraint.h.html#LN153"><span class='Ref_to_Const'>Anum_pg_constraint_conname</span></a><span class='Delimiter'>, 
</span>                            <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_NAMEEQ<span class='Delimiter'>, 
</span>                            <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4789"><span class='Ref_To_Local'>constraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN4826"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                            <a href="../../include/catalog/pg_constraint.h.html#LN154"><span class='Ref_to_Const'>Anum_pg_constraint_connamespace</span></a><span class='Delimiter'>, 
</span>                            <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                            <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4824"><span class='Ref_To_Local'>namespaceId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                <a href="trigger.c.html#LN4825"><span class='Ref_To_Local'>conscan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4768"><span class='Ref_To_Local'>conrel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN123"><span class='Ref_to_Const'>ConstraintNameNspIndexId</span></a><span class='Delimiter'>, 
</span>                                             <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="trigger.c.html#LN4826"><span class='Ref_To_Local'>skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4827"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4825"><span class='Ref_To_Local'>conscan</span></a><span class='Parentheses'>)))</span> 
                <span class='Delimiter'>{ 
</span><a name="LN4843"></a>                    <a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a> <span class='Declare_Local'>con</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4827"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN4843"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>condeferrable<span class='Parentheses'>) 
</span>                        <a href="trigger.c.html#LN4770"><span class='Ref_To_Local'>conoidlist</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4770"><span class='Ref_To_Local'>conoidlist</span></a><span class='Delimiter'>, 
</span>                                                 <a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4827"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN4731"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3178"><span class='Ref_to_Member'>deferred</span></a><span class='Parentheses'>) 
</span>                        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"constraint \"%s\" is not deferrable"</span><span class='Delimiter'>, 
</span>                                        <a href="trigger.c.html#LN4789"><span class='Ref_To_Local'>constraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <a href="trigger.c.html#LN4790"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4825"><span class='Ref_To_Local'>conscan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Once we've found a matching constraint we do not search 
                 * later parts of the search path. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN4790"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4791"><span class='Ref_To_Local'>namespacelist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Not found ? 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="trigger.c.html#LN4790"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"constraint \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                                <a href="trigger.c.html#LN4789"><span class='Ref_To_Local'>constraint</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4768"><span class='Ref_To_Local'>conrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Now, locate the trigger(s) implementing each of these constraints, 
         * and make a list of their OIDs. 
         */ 
</span>        <a href="trigger.c.html#LN4769"><span class='Ref_To_Local'>tgrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_trigger.h.html#LN33"><span class='Ref_to_Const'>TriggerRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4772"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN4770"><span class='Ref_To_Local'>conoidlist</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN4888"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>conoid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4772"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4889"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span><span class='Delimiter'>; 
</span><a name="LN4890"></a>            <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>skey</span><span class='Delimiter'>; 
</span><a name="LN4891"></a>            <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>tgscan</span><span class='Delimiter'>; 
</span><a name="LN4892"></a>            <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>htup</span><span class='Delimiter'>; 
</span> 
            <a href="trigger.c.html#LN4889"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
            <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN4890"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>, 
</span>                        <a href="../../include/catalog/pg_trigger.h.html#LN86"><span class='Ref_to_Const'>Anum_pg_trigger_tgconstraint</span></a><span class='Delimiter'>, 
</span>                        <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                        <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4888"><span class='Ref_To_Local'>conoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <a href="trigger.c.html#LN4891"><span class='Ref_To_Local'>tgscan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4769"><span class='Ref_To_Local'>tgrel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN246"><span class='Ref_to_Const'>TriggerConstraintIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                        <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="trigger.c.html#LN4890"><span class='Ref_To_Local'>skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4892"><span class='Ref_To_Local'>htup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4891"><span class='Ref_To_Local'>tgscan</span></a><span class='Parentheses'>)))</span> 
            <span class='Delimiter'>{ 
</span><a name="LN4906"></a>                <a href="../../include/catalog/pg_trigger.h.html#LN71"><span class='Ref_to_Typedef'>Form_pg_trigger</span></a> <span class='Declare_Local'>pg_trigger</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_trigger.h.html#LN71"><span class='Ref_to_Typedef'>Form_pg_trigger</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4892"><span class='Ref_To_Local'>htup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Silently skip triggers that are marked as non-deferrable in 
                 * pg_trigger.  This is not an error condition, since a 
                 * deferrable RI constraint may have some non-deferrable 
                 * actions. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN4906"><span class='Ref_To_Local'>pg_trigger</span></a><span class='Operator'>-&GT;</span>tgdeferrable<span class='Parentheses'>) 
</span>                    <a href="trigger.c.html#LN4771"><span class='Ref_To_Local'>tgoidlist</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4771"><span class='Ref_To_Local'>tgoidlist</span></a><span class='Delimiter'>, 
</span>                                            <a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4892"><span class='Ref_To_Local'>htup</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                <a href="trigger.c.html#LN4889"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4891"><span class='Ref_To_Local'>tgscan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Safety check: a deferrable constraint should have triggers */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="trigger.c.html#LN4889"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"no triggers found for constraint with OID %u"</span><span class='Delimiter'>, 
</span>                     <a href="trigger.c.html#LN4888"><span class='Ref_To_Local'>conoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4769"><span class='Ref_To_Local'>tgrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Now we can set the trigger states of individual triggers for this 
         * xact. 
         */ 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4772"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN4771"><span class='Ref_To_Local'>tgoidlist</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN4937"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tgoid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4772"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4938"></a>            <a href="trigger.c.html#LN3222"><span class='Ref_to_Typedef'>SetConstraintState</span></a> <span class='Declare_Local'>state</span> <span class='Operator'>= </span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3410"><span class='Ref_to_Member'>state</span></a><span class='Delimiter'>; 
</span><a name="LN4939"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN4940"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN4940"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="trigger.c.html#LN4940"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="trigger.c.html#LN4938"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3217"><span class='Ref_to_Member'>numstates</span></a><span class='Delimiter'>; </span><a href="trigger.c.html#LN4940"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN4938"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3219"><span class='Ref_to_Member'>trigstates</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN4940"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="trigger.c.html#LN3197"><span class='Ref_to_Member'>sct_tgoid</span></a> <span class='Operator'>== </span><a href="trigger.c.html#LN4937"><span class='Ref_To_Local'>tgoid</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="trigger.c.html#LN4938"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3219"><span class='Ref_to_Member'>trigstates</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN4940"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="trigger.c.html#LN3198"><span class='Ref_to_Member'>sct_tgisdeferred</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN4731"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3178"><span class='Ref_to_Member'>deferred</span></a><span class='Delimiter'>; 
</span>                    <a href="trigger.c.html#LN4939"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="trigger.c.html#LN4939"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3410"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= 
</span>                    <a href="trigger.c.html#LN3441"><span class='Ref_to_Proto'>SetConstraintStateAddItem</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4938"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN4937"><span class='Ref_To_Local'>tgoid</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN4731"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3178"><span class='Ref_to_Member'>deferred</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * SQL99 requires that when a constraint is set to IMMEDIATE, any deferred 
     * checks against that constraint must be made when the SET CONSTRAINTS 
     * command is executed -- i.e. the effects of the SET CONSTRAINTS command 
     * apply retroactively.  We've updated the constraints state, so scan the 
     * list of previously deferred events to fire any that have now become 
     * immediate. 
     * 
     * Obviously, if this was SET ... DEFERRED then it can't have converted 
     * any unfired events to immediate, so we need do nothing in that case. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="trigger.c.html#LN4731"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3178"><span class='Ref_to_Member'>deferred</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4972"></a>        <a href="trigger.c.html#LN3329"><span class='Ref_to_Struct'>AfterTriggerEventList</span></a> <span class='Operator'>*</span><span class='Declare_Local'>events</span> <span class='Operator'>= &</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3411"><span class='Ref_to_Member'>events</span></a><span class='Delimiter'>; 
</span><a name="LN4973"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>snapshot_set</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3920"><span class='Ref_to_Func'>afterTriggerMarkEvents</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4972"><span class='Ref_To_Local'>events</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN4977"></a>            <a href="../../include/c.h.html#LN410"><span class='Ref_to_Typedef'>CommandId</span></a>   <span class='Declare_Local'>firing_id</span> <span class='Operator'>= </span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3409"><span class='Ref_to_Member'>firing_counter</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Make sure a snapshot has been established in case trigger 
             * functions need one.  Note that we avoid setting a snapshot if 
             * we don't find at least one trigger that has to be fired now. 
             * This is so that BEGIN; SET CONSTRAINTS ...; SET TRANSACTION 
             * ISOLATION LEVEL SERIALIZABLE; ... works properly.  (If we are 
             * at the start of a transaction it's not possible for any trigger 
             * events to be queued yet.) 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="trigger.c.html#LN4973"><span class='Ref_To_Local'>snapshot_set</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../include/utils/snapmgr.h.html#LN73"><span class='Ref_to_Proto'>PushActiveSnapshot</span></a><span class='Parentheses'>(</span><a href="../../include/utils/snapmgr.h.html#LN63"><span class='Ref_to_Proto'>GetTransactionSnapshot</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>                <a href="trigger.c.html#LN4973"><span class='Ref_To_Local'>snapshot_set</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * We can delete fired events if we are at top transaction level, 
             * but we'd better not if inside a subtransaction, since the 
             * subtransaction could later get rolled back. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3992"><span class='Ref_to_Func'>afterTriggerInvokeEvents</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN4972"><span class='Ref_To_Local'>events</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN4977"><span class='Ref_To_Local'>firing_id</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                         <span class='Operator'>!</span><a href="../../include/access/xact.h.html#LN361"><span class='Ref_to_Proto'>IsSubTransaction</span></a><span class='Parentheses'>()))</span> 
                <span class='Control'>break</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* all fired */ 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while afterTriggerMarkEvent... &raquo; </span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN4973"><span class='Ref_To_Local'>snapshot_set</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/snapmgr.h.html#LN76"><span class='Ref_to_Proto'>PopActiveSnapshot</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !stmt-&GT;deferred &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end AfterTriggerSetState &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * AfterTriggerPendingOnRel() 
 *      Test to see if there are any pending after-trigger events for rel. 
 * 
 * This is used by TRUNCATE, CLUSTER, ALTER TABLE, etc to detect whether 
 * it is unsafe to perform major surgery on a relation.  Note that only 
 * local pending events are examined.  We assume that having exclusive lock 
 * on a rel guarantees there are no unserviced events in other backends --- 
 * but having a lock does not prevent there being such events in our own. 
 * 
 * In some scenarios it'd be reasonable to remove pending events (more 
 * specifically, mark them DONE by the current subxact) but without a lot 
 * of knowledge of the trigger semantics we can't do this in general. 
 * ---------- 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN5025"></a><span class='Declare_Function'>AfterTriggerPendingOnRel</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5027"></a>    <a href="trigger.c.html#LN3278"><span class='Ref_to_Typedef'>AfterTriggerEvent</span></a> <span class='Declare_Local'>event</span><span class='Delimiter'>; 
</span><a name="LN5028"></a>    <a href="trigger.c.html#LN3317"><span class='Ref_to_Struct'>AfterTriggerEventChunk</span></a> <span class='Operator'>*</span><span class='Declare_Local'>chunk</span><span class='Delimiter'>; 
</span><a name="LN5029"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>depth</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Scan queued events */ 
</span>    <a href="trigger.c.html#LN3344"><span class='Ref_to_Macro'>for_each_event_chunk</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN5027"><span class='Ref_To_Local'>event</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN5028"><span class='Ref_To_Local'>chunk</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3411"><span class='Ref_to_Member'>events</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5034"></a>        <a href="trigger.c.html#LN3268"><span class='Ref_to_Typedef'>AfterTriggerShared</span></a> <span class='Declare_Local'>evtshared</span> <span class='Operator'>= </span><a href="trigger.c.html#LN3307"><span class='Ref_to_Macro'>GetTriggerSharedData</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN5027"><span class='Ref_To_Local'>event</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We can ignore completed events.  (Even if a DONE flag is rolled 
         * back by subxact abort, it's OK because the effects of the TRUNCATE 
         * or whatever must get rolled back too.) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN5027"><span class='Ref_To_Local'>event</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3282"><span class='Ref_to_Member'>ate_flags</span></a> <span class='Operator'>& </span><a href="trigger.c.html#LN3259"><span class='Ref_to_Const'>AFTER_TRIGGER_DONE</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN5034"><span class='Ref_To_Local'>evtshared</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3274"><span class='Ref_to_Member'>ats_relid</span></a> <span class='Operator'>== </span><a href="trigger.c.html#LN5025"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Also scan events queued by incomplete queries.  This could only matter 
     * if TRUNCATE/etc is executed by a function or trigger within an updating 
     * query on the same relation, which is pretty perverse, but let's check. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN5029"><span class='Ref_To_Local'>depth</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="trigger.c.html#LN5029"><span class='Ref_To_Local'>depth</span></a> <span class='Operator'>&LT;= </span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a> <span class='Operator'>&& </span><a href="trigger.c.html#LN5029"><span class='Ref_To_Local'>depth</span></a> <span class='Operator'>&LT; </span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3418"><span class='Ref_to_Member'>maxquerydepth</span></a><span class='Delimiter'>; </span><a href="trigger.c.html#LN5029"><span class='Ref_To_Local'>depth</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="trigger.c.html#LN3344"><span class='Ref_to_Macro'>for_each_event_chunk</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN5027"><span class='Ref_To_Local'>event</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN5028"><span class='Ref_To_Local'>chunk</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3413"><span class='Ref_to_Member'>query_stack</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN5029"><span class='Ref_To_Local'>depth</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN5057"></a>            <a href="trigger.c.html#LN3268"><span class='Ref_to_Typedef'>AfterTriggerShared</span></a> <span class='Declare_Local'>evtshared</span> <span class='Operator'>= </span><a href="trigger.c.html#LN3307"><span class='Ref_to_Macro'>GetTriggerSharedData</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN5027"><span class='Ref_To_Local'>event</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN5027"><span class='Ref_To_Local'>event</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3282"><span class='Ref_to_Member'>ate_flags</span></a> <span class='Operator'>& </span><a href="trigger.c.html#LN3259"><span class='Ref_to_Const'>AFTER_TRIGGER_DONE</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN5057"><span class='Ref_To_Local'>evtshared</span></a><span class='Operator'>-&GT;</span><a href="trigger.c.html#LN3274"><span class='Ref_to_Member'>ats_relid</span></a> <span class='Operator'>== </span><a href="trigger.c.html#LN5025"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AfterTriggerPendingOnRel &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * AfterTriggerSaveEvent() 
 * 
 *  Called by ExecA[RS]...Triggers() to queue up the triggers that should 
 *  be fired for an event. 
 * 
 *  NOTE: this is called whenever there are any triggers associated with 
 *  the event (even if they are disabled).  This function decides which 
 *  triggers actually need to be queued.  It is also called after each row, 
 *  even if there are no triggers for that event, if there are any AFTER 
 *  STATEMENT triggers for the statement which use transition tables, so that 
 *  the transition tuplestores can be built. 
 * 
 *  Transition tuplestores are built now, rather than when events are pulled 
 *  off of the queue because AFTER ROW triggers are allowed to select from the 
 *  transition tables for the statement. 
 * ---------- 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN5090"></a><span class='Declare_Function'>AfterTriggerSaveEvent</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>relinfo</span><span class='Delimiter'>, 
</span><a name="LN5091"></a>                      <span class='Keyword'>int </span><span class='Declare_Parameter'>event</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>row_trigger</span><span class='Delimiter'>, 
</span><a name="LN5092"></a>                      <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>oldtup</span><span class='Delimiter'>, </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>newtup</span><span class='Delimiter'>, 
</span><a name="LN5093"></a>                      <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>recheckIndexes</span><span class='Delimiter'>, </span><a href="../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>modifiedCols</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5095"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span> <span class='Operator'>= </span><a href="trigger.c.html#LN5090"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>; 
</span><a name="LN5096"></a>    <a href="../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a> <span class='Operator'>*</span><span class='Declare_Local'>trigdesc</span> <span class='Operator'>= </span><a href="trigger.c.html#LN5090"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a><span class='Delimiter'>; 
</span><a name="LN5097"></a>    <a href="trigger.c.html#LN3280"><span class='Ref_to_Struct'>AfterTriggerEventData</span></a> <span class='Declare_Local'>new_event</span><span class='Delimiter'>; 
</span><a name="LN5098"></a>    <a href="trigger.c.html#LN3270"><span class='Ref_to_Struct'>AfterTriggerSharedData</span></a> <span class='Declare_Local'>new_shared</span><span class='Delimiter'>; 
</span><a name="LN5099"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>relkind</span> <span class='Operator'>= </span><a href="trigger.c.html#LN5090"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind<span class='Delimiter'>; 
</span><a name="LN5100"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>tgtype_event</span><span class='Delimiter'>; 
</span><a name="LN5101"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>tgtype_level</span><span class='Delimiter'>; 
</span><a name="LN5102"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN5103"></a>    <a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fdw_tuplestore</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check state.  We use a normal test not Assert because it is possible to 
     * reach here in the wrong state given misconfigured RI triggers, in 
     * particular deferring a cascade action trigger. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"AfterTriggerSaveEvent() called outside of query"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Be sure we have enough space to record events at this query depth. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a> <span class='Operator'>&GT;= </span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3418"><span class='Ref_to_Member'>maxquerydepth</span></a><span class='Parentheses'>) 
</span>        <a href="trigger.c.html#LN99"><span class='Ref_to_Proto'>AfterTriggerEnlargeQueryState</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the relation has AFTER ... FOR EACH ROW triggers, capture rows into 
     * transition tuplestores for this depth. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN5091"><span class='Ref_to_Parameter'>row_trigger</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="trigger.c.html#LN5091"><span class='Ref_to_Parameter'>event</span></a> <span class='Operator'>== </span><a href="../../include/commands/trigger.h.html#LN52"><span class='Ref_to_Const'>TRIGGER_EVENT_DELETE</span></a> <span class='Operator'>&& 
</span>             <a href="trigger.c.html#LN5096"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN76"><span class='Ref_to_Member'>trig_delete_old_table</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>            <span class='Parentheses'>(</span><a href="trigger.c.html#LN5091"><span class='Ref_to_Parameter'>event</span></a> <span class='Operator'>== </span><a href="../../include/commands/trigger.h.html#LN53"><span class='Ref_to_Const'>TRIGGER_EVENT_UPDATE</span></a> <span class='Operator'>&& 
</span>             <a href="trigger.c.html#LN5096"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN74"><span class='Ref_to_Member'>trig_update_old_table</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN5128"></a>            <a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Declare_Local'>old_tuplestore</span><span class='Delimiter'>; 
</span> 
            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5092"><span class='Ref_to_Parameter'>oldtup</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="trigger.c.html#LN5128"><span class='Ref_To_Local'>old_tuplestore</span></a> <span class='Operator'>= 
</span>                <a href="trigger.c.html#LN3450"><span class='Ref_to_Func'>GetTriggerTransitionTuplestore</span></a> 
                <span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3416"><span class='Ref_to_Member'>old_tuplestores</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/tuplestore.h.html#LN54"><span class='Ref_to_Proto'>tuplestore_puttuple</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN5128"><span class='Ref_To_Local'>old_tuplestore</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN5092"><span class='Ref_to_Parameter'>oldtup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="trigger.c.html#LN5091"><span class='Ref_to_Parameter'>event</span></a> <span class='Operator'>== </span><a href="../../include/commands/trigger.h.html#LN51"><span class='Ref_to_Const'>TRIGGER_EVENT_INSERT</span></a> <span class='Operator'>&& 
</span>             <a href="trigger.c.html#LN5096"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN73"><span class='Ref_to_Member'>trig_insert_new_table</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>            <span class='Parentheses'>(</span><a href="trigger.c.html#LN5091"><span class='Ref_to_Parameter'>event</span></a> <span class='Operator'>== </span><a href="../../include/commands/trigger.h.html#LN53"><span class='Ref_to_Const'>TRIGGER_EVENT_UPDATE</span></a> <span class='Operator'>&& 
</span>             <a href="trigger.c.html#LN5096"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN75"><span class='Ref_to_Member'>trig_update_new_table</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN5141"></a>            <a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Declare_Local'>new_tuplestore</span><span class='Delimiter'>; 
</span> 
            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5092"><span class='Ref_to_Parameter'>newtup</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="trigger.c.html#LN5141"><span class='Ref_To_Local'>new_tuplestore</span></a> <span class='Operator'>= 
</span>                <a href="trigger.c.html#LN3450"><span class='Ref_to_Func'>GetTriggerTransitionTuplestore</span></a> 
                <span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3417"><span class='Ref_to_Member'>new_tuplestores</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/tuplestore.h.html#LN54"><span class='Ref_to_Proto'>tuplestore_puttuple</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN5141"><span class='Ref_To_Local'>new_tuplestore</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN5092"><span class='Ref_to_Parameter'>newtup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* If transition tables are the only reason we're here, return. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="trigger.c.html#LN5091"><span class='Ref_to_Parameter'>event</span></a> <span class='Operator'>== </span><a href="../../include/commands/trigger.h.html#LN52"><span class='Ref_to_Const'>TRIGGER_EVENT_DELETE</span></a> <span class='Operator'>&& !</span><a href="trigger.c.html#LN5096"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN65"><span class='Ref_to_Member'>trig_delete_after_row</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <span class='Parentheses'>(</span><a href="trigger.c.html#LN5091"><span class='Ref_to_Parameter'>event</span></a> <span class='Operator'>== </span><a href="../../include/commands/trigger.h.html#LN51"><span class='Ref_to_Const'>TRIGGER_EVENT_INSERT</span></a> <span class='Operator'>&& !</span><a href="trigger.c.html#LN5096"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN55"><span class='Ref_to_Member'>trig_insert_after_row</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>         <span class='Parentheses'>(</span><a href="trigger.c.html#LN5091"><span class='Ref_to_Parameter'>event</span></a> <span class='Operator'>== </span><a href="../../include/commands/trigger.h.html#LN53"><span class='Ref_to_Const'>TRIGGER_EVENT_UPDATE</span></a> <span class='Operator'>&& !</span><a href="trigger.c.html#LN5096"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN60"><span class='Ref_to_Member'>trig_update_after_row</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if row_trigger &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Validate the event code and collect the associated tuple CTIDs. 
     * 
     * The event code will be used both as a bitmask and an array offset, so 
     * validation is important to make sure we don't walk off the edge of our 
     * arrays. 
     */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN5091"><span class='Ref_to_Parameter'>event</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/commands/trigger.h.html#LN51"><span class='Ref_to_Const'>TRIGGER_EVENT_INSERT</span></a><span class='Operator'>: 
</span>            <a href="trigger.c.html#LN5100"><span class='Ref_To_Local'>tgtype_event</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_trigger.h.html#LN99"><span class='Ref_to_Const'>TRIGGER_TYPE_INSERT</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN5091"><span class='Ref_to_Parameter'>row_trigger</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5092"><span class='Ref_to_Parameter'>oldtup</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5092"><span class='Ref_to_Parameter'>newtup</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/storage/itemptr.h.html#LN137"><span class='Ref_to_Macro'>ItemPointerCopy</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5092"><span class='Ref_to_Parameter'>newtup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5097"><span class='Ref_To_Local'>new_event</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3283"><span class='Ref_to_Member'>ate_ctid1</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="../../include/storage/itemptr.h.html#LN148"><span class='Ref_to_Macro'>ItemPointerSetInvalid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5097"><span class='Ref_To_Local'>new_event</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3284"><span class='Ref_to_Member'>ate_ctid2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5092"><span class='Ref_to_Parameter'>oldtup</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5092"><span class='Ref_to_Parameter'>newtup</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/storage/itemptr.h.html#LN148"><span class='Ref_to_Macro'>ItemPointerSetInvalid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5097"><span class='Ref_To_Local'>new_event</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3283"><span class='Ref_to_Member'>ate_ctid1</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="../../include/storage/itemptr.h.html#LN148"><span class='Ref_to_Macro'>ItemPointerSetInvalid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5097"><span class='Ref_To_Local'>new_event</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3284"><span class='Ref_to_Member'>ate_ctid2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/commands/trigger.h.html#LN52"><span class='Ref_to_Const'>TRIGGER_EVENT_DELETE</span></a><span class='Operator'>: 
</span>            <a href="trigger.c.html#LN5100"><span class='Ref_To_Local'>tgtype_event</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_trigger.h.html#LN100"><span class='Ref_to_Const'>TRIGGER_TYPE_DELETE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN5091"><span class='Ref_to_Parameter'>row_trigger</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5092"><span class='Ref_to_Parameter'>oldtup</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5092"><span class='Ref_to_Parameter'>newtup</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/storage/itemptr.h.html#LN137"><span class='Ref_to_Macro'>ItemPointerCopy</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5092"><span class='Ref_to_Parameter'>oldtup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5097"><span class='Ref_To_Local'>new_event</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3283"><span class='Ref_to_Member'>ate_ctid1</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="../../include/storage/itemptr.h.html#LN148"><span class='Ref_to_Macro'>ItemPointerSetInvalid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5097"><span class='Ref_To_Local'>new_event</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3284"><span class='Ref_to_Member'>ate_ctid2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5092"><span class='Ref_to_Parameter'>oldtup</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5092"><span class='Ref_to_Parameter'>newtup</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/storage/itemptr.h.html#LN148"><span class='Ref_to_Macro'>ItemPointerSetInvalid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5097"><span class='Ref_To_Local'>new_event</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3283"><span class='Ref_to_Member'>ate_ctid1</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="../../include/storage/itemptr.h.html#LN148"><span class='Ref_to_Macro'>ItemPointerSetInvalid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5097"><span class='Ref_To_Local'>new_event</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3284"><span class='Ref_to_Member'>ate_ctid2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/commands/trigger.h.html#LN53"><span class='Ref_to_Const'>TRIGGER_EVENT_UPDATE</span></a><span class='Operator'>: 
</span>            <a href="trigger.c.html#LN5100"><span class='Ref_To_Local'>tgtype_event</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_trigger.h.html#LN101"><span class='Ref_to_Const'>TRIGGER_TYPE_UPDATE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN5091"><span class='Ref_to_Parameter'>row_trigger</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5092"><span class='Ref_to_Parameter'>oldtup</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5092"><span class='Ref_to_Parameter'>newtup</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/storage/itemptr.h.html#LN137"><span class='Ref_to_Macro'>ItemPointerCopy</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5092"><span class='Ref_to_Parameter'>oldtup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5097"><span class='Ref_To_Local'>new_event</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3283"><span class='Ref_to_Member'>ate_ctid1</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="../../include/storage/itemptr.h.html#LN137"><span class='Ref_to_Macro'>ItemPointerCopy</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5092"><span class='Ref_to_Parameter'>newtup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5097"><span class='Ref_To_Local'>new_event</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3284"><span class='Ref_to_Member'>ate_ctid2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5092"><span class='Ref_to_Parameter'>oldtup</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5092"><span class='Ref_to_Parameter'>newtup</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/storage/itemptr.h.html#LN148"><span class='Ref_to_Macro'>ItemPointerSetInvalid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5097"><span class='Ref_To_Local'>new_event</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3283"><span class='Ref_to_Member'>ate_ctid1</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="../../include/storage/itemptr.h.html#LN148"><span class='Ref_to_Macro'>ItemPointerSetInvalid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5097"><span class='Ref_To_Local'>new_event</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3284"><span class='Ref_to_Member'>ate_ctid2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/commands/trigger.h.html#LN54"><span class='Ref_to_Const'>TRIGGER_EVENT_TRUNCATE</span></a><span class='Operator'>: 
</span>            <a href="trigger.c.html#LN5100"><span class='Ref_To_Local'>tgtype_event</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_trigger.h.html#LN102"><span class='Ref_to_Const'>TRIGGER_TYPE_TRUNCATE</span></a><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5092"><span class='Ref_to_Parameter'>oldtup</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5092"><span class='Ref_to_Parameter'>newtup</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/storage/itemptr.h.html#LN148"><span class='Ref_to_Macro'>ItemPointerSetInvalid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5097"><span class='Ref_To_Local'>new_event</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3283"><span class='Ref_to_Member'>ate_ctid1</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../include/storage/itemptr.h.html#LN148"><span class='Ref_to_Macro'>ItemPointerSetInvalid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5097"><span class='Ref_To_Local'>new_event</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3284"><span class='Ref_to_Member'>ate_ctid2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid after-trigger event code: %d"</span><span class='Delimiter'>, </span><a href="trigger.c.html#LN5091"><span class='Ref_to_Parameter'>event</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="trigger.c.html#LN5100"><span class='Ref_To_Local'>tgtype_event</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch event &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5099"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a> <span class='Operator'>&& </span><a href="trigger.c.html#LN5091"><span class='Ref_to_Parameter'>row_trigger</span></a><span class='Parentheses'>))</span> 
        <a href="trigger.c.html#LN5097"><span class='Ref_To_Local'>new_event</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3282"><span class='Ref_to_Member'>ate_flags</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5091"><span class='Ref_to_Parameter'>row_trigger</span></a> <span class='Operator'>&& </span><a href="trigger.c.html#LN5091"><span class='Ref_to_Parameter'>event</span></a> <span class='Operator'>== </span><a href="../../include/commands/trigger.h.html#LN53"><span class='Ref_to_Const'>TRIGGER_EVENT_UPDATE</span></a><span class='Parentheses'>) </span><span class='Operator'>? 
</span>            <a href="trigger.c.html#LN3265"><span class='Ref_to_Const'>AFTER_TRIGGER_2CTID</span></a> <span class='Operator'>: </span><a href="trigger.c.html#LN3264"><span class='Ref_to_Const'>AFTER_TRIGGER_1CTID</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* else, we'll initialize ate_flags for each trigger */ 
</span> 
    <a href="trigger.c.html#LN5101"><span class='Ref_To_Local'>tgtype_level</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="trigger.c.html#LN5091"><span class='Ref_to_Parameter'>row_trigger</span></a> <span class='Operator'>? </span><a href="../../include/catalog/pg_trigger.h.html#LN97"><span class='Ref_to_Const'>TRIGGER_TYPE_ROW</span></a> <span class='Operator'>: </span><a href="../../include/catalog/pg_trigger.h.html#LN106"><span class='Ref_to_Const'>TRIGGER_TYPE_STATEMENT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN5102"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="trigger.c.html#LN5102"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="trigger.c.html#LN5096"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN48"><span class='Ref_to_Member'>numtriggers</span></a><span class='Delimiter'>; </span><a href="trigger.c.html#LN5102"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5239"></a>        <a href="../../include/utils/reltrigger.h.html#LN22"><span class='Ref_to_Struct'>Trigger</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>trigger</span> <span class='Operator'>= &</span><a href="trigger.c.html#LN5096"><span class='Ref_To_Local'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN47"><span class='Ref_to_Member'>triggers</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN5102"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/catalog/pg_trigger.h.html#LN145"><span class='Ref_to_Macro'>TRIGGER_TYPE_MATCHES</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN5239"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN28"><span class='Ref_to_Member'>tgtype</span></a><span class='Delimiter'>, 
</span>                                  <a href="trigger.c.html#LN5101"><span class='Ref_To_Local'>tgtype_level</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/catalog/pg_trigger.h.html#LN111"><span class='Ref_to_Const'>TRIGGER_TYPE_AFTER</span></a><span class='Delimiter'>, 
</span>                                  <a href="trigger.c.html#LN5100"><span class='Ref_To_Local'>tgtype_event</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="trigger.c.html#LN86"><span class='Ref_to_Proto'>TriggerEnabled</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN5090"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN5090"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN5239"><span class='Ref_To_Local'>trigger</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN5091"><span class='Ref_to_Parameter'>event</span></a><span class='Delimiter'>, 
</span>                            <a href="trigger.c.html#LN5093"><span class='Ref_to_Parameter'>modifiedCols</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN5092"><span class='Ref_to_Parameter'>oldtup</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN5092"><span class='Ref_to_Parameter'>newtup</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN5099"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a> <span class='Operator'>&& </span><a href="trigger.c.html#LN5091"><span class='Ref_to_Parameter'>row_trigger</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN5103"><span class='Ref_To_Local'>fdw_tuplestore</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="trigger.c.html#LN5103"><span class='Ref_To_Local'>fdw_tuplestore</span></a> <span class='Operator'>= 
</span>                    <a href="trigger.c.html#LN3450"><span class='Ref_to_Func'>GetTriggerTransitionTuplestore</span></a> 
                    <span class='Parentheses'>(</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3414"><span class='Ref_to_Member'>fdw_tuplestores</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="trigger.c.html#LN5097"><span class='Ref_To_Local'>new_event</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3282"><span class='Ref_to_Member'>ate_flags</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3263"><span class='Ref_to_Const'>AFTER_TRIGGER_FDW_FETCH</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
                <span class='Comment_Multi_Line'>/* subsequent event for the same tuple */ 
</span>                <a href="trigger.c.html#LN5097"><span class='Ref_To_Local'>new_event</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3282"><span class='Ref_to_Member'>ate_flags</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN3262"><span class='Ref_to_Const'>AFTER_TRIGGER_FDW_REUSE</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If the trigger is a foreign key enforcement trigger, there are 
         * certain cases where we can skip queueing the event because we can 
         * tell by inspection that the FK constraint will still pass. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/commands/trigger.h.html#LN75"><span class='Ref_to_Macro'>TRIGGER_FIRED_BY_UPDATE</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN5091"><span class='Ref_to_Parameter'>event</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="../../include/commands/trigger.h.html#LN212"><span class='Ref_to_Proto'>RI_FKey_trigger_type</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN5239"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN27"><span class='Ref_to_Member'>tgfoid</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>case</span> <a href="../../include/commands/trigger.h.html#LN208"><span class='Ref_to_Const'>RI_TRIGGER_PK</span></a><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* Update on trigger's PK table */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/commands/trigger.h.html#LN200"><span class='Ref_to_Proto'>RI_FKey_pk_upd_check_required</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN5239"><span class='Ref_To_Local'>trigger</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN5095"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, 
</span>                                                       <a href="trigger.c.html#LN5092"><span class='Ref_to_Parameter'>oldtup</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN5092"><span class='Ref_to_Parameter'>newtup</span></a><span class='Parentheses'>))</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* skip queuing this event */ 
</span>                        <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <a href="../../include/commands/trigger.h.html#LN209"><span class='Ref_to_Const'>RI_TRIGGER_FK</span></a><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* Update on trigger's FK table */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/commands/trigger.h.html#LN202"><span class='Ref_to_Proto'>RI_FKey_fk_upd_check_required</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN5239"><span class='Ref_To_Local'>trigger</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN5095"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, 
</span>                                                       <a href="trigger.c.html#LN5092"><span class='Ref_to_Parameter'>oldtup</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN5092"><span class='Ref_to_Parameter'>newtup</span></a><span class='Parentheses'>))</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* skip queuing this event */ 
</span>                        <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <a href="../../include/commands/trigger.h.html#LN210"><span class='Ref_to_Const'>RI_TRIGGER_NONE</span></a><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* Not an FK trigger */ 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch RI_FKey_trigger_type(... &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if TRIGGER_FIRED_BY_UPDA... &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * If the trigger is a deferred unique constraint check trigger, only 
         * queue it if the unique constraint was potentially violated, which 
         * we know from index insertion time. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN5239"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN27"><span class='Ref_to_Member'>tgfoid</span></a> <span class='Operator'>== </span>F_UNIQUE_KEY_RECHECK<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/nodes/pg_list.h.html#LN231"><span class='Ref_to_Proto'>list_member_oid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN5093"><span class='Ref_to_Parameter'>recheckIndexes</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN5239"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN32"><span class='Ref_to_Member'>tgconstrindid</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>continue</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* Uniqueness definitely not violated */ 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Fill in event structure and add it to the current query's queue. 
         */ 
</span>        <a href="trigger.c.html#LN5098"><span class='Ref_To_Local'>new_shared</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3272"><span class='Ref_to_Member'>ats_event</span></a> <span class='Operator'>= 
</span>            <span class='Parentheses'>(</span><a href="trigger.c.html#LN5091"><span class='Ref_to_Parameter'>event</span></a> <span class='Operator'>& </span><a href="../../include/commands/trigger.h.html#LN55"><span class='Ref_to_Const'>TRIGGER_EVENT_OPMASK</span></a><span class='Parentheses'>) </span><span class='Operator'>| 
</span>            <span class='Parentheses'>(</span><a href="trigger.c.html#LN5091"><span class='Ref_to_Parameter'>row_trigger</span></a> <span class='Operator'>? </span><a href="../../include/commands/trigger.h.html#LN57"><span class='Ref_to_Const'>TRIGGER_EVENT_ROW</span></a> <span class='Operator'>: </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>| 
</span>            <span class='Parentheses'>(</span><a href="trigger.c.html#LN5239"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN34"><span class='Ref_to_Member'>tgdeferrable</span></a> <span class='Operator'>? </span><a href="../../include/commands/trigger.h.html#LN66"><span class='Ref_to_Const'>AFTER_TRIGGER_DEFERRABLE</span></a> <span class='Operator'>: </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>| 
</span>            <span class='Parentheses'>(</span><a href="trigger.c.html#LN5239"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN35"><span class='Ref_to_Member'>tginitdeferred</span></a> <span class='Operator'>? </span><a href="../../include/commands/trigger.h.html#LN67"><span class='Ref_to_Const'>AFTER_TRIGGER_INITDEFERRED</span></a> <span class='Operator'>: </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN5098"><span class='Ref_To_Local'>new_shared</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3273"><span class='Ref_to_Member'>ats_tgoid</span></a> <span class='Operator'>= </span><a href="trigger.c.html#LN5239"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN24"><span class='Ref_to_Member'>tgoid</span></a><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN5098"><span class='Ref_To_Local'>new_shared</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3274"><span class='Ref_to_Member'>ats_relid</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN5095"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="trigger.c.html#LN5098"><span class='Ref_To_Local'>new_shared</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3275"><span class='Ref_to_Member'>ats_firing_id</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <a href="trigger.c.html#LN3540"><span class='Ref_to_Func'>afterTriggerAddEvent</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3413"><span class='Ref_to_Member'>query_stack</span></a><span class='Delimiter'>[</span><a href="trigger.c.html#LN3430"><span class='Ref_to_Global_Var'>afterTriggers</span></a><span class='Operator'>.</span><a href="trigger.c.html#LN3412"><span class='Ref_to_Member'>query_depth</span></a><span class='Delimiter'>], 
</span>                             <span class='Operator'>&</span><a href="trigger.c.html#LN5097"><span class='Ref_To_Local'>new_event</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="trigger.c.html#LN5098"><span class='Ref_To_Local'>new_shared</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;trigdesc-&GT;numtr... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Finally, spool any foreign tuple(s).  The tuplestore squashes them to 
     * minimal tuples, so this loses any system columns.  The executor lost 
     * those columns before us, for an unrelated reason, so this is fine. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN5103"><span class='Ref_To_Local'>fdw_tuplestore</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN5092"><span class='Ref_to_Parameter'>oldtup</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="../../include/utils/tuplestore.h.html#LN54"><span class='Ref_to_Proto'>tuplestore_puttuple</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN5103"><span class='Ref_To_Local'>fdw_tuplestore</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN5092"><span class='Ref_to_Parameter'>oldtup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN5092"><span class='Ref_to_Parameter'>newtup</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="../../include/utils/tuplestore.h.html#LN54"><span class='Ref_to_Proto'>tuplestore_puttuple</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN5103"><span class='Ref_To_Local'>fdw_tuplestore</span></a><span class='Delimiter'>, </span><a href="trigger.c.html#LN5092"><span class='Ref_to_Parameter'>newtup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end AfterTriggerSaveEvent &raquo; </span> 
 
<a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN5341"></a><span class='Declare_Function'>pg_trigger_depth</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="trigger.c.html#LN66"><span class='Ref_to_Global_Var'>MyTriggerDepth</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>