<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\commands\typecmds.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\commands\typecmds.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:37 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * typecmds.c 
 *    Routines for SQL commands that manipulate types (and domains). 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/commands/typecmds.c 
 * 
 * DESCRIPTION 
 *    The "DefineFoo" routines take the parse tree and pick out the 
 *    appropriate arguments/flags, passing the results to the 
 *    corresponding "FooDefine" routines (in src/catalog) that do 
 *    the actual catalog-munging.  These routines also verify permission 
 *    of the user to execute the command. 
 * 
 * NOTES 
 *    These things must be defined and committed in the following order: 
 *      "create function": 
 *              input/output, recv/send functions 
 *      "create type": 
 *              type 
 *      "create operator": 
 *              operators 
 * 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xact.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/binary_upgrade.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/catalog.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/heap.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/objectaccess.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_am.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_authid.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_collation.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_constraint.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_constraint_fn.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_depend.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_enum.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_language.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_namespace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_proc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_proc_fn.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_range.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type_fn.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/defrem.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/tablecmds.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/typecmds.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"executor/executor.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/makefuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/var.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_coerce.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_collate.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_expr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_func.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/fmgroids.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/ruleutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/snapmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* result structure for get_rels_with_domain() */ 
</span><span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN78"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Member'>rel</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* opened and locked relation */ 
</span><a name="LN79"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>natts</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* number of attributes of interest */ 
</span><a name="LN80"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Member'>atts</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* attribute numbers */ 
</span>    <span class='Comment_Multi_Line'>/* atts[] is of allocated length RelationGetNumberOfAttributes(rel) */ 
</span><a name="LN82"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>RelToCheck</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* Potentially set by pg_upgrade_support functions */ 
</span><a name="LN85"></a><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Var'>binary_upgrade_next_array_pg_type_oid</span> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
<a name="LN87"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>makeRangeConstructors</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>namespace</span><span class='Delimiter'>, 
</span><a name="LN88"></a>                      <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>rangeOid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>subtype</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN89"></a><span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>  <span class='Declare_Prototype'>findTypeInputFunction</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>procname</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeOid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN90"></a><span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>  <span class='Declare_Prototype'>findTypeOutputFunction</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>procname</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeOid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN91"></a><span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>  <span class='Declare_Prototype'>findTypeReceiveFunction</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>procname</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeOid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN92"></a><span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>  <span class='Declare_Prototype'>findTypeSendFunction</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>procname</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeOid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN93"></a><span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>  <span class='Declare_Prototype'>findTypeTypmodinFunction</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>procname</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN94"></a><span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>  <span class='Declare_Prototype'>findTypeTypmodoutFunction</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>procname</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN95"></a><span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>  <span class='Declare_Prototype'>findTypeAnalyzeFunction</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>procname</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeOid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN96"></a><span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>  <span class='Declare_Prototype'>findRangeSubOpclass</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>opcname</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>subtype</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN97"></a><span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>  <span class='Declare_Prototype'>findRangeCanonicalFunction</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>procname</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeOid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN98"></a><span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>  <span class='Declare_Prototype'>findRangeSubtypeDiffFunction</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>procname</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>subtype</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN99"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>validateDomainConstraint</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>domainoid</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>ccbin</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN100"></a><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>get_rels_with_domain</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>domainOid</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN101"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>checkEnumOwner</span><span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tup</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN102"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Prototype'>domainAddConstraint</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>domainOid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>domainNamespace</span><span class='Delimiter'>, 
</span><a name="LN103"></a>                    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>baseTypeOid</span><span class='Delimiter'>, 
</span><a name="LN104"></a>                    <span class='Keyword'>int </span><span class='Declare_Parameter'>typMod</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2050"><span class='Ref_to_Struct'>Constraint</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>constr</span><span class='Delimiter'>, 
</span><a name="LN105"></a>                    <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>domainName</span><span class='Delimiter'>, </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>constrAddr</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN106"></a><span class='Keyword'>static </span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>replace_domain_constraint_value</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, 
</span><a name="LN107"></a>                                <a href="../../include/nodes/parsenodes.h.html#LN231"><span class='Ref_to_Struct'>ColumnRef</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cref</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * DefineType 
 *      Registers a new base type. 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN115"></a><span class='Declare_Function'>DefineType</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>names</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parameters</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN117"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>typeName</span><span class='Delimiter'>; 
</span><a name="LN118"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typeNamespace</span><span class='Delimiter'>; 
</span><a name="LN119"></a>    <a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>internalLength</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* default: variable-length */ 
</span><a name="LN120"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>inputName</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN121"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>outputName</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN122"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>receiveName</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN123"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>sendName</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN124"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>typmodinName</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN125"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>typmodoutName</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN126"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>analyzeName</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN127"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>category</span> <span class='Operator'>= </span><a href="../../include/catalog/pg_type.h.html#LN739"><span class='Ref_to_Const'>TYPCATEGORY_USER</span></a><span class='Delimiter'>; 
</span><a name="LN128"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>preferred</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN129"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>delimiter</span> <span class='Operator'>= </span><a href="../../include/commands/typecmds.h.html#LN21"><span class='Ref_to_Const'>DEFAULT_TYPDELIM</span></a><span class='Delimiter'>; 
</span><a name="LN130"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>elemType</span> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span><a name="LN131"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>defaultValue</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN132"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>byValue</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN133"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>alignment</span> <span class='Operator'>= </span><span class='String'>'i'</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* default alignment */ 
</span><a name="LN134"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>storage</span> <span class='Operator'>= </span><span class='String'>'p'</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* default TOAST storage method */ 
</span><a name="LN135"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>collation</span> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span><a name="LN136"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>likeTypeEl</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN137"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>internalLengthEl</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN138"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>inputNameEl</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN139"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>outputNameEl</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN140"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>receiveNameEl</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN141"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>sendNameEl</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN142"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>typmodinNameEl</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN143"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>typmodoutNameEl</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN144"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>analyzeNameEl</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN145"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>categoryEl</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN146"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>preferredEl</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN147"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>delimiterEl</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN148"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>elemTypeEl</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN149"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>defaultValueEl</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN150"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>byValueEl</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN151"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>alignmentEl</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN152"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>storageEl</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN153"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>collatableEl</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN154"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>inputOid</span><span class='Delimiter'>; 
</span><a name="LN155"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>outputOid</span><span class='Delimiter'>; 
</span><a name="LN156"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>receiveOid</span> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span><a name="LN157"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>sendOid</span> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span><a name="LN158"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typmodinOid</span> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span><a name="LN159"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typmodoutOid</span> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span><a name="LN160"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>analyzeOid</span> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span><a name="LN161"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>array_type</span><span class='Delimiter'>; 
</span><a name="LN162"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>array_oid</span><span class='Delimiter'>; 
</span><a name="LN163"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typoid</span><span class='Delimiter'>; 
</span><a name="LN164"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>resulttype</span><span class='Delimiter'>; 
</span><a name="LN165"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>pl</span><span class='Delimiter'>; 
</span><a name="LN166"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * As of Postgres 8.4, we require superuser privilege to create a base 
     * type.  This is simple paranoia: there are too many ways to mess up the 
     * system with an incorrect type definition (for instance, representation 
     * parameters that don't match what the C code expects).  In practice it 
     * takes superuser privilege to create the I/O functions, and so the 
     * former requirement that you own the I/O functions pretty much forced 
     * superuserness anyway.  We're just making doubly sure here. 
     * 
     * XXX re-enable NOT_USED code sections below if you remove this test. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>())</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"must be superuser to create a base type"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Convert list of names to a name and namespace */ 
</span>    <a href="typecmds.c.html#LN118"><span class='Ref_To_Local'>typeNamespace</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN118"><span class='Ref_to_Proto'>QualifiedNameGetCreationNamespace</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN115"><span class='Ref_to_Parameter'>names</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="typecmds.c.html#LN117"><span class='Ref_To_Local'>typeName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> NOT_USED 
    <span class='Comment_Multi_Line'>/* XXX this is unnecessary given the superuser check above */ 
</span>    <span class='Comment_Multi_Line'>/* Check we have creation rights in target namespace */ 
</span>    aclresult <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN289"><span class='Ref_to_Proto'>pg_namespace_aclcheck</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN118"><span class='Ref_To_Local'>typeNamespace</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN81"><span class='Ref_to_Const'>ACL_CREATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>aclresult <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span>aclresult<span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN189"><span class='Ref_to_EnumConst'>ACL_KIND_NAMESPACE</span></a><span class='Delimiter'>, 
</span>                       <a href="../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN118"><span class='Ref_To_Local'>typeNamespace</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Look to see if type already exists (presumably as a shell; if not, 
     * TypeCreate will complain). 
     */ 
</span>    <a href="typecmds.c.html#LN163"><span class='Ref_To_Local'>typoid</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN184"><span class='Ref_to_Macro'>GetSysCacheOid2</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN106"><span class='Ref_to_EnumConst'>TYPENAMENSP</span></a><span class='Delimiter'>, 
</span>                             <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN117"><span class='Ref_To_Local'>typeName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN118"><span class='Ref_To_Local'>typeNamespace</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If it's not a shell, see if it's an autogenerated array type, and if so 
     * rename it out of the way. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN163"><span class='Ref_To_Local'>typoid</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="../../include/utils/lsyscache.h.html#LN132"><span class='Ref_to_Proto'>get_typisdefined</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN163"><span class='Ref_To_Local'>typoid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/pg_type_fn.h.html#LN80"><span class='Ref_to_Proto'>moveArrayTypeName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN163"><span class='Ref_To_Local'>typoid</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN117"><span class='Ref_To_Local'>typeName</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN118"><span class='Ref_To_Local'>typeNamespace</span></a><span class='Parentheses'>))</span> 
            <a href="typecmds.c.html#LN163"><span class='Ref_To_Local'>typoid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If it doesn't exist, create it as a shell, so that the OID is known for 
     * use in the I/O function definitions. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN163"><span class='Ref_To_Local'>typoid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="typecmds.c.html#LN166"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_type_fn.h.html#LN20"><span class='Ref_to_Proto'>TypeShellMake</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN117"><span class='Ref_To_Local'>typeName</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN118"><span class='Ref_To_Local'>typeNamespace</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>        <a href="typecmds.c.html#LN163"><span class='Ref_To_Local'>typoid</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN166"><span class='Ref_To_Local'>address</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Make new shell type visible for modification below */ 
</span>        <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If the command was a parameterless CREATE TYPE, we're done --- 
         * creating the shell type was all we're supposed to do. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN115"><span class='Ref_to_Parameter'>parameters</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="typecmds.c.html#LN166"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Complain if dummy CREATE TYPE and entry already exists */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN115"><span class='Ref_to_Parameter'>parameters</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/pg_basebackup/streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"type \"%s\" already exists"</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN117"><span class='Ref_To_Local'>typeName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Extract the parameters from the parameter list */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN165"><span class='Ref_To_Local'>pl</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN115"><span class='Ref_to_Parameter'>parameters</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN244"></a>        <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>defel</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN165"><span class='Ref_To_Local'>pl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN245"></a>        <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>   <span class='Operator'>**</span><span class='Declare_Local'>defelp</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN244"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"like"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="typecmds.c.html#LN245"><span class='Ref_To_Local'>defelp</span></a> <span class='Operator'>= &</span><a href="typecmds.c.html#LN136"><span class='Ref_To_Local'>likeTypeEl</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN244"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"internallength"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="typecmds.c.html#LN245"><span class='Ref_To_Local'>defelp</span></a> <span class='Operator'>= &</span><a href="typecmds.c.html#LN137"><span class='Ref_To_Local'>internalLengthEl</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN244"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"input"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="typecmds.c.html#LN245"><span class='Ref_To_Local'>defelp</span></a> <span class='Operator'>= &</span><a href="typecmds.c.html#LN138"><span class='Ref_To_Local'>inputNameEl</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN244"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"output"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="typecmds.c.html#LN245"><span class='Ref_To_Local'>defelp</span></a> <span class='Operator'>= &</span><a href="typecmds.c.html#LN139"><span class='Ref_To_Local'>outputNameEl</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN244"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"receive"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="typecmds.c.html#LN245"><span class='Ref_To_Local'>defelp</span></a> <span class='Operator'>= &</span><a href="typecmds.c.html#LN140"><span class='Ref_To_Local'>receiveNameEl</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN244"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"send"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="typecmds.c.html#LN245"><span class='Ref_To_Local'>defelp</span></a> <span class='Operator'>= &</span><a href="typecmds.c.html#LN141"><span class='Ref_To_Local'>sendNameEl</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN244"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"typmod_in"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="typecmds.c.html#LN245"><span class='Ref_To_Local'>defelp</span></a> <span class='Operator'>= &</span><a href="typecmds.c.html#LN142"><span class='Ref_To_Local'>typmodinNameEl</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN244"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"typmod_out"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="typecmds.c.html#LN245"><span class='Ref_To_Local'>defelp</span></a> <span class='Operator'>= &</span><a href="typecmds.c.html#LN143"><span class='Ref_To_Local'>typmodoutNameEl</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN244"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"analyze"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                 <a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN244"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"analyse"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="typecmds.c.html#LN245"><span class='Ref_To_Local'>defelp</span></a> <span class='Operator'>= &</span><a href="typecmds.c.html#LN144"><span class='Ref_To_Local'>analyzeNameEl</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN244"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"category"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="typecmds.c.html#LN245"><span class='Ref_To_Local'>defelp</span></a> <span class='Operator'>= &</span><a href="typecmds.c.html#LN145"><span class='Ref_To_Local'>categoryEl</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN244"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"preferred"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="typecmds.c.html#LN245"><span class='Ref_To_Local'>defelp</span></a> <span class='Operator'>= &</span><a href="typecmds.c.html#LN146"><span class='Ref_To_Local'>preferredEl</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN244"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"delimiter"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="typecmds.c.html#LN245"><span class='Ref_To_Local'>defelp</span></a> <span class='Operator'>= &</span><a href="typecmds.c.html#LN147"><span class='Ref_To_Local'>delimiterEl</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN244"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"element"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="typecmds.c.html#LN245"><span class='Ref_To_Local'>defelp</span></a> <span class='Operator'>= &</span><a href="typecmds.c.html#LN148"><span class='Ref_To_Local'>elemTypeEl</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN244"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"default"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="typecmds.c.html#LN245"><span class='Ref_To_Local'>defelp</span></a> <span class='Operator'>= &</span><a href="typecmds.c.html#LN149"><span class='Ref_To_Local'>defaultValueEl</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN244"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"passedbyvalue"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="typecmds.c.html#LN245"><span class='Ref_To_Local'>defelp</span></a> <span class='Operator'>= &</span><a href="typecmds.c.html#LN150"><span class='Ref_To_Local'>byValueEl</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN244"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"alignment"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="typecmds.c.html#LN245"><span class='Ref_To_Local'>defelp</span></a> <span class='Operator'>= &</span><a href="typecmds.c.html#LN151"><span class='Ref_To_Local'>alignmentEl</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN244"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"storage"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="typecmds.c.html#LN245"><span class='Ref_To_Local'>defelp</span></a> <span class='Operator'>= &</span><a href="typecmds.c.html#LN152"><span class='Ref_To_Local'>storageEl</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN244"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"collatable"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="typecmds.c.html#LN245"><span class='Ref_To_Local'>defelp</span></a> <span class='Operator'>= &</span><a href="typecmds.c.html#LN153"><span class='Ref_To_Local'>collatableEl</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* WARNING, not ERROR, for historical backwards-compatibility */ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"type attribute \"%s\" not recognized"</span><span class='Delimiter'>, 
</span>                            <a href="typecmds.c.html#LN244"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN115"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN244"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="typecmds.c.html#LN245"><span class='Ref_To_Local'>defelp</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN115"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN244"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="typecmds.c.html#LN245"><span class='Ref_To_Local'>defelp</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN244"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now interpret the options; we do this separately so that LIKE can be 
     * overridden by other options regardless of the ordering in the parameter 
     * list. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN136"><span class='Ref_To_Local'>likeTypeEl</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN309"></a>        <a href="../../include/parser/parse_type.h.html#LN19"><span class='Ref_to_Typedef'>Type</span></a>        <span class='Declare_Local'>likeType</span><span class='Delimiter'>; 
</span><a name="LN310"></a>        <a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a> <span class='Declare_Local'>likeForm</span><span class='Delimiter'>; 
</span> 
        <a href="typecmds.c.html#LN309"><span class='Ref_To_Local'>likeType</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN25"><span class='Ref_to_Proto'>typenameType</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="../../include/commands/defrem.h.html#LN162"><span class='Ref_to_Proto'>defGetTypeName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN136"><span class='Ref_To_Local'>likeTypeEl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="typecmds.c.html#LN310"><span class='Ref_To_Local'>likeForm</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN309"><span class='Ref_To_Local'>likeType</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="typecmds.c.html#LN119"><span class='Ref_To_Local'>internalLength</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN310"><span class='Ref_To_Local'>likeForm</span></a><span class='Operator'>-&GT;</span>typlen<span class='Delimiter'>; 
</span>        <a href="typecmds.c.html#LN132"><span class='Ref_To_Local'>byValue</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN310"><span class='Ref_To_Local'>likeForm</span></a><span class='Operator'>-&GT;</span>typbyval<span class='Delimiter'>; 
</span>        <a href="typecmds.c.html#LN133"><span class='Ref_To_Local'>alignment</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN310"><span class='Ref_To_Local'>likeForm</span></a><span class='Operator'>-&GT;</span>typalign<span class='Delimiter'>; 
</span>        <a href="typecmds.c.html#LN134"><span class='Ref_To_Local'>storage</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN310"><span class='Ref_To_Local'>likeForm</span></a><span class='Operator'>-&GT;</span>typstorage<span class='Delimiter'>; 
</span>        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN309"><span class='Ref_To_Local'>likeType</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN137"><span class='Ref_To_Local'>internalLengthEl</span></a><span class='Parentheses'>) 
</span>        <a href="typecmds.c.html#LN119"><span class='Ref_To_Local'>internalLength</span></a> <span class='Operator'>= </span><a href="../../include/commands/defrem.h.html#LN163"><span class='Ref_to_Proto'>defGetTypeLength</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN137"><span class='Ref_To_Local'>internalLengthEl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN138"><span class='Ref_To_Local'>inputNameEl</span></a><span class='Parentheses'>) 
</span>        <a href="typecmds.c.html#LN120"><span class='Ref_To_Local'>inputName</span></a> <span class='Operator'>= </span><a href="../../include/commands/defrem.h.html#LN161"><span class='Ref_to_Proto'>defGetQualifiedName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN138"><span class='Ref_To_Local'>inputNameEl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN139"><span class='Ref_To_Local'>outputNameEl</span></a><span class='Parentheses'>) 
</span>        <a href="typecmds.c.html#LN121"><span class='Ref_To_Local'>outputName</span></a> <span class='Operator'>= </span><a href="../../include/commands/defrem.h.html#LN161"><span class='Ref_to_Proto'>defGetQualifiedName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN139"><span class='Ref_To_Local'>outputNameEl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN140"><span class='Ref_To_Local'>receiveNameEl</span></a><span class='Parentheses'>) 
</span>        <a href="typecmds.c.html#LN122"><span class='Ref_To_Local'>receiveName</span></a> <span class='Operator'>= </span><a href="../../include/commands/defrem.h.html#LN161"><span class='Ref_to_Proto'>defGetQualifiedName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN140"><span class='Ref_To_Local'>receiveNameEl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN141"><span class='Ref_To_Local'>sendNameEl</span></a><span class='Parentheses'>) 
</span>        <a href="typecmds.c.html#LN123"><span class='Ref_To_Local'>sendName</span></a> <span class='Operator'>= </span><a href="../../include/commands/defrem.h.html#LN161"><span class='Ref_to_Proto'>defGetQualifiedName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN141"><span class='Ref_To_Local'>sendNameEl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN142"><span class='Ref_To_Local'>typmodinNameEl</span></a><span class='Parentheses'>) 
</span>        <a href="typecmds.c.html#LN124"><span class='Ref_To_Local'>typmodinName</span></a> <span class='Operator'>= </span><a href="../../include/commands/defrem.h.html#LN161"><span class='Ref_to_Proto'>defGetQualifiedName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN142"><span class='Ref_To_Local'>typmodinNameEl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN143"><span class='Ref_To_Local'>typmodoutNameEl</span></a><span class='Parentheses'>) 
</span>        <a href="typecmds.c.html#LN125"><span class='Ref_To_Local'>typmodoutName</span></a> <span class='Operator'>= </span><a href="../../include/commands/defrem.h.html#LN161"><span class='Ref_to_Proto'>defGetQualifiedName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN143"><span class='Ref_To_Local'>typmodoutNameEl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN144"><span class='Ref_To_Local'>analyzeNameEl</span></a><span class='Parentheses'>) 
</span>        <a href="typecmds.c.html#LN126"><span class='Ref_To_Local'>analyzeName</span></a> <span class='Operator'>= </span><a href="../../include/commands/defrem.h.html#LN161"><span class='Ref_to_Proto'>defGetQualifiedName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN144"><span class='Ref_To_Local'>analyzeNameEl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN145"><span class='Ref_To_Local'>categoryEl</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN338"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span> <span class='Operator'>= </span><a href="define.c.html#LN47"><span class='Ref_to_Func'>defGetString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN145"><span class='Ref_To_Local'>categoryEl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="typecmds.c.html#LN127"><span class='Ref_To_Local'>category</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN338"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>        <span class='Comment_Multi_Line'>/* restrict to non-control ASCII */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN127"><span class='Ref_To_Local'>category</span></a> <span class='Operator'>&LT; </span><span class='Number'>32</span> <span class='Operator'>|| </span><a href="typecmds.c.html#LN127"><span class='Ref_To_Local'>category</span></a> <span class='Operator'>&GT; </span><span class='Number'>126</span><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid type category \"%s\": must be simple ASCII"</span><span class='Delimiter'>, 
</span>                        <a href="typecmds.c.html#LN338"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN146"><span class='Ref_To_Local'>preferredEl</span></a><span class='Parentheses'>) 
</span>        <a href="typecmds.c.html#LN128"><span class='Ref_To_Local'>preferred</span></a> <span class='Operator'>= </span><a href="define.c.html#LN109"><span class='Ref_to_Func'>defGetBoolean</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN146"><span class='Ref_To_Local'>preferredEl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN147"><span class='Ref_To_Local'>delimiterEl</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN352"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span> <span class='Operator'>= </span><a href="define.c.html#LN47"><span class='Ref_to_Func'>defGetString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN147"><span class='Ref_To_Local'>delimiterEl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="typecmds.c.html#LN129"><span class='Ref_To_Local'>delimiter</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN352"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>        <span class='Comment_Multi_Line'>/* XXX shouldn't we restrict the delimiter? */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN148"><span class='Ref_To_Local'>elemTypeEl</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="typecmds.c.html#LN130"><span class='Ref_To_Local'>elemType</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN27"><span class='Ref_to_Proto'>typenameTypeId</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="../../include/commands/defrem.h.html#LN162"><span class='Ref_to_Proto'>defGetTypeName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN148"><span class='Ref_To_Local'>elemTypeEl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* disallow arrays of pseudotypes */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/lsyscache.h.html#LN149"><span class='Ref_to_Proto'>get_typtype</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN130"><span class='Ref_To_Local'>elemType</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN723"><span class='Ref_to_Const'>TYPTYPE_PSEUDO</span></a><span class='Parentheses'>)</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"array element type cannot be %s"</span><span class='Delimiter'>, 
</span>                            <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN130"><span class='Ref_To_Local'>elemType</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN149"><span class='Ref_To_Local'>defaultValueEl</span></a><span class='Parentheses'>) 
</span>        <a href="typecmds.c.html#LN131"><span class='Ref_To_Local'>defaultValue</span></a> <span class='Operator'>= </span><a href="define.c.html#LN47"><span class='Ref_to_Func'>defGetString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN149"><span class='Ref_To_Local'>defaultValueEl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN150"><span class='Ref_To_Local'>byValueEl</span></a><span class='Parentheses'>) 
</span>        <a href="typecmds.c.html#LN132"><span class='Ref_To_Local'>byValue</span></a> <span class='Operator'>= </span><a href="define.c.html#LN109"><span class='Ref_to_Func'>defGetBoolean</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN150"><span class='Ref_To_Local'>byValueEl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN151"><span class='Ref_To_Local'>alignmentEl</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN373"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>a</span> <span class='Operator'>= </span><a href="define.c.html#LN47"><span class='Ref_to_Func'>defGetString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN151"><span class='Ref_To_Local'>alignmentEl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Note: if argument was an unquoted identifier, parser will have 
         * applied translations to it, so be prepared to recognize translated 
         * type names as well as the nominal form. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN373"><span class='Ref_To_Local'>a</span></a><span class='Delimiter'>, </span><span class='String'>"double"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            <a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN373"><span class='Ref_To_Local'>a</span></a><span class='Delimiter'>, </span><span class='String'>"float8"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            <a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN373"><span class='Ref_To_Local'>a</span></a><span class='Delimiter'>, </span><span class='String'>"pg_catalog.float8"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="typecmds.c.html#LN133"><span class='Ref_To_Local'>alignment</span></a> <span class='Operator'>= </span><span class='String'>'d'</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN373"><span class='Ref_To_Local'>a</span></a><span class='Delimiter'>, </span><span class='String'>"int4"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                 <a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN373"><span class='Ref_To_Local'>a</span></a><span class='Delimiter'>, </span><span class='String'>"pg_catalog.int4"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="typecmds.c.html#LN133"><span class='Ref_To_Local'>alignment</span></a> <span class='Operator'>= </span><span class='String'>'i'</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN373"><span class='Ref_To_Local'>a</span></a><span class='Delimiter'>, </span><span class='String'>"int2"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                 <a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN373"><span class='Ref_To_Local'>a</span></a><span class='Delimiter'>, </span><span class='String'>"pg_catalog.int2"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="typecmds.c.html#LN133"><span class='Ref_To_Local'>alignment</span></a> <span class='Operator'>= </span><span class='String'>'s'</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN373"><span class='Ref_To_Local'>a</span></a><span class='Delimiter'>, </span><span class='String'>"char"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                 <a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN373"><span class='Ref_To_Local'>a</span></a><span class='Delimiter'>, </span><span class='String'>"pg_catalog.bpchar"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="typecmds.c.html#LN133"><span class='Ref_To_Local'>alignment</span></a> <span class='Operator'>= </span><span class='String'>'c'</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"alignment \"%s\" not recognized"</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN373"><span class='Ref_To_Local'>a</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if alignmentEl &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN152"><span class='Ref_To_Local'>storageEl</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN400"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>a</span> <span class='Operator'>= </span><a href="define.c.html#LN47"><span class='Ref_to_Func'>defGetString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN152"><span class='Ref_To_Local'>storageEl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN400"><span class='Ref_To_Local'>a</span></a><span class='Delimiter'>, </span><span class='String'>"plain"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="typecmds.c.html#LN134"><span class='Ref_To_Local'>storage</span></a> <span class='Operator'>= </span><span class='String'>'p'</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN400"><span class='Ref_To_Local'>a</span></a><span class='Delimiter'>, </span><span class='String'>"external"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="typecmds.c.html#LN134"><span class='Ref_To_Local'>storage</span></a> <span class='Operator'>= </span><span class='String'>'e'</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN400"><span class='Ref_To_Local'>a</span></a><span class='Delimiter'>, </span><span class='String'>"extended"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="typecmds.c.html#LN134"><span class='Ref_To_Local'>storage</span></a> <span class='Operator'>= </span><span class='String'>'x'</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN400"><span class='Ref_To_Local'>a</span></a><span class='Delimiter'>, </span><span class='String'>"main"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="typecmds.c.html#LN134"><span class='Ref_To_Local'>storage</span></a> <span class='Operator'>= </span><span class='String'>'m'</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"storage \"%s\" not recognized"</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN400"><span class='Ref_To_Local'>a</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN153"><span class='Ref_To_Local'>collatableEl</span></a><span class='Parentheses'>) 
</span>        <a href="typecmds.c.html#LN135"><span class='Ref_To_Local'>collation</span></a> <span class='Operator'>= </span><a href="define.c.html#LN109"><span class='Ref_to_Func'>defGetBoolean</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN153"><span class='Ref_To_Local'>collatableEl</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="../../include/catalog/pg_collation.h.html#LN74"><span class='Ref_to_Const'>DEFAULT_COLLATION_OID</span></a> <span class='Operator'>: </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * make sure we have our required definitions 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN120"><span class='Ref_To_Local'>inputName</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"type input function must be specified"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN121"><span class='Ref_To_Local'>outputName</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"type output function must be specified"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN124"><span class='Ref_To_Local'>typmodinName</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>&& </span><a href="typecmds.c.html#LN125"><span class='Ref_To_Local'>typmodoutName</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"type modifier output function is useless without a type modifier input function"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Convert I/O proc names to OIDs 
     */ 
</span>    <a href="typecmds.c.html#LN154"><span class='Ref_To_Local'>inputOid</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN89"><span class='Ref_to_Proto'>findTypeInputFunction</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN120"><span class='Ref_To_Local'>inputName</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN163"><span class='Ref_To_Local'>typoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN155"><span class='Ref_To_Local'>outputOid</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN90"><span class='Ref_to_Proto'>findTypeOutputFunction</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN121"><span class='Ref_To_Local'>outputName</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN163"><span class='Ref_To_Local'>typoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN122"><span class='Ref_To_Local'>receiveName</span></a><span class='Parentheses'>) 
</span>        <a href="typecmds.c.html#LN156"><span class='Ref_To_Local'>receiveOid</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN91"><span class='Ref_to_Proto'>findTypeReceiveFunction</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN122"><span class='Ref_To_Local'>receiveName</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN163"><span class='Ref_To_Local'>typoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN123"><span class='Ref_To_Local'>sendName</span></a><span class='Parentheses'>) 
</span>        <a href="typecmds.c.html#LN157"><span class='Ref_To_Local'>sendOid</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN92"><span class='Ref_to_Proto'>findTypeSendFunction</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN123"><span class='Ref_To_Local'>sendName</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN163"><span class='Ref_To_Local'>typoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Verify that I/O procs return the expected thing.  If we see OPAQUE, 
     * complain and change it to the correct type-safe choice. 
     */ 
</span>    <a href="typecmds.c.html#LN164"><span class='Ref_To_Local'>resulttype</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN112"><span class='Ref_to_Proto'>get_func_rettype</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN154"><span class='Ref_To_Local'>inputOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN164"><span class='Ref_To_Local'>resulttype</span></a> <span class='Operator'>!= </span><a href="typecmds.c.html#LN163"><span class='Ref_To_Local'>typoid</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN164"><span class='Ref_To_Local'>resulttype</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN699"><span class='Ref_to_Const'>OPAQUEOID</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* backwards-compatibility hack */ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"changing return type of function %s from %s to %s"</span><span class='Delimiter'>, 
</span>                         <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN120"><span class='Ref_To_Local'>inputName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"opaque"</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN117"><span class='Ref_To_Local'>typeName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="../../include/commands/defrem.h.html#LN51"><span class='Ref_to_Proto'>SetFunctionReturnType</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN154"><span class='Ref_To_Local'>inputOid</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN163"><span class='Ref_To_Local'>typoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"type input function %s must return type %s"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN120"><span class='Ref_To_Local'>inputName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN117"><span class='Ref_To_Local'>typeName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="typecmds.c.html#LN164"><span class='Ref_To_Local'>resulttype</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN112"><span class='Ref_to_Proto'>get_func_rettype</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN155"><span class='Ref_To_Local'>outputOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN164"><span class='Ref_To_Local'>resulttype</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_type.h.html#LN683"><span class='Ref_to_Const'>CSTRINGOID</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN164"><span class='Ref_To_Local'>resulttype</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN699"><span class='Ref_to_Const'>OPAQUEOID</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* backwards-compatibility hack */ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"changing return type of function %s from %s to %s"</span><span class='Delimiter'>, 
</span>                         <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN121"><span class='Ref_To_Local'>outputName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"opaque"</span><span class='Delimiter'>, </span><span class='String'>"cstring"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="../../include/commands/defrem.h.html#LN51"><span class='Ref_to_Proto'>SetFunctionReturnType</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN155"><span class='Ref_To_Local'>outputOid</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_type.h.html#LN683"><span class='Ref_to_Const'>CSTRINGOID</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"type output function %s must return type %s"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN121"><span class='Ref_To_Local'>outputName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"cstring"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN156"><span class='Ref_To_Local'>receiveOid</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="typecmds.c.html#LN164"><span class='Ref_To_Local'>resulttype</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN112"><span class='Ref_to_Proto'>get_func_rettype</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN156"><span class='Ref_To_Local'>receiveOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN164"><span class='Ref_To_Local'>resulttype</span></a> <span class='Operator'>!= </span><a href="typecmds.c.html#LN163"><span class='Ref_To_Local'>typoid</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"type receive function %s must return type %s"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN122"><span class='Ref_To_Local'>receiveName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN117"><span class='Ref_To_Local'>typeName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN157"><span class='Ref_To_Local'>sendOid</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="typecmds.c.html#LN164"><span class='Ref_To_Local'>resulttype</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN112"><span class='Ref_to_Proto'>get_func_rettype</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN157"><span class='Ref_To_Local'>sendOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN164"><span class='Ref_To_Local'>resulttype</span></a> <span class='Operator'>!= </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN18"><span class='Ref_to_Const'>BYTEAOID</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"type send function %s must return type %s"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN123"><span class='Ref_To_Local'>sendName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"bytea"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Convert typmodin/out function proc names to OIDs. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN124"><span class='Ref_To_Local'>typmodinName</span></a><span class='Parentheses'>) 
</span>        <a href="typecmds.c.html#LN158"><span class='Ref_To_Local'>typmodinOid</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN93"><span class='Ref_to_Proto'>findTypeTypmodinFunction</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN124"><span class='Ref_To_Local'>typmodinName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN125"><span class='Ref_To_Local'>typmodoutName</span></a><span class='Parentheses'>) 
</span>        <a href="typecmds.c.html#LN159"><span class='Ref_To_Local'>typmodoutOid</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN94"><span class='Ref_to_Proto'>findTypeTypmodoutFunction</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN125"><span class='Ref_To_Local'>typmodoutName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Convert analysis function proc name to an OID. If no analysis function 
     * is specified, we'll use zero to select the built-in default algorithm. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN126"><span class='Ref_To_Local'>analyzeName</span></a><span class='Parentheses'>) 
</span>        <a href="typecmds.c.html#LN160"><span class='Ref_To_Local'>analyzeOid</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN95"><span class='Ref_to_Proto'>findTypeAnalyzeFunction</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN126"><span class='Ref_To_Local'>analyzeName</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN163"><span class='Ref_To_Local'>typoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check permissions on functions.  We choose to require the creator/owner 
     * of a type to also own the underlying functions.  Since creating a type 
     * is tantamount to granting public execute access on the functions, the 
     * minimum sane check would be for execute-with-grant-option.  But we 
     * don't have a way to make the type go away if the grant option is 
     * revoked, so ownership seems better. 
     */ 
</span><span class='Directive'>#ifdef</span> NOT_USED 
    <span class='Comment_Multi_Line'>/* XXX this is unnecessary given the superuser check above */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN154"><span class='Ref_To_Local'>inputOid</span></a> <span class='Operator'>&& !</span><a href="../../include/utils/acl.h.html#LN311"><span class='Ref_to_Proto'>pg_proc_ownercheck</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN154"><span class='Ref_To_Local'>inputOid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN184"><span class='Ref_to_EnumConst'>ACL_KIND_PROC</span></a><span class='Delimiter'>, 
</span>                       <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN120"><span class='Ref_To_Local'>inputName</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN155"><span class='Ref_To_Local'>outputOid</span></a> <span class='Operator'>&& !</span><a href="../../include/utils/acl.h.html#LN311"><span class='Ref_to_Proto'>pg_proc_ownercheck</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN155"><span class='Ref_To_Local'>outputOid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN184"><span class='Ref_to_EnumConst'>ACL_KIND_PROC</span></a><span class='Delimiter'>, 
</span>                       <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN121"><span class='Ref_To_Local'>outputName</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN156"><span class='Ref_To_Local'>receiveOid</span></a> <span class='Operator'>&& !</span><a href="../../include/utils/acl.h.html#LN311"><span class='Ref_to_Proto'>pg_proc_ownercheck</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN156"><span class='Ref_To_Local'>receiveOid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN184"><span class='Ref_to_EnumConst'>ACL_KIND_PROC</span></a><span class='Delimiter'>, 
</span>                       <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN122"><span class='Ref_To_Local'>receiveName</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN157"><span class='Ref_To_Local'>sendOid</span></a> <span class='Operator'>&& !</span><a href="../../include/utils/acl.h.html#LN311"><span class='Ref_to_Proto'>pg_proc_ownercheck</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN157"><span class='Ref_To_Local'>sendOid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN184"><span class='Ref_to_EnumConst'>ACL_KIND_PROC</span></a><span class='Delimiter'>, 
</span>                       <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN123"><span class='Ref_To_Local'>sendName</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN158"><span class='Ref_To_Local'>typmodinOid</span></a> <span class='Operator'>&& !</span><a href="../../include/utils/acl.h.html#LN311"><span class='Ref_to_Proto'>pg_proc_ownercheck</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN158"><span class='Ref_To_Local'>typmodinOid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN184"><span class='Ref_to_EnumConst'>ACL_KIND_PROC</span></a><span class='Delimiter'>, 
</span>                       <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN124"><span class='Ref_To_Local'>typmodinName</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN159"><span class='Ref_To_Local'>typmodoutOid</span></a> <span class='Operator'>&& !</span><a href="../../include/utils/acl.h.html#LN311"><span class='Ref_to_Proto'>pg_proc_ownercheck</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN159"><span class='Ref_To_Local'>typmodoutOid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN184"><span class='Ref_to_EnumConst'>ACL_KIND_PROC</span></a><span class='Delimiter'>, 
</span>                       <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN125"><span class='Ref_To_Local'>typmodoutName</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN160"><span class='Ref_To_Local'>analyzeOid</span></a> <span class='Operator'>&& !</span><a href="../../include/utils/acl.h.html#LN311"><span class='Ref_to_Proto'>pg_proc_ownercheck</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN160"><span class='Ref_To_Local'>analyzeOid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN184"><span class='Ref_to_EnumConst'>ACL_KIND_PROC</span></a><span class='Delimiter'>, 
</span>                       <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN126"><span class='Ref_To_Local'>analyzeName</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Print warnings if any of the type's I/O functions are marked volatile. 
     * There is a general assumption that I/O functions are stable or 
     * immutable; this allows us for example to mark record_in/record_out 
     * stable rather than volatile.  Ideally we would throw errors not just 
     * warnings here; but since this check is new as of 9.5, and since the 
     * volatility marking might be just an error-of-omission and not a true 
     * indication of how the function behaves, we'll let it pass as a warning 
     * for now. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN154"><span class='Ref_To_Local'>inputOid</span></a> <span class='Operator'>&& </span><a href="../../include/utils/lsyscache.h.html#LN118"><span class='Ref_to_Proto'>func_volatile</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN154"><span class='Ref_To_Local'>inputOid</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../include/catalog/pg_proc.h.html#LN5484"><span class='Ref_to_Const'>PROVOLATILE_VOLATILE</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"type input function %s should not be volatile"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN120"><span class='Ref_To_Local'>inputName</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN155"><span class='Ref_To_Local'>outputOid</span></a> <span class='Operator'>&& </span><a href="../../include/utils/lsyscache.h.html#LN118"><span class='Ref_to_Proto'>func_volatile</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN155"><span class='Ref_To_Local'>outputOid</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../include/catalog/pg_proc.h.html#LN5484"><span class='Ref_to_Const'>PROVOLATILE_VOLATILE</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"type output function %s should not be volatile"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN121"><span class='Ref_To_Local'>outputName</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN156"><span class='Ref_To_Local'>receiveOid</span></a> <span class='Operator'>&& </span><a href="../../include/utils/lsyscache.h.html#LN118"><span class='Ref_to_Proto'>func_volatile</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN156"><span class='Ref_To_Local'>receiveOid</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../include/catalog/pg_proc.h.html#LN5484"><span class='Ref_to_Const'>PROVOLATILE_VOLATILE</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"type receive function %s should not be volatile"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN122"><span class='Ref_To_Local'>receiveName</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN157"><span class='Ref_To_Local'>sendOid</span></a> <span class='Operator'>&& </span><a href="../../include/utils/lsyscache.h.html#LN118"><span class='Ref_to_Proto'>func_volatile</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN157"><span class='Ref_To_Local'>sendOid</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../include/catalog/pg_proc.h.html#LN5484"><span class='Ref_to_Const'>PROVOLATILE_VOLATILE</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"type send function %s should not be volatile"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN123"><span class='Ref_To_Local'>sendName</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN158"><span class='Ref_To_Local'>typmodinOid</span></a> <span class='Operator'>&& </span><a href="../../include/utils/lsyscache.h.html#LN118"><span class='Ref_to_Proto'>func_volatile</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN158"><span class='Ref_To_Local'>typmodinOid</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../include/catalog/pg_proc.h.html#LN5484"><span class='Ref_to_Const'>PROVOLATILE_VOLATILE</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"type modifier input function %s should not be volatile"</span><span class='Delimiter'>, 
</span>                    <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN124"><span class='Ref_To_Local'>typmodinName</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN159"><span class='Ref_To_Local'>typmodoutOid</span></a> <span class='Operator'>&& </span><a href="../../include/utils/lsyscache.h.html#LN118"><span class='Ref_to_Proto'>func_volatile</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN159"><span class='Ref_To_Local'>typmodoutOid</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../include/catalog/pg_proc.h.html#LN5484"><span class='Ref_to_Const'>PROVOLATILE_VOLATILE</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"type modifier output function %s should not be volatile"</span><span class='Delimiter'>, 
</span>                   <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN125"><span class='Ref_To_Local'>typmodoutName</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * OK, we're done checking, time to make the type.  We must assign the 
     * array type OID ahead of calling TypeCreate, since the base type and 
     * array type each refer to the other. 
     */ 
</span>    <a href="typecmds.c.html#LN162"><span class='Ref_To_Local'>array_oid</span></a> <span class='Operator'>= </span><a href="../../include/commands/typecmds.h.html#LN30"><span class='Ref_to_Proto'>AssignTypeArrayOid</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * now have TypeCreate do all the real work. 
     * 
     * Note: the pg_type.oid is stored in user tables as array elements (base 
     * types) in ArrayType and in composite types in DatumTupleFields.  This 
     * oid must be preserved by binary upgrades. 
     */ 
</span>    <a href="typecmds.c.html#LN166"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= 
</span>        <a href="../../include/catalog/pg_type_fn.h.html#LN24"><span class='Ref_to_Proto'>TypeCreate</span></a><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* no predetermined type OID */ 
</span>                   <a href="typecmds.c.html#LN117"><span class='Ref_To_Local'>typeName</span></a><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* type name */ 
</span>                   <a href="typecmds.c.html#LN118"><span class='Ref_To_Local'>typeNamespace</span></a><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* namespace */ 
</span>                   <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* relation oid (n/a here) */ 
</span>                   <span class='Number'>0</span><span class='Delimiter'>,</span>           <span class='Comment_Single_Line'>/* relation kind (ditto) */ 
</span>                   <a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* owner's ID */ 
</span>                   <a href="typecmds.c.html#LN119"><span class='Ref_To_Local'>internalLength</span></a><span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* internal size */ 
</span>                   <a href="../../include/catalog/pg_type.h.html#LN719"><span class='Ref_to_Const'>TYPTYPE_BASE</span></a><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* type-type (base type) */ 
</span>                   <a href="typecmds.c.html#LN127"><span class='Ref_To_Local'>category</span></a><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* type-category */ 
</span>                   <a href="typecmds.c.html#LN128"><span class='Ref_To_Local'>preferred</span></a><span class='Delimiter'>,</span>   <span class='Comment_Single_Line'>/* is it a preferred type? */ 
</span>                   <a href="typecmds.c.html#LN129"><span class='Ref_To_Local'>delimiter</span></a><span class='Delimiter'>,</span>   <span class='Comment_Single_Line'>/* array element delimiter */ 
</span>                   <a href="typecmds.c.html#LN154"><span class='Ref_To_Local'>inputOid</span></a><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* input procedure */ 
</span>                   <a href="typecmds.c.html#LN155"><span class='Ref_To_Local'>outputOid</span></a><span class='Delimiter'>,</span>   <span class='Comment_Single_Line'>/* output procedure */ 
</span>                   <a href="typecmds.c.html#LN156"><span class='Ref_To_Local'>receiveOid</span></a><span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* receive procedure */ 
</span>                   <a href="typecmds.c.html#LN157"><span class='Ref_To_Local'>sendOid</span></a><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* send procedure */ 
</span>                   <a href="typecmds.c.html#LN158"><span class='Ref_To_Local'>typmodinOid</span></a><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* typmodin procedure */ 
</span>                   <a href="typecmds.c.html#LN159"><span class='Ref_To_Local'>typmodoutOid</span></a><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* typmodout procedure */ 
</span>                   <a href="typecmds.c.html#LN160"><span class='Ref_To_Local'>analyzeOid</span></a><span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* analyze procedure */ 
</span>                   <a href="typecmds.c.html#LN130"><span class='Ref_To_Local'>elemType</span></a><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* element type ID */ 
</span>                   <span class='Boolean'>false</span><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* this is not an array type */ 
</span>                   <a href="typecmds.c.html#LN162"><span class='Ref_To_Local'>array_oid</span></a><span class='Delimiter'>,</span>   <span class='Comment_Single_Line'>/* array type we are about to create */ 
</span>                   <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* base type ID (only for domains) */ 
</span>                   <a href="typecmds.c.html#LN131"><span class='Ref_To_Local'>defaultValue</span></a><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* default type value */ 
</span>                   <span class='Null_Value'>NULL</span><span class='Delimiter'>,</span>        <span class='Comment_Single_Line'>/* no binary form available */ 
</span>                   <a href="typecmds.c.html#LN132"><span class='Ref_To_Local'>byValue</span></a><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* passed by value */ 
</span>                   <a href="typecmds.c.html#LN133"><span class='Ref_To_Local'>alignment</span></a><span class='Delimiter'>,</span>   <span class='Comment_Single_Line'>/* required alignment */ 
</span>                   <a href="typecmds.c.html#LN134"><span class='Ref_To_Local'>storage</span></a><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* TOAST strategy */ 
</span>                   <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>,</span>          <span class='Comment_Single_Line'>/* typMod (Domains only) */ 
</span>                   <span class='Number'>0</span><span class='Delimiter'>,</span>           <span class='Comment_Single_Line'>/* Array Dimensions of typbasetype */ 
</span>                   <span class='Boolean'>false</span><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* Type NOT NULL */ 
</span>                   <a href="typecmds.c.html#LN135"><span class='Ref_To_Local'>collation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* type's collation */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="typecmds.c.html#LN163"><span class='Ref_To_Local'>typoid</span></a> <span class='Operator'>== </span><a href="typecmds.c.html#LN166"><span class='Ref_To_Local'>address</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create the array type that goes with it. 
     */ 
</span>    <a href="typecmds.c.html#LN161"><span class='Ref_To_Local'>array_type</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_type_fn.h.html#LN78"><span class='Ref_to_Proto'>makeArrayTypeName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN117"><span class='Ref_To_Local'>typeName</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN118"><span class='Ref_To_Local'>typeNamespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* alignment must be 'i' or 'd' for arrays */ 
</span>    <a href="typecmds.c.html#LN133"><span class='Ref_To_Local'>alignment</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="typecmds.c.html#LN133"><span class='Ref_To_Local'>alignment</span></a> <span class='Operator'>== </span><span class='String'>'d'</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='String'>'d'</span> <span class='Operator'>: </span><span class='String'>'i'</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/pg_type_fn.h.html#LN24"><span class='Ref_to_Proto'>TypeCreate</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN162"><span class='Ref_To_Local'>array_oid</span></a><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* force assignment of this type OID */ 
</span>               <a href="typecmds.c.html#LN161"><span class='Ref_To_Local'>array_type</span></a><span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* type name */ 
</span>               <a href="typecmds.c.html#LN118"><span class='Ref_To_Local'>typeNamespace</span></a><span class='Delimiter'>,</span>   <span class='Comment_Single_Line'>/* namespace */ 
</span>               <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* relation oid (n/a here) */ 
</span>               <span class='Number'>0</span><span class='Delimiter'>,</span>               <span class='Comment_Single_Line'>/* relation kind (ditto) */ 
</span>               <a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* owner's ID */ 
</span>               <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>,</span>              <span class='Comment_Single_Line'>/* internal size (always varlena) */ 
</span>               <a href="../../include/catalog/pg_type.h.html#LN719"><span class='Ref_to_Const'>TYPTYPE_BASE</span></a><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* type-type (base type) */ 
</span>               <a href="../../include/catalog/pg_type.h.html#LN727"><span class='Ref_to_Const'>TYPCATEGORY_ARRAY</span></a><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* type-category (array) */ 
</span>               <span class='Boolean'>false</span><span class='Delimiter'>,</span>           <span class='Comment_Single_Line'>/* array types are never preferred */ 
</span>               <a href="typecmds.c.html#LN129"><span class='Ref_To_Local'>delimiter</span></a><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* array element delimiter */ 
</span>               F_ARRAY_IN<span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* input procedure */ 
</span>               F_ARRAY_OUT<span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* output procedure */ 
</span>               F_ARRAY_RECV<span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* receive procedure */ 
</span>               F_ARRAY_SEND<span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* send procedure */ 
</span>               <a href="typecmds.c.html#LN158"><span class='Ref_To_Local'>typmodinOid</span></a><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* typmodin procedure */ 
</span>               <a href="typecmds.c.html#LN159"><span class='Ref_To_Local'>typmodoutOid</span></a><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* typmodout procedure */ 
</span>               F_ARRAY_TYPANALYZE<span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* analyze procedure */ 
</span>               <a href="typecmds.c.html#LN163"><span class='Ref_To_Local'>typoid</span></a><span class='Delimiter'>,</span>          <span class='Comment_Single_Line'>/* element type ID */ 
</span>               <span class='Boolean'>true</span><span class='Delimiter'>,</span>            <span class='Comment_Single_Line'>/* yes this is an array type */ 
</span>               <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* no further array type */ 
</span>               <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* base type ID */ 
</span>               <span class='Null_Value'>NULL</span><span class='Delimiter'>,</span>            <span class='Comment_Single_Line'>/* never a default type value */ 
</span>               <span class='Null_Value'>NULL</span><span class='Delimiter'>,</span>            <span class='Comment_Single_Line'>/* binary default isn't sent either */ 
</span>               <span class='Boolean'>false</span><span class='Delimiter'>,</span>           <span class='Comment_Single_Line'>/* never passed by value */ 
</span>               <a href="typecmds.c.html#LN133"><span class='Ref_To_Local'>alignment</span></a><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* see above */ 
</span>               <span class='String'>'x'</span><span class='Delimiter'>,</span>             <span class='Comment_Single_Line'>/* ARRAY is always toastable */ 
</span>               <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>,</span>              <span class='Comment_Single_Line'>/* typMod (Domains only) */ 
</span>               <span class='Number'>0</span><span class='Delimiter'>,</span>               <span class='Comment_Single_Line'>/* Array dimensions of typbasetype */ 
</span>               <span class='Boolean'>false</span><span class='Delimiter'>,</span>           <span class='Comment_Single_Line'>/* Type NOT NULL */ 
</span>               <a href="typecmds.c.html#LN135"><span class='Ref_To_Local'>collation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* type's collation */ 
</span> 
    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN161"><span class='Ref_To_Local'>array_type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="typecmds.c.html#LN166"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DefineType &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Guts of type deletion. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN688"></a><span class='Declare_Function'>RemoveTypeById</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeOid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN690"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span><a name="LN691"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN690"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN691"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN688"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN691"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for type %u"</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN688"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN40"><span class='Ref_to_Proto'>CatalogTupleDelete</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN690"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="typecmds.c.html#LN691"><span class='Ref_To_Local'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If it is an enum, delete the pg_enum entries too; we don't bother with 
     * making dependency entries for those, so it has to be done "by hand" 
     * here. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN691"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>typtype <span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN722"><span class='Ref_to_Const'>TYPTYPE_ENUM</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/catalog/pg_enum.h.html#LN65"><span class='Ref_to_Proto'>EnumValuesDelete</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN688"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If it is a range type, delete the pg_range entry too; we don't bother 
     * with making a dependency entry for that, so it has to be done "by hand" 
     * here. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN691"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>typtype <span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN724"><span class='Ref_to_Const'>TYPTYPE_RANGE</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/catalog/pg_range.h.html#LN82"><span class='Ref_to_Proto'>RangeDelete</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN688"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN691"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN690"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RemoveTypeById &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * DefineDomain 
 *      Registers a new domain. 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN728"></a><span class='Declare_Function'>DefineDomain</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2476"><span class='Ref_to_Struct'>CreateDomainStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN730"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>domainName</span><span class='Delimiter'>; 
</span><a name="LN731"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>domainNamespace</span><span class='Delimiter'>; 
</span><a name="LN732"></a>    <a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span><a name="LN733"></a>    <a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>internalLength</span><span class='Delimiter'>; 
</span><a name="LN734"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>inputProcedure</span><span class='Delimiter'>; 
</span><a name="LN735"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>outputProcedure</span><span class='Delimiter'>; 
</span><a name="LN736"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>receiveProcedure</span><span class='Delimiter'>; 
</span><a name="LN737"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>sendProcedure</span><span class='Delimiter'>; 
</span><a name="LN738"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>analyzeProcedure</span><span class='Delimiter'>; 
</span><a name="LN739"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>byValue</span><span class='Delimiter'>; 
</span><a name="LN740"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>category</span><span class='Delimiter'>; 
</span><a name="LN741"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>delimiter</span><span class='Delimiter'>; 
</span><a name="LN742"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>alignment</span><span class='Delimiter'>; 
</span><a name="LN743"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>storage</span><span class='Delimiter'>; 
</span><a name="LN744"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>typtype</span><span class='Delimiter'>; 
</span><a name="LN745"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>datum</span><span class='Delimiter'>; 
</span><a name="LN746"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN747"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>defaultValue</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN748"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>defaultValueBin</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN749"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>saw_default</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN750"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>typNotNull</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN751"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nullDefined</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN752"></a>    <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>typNDims</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN728"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2480"><span class='Ref_to_Member'>typeName</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN214"><span class='Ref_to_Member'>arrayBounds</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN753"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>typeTup</span><span class='Delimiter'>; 
</span><a name="LN754"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>schema</span> <span class='Operator'>= </span><a href="typecmds.c.html#LN728"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2482"><span class='Ref_to_Member'>constraints</span></a><span class='Delimiter'>; 
</span><a name="LN755"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>listptr</span><span class='Delimiter'>; 
</span><a name="LN756"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>basetypeoid</span><span class='Delimiter'>; 
</span><a name="LN757"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>old_type_oid</span><span class='Delimiter'>; 
</span><a name="LN758"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>domaincoll</span><span class='Delimiter'>; 
</span><a name="LN759"></a>    <a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a> <span class='Declare_Local'>baseType</span><span class='Delimiter'>; 
</span><a name="LN760"></a>    <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>basetypeMod</span><span class='Delimiter'>; 
</span><a name="LN761"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>baseColl</span><span class='Delimiter'>; 
</span><a name="LN762"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Convert list of names to a name and namespace */ 
</span>    <a href="typecmds.c.html#LN731"><span class='Ref_To_Local'>domainNamespace</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN118"><span class='Ref_to_Proto'>QualifiedNameGetCreationNamespace</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN728"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2479"><span class='Ref_to_Member'>domainname</span></a><span class='Delimiter'>, 
</span>                                                        <span class='Operator'>&</span><a href="typecmds.c.html#LN730"><span class='Ref_To_Local'>domainName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check we have creation rights in target namespace */ 
</span>    <a href="typecmds.c.html#LN732"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN289"><span class='Ref_to_Proto'>pg_namespace_aclcheck</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN731"><span class='Ref_To_Local'>domainNamespace</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                                      <a href="../../include/nodes/parsenodes.h.html#LN81"><span class='Ref_to_Const'>ACL_CREATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN732"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN732"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN189"><span class='Ref_to_EnumConst'>ACL_KIND_NAMESPACE</span></a><span class='Delimiter'>, 
</span>                       <a href="../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN731"><span class='Ref_To_Local'>domainNamespace</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check for collision with an existing type name.  If there is one and 
     * it's an autogenerated array, we can rename it out of the way. 
     */ 
</span>    <a href="typecmds.c.html#LN757"><span class='Ref_To_Local'>old_type_oid</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN184"><span class='Ref_to_Macro'>GetSysCacheOid2</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN106"><span class='Ref_to_EnumConst'>TYPENAMENSP</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN730"><span class='Ref_To_Local'>domainName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN731"><span class='Ref_To_Local'>domainNamespace</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN757"><span class='Ref_To_Local'>old_type_oid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/catalog/pg_type_fn.h.html#LN80"><span class='Ref_to_Proto'>moveArrayTypeName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN757"><span class='Ref_To_Local'>old_type_oid</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN730"><span class='Ref_To_Local'>domainName</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN731"><span class='Ref_To_Local'>domainNamespace</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/pg_basebackup/streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"type \"%s\" already exists"</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN730"><span class='Ref_To_Local'>domainName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Look up the base type. 
     */ 
</span>    <a href="typecmds.c.html#LN753"><span class='Ref_To_Local'>typeTup</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN25"><span class='Ref_to_Proto'>typenameType</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN728"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2480"><span class='Ref_to_Member'>typeName</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="typecmds.c.html#LN760"><span class='Ref_To_Local'>basetypeMod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN759"><span class='Ref_To_Local'>baseType</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN753"><span class='Ref_To_Local'>typeTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN756"><span class='Ref_To_Local'>basetypeoid</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN753"><span class='Ref_To_Local'>typeTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Base type must be a plain base type, another domain, an enum or a range 
     * type. Domains over pseudotypes would create a security hole.  Domains 
     * over composite types might be made to work in the future, but not 
     * today. 
     */ 
</span>    <a href="typecmds.c.html#LN744"><span class='Ref_To_Local'>typtype</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN759"><span class='Ref_To_Local'>baseType</span></a><span class='Operator'>-&GT;</span>typtype<span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN744"><span class='Ref_To_Local'>typtype</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_type.h.html#LN719"><span class='Ref_to_Const'>TYPTYPE_BASE</span></a> <span class='Operator'>&& 
</span>        <a href="typecmds.c.html#LN744"><span class='Ref_To_Local'>typtype</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_type.h.html#LN721"><span class='Ref_to_Const'>TYPTYPE_DOMAIN</span></a> <span class='Operator'>&& 
</span>        <a href="typecmds.c.html#LN744"><span class='Ref_To_Local'>typtype</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_type.h.html#LN722"><span class='Ref_to_Const'>TYPTYPE_ENUM</span></a> <span class='Operator'>&& 
</span>        <a href="typecmds.c.html#LN744"><span class='Ref_To_Local'>typtype</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_type.h.html#LN724"><span class='Ref_to_Const'>TYPTYPE_RANGE</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a valid base type for a domain"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/parser/parse_type.h.html#LN31"><span class='Ref_to_Proto'>TypeNameToString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN728"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2480"><span class='Ref_to_Member'>typeName</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN732"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN293"><span class='Ref_to_Proto'>pg_type_aclcheck</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN756"><span class='Ref_To_Local'>basetypeoid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN732"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/acl.h.html#LN301"><span class='Ref_to_Proto'>aclcheck_error_type</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN732"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN756"><span class='Ref_To_Local'>basetypeoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Identify the collation if any 
     */ 
</span>    <a href="typecmds.c.html#LN761"><span class='Ref_To_Local'>baseColl</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN759"><span class='Ref_To_Local'>baseType</span></a><span class='Operator'>-&GT;</span>typcollation<span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN728"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2481"><span class='Ref_to_Member'>collClause</span></a><span class='Parentheses'>) 
</span>        <a href="typecmds.c.html#LN758"><span class='Ref_To_Local'>domaincoll</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN142"><span class='Ref_to_Proto'>get_collation_oid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN728"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2481"><span class='Ref_to_Member'>collClause</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN309"><span class='Ref_to_Member'>collname</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="typecmds.c.html#LN758"><span class='Ref_To_Local'>domaincoll</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN761"><span class='Ref_To_Local'>baseColl</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Complain if COLLATE is applied to an uncollatable type */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN758"><span class='Ref_To_Local'>domaincoll</span></a><span class='Parentheses'>) </span><span class='Operator'>&& !</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN761"><span class='Ref_To_Local'>baseColl</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"collations are not supported by type %s"</span><span class='Delimiter'>, 
</span>                        <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN756"><span class='Ref_To_Local'>basetypeoid</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* passed by value */ 
</span>    <a href="typecmds.c.html#LN739"><span class='Ref_To_Local'>byValue</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN759"><span class='Ref_To_Local'>baseType</span></a><span class='Operator'>-&GT;</span>typbyval<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Required Alignment */ 
</span>    <a href="typecmds.c.html#LN742"><span class='Ref_To_Local'>alignment</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN759"><span class='Ref_To_Local'>baseType</span></a><span class='Operator'>-&GT;</span>typalign<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* TOAST Strategy */ 
</span>    <a href="typecmds.c.html#LN743"><span class='Ref_To_Local'>storage</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN759"><span class='Ref_To_Local'>baseType</span></a><span class='Operator'>-&GT;</span>typstorage<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Storage Length */ 
</span>    <a href="typecmds.c.html#LN733"><span class='Ref_To_Local'>internalLength</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN759"><span class='Ref_To_Local'>baseType</span></a><span class='Operator'>-&GT;</span>typlen<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Type Category */ 
</span>    <a href="typecmds.c.html#LN740"><span class='Ref_To_Local'>category</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN759"><span class='Ref_To_Local'>baseType</span></a><span class='Operator'>-&GT;</span>typcategory<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Array element Delimiter */ 
</span>    <a href="typecmds.c.html#LN741"><span class='Ref_To_Local'>delimiter</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN759"><span class='Ref_To_Local'>baseType</span></a><span class='Operator'>-&GT;</span>typdelim<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* I/O Functions */ 
</span>    <a href="typecmds.c.html#LN734"><span class='Ref_To_Local'>inputProcedure</span></a> <span class='Operator'>= </span>F_DOMAIN_IN<span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN735"><span class='Ref_To_Local'>outputProcedure</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN759"><span class='Ref_To_Local'>baseType</span></a><span class='Operator'>-&GT;</span>typoutput<span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN736"><span class='Ref_To_Local'>receiveProcedure</span></a> <span class='Operator'>= </span>F_DOMAIN_RECV<span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN737"><span class='Ref_To_Local'>sendProcedure</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN759"><span class='Ref_To_Local'>baseType</span></a><span class='Operator'>-&GT;</span>typsend<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Domains never accept typmods, so no typmodin/typmodout needed */ 
</span> 
    <span class='Comment_Multi_Line'>/* Analysis function */ 
</span>    <a href="typecmds.c.html#LN738"><span class='Ref_To_Local'>analyzeProcedure</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN759"><span class='Ref_To_Local'>baseType</span></a><span class='Operator'>-&GT;</span>typanalyze<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Inherited default value */ 
</span>    <a href="typecmds.c.html#LN745"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN753"><span class='Ref_To_Local'>typeTup</span></a><span class='Delimiter'>, 
</span>                            <a href="../../include/catalog/pg_type.h.html#LN267"><span class='Ref_to_Const'>Anum_pg_type_typdefault</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="typecmds.c.html#LN746"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="typecmds.c.html#LN746"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>        <a href="typecmds.c.html#LN747"><span class='Ref_To_Local'>defaultValue</span></a> <span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN745"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Inherited default binary value */ 
</span>    <a href="typecmds.c.html#LN745"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN753"><span class='Ref_To_Local'>typeTup</span></a><span class='Delimiter'>, 
</span>                            <a href="../../include/catalog/pg_type.h.html#LN266"><span class='Ref_to_Const'>Anum_pg_type_typdefaultbin</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="typecmds.c.html#LN746"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="typecmds.c.html#LN746"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>        <a href="typecmds.c.html#LN748"><span class='Ref_To_Local'>defaultValueBin</span></a> <span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN745"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Run through constraints manually to avoid the additional processing 
     * conducted by DefineRelation() and friends. 
     */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN755"><span class='Ref_To_Local'>listptr</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN754"><span class='Ref_To_Local'>schema</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN880"></a>        <a href="../../include/nodes/parsenodes.h.html#LN2050"><span class='Ref_to_Struct'>Constraint</span></a> <span class='Operator'>*</span><span class='Declare_Local'>constr</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN755"><span class='Ref_To_Local'>listptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN880"><span class='Ref_To_Local'>constr</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2050"><span class='Ref_to_Struct'>Constraint</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized node type: %d"</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="../../include/nodes/nodes.h.html#LN513"><span class='Ref_to_Macro'>nodeTag</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN880"><span class='Ref_To_Local'>constr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN880"><span class='Ref_To_Local'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2053"><span class='Ref_to_Member'>contype</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2025"><span class='Ref_to_EnumConst'>CONSTR_DEFAULT</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * The inherited default value may be overridden by the user 
                 * with the DEFAULT &LT;expr&GT; clause ... but only once. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN749"><span class='Ref_To_Local'>saw_default</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"multiple default expressions"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <a href="typecmds.c.html#LN749"><span class='Ref_To_Local'>saw_default</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN880"><span class='Ref_To_Local'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2063"><span class='Ref_to_Member'>raw_expr</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN901"></a>                    <a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pstate</span><span class='Delimiter'>; 
</span><a name="LN902"></a>                    <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>defaultExpr</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* Create a dummy ParseState for transformExpr */ 
</span>                    <a href="typecmds.c.html#LN901"><span class='Ref_To_Local'>pstate</span></a> <span class='Operator'>= </span><a href="../parser/parse_node.c.html#LN42"><span class='Ref_to_Func'>make_parsestate</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Cook the constr-&GT;raw_expr into an expression. Note: 
                     * name is strictly for error message 
                     */ 
</span>                    <a href="typecmds.c.html#LN902"><span class='Ref_To_Local'>defaultExpr</span></a> <span class='Operator'>= </span><a href="../../include/catalog/heap.h.html#LN107"><span class='Ref_to_Proto'>cookDefault</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN901"><span class='Ref_To_Local'>pstate</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN880"><span class='Ref_To_Local'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2063"><span class='Ref_to_Member'>raw_expr</span></a><span class='Delimiter'>, 
</span>                                              <a href="typecmds.c.html#LN756"><span class='Ref_To_Local'>basetypeoid</span></a><span class='Delimiter'>, 
</span>                                              <a href="typecmds.c.html#LN760"><span class='Ref_To_Local'>basetypeMod</span></a><span class='Delimiter'>, 
</span>                                              <a href="typecmds.c.html#LN730"><span class='Ref_To_Local'>domainName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * If the expression is just a NULL constant, we treat it 
                     * like not having a default. 
                     * 
                     * Note that if the basetype is another domain, we'll see 
                     * a CoerceToDomain expr here and not discard the default. 
                     * This is critical because the domain default needs to be 
                     * retained to override any default that the base domain 
                     * might have. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN902"><span class='Ref_To_Local'>defaultExpr</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>                        <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN902"><span class='Ref_To_Local'>defaultExpr</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>                         <span class='Parentheses'>((</span><a href="../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="typecmds.c.html#LN902"><span class='Ref_To_Local'>defaultExpr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>constisnull<span class='Parentheses'>))</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="typecmds.c.html#LN747"><span class='Ref_To_Local'>defaultValue</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                        <a href="typecmds.c.html#LN748"><span class='Ref_To_Local'>defaultValueBin</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * Expression must be stored as a nodeToString result, 
                         * but we also require a valid textual representation 
                         * (mainly to make life easier for pg_dump). 
                         */ 
</span>                        <a href="typecmds.c.html#LN747"><span class='Ref_To_Local'>defaultValue</span></a> <span class='Operator'>= 
</span>                            <a href="../../include/utils/ruleutils.h.html#LN26"><span class='Ref_to_Proto'>deparse_expression</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN902"><span class='Ref_To_Local'>defaultExpr</span></a><span class='Delimiter'>, 
</span>                                               <a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="typecmds.c.html#LN748"><span class='Ref_To_Local'>defaultValueBin</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN598"><span class='Ref_to_Proto'>nodeToString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN902"><span class='Ref_To_Local'>defaultExpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if constr-&GT;raw_expr &raquo; </span> 
                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* No default (can this still happen?) */ 
</span>                    <a href="typecmds.c.html#LN747"><span class='Ref_To_Local'>defaultValue</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                    <a href="typecmds.c.html#LN748"><span class='Ref_To_Local'>defaultValueBin</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2024"><span class='Ref_to_EnumConst'>CONSTR_NOTNULL</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN751"><span class='Ref_To_Local'>nullDefined</span></a> <span class='Operator'>&& !</span><a href="typecmds.c.html#LN750"><span class='Ref_To_Local'>typNotNull</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting NULL/NOT NULL constraints"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <a href="typecmds.c.html#LN750"><span class='Ref_To_Local'>typNotNull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="typecmds.c.html#LN751"><span class='Ref_To_Local'>nullDefined</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2022"><span class='Ref_to_EnumConst'>CONSTR_NULL</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN751"><span class='Ref_To_Local'>nullDefined</span></a> <span class='Operator'>&& </span><a href="typecmds.c.html#LN750"><span class='Ref_To_Local'>typNotNull</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting NULL/NOT NULL constraints"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <a href="typecmds.c.html#LN750"><span class='Ref_To_Local'>typNotNull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <a href="typecmds.c.html#LN751"><span class='Ref_To_Local'>nullDefined</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2027"><span class='Ref_to_EnumConst'>CONSTR_CHECK</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Check constraints are handled after domain creation, as 
                 * they require the Oid of the domain; at this point we can 
                 * only check that they're not marked NO INHERIT, because that 
                 * would be bogus. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN880"><span class='Ref_To_Local'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2062"><span class='Ref_to_Member'>is_no_inherit</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"check constraints for domains cannot be marked NO INHERIT"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * All else are error cases 
                 */ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2029"><span class='Ref_to_EnumConst'>CONSTR_UNIQUE</span></a><span class='Operator'>: 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unique constraints not possible for domains"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2028"><span class='Ref_to_EnumConst'>CONSTR_PRIMARY</span></a><span class='Operator'>: 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"primary key constraints not possible for domains"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2030"><span class='Ref_to_EnumConst'>CONSTR_EXCLUSION</span></a><span class='Operator'>: 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                  <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"exclusion constraints not possible for domains"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2031"><span class='Ref_to_EnumConst'>CONSTR_FOREIGN</span></a><span class='Operator'>: 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"foreign key constraints not possible for domains"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2032"><span class='Ref_to_EnumConst'>CONSTR_ATTR_DEFERRABLE</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2033"><span class='Ref_to_EnumConst'>CONSTR_ATTR_NOT_DEFERRABLE</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2034"><span class='Ref_to_EnumConst'>CONSTR_ATTR_DEFERRED</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2035"><span class='Ref_to_EnumConst'>CONSTR_ATTR_IMMEDIATE</span></a><span class='Operator'>: 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"specifying constraint deferrability not supported for domains"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized constraint subtype: %d"</span><span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="typecmds.c.html#LN880"><span class='Ref_To_Local'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2053"><span class='Ref_to_Member'>contype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch constr-&GT;contype &raquo; </span> 
    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Have TypeCreate do all the real work. 
     */ 
</span>    <a href="typecmds.c.html#LN762"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= 
</span>        <a href="../../include/catalog/pg_type_fn.h.html#LN24"><span class='Ref_to_Proto'>TypeCreate</span></a><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* no predetermined type OID */ 
</span>                   <a href="typecmds.c.html#LN730"><span class='Ref_To_Local'>domainName</span></a><span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* type name */ 
</span>                   <a href="typecmds.c.html#LN731"><span class='Ref_To_Local'>domainNamespace</span></a><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* namespace */ 
</span>                   <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* relation oid (n/a here) */ 
</span>                   <span class='Number'>0</span><span class='Delimiter'>,</span>           <span class='Comment_Single_Line'>/* relation kind (ditto) */ 
</span>                   <a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* owner's ID */ 
</span>                   <a href="typecmds.c.html#LN733"><span class='Ref_To_Local'>internalLength</span></a><span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* internal size */ 
</span>                   <a href="../../include/catalog/pg_type.h.html#LN721"><span class='Ref_to_Const'>TYPTYPE_DOMAIN</span></a><span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* type-type (domain type) */ 
</span>                   <a href="typecmds.c.html#LN740"><span class='Ref_To_Local'>category</span></a><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* type-category */ 
</span>                   <span class='Boolean'>false</span><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* domain types are never preferred */ 
</span>                   <a href="typecmds.c.html#LN741"><span class='Ref_To_Local'>delimiter</span></a><span class='Delimiter'>,</span>   <span class='Comment_Single_Line'>/* array element delimiter */ 
</span>                   <a href="typecmds.c.html#LN734"><span class='Ref_To_Local'>inputProcedure</span></a><span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* input procedure */ 
</span>                   <a href="typecmds.c.html#LN735"><span class='Ref_To_Local'>outputProcedure</span></a><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* output procedure */ 
</span>                   <a href="typecmds.c.html#LN736"><span class='Ref_To_Local'>receiveProcedure</span></a><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* receive procedure */ 
</span>                   <a href="typecmds.c.html#LN737"><span class='Ref_To_Local'>sendProcedure</span></a><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* send procedure */ 
</span>                   <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* typmodin procedure - none */ 
</span>                   <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* typmodout procedure - none */ 
</span>                   <a href="typecmds.c.html#LN738"><span class='Ref_To_Local'>analyzeProcedure</span></a><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* analyze procedure */ 
</span>                   <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* no array element type */ 
</span>                   <span class='Boolean'>false</span><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* this isn't an array */ 
</span>                   <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* no arrays for domains (yet) */ 
</span>                   <a href="typecmds.c.html#LN756"><span class='Ref_To_Local'>basetypeoid</span></a><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* base type ID */ 
</span>                   <a href="typecmds.c.html#LN747"><span class='Ref_To_Local'>defaultValue</span></a><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* default type value (text) */ 
</span>                   <a href="typecmds.c.html#LN748"><span class='Ref_To_Local'>defaultValueBin</span></a><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* default type value (binary) */ 
</span>                   <a href="typecmds.c.html#LN739"><span class='Ref_To_Local'>byValue</span></a><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* passed by value */ 
</span>                   <a href="typecmds.c.html#LN742"><span class='Ref_To_Local'>alignment</span></a><span class='Delimiter'>,</span>   <span class='Comment_Single_Line'>/* required alignment */ 
</span>                   <a href="typecmds.c.html#LN743"><span class='Ref_To_Local'>storage</span></a><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* TOAST strategy */ 
</span>                   <a href="typecmds.c.html#LN760"><span class='Ref_To_Local'>basetypeMod</span></a><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* typeMod value */ 
</span>                   <a href="typecmds.c.html#LN752"><span class='Ref_To_Local'>typNDims</span></a><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* Array dimensions for base type */ 
</span>                   <a href="typecmds.c.html#LN750"><span class='Ref_To_Local'>typNotNull</span></a><span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* Type NOT NULL */ 
</span>                   <a href="typecmds.c.html#LN758"><span class='Ref_To_Local'>domaincoll</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* type's collation */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Process constraints which refer to the domain ID returned by TypeCreate 
     */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN755"><span class='Ref_To_Local'>listptr</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN754"><span class='Ref_To_Local'>schema</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1070"></a>        <a href="../../include/nodes/parsenodes.h.html#LN2050"><span class='Ref_to_Struct'>Constraint</span></a> <span class='Operator'>*</span><span class='Declare_Local'>constr</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN755"><span class='Ref_To_Local'>listptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* it must be a Constraint, per check above */ 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN1070"><span class='Ref_To_Local'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2053"><span class='Ref_to_Member'>contype</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2027"><span class='Ref_to_EnumConst'>CONSTR_CHECK</span></a><span class='Operator'>: 
</span>                <a href="typecmds.c.html#LN102"><span class='Ref_to_Proto'>domainAddConstraint</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN762"><span class='Ref_To_Local'>address</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN731"><span class='Ref_To_Local'>domainNamespace</span></a><span class='Delimiter'>, 
</span>                                    <a href="typecmds.c.html#LN756"><span class='Ref_To_Local'>basetypeoid</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN760"><span class='Ref_To_Local'>basetypeMod</span></a><span class='Delimiter'>, 
</span>                                    <a href="typecmds.c.html#LN1070"><span class='Ref_To_Local'>constr</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN730"><span class='Ref_To_Local'>domainName</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Other constraint types were fully processed above */ 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* CCI so we can detect duplicate constraint names */ 
</span>        <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now we can clean up. 
     */ 
</span>    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN753"><span class='Ref_To_Local'>typeTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="typecmds.c.html#LN762"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DefineDomain &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * DefineEnum 
 *      Registers a new enum. 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN1106"></a><span class='Declare_Function'>DefineEnum</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2925"><span class='Ref_to_Struct'>CreateEnumStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1108"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>enumName</span><span class='Delimiter'>; 
</span><a name="LN1109"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>enumArrayName</span><span class='Delimiter'>; 
</span><a name="LN1110"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>enumNamespace</span><span class='Delimiter'>; 
</span><a name="LN1111"></a>    <a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span><a name="LN1112"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>old_type_oid</span><span class='Delimiter'>; 
</span><a name="LN1113"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>enumArrayOid</span><span class='Delimiter'>; 
</span><a name="LN1114"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>enumTypeAddr</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Convert list of names to a name and namespace */ 
</span>    <a href="typecmds.c.html#LN1110"><span class='Ref_To_Local'>enumNamespace</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN118"><span class='Ref_to_Proto'>QualifiedNameGetCreationNamespace</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1106"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2928"><span class='Ref_to_Member'>typeName</span></a><span class='Delimiter'>, 
</span>                                                      <span class='Operator'>&</span><a href="typecmds.c.html#LN1108"><span class='Ref_To_Local'>enumName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check we have creation rights in target namespace */ 
</span>    <a href="typecmds.c.html#LN1111"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN289"><span class='Ref_to_Proto'>pg_namespace_aclcheck</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1110"><span class='Ref_To_Local'>enumNamespace</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN81"><span class='Ref_to_Const'>ACL_CREATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN1111"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1111"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN189"><span class='Ref_to_EnumConst'>ACL_KIND_NAMESPACE</span></a><span class='Delimiter'>, 
</span>                       <a href="../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1110"><span class='Ref_To_Local'>enumNamespace</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check for collision with an existing type name.  If there is one and 
     * it's an autogenerated array, we can rename it out of the way. 
     */ 
</span>    <a href="typecmds.c.html#LN1112"><span class='Ref_To_Local'>old_type_oid</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN184"><span class='Ref_to_Macro'>GetSysCacheOid2</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN106"><span class='Ref_to_EnumConst'>TYPENAMENSP</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1108"><span class='Ref_To_Local'>enumName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1110"><span class='Ref_To_Local'>enumNamespace</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1112"><span class='Ref_To_Local'>old_type_oid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/catalog/pg_type_fn.h.html#LN80"><span class='Ref_to_Proto'>moveArrayTypeName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1112"><span class='Ref_To_Local'>old_type_oid</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1108"><span class='Ref_To_Local'>enumName</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1110"><span class='Ref_To_Local'>enumNamespace</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/pg_basebackup/streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"type \"%s\" already exists"</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1108"><span class='Ref_To_Local'>enumName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="typecmds.c.html#LN1113"><span class='Ref_To_Local'>enumArrayOid</span></a> <span class='Operator'>= </span><a href="../../include/commands/typecmds.h.html#LN30"><span class='Ref_to_Proto'>AssignTypeArrayOid</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create the pg_type entry */ 
</span>    <a href="typecmds.c.html#LN1114"><span class='Ref_To_Local'>enumTypeAddr</span></a> <span class='Operator'>= 
</span>        <a href="../../include/catalog/pg_type_fn.h.html#LN24"><span class='Ref_to_Proto'>TypeCreate</span></a><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* no predetermined type OID */ 
</span>                   <a href="typecmds.c.html#LN1108"><span class='Ref_To_Local'>enumName</span></a><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* type name */ 
</span>                   <a href="typecmds.c.html#LN1110"><span class='Ref_To_Local'>enumNamespace</span></a><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* namespace */ 
</span>                   <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* relation oid (n/a here) */ 
</span>                   <span class='Number'>0</span><span class='Delimiter'>,</span>           <span class='Comment_Single_Line'>/* relation kind (ditto) */ 
</span>                   <a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* owner's ID */ 
</span>                   <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* internal size */ 
</span>                   <a href="../../include/catalog/pg_type.h.html#LN722"><span class='Ref_to_Const'>TYPTYPE_ENUM</span></a><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* type-type (enum type) */ 
</span>                   <a href="../../include/catalog/pg_type.h.html#LN731"><span class='Ref_to_Const'>TYPCATEGORY_ENUM</span></a><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* type-category (enum type) */ 
</span>                   <span class='Boolean'>false</span><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* enum types are never preferred */ 
</span>                   <a href="../../include/commands/typecmds.h.html#LN21"><span class='Ref_to_Const'>DEFAULT_TYPDELIM</span></a><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* array element delimiter */ 
</span>                   F_ENUM_IN<span class='Delimiter'>,</span>   <span class='Comment_Single_Line'>/* input procedure */ 
</span>                   F_ENUM_OUT<span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* output procedure */ 
</span>                   F_ENUM_RECV<span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* receive procedure */ 
</span>                   F_ENUM_SEND<span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* send procedure */ 
</span>                   <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* typmodin procedure - none */ 
</span>                   <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* typmodout procedure - none */ 
</span>                   <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* analyze procedure - default */ 
</span>                   <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* element type ID */ 
</span>                   <span class='Boolean'>false</span><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* this is not an array type */ 
</span>                   <a href="typecmds.c.html#LN1113"><span class='Ref_To_Local'>enumArrayOid</span></a><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* array type we are about to create */ 
</span>                   <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* base type ID (only for domains) */ 
</span>                   <span class='Null_Value'>NULL</span><span class='Delimiter'>,</span>        <span class='Comment_Single_Line'>/* never a default type value */ 
</span>                   <span class='Null_Value'>NULL</span><span class='Delimiter'>,</span>        <span class='Comment_Single_Line'>/* binary default isn't sent either */ 
</span>                   <span class='Boolean'>true</span><span class='Delimiter'>,</span>        <span class='Comment_Single_Line'>/* always passed by value */ 
</span>                   <span class='String'>'i'</span><span class='Delimiter'>,</span>         <span class='Comment_Single_Line'>/* int alignment */ 
</span>                   <span class='String'>'p'</span><span class='Delimiter'>,</span>         <span class='Comment_Single_Line'>/* TOAST strategy always plain */ 
</span>                   <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>,</span>          <span class='Comment_Single_Line'>/* typMod (Domains only) */ 
</span>                   <span class='Number'>0</span><span class='Delimiter'>,</span>           <span class='Comment_Single_Line'>/* Array dimensions of typbasetype */ 
</span>                   <span class='Boolean'>false</span><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* Type NOT NULL */ 
</span>                   <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* type's collation */ 
</span> 
    <span class='Comment_Multi_Line'>/* Enter the enum's values into pg_enum */ 
</span>    <a href="../catalog/pg_enum.c.html#LN47"><span class='Ref_to_Func'>EnumValuesCreate</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1114"><span class='Ref_To_Local'>enumTypeAddr</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1106"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2929"><span class='Ref_to_Member'>vals</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create the array type that goes with it. 
     */ 
</span>    <a href="typecmds.c.html#LN1109"><span class='Ref_To_Local'>enumArrayName</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_type_fn.h.html#LN78"><span class='Ref_to_Proto'>makeArrayTypeName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1108"><span class='Ref_To_Local'>enumName</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1110"><span class='Ref_To_Local'>enumNamespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/pg_type_fn.h.html#LN24"><span class='Ref_to_Proto'>TypeCreate</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1113"><span class='Ref_To_Local'>enumArrayOid</span></a><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* force assignment of this type OID */ 
</span>               <a href="typecmds.c.html#LN1109"><span class='Ref_To_Local'>enumArrayName</span></a><span class='Delimiter'>,</span>   <span class='Comment_Single_Line'>/* type name */ 
</span>               <a href="typecmds.c.html#LN1110"><span class='Ref_To_Local'>enumNamespace</span></a><span class='Delimiter'>,</span>   <span class='Comment_Single_Line'>/* namespace */ 
</span>               <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* relation oid (n/a here) */ 
</span>               <span class='Number'>0</span><span class='Delimiter'>,</span>               <span class='Comment_Single_Line'>/* relation kind (ditto) */ 
</span>               <a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* owner's ID */ 
</span>               <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>,</span>              <span class='Comment_Single_Line'>/* internal size (always varlena) */ 
</span>               <a href="../../include/catalog/pg_type.h.html#LN719"><span class='Ref_to_Const'>TYPTYPE_BASE</span></a><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* type-type (base type) */ 
</span>               <a href="../../include/catalog/pg_type.h.html#LN727"><span class='Ref_to_Const'>TYPCATEGORY_ARRAY</span></a><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* type-category (array) */ 
</span>               <span class='Boolean'>false</span><span class='Delimiter'>,</span>           <span class='Comment_Single_Line'>/* array types are never preferred */ 
</span>               <a href="../../include/commands/typecmds.h.html#LN21"><span class='Ref_to_Const'>DEFAULT_TYPDELIM</span></a><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* array element delimiter */ 
</span>               F_ARRAY_IN<span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* input procedure */ 
</span>               F_ARRAY_OUT<span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* output procedure */ 
</span>               F_ARRAY_RECV<span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* receive procedure */ 
</span>               F_ARRAY_SEND<span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* send procedure */ 
</span>               <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* typmodin procedure - none */ 
</span>               <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* typmodout procedure - none */ 
</span>               F_ARRAY_TYPANALYZE<span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* analyze procedure */ 
</span>               <a href="typecmds.c.html#LN1114"><span class='Ref_To_Local'>enumTypeAddr</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Delimiter'>,</span>   <span class='Comment_Single_Line'>/* element type ID */ 
</span>               <span class='Boolean'>true</span><span class='Delimiter'>,</span>            <span class='Comment_Single_Line'>/* yes this is an array type */ 
</span>               <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* no further array type */ 
</span>               <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* base type ID */ 
</span>               <span class='Null_Value'>NULL</span><span class='Delimiter'>,</span>            <span class='Comment_Single_Line'>/* never a default type value */ 
</span>               <span class='Null_Value'>NULL</span><span class='Delimiter'>,</span>            <span class='Comment_Single_Line'>/* binary default isn't sent either */ 
</span>               <span class='Boolean'>false</span><span class='Delimiter'>,</span>           <span class='Comment_Single_Line'>/* never passed by value */ 
</span>               <span class='String'>'i'</span><span class='Delimiter'>,</span>             <span class='Comment_Single_Line'>/* enums have align i, so do their arrays */ 
</span>               <span class='String'>'x'</span><span class='Delimiter'>,</span>             <span class='Comment_Single_Line'>/* ARRAY is always toastable */ 
</span>               <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>,</span>              <span class='Comment_Single_Line'>/* typMod (Domains only) */ 
</span>               <span class='Number'>0</span><span class='Delimiter'>,</span>               <span class='Comment_Single_Line'>/* Array dimensions of typbasetype */ 
</span>               <span class='Boolean'>false</span><span class='Delimiter'>,</span>           <span class='Comment_Single_Line'>/* Type NOT NULL */ 
</span>               <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* type's collation */ 
</span> 
    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1109"><span class='Ref_To_Local'>enumArrayName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="typecmds.c.html#LN1114"><span class='Ref_To_Local'>enumTypeAddr</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DefineEnum &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * AlterEnum 
 *      Adds a new label to an existing enum. 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN1227"></a><span class='Declare_Function'>AlterEnum</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2947"><span class='Ref_to_Struct'>AlterEnumStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1229"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>enum_type_oid</span><span class='Delimiter'>; 
</span><a name="LN1230"></a>    <a href="../../include/nodes/parsenodes.h.html#LN205"><span class='Ref_to_Struct'>TypeName</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>typename</span><span class='Delimiter'>; 
</span><a name="LN1231"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN1232"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make a TypeName so we can use standard type lookup machinery */ 
</span>    <span class='Keyword'>typename </span><span class='Operator'>= </span><a href="../../include/nodes/makefuncs.h.html#LN71"><span class='Ref_to_Proto'>makeTypeNameFromNameList</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1227"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2950"><span class='Ref_to_Member'>typeName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN1229"><span class='Ref_To_Local'>enum_type_oid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN27"><span class='Ref_to_Proto'>typenameTypeId</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Keyword'>typename</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN1231"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1229"><span class='Ref_To_Local'>enum_type_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1231"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for type %u"</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1229"><span class='Ref_To_Local'>enum_type_oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check it's an enum and check user has permission to ALTER the enum */ 
</span>    <a href="typecmds.c.html#LN101"><span class='Ref_to_Proto'>checkEnumOwner</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1231"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1231"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN1227"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2951"><span class='Ref_to_Member'>oldVal</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Rename an existing label */ 
</span>        <a href="../../include/catalog/pg_enum.h.html#LN69"><span class='Ref_to_Proto'>RenameEnumLabel</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1229"><span class='Ref_To_Local'>enum_type_oid</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1227"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2951"><span class='Ref_to_Member'>oldVal</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1227"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2952"><span class='Ref_to_Member'>newVal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Add a new label */ 
</span>        <a href="../../include/catalog/pg_enum.h.html#LN66"><span class='Ref_to_Proto'>AddEnumLabel</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1229"><span class='Ref_To_Local'>enum_type_oid</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1227"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2952"><span class='Ref_to_Member'>newVal</span></a><span class='Delimiter'>, 
</span>                     <a href="typecmds.c.html#LN1227"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2953"><span class='Ref_to_Member'>newValNeighbor</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1227"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2954"><span class='Ref_to_Member'>newValIsAfter</span></a><span class='Delimiter'>, 
</span>                     <a href="typecmds.c.html#LN1227"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2955"><span class='Ref_to_Member'>skipIfNewValExists</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1229"><span class='Ref_To_Local'>enum_type_oid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1232"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1229"><span class='Ref_To_Local'>enum_type_oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="typecmds.c.html#LN1232"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterEnum &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * checkEnumOwner 
 * 
 * Check that the type is actually an enum and that the current user 
 * has permission to do ALTER TYPE on it.  Throw an error if not. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1275"></a><span class='Declare_Function'>checkEnumOwner</span><span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tup</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1277"></a>    <a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a> <span class='Declare_Local'>typTup</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1275"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check that this is actually an enum */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN1277"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typtype <span class='Operator'>!= </span><a href="../../include/catalog/pg_type.h.html#LN722"><span class='Ref_to_Const'>TYPTYPE_ENUM</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"%s is not an enum"</span><span class='Delimiter'>, 
</span>                        <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1275"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>)))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Permission check: must own type */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN309"><span class='Ref_to_Proto'>pg_type_ownercheck</span></a><span class='Parentheses'>(</span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1275"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
        <a href="../../include/utils/acl.h.html#LN301"><span class='Ref_to_Proto'>aclcheck_error_type</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1275"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * DefineRange 
 *      Registers a new range type. 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN1297"></a><span class='Declare_Function'>DefineRange</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2936"><span class='Ref_to_Struct'>CreateRangeStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1299"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>typeName</span><span class='Delimiter'>; 
</span><a name="LN1300"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typeNamespace</span><span class='Delimiter'>; 
</span><a name="LN1301"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typoid</span><span class='Delimiter'>; 
</span><a name="LN1302"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>rangeArrayName</span><span class='Delimiter'>; 
</span><a name="LN1303"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>rangeArrayOid</span><span class='Delimiter'>; 
</span><a name="LN1304"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>rangeSubtype</span> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span><a name="LN1305"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>rangeSubOpclassName</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1306"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>rangeCollationName</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1307"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>rangeCanonicalName</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1308"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>rangeSubtypeDiffName</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1309"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>rangeSubOpclass</span><span class='Delimiter'>; 
</span><a name="LN1310"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>rangeCollation</span><span class='Delimiter'>; 
</span><a name="LN1311"></a>    <a href="../../include/c.h.html#LN393"><span class='Ref_to_Typedef'>regproc</span></a>     <span class='Declare_Local'>rangeCanonical</span><span class='Delimiter'>; 
</span><a name="LN1312"></a>    <a href="../../include/c.h.html#LN393"><span class='Ref_to_Typedef'>regproc</span></a>     <span class='Declare_Local'>rangeSubtypeDiff</span><span class='Delimiter'>; 
</span><a name="LN1313"></a>    <a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>subtyplen</span><span class='Delimiter'>; 
</span><a name="LN1314"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>subtypbyval</span><span class='Delimiter'>; 
</span><a name="LN1315"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>subtypalign</span><span class='Delimiter'>; 
</span><a name="LN1316"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>alignment</span><span class='Delimiter'>; 
</span><a name="LN1317"></a>    <a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span><a name="LN1318"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span><a name="LN1319"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Convert list of names to a name and namespace */ 
</span>    <a href="typecmds.c.html#LN1300"><span class='Ref_To_Local'>typeNamespace</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN118"><span class='Ref_to_Proto'>QualifiedNameGetCreationNamespace</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1297"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2939"><span class='Ref_to_Member'>typeName</span></a><span class='Delimiter'>, 
</span>                                                      <span class='Operator'>&</span><a href="typecmds.c.html#LN1299"><span class='Ref_To_Local'>typeName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check we have creation rights in target namespace */ 
</span>    <a href="typecmds.c.html#LN1317"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN289"><span class='Ref_to_Proto'>pg_namespace_aclcheck</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1300"><span class='Ref_To_Local'>typeNamespace</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN81"><span class='Ref_to_Const'>ACL_CREATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN1317"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1317"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN189"><span class='Ref_to_EnumConst'>ACL_KIND_NAMESPACE</span></a><span class='Delimiter'>, 
</span>                       <a href="../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1300"><span class='Ref_To_Local'>typeNamespace</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Look to see if type already exists. 
     */ 
</span>    <a href="typecmds.c.html#LN1301"><span class='Ref_To_Local'>typoid</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN184"><span class='Ref_to_Macro'>GetSysCacheOid2</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN106"><span class='Ref_to_EnumConst'>TYPENAMENSP</span></a><span class='Delimiter'>, 
</span>                             <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1299"><span class='Ref_To_Local'>typeName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1300"><span class='Ref_To_Local'>typeNamespace</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If it's not a shell, see if it's an autogenerated array type, and if so 
     * rename it out of the way. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1301"><span class='Ref_To_Local'>typoid</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="../../include/utils/lsyscache.h.html#LN132"><span class='Ref_to_Proto'>get_typisdefined</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1301"><span class='Ref_To_Local'>typoid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/pg_type_fn.h.html#LN80"><span class='Ref_to_Proto'>moveArrayTypeName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1301"><span class='Ref_To_Local'>typoid</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1299"><span class='Ref_To_Local'>typeName</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1300"><span class='Ref_To_Local'>typeNamespace</span></a><span class='Parentheses'>))</span> 
            <a href="typecmds.c.html#LN1301"><span class='Ref_To_Local'>typoid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/pg_basebackup/streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"type \"%s\" already exists"</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1299"><span class='Ref_To_Local'>typeName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If it doesn't exist, create it as a shell, so that the OID is known for 
     * use in the range function definitions. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1301"><span class='Ref_To_Local'>typoid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="typecmds.c.html#LN1319"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_type_fn.h.html#LN20"><span class='Ref_to_Proto'>TypeShellMake</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1299"><span class='Ref_To_Local'>typeName</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1300"><span class='Ref_To_Local'>typeNamespace</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>        <a href="typecmds.c.html#LN1301"><span class='Ref_To_Local'>typoid</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN1319"><span class='Ref_To_Local'>address</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Make new shell type visible for modification below */ 
</span>        <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Extract the parameters from the parameter list */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1318"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1297"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2940"><span class='Ref_to_Member'>params</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1367"></a>        <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>defel</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1318"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1367"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"subtype"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1304"><span class='Ref_To_Local'>rangeSubtype</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* we can look up the subtype name immediately */ 
</span>            <a href="typecmds.c.html#LN1304"><span class='Ref_To_Local'>rangeSubtype</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN27"><span class='Ref_to_Proto'>typenameTypeId</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="../../include/commands/defrem.h.html#LN162"><span class='Ref_to_Proto'>defGetTypeName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1367"><span class='Ref_To_Local'>defel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1367"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"subtype_opclass"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN1305"><span class='Ref_To_Local'>rangeSubOpclassName</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="typecmds.c.html#LN1305"><span class='Ref_To_Local'>rangeSubOpclassName</span></a> <span class='Operator'>= </span><a href="../../include/commands/defrem.h.html#LN161"><span class='Ref_to_Proto'>defGetQualifiedName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1367"><span class='Ref_To_Local'>defel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1367"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"collation"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN1306"><span class='Ref_To_Local'>rangeCollationName</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="typecmds.c.html#LN1306"><span class='Ref_To_Local'>rangeCollationName</span></a> <span class='Operator'>= </span><a href="../../include/commands/defrem.h.html#LN161"><span class='Ref_to_Proto'>defGetQualifiedName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1367"><span class='Ref_To_Local'>defel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1367"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"canonical"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN1307"><span class='Ref_To_Local'>rangeCanonicalName</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="typecmds.c.html#LN1307"><span class='Ref_To_Local'>rangeCanonicalName</span></a> <span class='Operator'>= </span><a href="../../include/commands/defrem.h.html#LN161"><span class='Ref_to_Proto'>defGetQualifiedName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1367"><span class='Ref_To_Local'>defel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1367"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"subtype_diff"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN1308"><span class='Ref_To_Local'>rangeSubtypeDiffName</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="typecmds.c.html#LN1308"><span class='Ref_To_Local'>rangeSubtypeDiffName</span></a> <span class='Operator'>= </span><a href="../../include/commands/defrem.h.html#LN161"><span class='Ref_to_Proto'>defGetQualifiedName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1367"><span class='Ref_To_Local'>defel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"type attribute \"%s\" not recognized"</span><span class='Delimiter'>, 
</span>                            <a href="typecmds.c.html#LN1367"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Must have a subtype */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1304"><span class='Ref_To_Local'>rangeSubtype</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"type attribute \"subtype\" is required"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* disallow ranges of pseudotypes */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/lsyscache.h.html#LN149"><span class='Ref_to_Proto'>get_typtype</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1304"><span class='Ref_To_Local'>rangeSubtype</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN723"><span class='Ref_to_Const'>TYPTYPE_PSEUDO</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"range subtype cannot be %s"</span><span class='Delimiter'>, 
</span>                        <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1304"><span class='Ref_To_Local'>rangeSubtype</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Identify subopclass */ 
</span>    <a href="typecmds.c.html#LN1309"><span class='Ref_To_Local'>rangeSubOpclass</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN96"><span class='Ref_to_Proto'>findRangeSubOpclass</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1305"><span class='Ref_To_Local'>rangeSubOpclassName</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1304"><span class='Ref_To_Local'>rangeSubtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Identify collation to use, if any */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/lsyscache.h.html#LN167"><span class='Ref_to_Proto'>type_is_collatable</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1304"><span class='Ref_To_Local'>rangeSubtype</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN1306"><span class='Ref_To_Local'>rangeCollationName</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>            <a href="typecmds.c.html#LN1310"><span class='Ref_To_Local'>rangeCollation</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN142"><span class='Ref_to_Proto'>get_collation_oid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1306"><span class='Ref_To_Local'>rangeCollationName</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="typecmds.c.html#LN1310"><span class='Ref_To_Local'>rangeCollation</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN166"><span class='Ref_to_Proto'>get_typcollation</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1304"><span class='Ref_To_Local'>rangeSubtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN1306"><span class='Ref_To_Local'>rangeCollationName</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"range collation specified but subtype does not support collation"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="typecmds.c.html#LN1310"><span class='Ref_To_Local'>rangeCollation</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Identify support functions, if provided */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN1307"><span class='Ref_To_Local'>rangeCanonicalName</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <a href="typecmds.c.html#LN1311"><span class='Ref_To_Local'>rangeCanonical</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN97"><span class='Ref_to_Proto'>findRangeCanonicalFunction</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1307"><span class='Ref_To_Local'>rangeCanonicalName</span></a><span class='Delimiter'>, 
</span>                                                    <a href="typecmds.c.html#LN1301"><span class='Ref_To_Local'>typoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="typecmds.c.html#LN1311"><span class='Ref_To_Local'>rangeCanonical</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN1308"><span class='Ref_To_Local'>rangeSubtypeDiffName</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <a href="typecmds.c.html#LN1312"><span class='Ref_To_Local'>rangeSubtypeDiff</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN98"><span class='Ref_to_Proto'>findRangeSubtypeDiffFunction</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1308"><span class='Ref_To_Local'>rangeSubtypeDiffName</span></a><span class='Delimiter'>, 
</span>                                                        <a href="typecmds.c.html#LN1304"><span class='Ref_To_Local'>rangeSubtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="typecmds.c.html#LN1312"><span class='Ref_To_Local'>rangeSubtypeDiff</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/lsyscache.h.html#LN136"><span class='Ref_to_Proto'>get_typlenbyvalalign</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1304"><span class='Ref_To_Local'>rangeSubtype</span></a><span class='Delimiter'>, 
</span>                         <span class='Operator'>&</span><a href="typecmds.c.html#LN1313"><span class='Ref_To_Local'>subtyplen</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="typecmds.c.html#LN1314"><span class='Ref_To_Local'>subtypbyval</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="typecmds.c.html#LN1315"><span class='Ref_To_Local'>subtypalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* alignment must be 'i' or 'd' for ranges */ 
</span>    <a href="typecmds.c.html#LN1316"><span class='Ref_To_Local'>alignment</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1315"><span class='Ref_To_Local'>subtypalign</span></a> <span class='Operator'>== </span><span class='String'>'d'</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='String'>'d'</span> <span class='Operator'>: </span><span class='String'>'i'</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Allocate OID for array type */ 
</span>    <a href="typecmds.c.html#LN1303"><span class='Ref_To_Local'>rangeArrayOid</span></a> <span class='Operator'>= </span><a href="../../include/commands/typecmds.h.html#LN30"><span class='Ref_to_Proto'>AssignTypeArrayOid</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create the pg_type entry */ 
</span>    <a href="typecmds.c.html#LN1319"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= 
</span>        <a href="../../include/catalog/pg_type_fn.h.html#LN24"><span class='Ref_to_Proto'>TypeCreate</span></a><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* no predetermined type OID */ 
</span>                   <a href="typecmds.c.html#LN1299"><span class='Ref_To_Local'>typeName</span></a><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* type name */ 
</span>                   <a href="typecmds.c.html#LN1300"><span class='Ref_To_Local'>typeNamespace</span></a><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* namespace */ 
</span>                   <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* relation oid (n/a here) */ 
</span>                   <span class='Number'>0</span><span class='Delimiter'>,</span>           <span class='Comment_Single_Line'>/* relation kind (ditto) */ 
</span>                   <a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* owner's ID */ 
</span>                   <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>,</span>          <span class='Comment_Single_Line'>/* internal size (always varlena) */ 
</span>                   <a href="../../include/catalog/pg_type.h.html#LN724"><span class='Ref_to_Const'>TYPTYPE_RANGE</span></a><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* type-type (range type) */ 
</span>                   <a href="../../include/catalog/pg_type.h.html#LN736"><span class='Ref_to_Const'>TYPCATEGORY_RANGE</span></a><span class='Delimiter'>,</span>   <span class='Comment_Single_Line'>/* type-category (range type) */ 
</span>                   <span class='Boolean'>false</span><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* range types are never preferred */ 
</span>                   <a href="../../include/commands/typecmds.h.html#LN21"><span class='Ref_to_Const'>DEFAULT_TYPDELIM</span></a><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* array element delimiter */ 
</span>                   F_RANGE_IN<span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* input procedure */ 
</span>                   F_RANGE_OUT<span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* output procedure */ 
</span>                   F_RANGE_RECV<span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* receive procedure */ 
</span>                   F_RANGE_SEND<span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* send procedure */ 
</span>                   <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* typmodin procedure - none */ 
</span>                   <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* typmodout procedure - none */ 
</span>                   F_RANGE_TYPANALYZE<span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* analyze procedure */ 
</span>                   <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* element type ID - none */ 
</span>                   <span class='Boolean'>false</span><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* this is not an array type */ 
</span>                   <a href="typecmds.c.html#LN1303"><span class='Ref_To_Local'>rangeArrayOid</span></a><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* array type we are about to create */ 
</span>                   <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* base type ID (only for domains) */ 
</span>                   <span class='Null_Value'>NULL</span><span class='Delimiter'>,</span>        <span class='Comment_Single_Line'>/* never a default type value */ 
</span>                   <span class='Null_Value'>NULL</span><span class='Delimiter'>,</span>        <span class='Comment_Single_Line'>/* no binary form available either */ 
</span>                   <span class='Boolean'>false</span><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* never passed by value */ 
</span>                   <a href="typecmds.c.html#LN1316"><span class='Ref_To_Local'>alignment</span></a><span class='Delimiter'>,</span>   <span class='Comment_Single_Line'>/* alignment */ 
</span>                   <span class='String'>'x'</span><span class='Delimiter'>,</span>         <span class='Comment_Single_Line'>/* TOAST strategy (always extended) */ 
</span>                   <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>,</span>          <span class='Comment_Single_Line'>/* typMod (Domains only) */ 
</span>                   <span class='Number'>0</span><span class='Delimiter'>,</span>           <span class='Comment_Single_Line'>/* Array dimensions of typbasetype */ 
</span>                   <span class='Boolean'>false</span><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* Type NOT NULL */ 
</span>                   <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* type's collation (ranges never have one) */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1301"><span class='Ref_To_Local'>typoid</span></a> <span class='Operator'>== </span><a href="typecmds.c.html#LN1319"><span class='Ref_To_Local'>address</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create the entry in pg_range */ 
</span>    <a href="../catalog/pg_range.c.html#LN35"><span class='Ref_to_Func'>RangeCreate</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1301"><span class='Ref_To_Local'>typoid</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1304"><span class='Ref_To_Local'>rangeSubtype</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1310"><span class='Ref_To_Local'>rangeCollation</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1309"><span class='Ref_To_Local'>rangeSubOpclass</span></a><span class='Delimiter'>, 
</span>                <a href="typecmds.c.html#LN1311"><span class='Ref_To_Local'>rangeCanonical</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1312"><span class='Ref_To_Local'>rangeSubtypeDiff</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create the array type that goes with it. 
     */ 
</span>    <a href="typecmds.c.html#LN1302"><span class='Ref_To_Local'>rangeArrayName</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_type_fn.h.html#LN78"><span class='Ref_to_Proto'>makeArrayTypeName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1299"><span class='Ref_To_Local'>typeName</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1300"><span class='Ref_To_Local'>typeNamespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/pg_type_fn.h.html#LN24"><span class='Ref_to_Proto'>TypeCreate</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1303"><span class='Ref_To_Local'>rangeArrayOid</span></a><span class='Delimiter'>,</span>   <span class='Comment_Single_Line'>/* force assignment of this type OID */ 
</span>               <a href="typecmds.c.html#LN1302"><span class='Ref_To_Local'>rangeArrayName</span></a><span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* type name */ 
</span>               <a href="typecmds.c.html#LN1300"><span class='Ref_To_Local'>typeNamespace</span></a><span class='Delimiter'>,</span>   <span class='Comment_Single_Line'>/* namespace */ 
</span>               <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* relation oid (n/a here) */ 
</span>               <span class='Number'>0</span><span class='Delimiter'>,</span>               <span class='Comment_Single_Line'>/* relation kind (ditto) */ 
</span>               <a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* owner's ID */ 
</span>               <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>,</span>              <span class='Comment_Single_Line'>/* internal size (always varlena) */ 
</span>               <a href="../../include/catalog/pg_type.h.html#LN719"><span class='Ref_to_Const'>TYPTYPE_BASE</span></a><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* type-type (base type) */ 
</span>               <a href="../../include/catalog/pg_type.h.html#LN727"><span class='Ref_to_Const'>TYPCATEGORY_ARRAY</span></a><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* type-category (array) */ 
</span>               <span class='Boolean'>false</span><span class='Delimiter'>,</span>           <span class='Comment_Single_Line'>/* array types are never preferred */ 
</span>               <a href="../../include/commands/typecmds.h.html#LN21"><span class='Ref_to_Const'>DEFAULT_TYPDELIM</span></a><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* array element delimiter */ 
</span>               F_ARRAY_IN<span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* input procedure */ 
</span>               F_ARRAY_OUT<span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* output procedure */ 
</span>               F_ARRAY_RECV<span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* receive procedure */ 
</span>               F_ARRAY_SEND<span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* send procedure */ 
</span>               <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* typmodin procedure - none */ 
</span>               <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* typmodout procedure - none */ 
</span>               F_ARRAY_TYPANALYZE<span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* analyze procedure */ 
</span>               <a href="typecmds.c.html#LN1301"><span class='Ref_To_Local'>typoid</span></a><span class='Delimiter'>,</span>          <span class='Comment_Single_Line'>/* element type ID */ 
</span>               <span class='Boolean'>true</span><span class='Delimiter'>,</span>            <span class='Comment_Single_Line'>/* yes this is an array type */ 
</span>               <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* no further array type */ 
</span>               <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* base type ID */ 
</span>               <span class='Null_Value'>NULL</span><span class='Delimiter'>,</span>            <span class='Comment_Single_Line'>/* never a default type value */ 
</span>               <span class='Null_Value'>NULL</span><span class='Delimiter'>,</span>            <span class='Comment_Single_Line'>/* binary default isn't sent either */ 
</span>               <span class='Boolean'>false</span><span class='Delimiter'>,</span>           <span class='Comment_Single_Line'>/* never passed by value */ 
</span>               <a href="typecmds.c.html#LN1316"><span class='Ref_To_Local'>alignment</span></a><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* alignment - same as range's */ 
</span>               <span class='String'>'x'</span><span class='Delimiter'>,</span>             <span class='Comment_Single_Line'>/* ARRAY is always toastable */ 
</span>               <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>,</span>              <span class='Comment_Single_Line'>/* typMod (Domains only) */ 
</span>               <span class='Number'>0</span><span class='Delimiter'>,</span>               <span class='Comment_Single_Line'>/* Array dimensions of typbasetype */ 
</span>               <span class='Boolean'>false</span><span class='Delimiter'>,</span>           <span class='Comment_Single_Line'>/* Type NOT NULL */ 
</span>               <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* typcollation */ 
</span> 
    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1302"><span class='Ref_To_Local'>rangeArrayName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* And create the constructor functions for this range type */ 
</span>    <a href="typecmds.c.html#LN87"><span class='Ref_to_Proto'>makeRangeConstructors</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1299"><span class='Ref_To_Local'>typeName</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1300"><span class='Ref_To_Local'>typeNamespace</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1301"><span class='Ref_To_Local'>typoid</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1304"><span class='Ref_To_Local'>rangeSubtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="typecmds.c.html#LN1319"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DefineRange &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Because there may exist several range types over the same subtype, the 
 * range type can't be uniquely determined from the subtype.  So it's 
 * impossible to define a polymorphic constructor; we have to generate new 
 * constructor functions explicitly for each range type. 
 * 
 * We actually define 4 functions, with 0 through 3 arguments.  This is just 
 * to offer more convenience for the user. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1565"></a><span class='Declare_Function'>makeRangeConstructors</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>namespace</span><span class='Delimiter'>, 
</span><a name="LN1566"></a>                      <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>rangeOid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>subtype</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1568"></a>    <span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Keyword'>const </span><span class='Declare_Local'>prosrc</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{</span><span class='String'>"range_constructor2"</span><span class='Delimiter'>, 
</span>    <span class='String'>"range_constructor3"</span><span class='Delimiter'>}; 
</span><a name="LN1570"></a>    <span class='Keyword'>static const int </span><span class='Declare_Local'>pronargs</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{</span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Delimiter'>}; 
</span> 
<a name="LN1572"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>constructorArgTypes</span><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>]; 
</span><a name="LN1573"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>myself</span><span class='Delimiter'>, 
</span><a name="LN1574"></a>                <span class='Declare_Local'>referenced</span><span class='Delimiter'>; 
</span><a name="LN1575"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN1572"><span class='Ref_To_Local'>constructorArgTypes</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="typecmds.c.html#LN1566"><span class='Ref_to_Parameter'>subtype</span></a><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN1572"><span class='Ref_To_Local'>constructorArgTypes</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="typecmds.c.html#LN1566"><span class='Ref_to_Parameter'>subtype</span></a><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN1572"><span class='Ref_To_Local'>constructorArgTypes</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN1574"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN1574"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN1566"><span class='Ref_to_Parameter'>rangeOid</span></a><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN1574"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN1575"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="typecmds.c.html#LN1575"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../include/c.h.html#LN561"><span class='Ref_to_Macro'>lengthof</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1568"><span class='Ref_To_Local'>prosrc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="typecmds.c.html#LN1575"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1587"></a>        <a href="../../include/c.h.html#LN477"><span class='Ref_to_Typedef'>oidvector</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>constructorArgTypesVector</span><span class='Delimiter'>; 
</span> 
        <a href="typecmds.c.html#LN1587"><span class='Ref_To_Local'>constructorArgTypesVector</span></a> <span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN67"><span class='Ref_to_Proto'>buildoidvector</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1572"><span class='Ref_To_Local'>constructorArgTypes</span></a><span class='Delimiter'>, 
</span>                                                   <a href="typecmds.c.html#LN1570"><span class='Ref_To_Local'>pronargs</span></a><span class='Delimiter'>[</span><a href="typecmds.c.html#LN1575"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="typecmds.c.html#LN1573"><span class='Ref_To_Local'>myself</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_proc_fn.h.html#LN19"><span class='Ref_to_Proto'>ProcedureCreate</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1565"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* name: same as range type */ 
</span>                                 <span class='Control'>namespace</span><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* namespace */ 
</span>                                 <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* replace */ 
</span>                                 <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* returns set */ 
</span>                                 <a href="typecmds.c.html#LN1566"><span class='Ref_to_Parameter'>rangeOid</span></a><span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* return type */ 
</span>                                 <a href="../../include/catalog/pg_authid.h.html#LN101"><span class='Ref_to_Const'>BOOTSTRAP_SUPERUSERID</span></a><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* proowner */ 
</span>                                 <a href="../../include/catalog/pg_language.h.html#LN73"><span class='Ref_to_Const'>INTERNALlanguageId</span></a><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* language */ 
</span>                                 F_FMGR_INTERNAL_VALIDATOR<span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* language validator */ 
</span>                                 <a href="typecmds.c.html#LN1568"><span class='Ref_To_Local'>prosrc</span></a><span class='Delimiter'>[</span><a href="typecmds.c.html#LN1575"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>],</span>     <span class='Comment_Single_Line'>/* prosrc */ 
</span>                                 <span class='Null_Value'>NULL</span><span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* probin */ 
</span>                                 <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* isAgg */ 
</span>                                 <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* isWindowFunc */ 
</span>                                 <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* security_definer */ 
</span>                                 <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* leakproof */ 
</span>                                 <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* isStrict */ 
</span>                                 <a href="../../include/catalog/pg_proc.h.html#LN5482"><span class='Ref_to_Const'>PROVOLATILE_IMMUTABLE</span></a><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* volatility */ 
</span>                                 <a href="../../include/catalog/pg_proc.h.html#LN5491"><span class='Ref_to_Const'>PROPARALLEL_SAFE</span></a><span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* parallel safety */ 
</span>                                 <a href="typecmds.c.html#LN1587"><span class='Ref_To_Local'>constructorArgTypesVector</span></a><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* parameterTypes */ 
</span>                                 <a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* allParameterTypes */ 
</span>                                 <a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* parameterModes */ 
</span>                                 <a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* parameterNames */ 
</span>                                 <a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>,</span>   <span class='Comment_Single_Line'>/* parameterDefaults */ 
</span>                                 <a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* trftypes */ 
</span>                                 <a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* proconfig */ 
</span>                                 <span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>,</span>   <span class='Comment_Single_Line'>/* procost */ 
</span>                                 <span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* prorows */ 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Make the constructors internally-dependent on the range type so 
         * that they go away silently when the type is dropped.  Note that 
         * pg_dump depends on this choice to avoid dumping the constructors. 
         */ 
</span>        <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="typecmds.c.html#LN1573"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="typecmds.c.html#LN1574"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN76"><span class='Ref_to_EnumConst'>DEPENDENCY_INTERNAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;lengthof(prosrc... &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end makeRangeConstructors &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Find suitable I/O functions for a type. 
 * 
 * typeOid is the type's OID (which will already exist, if only as a shell 
 * type). 
 */ 
</span> 
<span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN1637"></a><span class='Declare_Function'>findTypeInputFunction</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>procname</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeOid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1639"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>argList</span><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>]; 
</span><a name="LN1640"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>procOid</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Input functions can take a single argument of type CSTRING, or three 
     * arguments (string, typioparam OID, typmod). 
     * 
     * For backwards compatibility we allow OPAQUE in place of CSTRING; if we 
     * see this, we issue a warning and fix up the pg_proc entry. 
     */ 
</span>    <a href="typecmds.c.html#LN1639"><span class='Ref_To_Local'>argList</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/catalog/pg_type.h.html#LN683"><span class='Ref_to_Const'>CSTRINGOID</span></a><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN1640"><span class='Ref_To_Local'>procOid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_func.h.html#LN62"><span class='Ref_to_Proto'>LookupFuncName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1637"><span class='Ref_to_Parameter'>procname</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1639"><span class='Ref_To_Local'>argList</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1640"><span class='Ref_To_Local'>procOid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="typecmds.c.html#LN1640"><span class='Ref_To_Local'>procOid</span></a><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN1639"><span class='Ref_To_Local'>argList</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN27"><span class='Ref_to_Const'>OIDOID</span></a><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN1639"><span class='Ref_To_Local'>argList</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN24"><span class='Ref_to_Const'>INT4OID</span></a><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN1640"><span class='Ref_To_Local'>procOid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_func.h.html#LN62"><span class='Ref_to_Proto'>LookupFuncName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1637"><span class='Ref_to_Parameter'>procname</span></a><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1639"><span class='Ref_To_Local'>argList</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1640"><span class='Ref_To_Local'>procOid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="typecmds.c.html#LN1640"><span class='Ref_To_Local'>procOid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* No luck, try it with OPAQUE */ 
</span>    <a href="typecmds.c.html#LN1639"><span class='Ref_To_Local'>argList</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/catalog/pg_type.h.html#LN699"><span class='Ref_to_Const'>OPAQUEOID</span></a><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN1640"><span class='Ref_To_Local'>procOid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_func.h.html#LN62"><span class='Ref_to_Proto'>LookupFuncName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1637"><span class='Ref_to_Parameter'>procname</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1639"><span class='Ref_To_Local'>argList</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1640"><span class='Ref_To_Local'>procOid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="typecmds.c.html#LN1639"><span class='Ref_To_Local'>argList</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN27"><span class='Ref_to_Const'>OIDOID</span></a><span class='Delimiter'>; 
</span>        <a href="typecmds.c.html#LN1639"><span class='Ref_To_Local'>argList</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN24"><span class='Ref_to_Const'>INT4OID</span></a><span class='Delimiter'>; 
</span> 
        <a href="typecmds.c.html#LN1640"><span class='Ref_To_Local'>procOid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_func.h.html#LN62"><span class='Ref_to_Proto'>LookupFuncName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1637"><span class='Ref_to_Parameter'>procname</span></a><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1639"><span class='Ref_To_Local'>argList</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1640"><span class='Ref_To_Local'>procOid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Found, but must complain and fix the pg_proc entry */ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"changing argument type of function %s from \"opaque\" to \"cstring\""</span><span class='Delimiter'>, 
</span>                        <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1637"><span class='Ref_to_Parameter'>procname</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <a href="../../include/commands/defrem.h.html#LN52"><span class='Ref_to_Proto'>SetFunctionArgType</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1640"><span class='Ref_To_Local'>procOid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="../../include/catalog/pg_type.h.html#LN683"><span class='Ref_to_Const'>CSTRINGOID</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Need CommandCounterIncrement since DefineType will likely try to 
         * alter the pg_proc tuple again. 
         */ 
</span>        <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span> <a href="typecmds.c.html#LN1640"><span class='Ref_To_Local'>procOid</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Use CSTRING (preferred) in the error message */ 
</span>    <a href="typecmds.c.html#LN1639"><span class='Ref_To_Local'>argList</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/catalog/pg_type.h.html#LN683"><span class='Ref_to_Const'>CSTRINGOID</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"function %s does not exist"</span><span class='Delimiter'>, 
</span>                    <a href="../../include/parser/parse_func.h.html#LN59"><span class='Ref_to_Proto'>func_signature_string</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1637"><span class='Ref_to_Parameter'>procname</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1639"><span class='Ref_To_Local'>argList</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end findTypeInputFunction &raquo; </span> 
 
<span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN1704"></a><span class='Declare_Function'>findTypeOutputFunction</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>procname</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeOid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1706"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>argList</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN1707"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>procOid</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Output functions can take a single argument of the type. 
     * 
     * For backwards compatibility we allow OPAQUE in place of the actual type 
     * name; if we see this, we issue a warning and fix up the pg_proc entry. 
     */ 
</span>    <a href="typecmds.c.html#LN1706"><span class='Ref_To_Local'>argList</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="typecmds.c.html#LN1704"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN1707"><span class='Ref_To_Local'>procOid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_func.h.html#LN62"><span class='Ref_to_Proto'>LookupFuncName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1704"><span class='Ref_to_Parameter'>procname</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1706"><span class='Ref_To_Local'>argList</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1707"><span class='Ref_To_Local'>procOid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="typecmds.c.html#LN1707"><span class='Ref_To_Local'>procOid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* No luck, try it with OPAQUE */ 
</span>    <a href="typecmds.c.html#LN1706"><span class='Ref_To_Local'>argList</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/catalog/pg_type.h.html#LN699"><span class='Ref_to_Const'>OPAQUEOID</span></a><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN1707"><span class='Ref_To_Local'>procOid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_func.h.html#LN62"><span class='Ref_to_Proto'>LookupFuncName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1704"><span class='Ref_to_Parameter'>procname</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1706"><span class='Ref_To_Local'>argList</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1707"><span class='Ref_To_Local'>procOid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Found, but must complain and fix the pg_proc entry */ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"changing argument type of function %s from \"opaque\" to %s"</span><span class='Delimiter'>, 
</span>                <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1704"><span class='Ref_to_Parameter'>procname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1704"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <a href="../../include/commands/defrem.h.html#LN52"><span class='Ref_to_Proto'>SetFunctionArgType</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1707"><span class='Ref_To_Local'>procOid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1704"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Need CommandCounterIncrement since DefineType will likely try to 
         * alter the pg_proc tuple again. 
         */ 
</span>        <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span> <a href="typecmds.c.html#LN1707"><span class='Ref_To_Local'>procOid</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Use type name, not OPAQUE, in the failure message. */ 
</span>    <a href="typecmds.c.html#LN1706"><span class='Ref_To_Local'>argList</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="typecmds.c.html#LN1704"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"function %s does not exist"</span><span class='Delimiter'>, 
</span>                    <a href="../../include/parser/parse_func.h.html#LN59"><span class='Ref_to_Proto'>func_signature_string</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1704"><span class='Ref_to_Parameter'>procname</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1706"><span class='Ref_To_Local'>argList</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end findTypeOutputFunction &raquo; </span> 
 
<span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN1755"></a><span class='Declare_Function'>findTypeReceiveFunction</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>procname</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeOid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1757"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>argList</span><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>]; 
</span><a name="LN1758"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>procOid</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Receive functions can take a single argument of type INTERNAL, or three 
     * arguments (internal, typioparam OID, typmod). 
     */ 
</span>    <a href="typecmds.c.html#LN1757"><span class='Ref_To_Local'>argList</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/catalog/pg_type.h.html#LN697"><span class='Ref_to_Const'>INTERNALOID</span></a><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN1758"><span class='Ref_To_Local'>procOid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_func.h.html#LN62"><span class='Ref_to_Proto'>LookupFuncName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1755"><span class='Ref_to_Parameter'>procname</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1757"><span class='Ref_To_Local'>argList</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1758"><span class='Ref_To_Local'>procOid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="typecmds.c.html#LN1758"><span class='Ref_To_Local'>procOid</span></a><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN1757"><span class='Ref_To_Local'>argList</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN27"><span class='Ref_to_Const'>OIDOID</span></a><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN1757"><span class='Ref_To_Local'>argList</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN24"><span class='Ref_to_Const'>INT4OID</span></a><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN1758"><span class='Ref_To_Local'>procOid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_func.h.html#LN62"><span class='Ref_to_Proto'>LookupFuncName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1755"><span class='Ref_to_Parameter'>procname</span></a><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1757"><span class='Ref_To_Local'>argList</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1758"><span class='Ref_To_Local'>procOid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="typecmds.c.html#LN1758"><span class='Ref_To_Local'>procOid</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"function %s does not exist"</span><span class='Delimiter'>, 
</span>                    <a href="../../include/parser/parse_func.h.html#LN59"><span class='Ref_to_Proto'>func_signature_string</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1755"><span class='Ref_to_Parameter'>procname</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1757"><span class='Ref_To_Local'>argList</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end findTypeReceiveFunction &raquo; </span> 
 
<span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN1786"></a><span class='Declare_Function'>findTypeSendFunction</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>procname</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeOid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1788"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>argList</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN1789"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>procOid</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Send functions can take a single argument of the type. 
     */ 
</span>    <a href="typecmds.c.html#LN1788"><span class='Ref_To_Local'>argList</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="typecmds.c.html#LN1786"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN1789"><span class='Ref_To_Local'>procOid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_func.h.html#LN62"><span class='Ref_to_Proto'>LookupFuncName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1786"><span class='Ref_to_Parameter'>procname</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1788"><span class='Ref_To_Local'>argList</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1789"><span class='Ref_To_Local'>procOid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="typecmds.c.html#LN1789"><span class='Ref_To_Local'>procOid</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"function %s does not exist"</span><span class='Delimiter'>, 
</span>                    <a href="../../include/parser/parse_func.h.html#LN59"><span class='Ref_to_Proto'>func_signature_string</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1786"><span class='Ref_to_Parameter'>procname</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1788"><span class='Ref_To_Local'>argList</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end findTypeSendFunction &raquo; </span> 
 
<span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN1809"></a><span class='Declare_Function'>findTypeTypmodinFunction</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>procname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1811"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>argList</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN1812"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>procOid</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * typmodin functions always take one cstring[] argument and return int4. 
     */ 
</span>    <a href="typecmds.c.html#LN1811"><span class='Ref_To_Local'>argList</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/catalog/pg_type.h.html#LN499"><span class='Ref_to_Const'>CSTRINGARRAYOID</span></a><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN1812"><span class='Ref_To_Local'>procOid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_func.h.html#LN62"><span class='Ref_to_Proto'>LookupFuncName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1809"><span class='Ref_to_Parameter'>procname</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1811"><span class='Ref_To_Local'>argList</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1812"><span class='Ref_To_Local'>procOid</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"function %s does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/parser/parse_func.h.html#LN59"><span class='Ref_to_Proto'>func_signature_string</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1809"><span class='Ref_to_Parameter'>procname</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1811"><span class='Ref_To_Local'>argList</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/lsyscache.h.html#LN112"><span class='Ref_to_Proto'>get_func_rettype</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1812"><span class='Ref_To_Local'>procOid</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN24"><span class='Ref_to_Const'>INT4OID</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"typmod_in function %s must return type %s"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1809"><span class='Ref_to_Parameter'>procname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"integer"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="typecmds.c.html#LN1812"><span class='Ref_To_Local'>procOid</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end findTypeTypmodinFunction &raquo; </span> 
 
<span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN1836"></a><span class='Declare_Function'>findTypeTypmodoutFunction</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>procname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1838"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>argList</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN1839"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>procOid</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * typmodout functions always take one int4 argument and return cstring. 
     */ 
</span>    <a href="typecmds.c.html#LN1838"><span class='Ref_To_Local'>argList</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN24"><span class='Ref_to_Const'>INT4OID</span></a><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN1839"><span class='Ref_To_Local'>procOid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_func.h.html#LN62"><span class='Ref_to_Proto'>LookupFuncName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1836"><span class='Ref_to_Parameter'>procname</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1838"><span class='Ref_To_Local'>argList</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1839"><span class='Ref_To_Local'>procOid</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"function %s does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/parser/parse_func.h.html#LN59"><span class='Ref_to_Proto'>func_signature_string</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1836"><span class='Ref_to_Parameter'>procname</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1838"><span class='Ref_To_Local'>argList</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/lsyscache.h.html#LN112"><span class='Ref_to_Proto'>get_func_rettype</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1839"><span class='Ref_To_Local'>procOid</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../include/catalog/pg_type.h.html#LN683"><span class='Ref_to_Const'>CSTRINGOID</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"typmod_out function %s must return type %s"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1836"><span class='Ref_to_Parameter'>procname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"cstring"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="typecmds.c.html#LN1839"><span class='Ref_To_Local'>procOid</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end findTypeTypmodoutFunction &raquo; </span> 
 
<span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN1863"></a><span class='Declare_Function'>findTypeAnalyzeFunction</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>procname</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeOid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1865"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>argList</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN1866"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>procOid</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Analyze functions always take one INTERNAL argument and return bool. 
     */ 
</span>    <a href="typecmds.c.html#LN1865"><span class='Ref_To_Local'>argList</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/catalog/pg_type.h.html#LN697"><span class='Ref_to_Const'>INTERNALOID</span></a><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN1866"><span class='Ref_To_Local'>procOid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_func.h.html#LN62"><span class='Ref_to_Proto'>LookupFuncName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1863"><span class='Ref_to_Parameter'>procname</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1865"><span class='Ref_To_Local'>argList</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1866"><span class='Ref_To_Local'>procOid</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"function %s does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/parser/parse_func.h.html#LN59"><span class='Ref_to_Proto'>func_signature_string</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1863"><span class='Ref_to_Parameter'>procname</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1865"><span class='Ref_To_Local'>argList</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/lsyscache.h.html#LN112"><span class='Ref_to_Proto'>get_func_rettype</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1866"><span class='Ref_To_Local'>procOid</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN17"><span class='Ref_to_Const'>BOOLOID</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"type analyze function %s must return type %s"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1863"><span class='Ref_to_Parameter'>procname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"boolean"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="typecmds.c.html#LN1866"><span class='Ref_To_Local'>procOid</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end findTypeAnalyzeFunction &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Find suitable support functions and opclasses for a range type. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Find named btree opclass for subtype, or default btree opclass if 
 * opcname is NIL. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN1898"></a><span class='Declare_Function'>findRangeSubOpclass</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>opcname</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>subtype</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1900"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>opcid</span><span class='Delimiter'>; 
</span><a name="LN1901"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>opInputType</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN1898"><span class='Ref_to_Parameter'>opcname</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="typecmds.c.html#LN1900"><span class='Ref_To_Local'>opcid</span></a> <span class='Operator'>= </span><a href="../../include/commands/defrem.h.html#LN103"><span class='Ref_to_Proto'>get_opclass_oid</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_am.h.html#LN69"><span class='Ref_to_Const'>BTREE_AM_OID</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1898"><span class='Ref_to_Parameter'>opcname</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Verify that the operator class accepts this datatype. Note we will 
         * accept binary compatibility. 
         */ 
</span>        <a href="typecmds.c.html#LN1901"><span class='Ref_To_Local'>opInputType</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN97"><span class='Ref_to_Proto'>get_opclass_input_type</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1900"><span class='Ref_To_Local'>opcid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/parser/parse_coerce.h.html#LN33"><span class='Ref_to_Proto'>IsBinaryCoercible</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1898"><span class='Ref_to_Parameter'>subtype</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1901"><span class='Ref_To_Local'>opInputType</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"operator class \"%s\" does not accept data type %s"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1898"><span class='Ref_to_Parameter'>opcname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1898"><span class='Ref_to_Parameter'>subtype</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="typecmds.c.html#LN1900"><span class='Ref_To_Local'>opcid</span></a> <span class='Operator'>= </span><a href="../../include/commands/defrem.h.html#LN44"><span class='Ref_to_Proto'>GetDefaultOpClass</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1898"><span class='Ref_to_Parameter'>subtype</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_am.h.html#LN69"><span class='Ref_to_Const'>BTREE_AM_OID</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1900"><span class='Ref_To_Local'>opcid</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* We spell the error message identically to GetIndexOpClass */ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"data type %s has no default operator class for access method \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1898"><span class='Ref_to_Parameter'>subtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"btree"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"You must specify an operator class for the range type or define a default operator class for the subtype."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="typecmds.c.html#LN1900"><span class='Ref_To_Local'>opcid</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end findRangeSubOpclass &raquo; </span> 
 
<span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN1937"></a><span class='Declare_Function'>findRangeCanonicalFunction</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>procname</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeOid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1939"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>argList</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN1940"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>procOid</span><span class='Delimiter'>; 
</span><a name="LN1941"></a>    <a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Range canonical functions must take and return the range type, and must 
     * be immutable. 
     */ 
</span>    <a href="typecmds.c.html#LN1939"><span class='Ref_To_Local'>argList</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="typecmds.c.html#LN1937"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN1940"><span class='Ref_To_Local'>procOid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_func.h.html#LN62"><span class='Ref_to_Proto'>LookupFuncName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1937"><span class='Ref_to_Parameter'>procname</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1939"><span class='Ref_To_Local'>argList</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1940"><span class='Ref_To_Local'>procOid</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"function %s does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/parser/parse_func.h.html#LN59"><span class='Ref_to_Proto'>func_signature_string</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1937"><span class='Ref_to_Parameter'>procname</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1939"><span class='Ref_To_Local'>argList</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/lsyscache.h.html#LN112"><span class='Ref_to_Proto'>get_func_rettype</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1940"><span class='Ref_To_Local'>procOid</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="typecmds.c.html#LN1937"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"range canonical function %s must return range type"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/parser/parse_func.h.html#LN59"><span class='Ref_to_Proto'>func_signature_string</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1937"><span class='Ref_to_Parameter'>procname</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1939"><span class='Ref_To_Local'>argList</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/lsyscache.h.html#LN118"><span class='Ref_to_Proto'>func_volatile</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1940"><span class='Ref_To_Local'>procOid</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../include/catalog/pg_proc.h.html#LN5482"><span class='Ref_to_Const'>PROVOLATILE_IMMUTABLE</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"range canonical function %s must be immutable"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/parser/parse_func.h.html#LN59"><span class='Ref_to_Proto'>func_signature_string</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1937"><span class='Ref_to_Parameter'>procname</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1939"><span class='Ref_To_Local'>argList</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Also, range type's creator must have permission to call function */ 
</span>    <a href="typecmds.c.html#LN1941"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN285"><span class='Ref_to_Proto'>pg_proc_aclcheck</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1940"><span class='Ref_To_Local'>procOid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN78"><span class='Ref_to_Const'>ACL_EXECUTE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN1941"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1941"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN184"><span class='Ref_to_EnumConst'>ACL_KIND_PROC</span></a><span class='Delimiter'>, </span><a href="../../include/utils/lsyscache.h.html#LN110"><span class='Ref_to_Proto'>get_func_name</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1940"><span class='Ref_To_Local'>procOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="typecmds.c.html#LN1940"><span class='Ref_To_Local'>procOid</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end findRangeCanonicalFunction &raquo; </span> 
 
<span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN1978"></a><span class='Declare_Function'>findRangeSubtypeDiffFunction</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>procname</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>subtype</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1980"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>argList</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN1981"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>procOid</span><span class='Delimiter'>; 
</span><a name="LN1982"></a>    <a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Range subtype diff functions must take two arguments of the subtype, 
     * must return float8, and must be immutable. 
     */ 
</span>    <a href="typecmds.c.html#LN1980"><span class='Ref_To_Local'>argList</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="typecmds.c.html#LN1978"><span class='Ref_to_Parameter'>subtype</span></a><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN1980"><span class='Ref_To_Local'>argList</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="typecmds.c.html#LN1978"><span class='Ref_to_Parameter'>subtype</span></a><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN1981"><span class='Ref_To_Local'>procOid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_func.h.html#LN62"><span class='Ref_to_Proto'>LookupFuncName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1978"><span class='Ref_to_Parameter'>procname</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1980"><span class='Ref_To_Local'>argList</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1981"><span class='Ref_To_Local'>procOid</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"function %s does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/parser/parse_func.h.html#LN59"><span class='Ref_to_Proto'>func_signature_string</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1978"><span class='Ref_to_Parameter'>procname</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1980"><span class='Ref_To_Local'>argList</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/lsyscache.h.html#LN112"><span class='Ref_to_Proto'>get_func_rettype</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1981"><span class='Ref_To_Local'>procOid</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN39"><span class='Ref_to_Const'>FLOAT8OID</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"range subtype diff function %s must return type %s"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/parser/parse_func.h.html#LN59"><span class='Ref_to_Proto'>func_signature_string</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1978"><span class='Ref_to_Parameter'>procname</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1980"><span class='Ref_To_Local'>argList</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <span class='String'>"double precision"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/lsyscache.h.html#LN118"><span class='Ref_to_Proto'>func_volatile</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1981"><span class='Ref_To_Local'>procOid</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../include/catalog/pg_proc.h.html#LN5482"><span class='Ref_to_Const'>PROVOLATILE_IMMUTABLE</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"range subtype diff function %s must be immutable"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/parser/parse_func.h.html#LN59"><span class='Ref_to_Proto'>func_signature_string</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1978"><span class='Ref_to_Parameter'>procname</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN1980"><span class='Ref_To_Local'>argList</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Also, range type's creator must have permission to call function */ 
</span>    <a href="typecmds.c.html#LN1982"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN285"><span class='Ref_to_Proto'>pg_proc_aclcheck</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1981"><span class='Ref_To_Local'>procOid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN78"><span class='Ref_to_Const'>ACL_EXECUTE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN1982"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1982"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN184"><span class='Ref_to_EnumConst'>ACL_KIND_PROC</span></a><span class='Delimiter'>, </span><a href="../../include/utils/lsyscache.h.html#LN110"><span class='Ref_to_Proto'>get_func_name</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN1981"><span class='Ref_To_Local'>procOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="typecmds.c.html#LN1981"><span class='Ref_To_Local'>procOid</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end findRangeSubtypeDiffFunction &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *  AssignTypeArrayOid 
 * 
 *  Pre-assign the type's array OID for use in pg_type.typarray 
 */ 
</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN2026"></a><span class='Declare_Function'>AssignTypeArrayOid</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2028"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>type_array_oid</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Use binary-upgrade override for pg_type.typarray? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN101"><span class='Ref_to_Global_Var'>IsBinaryUpgrade</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN85"><span class='Ref_to_Global_Var'>binary_upgrade_next_array_pg_type_oid</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"pg_type array OID value not set when in binary upgrade mode"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="typecmds.c.html#LN2028"><span class='Ref_To_Local'>type_array_oid</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN85"><span class='Ref_to_Global_Var'>binary_upgrade_next_array_pg_type_oid</span></a><span class='Delimiter'>; 
</span>        <a href="typecmds.c.html#LN85"><span class='Ref_to_Global_Var'>binary_upgrade_next_array_pg_type_oid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2043"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pg_type</span> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="typecmds.c.html#LN2028"><span class='Ref_To_Local'>type_array_oid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/catalog.h.html#LN44"><span class='Ref_to_Proto'>GetNewOid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2043"><span class='Ref_To_Local'>pg_type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2043"><span class='Ref_To_Local'>pg_type</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="typecmds.c.html#LN2028"><span class='Ref_To_Local'>type_array_oid</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AssignTypeArrayOid &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------- 
 * DefineCompositeType 
 * 
 * Create a Composite Type relation. 
 * `DefineRelation' does all the work, we just provide the correct 
 * arguments! 
 * 
 * If the relation already exists, then 'DefineRelation' will abort 
 * the xact... 
 * 
 * Return type is the new type's object address. 
 *------------------------------------------------------------------- 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN2067"></a><span class='Declare_Function'>DefineCompositeType</span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typevar</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>coldeflist</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2069"></a>    <a href="../../include/nodes/parsenodes.h.html#LN1972"><span class='Ref_to_Struct'>CreateStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>createStmt</span> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1972"><span class='Ref_to_Struct'>CreateStmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2070"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>old_type_oid</span><span class='Delimiter'>; 
</span><a name="LN2071"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typeNamespace</span><span class='Delimiter'>; 
</span><a name="LN2072"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * now set the parameters for keys/inheritance etc. All of these are 
     * uninteresting for composite types... 
     */ 
</span>    <a href="typecmds.c.html#LN2069"><span class='Ref_To_Local'>createStmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1975"><span class='Ref_to_Member'>relation</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN2067"><span class='Ref_to_Parameter'>typevar</span></a><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN2069"><span class='Ref_To_Local'>createStmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1976"><span class='Ref_to_Member'>tableElts</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN2067"><span class='Ref_to_Parameter'>coldeflist</span></a><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN2069"><span class='Ref_To_Local'>createStmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1977"><span class='Ref_to_Member'>inhRelations</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN2069"><span class='Ref_To_Local'>createStmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1982"><span class='Ref_to_Member'>constraints</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN2069"><span class='Ref_To_Local'>createStmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1983"><span class='Ref_to_Member'>options</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN2069"><span class='Ref_To_Local'>createStmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1984"><span class='Ref_to_Member'>oncommit</span></a> <span class='Operator'>= </span><a href="../../include/nodes/primnodes.h.html#LN48"><span class='Ref_to_EnumConst'>ONCOMMIT_NOOP</span></a><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN2069"><span class='Ref_To_Local'>createStmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1985"><span class='Ref_to_Member'>tablespacename</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN2069"><span class='Ref_To_Local'>createStmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1986"><span class='Ref_to_Member'>if_not_exists</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check for collision with an existing type name. If there is one and 
     * it's an autogenerated array, we can rename it out of the way.  This 
     * check is here mainly to get a better error message about a "type" 
     * instead of below about a "relation". 
     */ 
</span>    <a href="typecmds.c.html#LN2071"><span class='Ref_To_Local'>typeNamespace</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN60"><span class='Ref_to_Proto'>RangeVarGetAndCheckCreationNamespace</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2069"><span class='Ref_To_Local'>createStmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1975"><span class='Ref_to_Member'>relation</span></a><span class='Delimiter'>, 
</span>                                                         <a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/catalog/namespace.h.html#LN63"><span class='Ref_to_Proto'>RangeVarAdjustRelationPersistence</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2069"><span class='Ref_To_Local'>createStmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1975"><span class='Ref_to_Member'>relation</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2071"><span class='Ref_To_Local'>typeNamespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN2070"><span class='Ref_To_Local'>old_type_oid</span></a> <span class='Operator'>= 
</span>        <a href="../../include/utils/syscache.h.html#LN184"><span class='Ref_to_Macro'>GetSysCacheOid2</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN106"><span class='Ref_to_EnumConst'>TYPENAMENSP</span></a><span class='Delimiter'>, 
</span>                        <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2069"><span class='Ref_To_Local'>createStmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1975"><span class='Ref_to_Member'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2071"><span class='Ref_To_Local'>typeNamespace</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2070"><span class='Ref_To_Local'>old_type_oid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/catalog/pg_type_fn.h.html#LN80"><span class='Ref_to_Proto'>moveArrayTypeName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2070"><span class='Ref_To_Local'>old_type_oid</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2069"><span class='Ref_To_Local'>createStmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1975"><span class='Ref_to_Member'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2071"><span class='Ref_To_Local'>typeNamespace</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/pg_basebackup/streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"type \"%s\" already exists"</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2069"><span class='Ref_To_Local'>createStmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1975"><span class='Ref_to_Member'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Finally create the relation.  This also creates the type. 
     */ 
</span>    <a href="../../include/commands/tablecmds.h.html#LN24"><span class='Ref_to_Proto'>DefineRelation</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2069"><span class='Ref_To_Local'>createStmt</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN165"><span class='Ref_to_Const'>RELKIND_COMPOSITE_TYPE</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="typecmds.c.html#LN2072"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, 
</span>                   <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="typecmds.c.html#LN2072"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DefineCompositeType &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * AlterDomainDefault 
 * 
 * Routine implementing ALTER DOMAIN SET/DROP DEFAULT statements. 
 * 
 * Returns ObjectAddress of the modified domain. 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN2125"></a><span class='Declare_Function'>AlterDomainDefault</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>names</span><span class='Delimiter'>, </span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>defaultRaw</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2127"></a>    <a href="../../include/nodes/parsenodes.h.html#LN205"><span class='Ref_to_Struct'>TypeName</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>typename</span><span class='Delimiter'>; 
</span><a name="LN2128"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>domainoid</span><span class='Delimiter'>; 
</span><a name="LN2129"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN2130"></a>    <a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pstate</span><span class='Delimiter'>; 
</span><a name="LN2131"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN2132"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>defaultValue</span><span class='Delimiter'>; 
</span><a name="LN2133"></a>    <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>defaultExpr</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* NULL if no default specified */ 
</span><a name="LN2134"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>new_record</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN238"><span class='Ref_to_Const'>Natts_pg_type</span></a><span class='Delimiter'>]; 
</span><a name="LN2135"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>new_record_nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN238"><span class='Ref_to_Const'>Natts_pg_type</span></a><span class='Delimiter'>]; 
</span><a name="LN2136"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>new_record_repl</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN238"><span class='Ref_to_Const'>Natts_pg_type</span></a><span class='Delimiter'>]; 
</span><a name="LN2137"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newtuple</span><span class='Delimiter'>; 
</span><a name="LN2138"></a>    <a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a> <span class='Declare_Local'>typTup</span><span class='Delimiter'>; 
</span><a name="LN2139"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make a TypeName so we can use standard type lookup machinery */ 
</span>    <span class='Keyword'>typename </span><span class='Operator'>= </span><a href="../../include/nodes/makefuncs.h.html#LN71"><span class='Ref_to_Proto'>makeTypeNameFromNameList</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2125"><span class='Ref_to_Parameter'>names</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN2128"><span class='Ref_To_Local'>domainoid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN27"><span class='Ref_to_Proto'>typenameTypeId</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Keyword'>typename</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Look up the domain in the type table */ 
</span>    <a href="typecmds.c.html#LN2131"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN2129"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2128"><span class='Ref_To_Local'>domainoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2129"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for type %u"</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2128"><span class='Ref_To_Local'>domainoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN2138"><span class='Ref_To_Local'>typTup</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2129"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check it's a domain and check user has permission for ALTER DOMAIN */ 
</span>    <a href="../../include/commands/typecmds.h.html#LN40"><span class='Ref_to_Proto'>checkDomainOwner</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2129"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Setup new tuple */ 
</span>    <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2134"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2134"><span class='Ref_To_Local'>new_record</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2135"><span class='Ref_To_Local'>new_record_nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2135"><span class='Ref_To_Local'>new_record_nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2136"><span class='Ref_To_Local'>new_record_repl</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2136"><span class='Ref_To_Local'>new_record_repl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Store the new default into the tuple */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN2125"><span class='Ref_to_Parameter'>defaultRaw</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Create a dummy ParseState for transformExpr */ 
</span>        <a href="typecmds.c.html#LN2130"><span class='Ref_To_Local'>pstate</span></a> <span class='Operator'>= </span><a href="../parser/parse_node.c.html#LN42"><span class='Ref_to_Func'>make_parsestate</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Cook the colDef-&GT;raw_expr into an expression. Note: Name is 
         * strictly for error message 
         */ 
</span>        <a href="typecmds.c.html#LN2133"><span class='Ref_To_Local'>defaultExpr</span></a> <span class='Operator'>= </span><a href="../../include/catalog/heap.h.html#LN107"><span class='Ref_to_Proto'>cookDefault</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2130"><span class='Ref_To_Local'>pstate</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2125"><span class='Ref_to_Parameter'>defaultRaw</span></a><span class='Delimiter'>, 
</span>                                  <a href="typecmds.c.html#LN2138"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typbasetype<span class='Delimiter'>, 
</span>                                  <a href="typecmds.c.html#LN2138"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typtypmod<span class='Delimiter'>, 
</span>                                  <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2138"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typname<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If the expression is just a NULL constant, we treat the command 
         * like ALTER ... DROP DEFAULT.  (But see note for same test in 
         * DefineDomain.) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN2133"><span class='Ref_To_Local'>defaultExpr</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>            <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2133"><span class='Ref_To_Local'>defaultExpr</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a><span class='Parentheses'>)</span> <span class='Operator'>&&</span><span class='Parentheses'>((</span><a href="../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="typecmds.c.html#LN2133"><span class='Ref_To_Local'>defaultExpr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>constisnull<span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Default is NULL, drop it */ 
</span>            <a href="typecmds.c.html#LN2135"><span class='Ref_To_Local'>new_record_nulls</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN266"><span class='Ref_to_Const'>Anum_pg_type_typdefaultbin</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="typecmds.c.html#LN2136"><span class='Ref_To_Local'>new_record_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN266"><span class='Ref_to_Const'>Anum_pg_type_typdefaultbin</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="typecmds.c.html#LN2135"><span class='Ref_To_Local'>new_record_nulls</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN267"><span class='Ref_to_Const'>Anum_pg_type_typdefault</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="typecmds.c.html#LN2136"><span class='Ref_To_Local'>new_record_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN267"><span class='Ref_to_Const'>Anum_pg_type_typdefault</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Expression must be stored as a nodeToString result, but we also 
             * require a valid textual representation (mainly to make life 
             * easier for pg_dump). 
             */ 
</span>            <a href="typecmds.c.html#LN2132"><span class='Ref_To_Local'>defaultValue</span></a> <span class='Operator'>= </span><a href="../../include/utils/ruleutils.h.html#LN26"><span class='Ref_to_Proto'>deparse_expression</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2133"><span class='Ref_To_Local'>defaultExpr</span></a><span class='Delimiter'>, 
</span>                                              <a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Form an updated tuple with the new default and write it back. 
             */ 
</span>            <a href="typecmds.c.html#LN2134"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN266"><span class='Ref_to_Const'>Anum_pg_type_typdefaultbin</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN598"><span class='Ref_to_Proto'>nodeToString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2133"><span class='Ref_To_Local'>defaultExpr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <a href="typecmds.c.html#LN2136"><span class='Ref_To_Local'>new_record_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN266"><span class='Ref_to_Const'>Anum_pg_type_typdefaultbin</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="typecmds.c.html#LN2134"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN267"><span class='Ref_to_Const'>Anum_pg_type_typdefault</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2132"><span class='Ref_To_Local'>defaultValue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="typecmds.c.html#LN2136"><span class='Ref_To_Local'>new_record_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN267"><span class='Ref_to_Const'>Anum_pg_type_typdefault</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if defaultRaw &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* ALTER ... DROP DEFAULT */ 
</span>        <a href="typecmds.c.html#LN2135"><span class='Ref_To_Local'>new_record_nulls</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN266"><span class='Ref_to_Const'>Anum_pg_type_typdefaultbin</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="typecmds.c.html#LN2136"><span class='Ref_To_Local'>new_record_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN266"><span class='Ref_to_Const'>Anum_pg_type_typdefaultbin</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="typecmds.c.html#LN2135"><span class='Ref_To_Local'>new_record_nulls</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN267"><span class='Ref_to_Const'>Anum_pg_type_typdefault</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="typecmds.c.html#LN2136"><span class='Ref_To_Local'>new_record_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN267"><span class='Ref_to_Const'>Anum_pg_type_typdefault</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="typecmds.c.html#LN2137"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2129"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2131"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="typecmds.c.html#LN2134"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2135"><span class='Ref_To_Local'>new_record_nulls</span></a><span class='Delimiter'>, 
</span>                                 <a href="typecmds.c.html#LN2136"><span class='Ref_To_Local'>new_record_repl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2131"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="typecmds.c.html#LN2129"><span class='Ref_To_Local'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2137"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Rebuild dependencies */ 
</span>    <a href="../../include/catalog/pg_type_fn.h.html#LN56"><span class='Ref_to_Proto'>GenerateTypeDependencies</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2138"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typnamespace<span class='Delimiter'>, 
</span>                             <a href="typecmds.c.html#LN2128"><span class='Ref_To_Local'>domainoid</span></a><span class='Delimiter'>, 
</span>                             <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>        <span class='Comment_Single_Line'>/* typrelid is n/a */ 
</span>                             <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* relation kind is n/a */ 
</span>                             <a href="typecmds.c.html#LN2138"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typowner<span class='Delimiter'>, 
</span>                             <a href="typecmds.c.html#LN2138"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typinput<span class='Delimiter'>, 
</span>                             <a href="typecmds.c.html#LN2138"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typoutput<span class='Delimiter'>, 
</span>                             <a href="typecmds.c.html#LN2138"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typreceive<span class='Delimiter'>, 
</span>                             <a href="typecmds.c.html#LN2138"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typsend<span class='Delimiter'>, 
</span>                             <a href="typecmds.c.html#LN2138"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typmodin<span class='Delimiter'>, 
</span>                             <a href="typecmds.c.html#LN2138"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typmodout<span class='Delimiter'>, 
</span>                             <a href="typecmds.c.html#LN2138"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typanalyze<span class='Delimiter'>, 
</span>                             <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                             <span class='Boolean'>false</span><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* a domain isn't an implicit array */ 
</span>                             <a href="typecmds.c.html#LN2138"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typbasetype<span class='Delimiter'>, 
</span>                             <a href="typecmds.c.html#LN2138"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typcollation<span class='Delimiter'>, 
</span>                             <a href="typecmds.c.html#LN2133"><span class='Ref_To_Local'>defaultExpr</span></a><span class='Delimiter'>, 
</span>                             <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* Rebuild is true */ 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2128"><span class='Ref_To_Local'>domainoid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2139"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2128"><span class='Ref_To_Local'>domainoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Clean up */ 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2131"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2137"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="typecmds.c.html#LN2139"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterDomainDefault &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * AlterDomainNotNull 
 * 
 * Routine implementing ALTER DOMAIN SET/DROP NOT NULL statements. 
 * 
 * Returns ObjectAddress of the modified domain. 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN2264"></a><span class='Declare_Function'>AlterDomainNotNull</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>names</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>notNull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2266"></a>    <a href="../../include/nodes/parsenodes.h.html#LN205"><span class='Ref_to_Struct'>TypeName</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>typename</span><span class='Delimiter'>; 
</span><a name="LN2267"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>domainoid</span><span class='Delimiter'>; 
</span><a name="LN2268"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>typrel</span><span class='Delimiter'>; 
</span><a name="LN2269"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN2270"></a>    <a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a> <span class='Declare_Local'>typTup</span><span class='Delimiter'>; 
</span><a name="LN2271"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span> <span class='Operator'>= </span><a href="../catalog/objectaddress.c.html#LN718"><span class='Ref_to_Global_Var'>InvalidObjectAddress</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make a TypeName so we can use standard type lookup machinery */ 
</span>    <span class='Keyword'>typename </span><span class='Operator'>= </span><a href="../../include/nodes/makefuncs.h.html#LN71"><span class='Ref_to_Proto'>makeTypeNameFromNameList</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2264"><span class='Ref_to_Parameter'>names</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN2267"><span class='Ref_To_Local'>domainoid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN27"><span class='Ref_to_Proto'>typenameTypeId</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Keyword'>typename</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Look up the domain in the type table */ 
</span>    <a href="typecmds.c.html#LN2268"><span class='Ref_To_Local'>typrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN2269"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2267"><span class='Ref_To_Local'>domainoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2269"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for type %u"</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2267"><span class='Ref_To_Local'>domainoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN2270"><span class='Ref_To_Local'>typTup</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2269"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check it's a domain and check user has permission for ALTER DOMAIN */ 
</span>    <a href="../../include/commands/typecmds.h.html#LN40"><span class='Ref_to_Proto'>checkDomainOwner</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2269"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Is the domain already set to the desired constraint? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN2270"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typnotnull <span class='Operator'>== </span><a href="typecmds.c.html#LN2264"><span class='Ref_to_Parameter'>notNull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2268"><span class='Ref_To_Local'>typrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="typecmds.c.html#LN2271"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Adding a NOT NULL constraint requires checking existing columns */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN2264"><span class='Ref_to_Parameter'>notNull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2298"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>rels</span><span class='Delimiter'>; 
</span><a name="LN2299"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>rt</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Fetch relation list with attributes based on this domain */ 
</span>        <span class='Comment_Multi_Line'>/* ShareLock is sufficient to prevent concurrent data changes */ 
</span> 
        <a href="typecmds.c.html#LN2298"><span class='Ref_To_Local'>rels</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN100"><span class='Ref_to_Proto'>get_rels_with_domain</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2267"><span class='Ref_To_Local'>domainoid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN40"><span class='Ref_to_Const'>ShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2299"><span class='Ref_To_Local'>rt</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2298"><span class='Ref_To_Local'>rels</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2308"></a>            <a href="typecmds.c.html#LN76"><span class='Ref_to_Typedef'>RelToCheck</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rtc</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="typecmds.c.html#LN76"><span class='Ref_to_Typedef'>RelToCheck</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2299"><span class='Ref_To_Local'>rt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2309"></a>            <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>testrel</span> <span class='Operator'>= </span><a href="typecmds.c.html#LN2308"><span class='Ref_To_Local'>rtc</span></a><span class='Operator'>-&GT;</span><a href="typecmds.c.html#LN78"><span class='Ref_to_Member'>rel</span></a><span class='Delimiter'>; 
</span><a name="LN2310"></a>            <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2309"><span class='Ref_To_Local'>testrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2311"></a>            <a href="../../include/access/heapam.h.html#LN99"><span class='Ref_to_Typedef'>HeapScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN2312"></a>            <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN2313"></a>            <a href="../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a>    <span class='Declare_Local'>snapshot</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Scan all tuples in this relation */ 
</span>            <a href="typecmds.c.html#LN2313"><span class='Ref_To_Local'>snapshot</span></a> <span class='Operator'>= </span><a href="../../include/utils/snapmgr.h.html#LN80"><span class='Ref_to_Proto'>RegisterSnapshot</span></a><span class='Parentheses'>(</span><a href="../../include/utils/snapmgr.h.html#LN64"><span class='Ref_to_Proto'>GetLatestSnapshot</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>            <a href="typecmds.c.html#LN2311"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN108"><span class='Ref_to_Proto'>heap_beginscan</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2309"><span class='Ref_To_Local'>testrel</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2313"><span class='Ref_To_Local'>snapshot</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="typecmds.c.html#LN2312"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN127"><span class='Ref_to_Proto'>heap_getnext</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2311"><span class='Ref_To_Local'>scan</span></a><span class='Delimiter'>, </span><a href="../../include/access/sdir.h.html#LN25"><span class='Ref_to_EnumConst'>ForwardScanDirection</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span><a name="LN2320"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Test attributes that are of the domain */ 
</span>                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN2320"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="typecmds.c.html#LN2320"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="typecmds.c.html#LN2308"><span class='Ref_To_Local'>rtc</span></a><span class='Operator'>-&GT;</span><a href="typecmds.c.html#LN79"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; </span><a href="typecmds.c.html#LN2320"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN2325"></a>                    <span class='Keyword'>int</span>         <span class='Declare_Local'>attnum</span> <span class='Operator'>= </span><a href="typecmds.c.html#LN2308"><span class='Ref_To_Local'>rtc</span></a><span class='Operator'>-&GT;</span><a href="typecmds.c.html#LN80"><span class='Ref_to_Member'>atts</span></a><span class='Delimiter'>[</span><a href="typecmds.c.html#LN2320"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../access/common/heaptuple.c.html#LN295"><span class='Ref_to_Func'>heap_attisnull</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2312"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2325"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>))</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * In principle the auxiliary information for this 
                         * error should be errdatatype(), but errtablecol() 
                         * seems considerably more useful in practice.  Since 
                         * this code only executes in an ALTER DOMAIN command, 
                         * the client should already know which domain is in 
                         * question. 
                         */ 
</span>                        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NOT_NULL_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" of table \"%s\" contains null values"</span><span class='Delimiter'>, 
</span>                                <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2310"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="typecmds.c.html#LN2325"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2309"><span class='Ref_To_Local'>testrel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                                 <a href="../../include/utils/relcache.h.html#LN77"><span class='Ref_to_Proto'>errtablecol</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2309"><span class='Ref_To_Local'>testrel</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2325"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;rtc-&GT;natts;i++ &raquo; </span> 
            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (tuple=heap_getnext(s... &raquo; </span> 
            <a href="../../include/access/heapam.h.html#LN126"><span class='Ref_to_Proto'>heap_endscan</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2311"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/snapmgr.h.html#LN81"><span class='Ref_to_Proto'>UnregisterSnapshot</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2313"><span class='Ref_To_Local'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Close each rel after processing, but keep lock */ 
</span>            <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2309"><span class='Ref_To_Local'>testrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if notNull &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Okay to update pg_type row.  We can scribble on typTup because it's a 
     * copy. 
     */ 
</span>    <a href="typecmds.c.html#LN2270"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typnotnull <span class='Operator'>= </span><a href="typecmds.c.html#LN2264"><span class='Ref_to_Parameter'>notNull</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2268"><span class='Ref_To_Local'>typrel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="typecmds.c.html#LN2269"><span class='Ref_To_Local'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2269"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2267"><span class='Ref_To_Local'>domainoid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2271"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2267"><span class='Ref_To_Local'>domainoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Clean up */ 
</span>    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2269"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2268"><span class='Ref_To_Local'>typrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="typecmds.c.html#LN2271"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterDomainNotNull &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * AlterDomainDropConstraint 
 * 
 * Implements the ALTER DOMAIN DROP CONSTRAINT statement 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN2379"></a><span class='Declare_Function'>AlterDomainDropConstraint</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>names</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>constrName</span><span class='Delimiter'>, 
</span><a name="LN2380"></a>                          <a href="../../include/nodes/parsenodes.h.html#LN1652"><span class='Ref_to_Enum'>DropBehavior</span></a> <span class='Declare_Parameter'>behavior</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>missing_ok</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2382"></a>    <a href="../../include/nodes/parsenodes.h.html#LN205"><span class='Ref_to_Struct'>TypeName</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>typename</span><span class='Delimiter'>; 
</span><a name="LN2383"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>domainoid</span><span class='Delimiter'>; 
</span><a name="LN2384"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN2385"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN2386"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>conrel</span><span class='Delimiter'>; 
</span><a name="LN2387"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>conscan</span><span class='Delimiter'>; 
</span><a name="LN2388"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN2389"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>contup</span><span class='Delimiter'>; 
</span><a name="LN2390"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN2391"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span> <span class='Operator'>= </span><a href="../catalog/objectaddress.c.html#LN718"><span class='Ref_to_Global_Var'>InvalidObjectAddress</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make a TypeName so we can use standard type lookup machinery */ 
</span>    <span class='Keyword'>typename </span><span class='Operator'>= </span><a href="../../include/nodes/makefuncs.h.html#LN71"><span class='Ref_to_Proto'>makeTypeNameFromNameList</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2379"><span class='Ref_to_Parameter'>names</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN2383"><span class='Ref_To_Local'>domainoid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN27"><span class='Ref_to_Proto'>typenameTypeId</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Keyword'>typename</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Look up the domain in the type table */ 
</span>    <a href="typecmds.c.html#LN2385"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN2384"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2383"><span class='Ref_To_Local'>domainoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2384"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for type %u"</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2383"><span class='Ref_To_Local'>domainoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check it's a domain and check user has permission for ALTER DOMAIN */ 
</span>    <a href="../../include/commands/typecmds.h.html#LN40"><span class='Ref_to_Proto'>checkDomainOwner</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2384"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Grab an appropriate lock on the pg_constraint relation */ 
</span>    <a href="typecmds.c.html#LN2386"><span class='Ref_To_Local'>conrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN28"><span class='Ref_to_Const'>ConstraintRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Use the index to scan only constraints of the target relation */ 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="typecmds.c.html#LN2388"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_constraint.h.html#LN160"><span class='Ref_to_Const'>Anum_pg_constraint_contypid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2384"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN2387"><span class='Ref_To_Local'>conscan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2386"><span class='Ref_To_Local'>conrel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN127"><span class='Ref_to_Const'>ConstraintTypidIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                 <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2388"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Scan over the result set, removing any matching entries. 
     */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="typecmds.c.html#LN2389"><span class='Ref_To_Local'>contup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2387"><span class='Ref_To_Local'>conscan</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2424"></a>        <a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a> <span class='Declare_Local'>con</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2389"><span class='Ref_To_Local'>contup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2424"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>conname<span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2379"><span class='Ref_to_Parameter'>constrName</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN2428"></a>            <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>conobj</span><span class='Delimiter'>; 
</span> 
            <a href="typecmds.c.html#LN2428"><span class='Ref_To_Local'>conobj</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_constraint.h.html#LN28"><span class='Ref_to_Const'>ConstraintRelationId</span></a><span class='Delimiter'>; 
</span>            <a href="typecmds.c.html#LN2428"><span class='Ref_To_Local'>conobj</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2389"><span class='Ref_To_Local'>contup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="typecmds.c.html#LN2428"><span class='Ref_To_Local'>conobj</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/catalog/dependency.h.html#LN182"><span class='Ref_to_Proto'>performDeletion</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="typecmds.c.html#LN2428"><span class='Ref_To_Local'>conobj</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2380"><span class='Ref_to_Parameter'>behavior</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="typecmds.c.html#LN2390"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2391"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2383"><span class='Ref_To_Local'>domainoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Clean up after the scan */ 
</span>    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2387"><span class='Ref_To_Local'>conscan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2386"><span class='Ref_To_Local'>conrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2385"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="typecmds.c.html#LN2390"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="typecmds.c.html#LN2380"><span class='Ref_to_Parameter'>missing_ok</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                  <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"constraint \"%s\" of domain \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                         <a href="typecmds.c.html#LN2379"><span class='Ref_to_Parameter'>constrName</span></a><span class='Delimiter'>, </span><a href="../../include/parser/parse_type.h.html#LN31"><span class='Ref_to_Proto'>TypeNameToString</span></a><span class='Parentheses'>(</span><span class='Keyword'>typename</span><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"constraint \"%s\" of domain \"%s\" does not exist, skipping"</span><span class='Delimiter'>, 
</span>                            <a href="typecmds.c.html#LN2379"><span class='Ref_to_Parameter'>constrName</span></a><span class='Delimiter'>, </span><a href="../../include/parser/parse_type.h.html#LN31"><span class='Ref_to_Proto'>TypeNameToString</span></a><span class='Parentheses'>(</span><span class='Keyword'>typename</span><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="typecmds.c.html#LN2391"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterDomainDropConstraint &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * AlterDomainAddConstraint 
 * 
 * Implements the ALTER DOMAIN .. ADD CONSTRAINT statement. 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN2469"></a><span class='Declare_Function'>AlterDomainAddConstraint</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>names</span><span class='Delimiter'>, </span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>newConstraint</span><span class='Delimiter'>, 
</span><a name="LN2470"></a>                         <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>constrAddr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2472"></a>    <a href="../../include/nodes/parsenodes.h.html#LN205"><span class='Ref_to_Struct'>TypeName</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>typename</span><span class='Delimiter'>; 
</span><a name="LN2473"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>domainoid</span><span class='Delimiter'>; 
</span><a name="LN2474"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>typrel</span><span class='Delimiter'>; 
</span><a name="LN2475"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN2476"></a>    <a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a> <span class='Declare_Local'>typTup</span><span class='Delimiter'>; 
</span><a name="LN2477"></a>    <a href="../../include/nodes/parsenodes.h.html#LN2050"><span class='Ref_to_Struct'>Constraint</span></a> <span class='Operator'>*</span><span class='Declare_Local'>constr</span><span class='Delimiter'>; 
</span><a name="LN2478"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ccbin</span><span class='Delimiter'>; 
</span><a name="LN2479"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make a TypeName so we can use standard type lookup machinery */ 
</span>    <span class='Keyword'>typename </span><span class='Operator'>= </span><a href="../../include/nodes/makefuncs.h.html#LN71"><span class='Ref_to_Proto'>makeTypeNameFromNameList</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2469"><span class='Ref_to_Parameter'>names</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN2473"><span class='Ref_To_Local'>domainoid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN27"><span class='Ref_to_Proto'>typenameTypeId</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Keyword'>typename</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Look up the domain in the type table */ 
</span>    <a href="typecmds.c.html#LN2474"><span class='Ref_To_Local'>typrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN2475"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2473"><span class='Ref_To_Local'>domainoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2475"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for type %u"</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2473"><span class='Ref_To_Local'>domainoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN2476"><span class='Ref_To_Local'>typTup</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2475"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check it's a domain and check user has permission for ALTER DOMAIN */ 
</span>    <a href="../../include/commands/typecmds.h.html#LN40"><span class='Ref_to_Proto'>checkDomainOwner</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2475"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2469"><span class='Ref_to_Parameter'>newConstraint</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2050"><span class='Ref_to_Struct'>Constraint</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized node type: %d"</span><span class='Delimiter'>, 
</span>             <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="../../include/nodes/nodes.h.html#LN513"><span class='Ref_to_Macro'>nodeTag</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2469"><span class='Ref_to_Parameter'>newConstraint</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN2477"><span class='Ref_To_Local'>constr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2050"><span class='Ref_to_Struct'>Constraint</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="typecmds.c.html#LN2469"><span class='Ref_to_Parameter'>newConstraint</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN2477"><span class='Ref_To_Local'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2053"><span class='Ref_to_Member'>contype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2027"><span class='Ref_to_EnumConst'>CONSTR_CHECK</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* processed below */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2029"><span class='Ref_to_EnumConst'>CONSTR_UNIQUE</span></a><span class='Operator'>: 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unique constraints not possible for domains"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2028"><span class='Ref_to_EnumConst'>CONSTR_PRIMARY</span></a><span class='Operator'>: 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"primary key constraints not possible for domains"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2030"><span class='Ref_to_EnumConst'>CONSTR_EXCLUSION</span></a><span class='Operator'>: 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                  <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"exclusion constraints not possible for domains"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2031"><span class='Ref_to_EnumConst'>CONSTR_FOREIGN</span></a><span class='Operator'>: 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"foreign key constraints not possible for domains"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2032"><span class='Ref_to_EnumConst'>CONSTR_ATTR_DEFERRABLE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2033"><span class='Ref_to_EnumConst'>CONSTR_ATTR_NOT_DEFERRABLE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2034"><span class='Ref_to_EnumConst'>CONSTR_ATTR_DEFERRED</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2035"><span class='Ref_to_EnumConst'>CONSTR_ATTR_IMMEDIATE</span></a><span class='Operator'>: 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"specifying constraint deferrability not supported for domains"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized constraint subtype: %d"</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="typecmds.c.html#LN2477"><span class='Ref_To_Local'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2053"><span class='Ref_to_Member'>contype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch constr-&GT;contype &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Since all other constraint types throw errors, this must be a check 
     * constraint.  First, process the constraint expression and add an entry 
     * to pg_constraint. 
     */ 
</span> 
    <a href="typecmds.c.html#LN2478"><span class='Ref_To_Local'>ccbin</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN102"><span class='Ref_to_Proto'>domainAddConstraint</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2473"><span class='Ref_To_Local'>domainoid</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2476"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typnamespace<span class='Delimiter'>, 
</span>                                <a href="typecmds.c.html#LN2476"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typbasetype<span class='Delimiter'>, </span><a href="typecmds.c.html#LN2476"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typtypmod<span class='Delimiter'>, 
</span>                                <a href="typecmds.c.html#LN2477"><span class='Ref_To_Local'>constr</span></a><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2476"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typname<span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2470"><span class='Ref_to_Parameter'>constrAddr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If requested to validate the constraint, test all values stored in the 
     * attributes based on the domain the constraint is being added to. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="typecmds.c.html#LN2477"><span class='Ref_To_Local'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2092"><span class='Ref_to_Member'>skip_validation</span></a><span class='Parentheses'>) 
</span>        <a href="typecmds.c.html#LN99"><span class='Ref_to_Proto'>validateDomainConstraint</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2473"><span class='Ref_To_Local'>domainoid</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2478"><span class='Ref_To_Local'>ccbin</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2479"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2473"><span class='Ref_To_Local'>domainoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Clean up */ 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2474"><span class='Ref_To_Local'>typrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="typecmds.c.html#LN2479"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterDomainAddConstraint &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * AlterDomainValidateConstraint 
 * 
 * Implements the ALTER DOMAIN .. VALIDATE CONSTRAINT statement. 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN2578"></a><span class='Declare_Function'>AlterDomainValidateConstraint</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>names</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>constrName</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2580"></a>    <a href="../../include/nodes/parsenodes.h.html#LN205"><span class='Ref_to_Struct'>TypeName</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>typename</span><span class='Delimiter'>; 
</span><a name="LN2581"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>domainoid</span><span class='Delimiter'>; 
</span><a name="LN2582"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>typrel</span><span class='Delimiter'>; 
</span><a name="LN2583"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>conrel</span><span class='Delimiter'>; 
</span><a name="LN2584"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN2585"></a>    <a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a> <span class='Declare_Local'>con</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN2586"></a>    <a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a> <span class='Declare_Local'>copy_con</span><span class='Delimiter'>; 
</span><a name="LN2587"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>conbin</span><span class='Delimiter'>; 
</span><a name="LN2588"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN2589"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN2590"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN2591"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN2592"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN2593"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>copyTuple</span><span class='Delimiter'>; 
</span><a name="LN2594"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>; 
</span><a name="LN2595"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make a TypeName so we can use standard type lookup machinery */ 
</span>    <span class='Keyword'>typename </span><span class='Operator'>= </span><a href="../../include/nodes/makefuncs.h.html#LN71"><span class='Ref_to_Proto'>makeTypeNameFromNameList</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2578"><span class='Ref_to_Parameter'>names</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN2581"><span class='Ref_To_Local'>domainoid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN27"><span class='Ref_to_Proto'>typenameTypeId</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Keyword'>typename</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Look up the domain in the type table */ 
</span>    <a href="typecmds.c.html#LN2582"><span class='Ref_To_Local'>typrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN2584"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2581"><span class='Ref_To_Local'>domainoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2584"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for type %u"</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2581"><span class='Ref_To_Local'>domainoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check it's a domain and check user has permission for ALTER DOMAIN */ 
</span>    <a href="../../include/commands/typecmds.h.html#LN40"><span class='Ref_to_Proto'>checkDomainOwner</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2584"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Find and check the target constraint 
     */ 
</span>    <a href="typecmds.c.html#LN2583"><span class='Ref_To_Local'>conrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN28"><span class='Ref_to_Const'>ConstraintRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="typecmds.c.html#LN2594"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/catalog/pg_constraint.h.html#LN160"><span class='Ref_to_Const'>Anum_pg_constraint_contypid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2581"><span class='Ref_To_Local'>domainoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN2588"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2583"><span class='Ref_To_Local'>conrel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN127"><span class='Ref_to_Const'>ConstraintTypidIndexId</span></a><span class='Delimiter'>, 
</span>                              <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="typecmds.c.html#LN2594"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2592"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2588"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="typecmds.c.html#LN2585"><span class='Ref_To_Local'>con</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2592"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2585"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>conname<span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2578"><span class='Ref_to_Parameter'>constrName</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="typecmds.c.html#LN2590"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="typecmds.c.html#LN2590"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"constraint \"%s\" of domain \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="typecmds.c.html#LN2578"><span class='Ref_to_Parameter'>constrName</span></a><span class='Delimiter'>, </span><a href="../../include/parser/parse_type.h.html#LN31"><span class='Ref_to_Proto'>TypeNameToString</span></a><span class='Parentheses'>(</span><span class='Keyword'>typename</span><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN2585"><span class='Ref_To_Local'>con</span></a><span class='Operator'>-&GT;</span>contype <span class='Operator'>!= </span><a href="../../include/catalog/pg_constraint.h.html#LN187"><span class='Ref_to_Const'>CONSTRAINT_CHECK</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"constraint \"%s\" of domain \"%s\" is not a check constraint"</span><span class='Delimiter'>, 
</span>               <a href="typecmds.c.html#LN2578"><span class='Ref_to_Parameter'>constrName</span></a><span class='Delimiter'>, </span><a href="../../include/parser/parse_type.h.html#LN31"><span class='Ref_to_Proto'>TypeNameToString</span></a><span class='Parentheses'>(</span><span class='Keyword'>typename</span><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN2589"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN52"><span class='Ref_to_EnumConst'>CONSTROID</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2592"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, 
</span>                          <a href="../../include/catalog/pg_constraint.h.html#LN175"><span class='Ref_to_Const'>Anum_pg_constraint_conbin</span></a><span class='Delimiter'>, 
</span>                          <span class='Operator'>&</span><a href="typecmds.c.html#LN2591"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN2591"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"null conbin for constraint %u"</span><span class='Delimiter'>, 
</span>             <a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2592"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN2587"><span class='Ref_To_Local'>conbin</span></a> <span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2589"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN99"><span class='Ref_to_Proto'>validateDomainConstraint</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2581"><span class='Ref_To_Local'>domainoid</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2587"><span class='Ref_To_Local'>conbin</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now update the catalog, while we have the door open. 
     */ 
</span>    <a href="typecmds.c.html#LN2593"><span class='Ref_To_Local'>copyTuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN606"><span class='Ref_to_Func'>heap_copytuple</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2592"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN2586"><span class='Ref_To_Local'>copy_con</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN146"><span class='Ref_to_Typedef'>Form_pg_constraint</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2593"><span class='Ref_To_Local'>copyTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN2586"><span class='Ref_To_Local'>copy_con</span></a><span class='Operator'>-&GT;</span>convalidated <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2583"><span class='Ref_To_Local'>conrel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="typecmds.c.html#LN2593"><span class='Ref_To_Local'>copyTuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2593"><span class='Ref_To_Local'>copyTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN28"><span class='Ref_to_Const'>ConstraintRelationId</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2593"><span class='Ref_To_Local'>copyTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2595"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2581"><span class='Ref_To_Local'>domainoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2593"><span class='Ref_To_Local'>copyTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2588"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2582"><span class='Ref_To_Local'>typrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2583"><span class='Ref_To_Local'>conrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2584"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="typecmds.c.html#LN2595"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterDomainValidateConstraint &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN2680"></a><span class='Declare_Function'>validateDomainConstraint</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>domainoid</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>ccbin</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2682"></a>    <a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../nodes/read.c.html#LN36"><span class='Ref_to_Func'>stringToNode</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2680"><span class='Ref_to_Parameter'>ccbin</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2683"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>rels</span><span class='Delimiter'>; 
</span><a name="LN2684"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>rt</span><span class='Delimiter'>; 
</span><a name="LN2685"></a>    <a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>estate</span><span class='Delimiter'>; 
</span><a name="LN2686"></a>    <a href="../../include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>econtext</span><span class='Delimiter'>; 
</span><a name="LN2687"></a>    <a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>exprstate</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Need an EState to run ExecEvalExpr */ 
</span>    <a href="typecmds.c.html#LN2685"><span class='Ref_To_Local'>estate</span></a> <span class='Operator'>= </span><a href="../executor/execUtils.c.html#LN78"><span class='Ref_to_Func'>CreateExecutorState</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN2686"><span class='Ref_To_Local'>econtext</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN455"><span class='Ref_to_Macro'>GetPerTupleExprContext</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2685"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* build execution state for expr */ 
</span>    <a href="typecmds.c.html#LN2687"><span class='Ref_To_Local'>exprstate</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN246"><span class='Ref_to_Proto'>ExecPrepareExpr</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2682"><span class='Ref_To_Local'>expr</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2685"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Fetch relation list with attributes based on this domain */ 
</span>    <span class='Comment_Multi_Line'>/* ShareLock is sufficient to prevent concurrent data changes */ 
</span> 
    <a href="typecmds.c.html#LN2683"><span class='Ref_To_Local'>rels</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN100"><span class='Ref_to_Proto'>get_rels_with_domain</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2680"><span class='Ref_to_Parameter'>domainoid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN40"><span class='Ref_to_Const'>ShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2684"><span class='Ref_To_Local'>rt</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2683"><span class='Ref_To_Local'>rels</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2703"></a>        <a href="typecmds.c.html#LN76"><span class='Ref_to_Typedef'>RelToCheck</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rtc</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="typecmds.c.html#LN76"><span class='Ref_to_Typedef'>RelToCheck</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2684"><span class='Ref_To_Local'>rt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2704"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>testrel</span> <span class='Operator'>= </span><a href="typecmds.c.html#LN2703"><span class='Ref_To_Local'>rtc</span></a><span class='Operator'>-&GT;</span><a href="typecmds.c.html#LN78"><span class='Ref_to_Member'>rel</span></a><span class='Delimiter'>; 
</span><a name="LN2705"></a>        <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2704"><span class='Ref_To_Local'>testrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2706"></a>        <a href="../../include/access/heapam.h.html#LN99"><span class='Ref_to_Typedef'>HeapScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN2707"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN2708"></a>        <a href="../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a>    <span class='Declare_Local'>snapshot</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Scan all tuples in this relation */ 
</span>        <a href="typecmds.c.html#LN2708"><span class='Ref_To_Local'>snapshot</span></a> <span class='Operator'>= </span><a href="../../include/utils/snapmgr.h.html#LN80"><span class='Ref_to_Proto'>RegisterSnapshot</span></a><span class='Parentheses'>(</span><a href="../../include/utils/snapmgr.h.html#LN64"><span class='Ref_to_Proto'>GetLatestSnapshot</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>        <a href="typecmds.c.html#LN2706"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN108"><span class='Ref_to_Proto'>heap_beginscan</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2704"><span class='Ref_To_Local'>testrel</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2708"><span class='Ref_To_Local'>snapshot</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="typecmds.c.html#LN2707"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN127"><span class='Ref_to_Proto'>heap_getnext</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2706"><span class='Ref_To_Local'>scan</span></a><span class='Delimiter'>, </span><a href="../../include/access/sdir.h.html#LN25"><span class='Ref_to_EnumConst'>ForwardScanDirection</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN2715"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Test attributes that are of the domain */ 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN2715"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="typecmds.c.html#LN2715"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="typecmds.c.html#LN2703"><span class='Ref_To_Local'>rtc</span></a><span class='Operator'>-&GT;</span><a href="typecmds.c.html#LN79"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; </span><a href="typecmds.c.html#LN2715"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2720"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>attnum</span> <span class='Operator'>= </span><a href="typecmds.c.html#LN2703"><span class='Ref_To_Local'>rtc</span></a><span class='Operator'>-&GT;</span><a href="typecmds.c.html#LN80"><span class='Ref_to_Member'>atts</span></a><span class='Delimiter'>[</span><a href="typecmds.c.html#LN2715"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span><a name="LN2721"></a>                <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>d</span><span class='Delimiter'>; 
</span><a name="LN2722"></a>                <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN2723"></a>                <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>conResult</span><span class='Delimiter'>; 
</span> 
                <a href="typecmds.c.html#LN2721"><span class='Ref_To_Local'>d</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN768"><span class='Ref_to_Macro'>heap_getattr</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2707"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2720"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2705"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="typecmds.c.html#LN2722"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="typecmds.c.html#LN2686"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN220"><span class='Ref_to_Member'>domainValue_datum</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN2721"><span class='Ref_To_Local'>d</span></a><span class='Delimiter'>; 
</span>                <a href="typecmds.c.html#LN2686"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN221"><span class='Ref_to_Member'>domainValue_isNull</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN2722"><span class='Ref_To_Local'>isNull</span></a><span class='Delimiter'>; 
</span> 
                <a href="typecmds.c.html#LN2723"><span class='Ref_To_Local'>conResult</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN279"><span class='Ref_to_Func'>ExecEvalExprSwitchContext</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2687"><span class='Ref_To_Local'>exprstate</span></a><span class='Delimiter'>, 
</span>                                                      <a href="typecmds.c.html#LN2686"><span class='Ref_To_Local'>econtext</span></a><span class='Delimiter'>, 
</span>                                                      <span class='Operator'>&</span><a href="typecmds.c.html#LN2722"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="typecmds.c.html#LN2722"><span class='Ref_To_Local'>isNull</span></a> <span class='Operator'>&& !</span><a href="../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2723"><span class='Ref_To_Local'>conResult</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * In principle the auxiliary information for this error 
                     * should be errdomainconstraint(), but errtablecol() 
                     * seems considerably more useful in practice.  Since this 
                     * code only executes in an ALTER DOMAIN command, the 
                     * client should already know which domain is in question, 
                     * and which constraint too. 
                     */ 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CHECK_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" of table \"%s\" contains values that violate the new constraint"</span><span class='Delimiter'>, 
</span>                                <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2705"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="typecmds.c.html#LN2720"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                    <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2704"><span class='Ref_To_Local'>testrel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                             <a href="../../include/utils/relcache.h.html#LN77"><span class='Ref_to_Proto'>errtablecol</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2704"><span class='Ref_To_Local'>testrel</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2720"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;rtc-&GT;natts;i++ &raquo; </span> 
 
            <a href="../../include/executor/executor.h.html#LN449"><span class='Ref_to_Macro'>ResetExprContext</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2686"><span class='Ref_To_Local'>econtext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (tuple=heap_getnext(s... &raquo; </span> 
        <a href="../../include/access/heapam.h.html#LN126"><span class='Ref_to_Proto'>heap_endscan</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2706"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/snapmgr.h.html#LN81"><span class='Ref_to_Proto'>UnregisterSnapshot</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2708"><span class='Ref_To_Local'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Hold relation lock till commit (XXX bad for concurrency) */ 
</span>        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2704"><span class='Ref_To_Local'>testrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../executor/execUtils.c.html#LN176"><span class='Ref_to_Func'>FreeExecutorState</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2685"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end validateDomainConstraint &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * get_rels_with_domain 
 * 
 * Fetch all relations / attributes which are using the domain 
 * 
 * The result is a list of RelToCheck structs, one for each distinct 
 * relation, each containing one or more attribute numbers that are of 
 * the domain type.  We have opened each rel and acquired the specified lock 
 * type on it. 
 * 
 * We support nested domains by including attributes that are of derived 
 * domain types.  Current callers do not need to distinguish between attributes 
 * that are of exactly the given domain and those that are of derived domains. 
 * 
 * XXX this is completely broken because there is no way to lock the domain 
 * to prevent columns from being added or dropped while our command runs. 
 * We can partially protect against column drops by locking relations as we 
 * come across them, but there is still a race condition (the window between 
 * seeing a pg_depend entry and acquiring lock on the relation it references). 
 * Also, holding locks on all these relations simultaneously creates a non- 
 * trivial risk of deadlock.  We can minimize but not eliminate the deadlock 
 * risk by using the weakest suitable lock (ShareLock for most callers). 
 * 
 * XXX the API for this is not sufficient to support checking domain values 
 * that are inside composite types or arrays.  Currently we just error out 
 * if a composite type containing the target domain is stored anywhere. 
 * There are not currently arrays of domains; if there were, we could take 
 * the same approach, but it'd be nicer to fix it properly. 
 * 
 * Generally used for retrieving a list of tests when adding 
 * new constraints to a domain. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN2798"></a><span class='Declare_Function'>get_rels_with_domain</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>domainOid</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2800"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN2801"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>depRel</span><span class='Delimiter'>; 
</span><a name="LN2802"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN2803"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>depScan</span><span class='Delimiter'>; 
</span><a name="LN2804"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>depTup</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2798"><span class='Ref_to_Parameter'>lockmode</span></a> <span class='Operator'>!= </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We scan pg_depend to find those things that depend on the domain. (We 
     * assume we can ignore refobjsubid for a domain.) 
     */ 
</span>    <a href="typecmds.c.html#LN2801"><span class='Ref_To_Local'>depRel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_depend.h.html#LN28"><span class='Ref_to_Const'>DependRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="typecmds.c.html#LN2802"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN70"><span class='Ref_to_Const'>Anum_pg_depend_refclassid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="typecmds.c.html#LN2802"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN71"><span class='Ref_to_Const'>Anum_pg_depend_refobjid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2798"><span class='Ref_to_Parameter'>domainOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN2803"><span class='Ref_To_Local'>depScan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2801"><span class='Ref_To_Local'>depRel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN146"><span class='Ref_to_Const'>DependReferenceIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                 <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2802"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2804"><span class='Ref_To_Local'>depTup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2803"><span class='Ref_To_Local'>depScan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2828"></a>        <a href="../../include/catalog/pg_depend.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_depend</span></a> <span class='Declare_Local'>pg_depend</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_depend.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_depend</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2804"><span class='Ref_To_Local'>depTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2829"></a>        <a href="typecmds.c.html#LN76"><span class='Ref_to_Typedef'>RelToCheck</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rtc</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN2830"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>rellist</span><span class='Delimiter'>; 
</span><a name="LN2831"></a>        <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>pg_att</span><span class='Delimiter'>; 
</span><a name="LN2832"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>ptr</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Check for directly dependent types --- must be domains */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN2828"><span class='Ref_To_Local'>pg_depend</span></a><span class='Operator'>-&GT;</span>classid <span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/utils/lsyscache.h.html#LN149"><span class='Ref_to_Proto'>get_typtype</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2828"><span class='Ref_To_Local'>pg_depend</span></a><span class='Operator'>-&GT;</span>objid<span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN721"><span class='Ref_to_Const'>TYPTYPE_DOMAIN</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Recursively add dependent columns to the output list.  This is 
             * a bit inefficient since we may fail to combine RelToCheck 
             * entries when attributes of the same rel have different derived 
             * domain types, but it's probably not worth improving. 
             */ 
</span>            <a href="typecmds.c.html#LN2800"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2800"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                                 <a href="typecmds.c.html#LN100"><span class='Ref_to_Proto'>get_rels_with_domain</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2828"><span class='Ref_To_Local'>pg_depend</span></a><span class='Operator'>-&GT;</span>objid<span class='Delimiter'>, 
</span>                                                      <a href="typecmds.c.html#LN2798"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Else, ignore dependees that aren't user columns of relations */ 
</span>        <span class='Comment_Multi_Line'>/* (we assume system columns are never of domain types) */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN2828"><span class='Ref_To_Local'>pg_depend</span></a><span class='Operator'>-&GT;</span>classid <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a> <span class='Operator'>|| 
</span>            <a href="typecmds.c.html#LN2828"><span class='Ref_To_Local'>pg_depend</span></a><span class='Operator'>-&GT;</span>objsubid <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* See if we already have an entry for this relation */ 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2830"><span class='Ref_To_Local'>rellist</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2800"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2860"></a>            <a href="typecmds.c.html#LN76"><span class='Ref_to_Typedef'>RelToCheck</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rt</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="typecmds.c.html#LN76"><span class='Ref_to_Typedef'>RelToCheck</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2830"><span class='Ref_To_Local'>rellist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2860"><span class='Ref_To_Local'>rt</span></a><span class='Operator'>-&GT;</span><a href="typecmds.c.html#LN78"><span class='Ref_to_Member'>rel</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="typecmds.c.html#LN2828"><span class='Ref_To_Local'>pg_depend</span></a><span class='Operator'>-&GT;</span>objid<span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="typecmds.c.html#LN2829"><span class='Ref_To_Local'>rtc</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN2860"><span class='Ref_To_Local'>rt</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN2829"><span class='Ref_To_Local'>rtc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* First attribute found for this relation */ 
</span><a name="LN2872"></a>            <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Acquire requested lock on relation */ 
</span>            <a href="typecmds.c.html#LN2872"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN84"><span class='Ref_to_Proto'>relation_open</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2828"><span class='Ref_To_Local'>pg_depend</span></a><span class='Operator'>-&GT;</span>objid<span class='Delimiter'>, </span><a href="typecmds.c.html#LN2798"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Check to see if rowtype is stored anyplace as a composite-type 
             * column; if so we have to fail, for now anyway. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2872"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltype<span class='Parentheses'>))</span> 
                <a href="../../include/commands/tablecmds.h.html#LN69"><span class='Ref_to_Proto'>find_composite_type_dependencies</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2872"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltype<span class='Delimiter'>, 
</span>                                                 <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                                 <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2798"><span class='Ref_to_Parameter'>domainOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Otherwise, we can ignore relations except those with both 
             * storage and user-chosen column types. 
             * 
             * XXX If an index-only scan could satisfy "col::some_domain" from 
             * a suitable expression index, this should also check expression 
             * index columns. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN2872"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a> <span class='Operator'>&& 
</span>                <a href="typecmds.c.html#LN2872"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2872"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2798"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* Build the RelToCheck entry with enough space for all atts */ 
</span>            <a href="typecmds.c.html#LN2829"><span class='Ref_To_Local'>rtc</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="typecmds.c.html#LN76"><span class='Ref_to_Typedef'>RelToCheck</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="typecmds.c.html#LN76"><span class='Ref_to_Typedef'>RelToCheck</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="typecmds.c.html#LN2829"><span class='Ref_To_Local'>rtc</span></a><span class='Operator'>-&GT;</span><a href="typecmds.c.html#LN78"><span class='Ref_to_Member'>rel</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN2872"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>; 
</span>            <a href="typecmds.c.html#LN2829"><span class='Ref_To_Local'>rtc</span></a><span class='Operator'>-&GT;</span><a href="typecmds.c.html#LN79"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="typecmds.c.html#LN2829"><span class='Ref_To_Local'>rtc</span></a><span class='Operator'>-&GT;</span><a href="typecmds.c.html#LN80"><span class='Ref_to_Member'>atts</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="../../include/utils/rel.h.html#LN422"><span class='Ref_to_Macro'>RelationGetNumberOfAttributes</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2872"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="typecmds.c.html#LN2800"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN215"><span class='Ref_to_Proto'>lcons</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2829"><span class='Ref_To_Local'>rtc</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2800"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if rtc==NULL &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * Confirm column has not been dropped, and is of the expected type. 
         * This defends against an ALTER DROP COLUMN occurring just before we 
         * acquired lock ... but if the whole table were dropped, we'd still 
         * have a problem. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN2828"><span class='Ref_To_Local'>pg_depend</span></a><span class='Operator'>-&GT;</span>objsubid <span class='Operator'>&GT; </span><a href="../../include/utils/rel.h.html#LN422"><span class='Ref_to_Macro'>RelationGetNumberOfAttributes</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2829"><span class='Ref_To_Local'>rtc</span></a><span class='Operator'>-&GT;</span><a href="typecmds.c.html#LN78"><span class='Ref_to_Member'>rel</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <a href="typecmds.c.html#LN2831"><span class='Ref_To_Local'>pg_att</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN2829"><span class='Ref_To_Local'>rtc</span></a><span class='Operator'>-&GT;</span><a href="typecmds.c.html#LN78"><span class='Ref_to_Member'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="typecmds.c.html#LN2828"><span class='Ref_To_Local'>pg_depend</span></a><span class='Operator'>-&GT;</span>objsubid <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN2831"><span class='Ref_To_Local'>pg_att</span></a><span class='Operator'>-&GT;</span>attisdropped <span class='Operator'>|| </span><a href="typecmds.c.html#LN2831"><span class='Ref_To_Local'>pg_att</span></a><span class='Operator'>-&GT;</span>atttypid <span class='Operator'>!= </span><a href="typecmds.c.html#LN2798"><span class='Ref_to_Parameter'>domainOid</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Okay, add column to result.  We store the columns in column-number 
         * order; this is just a hack to improve predictability of regression 
         * test output ... 
         */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2829"><span class='Ref_To_Local'>rtc</span></a><span class='Operator'>-&GT;</span><a href="typecmds.c.html#LN79"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>&LT; </span><a href="../../include/utils/rel.h.html#LN422"><span class='Ref_to_Macro'>RelationGetNumberOfAttributes</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2829"><span class='Ref_To_Local'>rtc</span></a><span class='Operator'>-&GT;</span><a href="typecmds.c.html#LN78"><span class='Ref_to_Member'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="typecmds.c.html#LN2832"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN2829"><span class='Ref_To_Local'>rtc</span></a><span class='Operator'>-&GT;</span><a href="typecmds.c.html#LN79"><span class='Ref_to_Member'>natts</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN2832"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="typecmds.c.html#LN2829"><span class='Ref_To_Local'>rtc</span></a><span class='Operator'>-&GT;</span><a href="typecmds.c.html#LN80"><span class='Ref_to_Member'>atts</span></a><span class='Delimiter'>[</span><a href="typecmds.c.html#LN2832"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>&GT; </span><a href="typecmds.c.html#LN2828"><span class='Ref_To_Local'>pg_depend</span></a><span class='Operator'>-&GT;</span>objsubid<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="typecmds.c.html#LN2829"><span class='Ref_To_Local'>rtc</span></a><span class='Operator'>-&GT;</span><a href="typecmds.c.html#LN80"><span class='Ref_to_Member'>atts</span></a><span class='Delimiter'>[</span><a href="typecmds.c.html#LN2832"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="typecmds.c.html#LN2829"><span class='Ref_To_Local'>rtc</span></a><span class='Operator'>-&GT;</span><a href="typecmds.c.html#LN80"><span class='Ref_to_Member'>atts</span></a><span class='Delimiter'>[</span><a href="typecmds.c.html#LN2832"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>            <a href="typecmds.c.html#LN2832"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="typecmds.c.html#LN2829"><span class='Ref_To_Local'>rtc</span></a><span class='Operator'>-&GT;</span><a href="typecmds.c.html#LN80"><span class='Ref_to_Member'>atts</span></a><span class='Delimiter'>[</span><a href="typecmds.c.html#LN2832"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="typecmds.c.html#LN2828"><span class='Ref_To_Local'>pg_depend</span></a><span class='Operator'>-&GT;</span>objsubid<span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while HeapTupleIsValid(depT... &raquo; </span> 
 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2803"><span class='Ref_To_Local'>depScan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2801"><span class='Ref_To_Local'>depRel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="typecmds.c.html#LN2800"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_rels_with_domain &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * checkDomainOwner 
 * 
 * Check that the type is actually a domain and that the current user 
 * has permission to do ALTER DOMAIN on it.  Throw an error if not. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2951"></a><span class='Declare_Function'>checkDomainOwner</span><span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tup</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2953"></a>    <a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a> <span class='Declare_Local'>typTup</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2951"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check that this is actually a domain */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN2953"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typtype <span class='Operator'>!= </span><a href="../../include/catalog/pg_type.h.html#LN721"><span class='Ref_to_Const'>TYPTYPE_DOMAIN</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"%s is not a domain"</span><span class='Delimiter'>, 
</span>                        <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2951"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>)))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Permission check: must own type */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN309"><span class='Ref_to_Proto'>pg_type_ownercheck</span></a><span class='Parentheses'>(</span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2951"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
        <a href="../../include/utils/acl.h.html#LN301"><span class='Ref_to_Proto'>aclcheck_error_type</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2951"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * domainAddConstraint - code shared between CREATE and ALTER DOMAIN 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN2971"></a><span class='Declare_Function'>domainAddConstraint</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>domainOid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>domainNamespace</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>baseTypeOid</span><span class='Delimiter'>, 
</span><a name="LN2972"></a>                    <span class='Keyword'>int </span><span class='Declare_Parameter'>typMod</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2050"><span class='Ref_to_Struct'>Constraint</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>constr</span><span class='Delimiter'>, 
</span><a name="LN2973"></a>                    <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>domainName</span><span class='Delimiter'>, </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>constrAddr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2975"></a>    <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>expr</span><span class='Delimiter'>; 
</span><a name="LN2976"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ccsrc</span><span class='Delimiter'>; 
</span><a name="LN2977"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ccbin</span><span class='Delimiter'>; 
</span><a name="LN2978"></a>    <a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pstate</span><span class='Delimiter'>; 
</span><a name="LN2979"></a>    <a href="../../include/nodes/primnodes.h.html#LN1235"><span class='Ref_to_Struct'>CoerceToDomainValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>domVal</span><span class='Delimiter'>; 
</span><a name="LN2980"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ccoid</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Assign or validate constraint name 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN2972"><span class='Ref_to_Parameter'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2056"><span class='Ref_to_Member'>conname</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint_fn.h.html#LN62"><span class='Ref_to_Proto'>ConstraintNameIsUsed</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint_fn.h.html#LN25"><span class='Ref_to_EnumConst'>CONSTRAINT_DOMAIN</span></a><span class='Delimiter'>, 
</span>                                 <a href="typecmds.c.html#LN2971"><span class='Ref_to_Parameter'>domainOid</span></a><span class='Delimiter'>, 
</span>                                 <a href="typecmds.c.html#LN2971"><span class='Ref_to_Parameter'>domainNamespace</span></a><span class='Delimiter'>, 
</span>                                 <a href="typecmds.c.html#LN2972"><span class='Ref_to_Parameter'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2056"><span class='Ref_to_Member'>conname</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/pg_basebackup/streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"constraint \"%s\" for domain \"%s\" already exists"</span><span class='Delimiter'>, 
</span>                        <a href="typecmds.c.html#LN2972"><span class='Ref_to_Parameter'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2056"><span class='Ref_to_Member'>conname</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2973"><span class='Ref_to_Parameter'>domainName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="typecmds.c.html#LN2972"><span class='Ref_to_Parameter'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2056"><span class='Ref_to_Member'>conname</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_constraint_fn.h.html#LN64"><span class='Ref_to_Proto'>ChooseConstraintName</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2973"><span class='Ref_to_Parameter'>domainName</span></a><span class='Delimiter'>, 
</span>                                               <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                               <span class='String'>"check"</span><span class='Delimiter'>, 
</span>                                               <a href="typecmds.c.html#LN2971"><span class='Ref_to_Parameter'>domainNamespace</span></a><span class='Delimiter'>, 
</span>                                               <a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Convert the A_EXPR in raw_expr into an EXPR 
     */ 
</span>    <a href="typecmds.c.html#LN2978"><span class='Ref_To_Local'>pstate</span></a> <span class='Operator'>= </span><a href="../parser/parse_node.c.html#LN42"><span class='Ref_to_Func'>make_parsestate</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set up a CoerceToDomainValue to represent the occurrence of VALUE in 
     * the expression.  Note that it will appear to have the type of the base 
     * type, not the domain.  This seems correct since within the check 
     * expression, we should not assume the input value can be considered a 
     * member of the domain. 
     */ 
</span>    <a href="typecmds.c.html#LN2979"><span class='Ref_To_Local'>domVal</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN1235"><span class='Ref_to_Struct'>CoerceToDomainValue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN2979"><span class='Ref_To_Local'>domVal</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1238"><span class='Ref_to_Member'>typeId</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN2971"><span class='Ref_to_Parameter'>baseTypeOid</span></a><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN2979"><span class='Ref_To_Local'>domVal</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1239"><span class='Ref_to_Member'>typeMod</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN2972"><span class='Ref_to_Parameter'>typMod</span></a><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN2979"><span class='Ref_To_Local'>domVal</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1240"><span class='Ref_to_Member'>collation</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN166"><span class='Ref_to_Proto'>get_typcollation</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2971"><span class='Ref_to_Parameter'>baseTypeOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN2979"><span class='Ref_To_Local'>domVal</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1241"><span class='Ref_to_Member'>location</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* will be set when/if used */ 
</span> 
    <a href="typecmds.c.html#LN2978"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/parser/parse_node.h.html#LN205"><span class='Ref_to_Member'>p_pre_columnref_hook</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN106"><span class='Ref_to_Proto'>replace_domain_constraint_value</span></a><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN2978"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/parser/parse_node.h.html#LN209"><span class='Ref_to_Member'>p_ref_hook_state</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="typecmds.c.html#LN2979"><span class='Ref_To_Local'>domVal</span></a><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN2975"><span class='Ref_To_Local'>expr</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_expr.h.html#LN21"><span class='Ref_to_Proto'>transformExpr</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2978"><span class='Ref_To_Local'>pstate</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2972"><span class='Ref_to_Parameter'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2063"><span class='Ref_to_Member'>raw_expr</span></a><span class='Delimiter'>, </span><a href="../../include/parser/parse_node.h.html#LN60"><span class='Ref_to_EnumConst'>EXPR_KIND_DOMAIN_CHECK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make sure it yields a boolean result. 
     */ 
</span>    <a href="typecmds.c.html#LN2975"><span class='Ref_To_Local'>expr</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_coerce.h.html#LN54"><span class='Ref_to_Proto'>coerce_to_boolean</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2978"><span class='Ref_To_Local'>pstate</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2975"><span class='Ref_To_Local'>expr</span></a><span class='Delimiter'>, </span><span class='String'>"CHECK"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Fix up collation information. 
     */ 
</span>    <a href="../../include/parser/parse_collate.h.html#LN22"><span class='Ref_to_Proto'>assign_expr_collations</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2978"><span class='Ref_To_Local'>pstate</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2975"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Domains don't allow variables (this is probably dead code now that 
     * add_missing_from is history, but let's be sure). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2978"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/parser/parse_node.h.html#LN168"><span class='Ref_to_Member'>p_rtable</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        <a href="../../include/optimizer/var.h.html#LN33"><span class='Ref_to_Proto'>contain_var_clause</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2975"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_COLUMN_REFERENCE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>          <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot use table references in domain check constraint"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Convert to string form for storage. 
     */ 
</span>    <a href="typecmds.c.html#LN2977"><span class='Ref_To_Local'>ccbin</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN598"><span class='Ref_to_Proto'>nodeToString</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2975"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Deparse it to produce text for consrc. 
     */ 
</span>    <a href="typecmds.c.html#LN2976"><span class='Ref_To_Local'>ccsrc</span></a> <span class='Operator'>= </span><a href="../../include/utils/ruleutils.h.html#LN26"><span class='Ref_to_Proto'>deparse_expression</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2975"><span class='Ref_To_Local'>expr</span></a><span class='Delimiter'>, 
</span>                               <a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Store the constraint in pg_constraint 
     */ 
</span>    <a href="typecmds.c.html#LN2980"><span class='Ref_To_Local'>ccoid</span></a> <span class='Operator'>= 
</span>        <a href="../../include/catalog/pg_constraint_fn.h.html#LN29"><span class='Ref_to_Proto'>CreateConstraintEntry</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN2972"><span class='Ref_to_Parameter'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2056"><span class='Ref_to_Member'>conname</span></a><span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* Constraint Name */ 
</span>                              <a href="typecmds.c.html#LN2971"><span class='Ref_to_Parameter'>domainNamespace</span></a><span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* namespace */ 
</span>                              <a href="../../include/catalog/pg_constraint.h.html#LN187"><span class='Ref_to_Const'>CONSTRAINT_CHECK</span></a><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* Constraint Type */ 
</span>                              <span class='Boolean'>false</span><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* Is Deferrable */ 
</span>                              <span class='Boolean'>false</span><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* Is Deferred */ 
</span>                              <span class='Operator'>!</span><a href="typecmds.c.html#LN2972"><span class='Ref_to_Parameter'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2092"><span class='Ref_to_Member'>skip_validation</span></a><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* Is Validated */ 
</span>                              <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* not a relation constraint */ 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                              <span class='Number'>0</span><span class='Delimiter'>, 
</span>                              <a href="typecmds.c.html#LN2971"><span class='Ref_to_Parameter'>domainOid</span></a><span class='Delimiter'>,</span>        <span class='Comment_Single_Line'>/* domain constraint */ 
</span>                              <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* no associated index */ 
</span>                              <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* Foreign key fields */ 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                              <span class='Number'>0</span><span class='Delimiter'>, 
</span>                              <span class='String'>' '</span><span class='Delimiter'>, 
</span>                              <span class='String'>' '</span><span class='Delimiter'>, 
</span>                              <span class='String'>' '</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* not an exclusion constraint */ 
</span>                              <a href="typecmds.c.html#LN2975"><span class='Ref_To_Local'>expr</span></a><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* Tree form of check constraint */ 
</span>                              <a href="typecmds.c.html#LN2977"><span class='Ref_To_Local'>ccbin</span></a><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* Binary form of check constraint */ 
</span>                              <a href="typecmds.c.html#LN2976"><span class='Ref_To_Local'>ccsrc</span></a><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* Source form of check constraint */ 
</span>                              <span class='Boolean'>true</span><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* is local */ 
</span>                              <span class='Number'>0</span><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* inhcount */ 
</span>                              <span class='Boolean'>false</span><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* connoinherit */ 
</span>                              <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* is_internal */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN2973"><span class='Ref_to_Parameter'>constrAddr</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="typecmds.c.html#LN2973"><span class='Ref_to_Parameter'>constrAddr</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_constraint.h.html#LN28"><span class='Ref_to_Const'>ConstraintRelationId</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN2980"><span class='Ref_To_Local'>ccoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Return the compiled constraint expression so the calling routine can 
     * perform any additional required tests. 
     */ 
</span>    <span class='Control'>return</span> <a href="typecmds.c.html#LN2977"><span class='Ref_To_Local'>ccbin</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end domainAddConstraint &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* Parser pre_columnref_hook for domain CHECK constraint parsing */ 
</span><span class='Keyword'>static </span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN3101"></a><span class='Declare_Function'>replace_domain_constraint_value</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN231"><span class='Ref_to_Struct'>ColumnRef</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cref</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * Check for a reference to "value", and if that's what it is, replace 
     * with a CoerceToDomainValue as prepared for us by domainAddConstraint. 
     * (We handle VALUE as a name, not a keyword, to avoid breaking a lot of 
     * applications that have used VALUE as a column name in the past.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3101"><span class='Ref_to_Parameter'>cref</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN234"><span class='Ref_to_Member'>fields</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN3111"></a>        <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>field1</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3101"><span class='Ref_to_Parameter'>cref</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN234"><span class='Ref_to_Member'>fields</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3112"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>colname</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3111"><span class='Ref_To_Local'>field1</span></a><span class='Delimiter'>, </span>String<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="typecmds.c.html#LN3112"><span class='Ref_To_Local'>colname</span></a> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3111"><span class='Ref_To_Local'>field1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="typecmds.c.html#LN3112"><span class='Ref_To_Local'>colname</span></a><span class='Delimiter'>, </span><span class='String'>"value"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN3118"></a>            <a href="../../include/nodes/primnodes.h.html#LN1235"><span class='Ref_to_Struct'>CoerceToDomainValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>domVal</span> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3101"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/parser/parse_node.h.html#LN209"><span class='Ref_to_Member'>p_ref_hook_state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Propagate location knowledge, if any */ 
</span>            <a href="typecmds.c.html#LN3118"><span class='Ref_To_Local'>domVal</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1241"><span class='Ref_to_Member'>location</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN3101"><span class='Ref_to_Parameter'>cref</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN235"><span class='Ref_to_Member'>location</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="typecmds.c.html#LN3118"><span class='Ref_To_Local'>domVal</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end replace_domain_constraint_value &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Execute ALTER TYPE RENAME 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN3133"></a><span class='Declare_Function'>RenameType</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2770"><span class='Ref_to_Struct'>RenameStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3135"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>names</span> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3133"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2776"><span class='Ref_to_Member'>object</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3136"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>newTypeName</span> <span class='Operator'>= </span><a href="typecmds.c.html#LN3133"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2779"><span class='Ref_to_Member'>newname</span></a><span class='Delimiter'>; 
</span><a name="LN3137"></a>    <a href="../../include/nodes/parsenodes.h.html#LN205"><span class='Ref_to_Struct'>TypeName</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>typename</span><span class='Delimiter'>; 
</span><a name="LN3138"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typeOid</span><span class='Delimiter'>; 
</span><a name="LN3139"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN3140"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN3141"></a>    <a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a> <span class='Declare_Local'>typTup</span><span class='Delimiter'>; 
</span><a name="LN3142"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make a TypeName so we can use standard type lookup machinery */ 
</span>    <span class='Keyword'>typename </span><span class='Operator'>= </span><a href="../../include/nodes/makefuncs.h.html#LN71"><span class='Ref_to_Proto'>makeTypeNameFromNameList</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3135"><span class='Ref_To_Local'>names</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN3138"><span class='Ref_To_Local'>typeOid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN27"><span class='Ref_to_Proto'>typenameTypeId</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Keyword'>typename</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Look up the type in the type table */ 
</span>    <a href="typecmds.c.html#LN3139"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN3140"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3138"><span class='Ref_To_Local'>typeOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3140"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for type %u"</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3138"><span class='Ref_To_Local'>typeOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN3141"><span class='Ref_To_Local'>typTup</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3140"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* check permissions on type */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN309"><span class='Ref_to_Proto'>pg_type_ownercheck</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3138"><span class='Ref_To_Local'>typeOid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
        <a href="../../include/utils/acl.h.html#LN301"><span class='Ref_to_Proto'>aclcheck_error_type</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3138"><span class='Ref_To_Local'>typeOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* ALTER DOMAIN used on a non-domain? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN3133"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2773"><span class='Ref_to_Member'>renameType</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN1597"><span class='Ref_to_EnumConst'>OBJECT_DOMAIN</span></a> <span class='Operator'>&& </span><a href="typecmds.c.html#LN3141"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typtype <span class='Operator'>!= </span><a href="../../include/catalog/pg_type.h.html#LN721"><span class='Ref_to_Const'>TYPTYPE_DOMAIN</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"%s is not a domain"</span><span class='Delimiter'>, 
</span>                        <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3138"><span class='Ref_To_Local'>typeOid</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If it's a composite type, we need to check that it really is a 
     * free-standing composite type, and not a table's rowtype. We want people 
     * to use ALTER TABLE not ALTER TYPE for that case. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN3141"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typtype <span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN720"><span class='Ref_to_Const'>TYPTYPE_COMPOSITE</span></a> <span class='Operator'>&& 
</span>        <a href="../../include/utils/lsyscache.h.html#LN127"><span class='Ref_to_Proto'>get_rel_relkind</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3141"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typrelid<span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN165"><span class='Ref_to_Const'>RELKIND_COMPOSITE_TYPE</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"%s is a table's row type"</span><span class='Delimiter'>, 
</span>                        <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3138"><span class='Ref_To_Local'>typeOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Use ALTER TABLE instead."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* don't allow direct alteration of array types, either */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3141"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typelem<span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <a href="../../include/utils/lsyscache.h.html#LN158"><span class='Ref_to_Proto'>get_array_type</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3141"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typelem<span class='Parentheses'>) </span><span class='Operator'>== </span><a href="typecmds.c.html#LN3138"><span class='Ref_To_Local'>typeOid</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot alter array type %s"</span><span class='Delimiter'>, 
</span>                        <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3138"><span class='Ref_To_Local'>typeOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"You can alter type %s, which will alter the array type as well."</span><span class='Delimiter'>, 
</span>                         <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3141"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typelem<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If type is composite we need to rename associated pg_class entry too. 
     * RenameRelationInternal will call RenameTypeInternal automatically. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN3141"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typtype <span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN720"><span class='Ref_to_Const'>TYPTYPE_COMPOSITE</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/commands/tablecmds.h.html#LN66"><span class='Ref_to_Proto'>RenameRelationInternal</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3141"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typrelid<span class='Delimiter'>, </span><a href="typecmds.c.html#LN3136"><span class='Ref_To_Local'>newTypeName</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../include/catalog/pg_type_fn.h.html#LN75"><span class='Ref_to_Proto'>RenameTypeInternal</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3138"><span class='Ref_To_Local'>typeOid</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3136"><span class='Ref_To_Local'>newTypeName</span></a><span class='Delimiter'>, 
</span>                           <a href="typecmds.c.html#LN3141"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typnamespace<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3142"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3138"><span class='Ref_To_Local'>typeOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Clean up */ 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3139"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="typecmds.c.html#LN3142"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RenameType &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Change the owner of a type. 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN3211"></a><span class='Declare_Function'>AlterTypeOwner</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>names</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>newOwnerId</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1583"><span class='Ref_to_Enum'>ObjectType</span></a> <span class='Declare_Parameter'>objecttype</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3213"></a>    <a href="../../include/nodes/parsenodes.h.html#LN205"><span class='Ref_to_Struct'>TypeName</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>typename</span><span class='Delimiter'>; 
</span><a name="LN3214"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typeOid</span><span class='Delimiter'>; 
</span><a name="LN3215"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN3216"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN3217"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newtup</span><span class='Delimiter'>; 
</span><a name="LN3218"></a>    <a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a> <span class='Declare_Local'>typTup</span><span class='Delimiter'>; 
</span><a name="LN3219"></a>    <a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span><a name="LN3220"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN3215"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make a TypeName so we can use standard type lookup machinery */ 
</span>    <span class='Keyword'>typename </span><span class='Operator'>= </span><a href="../../include/nodes/makefuncs.h.html#LN71"><span class='Ref_to_Proto'>makeTypeNameFromNameList</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3211"><span class='Ref_to_Parameter'>names</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Use LookupTypeName here so that shell types can be processed */ 
</span>    <a href="typecmds.c.html#LN3216"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN21"><span class='Ref_to_Proto'>LookupTypeName</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Keyword'>typename</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN3216"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"type \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/parser/parse_type.h.html#LN31"><span class='Ref_to_Proto'>TypeNameToString</span></a><span class='Parentheses'>(</span><span class='Keyword'>typename</span><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN3214"><span class='Ref_To_Local'>typeOid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN39"><span class='Ref_to_Proto'>typeTypeId</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3216"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Copy the syscache entry so we can scribble on it below */ 
</span>    <a href="typecmds.c.html#LN3217"><span class='Ref_To_Local'>newtup</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN606"><span class='Ref_to_Func'>heap_copytuple</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3216"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3216"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN3216"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN3217"><span class='Ref_To_Local'>newtup</span></a><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN3218"><span class='Ref_To_Local'>typTup</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3216"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Don't allow ALTER DOMAIN on a type */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN3211"><span class='Ref_to_Parameter'>objecttype</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN1597"><span class='Ref_to_EnumConst'>OBJECT_DOMAIN</span></a> <span class='Operator'>&& </span><a href="typecmds.c.html#LN3218"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typtype <span class='Operator'>!= </span><a href="../../include/catalog/pg_type.h.html#LN721"><span class='Ref_to_Const'>TYPTYPE_DOMAIN</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"%s is not a domain"</span><span class='Delimiter'>, 
</span>                        <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3214"><span class='Ref_To_Local'>typeOid</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If it's a composite type, we need to check that it really is a 
     * free-standing composite type, and not a table's rowtype. We want people 
     * to use ALTER TABLE not ALTER TYPE for that case. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN3218"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typtype <span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN720"><span class='Ref_to_Const'>TYPTYPE_COMPOSITE</span></a> <span class='Operator'>&& 
</span>        <a href="../../include/utils/lsyscache.h.html#LN127"><span class='Ref_to_Proto'>get_rel_relkind</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3218"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typrelid<span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN165"><span class='Ref_to_Const'>RELKIND_COMPOSITE_TYPE</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"%s is a table's row type"</span><span class='Delimiter'>, 
</span>                        <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3214"><span class='Ref_To_Local'>typeOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Use ALTER TABLE instead."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* don't allow direct alteration of array types, either */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3218"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typelem<span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <a href="../../include/utils/lsyscache.h.html#LN158"><span class='Ref_to_Proto'>get_array_type</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3218"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typelem<span class='Parentheses'>) </span><span class='Operator'>== </span><a href="typecmds.c.html#LN3214"><span class='Ref_To_Local'>typeOid</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot alter array type %s"</span><span class='Delimiter'>, 
</span>                        <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3214"><span class='Ref_To_Local'>typeOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"You can alter type %s, which will alter the array type as well."</span><span class='Delimiter'>, 
</span>                         <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3218"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typelem<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the new owner is the same as the existing owner, consider the 
     * command to have succeeded.  This is for dump restoration purposes. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN3218"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typowner <span class='Operator'>!= </span><a href="typecmds.c.html#LN3211"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Superusers can always do it */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>())</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Otherwise, must be owner of the existing object */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN309"><span class='Ref_to_Proto'>pg_type_ownercheck</span></a><span class='Parentheses'>(</span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3216"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
                <a href="../../include/utils/acl.h.html#LN301"><span class='Ref_to_Proto'>aclcheck_error_type</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3216"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Must be able to become new owner */ 
</span>            <a href="../../include/utils/acl.h.html#LN233"><span class='Ref_to_Proto'>check_is_member_of_role</span></a><span class='Parentheses'>(</span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3211"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* New owner must have CREATE privilege on namespace */ 
</span>            <a href="typecmds.c.html#LN3219"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN289"><span class='Ref_to_Proto'>pg_namespace_aclcheck</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3218"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typnamespace<span class='Delimiter'>, 
</span>                                              <a href="typecmds.c.html#LN3211"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Delimiter'>, 
</span>                                              <a href="../../include/nodes/parsenodes.h.html#LN81"><span class='Ref_to_Const'>ACL_CREATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN3219"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3219"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN189"><span class='Ref_to_EnumConst'>ACL_KIND_NAMESPACE</span></a><span class='Delimiter'>, 
</span>                               <a href="../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3218"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typnamespace<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../include/commands/typecmds.h.html#LN45"><span class='Ref_to_Proto'>AlterTypeOwner_oid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3214"><span class='Ref_To_Local'>typeOid</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3211"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if typTup-&GT;typowner!=new... &raquo; </span> 
 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3220"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3214"><span class='Ref_To_Local'>typeOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Clean up */ 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3215"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="typecmds.c.html#LN3220"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterTypeOwner &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * AlterTypeOwner_oid - change type owner unconditionally 
 * 
 * This function recurses to handle a pg_class entry, if necessary.  It 
 * invokes any necessary access object hooks.  If hasDependEntry is TRUE, this 
 * function modifies the pg_shdepend entry appropriately (this should be 
 * passed as FALSE only for table rowtypes and array types). 
 * 
 * This is used by ALTER TABLE/TYPE OWNER commands, as well as by REASSIGN 
 * OWNED BY.  It assumes the caller has done all needed check. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN3320"></a><span class='Declare_Function'>AlterTypeOwner_oid</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeOid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>newOwnerId</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>hasDependEntry</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3322"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN3323"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN3324"></a>    <a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a> <span class='Declare_Local'>typTup</span><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN3322"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN3323"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3320"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3323"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for type %u"</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3320"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN3324"><span class='Ref_To_Local'>typTup</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3323"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If it's a composite type, invoke ATExecChangeOwner so that we fix up 
     * the pg_class entry properly.  That will call back to 
     * AlterTypeOwnerInternal to take care of the pg_type entry(s). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN3324"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typtype <span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN720"><span class='Ref_to_Const'>TYPTYPE_COMPOSITE</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/commands/tablecmds.h.html#LN35"><span class='Ref_to_Proto'>ATExecChangeOwner</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3324"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typrelid<span class='Delimiter'>, </span><a href="typecmds.c.html#LN3320"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../include/commands/typecmds.h.html#LN46"><span class='Ref_to_Proto'>AlterTypeOwnerInternal</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3320"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3320"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Update owner dependency reference */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN3320"><span class='Ref_to_Parameter'>hasDependEntry</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/catalog/dependency.h.html#LN259"><span class='Ref_to_Proto'>changeDependencyOnOwner</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3320"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3320"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3320"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3323"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3322"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterTypeOwner_oid &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * AlterTypeOwnerInternal - bare-bones type owner change. 
 * 
 * This routine simply modifies the owner of a pg_type entry, and recurses 
 * to handle a possible array type. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN3360"></a><span class='Declare_Function'>AlterTypeOwnerInternal</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeOid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>newOwnerId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3362"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN3363"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN3364"></a>    <a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a> <span class='Declare_Local'>typTup</span><span class='Delimiter'>; 
</span><a name="LN3365"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>repl_val</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN238"><span class='Ref_to_Const'>Natts_pg_type</span></a><span class='Delimiter'>]; 
</span><a name="LN3366"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>repl_null</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN238"><span class='Ref_to_Const'>Natts_pg_type</span></a><span class='Delimiter'>]; 
</span><a name="LN3367"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>repl_repl</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN238"><span class='Ref_to_Const'>Natts_pg_type</span></a><span class='Delimiter'>]; 
</span><a name="LN3368"></a>    <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>newAcl</span><span class='Delimiter'>; 
</span><a name="LN3369"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN3370"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN3362"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN3363"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3360"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3363"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for type %u"</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3360"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN3364"><span class='Ref_To_Local'>typTup</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3363"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    memset<span class='Parentheses'>(</span><a href="typecmds.c.html#LN3366"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3366"><span class='Ref_To_Local'>repl_null</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="typecmds.c.html#LN3367"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3367"><span class='Ref_To_Local'>repl_repl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN3367"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN241"><span class='Ref_to_Const'>Anum_pg_type_typowner</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN3365"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN241"><span class='Ref_to_Const'>Anum_pg_type_typowner</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3360"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN3369"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN768"><span class='Ref_to_Macro'>heap_getattr</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3363"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>, 
</span>                            <a href="../../include/catalog/pg_type.h.html#LN268"><span class='Ref_to_Const'>Anum_pg_type_typacl</span></a><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3362"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <span class='Operator'>&</span><a href="typecmds.c.html#LN3370"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Null ACLs do not require changes */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="typecmds.c.html#LN3370"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="typecmds.c.html#LN3368"><span class='Ref_To_Local'>newAcl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN217"><span class='Ref_to_Proto'>aclnewowner</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN112"><span class='Ref_to_Macro'>DatumGetAclP</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3369"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="typecmds.c.html#LN3364"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typowner<span class='Delimiter'>, </span><a href="typecmds.c.html#LN3360"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="typecmds.c.html#LN3367"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN268"><span class='Ref_to_Const'>Anum_pg_type_typacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="typecmds.c.html#LN3365"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN268"><span class='Ref_to_Const'>Anum_pg_type_typacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3368"><span class='Ref_To_Local'>newAcl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="typecmds.c.html#LN3363"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3363"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3362"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3365"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3366"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>, 
</span>                            <a href="typecmds.c.html#LN3367"><span class='Ref_To_Local'>repl_repl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3362"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="typecmds.c.html#LN3363"><span class='Ref_To_Local'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3363"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If it has an array type, update that too */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3364"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typarray<span class='Parentheses'>))</span> 
        <a href="../../include/commands/typecmds.h.html#LN46"><span class='Ref_to_Proto'>AlterTypeOwnerInternal</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3364"><span class='Ref_To_Local'>typTup</span></a><span class='Operator'>-&GT;</span>typarray<span class='Delimiter'>, </span><a href="typecmds.c.html#LN3360"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Clean up */ 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3362"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterTypeOwnerInternal &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Execute ALTER TYPE SET SCHEMA 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN3415"></a><span class='Declare_Function'>AlterTypeNamespace</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>names</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>newschema</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1583"><span class='Ref_to_Enum'>ObjectType</span></a> <span class='Declare_Parameter'>objecttype</span><span class='Delimiter'>, 
</span><a name="LN3416"></a>                   <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>oldschema</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3418"></a>    <a href="../../include/nodes/parsenodes.h.html#LN205"><span class='Ref_to_Struct'>TypeName</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>typename</span><span class='Delimiter'>; 
</span><a name="LN3419"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typeOid</span><span class='Delimiter'>; 
</span><a name="LN3420"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>nspOid</span><span class='Delimiter'>; 
</span><a name="LN3421"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>oldNspOid</span><span class='Delimiter'>; 
</span><a name="LN3422"></a>    <a href="../catalog/dependency.c.html#LN108"><span class='Ref_to_Struct'>ObjectAddresses</span></a> <span class='Operator'>*</span><span class='Declare_Local'>objsMoved</span><span class='Delimiter'>; 
</span><a name="LN3423"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>myself</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make a TypeName so we can use standard type lookup machinery */ 
</span>    <span class='Keyword'>typename </span><span class='Operator'>= </span><a href="../../include/nodes/makefuncs.h.html#LN71"><span class='Ref_to_Proto'>makeTypeNameFromNameList</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3415"><span class='Ref_to_Parameter'>names</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN3419"><span class='Ref_To_Local'>typeOid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN27"><span class='Ref_to_Proto'>typenameTypeId</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Keyword'>typename</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Don't allow ALTER DOMAIN on a type */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN3415"><span class='Ref_to_Parameter'>objecttype</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN1597"><span class='Ref_to_EnumConst'>OBJECT_DOMAIN</span></a> <span class='Operator'>&& </span><a href="../../include/utils/lsyscache.h.html#LN149"><span class='Ref_to_Proto'>get_typtype</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3419"><span class='Ref_To_Local'>typeOid</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../include/catalog/pg_type.h.html#LN721"><span class='Ref_to_Const'>TYPTYPE_DOMAIN</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"%s is not a domain"</span><span class='Delimiter'>, 
</span>                        <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3419"><span class='Ref_To_Local'>typeOid</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* get schema OID and check its permissions */ 
</span>    <a href="typecmds.c.html#LN3420"><span class='Ref_To_Local'>nspOid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN116"><span class='Ref_to_Proto'>LookupCreationNamespace</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3415"><span class='Ref_to_Parameter'>newschema</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN3422"><span class='Ref_To_Local'>objsMoved</span></a> <span class='Operator'>= </span><a href="../../include/catalog/dependency.h.html#LN200"><span class='Ref_to_Proto'>new_object_addresses</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN3421"><span class='Ref_To_Local'>oldNspOid</span></a> <span class='Operator'>= </span><a href="../../include/commands/typecmds.h.html#LN50"><span class='Ref_to_Proto'>AlterTypeNamespace_oid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3419"><span class='Ref_To_Local'>typeOid</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3420"><span class='Ref_To_Local'>nspOid</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3422"><span class='Ref_To_Local'>objsMoved</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/catalog/dependency.h.html#LN212"><span class='Ref_to_Proto'>free_object_addresses</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3422"><span class='Ref_To_Local'>objsMoved</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN3416"><span class='Ref_to_Parameter'>oldschema</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="typecmds.c.html#LN3416"><span class='Ref_to_Parameter'>oldschema</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN3421"><span class='Ref_To_Local'>oldNspOid</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3423"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3419"><span class='Ref_To_Local'>typeOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="typecmds.c.html#LN3423"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterTypeNamespace &raquo; </span> 
 
<a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN3452"></a><span class='Declare_Function'>AlterTypeNamespace_oid</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeOid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>nspOid</span><span class='Delimiter'>, </span><a href="../catalog/dependency.c.html#LN108"><span class='Ref_to_Struct'>ObjectAddresses</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>objsMoved</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3454"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>elemOid</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* check permissions on type */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN309"><span class='Ref_to_Proto'>pg_type_ownercheck</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3452"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
        <a href="../../include/utils/acl.h.html#LN301"><span class='Ref_to_Proto'>aclcheck_error_type</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3452"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* don't allow direct alteration of array types */ 
</span>    <a href="typecmds.c.html#LN3454"><span class='Ref_To_Local'>elemOid</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN157"><span class='Ref_to_Proto'>get_element_type</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3452"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3454"><span class='Ref_To_Local'>elemOid</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="../../include/utils/lsyscache.h.html#LN158"><span class='Ref_to_Proto'>get_array_type</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3454"><span class='Ref_To_Local'>elemOid</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="typecmds.c.html#LN3452"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot alter array type %s"</span><span class='Delimiter'>, 
</span>                        <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3452"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"You can alter type %s, which will alter the array type as well."</span><span class='Delimiter'>, 
</span>                         <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3454"><span class='Ref_To_Local'>elemOid</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* and do the work */ 
</span>    <span class='Control'>return</span> <a href="../../include/commands/typecmds.h.html#LN51"><span class='Ref_to_Proto'>AlterTypeNamespaceInternal</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3452"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3452"><span class='Ref_to_Parameter'>nspOid</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3452"><span class='Ref_to_Parameter'>objsMoved</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterTypeNamespace_oid &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Move specified type to new namespace. 
 * 
 * Caller must have already checked privileges. 
 * 
 * The function automatically recurses to process the type's array type, 
 * if any.  isImplicitArray should be TRUE only when doing this internal 
 * recursion (outside callers must never try to move an array type directly). 
 * 
 * If errorOnTableType is TRUE, the function errors out if the type is 
 * a table type.  ALTER TABLE has to be used to move a table to a new 
 * namespace. 
 * 
 * Returns the type's old namespace OID. 
 */ 
</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN3490"></a><span class='Declare_Function'>AlterTypeNamespaceInternal</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeOid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>nspOid</span><span class='Delimiter'>, 
</span><a name="LN3491"></a>                           <span class='Keyword'>bool </span><span class='Declare_Parameter'>isImplicitArray</span><span class='Delimiter'>, 
</span><a name="LN3492"></a>                           <span class='Keyword'>bool </span><span class='Declare_Parameter'>errorOnTableType</span><span class='Delimiter'>, 
</span><a name="LN3493"></a>                           <a href="../catalog/dependency.c.html#LN108"><span class='Ref_to_Struct'>ObjectAddresses</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>objsMoved</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3495"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN3496"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN3497"></a>    <a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a> <span class='Declare_Local'>typform</span><span class='Delimiter'>; 
</span><a name="LN3498"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>oldNspOid</span><span class='Delimiter'>; 
</span><a name="LN3499"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>arrayOid</span><span class='Delimiter'>; 
</span><a name="LN3500"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isCompositeType</span><span class='Delimiter'>; 
</span><a name="LN3501"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>thisobj</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make sure we haven't moved this object previously. 
     */ 
</span>    <a href="typecmds.c.html#LN3501"><span class='Ref_To_Local'>thisobj</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN3501"><span class='Ref_To_Local'>thisobj</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN3490"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN3501"><span class='Ref_To_Local'>thisobj</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/dependency.h.html#LN205"><span class='Ref_to_Proto'>object_address_present</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="typecmds.c.html#LN3501"><span class='Ref_To_Local'>thisobj</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3493"><span class='Ref_to_Parameter'>objsMoved</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN3495"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN3496"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3490"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3496"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for type %u"</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3490"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN3497"><span class='Ref_To_Local'>typform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3496"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="typecmds.c.html#LN3498"><span class='Ref_To_Local'>oldNspOid</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN3497"><span class='Ref_To_Local'>typform</span></a><span class='Operator'>-&GT;</span>typnamespace<span class='Delimiter'>; 
</span>    <a href="typecmds.c.html#LN3499"><span class='Ref_To_Local'>arrayOid</span></a> <span class='Operator'>= </span><a href="typecmds.c.html#LN3497"><span class='Ref_To_Local'>typform</span></a><span class='Operator'>-&GT;</span>typarray<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If the type is already there, we scan skip these next few checks. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN3498"><span class='Ref_To_Local'>oldNspOid</span></a> <span class='Operator'>!= </span><a href="typecmds.c.html#LN3490"><span class='Ref_to_Parameter'>nspOid</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* common checks on switching namespaces */ 
</span>        <a href="../../include/catalog/namespace.h.html#LN117"><span class='Ref_to_Proto'>CheckSetNamespace</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3498"><span class='Ref_To_Local'>oldNspOid</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3490"><span class='Ref_to_Parameter'>nspOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* check for duplicate name (more friendly than unique-index failure) */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN175"><span class='Ref_to_Macro'>SearchSysCacheExists2</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN106"><span class='Ref_to_EnumConst'>TYPENAMENSP</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/postgres.h.html#LN600"><span class='Ref_to_Macro'>NameGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="typecmds.c.html#LN3497"><span class='Ref_To_Local'>typform</span></a><span class='Operator'>-&GT;</span>typname<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3490"><span class='Ref_to_Parameter'>nspOid</span></a><span class='Parentheses'>)))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/pg_basebackup/streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"type \"%s\" already exists in schema \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3497"><span class='Ref_To_Local'>typform</span></a><span class='Operator'>-&GT;</span>typname<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3490"><span class='Ref_to_Parameter'>nspOid</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Detect whether type is a composite type (but not a table rowtype) */ 
</span>    <a href="typecmds.c.html#LN3500"><span class='Ref_To_Local'>isCompositeType</span></a> <span class='Operator'>= 
</span>        <span class='Parentheses'>(</span><a href="typecmds.c.html#LN3497"><span class='Ref_To_Local'>typform</span></a><span class='Operator'>-&GT;</span>typtype <span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN720"><span class='Ref_to_Const'>TYPTYPE_COMPOSITE</span></a> <span class='Operator'>&& 
</span>         <a href="../../include/utils/lsyscache.h.html#LN127"><span class='Ref_to_Proto'>get_rel_relkind</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3497"><span class='Ref_To_Local'>typform</span></a><span class='Operator'>-&GT;</span>typrelid<span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN165"><span class='Ref_to_Const'>RELKIND_COMPOSITE_TYPE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Enforce not-table-type if requested */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN3497"><span class='Ref_To_Local'>typform</span></a><span class='Operator'>-&GT;</span>typtype <span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN720"><span class='Ref_to_Const'>TYPTYPE_COMPOSITE</span></a> <span class='Operator'>&& !</span><a href="typecmds.c.html#LN3500"><span class='Ref_To_Local'>isCompositeType</span></a> <span class='Operator'>&& 
</span>        <a href="typecmds.c.html#LN3492"><span class='Ref_to_Parameter'>errorOnTableType</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"%s is a table's row type"</span><span class='Delimiter'>, 
</span>                        <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3490"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Use ALTER TABLE instead."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN3498"><span class='Ref_To_Local'>oldNspOid</span></a> <span class='Operator'>!= </span><a href="typecmds.c.html#LN3490"><span class='Ref_to_Parameter'>nspOid</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* OK, modify the pg_type row */ 
</span> 
        <span class='Comment_Multi_Line'>/* tup is a copy, so we can scribble directly on it */ 
</span>        <a href="typecmds.c.html#LN3497"><span class='Ref_To_Local'>typform</span></a><span class='Operator'>-&GT;</span>typnamespace <span class='Operator'>= </span><a href="typecmds.c.html#LN3490"><span class='Ref_to_Parameter'>nspOid</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3495"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="typecmds.c.html#LN3496"><span class='Ref_To_Local'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3496"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Composite types have pg_class entries. 
     * 
     * We need to modify the pg_class tuple as well to reflect the change of 
     * schema. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN3500"><span class='Ref_To_Local'>isCompositeType</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3572"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>classRel</span><span class='Delimiter'>; 
</span> 
        <a href="typecmds.c.html#LN3572"><span class='Ref_To_Local'>classRel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/commands/tablecmds.h.html#LN47"><span class='Ref_to_Proto'>AlterRelationNamespaceInternal</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3572"><span class='Ref_To_Local'>classRel</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3497"><span class='Ref_To_Local'>typform</span></a><span class='Operator'>-&GT;</span>typrelid<span class='Delimiter'>, 
</span>                                       <a href="typecmds.c.html#LN3498"><span class='Ref_To_Local'>oldNspOid</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3490"><span class='Ref_to_Parameter'>nspOid</span></a><span class='Delimiter'>, 
</span>                                       <span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3493"><span class='Ref_to_Parameter'>objsMoved</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3572"><span class='Ref_To_Local'>classRel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Check for constraints associated with the composite type (we don't 
         * currently support this, but probably will someday). 
         */ 
</span>        <a href="../../include/catalog/pg_constraint_fn.h.html#LN68"><span class='Ref_to_Proto'>AlterConstraintNamespaces</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3497"><span class='Ref_To_Local'>typform</span></a><span class='Operator'>-&GT;</span>typrelid<span class='Delimiter'>, </span><a href="typecmds.c.html#LN3498"><span class='Ref_To_Local'>oldNspOid</span></a><span class='Delimiter'>, 
</span>                                  <a href="typecmds.c.html#LN3490"><span class='Ref_to_Parameter'>nspOid</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3493"><span class='Ref_to_Parameter'>objsMoved</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* If it's a domain, it might have constraints */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN3497"><span class='Ref_To_Local'>typform</span></a><span class='Operator'>-&GT;</span>typtype <span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN721"><span class='Ref_to_Const'>TYPTYPE_DOMAIN</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/catalog/pg_constraint_fn.h.html#LN68"><span class='Ref_to_Proto'>AlterConstraintNamespaces</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3490"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3498"><span class='Ref_To_Local'>oldNspOid</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3490"><span class='Ref_to_Parameter'>nspOid</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                      <a href="typecmds.c.html#LN3493"><span class='Ref_to_Parameter'>objsMoved</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Update dependency on schema, if any --- a table rowtype has not got 
     * one, and neither does an implicit array. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="typecmds.c.html#LN3498"><span class='Ref_To_Local'>oldNspOid</span></a> <span class='Operator'>!= </span><a href="typecmds.c.html#LN3490"><span class='Ref_to_Parameter'>nspOid</span></a> <span class='Operator'>&& 
</span>        <span class='Parentheses'>(</span><a href="typecmds.c.html#LN3500"><span class='Ref_To_Local'>isCompositeType</span></a> <span class='Operator'>|| </span><a href="typecmds.c.html#LN3497"><span class='Ref_To_Local'>typform</span></a><span class='Operator'>-&GT;</span>typtype <span class='Operator'>!= </span><a href="../../include/catalog/pg_type.h.html#LN720"><span class='Ref_to_Const'>TYPTYPE_COMPOSITE</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="typecmds.c.html#LN3491"><span class='Ref_to_Parameter'>isImplicitArray</span></a><span class='Parentheses'>)</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/dependency.h.html#LN234"><span class='Ref_to_Proto'>changeDependencyFor</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3490"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/catalog/pg_namespace.h.html#LN33"><span class='Ref_to_Const'>NamespaceRelationId</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3498"><span class='Ref_To_Local'>oldNspOid</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3490"><span class='Ref_to_Parameter'>nspOid</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"failed to change schema dependency for type %s"</span><span class='Delimiter'>, 
</span>                 <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3490"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3490"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3496"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3495"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/dependency.h.html#LN202"><span class='Ref_to_Proto'>add_exact_object_address</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="typecmds.c.html#LN3501"><span class='Ref_To_Local'>thisobj</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3493"><span class='Ref_to_Parameter'>objsMoved</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Recursively alter the associated array type, if any */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3499"><span class='Ref_To_Local'>arrayOid</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/commands/typecmds.h.html#LN51"><span class='Ref_to_Proto'>AlterTypeNamespaceInternal</span></a><span class='Parentheses'>(</span><a href="typecmds.c.html#LN3499"><span class='Ref_To_Local'>arrayOid</span></a><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3490"><span class='Ref_to_Parameter'>nspOid</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="typecmds.c.html#LN3493"><span class='Ref_to_Parameter'>objsMoved</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="typecmds.c.html#LN3498"><span class='Ref_To_Local'>oldNspOid</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterTypeNamespaceInternal &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>