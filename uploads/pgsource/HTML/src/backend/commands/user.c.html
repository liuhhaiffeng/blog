<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\commands\user.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\commands\user.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:37 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * user.c 
 *    Commands for manipulating roles (formerly called users). 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * src/backend/commands/user.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/genam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/heapam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xact.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/binary_upgrade.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/catalog.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/dependency.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/indexing.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/objectaccess.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_auth_members.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_authid.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_database.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_db_role_setting.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/comment.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/dbcommands.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/seclabel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/user.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"libpq/crypt.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/lmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/acl.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/fmgroids.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/timestamp.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/tqual.h"</span> 
 
<span class='Comment_Multi_Line'>/* Potentially set by pg_upgrade_support functions */ 
</span><a name="LN42"></a><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Var'>binary_upgrade_next_pg_authid_oid</span> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* GUC parameter */ 
</span><a name="LN46"></a><span class='Keyword'>int</span>         <span class='Declare_Var'>Password_encryption</span> <span class='Operator'>= </span><a href="../../include/libpq/crypt.h.html#LN29"><span class='Ref_to_EnumConst'>PASSWORD_TYPE_MD5</span></a><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* Hook to check passwords in CreateRole() and AlterRole() */ 
</span><a name="LN49"></a><a href="../../include/commands/user.h.html#LN22"><span class='Ref_to_Typedef'>check_password_hook_type</span></a> <span class='Declare_Var'>check_password_hook</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<a name="LN51"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>AddRoleMems</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>rolename</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, 
</span><a name="LN52"></a>            <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>memberSpecs</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>memberIds</span><span class='Delimiter'>, 
</span><a name="LN53"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>grantorId</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>admin_opt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN54"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>DelRoleMems</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>rolename</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, 
</span><a name="LN55"></a>            <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>memberSpecs</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>memberIds</span><span class='Delimiter'>, 
</span><a name="LN56"></a>            <span class='Keyword'>bool </span><span class='Declare_Parameter'>admin_opt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* Check if current user has createrole privileges */ 
</span><span class='Keyword'>static bool 
</span><a name="LN61"></a><span class='Declare_Function'>have_createrole_privilege</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN330"><span class='Ref_to_Proto'>has_createrole_privilege</span></a><span class='Parentheses'>(</span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * CREATE ROLE 
 */ 
</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN71"></a><span class='Declare_Function'>CreateRole</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2402"><span class='Ref_to_Struct'>CreateRoleStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN73"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pg_authid_rel</span><span class='Delimiter'>; 
</span><a name="LN74"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>pg_authid_dsc</span><span class='Delimiter'>; 
</span><a name="LN75"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN76"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>new_record</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN77"><span class='Ref_to_Const'>Natts_pg_authid</span></a><span class='Delimiter'>]; 
</span><a name="LN77"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>new_record_nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN77"><span class='Ref_to_Const'>Natts_pg_authid</span></a><span class='Delimiter'>]; 
</span><a name="LN78"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN79"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>item</span><span class='Delimiter'>; 
</span><a name="LN80"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>option</span><span class='Delimiter'>; 
</span><a name="LN81"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>password</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* user password */ 
</span><a name="LN82"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>issuper</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* Make the user a superuser? */ 
</span><a name="LN83"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>inherit</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* Auto inherit privileges? */ 
</span><a name="LN84"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>createrole</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* Can this user create roles? */ 
</span><a name="LN85"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>createdb</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* Can the user create databases? */ 
</span><a name="LN86"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>canlogin</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* Can this user login? */ 
</span><a name="LN87"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isreplication</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* Is this a replication role? */ 
</span><a name="LN88"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>bypassrls</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>      <span class='Comment_Multi_Line'>/* Is this a row security enabled 
                                         * role? */ 
</span><a name="LN90"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>connlimit</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* maximum connections allowed */ 
</span><a name="LN91"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>addroleto</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* roles to make this a member of */ 
</span><a name="LN92"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>rolemembers</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* roles to be members of this role */ 
</span><a name="LN93"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>adminmembers</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* roles to be admins of this role */ 
</span><a name="LN94"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>validUntil</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* time the login is valid until */ 
</span><a name="LN95"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>validUntil_datum</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* same, as timestamptz Datum */ 
</span><a name="LN96"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>validUntil_null</span><span class='Delimiter'>; 
</span><a name="LN97"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>dpassword</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN98"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>dissuper</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN99"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>dinherit</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN100"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>dcreaterole</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN101"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>dcreatedb</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN102"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>dcanlogin</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN103"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>disreplication</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN104"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>dconnlimit</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN105"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>daddroleto</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN106"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>drolemembers</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN107"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>dadminmembers</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN108"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>dvalidUntil</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN109"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>dbypassRLS</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* The defaults can vary depending on the original statement type */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="user.c.html#LN71"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2405"><span class='Ref_to_Member'>stmt_type</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2397"><span class='Ref_to_EnumConst'>ROLESTMT_ROLE</span></a><span class='Operator'>: 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2398"><span class='Ref_to_EnumConst'>ROLESTMT_USER</span></a><span class='Operator'>: 
</span>            <a href="user.c.html#LN86"><span class='Ref_To_Local'>canlogin</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* may eventually want inherit to default to false here */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN2399"><span class='Ref_to_EnumConst'>ROLESTMT_GROUP</span></a><span class='Operator'>: 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Extract options from the statement node tree */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN80"><span class='Ref_To_Local'>option</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN71"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2407"><span class='Ref_to_Member'>options</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN127"></a>        <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>defel</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN80"><span class='Ref_To_Local'>option</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"password"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN97"><span class='Ref_To_Local'>dpassword</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN71"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="user.c.html#LN97"><span class='Ref_To_Local'>dpassword</span></a> <span class='Operator'>= </span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"sysid"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"SYSID can no longer be specified"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"superuser"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN98"><span class='Ref_To_Local'>dissuper</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN71"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="user.c.html#LN98"><span class='Ref_To_Local'>dissuper</span></a> <span class='Operator'>= </span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"inherit"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN99"><span class='Ref_To_Local'>dinherit</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN71"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="user.c.html#LN99"><span class='Ref_To_Local'>dinherit</span></a> <span class='Operator'>= </span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"createrole"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN100"><span class='Ref_To_Local'>dcreaterole</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN71"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="user.c.html#LN100"><span class='Ref_To_Local'>dcreaterole</span></a> <span class='Operator'>= </span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"createdb"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN101"><span class='Ref_To_Local'>dcreatedb</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN71"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="user.c.html#LN101"><span class='Ref_To_Local'>dcreatedb</span></a> <span class='Operator'>= </span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"canlogin"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN102"><span class='Ref_To_Local'>dcanlogin</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN71"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="user.c.html#LN102"><span class='Ref_To_Local'>dcanlogin</span></a> <span class='Operator'>= </span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"isreplication"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN103"><span class='Ref_To_Local'>disreplication</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN71"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="user.c.html#LN103"><span class='Ref_To_Local'>disreplication</span></a> <span class='Operator'>= </span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"connectionlimit"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN104"><span class='Ref_To_Local'>dconnlimit</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN71"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="user.c.html#LN104"><span class='Ref_To_Local'>dconnlimit</span></a> <span class='Operator'>= </span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"addroleto"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN105"><span class='Ref_To_Local'>daddroleto</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN71"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="user.c.html#LN105"><span class='Ref_To_Local'>daddroleto</span></a> <span class='Operator'>= </span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"rolemembers"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN106"><span class='Ref_To_Local'>drolemembers</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN71"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="user.c.html#LN106"><span class='Ref_To_Local'>drolemembers</span></a> <span class='Operator'>= </span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"adminmembers"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN107"><span class='Ref_To_Local'>dadminmembers</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN71"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="user.c.html#LN107"><span class='Ref_To_Local'>dadminmembers</span></a> <span class='Operator'>= </span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"validUntil"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN108"><span class='Ref_To_Local'>dvalidUntil</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN71"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="user.c.html#LN108"><span class='Ref_To_Local'>dvalidUntil</span></a> <span class='Operator'>= </span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"bypassrls"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN109"><span class='Ref_To_Local'>dbypassRLS</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN71"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="user.c.html#LN109"><span class='Ref_To_Local'>dbypassRLS</span></a> <span class='Operator'>= </span><a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"option \"%s\" not recognized"</span><span class='Delimiter'>, 
</span>                 <a href="user.c.html#LN127"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN97"><span class='Ref_To_Local'>dpassword</span></a> <span class='Operator'>&& </span><a href="user.c.html#LN97"><span class='Ref_To_Local'>dpassword</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>) 
</span>        <a href="user.c.html#LN81"><span class='Ref_To_Local'>password</span></a> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN97"><span class='Ref_To_Local'>dpassword</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN98"><span class='Ref_To_Local'>dissuper</span></a><span class='Parentheses'>) 
</span>        <a href="user.c.html#LN82"><span class='Ref_To_Local'>issuper</span></a> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN51"><span class='Ref_to_Macro'>intVal</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN98"><span class='Ref_To_Local'>dissuper</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN99"><span class='Ref_To_Local'>dinherit</span></a><span class='Parentheses'>) 
</span>        <a href="user.c.html#LN83"><span class='Ref_To_Local'>inherit</span></a> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN51"><span class='Ref_to_Macro'>intVal</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN99"><span class='Ref_To_Local'>dinherit</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN100"><span class='Ref_To_Local'>dcreaterole</span></a><span class='Parentheses'>) 
</span>        <a href="user.c.html#LN84"><span class='Ref_To_Local'>createrole</span></a> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN51"><span class='Ref_to_Macro'>intVal</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN100"><span class='Ref_To_Local'>dcreaterole</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN101"><span class='Ref_To_Local'>dcreatedb</span></a><span class='Parentheses'>) 
</span>        <a href="user.c.html#LN85"><span class='Ref_To_Local'>createdb</span></a> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN51"><span class='Ref_to_Macro'>intVal</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN101"><span class='Ref_To_Local'>dcreatedb</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN102"><span class='Ref_To_Local'>dcanlogin</span></a><span class='Parentheses'>) 
</span>        <a href="user.c.html#LN86"><span class='Ref_To_Local'>canlogin</span></a> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN51"><span class='Ref_to_Macro'>intVal</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN102"><span class='Ref_To_Local'>dcanlogin</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN103"><span class='Ref_To_Local'>disreplication</span></a><span class='Parentheses'>) 
</span>        <a href="user.c.html#LN87"><span class='Ref_To_Local'>isreplication</span></a> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN51"><span class='Ref_to_Macro'>intVal</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN103"><span class='Ref_To_Local'>disreplication</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN104"><span class='Ref_To_Local'>dconnlimit</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="user.c.html#LN90"><span class='Ref_To_Local'>connlimit</span></a> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN51"><span class='Ref_to_Macro'>intVal</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN104"><span class='Ref_To_Local'>dconnlimit</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN90"><span class='Ref_To_Local'>connlimit</span></a> <span class='Operator'>&LT; -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid connection limit: %d"</span><span class='Delimiter'>, </span><a href="user.c.html#LN90"><span class='Ref_To_Local'>connlimit</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN105"><span class='Ref_To_Local'>daddroleto</span></a><span class='Parentheses'>) 
</span>        <a href="user.c.html#LN91"><span class='Ref_To_Local'>addroleto</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="user.c.html#LN105"><span class='Ref_To_Local'>daddroleto</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN106"><span class='Ref_To_Local'>drolemembers</span></a><span class='Parentheses'>) 
</span>        <a href="user.c.html#LN92"><span class='Ref_To_Local'>rolemembers</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="user.c.html#LN106"><span class='Ref_To_Local'>drolemembers</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN107"><span class='Ref_To_Local'>dadminmembers</span></a><span class='Parentheses'>) 
</span>        <a href="user.c.html#LN93"><span class='Ref_To_Local'>adminmembers</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="user.c.html#LN107"><span class='Ref_To_Local'>dadminmembers</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN108"><span class='Ref_To_Local'>dvalidUntil</span></a><span class='Parentheses'>) 
</span>        <a href="user.c.html#LN94"><span class='Ref_To_Local'>validUntil</span></a> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN108"><span class='Ref_To_Local'>dvalidUntil</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN109"><span class='Ref_To_Local'>dbypassRLS</span></a><span class='Parentheses'>) 
</span>        <a href="user.c.html#LN88"><span class='Ref_To_Local'>bypassrls</span></a> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN51"><span class='Ref_to_Macro'>intVal</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN109"><span class='Ref_To_Local'>dbypassRLS</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check some permissions first */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN82"><span class='Ref_To_Local'>issuper</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>())</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"must be superuser to create superusers"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN87"><span class='Ref_To_Local'>isreplication</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>())</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                   <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"must be superuser to create replication users"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN88"><span class='Ref_To_Local'>bypassrls</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>())</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"must be superuser to change bypassrls attribute"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="user.c.html#LN60"><span class='Ref_to_Func'>have_createrole_privilege</span></a><span class='Parentheses'>())</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied to create role"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check that the user is not trying to create a role in the reserved 
     * "pg_" namespace. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/catalog.h.html#LN40"><span class='Ref_to_Proto'>IsReservedName</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN71"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2406"><span class='Ref_to_Member'>role</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_RESERVED_NAME<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"role name \"%s\" is reserved"</span><span class='Delimiter'>, 
</span>                        <a href="user.c.html#LN71"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2406"><span class='Ref_to_Member'>role</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Role names starting with \"pg_\" are reserved."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check the pg_authid relation to be certain the role doesn't already 
     * exist. 
     */ 
</span>    <a href="user.c.html#LN73"><span class='Ref_To_Local'>pg_authid_rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_authid.h.html#LN41"><span class='Ref_to_Const'>AuthIdRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="user.c.html#LN74"><span class='Ref_To_Local'>pg_authid_dsc</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN73"><span class='Ref_To_Local'>pg_authid_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN234"><span class='Ref_to_Proto'>get_role_oid</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN71"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2406"><span class='Ref_to_Member'>role</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/pg_basebackup/streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"role \"%s\" already exists"</span><span class='Delimiter'>, 
</span>                        <a href="user.c.html#LN71"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2406"><span class='Ref_to_Member'>role</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Convert validuntil to internal form */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN94"><span class='Ref_To_Local'>validUntil</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="user.c.html#LN95"><span class='Ref_To_Local'>validUntil_datum</span></a> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN587"><span class='Ref_to_Macro'>DirectFunctionCall3</span></a><span class='Parentheses'>(</span><a href="../utils/adt/timestamp.c.html#LN381"><span class='Ref_to_Func'>timestamptz_in</span></a><span class='Delimiter'>, 
</span>                                               <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN94"><span class='Ref_To_Local'>validUntil</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                               <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                               <a href="../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="user.c.html#LN96"><span class='Ref_To_Local'>validUntil_null</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="user.c.html#LN95"><span class='Ref_To_Local'>validUntil_datum</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="user.c.html#LN96"><span class='Ref_To_Local'>validUntil_null</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Call the password checking hook if there is one defined 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN49"><span class='Ref_to_Global_Var'>check_password_hook</span></a> <span class='Operator'>&& </span><a href="user.c.html#LN81"><span class='Ref_To_Local'>password</span></a><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="user.c.html#LN49"><span class='Ref_to_Global_Var'>check_password_hook</span></a><span class='Parentheses'>) (</span><a href="user.c.html#LN71"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2406"><span class='Ref_to_Member'>role</span></a><span class='Delimiter'>, 
</span>                                <a href="user.c.html#LN81"><span class='Ref_To_Local'>password</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/libpq/crypt.h.html#LN33"><span class='Ref_to_Proto'>get_password_type</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN81"><span class='Ref_To_Local'>password</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="user.c.html#LN95"><span class='Ref_To_Local'>validUntil_datum</span></a><span class='Delimiter'>, 
</span>                                <a href="user.c.html#LN96"><span class='Ref_To_Local'>validUntil_null</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Build a tuple to insert 
     */ 
</span>    <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN76"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="user.c.html#LN76"><span class='Ref_To_Local'>new_record</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN77"><span class='Ref_To_Local'>new_record_nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="user.c.html#LN77"><span class='Ref_To_Local'>new_record_nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="user.c.html#LN76"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN78"><span class='Ref_to_Const'>Anum_pg_authid_rolname</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>        <a href="../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../utils/adt/name.c.html#LN44"><span class='Ref_to_Func'>namein</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN71"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2406"><span class='Ref_to_Member'>role</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="user.c.html#LN76"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN79"><span class='Ref_to_Const'>Anum_pg_authid_rolsuper</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN82"><span class='Ref_To_Local'>issuper</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="user.c.html#LN76"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN80"><span class='Ref_to_Const'>Anum_pg_authid_rolinherit</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN83"><span class='Ref_To_Local'>inherit</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="user.c.html#LN76"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN81"><span class='Ref_to_Const'>Anum_pg_authid_rolcreaterole</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN84"><span class='Ref_To_Local'>createrole</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="user.c.html#LN76"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN82"><span class='Ref_to_Const'>Anum_pg_authid_rolcreatedb</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN85"><span class='Ref_To_Local'>createdb</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="user.c.html#LN76"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN83"><span class='Ref_to_Const'>Anum_pg_authid_rolcanlogin</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN86"><span class='Ref_To_Local'>canlogin</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="user.c.html#LN76"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN84"><span class='Ref_to_Const'>Anum_pg_authid_rolreplication</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN87"><span class='Ref_To_Local'>isreplication</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="user.c.html#LN76"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN86"><span class='Ref_to_Const'>Anum_pg_authid_rolconnlimit</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN90"><span class='Ref_To_Local'>connlimit</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN81"><span class='Ref_To_Local'>password</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Encrypt the password to the requested format. */ 
</span><a name="LN388"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>shadow_pass</span><span class='Delimiter'>; 
</span> 
        <a href="user.c.html#LN388"><span class='Ref_To_Local'>shadow_pass</span></a> <span class='Operator'>= </span><a href="../../include/libpq/crypt.h.html#LN34"><span class='Ref_to_Proto'>encrypt_password</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN46"><span class='Ref_to_Global_Var'>Password_encryption</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN71"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2406"><span class='Ref_to_Member'>role</span></a><span class='Delimiter'>, 
</span>                                       <a href="user.c.html#LN81"><span class='Ref_To_Local'>password</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="user.c.html#LN76"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN87"><span class='Ref_to_Const'>Anum_pg_authid_rolpassword</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>            <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN388"><span class='Ref_To_Local'>shadow_pass</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="user.c.html#LN77"><span class='Ref_To_Local'>new_record_nulls</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN87"><span class='Ref_to_Const'>Anum_pg_authid_rolpassword</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="user.c.html#LN76"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN88"><span class='Ref_to_Const'>Anum_pg_authid_rolvaliduntil</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="user.c.html#LN95"><span class='Ref_To_Local'>validUntil_datum</span></a><span class='Delimiter'>; 
</span>    <a href="user.c.html#LN77"><span class='Ref_To_Local'>new_record_nulls</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN88"><span class='Ref_to_Const'>Anum_pg_authid_rolvaliduntil</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="user.c.html#LN96"><span class='Ref_To_Local'>validUntil_null</span></a><span class='Delimiter'>; 
</span> 
    <a href="user.c.html#LN76"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN85"><span class='Ref_to_Const'>Anum_pg_authid_rolbypassrls</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN88"><span class='Ref_To_Local'>bypassrls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="user.c.html#LN75"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN74"><span class='Ref_To_Local'>pg_authid_dsc</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN76"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN77"><span class='Ref_To_Local'>new_record_nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * pg_largeobject_metadata contains pg_authid.oid's, so we use the 
     * binary-upgrade override. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN101"><span class='Ref_to_Global_Var'>IsBinaryUpgrade</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN42"><span class='Ref_to_Global_Var'>binary_upgrade_next_pg_authid_oid</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"pg_authid OID value not set when in binary upgrade mode"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/access/htup_details.h.html#LN697"><span class='Ref_to_Macro'>HeapTupleSetOid</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN75"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN42"><span class='Ref_to_Global_Var'>binary_upgrade_next_pg_authid_oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="user.c.html#LN42"><span class='Ref_to_Global_Var'>binary_upgrade_next_pg_authid_oid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Insert new record in the pg_authid table 
     */ 
</span>    <a href="user.c.html#LN78"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/indexing.h.html#LN32"><span class='Ref_to_Proto'>CatalogTupleInsert</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN73"><span class='Ref_To_Local'>pg_authid_rel</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN75"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Advance command counter so we can see new record; else tests in 
     * AddRoleMems may fail. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN91"><span class='Ref_To_Local'>addroleto</span></a> <span class='Operator'>|| </span><a href="user.c.html#LN93"><span class='Ref_To_Local'>adminmembers</span></a> <span class='Operator'>|| </span><a href="user.c.html#LN92"><span class='Ref_To_Local'>rolemembers</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Add the new role to the specified existing roles. 
     */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN79"><span class='Ref_To_Local'>item</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN91"><span class='Ref_To_Local'>addroleto</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN437"></a>        <a href="../../include/nodes/parsenodes.h.html#LN324"><span class='Ref_to_Struct'>RoleSpec</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>oldrole</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN79"><span class='Ref_To_Local'>item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN438"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>oldroletup</span> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN238"><span class='Ref_to_Proto'>get_rolespec_tuple</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN437"><span class='Ref_To_Local'>oldrole</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN439"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>oldroleid</span> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN438"><span class='Ref_To_Local'>oldroletup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN440"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>oldrolename</span> <span class='Operator'>= </span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(((</span><a href="../../include/catalog/pg_authid.h.html#LN71"><span class='Ref_to_Typedef'>Form_pg_authid</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN438"><span class='Ref_To_Local'>oldroletup</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>rolname<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="user.c.html#LN51"><span class='Ref_to_Proto'>AddRoleMems</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN440"><span class='Ref_To_Local'>oldrolename</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN439"><span class='Ref_To_Local'>oldroleid</span></a><span class='Delimiter'>, 
</span>                    <a href="../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="../nodes/value.c.html#LN51"><span class='Ref_to_Func'>makeString</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN71"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2406"><span class='Ref_to_Member'>role</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                    <a href="../../include/nodes/pg_list.h.html#LN150"><span class='Ref_to_Macro'>list_make1_oid</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN78"><span class='Ref_To_Local'>roleid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN438"><span class='Ref_To_Local'>oldroletup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Add the specified members to this new role. adminmembers get the admin 
     * option, rolemembers don't. 
     */ 
</span>    <a href="user.c.html#LN51"><span class='Ref_to_Proto'>AddRoleMems</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN71"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2406"><span class='Ref_to_Member'>role</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN78"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, 
</span>                <a href="user.c.html#LN93"><span class='Ref_To_Local'>adminmembers</span></a><span class='Delimiter'>, </span><a href="../../include/commands/user.h.html#LN34"><span class='Ref_to_Proto'>roleSpecsToIds</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN93"><span class='Ref_To_Local'>adminmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="user.c.html#LN51"><span class='Ref_to_Proto'>AddRoleMems</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN71"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2406"><span class='Ref_to_Member'>role</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN78"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, 
</span>                <a href="user.c.html#LN92"><span class='Ref_To_Local'>rolemembers</span></a><span class='Delimiter'>, </span><a href="../../include/commands/user.h.html#LN34"><span class='Ref_to_Proto'>roleSpecsToIds</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN92"><span class='Ref_To_Local'>rolemembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Post creation hook for new role */ 
</span>    <a href="../../include/catalog/objectaccess.h.html#LN144"><span class='Ref_to_Macro'>InvokeObjectPostCreateHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_authid.h.html#LN41"><span class='Ref_to_Const'>AuthIdRelationId</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN78"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Close pg_authid, but keep lock till commit. 
     */ 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN73"><span class='Ref_To_Local'>pg_authid_rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="user.c.html#LN78"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CreateRole &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * ALTER ROLE 
 * 
 * Note: the rolemembers option accepted here is intended to support the 
 * backwards-compatible ALTER GROUP syntax.  Although it will work to say 
 * "ALTER ROLE role ROLE rolenames", we don't document it. 
 */ 
</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN481"></a><span class='Declare_Function'>AlterRole</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2410"><span class='Ref_to_Struct'>AlterRoleStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN483"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>new_record</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN77"><span class='Ref_to_Const'>Natts_pg_authid</span></a><span class='Delimiter'>]; 
</span><a name="LN484"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>new_record_nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN77"><span class='Ref_to_Const'>Natts_pg_authid</span></a><span class='Delimiter'>]; 
</span><a name="LN485"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>new_record_repl</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN77"><span class='Ref_to_Const'>Natts_pg_authid</span></a><span class='Delimiter'>]; 
</span><a name="LN486"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pg_authid_rel</span><span class='Delimiter'>; 
</span><a name="LN487"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>pg_authid_dsc</span><span class='Delimiter'>; 
</span><a name="LN488"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>, 
</span><a name="LN489"></a>                <span class='Declare_Local'>new_tuple</span><span class='Delimiter'>; 
</span><a name="LN490"></a>    <a href="../../include/catalog/pg_authid.h.html#LN71"><span class='Ref_to_Typedef'>Form_pg_authid</span></a> <span class='Declare_Local'>authform</span><span class='Delimiter'>; 
</span><a name="LN491"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>option</span><span class='Delimiter'>; 
</span><a name="LN492"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>rolename</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN493"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>password</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* user password */ 
</span><a name="LN494"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>issuper</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* Make the user a superuser? */ 
</span><a name="LN495"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>inherit</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* Auto inherit privileges? */ 
</span><a name="LN496"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>createrole</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* Can this user create roles? */ 
</span><a name="LN497"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>createdb</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* Can the user create databases? */ 
</span><a name="LN498"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>canlogin</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* Can this user login? */ 
</span><a name="LN499"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>isreplication</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* Is this a replication role? */ 
</span><a name="LN500"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>connlimit</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* maximum connections allowed */ 
</span><a name="LN501"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>rolemembers</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* roles to be added/removed */ 
</span><a name="LN502"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>validUntil</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* time the login is valid until */ 
</span><a name="LN503"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>validUntil_datum</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* same, as timestamptz Datum */ 
</span><a name="LN504"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>validUntil_null</span><span class='Delimiter'>; 
</span><a name="LN505"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>bypassrls</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span><a name="LN506"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>dpassword</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN507"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>dissuper</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN508"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>dinherit</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN509"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>dcreaterole</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN510"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>dcreatedb</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN511"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>dcanlogin</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN512"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>disreplication</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN513"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>dconnlimit</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN514"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>drolemembers</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN515"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>dvalidUntil</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN516"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>dbypassRLS</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN517"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/acl.h.html#LN237"><span class='Ref_to_Proto'>check_rolespec_name</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN481"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2413"><span class='Ref_to_Member'>role</span></a><span class='Delimiter'>, 
</span>                        <span class='String'>"Cannot alter reserved roles."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Extract options from the statement node tree */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN491"><span class='Ref_To_Local'>option</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN481"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2414"><span class='Ref_to_Member'>options</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN525"></a>        <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>defel</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN491"><span class='Ref_To_Local'>option</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="user.c.html#LN525"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"password"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN506"><span class='Ref_To_Local'>dpassword</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="user.c.html#LN506"><span class='Ref_To_Local'>dpassword</span></a> <span class='Operator'>= </span><a href="user.c.html#LN525"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="user.c.html#LN525"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"superuser"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN507"><span class='Ref_To_Local'>dissuper</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="user.c.html#LN507"><span class='Ref_To_Local'>dissuper</span></a> <span class='Operator'>= </span><a href="user.c.html#LN525"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="user.c.html#LN525"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"inherit"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN508"><span class='Ref_To_Local'>dinherit</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="user.c.html#LN508"><span class='Ref_To_Local'>dinherit</span></a> <span class='Operator'>= </span><a href="user.c.html#LN525"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="user.c.html#LN525"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"createrole"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN509"><span class='Ref_To_Local'>dcreaterole</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="user.c.html#LN509"><span class='Ref_To_Local'>dcreaterole</span></a> <span class='Operator'>= </span><a href="user.c.html#LN525"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="user.c.html#LN525"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"createdb"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN510"><span class='Ref_To_Local'>dcreatedb</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="user.c.html#LN510"><span class='Ref_To_Local'>dcreatedb</span></a> <span class='Operator'>= </span><a href="user.c.html#LN525"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="user.c.html#LN525"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"canlogin"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN511"><span class='Ref_To_Local'>dcanlogin</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="user.c.html#LN511"><span class='Ref_To_Local'>dcanlogin</span></a> <span class='Operator'>= </span><a href="user.c.html#LN525"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="user.c.html#LN525"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"isreplication"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN512"><span class='Ref_To_Local'>disreplication</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="user.c.html#LN512"><span class='Ref_To_Local'>disreplication</span></a> <span class='Operator'>= </span><a href="user.c.html#LN525"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="user.c.html#LN525"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"connectionlimit"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN513"><span class='Ref_To_Local'>dconnlimit</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="user.c.html#LN513"><span class='Ref_To_Local'>dconnlimit</span></a> <span class='Operator'>= </span><a href="user.c.html#LN525"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="user.c.html#LN525"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"rolemembers"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>                 <a href="user.c.html#LN481"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2415"><span class='Ref_to_Member'>action</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN514"><span class='Ref_To_Local'>drolemembers</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="user.c.html#LN514"><span class='Ref_To_Local'>drolemembers</span></a> <span class='Operator'>= </span><a href="user.c.html#LN525"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="user.c.html#LN525"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"validUntil"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN515"><span class='Ref_To_Local'>dvalidUntil</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="user.c.html#LN515"><span class='Ref_To_Local'>dvalidUntil</span></a> <span class='Operator'>= </span><a href="user.c.html#LN525"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="user.c.html#LN525"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"bypassrls"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN516"><span class='Ref_To_Local'>dbypassRLS</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="user.c.html#LN516"><span class='Ref_To_Local'>dbypassRLS</span></a> <span class='Operator'>= </span><a href="user.c.html#LN525"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"option \"%s\" not recognized"</span><span class='Delimiter'>, 
</span>                 <a href="user.c.html#LN525"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN506"><span class='Ref_To_Local'>dpassword</span></a> <span class='Operator'>&& </span><a href="user.c.html#LN506"><span class='Ref_To_Local'>dpassword</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>) 
</span>        <a href="user.c.html#LN493"><span class='Ref_To_Local'>password</span></a> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN506"><span class='Ref_To_Local'>dpassword</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN507"><span class='Ref_To_Local'>dissuper</span></a><span class='Parentheses'>) 
</span>        <a href="user.c.html#LN494"><span class='Ref_To_Local'>issuper</span></a> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN51"><span class='Ref_to_Macro'>intVal</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN507"><span class='Ref_To_Local'>dissuper</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN508"><span class='Ref_To_Local'>dinherit</span></a><span class='Parentheses'>) 
</span>        <a href="user.c.html#LN495"><span class='Ref_To_Local'>inherit</span></a> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN51"><span class='Ref_to_Macro'>intVal</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN508"><span class='Ref_To_Local'>dinherit</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN509"><span class='Ref_To_Local'>dcreaterole</span></a><span class='Parentheses'>) 
</span>        <a href="user.c.html#LN496"><span class='Ref_To_Local'>createrole</span></a> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN51"><span class='Ref_to_Macro'>intVal</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN509"><span class='Ref_To_Local'>dcreaterole</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN510"><span class='Ref_To_Local'>dcreatedb</span></a><span class='Parentheses'>) 
</span>        <a href="user.c.html#LN497"><span class='Ref_To_Local'>createdb</span></a> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN51"><span class='Ref_to_Macro'>intVal</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN510"><span class='Ref_To_Local'>dcreatedb</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN511"><span class='Ref_To_Local'>dcanlogin</span></a><span class='Parentheses'>) 
</span>        <a href="user.c.html#LN498"><span class='Ref_To_Local'>canlogin</span></a> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN51"><span class='Ref_to_Macro'>intVal</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN511"><span class='Ref_To_Local'>dcanlogin</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN512"><span class='Ref_To_Local'>disreplication</span></a><span class='Parentheses'>) 
</span>        <a href="user.c.html#LN499"><span class='Ref_To_Local'>isreplication</span></a> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN51"><span class='Ref_to_Macro'>intVal</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN512"><span class='Ref_To_Local'>disreplication</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN513"><span class='Ref_To_Local'>dconnlimit</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="user.c.html#LN500"><span class='Ref_To_Local'>connlimit</span></a> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN51"><span class='Ref_to_Macro'>intVal</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN513"><span class='Ref_To_Local'>dconnlimit</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN500"><span class='Ref_To_Local'>connlimit</span></a> <span class='Operator'>&LT; -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid connection limit: %d"</span><span class='Delimiter'>, </span><a href="user.c.html#LN500"><span class='Ref_To_Local'>connlimit</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN514"><span class='Ref_To_Local'>drolemembers</span></a><span class='Parentheses'>) 
</span>        <a href="user.c.html#LN501"><span class='Ref_To_Local'>rolemembers</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="user.c.html#LN514"><span class='Ref_To_Local'>drolemembers</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN515"><span class='Ref_To_Local'>dvalidUntil</span></a><span class='Parentheses'>) 
</span>        <a href="user.c.html#LN502"><span class='Ref_To_Local'>validUntil</span></a> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN515"><span class='Ref_To_Local'>dvalidUntil</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN516"><span class='Ref_To_Local'>dbypassRLS</span></a><span class='Parentheses'>) 
</span>        <a href="user.c.html#LN505"><span class='Ref_To_Local'>bypassrls</span></a> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN51"><span class='Ref_to_Macro'>intVal</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN516"><span class='Ref_To_Local'>dbypassRLS</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Scan the pg_authid relation to be certain the user exists. 
     */ 
</span>    <a href="user.c.html#LN486"><span class='Ref_To_Local'>pg_authid_rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_authid.h.html#LN41"><span class='Ref_to_Const'>AuthIdRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="user.c.html#LN487"><span class='Ref_To_Local'>pg_authid_dsc</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN486"><span class='Ref_To_Local'>pg_authid_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="user.c.html#LN488"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN238"><span class='Ref_to_Proto'>get_rolespec_tuple</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN481"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2413"><span class='Ref_to_Member'>role</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="user.c.html#LN490"><span class='Ref_To_Local'>authform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_authid.h.html#LN71"><span class='Ref_to_Typedef'>Form_pg_authid</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN488"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="user.c.html#LN492"><span class='Ref_To_Local'>rolename</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN490"><span class='Ref_To_Local'>authform</span></a><span class='Operator'>-&GT;</span>rolname<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="user.c.html#LN517"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN488"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * To mess with a superuser you gotta be superuser; else you need 
     * createrole, or just want to change your own password 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN490"><span class='Ref_To_Local'>authform</span></a><span class='Operator'>-&GT;</span>rolsuper <span class='Operator'>|| </span><a href="user.c.html#LN494"><span class='Ref_To_Local'>issuper</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>())</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"must be superuser to alter superusers"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN490"><span class='Ref_To_Local'>authform</span></a><span class='Operator'>-&GT;</span>rolreplication <span class='Operator'>|| </span><a href="user.c.html#LN499"><span class='Ref_To_Local'>isreplication</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>())</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"must be superuser to alter replication users"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN490"><span class='Ref_To_Local'>authform</span></a><span class='Operator'>-&GT;</span>rolbypassrls <span class='Operator'>|| </span><a href="user.c.html#LN505"><span class='Ref_To_Local'>bypassrls</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>())</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"must be superuser to change bypassrls attribute"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="user.c.html#LN60"><span class='Ref_to_Func'>have_createrole_privilege</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="user.c.html#LN495"><span class='Ref_To_Local'>inherit</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>              <a href="user.c.html#LN496"><span class='Ref_To_Local'>createrole</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>              <a href="user.c.html#LN497"><span class='Ref_To_Local'>createdb</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>              <a href="user.c.html#LN498"><span class='Ref_To_Local'>canlogin</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>              <a href="user.c.html#LN499"><span class='Ref_To_Local'>isreplication</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>              <span class='Operator'>!</span><a href="user.c.html#LN513"><span class='Ref_To_Local'>dconnlimit</span></a> <span class='Operator'>&& 
</span>              <span class='Operator'>!</span><a href="user.c.html#LN501"><span class='Ref_To_Local'>rolemembers</span></a> <span class='Operator'>&& 
</span>              <span class='Operator'>!</span><a href="user.c.html#LN502"><span class='Ref_To_Local'>validUntil</span></a> <span class='Operator'>&& 
</span>              <a href="user.c.html#LN506"><span class='Ref_To_Local'>dpassword</span></a> <span class='Operator'>&& 
</span>              <a href="user.c.html#LN517"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>== </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Convert validuntil to internal form */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN502"><span class='Ref_To_Local'>validUntil</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="user.c.html#LN503"><span class='Ref_To_Local'>validUntil_datum</span></a> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN587"><span class='Ref_to_Macro'>DirectFunctionCall3</span></a><span class='Parentheses'>(</span><a href="../utils/adt/timestamp.c.html#LN381"><span class='Ref_to_Func'>timestamptz_in</span></a><span class='Delimiter'>, 
</span>                                               <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN502"><span class='Ref_To_Local'>validUntil</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                               <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                               <a href="../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="user.c.html#LN504"><span class='Ref_To_Local'>validUntil_null</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* fetch existing setting in case hook needs it */ 
</span>        <a href="user.c.html#LN503"><span class='Ref_To_Local'>validUntil_datum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN43"><span class='Ref_to_EnumConst'>AUTHNAME</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN488"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, 
</span>                                           <a href="../../include/catalog/pg_authid.h.html#LN88"><span class='Ref_to_Const'>Anum_pg_authid_rolvaliduntil</span></a><span class='Delimiter'>, 
</span>                                           <span class='Operator'>&</span><a href="user.c.html#LN504"><span class='Ref_To_Local'>validUntil_null</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Call the password checking hook if there is one defined 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN49"><span class='Ref_to_Global_Var'>check_password_hook</span></a> <span class='Operator'>&& </span><a href="user.c.html#LN493"><span class='Ref_To_Local'>password</span></a><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="user.c.html#LN49"><span class='Ref_to_Global_Var'>check_password_hook</span></a><span class='Parentheses'>) (</span><a href="user.c.html#LN492"><span class='Ref_To_Local'>rolename</span></a><span class='Delimiter'>, 
</span>                                <a href="user.c.html#LN493"><span class='Ref_To_Local'>password</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/libpq/crypt.h.html#LN33"><span class='Ref_to_Proto'>get_password_type</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN493"><span class='Ref_To_Local'>password</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="user.c.html#LN503"><span class='Ref_To_Local'>validUntil_datum</span></a><span class='Delimiter'>, 
</span>                                <a href="user.c.html#LN504"><span class='Ref_To_Local'>validUntil_null</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Build an updated tuple, perusing the information just obtained 
     */ 
</span>    <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN483"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="user.c.html#LN483"><span class='Ref_To_Local'>new_record</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN484"><span class='Ref_To_Local'>new_record_nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="user.c.html#LN484"><span class='Ref_To_Local'>new_record_nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN485"><span class='Ref_To_Local'>new_record_repl</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="user.c.html#LN485"><span class='Ref_To_Local'>new_record_repl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * issuper/createrole/etc 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN494"><span class='Ref_To_Local'>issuper</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="user.c.html#LN483"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN79"><span class='Ref_to_Const'>Anum_pg_authid_rolsuper</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN494"><span class='Ref_To_Local'>issuper</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="user.c.html#LN485"><span class='Ref_To_Local'>new_record_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN79"><span class='Ref_to_Const'>Anum_pg_authid_rolsuper</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN495"><span class='Ref_To_Local'>inherit</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="user.c.html#LN483"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN80"><span class='Ref_to_Const'>Anum_pg_authid_rolinherit</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN495"><span class='Ref_To_Local'>inherit</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="user.c.html#LN485"><span class='Ref_To_Local'>new_record_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN80"><span class='Ref_to_Const'>Anum_pg_authid_rolinherit</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN496"><span class='Ref_To_Local'>createrole</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="user.c.html#LN483"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN81"><span class='Ref_to_Const'>Anum_pg_authid_rolcreaterole</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN496"><span class='Ref_To_Local'>createrole</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="user.c.html#LN485"><span class='Ref_To_Local'>new_record_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN81"><span class='Ref_to_Const'>Anum_pg_authid_rolcreaterole</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN497"><span class='Ref_To_Local'>createdb</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="user.c.html#LN483"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN82"><span class='Ref_to_Const'>Anum_pg_authid_rolcreatedb</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN497"><span class='Ref_To_Local'>createdb</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="user.c.html#LN485"><span class='Ref_To_Local'>new_record_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN82"><span class='Ref_to_Const'>Anum_pg_authid_rolcreatedb</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN498"><span class='Ref_To_Local'>canlogin</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="user.c.html#LN483"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN83"><span class='Ref_to_Const'>Anum_pg_authid_rolcanlogin</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN498"><span class='Ref_To_Local'>canlogin</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="user.c.html#LN485"><span class='Ref_To_Local'>new_record_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN83"><span class='Ref_to_Const'>Anum_pg_authid_rolcanlogin</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN499"><span class='Ref_To_Local'>isreplication</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="user.c.html#LN483"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN84"><span class='Ref_to_Const'>Anum_pg_authid_rolreplication</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN499"><span class='Ref_To_Local'>isreplication</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="user.c.html#LN485"><span class='Ref_To_Local'>new_record_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN84"><span class='Ref_to_Const'>Anum_pg_authid_rolreplication</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN513"><span class='Ref_To_Local'>dconnlimit</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="user.c.html#LN483"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN86"><span class='Ref_to_Const'>Anum_pg_authid_rolconnlimit</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN500"><span class='Ref_To_Local'>connlimit</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="user.c.html#LN485"><span class='Ref_To_Local'>new_record_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN86"><span class='Ref_to_Const'>Anum_pg_authid_rolconnlimit</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* password */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN493"><span class='Ref_To_Local'>password</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Encrypt the password to the requested format. */ 
</span><a name="LN786"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>shadow_pass</span><span class='Delimiter'>; 
</span> 
        <a href="user.c.html#LN786"><span class='Ref_To_Local'>shadow_pass</span></a> <span class='Operator'>= </span><a href="../../include/libpq/crypt.h.html#LN34"><span class='Ref_to_Proto'>encrypt_password</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN46"><span class='Ref_to_Global_Var'>Password_encryption</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN492"><span class='Ref_To_Local'>rolename</span></a><span class='Delimiter'>, 
</span>                                       <a href="user.c.html#LN493"><span class='Ref_To_Local'>password</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="user.c.html#LN483"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN87"><span class='Ref_to_Const'>Anum_pg_authid_rolpassword</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>            <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN786"><span class='Ref_To_Local'>shadow_pass</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="user.c.html#LN485"><span class='Ref_To_Local'>new_record_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN87"><span class='Ref_to_Const'>Anum_pg_authid_rolpassword</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* unset password */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN506"><span class='Ref_To_Local'>dpassword</span></a> <span class='Operator'>&& </span><a href="user.c.html#LN506"><span class='Ref_To_Local'>dpassword</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="user.c.html#LN485"><span class='Ref_To_Local'>new_record_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN87"><span class='Ref_to_Const'>Anum_pg_authid_rolpassword</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="user.c.html#LN484"><span class='Ref_To_Local'>new_record_nulls</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN87"><span class='Ref_to_Const'>Anum_pg_authid_rolpassword</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* valid until */ 
</span>    <a href="user.c.html#LN483"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN88"><span class='Ref_to_Const'>Anum_pg_authid_rolvaliduntil</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="user.c.html#LN503"><span class='Ref_To_Local'>validUntil_datum</span></a><span class='Delimiter'>; 
</span>    <a href="user.c.html#LN484"><span class='Ref_To_Local'>new_record_nulls</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN88"><span class='Ref_to_Const'>Anum_pg_authid_rolvaliduntil</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="user.c.html#LN504"><span class='Ref_To_Local'>validUntil_null</span></a><span class='Delimiter'>; 
</span>    <a href="user.c.html#LN485"><span class='Ref_To_Local'>new_record_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN88"><span class='Ref_to_Const'>Anum_pg_authid_rolvaliduntil</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN505"><span class='Ref_To_Local'>bypassrls</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="user.c.html#LN483"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN85"><span class='Ref_to_Const'>Anum_pg_authid_rolbypassrls</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN505"><span class='Ref_To_Local'>bypassrls</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="user.c.html#LN485"><span class='Ref_To_Local'>new_record_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN85"><span class='Ref_to_Const'>Anum_pg_authid_rolbypassrls</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="user.c.html#LN489"><span class='Ref_To_Local'>new_tuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN488"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN487"><span class='Ref_To_Local'>pg_authid_dsc</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN483"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>, 
</span>                                  <a href="user.c.html#LN484"><span class='Ref_To_Local'>new_record_nulls</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN485"><span class='Ref_To_Local'>new_record_repl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN486"><span class='Ref_To_Local'>pg_authid_rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="user.c.html#LN488"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN489"><span class='Ref_To_Local'>new_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_authid.h.html#LN41"><span class='Ref_to_Const'>AuthIdRelationId</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN517"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN488"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN489"><span class='Ref_To_Local'>new_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Advance command counter so we can see new record; else tests in 
     * AddRoleMems may fail. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN501"><span class='Ref_To_Local'>rolemembers</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN481"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2415"><span class='Ref_to_Member'>action</span></a> <span class='Operator'>== +</span><span class='Number'>1</span><span class='Parentheses'>)</span>     <span class='Comment_Single_Line'>/* add members to role */ 
</span>        <a href="user.c.html#LN51"><span class='Ref_to_Proto'>AddRoleMems</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN492"><span class='Ref_To_Local'>rolename</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN517"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, 
</span>                    <a href="user.c.html#LN501"><span class='Ref_To_Local'>rolemembers</span></a><span class='Delimiter'>, </span><a href="../../include/commands/user.h.html#LN34"><span class='Ref_to_Proto'>roleSpecsToIds</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN501"><span class='Ref_To_Local'>rolemembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN481"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2415"><span class='Ref_to_Member'>action</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>)</span>    <span class='Comment_Single_Line'>/* drop members from role */ 
</span>        <a href="user.c.html#LN54"><span class='Ref_to_Proto'>DelRoleMems</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN492"><span class='Ref_To_Local'>rolename</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN517"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, 
</span>                    <a href="user.c.html#LN501"><span class='Ref_To_Local'>rolemembers</span></a><span class='Delimiter'>, </span><a href="../../include/commands/user.h.html#LN34"><span class='Ref_to_Proto'>roleSpecsToIds</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN501"><span class='Ref_To_Local'>rolemembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Close pg_authid, but keep lock till commit. 
     */ 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN486"><span class='Ref_To_Local'>pg_authid_rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="user.c.html#LN517"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterRole &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * ALTER ROLE ... SET 
 */ 
</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN851"></a><span class='Declare_Function'>AlterRoleSet</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2418"><span class='Ref_to_Struct'>AlterRoleSetStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN853"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>roletuple</span><span class='Delimiter'>; 
</span><a name="LN854"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>databaseid</span> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span><a name="LN855"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN851"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2421"><span class='Ref_to_Member'>role</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/acl.h.html#LN237"><span class='Ref_to_Proto'>check_rolespec_name</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN851"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2421"><span class='Ref_to_Member'>role</span></a><span class='Delimiter'>, 
</span>                            <span class='String'>"Cannot alter reserved roles."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="user.c.html#LN853"><span class='Ref_To_Local'>roletuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN238"><span class='Ref_to_Proto'>get_rolespec_tuple</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN851"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2421"><span class='Ref_to_Member'>role</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="user.c.html#LN855"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN853"><span class='Ref_To_Local'>roletuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Obtain a lock on the role and make sure it didn't go away in the 
         * meantime. 
         */ 
</span>        <a href="../../include/catalog/dependency.h.html#LN270"><span class='Ref_to_Proto'>shdepLockAndCheckObject</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_authid.h.html#LN41"><span class='Ref_to_Const'>AuthIdRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN853"><span class='Ref_To_Local'>roletuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * To mess with a superuser you gotta be superuser; else you need 
         * createrole, or just want to change your own settings 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="../../include/catalog/pg_authid.h.html#LN71"><span class='Ref_to_Typedef'>Form_pg_authid</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN853"><span class='Ref_To_Local'>roletuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>rolsuper<span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>())</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"must be superuser to alter superusers"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="user.c.html#LN60"><span class='Ref_to_Func'>have_createrole_privilege</span></a><span class='Parentheses'>() </span><span class='Operator'>&& 
</span>                <a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN853"><span class='Ref_To_Local'>roletuple</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>())</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN853"><span class='Ref_To_Local'>roletuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if stmt-&GT;role &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* look up and lock the database, if specified */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN851"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2422"><span class='Ref_to_Member'>database</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="user.c.html#LN854"><span class='Ref_To_Local'>databaseid</span></a> <span class='Operator'>= </span><a href="../../include/commands/dbcommands.h.html#LN28"><span class='Ref_to_Proto'>get_database_oid</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN851"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2422"><span class='Ref_to_Member'>database</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/catalog/dependency.h.html#LN270"><span class='Ref_to_Proto'>shdepLockAndCheckObject</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_database.h.html#LN28"><span class='Ref_to_Const'>DatabaseRelationId</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN854"><span class='Ref_To_Local'>databaseid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="user.c.html#LN851"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2421"><span class='Ref_to_Member'>role</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * If no role is specified, then this is effectively the same as 
             * ALTER DATABASE ... SET, so use the same permission check. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN318"><span class='Ref_to_Proto'>pg_database_ownercheck</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN854"><span class='Ref_To_Local'>databaseid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
                <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN183"><span class='Ref_to_EnumConst'>ACL_KIND_DATABASE</span></a><span class='Delimiter'>, 
</span>                               <a href="user.c.html#LN851"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2422"><span class='Ref_to_Member'>database</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="user.c.html#LN851"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2421"><span class='Ref_to_Member'>role</span></a> <span class='Operator'>&& !</span><a href="user.c.html#LN851"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2422"><span class='Ref_to_Member'>database</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Must be superuser to alter settings globally. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>())</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"must be superuser to alter settings globally"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../catalog/pg_db_role_setting.c.html#LN22"><span class='Ref_to_Func'>AlterSetting</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN854"><span class='Ref_To_Local'>databaseid</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN855"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN851"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2423"><span class='Ref_to_Member'>setstmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="user.c.html#LN855"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterRoleSet &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * DROP ROLE 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN931"></a><span class='Declare_Function'>DropRole</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2426"><span class='Ref_to_Struct'>DropRoleStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN933"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pg_authid_rel</span><span class='Delimiter'>, 
</span><a name="LN934"></a>                <span class='Declare_Local'>pg_auth_members_rel</span><span class='Delimiter'>; 
</span><a name="LN935"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>item</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="user.c.html#LN60"><span class='Ref_to_Func'>have_createrole_privilege</span></a><span class='Parentheses'>())</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied to drop role"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Scan the pg_authid relation to find the Oid of the role(s) to be 
     * deleted. 
     */ 
</span>    <a href="user.c.html#LN933"><span class='Ref_To_Local'>pg_authid_rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_authid.h.html#LN41"><span class='Ref_to_Const'>AuthIdRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="user.c.html#LN934"><span class='Ref_To_Local'>pg_auth_members_rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_auth_members.h.html#LN28"><span class='Ref_to_Const'>AuthMemRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN935"><span class='Ref_To_Local'>item</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN931"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2429"><span class='Ref_to_Member'>roles</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN951"></a>        <a href="../../include/nodes/parsenodes.h.html#LN324"><span class='Ref_to_Struct'>RoleSpec</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>rolspec</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN935"><span class='Ref_To_Local'>item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN952"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>role</span><span class='Delimiter'>; 
</span><a name="LN953"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>, 
</span><a name="LN954"></a>                    <span class='Declare_Local'>tmp_tuple</span><span class='Delimiter'>; 
</span><a name="LN955"></a>        <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>scankey</span><span class='Delimiter'>; 
</span><a name="LN956"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>detail</span><span class='Delimiter'>; 
</span><a name="LN957"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>detail_log</span><span class='Delimiter'>; 
</span><a name="LN958"></a>        <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>sscan</span><span class='Delimiter'>; 
</span><a name="LN959"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN951"><span class='Ref_To_Local'>rolspec</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN327"><span class='Ref_to_Member'>roletype</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/parsenodes.h.html#LN318"><span class='Ref_to_EnumConst'>ROLESPEC_CSTRING</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                  <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot use special role specifier in DROP ROLE"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="user.c.html#LN952"><span class='Ref_To_Local'>role</span></a> <span class='Operator'>= </span><a href="user.c.html#LN951"><span class='Ref_To_Local'>rolspec</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN328"><span class='Ref_to_Member'>rolename</span></a><span class='Delimiter'>; 
</span> 
        <a href="user.c.html#LN953"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN43"><span class='Ref_to_EnumConst'>AUTHNAME</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN952"><span class='Ref_To_Local'>role</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN953"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="user.c.html#LN931"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2430"><span class='Ref_to_Member'>missing_ok</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"role \"%s\" does not exist"</span><span class='Delimiter'>, </span><a href="user.c.html#LN952"><span class='Ref_To_Local'>role</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"role \"%s\" does not exist, skipping"</span><span class='Delimiter'>, 
</span>                                <a href="user.c.html#LN952"><span class='Ref_To_Local'>role</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="user.c.html#LN959"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN953"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN959"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>== </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>())</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_IN_USE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"current user cannot be dropped"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN959"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>== </span><a href="../utils/init/miscinit.c.html#LN292"><span class='Ref_to_Func'>GetOuterUserId</span></a><span class='Parentheses'>())</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_IN_USE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"current user cannot be dropped"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN959"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>== </span><a href="../../include/miscadmin.h.html#LN310"><span class='Ref_to_Proto'>GetSessionUserId</span></a><span class='Parentheses'>())</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_IN_USE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"session user cannot be dropped"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * For safety's sake, we allow createrole holders to drop ordinary 
         * roles but not superuser roles.  This is mainly to avoid the 
         * scenario where you accidentally drop the last superuser. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="../../include/catalog/pg_authid.h.html#LN71"><span class='Ref_to_Typedef'>Form_pg_authid</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN953"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>rolsuper <span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="../utils/misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>())</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"must be superuser to drop superusers"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* DROP hook for the role being removed */ 
</span>        <a href="../../include/catalog/objectaccess.h.html#LN153"><span class='Ref_to_Macro'>InvokeObjectDropHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_authid.h.html#LN41"><span class='Ref_to_Const'>AuthIdRelationId</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN959"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Lock the role, so nobody can add dependencies to her while we drop 
         * her.  We keep the lock until the end of transaction. 
         */ 
</span>        <a href="../../include/storage/lmgr.h.html#LN93"><span class='Ref_to_Proto'>LockSharedObject</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_authid.h.html#LN41"><span class='Ref_to_Const'>AuthIdRelationId</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN959"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Check for pg_shdepend entries depending on this role */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/dependency.h.html#LN267"><span class='Ref_to_Proto'>checkSharedDependencies</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_authid.h.html#LN41"><span class='Ref_to_Const'>AuthIdRelationId</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN959"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, 
</span>                                    <span class='Operator'>&</span><a href="user.c.html#LN956"><span class='Ref_To_Local'>detail</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="user.c.html#LN957"><span class='Ref_To_Local'>detail_log</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DEPENDENT_OBJECTS_STILL_EXIST<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"role \"%s\" cannot be dropped because some objects depend on it"</span><span class='Delimiter'>, 
</span>                            <a href="user.c.html#LN952"><span class='Ref_To_Local'>role</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN898"><span class='Ref_to_Func'>errdetail_internal</span></a><span class='Parentheses'>(</span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="user.c.html#LN956"><span class='Ref_To_Local'>detail</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN919"><span class='Ref_to_Func'>errdetail_log</span></a><span class='Parentheses'>(</span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="user.c.html#LN957"><span class='Ref_To_Local'>detail_log</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Remove the role from the pg_authid table 
         */ 
</span>        <a href="../../include/catalog/indexing.h.html#LN40"><span class='Ref_to_Proto'>CatalogTupleDelete</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN933"><span class='Ref_To_Local'>pg_authid_rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="user.c.html#LN953"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN953"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Remove role from the pg_auth_members table.  We have to remove all 
         * tuples that show it as either a role or a member. 
         * 
         * XXX what about grantor entries?  Maybe we should do one heap scan. 
         */ 
</span>        <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="user.c.html#LN955"><span class='Ref_To_Local'>scankey</span></a><span class='Delimiter'>, 
</span>                    <a href="../../include/catalog/pg_auth_members.h.html#LN51"><span class='Ref_to_Const'>Anum_pg_auth_members_roleid</span></a><span class='Delimiter'>, 
</span>                    <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                    <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN959"><span class='Ref_To_Local'>roleid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="user.c.html#LN958"><span class='Ref_To_Local'>sscan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN934"><span class='Ref_To_Local'>pg_auth_members_rel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN101"><span class='Ref_to_Const'>AuthMemRoleMemIndexId</span></a><span class='Delimiter'>, 
</span>                                   <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="user.c.html#LN955"><span class='Ref_To_Local'>scankey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN954"><span class='Ref_To_Local'>tmp_tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN958"><span class='Ref_To_Local'>sscan</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/catalog/indexing.h.html#LN40"><span class='Ref_to_Proto'>CatalogTupleDelete</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN934"><span class='Ref_To_Local'>pg_auth_members_rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="user.c.html#LN954"><span class='Ref_To_Local'>tmp_tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN958"><span class='Ref_To_Local'>sscan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="user.c.html#LN955"><span class='Ref_To_Local'>scankey</span></a><span class='Delimiter'>, 
</span>                    <a href="../../include/catalog/pg_auth_members.h.html#LN52"><span class='Ref_to_Const'>Anum_pg_auth_members_member</span></a><span class='Delimiter'>, 
</span>                    <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                    <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN959"><span class='Ref_To_Local'>roleid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="user.c.html#LN958"><span class='Ref_To_Local'>sscan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN934"><span class='Ref_To_Local'>pg_auth_members_rel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN103"><span class='Ref_to_Const'>AuthMemMemRoleIndexId</span></a><span class='Delimiter'>, 
</span>                                   <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="user.c.html#LN955"><span class='Ref_To_Local'>scankey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN954"><span class='Ref_To_Local'>tmp_tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN958"><span class='Ref_To_Local'>sscan</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/catalog/indexing.h.html#LN40"><span class='Ref_to_Proto'>CatalogTupleDelete</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN934"><span class='Ref_To_Local'>pg_auth_members_rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="user.c.html#LN954"><span class='Ref_To_Local'>tmp_tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN958"><span class='Ref_To_Local'>sscan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Remove any comments or security labels on this role. 
         */ 
</span>        <a href="../../include/commands/comment.h.html#LN38"><span class='Ref_to_Proto'>DeleteSharedComments</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN959"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_authid.h.html#LN41"><span class='Ref_to_Const'>AuthIdRelationId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/commands/seclabel.h.html#LN21"><span class='Ref_to_Proto'>DeleteSharedSecurityLabel</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN959"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_authid.h.html#LN41"><span class='Ref_to_Const'>AuthIdRelationId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Remove settings for this role. 
         */ 
</span>        <a href="../../include/catalog/pg_db_role_setting.h.html#LN64"><span class='Ref_to_Proto'>DropSetting</span></a><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN959"><span class='Ref_To_Local'>roleid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Advance command counter so that later iterations of this loop will 
         * see the changes already made.  This is essential if, for example, 
         * we are trying to drop both a role and one of its direct members --- 
         * we'll get an error if we try to delete the linking pg_auth_members 
         * tuple twice.  (We do not need a CCI between the two delete loops 
         * above, because it's not allowed for a role to directly contain 
         * itself.) 
         */ 
</span>        <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now we can clean up; but keep locks until commit. 
     */ 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN934"><span class='Ref_To_Local'>pg_auth_members_rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN933"><span class='Ref_To_Local'>pg_authid_rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DropRole &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Rename role 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN1108"></a><span class='Declare_Function'>RenameRole</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>oldname</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>newname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1110"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>oldtuple</span><span class='Delimiter'>, 
</span><a name="LN1111"></a>                <span class='Declare_Local'>newtuple</span><span class='Delimiter'>; 
</span><a name="LN1112"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>dsc</span><span class='Delimiter'>; 
</span><a name="LN1113"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN1114"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>datum</span><span class='Delimiter'>; 
</span><a name="LN1115"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN1116"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>repl_val</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN77"><span class='Ref_to_Const'>Natts_pg_authid</span></a><span class='Delimiter'>]; 
</span><a name="LN1117"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>repl_null</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN77"><span class='Ref_to_Const'>Natts_pg_authid</span></a><span class='Delimiter'>]; 
</span><a name="LN1118"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>repl_repl</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN77"><span class='Ref_to_Const'>Natts_pg_authid</span></a><span class='Delimiter'>]; 
</span><a name="LN1119"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN1120"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN1121"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span><a name="LN1122"></a>    <a href="../../include/catalog/pg_authid.h.html#LN71"><span class='Ref_to_Typedef'>Form_pg_authid</span></a> <span class='Declare_Local'>authform</span><span class='Delimiter'>; 
</span> 
    <a href="user.c.html#LN1113"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_authid.h.html#LN41"><span class='Ref_to_Const'>AuthIdRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="user.c.html#LN1112"><span class='Ref_To_Local'>dsc</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1113"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="user.c.html#LN1110"><span class='Ref_To_Local'>oldtuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN43"><span class='Ref_to_EnumConst'>AUTHNAME</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1108"><span class='Ref_to_Parameter'>oldname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1110"><span class='Ref_To_Local'>oldtuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"role \"%s\" does not exist"</span><span class='Delimiter'>, </span><a href="user.c.html#LN1108"><span class='Ref_to_Parameter'>oldname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * XXX Client applications probably store the session user somewhere, so 
     * renaming it could cause confusion.  On the other hand, there may not be 
     * an actual problem besides a little confusion, so think about this and 
     * decide.  Same for SET ROLE ... we don't restrict renaming the current 
     * effective userid, though. 
     */ 
</span> 
    <a href="user.c.html#LN1120"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1110"><span class='Ref_To_Local'>oldtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="user.c.html#LN1122"><span class='Ref_To_Local'>authform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_authid.h.html#LN71"><span class='Ref_to_Typedef'>Form_pg_authid</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1110"><span class='Ref_To_Local'>oldtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN1120"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>== </span><a href="../../include/miscadmin.h.html#LN310"><span class='Ref_to_Proto'>GetSessionUserId</span></a><span class='Parentheses'>())</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"session user cannot be renamed"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN1120"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>== </span><a href="../utils/init/miscinit.c.html#LN292"><span class='Ref_to_Func'>GetOuterUserId</span></a><span class='Parentheses'>())</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"current user cannot be renamed"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check that the user is not trying to rename a system role and not 
     * trying to rename a role into the reserved "pg_" namespace. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/catalog.h.html#LN40"><span class='Ref_to_Proto'>IsReservedName</span></a><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1122"><span class='Ref_To_Local'>authform</span></a><span class='Operator'>-&GT;</span>rolname<span class='Parentheses'>)))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_RESERVED_NAME<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"role name \"%s\" is reserved"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1122"><span class='Ref_To_Local'>authform</span></a><span class='Operator'>-&GT;</span>rolname<span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>               <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Role names starting with \"pg_\" are reserved."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/catalog.h.html#LN40"><span class='Ref_to_Proto'>IsReservedName</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1108"><span class='Ref_to_Parameter'>newname</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_RESERVED_NAME<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"role name \"%s\" is reserved"</span><span class='Delimiter'>, 
</span>                        <a href="user.c.html#LN1108"><span class='Ref_to_Parameter'>newname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Role names starting with \"pg_\" are reserved."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* make sure the new name doesn't exist */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN173"><span class='Ref_to_Macro'>SearchSysCacheExists1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN43"><span class='Ref_to_EnumConst'>AUTHNAME</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1108"><span class='Ref_to_Parameter'>newname</span></a><span class='Parentheses'>)))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/pg_basebackup/streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"role \"%s\" already exists"</span><span class='Delimiter'>, </span><a href="user.c.html#LN1108"><span class='Ref_to_Parameter'>newname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * createrole is enough privilege unless you want to mess with a superuser 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="../../include/catalog/pg_authid.h.html#LN71"><span class='Ref_to_Typedef'>Form_pg_authid</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1110"><span class='Ref_To_Local'>oldtuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>rolsuper<span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>())</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"must be superuser to rename superusers"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="user.c.html#LN60"><span class='Ref_to_Func'>have_createrole_privilege</span></a><span class='Parentheses'>())</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied to rename role"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* OK, construct the modified tuple */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="user.c.html#LN1119"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="user.c.html#LN1119"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../include/catalog/pg_authid.h.html#LN77"><span class='Ref_to_Const'>Natts_pg_authid</span></a><span class='Delimiter'>; </span><a href="user.c.html#LN1119"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="user.c.html#LN1118"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>[</span><a href="user.c.html#LN1119"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="user.c.html#LN1118"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN78"><span class='Ref_to_Const'>Anum_pg_authid_rolname</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="user.c.html#LN1116"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN78"><span class='Ref_to_Const'>Anum_pg_authid_rolname</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../utils/adt/name.c.html#LN44"><span class='Ref_to_Func'>namein</span></a><span class='Delimiter'>, 
</span>                                                   <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1108"><span class='Ref_to_Parameter'>newname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="user.c.html#LN1117"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN78"><span class='Ref_to_Const'>Anum_pg_authid_rolname</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="user.c.html#LN1114"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN768"><span class='Ref_to_Macro'>heap_getattr</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1110"><span class='Ref_To_Local'>oldtuple</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_authid.h.html#LN87"><span class='Ref_to_Const'>Anum_pg_authid_rolpassword</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1112"><span class='Ref_To_Local'>dsc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="user.c.html#LN1115"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="user.c.html#LN1115"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>&& </span><a href="../../include/libpq/crypt.h.html#LN33"><span class='Ref_to_Proto'>get_password_type</span></a><span class='Parentheses'>(</span><a href="../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1114"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><a href="../../include/libpq/crypt.h.html#LN29"><span class='Ref_to_EnumConst'>PASSWORD_TYPE_MD5</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* MD5 uses the username as salt, so just clear it on a rename */ 
</span>        <a href="user.c.html#LN1118"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN87"><span class='Ref_to_Const'>Anum_pg_authid_rolpassword</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="user.c.html#LN1117"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_authid.h.html#LN87"><span class='Ref_to_Const'>Anum_pg_authid_rolpassword</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"MD5 password cleared because of role rename"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="user.c.html#LN1111"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1110"><span class='Ref_To_Local'>oldtuple</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1112"><span class='Ref_To_Local'>dsc</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1116"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1117"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1118"><span class='Ref_To_Local'>repl_repl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1113"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="user.c.html#LN1110"><span class='Ref_To_Local'>oldtuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1111"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_authid.h.html#LN41"><span class='Ref_to_Const'>AuthIdRelationId</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1120"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1121"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_authid.h.html#LN41"><span class='Ref_to_Const'>AuthIdRelationId</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1120"><span class='Ref_To_Local'>roleid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1110"><span class='Ref_To_Local'>oldtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Close pg_authid, but keep lock till commit. 
     */ 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1113"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="user.c.html#LN1121"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RenameRole &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * GrantRoleStmt 
 * 
 * Grant/Revoke roles to/from roles 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1239"></a><span class='Declare_Function'>GrantRole</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1881"><span class='Ref_to_Struct'>GrantRoleStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1241"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pg_authid_rel</span><span class='Delimiter'>; 
</span><a name="LN1242"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>grantor</span><span class='Delimiter'>; 
</span><a name="LN1243"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>grantee_ids</span><span class='Delimiter'>; 
</span><a name="LN1244"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>item</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN1239"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1888"><span class='Ref_to_Member'>grantor</span></a><span class='Parentheses'>) 
</span>        <a href="user.c.html#LN1242"><span class='Ref_To_Local'>grantor</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN236"><span class='Ref_to_Proto'>get_rolespec_oid</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1239"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1888"><span class='Ref_to_Member'>grantor</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="user.c.html#LN1242"><span class='Ref_To_Local'>grantor</span></a> <span class='Operator'>= </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="user.c.html#LN1243"><span class='Ref_To_Local'>grantee_ids</span></a> <span class='Operator'>= </span><a href="../../include/commands/user.h.html#LN34"><span class='Ref_to_Proto'>roleSpecsToIds</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1239"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1885"><span class='Ref_to_Member'>grantee_roles</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* AccessShareLock is enough since we aren't modifying pg_authid */ 
</span>    <a href="user.c.html#LN1241"><span class='Ref_To_Local'>pg_authid_rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_authid.h.html#LN41"><span class='Ref_to_Const'>AuthIdRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Step through all of the granted roles and add/remove entries for the 
     * grantees, or, if admin_opt is set, then just add/remove the admin 
     * option. 
     * 
     * Note: Permissions checking is done by AddRoleMems/DelRoleMems 
     */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1244"><span class='Ref_To_Local'>item</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1239"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1884"><span class='Ref_to_Member'>granted_roles</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1265"></a>        <a href="../../include/nodes/parsenodes.h.html#LN1865"><span class='Ref_to_Struct'>AccessPriv</span></a> <span class='Operator'>*</span><span class='Declare_Local'>priv</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1865"><span class='Ref_to_Struct'>AccessPriv</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1244"><span class='Ref_To_Local'>item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1266"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>rolename</span> <span class='Operator'>= </span><a href="user.c.html#LN1265"><span class='Ref_To_Local'>priv</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1868"><span class='Ref_to_Member'>priv_name</span></a><span class='Delimiter'>; 
</span><a name="LN1267"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Must reject priv(columns) and ALL PRIVILEGES(columns) */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN1266"><span class='Ref_To_Local'>rolename</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="user.c.html#LN1265"><span class='Ref_To_Local'>priv</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1869"><span class='Ref_to_Member'>cols</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_GRANT_OPERATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column names cannot be included in GRANT/REVOKE ROLE"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="user.c.html#LN1267"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN234"><span class='Ref_to_Proto'>get_role_oid</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1266"><span class='Ref_To_Local'>rolename</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN1239"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1886"><span class='Ref_to_Member'>is_grant</span></a><span class='Parentheses'>) 
</span>            <a href="user.c.html#LN51"><span class='Ref_to_Proto'>AddRoleMems</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1266"><span class='Ref_To_Local'>rolename</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1267"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, 
</span>                        <a href="user.c.html#LN1239"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1885"><span class='Ref_to_Member'>grantee_roles</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1243"><span class='Ref_To_Local'>grantee_ids</span></a><span class='Delimiter'>, 
</span>                        <a href="user.c.html#LN1242"><span class='Ref_To_Local'>grantor</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1239"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1887"><span class='Ref_to_Member'>admin_opt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="user.c.html#LN54"><span class='Ref_to_Proto'>DelRoleMems</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1266"><span class='Ref_To_Local'>rolename</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1267"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>, 
</span>                        <a href="user.c.html#LN1239"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1885"><span class='Ref_to_Member'>grantee_roles</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1243"><span class='Ref_To_Local'>grantee_ids</span></a><span class='Delimiter'>, 
</span>                        <a href="user.c.html#LN1239"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1887"><span class='Ref_to_Member'>admin_opt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Close pg_authid, but keep lock till commit. 
     */ 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1241"><span class='Ref_To_Local'>pg_authid_rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end GrantRole &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * DropOwnedObjects 
 * 
 * Drop the objects owned by a given list of roles. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1298"></a><span class='Declare_Function'>DropOwnedObjects</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN3290"><span class='Ref_to_Struct'>DropOwnedStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1300"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>role_ids</span> <span class='Operator'>= </span><a href="../../include/commands/user.h.html#LN34"><span class='Ref_to_Proto'>roleSpecsToIds</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1298"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3293"><span class='Ref_to_Member'>roles</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1301"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check privileges */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1301"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1300"><span class='Ref_To_Local'>role_ids</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1306"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1301"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN229"><span class='Ref_to_Proto'>has_privs_of_role</span></a><span class='Parentheses'>(</span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="user.c.html#LN1306"><span class='Ref_To_Local'>roleid</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied to drop objects"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Ok, do it */ 
</span>    <a href="../../include/catalog/dependency.h.html#LN276"><span class='Ref_to_Proto'>shdepDropOwned</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1300"><span class='Ref_To_Local'>role_ids</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1298"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3294"><span class='Ref_to_Member'>behavior</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DropOwnedObjects &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ReassignOwnedObjects 
 * 
 * Give the objects owned by a given list of roles away to another user. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1324"></a><span class='Declare_Function'>ReassignOwnedObjects</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN3300"><span class='Ref_to_Struct'>ReassignOwnedStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1326"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>role_ids</span> <span class='Operator'>= </span><a href="../../include/commands/user.h.html#LN34"><span class='Ref_to_Proto'>roleSpecsToIds</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1324"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3303"><span class='Ref_to_Member'>roles</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1327"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span><a name="LN1328"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>newrole</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check privileges */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1327"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1326"><span class='Ref_To_Local'>role_ids</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1333"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1327"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN229"><span class='Ref_to_Proto'>has_privs_of_role</span></a><span class='Parentheses'>(</span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="user.c.html#LN1333"><span class='Ref_To_Local'>roleid</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied to reassign objects"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Must have privileges on the receiving side too */ 
</span>    <a href="user.c.html#LN1328"><span class='Ref_To_Local'>newrole</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN236"><span class='Ref_to_Proto'>get_rolespec_oid</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1324"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3304"><span class='Ref_to_Member'>newrole</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN229"><span class='Ref_to_Proto'>has_privs_of_role</span></a><span class='Parentheses'>(</span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="user.c.html#LN1328"><span class='Ref_To_Local'>newrole</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied to reassign objects"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Ok, do it */ 
</span>    <a href="../../include/catalog/dependency.h.html#LN278"><span class='Ref_to_Proto'>shdepReassignOwned</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1326"><span class='Ref_To_Local'>role_ids</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1328"><span class='Ref_To_Local'>newrole</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ReassignOwnedObjects &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * roleSpecsToIds 
 * 
 * Given a list of RoleSpecs, generate a list of role OIDs in the same order. 
 * 
 * ROLESPEC_PUBLIC is not allowed. 
 */ 
</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN1361"></a><span class='Declare_Function'>roleSpecsToIds</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>memberNames</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1363"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1364"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1364"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1361"><span class='Ref_to_Parameter'>memberNames</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1368"></a>        <a href="../../include/nodes/parsenodes.h.html#LN324"><span class='Ref_to_Struct'>RoleSpec</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>rolespec</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN324"><span class='Ref_to_Struct'>RoleSpec</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1364"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1369"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span> 
        <a href="user.c.html#LN1369"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN236"><span class='Ref_to_Proto'>get_rolespec_oid</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1368"><span class='Ref_To_Local'>rolespec</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="user.c.html#LN1363"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1363"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1369"><span class='Ref_To_Local'>roleid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="user.c.html#LN1363"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * AddRoleMems -- Add given members to the specified role 
 * 
 * rolename: name of role to add to (used only for error messages) 
 * roleid: OID of role to add to 
 * memberSpecs: list of RoleSpec of roles to add (used only for error messages) 
 * memberIds: OIDs of roles to add 
 * grantorId: who is granting the membership 
 * admin_opt: granting admin option? 
 * 
 * Note: caller is responsible for calling auth_file_update_needed(). 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1390"></a><span class='Declare_Function'>AddRoleMems</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>rolename</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, 
</span><a name="LN1391"></a>            <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>memberSpecs</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>memberIds</span><span class='Delimiter'>, 
</span><a name="LN1392"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>grantorId</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>admin_opt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1394"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pg_authmem_rel</span><span class='Delimiter'>; 
</span><a name="LN1395"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>pg_authmem_dsc</span><span class='Delimiter'>; 
</span><a name="LN1396"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>specitem</span><span class='Delimiter'>; 
</span><a name="LN1397"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>iditem</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1391"><span class='Ref_to_Parameter'>memberSpecs</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1391"><span class='Ref_to_Parameter'>memberIds</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Skip permission check if nothing to do */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="user.c.html#LN1391"><span class='Ref_to_Parameter'>memberIds</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check permissions: must have createrole or admin option on the role to 
     * be changed.  To mess with a superuser role, you gotta be superuser. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1390"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>())</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"must be superuser to alter superusers"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="user.c.html#LN60"><span class='Ref_to_Func'>have_createrole_privilege</span></a><span class='Parentheses'>() </span><span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN232"><span class='Ref_to_Proto'>is_admin_of_role</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1392"><span class='Ref_to_Parameter'>grantorId</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1390"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"must have admin option on role \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="user.c.html#LN1390"><span class='Ref_to_Parameter'>rolename</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The role membership grantor of record has little significance at 
     * present.  Nonetheless, inasmuch as users might look to it for a crude 
     * audit trail, let only superusers impute the grant to a third party. 
     * 
     * Before lifting this restriction, give the member == role case of 
     * is_admin_of_role() a fresh look.  Ensure that the current role cannot 
     * use an explicit grantor specification to take advantage of the session 
     * user's self-admin right. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="user.c.html#LN1392"><span class='Ref_to_Parameter'>grantorId</span></a> <span class='Operator'>!= </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>() </span><span class='Operator'>&& !</span><a href="../utils/misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>())</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"must be superuser to set grantor"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="user.c.html#LN1394"><span class='Ref_To_Local'>pg_authmem_rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_auth_members.h.html#LN28"><span class='Ref_to_Const'>AuthMemRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="user.c.html#LN1395"><span class='Ref_To_Local'>pg_authmem_dsc</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1394"><span class='Ref_To_Local'>pg_authmem_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN179"><span class='Ref_to_Macro'>forboth</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1396"><span class='Ref_To_Local'>specitem</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1391"><span class='Ref_to_Parameter'>memberSpecs</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1397"><span class='Ref_To_Local'>iditem</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1391"><span class='Ref_to_Parameter'>memberIds</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1446"></a>        <a href="../../include/nodes/parsenodes.h.html#LN324"><span class='Ref_to_Struct'>RoleSpec</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>memberRole</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1396"><span class='Ref_To_Local'>specitem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1447"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>memberid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1397"><span class='Ref_To_Local'>iditem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1448"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>authmem_tuple</span><span class='Delimiter'>; 
</span><a name="LN1449"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN1450"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>new_record</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_auth_members.h.html#LN50"><span class='Ref_to_Const'>Natts_pg_auth_members</span></a><span class='Delimiter'>]; 
</span><a name="LN1451"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>new_record_nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_auth_members.h.html#LN50"><span class='Ref_to_Const'>Natts_pg_auth_members</span></a><span class='Delimiter'>]; 
</span><a name="LN1452"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>new_record_repl</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_auth_members.h.html#LN50"><span class='Ref_to_Const'>Natts_pg_auth_members</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Refuse creation of membership loops, including the trivial case 
         * where a role is made a member of itself.  We do this by checking to 
         * see if the target role is already a member of the proposed member 
         * role.  We have to ignore possible superuserness, however, else we 
         * could never grant membership in a superuser-privileged role. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN231"><span class='Ref_to_Proto'>is_member_of_role_nosuper</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1390"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1447"><span class='Ref_To_Local'>memberid</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_GRANT_OPERATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"role \"%s\" is a member of role \"%s\""</span><span class='Delimiter'>, 
</span>                             <a href="user.c.html#LN1390"><span class='Ref_to_Parameter'>rolename</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN239"><span class='Ref_to_Proto'>get_rolespec_name</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1446"><span class='Ref_To_Local'>memberRole</span></a><span class='Parentheses'>)))))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Check if entry for this role/member already exists; if so, give 
         * warning unless we are adding admin option. 
         */ 
</span>        <a href="user.c.html#LN1448"><span class='Ref_To_Local'>authmem_tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN157"><span class='Ref_to_Macro'>SearchSysCache2</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN42"><span class='Ref_to_EnumConst'>AUTHMEMROLEMEM</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1390"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                        <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1447"><span class='Ref_To_Local'>memberid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1448"><span class='Ref_To_Local'>authmem_tuple</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>            <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="user.c.html#LN1392"><span class='Ref_to_Parameter'>admin_opt</span></a> <span class='Operator'>|| 
</span>             <span class='Parentheses'>((</span><a href="../../include/catalog/pg_auth_members.h.html#LN44"><span class='Ref_to_Typedef'>Form_pg_auth_members</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1448"><span class='Ref_To_Local'>authmem_tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>admin_option<span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"role \"%s\" is already a member of role \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/acl.h.html#LN239"><span class='Ref_to_Proto'>get_rolespec_name</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1446"><span class='Ref_To_Local'>memberRole</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="user.c.html#LN1390"><span class='Ref_to_Parameter'>rolename</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1448"><span class='Ref_To_Local'>authmem_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Build a tuple to insert or update */ 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1450"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="user.c.html#LN1450"><span class='Ref_To_Local'>new_record</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1451"><span class='Ref_To_Local'>new_record_nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="user.c.html#LN1451"><span class='Ref_To_Local'>new_record_nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1452"><span class='Ref_To_Local'>new_record_repl</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="user.c.html#LN1452"><span class='Ref_To_Local'>new_record_repl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="user.c.html#LN1450"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_auth_members.h.html#LN51"><span class='Ref_to_Const'>Anum_pg_auth_members_roleid</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1390"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="user.c.html#LN1450"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_auth_members.h.html#LN52"><span class='Ref_to_Const'>Anum_pg_auth_members_member</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1447"><span class='Ref_To_Local'>memberid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="user.c.html#LN1450"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_auth_members.h.html#LN53"><span class='Ref_to_Const'>Anum_pg_auth_members_grantor</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1392"><span class='Ref_to_Parameter'>grantorId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="user.c.html#LN1450"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_auth_members.h.html#LN54"><span class='Ref_to_Const'>Anum_pg_auth_members_admin_option</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1392"><span class='Ref_to_Parameter'>admin_opt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1448"><span class='Ref_To_Local'>authmem_tuple</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="user.c.html#LN1452"><span class='Ref_To_Local'>new_record_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_auth_members.h.html#LN53"><span class='Ref_to_Const'>Anum_pg_auth_members_grantor</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="user.c.html#LN1452"><span class='Ref_To_Local'>new_record_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_auth_members.h.html#LN54"><span class='Ref_to_Const'>Anum_pg_auth_members_admin_option</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="user.c.html#LN1449"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1448"><span class='Ref_To_Local'>authmem_tuple</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1395"><span class='Ref_To_Local'>pg_authmem_dsc</span></a><span class='Delimiter'>, 
</span>                                      <a href="user.c.html#LN1450"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>, 
</span>                                      <a href="user.c.html#LN1451"><span class='Ref_To_Local'>new_record_nulls</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1452"><span class='Ref_To_Local'>new_record_repl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1394"><span class='Ref_To_Local'>pg_authmem_rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="user.c.html#LN1449"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1449"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1448"><span class='Ref_To_Local'>authmem_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="user.c.html#LN1449"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1395"><span class='Ref_To_Local'>pg_authmem_dsc</span></a><span class='Delimiter'>, 
</span>                                    <a href="user.c.html#LN1450"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1451"><span class='Ref_To_Local'>new_record_nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/catalog/indexing.h.html#LN32"><span class='Ref_to_Proto'>CatalogTupleInsert</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1394"><span class='Ref_To_Local'>pg_authmem_rel</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1449"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* CCI after each change, in case there are duplicates in list */ 
</span>        <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Close pg_authmem, but keep lock till commit. 
     */ 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1394"><span class='Ref_To_Local'>pg_authmem_rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AddRoleMems &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * DelRoleMems -- Remove given members from the specified role 
 * 
 * rolename: name of role to del from (used only for error messages) 
 * roleid: OID of role to del from 
 * memberSpecs: list of RoleSpec of roles to del (used only for error messages) 
 * memberIds: OIDs of roles to del 
 * admin_opt: remove admin option only? 
 * 
 * Note: caller is responsible for calling auth_file_update_needed(). 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1534"></a><span class='Declare_Function'>DelRoleMems</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>rolename</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, 
</span><a name="LN1535"></a>            <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>memberSpecs</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>memberIds</span><span class='Delimiter'>, 
</span><a name="LN1536"></a>            <span class='Keyword'>bool </span><span class='Declare_Parameter'>admin_opt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1538"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pg_authmem_rel</span><span class='Delimiter'>; 
</span><a name="LN1539"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>pg_authmem_dsc</span><span class='Delimiter'>; 
</span><a name="LN1540"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>specitem</span><span class='Delimiter'>; 
</span><a name="LN1541"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>iditem</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1535"><span class='Ref_to_Parameter'>memberSpecs</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1535"><span class='Ref_to_Parameter'>memberIds</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Skip permission check if nothing to do */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="user.c.html#LN1535"><span class='Ref_to_Parameter'>memberIds</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check permissions: must have createrole or admin option on the role to 
     * be changed.  To mess with a superuser role, you gotta be superuser. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1534"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>())</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"must be superuser to alter superusers"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="user.c.html#LN60"><span class='Ref_to_Func'>have_createrole_privilege</span></a><span class='Parentheses'>()</span> <span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN232"><span class='Ref_to_Proto'>is_admin_of_role</span></a><span class='Parentheses'>(</span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="user.c.html#LN1534"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"must have admin option on role \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="user.c.html#LN1534"><span class='Ref_to_Parameter'>rolename</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="user.c.html#LN1538"><span class='Ref_To_Local'>pg_authmem_rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_auth_members.h.html#LN28"><span class='Ref_to_Const'>AuthMemRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="user.c.html#LN1539"><span class='Ref_To_Local'>pg_authmem_dsc</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1538"><span class='Ref_To_Local'>pg_authmem_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN179"><span class='Ref_to_Macro'>forboth</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1540"><span class='Ref_To_Local'>specitem</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1535"><span class='Ref_to_Parameter'>memberSpecs</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1541"><span class='Ref_To_Local'>iditem</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1535"><span class='Ref_to_Parameter'>memberIds</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1575"></a>        <a href="../../include/nodes/parsenodes.h.html#LN324"><span class='Ref_to_Struct'>RoleSpec</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>memberRole</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1540"><span class='Ref_To_Local'>specitem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1576"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>memberid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1541"><span class='Ref_To_Local'>iditem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1577"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>authmem_tuple</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Find entry for this role/member 
         */ 
</span>        <a href="user.c.html#LN1577"><span class='Ref_To_Local'>authmem_tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN157"><span class='Ref_to_Macro'>SearchSysCache2</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN42"><span class='Ref_to_EnumConst'>AUTHMEMROLEMEM</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1534"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                        <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1576"><span class='Ref_To_Local'>memberid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1577"><span class='Ref_To_Local'>authmem_tuple</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"role \"%s\" is not a member of role \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/acl.h.html#LN239"><span class='Ref_to_Proto'>get_rolespec_name</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1575"><span class='Ref_To_Local'>memberRole</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="user.c.html#LN1534"><span class='Ref_to_Parameter'>rolename</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="user.c.html#LN1536"><span class='Ref_to_Parameter'>admin_opt</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Remove the entry altogether */ 
</span>            <a href="../../include/catalog/indexing.h.html#LN40"><span class='Ref_to_Proto'>CatalogTupleDelete</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1538"><span class='Ref_To_Local'>pg_authmem_rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="user.c.html#LN1577"><span class='Ref_To_Local'>authmem_tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Just turn off the admin option */ 
</span><a name="LN1601"></a>            <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN1602"></a>            <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>new_record</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_auth_members.h.html#LN50"><span class='Ref_to_Const'>Natts_pg_auth_members</span></a><span class='Delimiter'>]; 
</span><a name="LN1603"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>new_record_nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_auth_members.h.html#LN50"><span class='Ref_to_Const'>Natts_pg_auth_members</span></a><span class='Delimiter'>]; 
</span><a name="LN1604"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>new_record_repl</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_auth_members.h.html#LN50"><span class='Ref_to_Const'>Natts_pg_auth_members</span></a><span class='Delimiter'>]; 
</span> 
            <span class='Comment_Multi_Line'>/* Build a tuple to update with */ 
</span>            <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1602"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="user.c.html#LN1602"><span class='Ref_To_Local'>new_record</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1603"><span class='Ref_To_Local'>new_record_nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="user.c.html#LN1603"><span class='Ref_To_Local'>new_record_nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1604"><span class='Ref_To_Local'>new_record_repl</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="user.c.html#LN1604"><span class='Ref_To_Local'>new_record_repl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <a href="user.c.html#LN1602"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_auth_members.h.html#LN54"><span class='Ref_to_Const'>Anum_pg_auth_members_admin_option</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="user.c.html#LN1604"><span class='Ref_To_Local'>new_record_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_auth_members.h.html#LN54"><span class='Ref_to_Const'>Anum_pg_auth_members_admin_option</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
            <a href="user.c.html#LN1601"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1577"><span class='Ref_To_Local'>authmem_tuple</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1539"><span class='Ref_To_Local'>pg_authmem_dsc</span></a><span class='Delimiter'>, 
</span>                                      <a href="user.c.html#LN1602"><span class='Ref_To_Local'>new_record</span></a><span class='Delimiter'>, 
</span>                                      <a href="user.c.html#LN1603"><span class='Ref_To_Local'>new_record_nulls</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1604"><span class='Ref_To_Local'>new_record_repl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1538"><span class='Ref_To_Local'>pg_authmem_rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="user.c.html#LN1601"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="user.c.html#LN1601"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1577"><span class='Ref_To_Local'>authmem_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* CCI after each change, in case there are duplicates in list */ 
</span>        <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Close pg_authmem, but keep lock till commit. 
     */ 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="user.c.html#LN1538"><span class='Ref_To_Local'>pg_authmem_rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DelRoleMems &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>