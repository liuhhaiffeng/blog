<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\commands\variable.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\commands\variable.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:38 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * variable.c 
 *      Routines for handling specialized SET variables. 
 * 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/commands/variable.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;ctype.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/parallel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xact.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xlog.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_authid.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/variable.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/acl.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/snapmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/timestamp.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/varlena.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"mb/pg_wchar.h"</span> 
 
<span class='Comment_Multi_Line'>/* 
 * DATESTYLE 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * check_datestyle: GUC check_hook for datestyle 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN43"></a><span class='Declare_Function'>check_datestyle</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>newval</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>**</span><span class='Declare_Parameter'>extra</span><span class='Delimiter'>, </span><a href="../../include/utils/guc.h.html#LN104"><span class='Ref_to_Typedef'>GucSource</span></a> <span class='Declare_Parameter'>source</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN45"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>newDateStyle</span> <span class='Operator'>= </span><a href="../utils/init/globals.c.html#LN106"><span class='Ref_to_Global_Var'>DateStyle</span></a><span class='Delimiter'>; 
</span><a name="LN46"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>newDateOrder</span> <span class='Operator'>= </span><a href="../utils/init/globals.c.html#LN107"><span class='Ref_to_Global_Var'>DateOrder</span></a><span class='Delimiter'>; 
</span><a name="LN47"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>have_style</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN48"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>have_order</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN49"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>ok</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span><a name="LN50"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>rawstring</span><span class='Delimiter'>; 
</span><a name="LN51"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>myextra</span><span class='Delimiter'>; 
</span><a name="LN52"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN53"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>elemlist</span><span class='Delimiter'>; 
</span><a name="LN54"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Need a modifiable copy of string */ 
</span>    <a href="variable.c.html#LN50"><span class='Ref_To_Local'>rawstring</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="variable.c.html#LN43"><span class='Ref_to_Parameter'>newval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Parse string into list of identifiers */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/varlena.h.html#LN29"><span class='Ref_to_Proto'>SplitIdentifierString</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN50"><span class='Ref_To_Local'>rawstring</span></a><span class='Delimiter'>, </span><span class='String'>','</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="variable.c.html#LN53"><span class='Ref_To_Local'>elemlist</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* syntax error in list */ 
</span>        <a href="../../include/utils/guc.h.html#LN406"><span class='Ref_to_Const'>GUC_check_errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"List syntax is invalid."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN50"><span class='Ref_To_Local'>rawstring</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN53"><span class='Ref_To_Local'>elemlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN54"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="variable.c.html#LN53"><span class='Ref_To_Local'>elemlist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN71"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>tok</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN54"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Ugh. Somebody ought to write a table driven version -- mjl */ 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN71"><span class='Ref_To_Local'>tok</span></a><span class='Delimiter'>, </span><span class='String'>"ISO"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="variable.c.html#LN47"><span class='Ref_To_Local'>have_style</span></a> <span class='Operator'>&& </span><a href="variable.c.html#LN45"><span class='Ref_To_Local'>newDateStyle</span></a> <span class='Operator'>!= </span><a href="../../interfaces/ecpg/pgtypeslib/dt.h.html#LN12"><span class='Ref_to_Const'>USE_ISO_DATES</span></a><span class='Parentheses'>) 
</span>                <a href="variable.c.html#LN49"><span class='Ref_To_Local'>ok</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* conflicting styles */ 
</span>            <a href="variable.c.html#LN45"><span class='Ref_To_Local'>newDateStyle</span></a> <span class='Operator'>= </span><a href="../../interfaces/ecpg/pgtypeslib/dt.h.html#LN12"><span class='Ref_to_Const'>USE_ISO_DATES</span></a><span class='Delimiter'>; 
</span>            <a href="variable.c.html#LN47"><span class='Ref_To_Local'>have_style</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN71"><span class='Ref_To_Local'>tok</span></a><span class='Delimiter'>, </span><span class='String'>"SQL"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="variable.c.html#LN47"><span class='Ref_To_Local'>have_style</span></a> <span class='Operator'>&& </span><a href="variable.c.html#LN45"><span class='Ref_To_Local'>newDateStyle</span></a> <span class='Operator'>!= </span><a href="../../interfaces/ecpg/pgtypeslib/dt.h.html#LN13"><span class='Ref_to_Const'>USE_SQL_DATES</span></a><span class='Parentheses'>) 
</span>                <a href="variable.c.html#LN49"><span class='Ref_To_Local'>ok</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* conflicting styles */ 
</span>            <a href="variable.c.html#LN45"><span class='Ref_To_Local'>newDateStyle</span></a> <span class='Operator'>= </span><a href="../../interfaces/ecpg/pgtypeslib/dt.h.html#LN13"><span class='Ref_to_Const'>USE_SQL_DATES</span></a><span class='Delimiter'>; 
</span>            <a href="variable.c.html#LN47"><span class='Ref_To_Local'>have_style</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN67"><span class='Ref_to_Func'>pg_strncasecmp</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN71"><span class='Ref_To_Local'>tok</span></a><span class='Delimiter'>, </span><span class='String'>"POSTGRES"</span><span class='Delimiter'>, </span><span class='Number'>8</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="variable.c.html#LN47"><span class='Ref_To_Local'>have_style</span></a> <span class='Operator'>&& </span><a href="variable.c.html#LN45"><span class='Ref_To_Local'>newDateStyle</span></a> <span class='Operator'>!= </span><a href="../../interfaces/ecpg/pgtypeslib/dt.h.html#LN11"><span class='Ref_to_Const'>USE_POSTGRES_DATES</span></a><span class='Parentheses'>) 
</span>                <a href="variable.c.html#LN49"><span class='Ref_To_Local'>ok</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* conflicting styles */ 
</span>            <a href="variable.c.html#LN45"><span class='Ref_To_Local'>newDateStyle</span></a> <span class='Operator'>= </span><a href="../../interfaces/ecpg/pgtypeslib/dt.h.html#LN11"><span class='Ref_to_Const'>USE_POSTGRES_DATES</span></a><span class='Delimiter'>; 
</span>            <a href="variable.c.html#LN47"><span class='Ref_To_Local'>have_style</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN71"><span class='Ref_To_Local'>tok</span></a><span class='Delimiter'>, </span><span class='String'>"GERMAN"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="variable.c.html#LN47"><span class='Ref_To_Local'>have_style</span></a> <span class='Operator'>&& </span><a href="variable.c.html#LN45"><span class='Ref_To_Local'>newDateStyle</span></a> <span class='Operator'>!= </span><a href="../../interfaces/ecpg/pgtypeslib/dt.h.html#LN14"><span class='Ref_to_Const'>USE_GERMAN_DATES</span></a><span class='Parentheses'>) 
</span>                <a href="variable.c.html#LN49"><span class='Ref_To_Local'>ok</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* conflicting styles */ 
</span>            <a href="variable.c.html#LN45"><span class='Ref_To_Local'>newDateStyle</span></a> <span class='Operator'>= </span><a href="../../interfaces/ecpg/pgtypeslib/dt.h.html#LN14"><span class='Ref_to_Const'>USE_GERMAN_DATES</span></a><span class='Delimiter'>; 
</span>            <a href="variable.c.html#LN47"><span class='Ref_To_Local'>have_style</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* GERMAN also sets DMY, unless explicitly overridden */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="variable.c.html#LN48"><span class='Ref_To_Local'>have_order</span></a><span class='Parentheses'>) 
</span>                <a href="variable.c.html#LN46"><span class='Ref_To_Local'>newDateOrder</span></a> <span class='Operator'>= </span><a href="../../include/miscadmin.h.html#LN219"><span class='Ref_to_Const'>DATEORDER_DMY</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN71"><span class='Ref_To_Local'>tok</span></a><span class='Delimiter'>, </span><span class='String'>"YMD"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="variable.c.html#LN48"><span class='Ref_To_Local'>have_order</span></a> <span class='Operator'>&& </span><a href="variable.c.html#LN46"><span class='Ref_To_Local'>newDateOrder</span></a> <span class='Operator'>!= </span><a href="../../include/miscadmin.h.html#LN218"><span class='Ref_to_Const'>DATEORDER_YMD</span></a><span class='Parentheses'>) 
</span>                <a href="variable.c.html#LN49"><span class='Ref_To_Local'>ok</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* conflicting orders */ 
</span>            <a href="variable.c.html#LN46"><span class='Ref_To_Local'>newDateOrder</span></a> <span class='Operator'>= </span><a href="../../include/miscadmin.h.html#LN218"><span class='Ref_to_Const'>DATEORDER_YMD</span></a><span class='Delimiter'>; 
</span>            <a href="variable.c.html#LN48"><span class='Ref_To_Local'>have_order</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN71"><span class='Ref_To_Local'>tok</span></a><span class='Delimiter'>, </span><span class='String'>"DMY"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                 <a href="../../port/pgstrcasecmp.c.html#LN67"><span class='Ref_to_Func'>pg_strncasecmp</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN71"><span class='Ref_To_Local'>tok</span></a><span class='Delimiter'>, </span><span class='String'>"EURO"</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="variable.c.html#LN48"><span class='Ref_To_Local'>have_order</span></a> <span class='Operator'>&& </span><a href="variable.c.html#LN46"><span class='Ref_To_Local'>newDateOrder</span></a> <span class='Operator'>!= </span><a href="../../include/miscadmin.h.html#LN219"><span class='Ref_to_Const'>DATEORDER_DMY</span></a><span class='Parentheses'>) 
</span>                <a href="variable.c.html#LN49"><span class='Ref_To_Local'>ok</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* conflicting orders */ 
</span>            <a href="variable.c.html#LN46"><span class='Ref_To_Local'>newDateOrder</span></a> <span class='Operator'>= </span><a href="../../include/miscadmin.h.html#LN219"><span class='Ref_to_Const'>DATEORDER_DMY</span></a><span class='Delimiter'>; 
</span>            <a href="variable.c.html#LN48"><span class='Ref_To_Local'>have_order</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN71"><span class='Ref_To_Local'>tok</span></a><span class='Delimiter'>, </span><span class='String'>"MDY"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                 <a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN71"><span class='Ref_To_Local'>tok</span></a><span class='Delimiter'>, </span><span class='String'>"US"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                 <a href="../../port/pgstrcasecmp.c.html#LN67"><span class='Ref_to_Func'>pg_strncasecmp</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN71"><span class='Ref_To_Local'>tok</span></a><span class='Delimiter'>, </span><span class='String'>"NONEURO"</span><span class='Delimiter'>, </span><span class='Number'>7</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="variable.c.html#LN48"><span class='Ref_To_Local'>have_order</span></a> <span class='Operator'>&& </span><a href="variable.c.html#LN46"><span class='Ref_To_Local'>newDateOrder</span></a> <span class='Operator'>!= </span><a href="../../include/miscadmin.h.html#LN220"><span class='Ref_to_Const'>DATEORDER_MDY</span></a><span class='Parentheses'>) 
</span>                <a href="variable.c.html#LN49"><span class='Ref_To_Local'>ok</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* conflicting orders */ 
</span>            <a href="variable.c.html#LN46"><span class='Ref_To_Local'>newDateOrder</span></a> <span class='Operator'>= </span><a href="../../include/miscadmin.h.html#LN220"><span class='Ref_to_Const'>DATEORDER_MDY</span></a><span class='Delimiter'>; 
</span>            <a href="variable.c.html#LN48"><span class='Ref_To_Local'>have_order</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN71"><span class='Ref_To_Local'>tok</span></a><span class='Delimiter'>, </span><span class='String'>"DEFAULT"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Easiest way to get the current DEFAULT state is to fetch the 
             * DEFAULT string from guc.c and recursively parse it. 
             * 
             * We can't simply "return check_datestyle(...)" because we need 
             * to handle constructs like "DEFAULT, ISO". 
             */ 
</span><a name="LN139"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>subval</span><span class='Delimiter'>; 
</span><a name="LN140"></a>            <span class='Keyword'>void</span>       <span class='Operator'>*</span><span class='Declare_Local'>subextra</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
            <a href="variable.c.html#LN139"><span class='Ref_To_Local'>subval</span></a> <span class='Operator'>= </span>strdup<span class='Parentheses'>(</span><a href="../../include/utils/guc.h.html#LN348"><span class='Ref_to_Proto'>GetConfigOptionResetString</span></a><span class='Parentheses'>(</span><span class='String'>"datestyle"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="variable.c.html#LN139"><span class='Ref_To_Local'>subval</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="variable.c.html#LN49"><span class='Ref_To_Local'>ok</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/commands/variable.h.html#LN15"><span class='Ref_to_Proto'>check_datestyle</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="variable.c.html#LN139"><span class='Ref_To_Local'>subval</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="variable.c.html#LN140"><span class='Ref_To_Local'>subextra</span></a><span class='Delimiter'>, </span><a href="variable.c.html#LN43"><span class='Ref_to_Parameter'>source</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN139"><span class='Ref_To_Local'>subval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="variable.c.html#LN49"><span class='Ref_To_Local'>ok</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="variable.c.html#LN51"><span class='Ref_To_Local'>myextra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="variable.c.html#LN140"><span class='Ref_To_Local'>subextra</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="variable.c.html#LN47"><span class='Ref_To_Local'>have_style</span></a><span class='Parentheses'>) 
</span>                <a href="variable.c.html#LN45"><span class='Ref_To_Local'>newDateStyle</span></a> <span class='Operator'>= </span><a href="variable.c.html#LN51"><span class='Ref_To_Local'>myextra</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="variable.c.html#LN48"><span class='Ref_To_Local'>have_order</span></a><span class='Parentheses'>) 
</span>                <a href="variable.c.html#LN46"><span class='Ref_To_Local'>newDateOrder</span></a> <span class='Operator'>= </span><a href="variable.c.html#LN51"><span class='Ref_To_Local'>myextra</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN139"><span class='Ref_To_Local'>subval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN140"><span class='Ref_To_Local'>subextra</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if pg_strcasecmp(tok,"DE... &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/guc.h.html#LN406"><span class='Ref_to_Const'>GUC_check_errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Unrecognized key word: \"%s\"."</span><span class='Delimiter'>, </span><a href="variable.c.html#LN71"><span class='Ref_To_Local'>tok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN50"><span class='Ref_To_Local'>rawstring</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN53"><span class='Ref_To_Local'>elemlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN50"><span class='Ref_To_Local'>rawstring</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN53"><span class='Ref_To_Local'>elemlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="variable.c.html#LN49"><span class='Ref_To_Local'>ok</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/guc.h.html#LN406"><span class='Ref_to_Const'>GUC_check_errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Conflicting \"datestyle\" specifications."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Prepare the canonical string to return.  GUC wants it malloc'd. 
     */ 
</span>    <a href="variable.c.html#LN52"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span><span class='Number'>32</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="variable.c.html#LN52"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="variable.c.html#LN45"><span class='Ref_To_Local'>newDateStyle</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../interfaces/ecpg/pgtypeslib/dt.h.html#LN12"><span class='Ref_to_Const'>USE_ISO_DATES</span></a><span class='Operator'>: 
</span>            <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN52"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"ISO"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../interfaces/ecpg/pgtypeslib/dt.h.html#LN13"><span class='Ref_to_Const'>USE_SQL_DATES</span></a><span class='Operator'>: 
</span>            <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN52"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"SQL"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../interfaces/ecpg/pgtypeslib/dt.h.html#LN14"><span class='Ref_to_Const'>USE_GERMAN_DATES</span></a><span class='Operator'>: 
</span>            <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN52"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"German"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN52"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"Postgres"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="variable.c.html#LN46"><span class='Ref_To_Local'>newDateOrder</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/miscadmin.h.html#LN218"><span class='Ref_to_Const'>DATEORDER_YMD</span></a><span class='Operator'>: 
</span>            strcat<span class='Parentheses'>(</span><a href="variable.c.html#LN52"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>", YMD"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/miscadmin.h.html#LN219"><span class='Ref_to_Const'>DATEORDER_DMY</span></a><span class='Operator'>: 
</span>            strcat<span class='Parentheses'>(</span><a href="variable.c.html#LN52"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>", DMY"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            strcat<span class='Parentheses'>(</span><a href="variable.c.html#LN52"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>", MDY"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="variable.c.html#LN43"><span class='Ref_to_Parameter'>newval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="variable.c.html#LN43"><span class='Ref_to_Parameter'>newval</span></a> <span class='Operator'>= </span><a href="variable.c.html#LN52"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set up the "extra" struct actually used by assign_datestyle. 
     */ 
</span>    <a href="variable.c.html#LN51"><span class='Ref_To_Local'>myextra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span><span class='Number'>2</span> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="variable.c.html#LN51"><span class='Ref_To_Local'>myextra</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="variable.c.html#LN51"><span class='Ref_To_Local'>myextra</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="variable.c.html#LN45"><span class='Ref_To_Local'>newDateStyle</span></a><span class='Delimiter'>; 
</span>    <a href="variable.c.html#LN51"><span class='Ref_To_Local'>myextra</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="variable.c.html#LN46"><span class='Ref_To_Local'>newDateOrder</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="variable.c.html#LN43"><span class='Ref_to_Parameter'>extra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="variable.c.html#LN51"><span class='Ref_To_Local'>myextra</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end check_datestyle &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * assign_datestyle: GUC assign_hook for datestyle 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN235"></a><span class='Declare_Function'>assign_datestyle</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>newval</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>extra</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN237"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>myextra</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="variable.c.html#LN235"><span class='Ref_to_Parameter'>extra</span></a><span class='Delimiter'>; 
</span> 
    <a href="../utils/init/globals.c.html#LN106"><span class='Ref_to_Global_Var'>DateStyle</span></a> <span class='Operator'>= </span><a href="variable.c.html#LN237"><span class='Ref_To_Local'>myextra</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>    <a href="../utils/init/globals.c.html#LN107"><span class='Ref_to_Global_Var'>DateOrder</span></a> <span class='Operator'>= </span><a href="variable.c.html#LN237"><span class='Ref_To_Local'>myextra</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * TIMEZONE 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * check_timezone: GUC check_hook for timezone 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN252"></a><span class='Declare_Function'>check_timezone</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>newval</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>**</span><span class='Declare_Parameter'>extra</span><span class='Delimiter'>, </span><a href="../../include/utils/guc.h.html#LN104"><span class='Ref_to_Typedef'>GucSource</span></a> <span class='Declare_Parameter'>source</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN254"></a>    <a href="../../timezone/pgtz.h.html#LN58"><span class='Ref_to_Struct'>pg_tz</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>new_tz</span><span class='Delimiter'>; 
</span><a name="LN255"></a>    <span class='Keyword'>long</span>        <span class='Declare_Local'>gmtoffset</span><span class='Delimiter'>; 
</span><a name="LN256"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>endptr</span><span class='Delimiter'>; 
</span><a name="LN257"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>hours</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN67"><span class='Ref_to_Func'>pg_strncasecmp</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="variable.c.html#LN252"><span class='Ref_to_Parameter'>newval</span></a><span class='Delimiter'>, </span><span class='String'>"interval"</span><span class='Delimiter'>, </span><span class='Number'>8</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Support INTERVAL 'foo'.  This is for SQL spec compliance, not 
         * because it has any actual real-world usefulness. 
         */ 
</span><a name="LN265"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>valueptr</span> <span class='Operator'>= *</span><a href="variable.c.html#LN252"><span class='Ref_to_Parameter'>newval</span></a><span class='Delimiter'>; 
</span><a name="LN266"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN267"></a>        <a href="../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>interval</span><span class='Delimiter'>; 
</span> 
        <a href="variable.c.html#LN265"><span class='Ref_To_Local'>valueptr</span></a> <span class='Operator'>+= </span><span class='Number'>8</span><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="variable.c.html#LN265"><span class='Ref_To_Local'>valueptr</span></a><span class='Parentheses'>))</span> 
            <a href="variable.c.html#LN265"><span class='Ref_To_Local'>valueptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="variable.c.html#LN265"><span class='Ref_To_Local'>valueptr</span></a><span class='Operator'>++ != </span><span class='String'>'\''</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="variable.c.html#LN266"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN265"><span class='Ref_To_Local'>valueptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Check and remove trailing quote */ 
</span>        <a href="variable.c.html#LN256"><span class='Ref_To_Local'>endptr</span></a> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><a href="variable.c.html#LN266"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='String'>'\''</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="variable.c.html#LN256"><span class='Ref_To_Local'>endptr</span></a> <span class='Operator'>|| </span><a href="variable.c.html#LN256"><span class='Ref_To_Local'>endptr</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN266"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Operator'>*</span><a href="variable.c.html#LN256"><span class='Ref_To_Local'>endptr</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Try to parse it.  XXX an invalid interval format will result in 
         * ereport(ERROR), which is not desirable for GUC.  We did what we 
         * could to guard against this in flatten_set_variable_args, but a 
         * string coming in from postgresql.conf might contain anything. 
         */ 
</span>        <a href="variable.c.html#LN267"><span class='Ref_To_Local'>interval</span></a> <span class='Operator'>= </span><a href="../../include/utils/timestamp.h.html#LN28"><span class='Ref_to_Macro'>DatumGetIntervalP</span></a><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN587"><span class='Ref_to_Macro'>DirectFunctionCall3</span></a><span class='Parentheses'>(</span><a href="../utils/adt/timestamp.c.html#LN874"><span class='Ref_to_Func'>interval_in</span></a><span class='Delimiter'>, 
</span>                                                         <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN266"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                         <a href="../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN266"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="variable.c.html#LN267"><span class='Ref_To_Local'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/guc.h.html#LN406"><span class='Ref_to_Const'>GUC_check_errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Cannot specify months in time zone interval."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN267"><span class='Ref_To_Local'>interval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="variable.c.html#LN267"><span class='Ref_To_Local'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/guc.h.html#LN406"><span class='Ref_to_Const'>GUC_check_errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Cannot specify days in time zone interval."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN267"><span class='Ref_To_Local'>interval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Here we change from SQL to Unix sign convention */ 
</span>        <a href="variable.c.html#LN255"><span class='Ref_To_Local'>gmtoffset</span></a> <span class='Operator'>= -</span><span class='Parentheses'>(</span><a href="variable.c.html#LN267"><span class='Ref_To_Local'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>/ </span><a href="../../include/datatype/timestamp.h.html#LN93"><span class='Ref_to_Const'>USECS_PER_SEC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="variable.c.html#LN254"><span class='Ref_To_Local'>new_tz</span></a> <span class='Operator'>= </span><a href="../../include/pgtime.h.html#LN77"><span class='Ref_to_Proto'>pg_tzset_offset</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN255"><span class='Ref_To_Local'>gmtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN267"><span class='Ref_To_Local'>interval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if pg_strncasecmp(*newva... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Try it as a numeric number of hours (possibly fractional). 
         */ 
</span>        <a href="variable.c.html#LN257"><span class='Ref_To_Local'>hours</span></a> <span class='Operator'>= </span>strtod<span class='Parentheses'>(</span><span class='Operator'>*</span><a href="variable.c.html#LN252"><span class='Ref_to_Parameter'>newval</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="variable.c.html#LN256"><span class='Ref_To_Local'>endptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="variable.c.html#LN256"><span class='Ref_To_Local'>endptr</span></a> <span class='Operator'>!= *</span><a href="variable.c.html#LN252"><span class='Ref_to_Parameter'>newval</span></a> <span class='Operator'>&& *</span><a href="variable.c.html#LN256"><span class='Ref_To_Local'>endptr</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Here we change from SQL to Unix sign convention */ 
</span>            <a href="variable.c.html#LN255"><span class='Ref_To_Local'>gmtoffset</span></a> <span class='Operator'>= -</span><a href="variable.c.html#LN257"><span class='Ref_To_Local'>hours</span></a> <span class='Operator'>* </span><a href="../../include/datatype/timestamp.h.html#LN86"><span class='Ref_to_Const'>SECS_PER_HOUR</span></a><span class='Delimiter'>; 
</span>            <a href="variable.c.html#LN254"><span class='Ref_To_Local'>new_tz</span></a> <span class='Operator'>= </span><a href="../../include/pgtime.h.html#LN77"><span class='Ref_to_Proto'>pg_tzset_offset</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN255"><span class='Ref_To_Local'>gmtoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Otherwise assume it is a timezone name, and try to load it. 
             */ 
</span>            <a href="variable.c.html#LN254"><span class='Ref_To_Local'>new_tz</span></a> <span class='Operator'>= </span><a href="../../include/pgtime.h.html#LN76"><span class='Ref_to_Proto'>pg_tzset</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="variable.c.html#LN252"><span class='Ref_to_Parameter'>newval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="variable.c.html#LN254"><span class='Ref_To_Local'>new_tz</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Doesn't seem to be any great value in errdetail here */ 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/pgtime.h.html#LN63"><span class='Ref_to_Proto'>pg_tz_acceptable</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN254"><span class='Ref_To_Local'>new_tz</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../include/utils/guc.h.html#LN402"><span class='Ref_to_Const'>GUC_check_errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"time zone \"%s\" appears to use leap seconds"</span><span class='Delimiter'>, 
</span>                                 <span class='Operator'>*</span><a href="variable.c.html#LN252"><span class='Ref_to_Parameter'>newval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/utils/guc.h.html#LN406"><span class='Ref_to_Const'>GUC_check_errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"PostgreSQL does not support leap seconds."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Test for failure in pg_tzset_offset, which we assume is out-of-range */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="variable.c.html#LN254"><span class='Ref_To_Local'>new_tz</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/guc.h.html#LN406"><span class='Ref_to_Const'>GUC_check_errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"UTC timezone offset is out of range."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Pass back data for assign_timezone to use 
     */ 
</span>    <span class='Operator'>*</span><a href="variable.c.html#LN252"><span class='Ref_to_Parameter'>extra</span></a> <span class='Operator'>= </span><a href="../../include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../timezone/pgtz.h.html#LN58"><span class='Ref_to_Struct'>pg_tz</span></a> <span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!*</span><a href="variable.c.html#LN252"><span class='Ref_to_Parameter'>extra</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><span class='Parentheses'>((</span><a href="../../timezone/pgtz.h.html#LN58"><span class='Ref_to_Struct'>pg_tz</span></a> <span class='Operator'>**</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="variable.c.html#LN252"><span class='Ref_to_Parameter'>extra</span></a><span class='Parentheses'>)</span> <span class='Operator'>= </span><a href="variable.c.html#LN254"><span class='Ref_To_Local'>new_tz</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end check_timezone &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * assign_timezone: GUC assign_hook for timezone 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN372"></a><span class='Declare_Function'>assign_timezone</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>newval</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>extra</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../timezone/pgtz.c.html#LN27"><span class='Ref_to_Global_Var'>session_timezone</span></a> <span class='Operator'>= *</span><span class='Parentheses'>((</span><a href="../../timezone/pgtz.h.html#LN58"><span class='Ref_to_Struct'>pg_tz</span></a> <span class='Operator'>**</span><span class='Parentheses'>) </span><a href="variable.c.html#LN372"><span class='Ref_to_Parameter'>extra</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * show_timezone: GUC show_hook for timezone 
 */ 
</span><span class='Keyword'>const char </span><span class='Operator'>* 
</span><a name="LN381"></a><span class='Declare_Function'>show_timezone</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN383"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>tzn</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Always show the zone's canonical name */ 
</span>    <a href="variable.c.html#LN383"><span class='Ref_To_Local'>tzn</span></a> <span class='Operator'>= </span><a href="../../include/pgtime.h.html#LN62"><span class='Ref_to_Proto'>pg_get_timezone_name</span></a><span class='Parentheses'>(</span><a href="../../timezone/pgtz.c.html#LN27"><span class='Ref_to_Global_Var'>session_timezone</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="variable.c.html#LN383"><span class='Ref_To_Local'>tzn</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="variable.c.html#LN383"><span class='Ref_To_Local'>tzn</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='String'>"unknown"</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * LOG_TIMEZONE 
 * 
 * For log_timezone, we don't support the interval-based methods of setting a 
 * zone, which are only there for SQL spec compliance not because they're 
 * actually useful. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * check_log_timezone: GUC check_hook for log_timezone 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN407"></a><span class='Declare_Function'>check_log_timezone</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>newval</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>**</span><span class='Declare_Parameter'>extra</span><span class='Delimiter'>, </span><a href="../../include/utils/guc.h.html#LN104"><span class='Ref_to_Typedef'>GucSource</span></a> <span class='Declare_Parameter'>source</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN409"></a>    <a href="../../timezone/pgtz.h.html#LN58"><span class='Ref_to_Struct'>pg_tz</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>new_tz</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Assume it is a timezone name, and try to load it. 
     */ 
</span>    <a href="variable.c.html#LN409"><span class='Ref_To_Local'>new_tz</span></a> <span class='Operator'>= </span><a href="../../include/pgtime.h.html#LN76"><span class='Ref_to_Proto'>pg_tzset</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="variable.c.html#LN407"><span class='Ref_to_Parameter'>newval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="variable.c.html#LN409"><span class='Ref_To_Local'>new_tz</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Doesn't seem to be any great value in errdetail here */ 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/pgtime.h.html#LN63"><span class='Ref_to_Proto'>pg_tz_acceptable</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN409"><span class='Ref_To_Local'>new_tz</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/guc.h.html#LN402"><span class='Ref_to_Const'>GUC_check_errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"time zone \"%s\" appears to use leap seconds"</span><span class='Delimiter'>, 
</span>                         <span class='Operator'>*</span><a href="variable.c.html#LN407"><span class='Ref_to_Parameter'>newval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/guc.h.html#LN406"><span class='Ref_to_Const'>GUC_check_errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"PostgreSQL does not support leap seconds."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Pass back data for assign_log_timezone to use 
     */ 
</span>    <span class='Operator'>*</span><a href="variable.c.html#LN407"><span class='Ref_to_Parameter'>extra</span></a> <span class='Operator'>= </span><a href="../../include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../timezone/pgtz.h.html#LN58"><span class='Ref_to_Struct'>pg_tz</span></a> <span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!*</span><a href="variable.c.html#LN407"><span class='Ref_to_Parameter'>extra</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><span class='Parentheses'>((</span><a href="../../timezone/pgtz.h.html#LN58"><span class='Ref_to_Struct'>pg_tz</span></a> <span class='Operator'>**</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="variable.c.html#LN407"><span class='Ref_to_Parameter'>extra</span></a><span class='Parentheses'>)</span> <span class='Operator'>= </span><a href="variable.c.html#LN409"><span class='Ref_To_Local'>new_tz</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end check_log_timezone &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * assign_log_timezone: GUC assign_hook for log_timezone 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN445"></a><span class='Declare_Function'>assign_log_timezone</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>newval</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>extra</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../timezone/pgtz.c.html#LN30"><span class='Ref_to_Global_Var'>log_timezone</span></a> <span class='Operator'>= *</span><span class='Parentheses'>((</span><a href="../../timezone/pgtz.h.html#LN58"><span class='Ref_to_Struct'>pg_tz</span></a> <span class='Operator'>**</span><span class='Parentheses'>) </span><a href="variable.c.html#LN445"><span class='Ref_to_Parameter'>extra</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * show_log_timezone: GUC show_hook for log_timezone 
 */ 
</span><span class='Keyword'>const char </span><span class='Operator'>* 
</span><a name="LN454"></a><span class='Declare_Function'>show_log_timezone</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN456"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>tzn</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Always show the zone's canonical name */ 
</span>    <a href="variable.c.html#LN456"><span class='Ref_To_Local'>tzn</span></a> <span class='Operator'>= </span><a href="../../include/pgtime.h.html#LN62"><span class='Ref_to_Proto'>pg_get_timezone_name</span></a><span class='Parentheses'>(</span><a href="../../timezone/pgtz.c.html#LN30"><span class='Ref_to_Global_Var'>log_timezone</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="variable.c.html#LN456"><span class='Ref_To_Local'>tzn</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="variable.c.html#LN456"><span class='Ref_To_Local'>tzn</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='String'>"unknown"</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * SET TRANSACTION READ ONLY and SET TRANSACTION READ WRITE 
 * 
 * We allow idempotent changes (r/w -&GT; r/w and r/o -&GT; r/o) at any time, and 
 * we also always allow changes from read-write to read-only.  However, 
 * read-only may be changed to read-write only when in a top-level transaction 
 * that has not yet taken an initial snapshot.  Can't do it in a hot standby 
 * slave, either. 
 * 
 * If we are not in a transaction at all, just allow the change; it means 
 * nothing since XactReadOnly will be reset by the next StartTransaction(). 
 * The IsTransactionState() test protects us against trying to check 
 * RecoveryInProgress() in contexts where shared memory is not accessible. 
 * (Similarly, if we're restoring state in a parallel worker, just allow 
 * the change.) 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN485"></a><span class='Declare_Function'>check_transaction_read_only</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>newval</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>**</span><span class='Declare_Parameter'>extra</span><span class='Delimiter'>, </span><a href="../../include/utils/guc.h.html#LN104"><span class='Ref_to_Typedef'>GucSource</span></a> <span class='Declare_Parameter'>source</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="variable.c.html#LN485"><span class='Ref_to_Parameter'>newval</span></a> <span class='Operator'>== </span><span class='Boolean'>false </span><span class='Operator'>&& </span><a href="../access/transam/xact.c.html#LN76"><span class='Ref_to_Global_Var'>XactReadOnly</span></a> <span class='Operator'>&& </span><a href="../../include/access/xact.h.html#LN329"><span class='Ref_to_Proto'>IsTransactionState</span></a><span class='Parentheses'>() </span><span class='Operator'>&& !</span><a href="../access/transam/parallel.c.html#LN99"><span class='Ref_to_Global_Var'>InitializingParallelWorker</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Can't go to r/w mode inside a r/o transaction */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/xact.h.html#LN361"><span class='Ref_to_Proto'>IsSubTransaction</span></a><span class='Parentheses'>())</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/guc.h.html#LN400"><span class='Ref_to_Proto'>GUC_check_errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ACTIVE_SQL_TRANSACTION<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/guc.h.html#LN402"><span class='Ref_to_Const'>GUC_check_errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot set transaction read-write mode inside a read-only transaction"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* Top level transaction can't change to r/w after first snapshot. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/time/snapmgr.c.html#LN202"><span class='Ref_to_Global_Var'>FirstSnapshotSet</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/guc.h.html#LN400"><span class='Ref_to_Proto'>GUC_check_errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ACTIVE_SQL_TRANSACTION<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/guc.h.html#LN402"><span class='Ref_to_Const'>GUC_check_errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"transaction read-write mode must be set before any query"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* Can't go to r/w mode while recovery is still active */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/xlog.h.html#LN242"><span class='Ref_to_Proto'>RecoveryInProgress</span></a><span class='Parentheses'>())</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/guc.h.html#LN400"><span class='Ref_to_Proto'>GUC_check_errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/guc.h.html#LN402"><span class='Ref_to_Const'>GUC_check_errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot set transaction read-write mode during recovery"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if *newval==false&&XactR... &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end check_transaction_read_only &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * SET TRANSACTION ISOLATION LEVEL 
 * 
 * We allow idempotent changes at any time, but otherwise this can only be 
 * changed in a toplevel transaction that has not yet taken a snapshot. 
 * 
 * As in check_transaction_read_only, allow it if not inside a transaction. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN524"></a><span class='Declare_Function'>check_XactIsoLevel</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>newval</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>**</span><span class='Declare_Parameter'>extra</span><span class='Delimiter'>, </span><a href="../../include/utils/guc.h.html#LN104"><span class='Ref_to_Typedef'>GucSource</span></a> <span class='Declare_Parameter'>source</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN526"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>newXactIsoLevel</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><span class='Operator'>*</span><a href="variable.c.html#LN524"><span class='Ref_to_Parameter'>newval</span></a><span class='Delimiter'>, </span><span class='String'>"serializable"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="variable.c.html#LN526"><span class='Ref_To_Local'>newXactIsoLevel</span></a> <span class='Operator'>= </span><a href="../../include/access/xact.h.html#LN30"><span class='Ref_to_Const'>XACT_SERIALIZABLE</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><span class='Operator'>*</span><a href="variable.c.html#LN524"><span class='Ref_to_Parameter'>newval</span></a><span class='Delimiter'>, </span><span class='String'>"repeatable read"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="variable.c.html#LN526"><span class='Ref_To_Local'>newXactIsoLevel</span></a> <span class='Operator'>= </span><a href="../../include/access/xact.h.html#LN29"><span class='Ref_to_Const'>XACT_REPEATABLE_READ</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><span class='Operator'>*</span><a href="variable.c.html#LN524"><span class='Ref_to_Parameter'>newval</span></a><span class='Delimiter'>, </span><span class='String'>"read committed"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="variable.c.html#LN526"><span class='Ref_To_Local'>newXactIsoLevel</span></a> <span class='Operator'>= </span><a href="../../include/access/xact.h.html#LN28"><span class='Ref_to_Const'>XACT_READ_COMMITTED</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><span class='Operator'>*</span><a href="variable.c.html#LN524"><span class='Ref_to_Parameter'>newval</span></a><span class='Delimiter'>, </span><span class='String'>"read uncommitted"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="variable.c.html#LN526"><span class='Ref_To_Local'>newXactIsoLevel</span></a> <span class='Operator'>= </span><a href="../../include/access/xact.h.html#LN27"><span class='Ref_to_Const'>XACT_READ_UNCOMMITTED</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><span class='Operator'>*</span><a href="variable.c.html#LN524"><span class='Ref_to_Parameter'>newval</span></a><span class='Delimiter'>, </span><span class='String'>"default"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="variable.c.html#LN526"><span class='Ref_To_Local'>newXactIsoLevel</span></a> <span class='Operator'>= </span><a href="../access/transam/xact.c.html#LN72"><span class='Ref_to_Global_Var'>DefaultXactIsoLevel</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="variable.c.html#LN526"><span class='Ref_To_Local'>newXactIsoLevel</span></a> <span class='Operator'>!= </span><a href="../access/transam/xact.c.html#LN73"><span class='Ref_to_Global_Var'>XactIsoLevel</span></a> <span class='Operator'>&& </span><a href="../../include/access/xact.h.html#LN329"><span class='Ref_to_Proto'>IsTransactionState</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/time/snapmgr.c.html#LN202"><span class='Ref_to_Global_Var'>FirstSnapshotSet</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/guc.h.html#LN400"><span class='Ref_to_Proto'>GUC_check_errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ACTIVE_SQL_TRANSACTION<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/guc.h.html#LN402"><span class='Ref_to_Const'>GUC_check_errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"SET TRANSACTION ISOLATION LEVEL must be called before any query"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* We ignore a subtransaction setting it to the existing value. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/xact.h.html#LN361"><span class='Ref_to_Proto'>IsSubTransaction</span></a><span class='Parentheses'>())</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/guc.h.html#LN400"><span class='Ref_to_Proto'>GUC_check_errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ACTIVE_SQL_TRANSACTION<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/guc.h.html#LN402"><span class='Ref_to_Const'>GUC_check_errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"SET TRANSACTION ISOLATION LEVEL must not be called in a subtransaction"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* Can't go to serializable mode while recovery is still active */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="variable.c.html#LN526"><span class='Ref_To_Local'>newXactIsoLevel</span></a> <span class='Operator'>== </span><a href="../../include/access/xact.h.html#LN30"><span class='Ref_to_Const'>XACT_SERIALIZABLE</span></a> <span class='Operator'>&& </span><a href="../../include/access/xlog.h.html#LN242"><span class='Ref_to_Proto'>RecoveryInProgress</span></a><span class='Parentheses'>())</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/guc.h.html#LN400"><span class='Ref_to_Proto'>GUC_check_errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/guc.h.html#LN402"><span class='Ref_to_Const'>GUC_check_errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot use serializable mode in a hot standby"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/guc.h.html#LN410"><span class='Ref_to_Const'>GUC_check_errhint</span></a><span class='Parentheses'>(</span><span class='String'>"You can use REPEATABLE READ instead."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if newXactIsoLevel!=Xact... &raquo; </span> 
 
    <span class='Operator'>*</span><a href="variable.c.html#LN524"><span class='Ref_to_Parameter'>extra</span></a> <span class='Operator'>= </span><a href="../../include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!*</span><a href="variable.c.html#LN524"><span class='Ref_to_Parameter'>extra</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><span class='Parentheses'>((</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="variable.c.html#LN524"><span class='Ref_to_Parameter'>extra</span></a><span class='Parentheses'>)</span> <span class='Operator'>= </span><a href="variable.c.html#LN526"><span class='Ref_To_Local'>newXactIsoLevel</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end check_XactIsoLevel &raquo; </span> 
 
<span class='Keyword'>void 
</span><a name="LN585"></a><span class='Declare_Function'>assign_XactIsoLevel</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>newval</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>extra</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../access/transam/xact.c.html#LN73"><span class='Ref_to_Global_Var'>XactIsoLevel</span></a> <span class='Operator'>= *</span><span class='Parentheses'>((</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="variable.c.html#LN585"><span class='Ref_to_Parameter'>extra</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>const char </span><span class='Operator'>* 
</span><a name="LN591"></a><span class='Declare_Function'>show_XactIsoLevel</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* We need this because we don't want to show "default". */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="../access/transam/xact.c.html#LN73"><span class='Ref_to_Global_Var'>XactIsoLevel</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/access/xact.h.html#LN27"><span class='Ref_to_Const'>XACT_READ_UNCOMMITTED</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"read uncommitted"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/access/xact.h.html#LN28"><span class='Ref_to_Const'>XACT_READ_COMMITTED</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"read committed"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/access/xact.h.html#LN29"><span class='Ref_to_Const'>XACT_REPEATABLE_READ</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"repeatable read"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/access/xact.h.html#LN30"><span class='Ref_to_Const'>XACT_SERIALIZABLE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"serializable"</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"bogus"</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * SET TRANSACTION [NOT] DEFERRABLE 
 */ 
</span> 
<span class='Keyword'>bool 
</span><a name="LN614"></a><span class='Declare_Function'>check_transaction_deferrable</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>newval</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>**</span><span class='Declare_Parameter'>extra</span><span class='Delimiter'>, </span><a href="../../include/utils/guc.h.html#LN104"><span class='Ref_to_Typedef'>GucSource</span></a> <span class='Declare_Parameter'>source</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/xact.h.html#LN361"><span class='Ref_to_Proto'>IsSubTransaction</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/guc.h.html#LN400"><span class='Ref_to_Proto'>GUC_check_errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ACTIVE_SQL_TRANSACTION<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/guc.h.html#LN402"><span class='Ref_to_Const'>GUC_check_errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"SET TRANSACTION [NOT] DEFERRABLE cannot be called within a subtransaction"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/time/snapmgr.c.html#LN202"><span class='Ref_to_Global_Var'>FirstSnapshotSet</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/guc.h.html#LN400"><span class='Ref_to_Proto'>GUC_check_errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ACTIVE_SQL_TRANSACTION<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/guc.h.html#LN402"><span class='Ref_to_Const'>GUC_check_errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"SET TRANSACTION [NOT] DEFERRABLE must be called before any query"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Random number seed 
 * 
 * We can't roll back the random sequence on error, and we don't want 
 * config file reloads to affect it, so we only want interactive SET SEED 
 * commands to set it.  We use the "extra" storage to ensure that rollbacks 
 * don't try to do the operation again. 
 */ 
</span> 
<span class='Keyword'>bool 
</span><a name="LN642"></a><span class='Declare_Function'>check_random_seed</span><span class='Parentheses'>(</span><span class='Keyword'>double </span><span class='Operator'>*</span><span class='Declare_Parameter'>newval</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>**</span><span class='Declare_Parameter'>extra</span><span class='Delimiter'>, </span><a href="../../include/utils/guc.h.html#LN104"><span class='Ref_to_Typedef'>GucSource</span></a> <span class='Declare_Parameter'>source</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Operator'>*</span><a href="variable.c.html#LN642"><span class='Ref_to_Parameter'>extra</span></a> <span class='Operator'>= </span><a href="../../include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!*</span><a href="variable.c.html#LN642"><span class='Ref_to_Parameter'>extra</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Arm the assign only if source of value is an interactive SET */ 
</span>    <span class='Operator'>*</span><span class='Parentheses'>((</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="variable.c.html#LN642"><span class='Ref_to_Parameter'>extra</span></a><span class='Parentheses'>)</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="variable.c.html#LN642"><span class='Ref_to_Parameter'>source</span></a> <span class='Operator'>&GT;= </span><a href="../../include/utils/guc.h.html#LN117"><span class='Ref_to_EnumConst'>PGC_S_INTERACTIVE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>void 
</span><a name="LN654"></a><span class='Declare_Function'>assign_random_seed</span><span class='Parentheses'>(</span><span class='Keyword'>double </span><span class='Declare_Parameter'>newval</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>extra</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* We'll do this at most once for any setting of the GUC variable */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>((</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="variable.c.html#LN654"><span class='Ref_to_Parameter'>extra</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../utils/adt/float.c.html#LN2429"><span class='Ref_to_Func'>setseed</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN745"><span class='Ref_to_Func'>Float8GetDatum</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN654"><span class='Ref_to_Parameter'>newval</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><span class='Parentheses'>((</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="variable.c.html#LN654"><span class='Ref_to_Parameter'>extra</span></a><span class='Parentheses'>)</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>const char </span><span class='Operator'>* 
</span><a name="LN663"></a><span class='Declare_Function'>show_random_seed</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <span class='String'>"unavailable"</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * SET CLIENT_ENCODING 
 */ 
</span> 
<span class='Keyword'>bool 
</span><a name="LN674"></a><span class='Declare_Function'>check_client_encoding</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>newval</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>**</span><span class='Declare_Parameter'>extra</span><span class='Delimiter'>, </span><a href="../../include/utils/guc.h.html#LN104"><span class='Ref_to_Typedef'>GucSource</span></a> <span class='Declare_Parameter'>source</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN676"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>encoding</span><span class='Delimiter'>; 
</span><a name="LN677"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>canonical_name</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Look up the encoding by name */ 
</span>    <a href="variable.c.html#LN676"><span class='Ref_To_Local'>encoding</span></a> <span class='Operator'>= </span><a href="../utils/mb/encnames.c.html#LN485"><span class='Ref_to_Func'>pg_valid_client_encoding</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="variable.c.html#LN674"><span class='Ref_to_Parameter'>newval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="variable.c.html#LN676"><span class='Ref_To_Local'>encoding</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get the canonical name (no aliases, uniform case) */ 
</span>    <a href="variable.c.html#LN677"><span class='Ref_To_Local'>canonical_name</span></a> <span class='Operator'>= </span><a href="../../include/mb/pg_wchar.h.html#LN502"><span class='Ref_to_Proto'>pg_encoding_to_char</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN676"><span class='Ref_To_Local'>encoding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we are not within a transaction then PrepareClientEncoding will not 
     * be able to look up the necessary conversion procs.  If we are still 
     * starting up, it will return "OK" anyway, and InitializeClientEncoding 
     * will fix things once initialization is far enough along.  After 
     * startup, we'll fail.  This would only happen if someone tries to change 
     * client_encoding in postgresql.conf and then SIGHUP existing sessions. 
     * It seems like a bad idea for client_encoding to change that way anyhow, 
     * so we don't go out of our way to support it. 
     * 
     * Note: in the postmaster, or any other process that never calls 
     * InitializeClientEncoding, PrepareClientEncoding will always succeed, 
     * and so will SetClientEncoding; but they won't do anything, which is OK. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/mb/mbutils.c.html#LN112"><span class='Ref_to_Func'>PrepareClientEncoding</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN676"><span class='Ref_To_Local'>encoding</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/xact.h.html#LN329"><span class='Ref_to_Proto'>IsTransactionState</span></a><span class='Parentheses'>())</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Must be a genuine no-such-conversion problem */ 
</span>            <a href="../../include/utils/guc.h.html#LN400"><span class='Ref_to_Proto'>GUC_check_errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/guc.h.html#LN406"><span class='Ref_to_Const'>GUC_check_errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Conversion between %s and %s is not supported."</span><span class='Delimiter'>, 
</span>                                <a href="variable.c.html#LN677"><span class='Ref_To_Local'>canonical_name</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/mb/pg_wchar.h.html#LN546"><span class='Ref_to_Proto'>GetDatabaseEncodingName</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Provide a useful complaint */ 
</span>            <a href="../../include/utils/guc.h.html#LN406"><span class='Ref_to_Const'>GUC_check_errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Cannot change \"client_encoding\" now."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Replace the user-supplied string with the encoding's canonical name. 
     * This gets rid of aliases and case-folding variations. 
     * 
     * XXX Although canonicalizing seems like a good idea in the abstract, it 
     * breaks pre-9.1 JDBC drivers, which expect that if they send "UNICODE" 
     * as the client_encoding setting then it will read back the same way. As 
     * a workaround, don't replace the string if it's "UNICODE".  Remove that 
     * hack when pre-9.1 JDBC drivers are no longer in use. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><span class='Operator'>*</span><a href="variable.c.html#LN674"><span class='Ref_to_Parameter'>newval</span></a><span class='Delimiter'>, </span><a href="variable.c.html#LN677"><span class='Ref_To_Local'>canonical_name</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>        strcmp<span class='Parentheses'>(</span><span class='Operator'>*</span><a href="variable.c.html#LN674"><span class='Ref_to_Parameter'>newval</span></a><span class='Delimiter'>, </span><span class='String'>"UNICODE"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="variable.c.html#LN674"><span class='Ref_to_Parameter'>newval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="variable.c.html#LN674"><span class='Ref_to_Parameter'>newval</span></a> <span class='Operator'>= </span>strdup<span class='Parentheses'>(</span><a href="variable.c.html#LN677"><span class='Ref_To_Local'>canonical_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!*</span><a href="variable.c.html#LN674"><span class='Ref_to_Parameter'>newval</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Save the encoding's ID in *extra, for use by assign_client_encoding. 
     */ 
</span>    <span class='Operator'>*</span><a href="variable.c.html#LN674"><span class='Ref_to_Parameter'>extra</span></a> <span class='Operator'>= </span><a href="../../include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!*</span><a href="variable.c.html#LN674"><span class='Ref_to_Parameter'>extra</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><span class='Parentheses'>((</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="variable.c.html#LN674"><span class='Ref_to_Parameter'>extra</span></a><span class='Parentheses'>)</span> <span class='Operator'>= </span><a href="variable.c.html#LN676"><span class='Ref_To_Local'>encoding</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end check_client_encoding &raquo; </span> 
 
<span class='Keyword'>void 
</span><a name="LN750"></a><span class='Declare_Function'>assign_client_encoding</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>newval</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>extra</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN752"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>encoding</span> <span class='Operator'>= *</span><span class='Parentheses'>((</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="variable.c.html#LN750"><span class='Ref_to_Parameter'>extra</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Parallel workers send data to the leader, not the client.  They always 
     * send data using the database encoding. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/parallel.h.html#LN51"><span class='Ref_to_Macro'>IsParallelWorker</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * During parallel worker startup, we want to accept the leader's 
         * client_encoding setting so that anyone who looks at the value in 
         * the worker sees the same value that they would see in the leader. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../access/transam/parallel.c.html#LN99"><span class='Ref_to_Global_Var'>InitializingParallelWorker</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * A change other than during startup, for example due to a SET clause 
         * attached to a function definition, should be rejected, as there is 
         * nothing we can do inside the worker to make it take effect. 
         */ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TRANSACTION_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot change client_encoding during a parallel operation"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* We do not expect an error if PrepareClientEncoding succeeded */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/mb/mbutils.c.html#LN210"><span class='Ref_to_Func'>SetClientEncoding</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN752"><span class='Ref_To_Local'>encoding</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, </span><span class='String'>"SetClientEncoding(%d) failed"</span><span class='Delimiter'>, </span><a href="variable.c.html#LN752"><span class='Ref_To_Local'>encoding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end assign_client_encoding &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * SET SESSION AUTHORIZATION 
 */ 
</span> 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* This is the "extra" state for both SESSION AUTHORIZATION and ROLE */ 
</span><a name="LN791"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>roleid</span><span class='Delimiter'>; 
</span><a name="LN792"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>is_superuser</span><span class='Delimiter'>; 
</span><a name="LN793"></a>} <span class='Declare_Typedef'>role_auth_extra</span><span class='Delimiter'>; 
</span> 
<span class='Keyword'>bool 
</span><a name="LN796"></a><span class='Declare_Function'>check_session_authorization</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>newval</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>**</span><span class='Declare_Parameter'>extra</span><span class='Delimiter'>, </span><a href="../../include/utils/guc.h.html#LN104"><span class='Ref_to_Typedef'>GucSource</span></a> <span class='Declare_Parameter'>source</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN798"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>roleTup</span><span class='Delimiter'>; 
</span><a name="LN799"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN800"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_superuser</span><span class='Delimiter'>; 
</span><a name="LN801"></a>    <a href="variable.c.html#LN788"><span class='Ref_to_Typedef'>role_auth_extra</span></a> <span class='Operator'>*</span><span class='Declare_Local'>myextra</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Do nothing for the boot_val default of NULL */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="variable.c.html#LN796"><span class='Ref_to_Parameter'>newval</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/xact.h.html#LN329"><span class='Ref_to_Proto'>IsTransactionState</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Can't do catalog lookups, so fail.  The result of this is that 
         * session_authorization cannot be set in postgresql.conf, which seems 
         * like a good thing anyway, so we don't work hard to avoid it. 
         */ 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Look up the username */ 
</span>    <a href="variable.c.html#LN798"><span class='Ref_To_Local'>roleTup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN43"><span class='Ref_to_EnumConst'>AUTHNAME</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="variable.c.html#LN796"><span class='Ref_to_Parameter'>newval</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN798"><span class='Ref_To_Local'>roleTup</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/guc.h.html#LN402"><span class='Ref_to_Const'>GUC_check_errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"role \"%s\" does not exist"</span><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="variable.c.html#LN796"><span class='Ref_to_Parameter'>newval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="variable.c.html#LN799"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN798"><span class='Ref_To_Local'>roleTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="variable.c.html#LN800"><span class='Ref_To_Local'>is_superuser</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_authid.h.html#LN71"><span class='Ref_to_Typedef'>Form_pg_authid</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN798"><span class='Ref_To_Local'>roleTup</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>rolsuper<span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN798"><span class='Ref_To_Local'>roleTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Set up "extra" struct for assign_session_authorization to use */ 
</span>    <a href="variable.c.html#LN801"><span class='Ref_To_Local'>myextra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="variable.c.html#LN788"><span class='Ref_to_Typedef'>role_auth_extra</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="variable.c.html#LN788"><span class='Ref_to_Typedef'>role_auth_extra</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="variable.c.html#LN801"><span class='Ref_To_Local'>myextra</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="variable.c.html#LN801"><span class='Ref_To_Local'>myextra</span></a><span class='Operator'>-&GT;</span><a href="variable.c.html#LN791"><span class='Ref_to_Member'>roleid</span></a> <span class='Operator'>= </span><a href="variable.c.html#LN799"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>; 
</span>    <a href="variable.c.html#LN801"><span class='Ref_To_Local'>myextra</span></a><span class='Operator'>-&GT;</span><a href="variable.c.html#LN792"><span class='Ref_to_Member'>is_superuser</span></a> <span class='Operator'>= </span><a href="variable.c.html#LN800"><span class='Ref_To_Local'>is_superuser</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="variable.c.html#LN796"><span class='Ref_to_Parameter'>extra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="variable.c.html#LN801"><span class='Ref_To_Local'>myextra</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end check_session_authorization &raquo; </span> 
 
<span class='Keyword'>void 
</span><a name="LN842"></a><span class='Declare_Function'>assign_session_authorization</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>newval</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>extra</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN844"></a>    <a href="variable.c.html#LN788"><span class='Ref_to_Typedef'>role_auth_extra</span></a> <span class='Operator'>*</span><span class='Declare_Local'>myextra</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="variable.c.html#LN788"><span class='Ref_to_Typedef'>role_auth_extra</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="variable.c.html#LN842"><span class='Ref_to_Parameter'>extra</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Do nothing for the boot_val default of NULL */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="variable.c.html#LN844"><span class='Ref_To_Local'>myextra</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/miscadmin.h.html#LN321"><span class='Ref_to_Proto'>SetSessionAuthorization</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN844"><span class='Ref_To_Local'>myextra</span></a><span class='Operator'>-&GT;</span><a href="variable.c.html#LN791"><span class='Ref_to_Member'>roleid</span></a><span class='Delimiter'>, </span><a href="variable.c.html#LN844"><span class='Ref_To_Local'>myextra</span></a><span class='Operator'>-&GT;</span><a href="variable.c.html#LN792"><span class='Ref_to_Member'>is_superuser</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * SET ROLE 
 * 
 * The SQL spec requires "SET ROLE NONE" to unset the role, so we hardwire 
 * a translation of "none" to InvalidOid.  Otherwise this is much like 
 * SET SESSION AUTHORIZATION. 
 */ 
</span><a name="LN861"></a><span class='Keyword'>extern char </span><span class='Operator'>*</span><span class='Declare_Var'>role_string</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* in guc.c */ 
</span> 
<span class='Keyword'>bool 
</span><a name="LN864"></a><span class='Declare_Function'>check_role</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>newval</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>**</span><span class='Declare_Parameter'>extra</span><span class='Delimiter'>, </span><a href="../../include/utils/guc.h.html#LN104"><span class='Ref_to_Typedef'>GucSource</span></a> <span class='Declare_Parameter'>source</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN866"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>roleTup</span><span class='Delimiter'>; 
</span><a name="LN867"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>roleid</span><span class='Delimiter'>; 
</span><a name="LN868"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_superuser</span><span class='Delimiter'>; 
</span><a name="LN869"></a>    <a href="variable.c.html#LN788"><span class='Ref_to_Typedef'>role_auth_extra</span></a> <span class='Operator'>*</span><span class='Declare_Local'>myextra</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><span class='Operator'>*</span><a href="variable.c.html#LN864"><span class='Ref_to_Parameter'>newval</span></a><span class='Delimiter'>, </span><span class='String'>"none"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* hardwired translation */ 
</span>        <a href="variable.c.html#LN867"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="variable.c.html#LN868"><span class='Ref_To_Local'>is_superuser</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/xact.h.html#LN329"><span class='Ref_to_Proto'>IsTransactionState</span></a><span class='Parentheses'>())</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Can't do catalog lookups, so fail.  The result of this is that 
             * role cannot be set in postgresql.conf, which seems like a good 
             * thing anyway, so we don't work hard to avoid it. 
             */ 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Look up the username */ 
</span>        <a href="variable.c.html#LN866"><span class='Ref_To_Local'>roleTup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN43"><span class='Ref_to_EnumConst'>AUTHNAME</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="variable.c.html#LN864"><span class='Ref_to_Parameter'>newval</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN866"><span class='Ref_To_Local'>roleTup</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/guc.h.html#LN402"><span class='Ref_to_Const'>GUC_check_errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"role \"%s\" does not exist"</span><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="variable.c.html#LN864"><span class='Ref_to_Parameter'>newval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="variable.c.html#LN867"><span class='Ref_To_Local'>roleid</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN866"><span class='Ref_To_Local'>roleTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="variable.c.html#LN868"><span class='Ref_To_Local'>is_superuser</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_authid.h.html#LN71"><span class='Ref_to_Typedef'>Form_pg_authid</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN866"><span class='Ref_To_Local'>roleTup</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>rolsuper<span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN866"><span class='Ref_To_Local'>roleTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Verify that session user is allowed to become this role, but skip 
         * this in parallel mode, where we must blindly recreate the parallel 
         * leader's state. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../access/transam/parallel.c.html#LN99"><span class='Ref_to_Global_Var'>InitializingParallelWorker</span></a> <span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN230"><span class='Ref_to_Proto'>is_member_of_role</span></a><span class='Parentheses'>(</span><a href="../../include/miscadmin.h.html#LN310"><span class='Ref_to_Proto'>GetSessionUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="variable.c.html#LN867"><span class='Ref_To_Local'>roleid</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/guc.h.html#LN400"><span class='Ref_to_Proto'>GUC_check_errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/guc.h.html#LN402"><span class='Ref_to_Const'>GUC_check_errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied to set role \"%s\""</span><span class='Delimiter'>, 
</span>                             <span class='Operator'>*</span><a href="variable.c.html#LN864"><span class='Ref_to_Parameter'>newval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Set up "extra" struct for assign_role to use */ 
</span>    <a href="variable.c.html#LN869"><span class='Ref_To_Local'>myextra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="variable.c.html#LN788"><span class='Ref_to_Typedef'>role_auth_extra</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="variable.c.html#LN788"><span class='Ref_to_Typedef'>role_auth_extra</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="variable.c.html#LN869"><span class='Ref_To_Local'>myextra</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="variable.c.html#LN869"><span class='Ref_To_Local'>myextra</span></a><span class='Operator'>-&GT;</span><a href="variable.c.html#LN791"><span class='Ref_to_Member'>roleid</span></a> <span class='Operator'>= </span><a href="variable.c.html#LN867"><span class='Ref_To_Local'>roleid</span></a><span class='Delimiter'>; 
</span>    <a href="variable.c.html#LN869"><span class='Ref_To_Local'>myextra</span></a><span class='Operator'>-&GT;</span><a href="variable.c.html#LN792"><span class='Ref_to_Member'>is_superuser</span></a> <span class='Operator'>= </span><a href="variable.c.html#LN868"><span class='Ref_To_Local'>is_superuser</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="variable.c.html#LN864"><span class='Ref_to_Parameter'>extra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="variable.c.html#LN869"><span class='Ref_To_Local'>myextra</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end check_role &raquo; </span> 
 
<span class='Keyword'>void 
</span><a name="LN929"></a><span class='Declare_Function'>assign_role</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>newval</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>extra</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN931"></a>    <a href="variable.c.html#LN788"><span class='Ref_to_Typedef'>role_auth_extra</span></a> <span class='Operator'>*</span><span class='Declare_Local'>myextra</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="variable.c.html#LN788"><span class='Ref_to_Typedef'>role_auth_extra</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="variable.c.html#LN929"><span class='Ref_to_Parameter'>extra</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/miscadmin.h.html#LN323"><span class='Ref_to_Proto'>SetCurrentRoleId</span></a><span class='Parentheses'>(</span><a href="variable.c.html#LN931"><span class='Ref_To_Local'>myextra</span></a><span class='Operator'>-&GT;</span><a href="variable.c.html#LN791"><span class='Ref_to_Member'>roleid</span></a><span class='Delimiter'>, </span><a href="variable.c.html#LN931"><span class='Ref_To_Local'>myextra</span></a><span class='Operator'>-&GT;</span><a href="variable.c.html#LN792"><span class='Ref_to_Member'>is_superuser</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>const char </span><span class='Operator'>* 
</span><a name="LN937"></a><span class='Declare_Function'>show_role</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * Check whether SET ROLE is active; if not return "none".  This is a 
     * kluge to deal with the fact that SET SESSION AUTHORIZATION logically 
     * resets SET ROLE to NONE, but we cannot set the GUC role variable from 
     * assign_session_authorization (because we haven't got enough info to 
     * call set_config_option). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="../../include/miscadmin.h.html#LN322"><span class='Ref_to_Proto'>GetCurrentRoleId</span></a><span class='Parentheses'>()))</span> 
        <span class='Control'>return</span> <span class='String'>"none"</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Otherwise we can just use the GUC string */ 
</span>    <span class='Control'>return</span> <a href="../utils/misc/guc.c.html#LN521"><span class='Ref_to_Global_Var'>role_string</span></a> <span class='Operator'>? </span><a href="../utils/misc/guc.c.html#LN521"><span class='Ref_to_Global_Var'>role_string</span></a> <span class='Operator'>: </span><span class='String'>"none"</span><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>