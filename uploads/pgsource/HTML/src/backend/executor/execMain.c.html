<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\executor\execMain.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\executor\execMain.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:38 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * execMain.c 
 *    top level executor interface routines 
 * 
 * INTERFACE ROUTINES 
 *  ExecutorStart() 
 *  ExecutorRun() 
 *  ExecutorFinish() 
 *  ExecutorEnd() 
 * 
 *  These four procedures are the external interface to the executor. 
 *  In each case, the query descriptor is required as an argument. 
 * 
 *  ExecutorStart must be called at the beginning of execution of any 
 *  query plan and ExecutorEnd must always be called at the end of 
 *  execution of a plan (unless it is aborted due to error). 
 * 
 *  ExecutorRun accepts direction and count arguments that specify whether 
 *  the plan is to be executed forwards, backwards, and for how many tuples. 
 *  In some cases ExecutorRun may be called multiple times to process all 
 *  the tuples for a plan.  It is also acceptable to stop short of executing 
 *  the whole plan (but only if it is a SELECT). 
 * 
 *  ExecutorFinish must be called after the final ExecutorRun call and 
 *  before ExecutorEnd.  This can be omitted only in case of EXPLAIN, 
 *  which should also omit ExecutorRun. 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/executor/execMain.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/sysattr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/transam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xact.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/namespace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/partition.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_publication.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/matview.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/trigger.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"executor/execdebug.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"foreign/fdwapi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"mb/pg_wchar.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/clauses.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parsetree.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"rewrite/rewriteManip.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/bufmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/lmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"tcop/utility.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/acl.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rls.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/ruleutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/snapmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/tqual.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* Hooks for plugins to get control in ExecutorStart/Run/Finish/End */ 
</span><a name="LN68"></a><a href="../../include/executor/executor.h.html#LN68"><span class='Ref_to_Typedef'>ExecutorStart_hook_type</span></a> <span class='Declare_Var'>ExecutorStart_hook</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN69"></a><a href="../../include/executor/executor.h.html#LN72"><span class='Ref_to_Typedef'>ExecutorRun_hook_type</span></a> <span class='Declare_Var'>ExecutorRun_hook</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN70"></a><a href="../../include/executor/executor.h.html#LN79"><span class='Ref_to_Typedef'>ExecutorFinish_hook_type</span></a> <span class='Declare_Var'>ExecutorFinish_hook</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN71"></a><a href="../../include/executor/executor.h.html#LN83"><span class='Ref_to_Typedef'>ExecutorEnd_hook_type</span></a> <span class='Declare_Var'>ExecutorEnd_hook</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* Hook for plugin to get control in ExecCheckRTPerms() */ 
</span><a name="LN74"></a><a href="../../include/executor/executor.h.html#LN87"><span class='Ref_to_Typedef'>ExecutorCheckPerms_hook_type</span></a> <span class='Declare_Var'>ExecutorCheckPerms_hook</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* decls for local routines only used within this module */ 
</span><a name="LN77"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>InitPlan</span><span class='Parentheses'>(</span><a href="../../include/executor/execdesc.h.html#LN32"><span class='Ref_to_Struct'>QueryDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>queryDesc</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>eflags</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN78"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>CheckValidRowMarkRel</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/nodes/plannodes.h.html#LN951"><span class='Ref_to_Enum'>RowMarkType</span></a> <span class='Declare_Parameter'>markType</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN79"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ExecPostprocessPlan</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN80"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ExecEndPlan</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>planstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN81"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ExecutePlan</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>planstate</span><span class='Delimiter'>, 
</span><a name="LN82"></a>            <span class='Keyword'>bool </span><span class='Declare_Parameter'>use_parallel_mode</span><span class='Delimiter'>, 
</span><a name="LN83"></a>            <a href="../../include/nodes/nodes.h.html#LN647"><span class='Ref_to_Enum'>CmdType</span></a> <span class='Declare_Parameter'>operation</span><span class='Delimiter'>, 
</span><a name="LN84"></a>            <span class='Keyword'>bool </span><span class='Declare_Parameter'>sendTuples</span><span class='Delimiter'>, 
</span><a name="LN85"></a>            <a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Parameter'>numberTuples</span><span class='Delimiter'>, 
</span><a name="LN86"></a>            <a href="../../include/access/sdir.h.html#LN21"><span class='Ref_to_Enum'>ScanDirection</span></a> <span class='Declare_Parameter'>direction</span><span class='Delimiter'>, 
</span><a name="LN87"></a>            <a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dest</span><span class='Delimiter'>, 
</span><a name="LN88"></a>            <span class='Keyword'>bool </span><span class='Declare_Parameter'>execute_once</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN89"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>ExecCheckRTEPerms</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rte</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN90"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>ExecCheckRTEPermsModified</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relOid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>userid</span><span class='Delimiter'>, 
</span><a name="LN91"></a>                          <a href="../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>modifiedCols</span><span class='Delimiter'>, 
</span><a name="LN92"></a>                          <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>requiredPerms</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN93"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ExecCheckXactReadOnly</span><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plannedstmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN94"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Prototype'>ExecBuildSlotValueDescription</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>reloid</span><span class='Delimiter'>, 
</span><a name="LN95"></a>                              <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Delimiter'>, 
</span><a name="LN96"></a>                              <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupdesc</span><span class='Delimiter'>, 
</span><a name="LN97"></a>                              <a href="../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>modifiedCols</span><span class='Delimiter'>, 
</span><a name="LN98"></a>                              <span class='Keyword'>int </span><span class='Declare_Parameter'>maxfieldlen</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN99"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Prototype'>ExecBuildSlotPartitionKeyDescription</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN100"></a>                                     <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>values</span><span class='Delimiter'>, 
</span><a name="LN101"></a>                                     <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isnull</span><span class='Delimiter'>, 
</span><a name="LN102"></a>                                     <span class='Keyword'>int </span><span class='Declare_Parameter'>maxfieldlen</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN103"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>EvalPlanQualStart</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN873"><span class='Ref_to_Struct'>EPQState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>epqstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parentestate</span><span class='Delimiter'>, 
</span><a name="LN104"></a>                  <a href="../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>planTree</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN105"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ExecPartitionCheck</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>resultRelInfo</span><span class='Delimiter'>, 
</span><a name="LN106"></a>                   <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Note that GetUpdatedColumns() also exists in commands/trigger.c.  There does 
 * not appear to be any good header to put it into, given the structures that 
 * it uses, so we let them be duplicated.  Be sure to update both if one needs 
 * to be changed, however. 
 */ 
</span><a name="LN114"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>GetInsertedColumns</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>relinfo</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>estate</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>(</span><a href="../../include/parser/parsetree.h.html#LN30"><span class='Ref_to_Macro'>rt_fetch</span></a><span class='Parentheses'>((</span><a href="execMain.c.html#LN114"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>ri_RangeTableIndex<span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="execMain.c.html#LN114"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>es_range_table<span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>insertedCols<span class='Parentheses'>)</span> 
<a name="LN116"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>GetUpdatedColumns</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>relinfo</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>estate</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>(</span><a href="../../include/parser/parsetree.h.html#LN30"><span class='Ref_to_Macro'>rt_fetch</span></a><span class='Parentheses'>((</span><a href="execMain.c.html#LN116"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>ri_RangeTableIndex<span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="execMain.c.html#LN116"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>es_range_table<span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>updatedCols<span class='Parentheses'>)</span> 
 
<span class='Comment_Multi_Line'>/* end of local decls */ 
</span> 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      ExecutorStart 
 * 
 *      This routine must be called at the beginning of any execution of any 
 *      query plan 
 * 
 * Takes a QueryDesc previously created by CreateQueryDesc (which is separate 
 * only because some places use QueryDescs for utility commands).  The tupDesc 
 * field of the QueryDesc is filled in to describe the tuples that will be 
 * returned, and the internal fields (estate and planstate) are set up. 
 * 
 * eflags contains flag bits as described in executor.h. 
 * 
 * NB: the CurrentMemoryContext when this is called will become the parent 
 * of the per-query context used for this Executor invocation. 
 * 
 * We provide a function hook variable that lets loadable plugins 
 * get control when ExecutorStart is called.  Such a plugin would 
 * normally call standard_ExecutorStart(). 
 * 
 * ---------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN145"></a><span class='Declare_Function'>ExecutorStart</span><span class='Parentheses'>(</span><a href="../../include/executor/execdesc.h.html#LN32"><span class='Ref_to_Struct'>QueryDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>queryDesc</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>eflags</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN68"><span class='Ref_to_Global_Var'>ExecutorStart_hook</span></a><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="execMain.c.html#LN68"><span class='Ref_to_Global_Var'>ExecutorStart_hook</span></a><span class='Parentheses'>) (</span><a href="execMain.c.html#LN145"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN145"><span class='Ref_to_Parameter'>eflags</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="execMain.c.html#LN153"><span class='Ref_to_Func'>standard_ExecutorStart</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN145"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN145"><span class='Ref_to_Parameter'>eflags</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>void 
</span><a name="LN154"></a><span class='Declare_Function'>standard_ExecutorStart</span><span class='Parentheses'>(</span><a href="../../include/executor/execdesc.h.html#LN32"><span class='Ref_to_Struct'>QueryDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>queryDesc</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>eflags</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN156"></a>    <a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>estate</span><span class='Delimiter'>; 
</span><a name="LN157"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* sanity checks: queryDesc must not be started already */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="execMain.c.html#LN154"><span class='Ref_to_Parameter'>queryDesc</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="execMain.c.html#LN154"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN47"><span class='Ref_to_Member'>estate</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the transaction is read-only, we need to check if any writes are 
     * planned to non-temporary tables.  EXPLAIN is considered read-only. 
     * 
     * Don't allow writes in parallel mode.  Supporting UPDATE and DELETE 
     * would require (a) storing the combocid hash in shared memory, rather 
     * than synchronizing it just once at the start of parallelism, and (b) an 
     * alternative to heap_update()'s reliance on xmax for mutual exclusion. 
     * INSERT may have no such troubles, but we forbid it to simplify the 
     * checks. 
     * 
     * We have lower-level defenses in CommandCounterIncrement and elsewhere 
     * against performing unsafe operations in parallel mode, but this gives a 
     * more user-friendly error message. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="../access/transam/xact.c.html#LN76"><span class='Ref_to_Global_Var'>XactReadOnly</span></a> <span class='Operator'>|| </span><a href="../../include/access/xact.h.html#LN405"><span class='Ref_to_Proto'>IsInParallelMode</span></a><span class='Parentheses'>())</span> <span class='Operator'>&& 
</span>        <span class='Operator'>!</span><span class='Parentheses'>(</span><a href="execMain.c.html#LN154"><span class='Ref_to_Parameter'>eflags</span></a> <span class='Operator'>& </span><a href="../../include/executor/executor.h.html#LN57"><span class='Ref_to_Const'>EXEC_FLAG_EXPLAIN_ONLY</span></a><span class='Parentheses'>))</span> 
        <a href="execMain.c.html#LN93"><span class='Ref_to_Proto'>ExecCheckXactReadOnly</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN154"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN36"><span class='Ref_to_Member'>plannedstmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Build EState, switch into per-query memory context for startup. 
     */ 
</span>    <a href="execMain.c.html#LN156"><span class='Ref_To_Local'>estate</span></a> <span class='Operator'>= </span><a href="execUtils.c.html#LN78"><span class='Ref_to_Func'>CreateExecutorState</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN154"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN47"><span class='Ref_to_Member'>estate</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN156"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>; 
</span> 
    <a href="execMain.c.html#LN157"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN156"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN447"><span class='Ref_to_Member'>es_query_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Fill in external parameters, if any, from queryDesc; and allocate 
     * workspace for internal parameters 
     */ 
</span>    <a href="execMain.c.html#LN156"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN441"><span class='Ref_to_Member'>es_param_list_info</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN154"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN41"><span class='Ref_to_Member'>params</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN154"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN36"><span class='Ref_to_Member'>plannedstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN91"><span class='Ref_to_Member'>nParamExec</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="execMain.c.html#LN156"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN442"><span class='Ref_to_Member'>es_param_exec_vals</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/params.h.html#LN96"><span class='Ref_to_Struct'>ParamExecData</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN154"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN36"><span class='Ref_to_Member'>plannedstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN91"><span class='Ref_to_Member'>nParamExec</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/nodes/params.h.html#LN96"><span class='Ref_to_Struct'>ParamExecData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="execMain.c.html#LN156"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN412"><span class='Ref_to_Member'>es_sourceText</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN154"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN37"><span class='Ref_to_Member'>sourceText</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Fill in the query environment, if any, from queryDesc. 
     */ 
</span>    <a href="execMain.c.html#LN156"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN444"><span class='Ref_to_Member'>es_queryEnv</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN154"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN42"><span class='Ref_to_Member'>queryEnv</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If non-read-only query, set the command ID to mark output tuples with 
     */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN154"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN35"><span class='Ref_to_Member'>operation</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN650"><span class='Ref_to_EnumConst'>CMD_SELECT</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * SELECT FOR [KEY] UPDATE/SHARE and modifying CTEs need to mark 
             * tuples 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN154"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN36"><span class='Ref_to_Member'>plannedstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN85"><span class='Ref_to_Member'>rowMarks</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>|| 
</span>                <a href="execMain.c.html#LN154"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN36"><span class='Ref_to_Member'>plannedstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN50"><span class='Ref_to_Member'>hasModifyingCTE</span></a><span class='Parentheses'>) 
</span>                <a href="execMain.c.html#LN156"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN417"><span class='Ref_to_Member'>es_output_cid</span></a> <span class='Operator'>= </span><a href="../../include/access/xact.h.html#LN339"><span class='Ref_to_Proto'>GetCurrentCommandId</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * A SELECT without modifying CTEs can't possibly queue triggers, 
             * so force skip-triggers mode. This is just a marginal efficiency 
             * hack, since AfterTriggerBeginQuery/AfterTriggerEndQuery aren't 
             * all that expensive, but we might as well do it. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="execMain.c.html#LN154"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN36"><span class='Ref_to_Member'>plannedstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN50"><span class='Ref_to_Member'>hasModifyingCTE</span></a><span class='Parentheses'>) 
</span>                <a href="execMain.c.html#LN154"><span class='Ref_to_Parameter'>eflags</span></a> <span class='Operator'>|= </span><a href="../../include/executor/executor.h.html#LN61"><span class='Ref_to_Const'>EXEC_FLAG_SKIP_TRIGGERS</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN652"><span class='Ref_to_EnumConst'>CMD_INSERT</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN653"><span class='Ref_to_EnumConst'>CMD_DELETE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN651"><span class='Ref_to_EnumConst'>CMD_UPDATE</span></a><span class='Operator'>: 
</span>            <a href="execMain.c.html#LN156"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN417"><span class='Ref_to_Member'>es_output_cid</span></a> <span class='Operator'>= </span><a href="../../include/access/xact.h.html#LN339"><span class='Ref_to_Proto'>GetCurrentCommandId</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized operation code: %d"</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="execMain.c.html#LN154"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN35"><span class='Ref_to_Member'>operation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch queryDesc-&GT;operation &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Copy other important information into the EState 
     */ 
</span>    <a href="execMain.c.html#LN156"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN408"><span class='Ref_to_Member'>es_snapshot</span></a> <span class='Operator'>= </span><a href="../../include/utils/snapmgr.h.html#LN80"><span class='Ref_to_Proto'>RegisterSnapshot</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN154"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN38"><span class='Ref_to_Member'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN156"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN409"><span class='Ref_to_Member'>es_crosscheck_snapshot</span></a> <span class='Operator'>= </span><a href="../../include/utils/snapmgr.h.html#LN80"><span class='Ref_to_Proto'>RegisterSnapshot</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN154"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN39"><span class='Ref_to_Member'>crosscheck_snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN156"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN456"><span class='Ref_to_Member'>es_top_eflags</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN154"><span class='Ref_to_Parameter'>eflags</span></a><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN156"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN457"><span class='Ref_to_Member'>es_instrument</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN154"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN43"><span class='Ref_to_Member'>instrument_options</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Initialize the plan state tree 
     */ 
</span>    <a href="execMain.c.html#LN77"><span class='Ref_to_Proto'>InitPlan</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN154"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN154"><span class='Ref_to_Parameter'>eflags</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set up an AFTER-trigger statement context, unless told not to, or 
     * unless it's EXPLAIN-only mode (when ExecutorFinish won't be called). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="execMain.c.html#LN154"><span class='Ref_to_Parameter'>eflags</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><a href="../../include/executor/executor.h.html#LN61"><span class='Ref_to_Const'>EXEC_FLAG_SKIP_TRIGGERS</span></a> <span class='Operator'>| </span><a href="../../include/executor/executor.h.html#LN57"><span class='Ref_to_Const'>EXEC_FLAG_EXPLAIN_ONLY</span></a><span class='Parentheses'>)))</span> 
        <a href="../../include/commands/trigger.h.html#LN187"><span class='Ref_to_Proto'>AfterTriggerBeginQuery</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN157"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end standard_ExecutorStart &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      ExecutorRun 
 * 
 *      This is the main routine of the executor module. It accepts 
 *      the query descriptor from the traffic cop and executes the 
 *      query plan. 
 * 
 *      ExecutorStart must have been called already. 
 * 
 *      If direction is NoMovementScanDirection then nothing is done 
 *      except to start up/shut down the destination.  Otherwise, 
 *      we retrieve up to 'count' tuples in the specified direction. 
 * 
 *      Note: count = 0 is interpreted as no portal limit, i.e., run to 
 *      completion.  Also note that the count limit is only applied to 
 *      retrieved tuples, not for instance to those inserted/updated/deleted 
 *      by a ModifyTable plan node. 
 * 
 *      There is no return value, but output tuples (if any) are sent to 
 *      the destination receiver specified in the QueryDesc; and the number 
 *      of tuples processed at the top level can be found in 
 *      estate-&GT;es_processed. 
 * 
 *      We provide a function hook variable that lets loadable plugins 
 *      get control when ExecutorRun is called.  Such a plugin would 
 *      normally call standard_ExecutorRun(). 
 * 
 * ---------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN297"></a><span class='Declare_Function'>ExecutorRun</span><span class='Parentheses'>(</span><a href="../../include/executor/execdesc.h.html#LN32"><span class='Ref_to_Struct'>QueryDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>queryDesc</span><span class='Delimiter'>, 
</span><a name="LN298"></a>            <a href="../../include/access/sdir.h.html#LN21"><span class='Ref_to_Enum'>ScanDirection</span></a> <span class='Declare_Parameter'>direction</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Parameter'>count</span><span class='Delimiter'>, 
</span><a name="LN299"></a>            <span class='Keyword'>bool </span><span class='Declare_Parameter'>execute_once</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN69"><span class='Ref_to_Global_Var'>ExecutorRun_hook</span></a><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="execMain.c.html#LN69"><span class='Ref_to_Global_Var'>ExecutorRun_hook</span></a><span class='Parentheses'>) (</span><a href="execMain.c.html#LN297"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN298"><span class='Ref_to_Parameter'>direction</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN298"><span class='Ref_to_Parameter'>count</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN299"><span class='Ref_to_Parameter'>execute_once</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../include/executor/executor.h.html#LN171"><span class='Ref_to_Proto'>standard_ExecutorRun</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN297"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN298"><span class='Ref_to_Parameter'>direction</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN298"><span class='Ref_to_Parameter'>count</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN299"><span class='Ref_to_Parameter'>execute_once</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>void 
</span><a name="LN308"></a><span class='Declare_Function'>standard_ExecutorRun</span><span class='Parentheses'>(</span><a href="../../include/executor/execdesc.h.html#LN32"><span class='Ref_to_Struct'>QueryDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>queryDesc</span><span class='Delimiter'>, 
</span><a name="LN309"></a>                     <a href="../../include/access/sdir.h.html#LN21"><span class='Ref_to_Enum'>ScanDirection</span></a> <span class='Declare_Parameter'>direction</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Parameter'>count</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>execute_once</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN311"></a>    <a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>estate</span><span class='Delimiter'>; 
</span><a name="LN312"></a>    <a href="../../include/nodes/nodes.h.html#LN647"><span class='Ref_to_Enum'>CmdType</span></a>     <span class='Declare_Local'>operation</span><span class='Delimiter'>; 
</span><a name="LN313"></a>    <a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Local'>dest</span><span class='Delimiter'>; 
</span><a name="LN314"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>sendTuples</span><span class='Delimiter'>; 
</span><a name="LN315"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* sanity checks */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="execMain.c.html#LN308"><span class='Ref_to_Parameter'>queryDesc</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="execMain.c.html#LN311"><span class='Ref_To_Local'>estate</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN308"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN47"><span class='Ref_to_Member'>estate</span></a><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="execMain.c.html#LN311"><span class='Ref_To_Local'>estate</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="execMain.c.html#LN311"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN456"><span class='Ref_to_Member'>es_top_eflags</span></a> <span class='Operator'>& </span><a href="../../include/executor/executor.h.html#LN57"><span class='Ref_to_Const'>EXEC_FLAG_EXPLAIN_ONLY</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Switch into per-query memory context 
     */ 
</span>    <a href="execMain.c.html#LN315"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN311"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN447"><span class='Ref_to_Member'>es_query_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Allow instrumentation of Executor overall runtime */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN308"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN54"><span class='Ref_to_Member'>totaltime</span></a><span class='Parentheses'>) 
</span>        <a href="instrument.c.html#LN61"><span class='Ref_to_Func'>InstrStartNode</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN308"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN54"><span class='Ref_to_Member'>totaltime</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * extract information from the query descriptor and the query feature. 
     */ 
</span>    <a href="execMain.c.html#LN312"><span class='Ref_To_Local'>operation</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN308"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN35"><span class='Ref_to_Member'>operation</span></a><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN313"><span class='Ref_To_Local'>dest</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN308"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN40"><span class='Ref_to_Member'>dest</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * startup tuple receiver, if we will be emitting tuples 
     */ 
</span>    <a href="execMain.c.html#LN311"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN453"><span class='Ref_to_Member'>es_processed</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN311"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN454"><span class='Ref_to_Member'>es_lastoid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
    <a href="execMain.c.html#LN314"><span class='Ref_To_Local'>sendTuples</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="execMain.c.html#LN312"><span class='Ref_To_Local'>operation</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN650"><span class='Ref_to_EnumConst'>CMD_SELECT</span></a> <span class='Operator'>|| 
</span>                  <a href="execMain.c.html#LN308"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN36"><span class='Ref_to_Member'>plannedstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN48"><span class='Ref_to_Member'>hasReturning</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN314"><span class='Ref_To_Local'>sendTuples</span></a><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="execMain.c.html#LN313"><span class='Ref_To_Local'>dest</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/dest.h.html#LN120"><span class='Ref_to_Member'>rStartup</span></a><span class='Parentheses'>) (</span><a href="execMain.c.html#LN313"><span class='Ref_To_Local'>dest</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN312"><span class='Ref_To_Local'>operation</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN308"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN46"><span class='Ref_to_Member'>tupDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * run plan 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/sdir.h.html#LN47"><span class='Ref_to_Macro'>ScanDirectionIsNoMovement</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN309"><span class='Ref_to_Parameter'>direction</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN309"><span class='Ref_to_Parameter'>execute_once</span></a> <span class='Operator'>&& </span><a href="execMain.c.html#LN308"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN51"><span class='Ref_to_Member'>already_executed</span></a><span class='Parentheses'>) 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"can't re-execute query flagged for single execution"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN308"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN51"><span class='Ref_to_Member'>already_executed</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <a href="execMain.c.html#LN81"><span class='Ref_to_Proto'>ExecutePlan</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN311"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, 
</span>                    <a href="execMain.c.html#LN308"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN48"><span class='Ref_to_Member'>planstate</span></a><span class='Delimiter'>, 
</span>                    <a href="execMain.c.html#LN308"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN36"><span class='Ref_to_Member'>plannedstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN58"><span class='Ref_to_Member'>parallelModeNeeded</span></a><span class='Delimiter'>, 
</span>                    <a href="execMain.c.html#LN312"><span class='Ref_To_Local'>operation</span></a><span class='Delimiter'>, 
</span>                    <a href="execMain.c.html#LN314"><span class='Ref_To_Local'>sendTuples</span></a><span class='Delimiter'>, 
</span>                    <a href="execMain.c.html#LN309"><span class='Ref_to_Parameter'>count</span></a><span class='Delimiter'>, 
</span>                    <a href="execMain.c.html#LN309"><span class='Ref_to_Parameter'>direction</span></a><span class='Delimiter'>, 
</span>                    <a href="execMain.c.html#LN313"><span class='Ref_To_Local'>dest</span></a><span class='Delimiter'>, 
</span>                    <a href="execMain.c.html#LN309"><span class='Ref_to_Parameter'>execute_once</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * shutdown tuple receiver, if we started it 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN314"><span class='Ref_To_Local'>sendTuples</span></a><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="execMain.c.html#LN313"><span class='Ref_To_Local'>dest</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/dest.h.html#LN123"><span class='Ref_to_Member'>rShutdown</span></a><span class='Parentheses'>) (</span><a href="execMain.c.html#LN313"><span class='Ref_To_Local'>dest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN308"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN54"><span class='Ref_to_Member'>totaltime</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/executor/instrument.h.html#LN76"><span class='Ref_to_Proto'>InstrStopNode</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN308"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN54"><span class='Ref_to_Member'>totaltime</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN311"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN453"><span class='Ref_to_Member'>es_processed</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN315"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end standard_ExecutorRun &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      ExecutorFinish 
 * 
 *      This routine must be called after the last ExecutorRun call. 
 *      It performs cleanup such as firing AFTER triggers.  It is 
 *      separate from ExecutorEnd because EXPLAIN ANALYZE needs to 
 *      include these actions in the total runtime. 
 * 
 *      We provide a function hook variable that lets loadable plugins 
 *      get control when ExecutorFinish is called.  Such a plugin would 
 *      normally call standard_ExecutorFinish(). 
 * 
 * ---------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN399"></a><span class='Declare_Function'>ExecutorFinish</span><span class='Parentheses'>(</span><a href="../../include/executor/execdesc.h.html#LN32"><span class='Ref_to_Struct'>QueryDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>queryDesc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN70"><span class='Ref_to_Global_Var'>ExecutorFinish_hook</span></a><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="execMain.c.html#LN70"><span class='Ref_to_Global_Var'>ExecutorFinish_hook</span></a><span class='Parentheses'>) (</span><a href="execMain.c.html#LN399"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../include/executor/executor.h.html#LN174"><span class='Ref_to_Proto'>standard_ExecutorFinish</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN399"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>void 
</span><a name="LN408"></a><span class='Declare_Function'>standard_ExecutorFinish</span><span class='Parentheses'>(</span><a href="../../include/executor/execdesc.h.html#LN32"><span class='Ref_to_Struct'>QueryDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>queryDesc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN410"></a>    <a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>estate</span><span class='Delimiter'>; 
</span><a name="LN411"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* sanity checks */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="execMain.c.html#LN408"><span class='Ref_to_Parameter'>queryDesc</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="execMain.c.html#LN410"><span class='Ref_To_Local'>estate</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN408"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN47"><span class='Ref_to_Member'>estate</span></a><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="execMain.c.html#LN410"><span class='Ref_To_Local'>estate</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="execMain.c.html#LN410"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN456"><span class='Ref_to_Member'>es_top_eflags</span></a> <span class='Operator'>& </span><a href="../../include/executor/executor.h.html#LN57"><span class='Ref_to_Const'>EXEC_FLAG_EXPLAIN_ONLY</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* This should be run once and only once per Executor instance */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="execMain.c.html#LN410"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN458"><span class='Ref_to_Member'>es_finished</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Switch into per-query memory context */ 
</span>    <a href="execMain.c.html#LN411"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN410"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN447"><span class='Ref_to_Member'>es_query_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Allow instrumentation of Executor overall runtime */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN408"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN54"><span class='Ref_to_Member'>totaltime</span></a><span class='Parentheses'>) 
</span>        <a href="instrument.c.html#LN61"><span class='Ref_to_Func'>InstrStartNode</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN408"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN54"><span class='Ref_to_Member'>totaltime</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Run ModifyTable nodes to completion */ 
</span>    <a href="execMain.c.html#LN79"><span class='Ref_to_Proto'>ExecPostprocessPlan</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN410"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Execute queued AFTER triggers, unless told not to */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="execMain.c.html#LN410"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN456"><span class='Ref_to_Member'>es_top_eflags</span></a> <span class='Operator'>& </span><a href="../../include/executor/executor.h.html#LN61"><span class='Ref_to_Const'>EXEC_FLAG_SKIP_TRIGGERS</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/commands/trigger.h.html#LN188"><span class='Ref_to_Proto'>AfterTriggerEndQuery</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN410"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN408"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN54"><span class='Ref_to_Member'>totaltime</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/executor/instrument.h.html#LN76"><span class='Ref_to_Proto'>InstrStopNode</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN408"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN54"><span class='Ref_to_Member'>totaltime</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN411"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="execMain.c.html#LN410"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN458"><span class='Ref_to_Member'>es_finished</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end standard_ExecutorFinish &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      ExecutorEnd 
 * 
 *      This routine must be called at the end of execution of any 
 *      query plan 
 * 
 *      We provide a function hook variable that lets loadable plugins 
 *      get control when ExecutorEnd is called.  Such a plugin would 
 *      normally call standard_ExecutorEnd(). 
 * 
 * ---------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN459"></a><span class='Declare_Function'>ExecutorEnd</span><span class='Parentheses'>(</span><a href="../../include/executor/execdesc.h.html#LN32"><span class='Ref_to_Struct'>QueryDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>queryDesc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN71"><span class='Ref_to_Global_Var'>ExecutorEnd_hook</span></a><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="execMain.c.html#LN71"><span class='Ref_to_Global_Var'>ExecutorEnd_hook</span></a><span class='Parentheses'>) (</span><a href="execMain.c.html#LN459"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../include/executor/executor.h.html#LN176"><span class='Ref_to_Proto'>standard_ExecutorEnd</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN459"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>void 
</span><a name="LN468"></a><span class='Declare_Function'>standard_ExecutorEnd</span><span class='Parentheses'>(</span><a href="../../include/executor/execdesc.h.html#LN32"><span class='Ref_to_Struct'>QueryDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>queryDesc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN470"></a>    <a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>estate</span><span class='Delimiter'>; 
</span><a name="LN471"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* sanity checks */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="execMain.c.html#LN468"><span class='Ref_to_Parameter'>queryDesc</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="execMain.c.html#LN470"><span class='Ref_To_Local'>estate</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN468"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN47"><span class='Ref_to_Member'>estate</span></a><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="execMain.c.html#LN470"><span class='Ref_To_Local'>estate</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check that ExecutorFinish was called, unless in EXPLAIN-only mode. This 
     * Assert is needed because ExecutorFinish is new as of 9.1, and callers 
     * might forget to call it. 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="execMain.c.html#LN470"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN458"><span class='Ref_to_Member'>es_finished</span></a> <span class='Operator'>|| 
</span>           <span class='Parentheses'>(</span><a href="execMain.c.html#LN470"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN456"><span class='Ref_to_Member'>es_top_eflags</span></a> <span class='Operator'>& </span><a href="../../include/executor/executor.h.html#LN57"><span class='Ref_to_Const'>EXEC_FLAG_EXPLAIN_ONLY</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Switch into per-query memory context to run ExecEndPlan 
     */ 
</span>    <a href="execMain.c.html#LN471"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN470"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN447"><span class='Ref_to_Member'>es_query_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="execMain.c.html#LN80"><span class='Ref_to_Proto'>ExecEndPlan</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN468"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN48"><span class='Ref_to_Member'>planstate</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN470"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* do away with our snapshots */ 
</span>    <a href="../../include/utils/snapmgr.h.html#LN81"><span class='Ref_to_Proto'>UnregisterSnapshot</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN470"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN408"><span class='Ref_to_Member'>es_snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/snapmgr.h.html#LN81"><span class='Ref_to_Proto'>UnregisterSnapshot</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN470"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN409"><span class='Ref_to_Member'>es_crosscheck_snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Must switch out of context before destroying it 
     */ 
</span>    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN471"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Release EState and per-query memory context.  This should release 
     * everything the executor has allocated. 
     */ 
</span>    <a href="execUtils.c.html#LN176"><span class='Ref_to_Func'>FreeExecutorState</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN470"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Reset queryDesc fields that no longer point to anything */ 
</span>    <a href="execMain.c.html#LN468"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN46"><span class='Ref_to_Member'>tupDesc</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN468"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN47"><span class='Ref_to_Member'>estate</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN468"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN48"><span class='Ref_to_Member'>planstate</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN468"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN54"><span class='Ref_to_Member'>totaltime</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end standard_ExecutorEnd &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      ExecutorRewind 
 * 
 *      This routine may be called on an open queryDesc to rewind it 
 *      to the start. 
 * ---------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN525"></a><span class='Declare_Function'>ExecutorRewind</span><span class='Parentheses'>(</span><a href="../../include/executor/execdesc.h.html#LN32"><span class='Ref_to_Struct'>QueryDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>queryDesc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN527"></a>    <a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>estate</span><span class='Delimiter'>; 
</span><a name="LN528"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* sanity checks */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="execMain.c.html#LN525"><span class='Ref_to_Parameter'>queryDesc</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="execMain.c.html#LN527"><span class='Ref_To_Local'>estate</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN525"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN47"><span class='Ref_to_Member'>estate</span></a><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="execMain.c.html#LN527"><span class='Ref_To_Local'>estate</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* It's probably not sensible to rescan updating queries */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="execMain.c.html#LN525"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN35"><span class='Ref_to_Member'>operation</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN650"><span class='Ref_to_EnumConst'>CMD_SELECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Switch into per-query memory context 
     */ 
</span>    <a href="execMain.c.html#LN528"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN527"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN447"><span class='Ref_to_Member'>es_query_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * rescan plan 
     */ 
</span>    <a href="execAmi.c.html#LN73"><span class='Ref_to_Func'>ExecReScan</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN525"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN48"><span class='Ref_to_Member'>planstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN528"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecutorRewind &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * ExecCheckRTPerms 
 *      Check access permissions for all relations listed in a range table. 
 * 
 * Returns true if permissions are adequate.  Otherwise, throws an appropriate 
 * error if ereport_on_violation is true, or simply returns false otherwise. 
 * 
 * Note that this does NOT address row level security policies (aka: RLS).  If 
 * rows will be returned to the user as a result of this permission check 
 * passing, then RLS also needs to be consulted (and check_enable_rls()). 
 * 
 * See rewrite/rowsecurity.c. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN568"></a><span class='Declare_Function'>ExecCheckRTPerms</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rangeTable</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>ereport_on_violation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN570"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span><a name="LN571"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN570"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN568"><span class='Ref_to_Parameter'>rangeTable</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN575"></a>        <a href="../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rte</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN570"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="execMain.c.html#LN571"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN89"><span class='Ref_to_Proto'>ExecCheckRTEPerms</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN575"><span class='Ref_To_Local'>rte</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="execMain.c.html#LN571"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="execMain.c.html#LN575"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN936"><span class='Ref_to_Member'>rtekind</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN922"><span class='Ref_to_EnumConst'>RTE_RELATION</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN568"><span class='Ref_to_Parameter'>ereport_on_violation</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN172"><span class='Ref_to_EnumConst'>ACLCHECK_NO_PRIV</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN181"><span class='Ref_to_EnumConst'>ACL_KIND_CLASS</span></a><span class='Delimiter'>, 
</span>                               <a href="../../include/utils/lsyscache.h.html#LN124"><span class='Ref_to_Proto'>get_rel_name</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN575"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN947"><span class='Ref_to_Member'>relid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN74"><span class='Ref_to_Global_Var'>ExecutorCheckPerms_hook</span></a><span class='Parentheses'>) 
</span>        <a href="execMain.c.html#LN571"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="execMain.c.html#LN74"><span class='Ref_to_Global_Var'>ExecutorCheckPerms_hook</span></a><span class='Parentheses'>) (</span><a href="execMain.c.html#LN568"><span class='Ref_to_Parameter'>rangeTable</span></a><span class='Delimiter'>, 
</span>                                             <a href="execMain.c.html#LN568"><span class='Ref_to_Parameter'>ereport_on_violation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="execMain.c.html#LN571"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecCheckRTPerms &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ExecCheckRTEPerms 
 *      Check access permissions for a single RTE. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN599"></a><span class='Declare_Function'>ExecCheckRTEPerms</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rte</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN601"></a>    <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>requiredPerms</span><span class='Delimiter'>; 
</span><a name="LN602"></a>    <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>relPerms</span><span class='Delimiter'>; 
</span><a name="LN603"></a>    <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>remainingPerms</span><span class='Delimiter'>; 
</span><a name="LN604"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relOid</span><span class='Delimiter'>; 
</span><a name="LN605"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>userid</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Only plain-relation RTEs need to be checked here.  Function RTEs are 
     * checked when the function is prepared for execution.  Join, subquery, 
     * and special RTEs need no checks. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN599"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN936"><span class='Ref_to_Member'>rtekind</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/parsenodes.h.html#LN922"><span class='Ref_to_EnumConst'>RTE_RELATION</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * No work if requiredPerms is empty. 
     */ 
</span>    <a href="execMain.c.html#LN601"><span class='Ref_To_Local'>requiredPerms</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN599"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1027"><span class='Ref_to_Member'>requiredPerms</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN601"><span class='Ref_To_Local'>requiredPerms</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="execMain.c.html#LN604"><span class='Ref_To_Local'>relOid</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN599"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN947"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * userid to check as: current user unless we have a setuid indication. 
     * 
     * Note: GetUserId() is presently fast enough that there's no harm in 
     * calling it separately for each RTE.  If that stops being true, we could 
     * call it once in ExecCheckRTPerms and pass the userid down from there. 
     * But for now, no need for the extra clutter. 
     */ 
</span>    <a href="execMain.c.html#LN605"><span class='Ref_To_Local'>userid</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN599"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1028"><span class='Ref_to_Member'>checkAsUser</span></a> <span class='Operator'>? </span><a href="execMain.c.html#LN599"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1028"><span class='Ref_to_Member'>checkAsUser</span></a> <span class='Operator'>: </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We must have *all* the requiredPerms bits, but some of the bits can be 
     * satisfied from column-level rather than relation-level permissions. 
     * First, remove any bits that are satisfied by relation permissions. 
     */ 
</span>    <a href="execMain.c.html#LN602"><span class='Ref_To_Local'>relPerms</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN258"><span class='Ref_to_Proto'>pg_class_aclmask</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN604"><span class='Ref_To_Local'>relOid</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN605"><span class='Ref_To_Local'>userid</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN601"><span class='Ref_To_Local'>requiredPerms</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN164"><span class='Ref_to_EnumConst'>ACLMASK_ALL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN603"><span class='Ref_To_Local'>remainingPerms</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN601"><span class='Ref_To_Local'>requiredPerms</span></a> <span class='Operator'>& ~</span><a href="execMain.c.html#LN602"><span class='Ref_To_Local'>relPerms</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN603"><span class='Ref_To_Local'>remainingPerms</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN643"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>col</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If we lack any permissions that exist only as relation permissions, 
         * we can fail straight away. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN603"><span class='Ref_To_Local'>remainingPerms</span></a> <span class='Operator'>& ~</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN72"><span class='Ref_to_Const'>ACL_SELECT</span></a> <span class='Operator'>| </span><a href="../../include/nodes/parsenodes.h.html#LN71"><span class='Ref_to_Const'>ACL_INSERT</span></a> <span class='Operator'>| </span><a href="../../include/nodes/parsenodes.h.html#LN73"><span class='Ref_to_Const'>ACL_UPDATE</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Check to see if we have the needed privileges at column level. 
         * 
         * Note: failures just report a table-level error; it would be nicer 
         * to report a column-level error if we have some but not all of the 
         * column privileges. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN603"><span class='Ref_To_Local'>remainingPerms</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN72"><span class='Ref_to_Const'>ACL_SELECT</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * When the query doesn't explicitly reference any columns (for 
             * example, SELECT COUNT(*) FROM table), allow the query if we 
             * have SELECT on any column of the rel, as per SQL spec. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/bitmapset.h.html#LN85"><span class='Ref_to_Proto'>bms_is_empty</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN599"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1029"><span class='Ref_to_Member'>selectedCols</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN281"><span class='Ref_to_Proto'>pg_attribute_aclcheck_all</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN604"><span class='Ref_To_Local'>relOid</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN605"><span class='Ref_To_Local'>userid</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN72"><span class='Ref_to_Const'>ACL_SELECT</span></a><span class='Delimiter'>, 
</span>                                              <a href="../../include/utils/acl.h.html#LN165"><span class='Ref_to_EnumConst'>ACLMASK_ANY</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span> 
                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="execMain.c.html#LN643"><span class='Ref_To_Local'>col</span></a> <span class='Operator'>= </span><a href="../../include/nodes/bitmapset.h.html#LN98"><span class='Ref_to_Proto'>bms_next_member</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN599"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1029"><span class='Ref_to_Member'>selectedCols</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN643"><span class='Ref_To_Local'>col</span></a><span class='Parentheses'>))</span> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* bit #s are offset by FirstLowInvalidHeapAttributeNumber */ 
</span><a name="LN676"></a>                <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>attno</span> <span class='Operator'>= </span><a href="execMain.c.html#LN643"><span class='Ref_To_Local'>col</span></a> <span class='Operator'>+ </span><a href="../../include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN676"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>== </span><a href="../../include/access/attnum.h.html#LN22"><span class='Ref_to_Const'>InvalidAttrNumber</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* Whole-row reference, must have priv on all cols */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN281"><span class='Ref_to_Proto'>pg_attribute_aclcheck_all</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN604"><span class='Ref_To_Local'>relOid</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN605"><span class='Ref_To_Local'>userid</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN72"><span class='Ref_to_Const'>ACL_SELECT</span></a><span class='Delimiter'>, 
</span>                                                  <a href="../../include/utils/acl.h.html#LN164"><span class='Ref_to_EnumConst'>ACLMASK_ALL</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span> 
                        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN279"><span class='Ref_to_Proto'>pg_attribute_aclcheck</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN604"><span class='Ref_To_Local'>relOid</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN676"><span class='Ref_To_Local'>attno</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN605"><span class='Ref_To_Local'>userid</span></a><span class='Delimiter'>, 
</span>                                              <a href="../../include/nodes/parsenodes.h.html#LN72"><span class='Ref_to_Const'>ACL_SELECT</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span> 
                        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if remainingPerms&ACL_SE... &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * Basically the same for the mod columns, for both INSERT and UPDATE 
         * privilege as specified by remainingPerms. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN603"><span class='Ref_To_Local'>remainingPerms</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN71"><span class='Ref_to_Const'>ACL_INSERT</span></a> <span class='Operator'>&& !</span><a href="execMain.c.html#LN90"><span class='Ref_to_Proto'>ExecCheckRTEPermsModified</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN604"><span class='Ref_To_Local'>relOid</span></a><span class='Delimiter'>, 
</span>                                                                      <a href="execMain.c.html#LN605"><span class='Ref_To_Local'>userid</span></a><span class='Delimiter'>, 
</span>                                                           <a href="execMain.c.html#LN599"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1030"><span class='Ref_to_Member'>insertedCols</span></a><span class='Delimiter'>, 
</span>                                                                 <a href="../../include/nodes/parsenodes.h.html#LN71"><span class='Ref_to_Const'>ACL_INSERT</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN603"><span class='Ref_To_Local'>remainingPerms</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN73"><span class='Ref_to_Const'>ACL_UPDATE</span></a> <span class='Operator'>&& !</span><a href="execMain.c.html#LN90"><span class='Ref_to_Proto'>ExecCheckRTEPermsModified</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN604"><span class='Ref_To_Local'>relOid</span></a><span class='Delimiter'>, 
</span>                                                                      <a href="execMain.c.html#LN605"><span class='Ref_To_Local'>userid</span></a><span class='Delimiter'>, 
</span>                                                            <a href="execMain.c.html#LN599"><span class='Ref_to_Parameter'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1031"><span class='Ref_to_Member'>updatedCols</span></a><span class='Delimiter'>, 
</span>                                                                 <a href="../../include/nodes/parsenodes.h.html#LN73"><span class='Ref_to_Const'>ACL_UPDATE</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if remainingPerms!=0 &raquo; </span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecCheckRTEPerms &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ExecCheckRTEPermsModified 
 *      Check INSERT or UPDATE access permissions for a single RTE (these 
 *      are processed uniformly). 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN719"></a><span class='Declare_Function'>ExecCheckRTEPermsModified</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relOid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>userid</span><span class='Delimiter'>, </span><a href="../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>modifiedCols</span><span class='Delimiter'>, 
</span><a name="LN720"></a>                          <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>requiredPerms</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN722"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>col</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * When the query doesn't explicitly update any columns, allow the query 
     * if we have permission on any column of the rel.  This is to handle 
     * SELECT FOR UPDATE as well as possible corner cases in UPDATE. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/bitmapset.h.html#LN85"><span class='Ref_to_Proto'>bms_is_empty</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN719"><span class='Ref_to_Parameter'>modifiedCols</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN281"><span class='Ref_to_Proto'>pg_attribute_aclcheck_all</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN719"><span class='Ref_to_Parameter'>relOid</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN719"><span class='Ref_to_Parameter'>userid</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN720"><span class='Ref_to_Parameter'>requiredPerms</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../include/utils/acl.h.html#LN165"><span class='Ref_to_EnumConst'>ACLMASK_ANY</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="execMain.c.html#LN722"><span class='Ref_To_Local'>col</span></a> <span class='Operator'>= </span><a href="../../include/nodes/bitmapset.h.html#LN98"><span class='Ref_to_Proto'>bms_next_member</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN719"><span class='Ref_to_Parameter'>modifiedCols</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN722"><span class='Ref_To_Local'>col</span></a><span class='Parentheses'>))</span> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* bit #s are offset by FirstLowInvalidHeapAttributeNumber */ 
</span><a name="LN739"></a>        <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>attno</span> <span class='Operator'>= </span><a href="execMain.c.html#LN722"><span class='Ref_To_Local'>col</span></a> <span class='Operator'>+ </span><a href="../../include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN739"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>== </span><a href="../../include/access/attnum.h.html#LN22"><span class='Ref_to_Const'>InvalidAttrNumber</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* whole-row reference can't happen here */ 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"whole-row update is not implemented"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN279"><span class='Ref_to_Proto'>pg_attribute_aclcheck</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN719"><span class='Ref_to_Parameter'>relOid</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN739"><span class='Ref_To_Local'>attno</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN719"><span class='Ref_to_Parameter'>userid</span></a><span class='Delimiter'>, 
</span>                                      <a href="execMain.c.html#LN720"><span class='Ref_to_Parameter'>requiredPerms</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecCheckRTEPermsModified &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Check that the query does not imply any writes to non-temp tables; 
 * unless we're in parallel mode, in which case don't even allow writes 
 * to temp tables. 
 * 
 * Note: in a Hot Standby slave this would need to reject writes to temp 
 * tables just as we do in parallel mode; but an HS slave can't have created 
 * any temp tables in the first place, so no need to check that. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN766"></a><span class='Declare_Function'>ExecCheckXactReadOnly</span><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plannedstmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN768"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Fail if write permissions are requested in parallel mode for table 
     * (temp or non-temp), otherwise fail for any non-temp table. 
     */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN768"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN766"><span class='Ref_to_Parameter'>plannedstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN62"><span class='Ref_to_Member'>rtable</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN776"></a>        <a href="../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rte</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN768"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN776"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN936"><span class='Ref_to_Member'>rtekind</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/parsenodes.h.html#LN922"><span class='Ref_to_EnumConst'>RTE_RELATION</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="execMain.c.html#LN776"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1027"><span class='Ref_to_Member'>requiredPerms</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><span class='Operator'>~</span><a href="../../include/nodes/parsenodes.h.html#LN72"><span class='Ref_to_Const'>ACL_SELECT</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/namespace.h.html#LN123"><span class='Ref_to_Proto'>isTempNamespace</span></a><span class='Parentheses'>(</span><a href="../../include/utils/lsyscache.h.html#LN125"><span class='Ref_to_Proto'>get_rel_namespace</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN776"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN947"><span class='Ref_to_Member'>relid</span></a><span class='Parentheses'>)))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="../tcop/utility.c.html#LN234"><span class='Ref_to_Func'>PreventCommandIfReadOnly</span></a><span class='Parentheses'>(</span><a href="../../include/tcop/utility.h.html#LN48"><span class='Ref_to_Proto'>CreateCommandTag</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="execMain.c.html#LN766"><span class='Ref_to_Parameter'>plannedstmt</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN766"><span class='Ref_to_Parameter'>plannedstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN44"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/nodes.h.html#LN650"><span class='Ref_to_EnumConst'>CMD_SELECT</span></a> <span class='Operator'>|| </span><a href="execMain.c.html#LN766"><span class='Ref_to_Parameter'>plannedstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN50"><span class='Ref_to_Member'>hasModifyingCTE</span></a><span class='Parentheses'>) 
</span>        <a href="../tcop/utility.c.html#LN252"><span class='Ref_to_Func'>PreventCommandIfParallelMode</span></a><span class='Parentheses'>(</span><a href="../../include/tcop/utility.h.html#LN48"><span class='Ref_to_Proto'>CreateCommandTag</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="execMain.c.html#LN766"><span class='Ref_to_Parameter'>plannedstmt</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecCheckXactReadOnly &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      InitPlan 
 * 
 *      Initializes the query plan: open files, allocate storage 
 *      and start up the rule manager 
 * ---------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN803"></a><span class='Declare_Function'>InitPlan</span><span class='Parentheses'>(</span><a href="../../include/executor/execdesc.h.html#LN32"><span class='Ref_to_Struct'>QueryDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>queryDesc</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>eflags</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN805"></a>    <a href="../../include/nodes/nodes.h.html#LN647"><span class='Ref_to_Enum'>CmdType</span></a>     <span class='Declare_Local'>operation</span> <span class='Operator'>= </span><a href="execMain.c.html#LN803"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN35"><span class='Ref_to_Member'>operation</span></a><span class='Delimiter'>; 
</span><a name="LN806"></a>    <a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>plannedstmt</span> <span class='Operator'>= </span><a href="execMain.c.html#LN803"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN36"><span class='Ref_to_Member'>plannedstmt</span></a><span class='Delimiter'>; 
</span><a name="LN807"></a>    <a href="../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>plan</span> <span class='Operator'>= </span><a href="execMain.c.html#LN806"><span class='Ref_To_Local'>plannedstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN60"><span class='Ref_to_Member'>planTree</span></a><span class='Delimiter'>; 
</span><a name="LN808"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>rangeTable</span> <span class='Operator'>= </span><a href="execMain.c.html#LN806"><span class='Ref_To_Local'>plannedstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN62"><span class='Ref_to_Member'>rtable</span></a><span class='Delimiter'>; 
</span><a name="LN809"></a>    <a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>estate</span> <span class='Operator'>= </span><a href="execMain.c.html#LN803"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN47"><span class='Ref_to_Member'>estate</span></a><span class='Delimiter'>; 
</span><a name="LN810"></a>    <a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>planstate</span><span class='Delimiter'>; 
</span><a name="LN811"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupType</span><span class='Delimiter'>; 
</span><a name="LN812"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span><a name="LN813"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Do permissions checks 
     */ 
</span>    <a href="../../include/executor/executor.h.html#LN178"><span class='Ref_to_Proto'>ExecCheckRTPerms</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN808"><span class='Ref_To_Local'>rangeTable</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initialize the node's execution state 
     */ 
</span>    <a href="execMain.c.html#LN809"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN410"><span class='Ref_to_Member'>es_range_table</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN808"><span class='Ref_To_Local'>rangeTable</span></a><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN809"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN411"><span class='Ref_to_Member'>es_plannedstmt</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN806"><span class='Ref_To_Local'>plannedstmt</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initialize result relation stuff, and open/lock the result rels. 
     * 
     * We must do this before initializing the plan tree, else we might try to 
     * do a lock upgrade if a result rel is also a source rel. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN806"><span class='Ref_To_Local'>plannedstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN65"><span class='Ref_to_Member'>resultRelations</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN834"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>resultRelations</span> <span class='Operator'>= </span><a href="execMain.c.html#LN806"><span class='Ref_To_Local'>plannedstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN65"><span class='Ref_to_Member'>resultRelations</span></a><span class='Delimiter'>; 
</span><a name="LN835"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>numResultRelations</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN834"><span class='Ref_To_Local'>resultRelations</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN836"></a>        <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>resultRelInfos</span><span class='Delimiter'>; 
</span><a name="LN837"></a>        <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>resultRelInfo</span><span class='Delimiter'>; 
</span> 
        <a href="execMain.c.html#LN836"><span class='Ref_To_Local'>resultRelInfos</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN835"><span class='Ref_To_Local'>numResultRelations</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN837"><span class='Ref_To_Local'>resultRelInfo</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN836"><span class='Ref_To_Local'>resultRelInfos</span></a><span class='Delimiter'>; 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN812"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN834"><span class='Ref_To_Local'>resultRelations</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN844"></a>            <a href="../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a>       <span class='Declare_Local'>resultRelationIndex</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN812"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN845"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>resultRelationOid</span><span class='Delimiter'>; 
</span><a name="LN846"></a>            <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>resultRelation</span><span class='Delimiter'>; 
</span> 
            <a href="execMain.c.html#LN845"><span class='Ref_To_Local'>resultRelationOid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parsetree.h.html#LN40"><span class='Ref_to_Macro'>getrelid</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN844"><span class='Ref_To_Local'>resultRelationIndex</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN808"><span class='Ref_To_Local'>rangeTable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="execMain.c.html#LN846"><span class='Ref_To_Local'>resultRelation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN845"><span class='Ref_To_Local'>resultRelationOid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/executor/executor.h.html#LN180"><span class='Ref_to_Proto'>InitResultRelInfo</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN837"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, 
</span>                              <a href="execMain.c.html#LN846"><span class='Ref_To_Local'>resultRelation</span></a><span class='Delimiter'>, 
</span>                              <a href="execMain.c.html#LN844"><span class='Ref_To_Local'>resultRelationIndex</span></a><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                              <a href="execMain.c.html#LN809"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN457"><span class='Ref_to_Member'>es_instrument</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="execMain.c.html#LN837"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="execMain.c.html#LN809"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN420"><span class='Ref_to_Member'>es_result_relations</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN836"><span class='Ref_To_Local'>resultRelInfos</span></a><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN809"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN421"><span class='Ref_to_Member'>es_num_result_relations</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN835"><span class='Ref_To_Local'>numResultRelations</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* es_result_relation_info is NULL except when within ModifyTable */ 
</span>        <a href="execMain.c.html#LN809"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN422"><span class='Ref_to_Member'>es_result_relation_info</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * In the partitioned result relation case, lock the non-leaf result 
         * relations too.  A subset of these are the roots of respective 
         * partitioned tables, for which we also allocate ResulRelInfos. 
         */ 
</span>        <a href="execMain.c.html#LN809"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN431"><span class='Ref_to_Member'>es_root_result_relations</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN809"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN432"><span class='Ref_to_Member'>es_num_root_result_relations</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN806"><span class='Ref_To_Local'>plannedstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN71"><span class='Ref_to_Member'>nonleafResultRelations</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN872"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>num_roots</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN806"><span class='Ref_To_Local'>plannedstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN78"><span class='Ref_to_Member'>rootResultRelations</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Firstly, build ResultRelInfos for all the partitioned table 
             * roots, because we will need them to fire the statement-level 
             * triggers, if any. 
             */ 
</span>            <a href="execMain.c.html#LN836"><span class='Ref_To_Local'>resultRelInfos</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                <a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN872"><span class='Ref_To_Local'>num_roots</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="execMain.c.html#LN837"><span class='Ref_To_Local'>resultRelInfo</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN836"><span class='Ref_To_Local'>resultRelInfos</span></a><span class='Delimiter'>; 
</span>            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN812"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN806"><span class='Ref_To_Local'>plannedstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN78"><span class='Ref_to_Member'>rootResultRelations</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN884"></a>                <a href="../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a>       <span class='Declare_Local'>resultRelIndex</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN812"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN885"></a>                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>resultRelOid</span><span class='Delimiter'>; 
</span><a name="LN886"></a>                <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>resultRelDesc</span><span class='Delimiter'>; 
</span> 
                <a href="execMain.c.html#LN885"><span class='Ref_To_Local'>resultRelOid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parsetree.h.html#LN40"><span class='Ref_to_Macro'>getrelid</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN884"><span class='Ref_To_Local'>resultRelIndex</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN808"><span class='Ref_To_Local'>rangeTable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="execMain.c.html#LN886"><span class='Ref_To_Local'>resultRelDesc</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN885"><span class='Ref_To_Local'>resultRelOid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/executor/executor.h.html#LN180"><span class='Ref_to_Proto'>InitResultRelInfo</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN837"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, 
</span>                                  <a href="execMain.c.html#LN886"><span class='Ref_To_Local'>resultRelDesc</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN812"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                  <a href="execMain.c.html#LN809"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN457"><span class='Ref_to_Member'>es_instrument</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="execMain.c.html#LN837"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="execMain.c.html#LN809"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN431"><span class='Ref_to_Member'>es_root_result_relations</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN836"><span class='Ref_To_Local'>resultRelInfos</span></a><span class='Delimiter'>; 
</span>            <a href="execMain.c.html#LN809"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN432"><span class='Ref_to_Member'>es_num_root_result_relations</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN872"><span class='Ref_To_Local'>num_roots</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Simply lock the rest of them. */ 
</span>            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN812"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN806"><span class='Ref_To_Local'>plannedstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN71"><span class='Ref_to_Member'>nonleafResultRelations</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN904"></a>                <a href="../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a>       <span class='Declare_Local'>resultRelIndex</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN812"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* We locked the roots above. */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/nodes/pg_list.h.html#LN230"><span class='Ref_to_Proto'>list_member_int</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN806"><span class='Ref_To_Local'>plannedstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN78"><span class='Ref_to_Member'>rootResultRelations</span></a><span class='Delimiter'>, 
</span>                                     <a href="execMain.c.html#LN904"><span class='Ref_To_Local'>resultRelIndex</span></a><span class='Parentheses'>))</span> 
                    <a href="../../include/storage/lmgr.h.html#LN39"><span class='Ref_to_Proto'>LockRelationOid</span></a><span class='Parentheses'>(</span><a href="../../include/parser/parsetree.h.html#LN40"><span class='Ref_to_Macro'>getrelid</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN904"><span class='Ref_To_Local'>resultRelIndex</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN808"><span class='Ref_To_Local'>rangeTable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                    <a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if plannedstmt-&GT;nonleafR... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if plannedstmt-&GT;resultRe... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * if no result relation, then set state appropriately 
         */ 
</span>        <a href="execMain.c.html#LN809"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN420"><span class='Ref_to_Member'>es_result_relations</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN809"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN421"><span class='Ref_to_Member'>es_num_result_relations</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN809"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN422"><span class='Ref_to_Member'>es_result_relation_info</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN809"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN431"><span class='Ref_to_Member'>es_root_result_relations</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN809"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN432"><span class='Ref_to_Member'>es_num_root_result_relations</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Similarly, we have to lock relations selected FOR [KEY] UPDATE/SHARE 
     * before we initialize the plan tree, else we'd be risking lock upgrades. 
     * While we are at it, build the ExecRowMark list.  Any partitioned child 
     * tables are ignored here (because isParent=true) and will be locked by 
     * the first Append or MergeAppend node that references them.  (Note that 
     * the RowMarks corresponding to partitioned child tables are present in 
     * the same list as the rest, i.e., plannedstmt-&GT;rowMarks.) 
     */ 
</span>    <a href="execMain.c.html#LN809"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN451"><span class='Ref_to_Member'>es_rowMarks</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN812"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN806"><span class='Ref_To_Local'>plannedstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN85"><span class='Ref_to_Member'>rowMarks</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN938"></a>        <a href="../../include/nodes/plannodes.h.html#LN1002"><span class='Ref_to_Struct'>PlanRowMark</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rc</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN1002"><span class='Ref_to_Struct'>PlanRowMark</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN812"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN939"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span><span class='Delimiter'>; 
</span><a name="LN940"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span><a name="LN941"></a>        <a href="../../include/nodes/execnodes.h.html#LN508"><span class='Ref_to_Struct'>ExecRowMark</span></a> <span class='Operator'>*</span><span class='Declare_Local'>erm</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* ignore "parent" rowmarks; they are irrelevant at runtime */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN938"><span class='Ref_To_Local'>rc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN1012"><span class='Ref_to_Member'>isParent</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* get relation's OID (will produce InvalidOid if subquery) */ 
</span>        <a href="execMain.c.html#LN939"><span class='Ref_To_Local'>relid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parsetree.h.html#LN40"><span class='Ref_to_Macro'>getrelid</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN938"><span class='Ref_To_Local'>rc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN1005"><span class='Ref_to_Member'>rti</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN808"><span class='Ref_To_Local'>rangeTable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If you change the conditions under which rel locks are acquired 
         * here, be sure to adjust ExecOpenScanRelation to match. 
         */ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN938"><span class='Ref_To_Local'>rc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN1008"><span class='Ref_to_Member'>markType</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/plannodes.h.html#LN953"><span class='Ref_to_EnumConst'>ROW_MARK_EXCLUSIVE</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/plannodes.h.html#LN954"><span class='Ref_to_EnumConst'>ROW_MARK_NOKEYEXCLUSIVE</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/plannodes.h.html#LN955"><span class='Ref_to_EnumConst'>ROW_MARK_SHARE</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/plannodes.h.html#LN956"><span class='Ref_to_EnumConst'>ROW_MARK_KEYSHARE</span></a><span class='Operator'>: 
</span>                <a href="execMain.c.html#LN940"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN939"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN36"><span class='Ref_to_Const'>RowShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/plannodes.h.html#LN957"><span class='Ref_to_EnumConst'>ROW_MARK_REFERENCE</span></a><span class='Operator'>: 
</span>                <a href="execMain.c.html#LN940"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN939"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/plannodes.h.html#LN958"><span class='Ref_to_EnumConst'>ROW_MARK_COPY</span></a><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* no physical table access is required */ 
</span>                <a href="execMain.c.html#LN940"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized markType: %d"</span><span class='Delimiter'>, </span><a href="execMain.c.html#LN938"><span class='Ref_To_Local'>rc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN1008"><span class='Ref_to_Member'>markType</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="execMain.c.html#LN940"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch rc-&GT;markType &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* Check that relation is a legal target for marking */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN940"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>) 
</span>            <a href="execMain.c.html#LN78"><span class='Ref_to_Proto'>CheckValidRowMarkRel</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN940"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN938"><span class='Ref_To_Local'>rc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN1008"><span class='Ref_to_Member'>markType</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="execMain.c.html#LN941"><span class='Ref_To_Local'>erm</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN508"><span class='Ref_to_Struct'>ExecRowMark</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN508"><span class='Ref_to_Struct'>ExecRowMark</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN941"><span class='Ref_To_Local'>erm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN510"><span class='Ref_to_Member'>relation</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN940"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN941"><span class='Ref_To_Local'>erm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN511"><span class='Ref_to_Member'>relid</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN939"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN941"><span class='Ref_To_Local'>erm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN512"><span class='Ref_to_Member'>rti</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN938"><span class='Ref_To_Local'>rc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN1005"><span class='Ref_to_Member'>rti</span></a><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN941"><span class='Ref_To_Local'>erm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN513"><span class='Ref_to_Member'>prti</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN938"><span class='Ref_To_Local'>rc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN1006"><span class='Ref_to_Member'>prti</span></a><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN941"><span class='Ref_To_Local'>erm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN514"><span class='Ref_to_Member'>rowmarkId</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN938"><span class='Ref_To_Local'>rc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN1007"><span class='Ref_to_Member'>rowmarkId</span></a><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN941"><span class='Ref_To_Local'>erm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN515"><span class='Ref_to_Member'>markType</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN938"><span class='Ref_To_Local'>rc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN1008"><span class='Ref_to_Member'>markType</span></a><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN941"><span class='Ref_To_Local'>erm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN516"><span class='Ref_to_Member'>strength</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN938"><span class='Ref_To_Local'>rc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN1010"><span class='Ref_to_Member'>strength</span></a><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN941"><span class='Ref_To_Local'>erm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN517"><span class='Ref_to_Member'>waitPolicy</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN938"><span class='Ref_To_Local'>rc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN1011"><span class='Ref_to_Member'>waitPolicy</span></a><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN941"><span class='Ref_To_Local'>erm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN518"><span class='Ref_to_Member'>ermActive</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="../../include/storage/itemptr.h.html#LN148"><span class='Ref_to_Macro'>ItemPointerSetInvalid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="execMain.c.html#LN941"><span class='Ref_To_Local'>erm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN519"><span class='Ref_to_Member'>curCtid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN941"><span class='Ref_To_Local'>erm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN520"><span class='Ref_to_Member'>ermExtra</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN809"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN451"><span class='Ref_to_Member'>es_rowMarks</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN809"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN451"><span class='Ref_to_Member'>es_rowMarks</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN941"><span class='Ref_To_Local'>erm</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Initialize the executor's tuple table to empty. 
     */ 
</span>    <a href="execMain.c.html#LN809"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN449"><span class='Ref_to_Member'>es_tupleTable</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN809"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN436"><span class='Ref_to_Member'>es_trig_tuple_slot</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN809"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN437"><span class='Ref_to_Member'>es_trig_oldtup_slot</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN809"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN438"><span class='Ref_to_Member'>es_trig_newtup_slot</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* mark EvalPlanQual not active */ 
</span>    <a href="execMain.c.html#LN809"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN482"><span class='Ref_to_Member'>es_epqTuple</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN809"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN483"><span class='Ref_to_Member'>es_epqTupleSet</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN809"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN484"><span class='Ref_to_Member'>es_epqScanDone</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Initialize private state information for each SubPlan.  We must do this 
     * before running ExecInitNode on the main query tree, since 
     * ExecInitSubPlan expects to be able to find these entries. 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="execMain.c.html#LN809"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN462"><span class='Ref_to_Member'>es_subplanstates</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN813"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>;</span>                      <span class='Comment_Single_Line'>/* subplan indices count from 1 */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN812"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN806"><span class='Ref_To_Local'>plannedstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN80"><span class='Ref_to_Member'>subplans</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1016"></a>        <a href="../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>subplan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN812"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1017"></a>        <a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>subplanstate</span><span class='Delimiter'>; 
</span><a name="LN1018"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>sp_eflags</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * A subplan will never need to do BACKWARD scan nor MARK/RESTORE. If 
         * it is a parameterless subplan (not initplan), we suggest that it be 
         * prepared to handle REWIND efficiently; otherwise there is no need. 
         */ 
</span>        <a href="execMain.c.html#LN1018"><span class='Ref_To_Local'>sp_eflags</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN803"><span class='Ref_to_Parameter'>eflags</span></a> 
            <span class='Operator'>& </span><span class='Parentheses'>(</span><a href="../../include/executor/executor.h.html#LN57"><span class='Ref_to_Const'>EXEC_FLAG_EXPLAIN_ONLY</span></a> <span class='Operator'>| </span><a href="../../include/executor/executor.h.html#LN64"><span class='Ref_to_Const'>EXEC_FLAG_WITH_NO_DATA</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/bitmapset.h.html#LN75"><span class='Ref_to_Proto'>bms_is_member</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN813"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN806"><span class='Ref_To_Local'>plannedstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN83"><span class='Ref_to_Member'>rewindPlanIDs</span></a><span class='Parentheses'>))</span> 
            <a href="execMain.c.html#LN1018"><span class='Ref_To_Local'>sp_eflags</span></a> <span class='Operator'>|= </span><a href="../../include/executor/executor.h.html#LN58"><span class='Ref_to_Const'>EXEC_FLAG_REWIND</span></a><span class='Delimiter'>; 
</span> 
        <a href="execMain.c.html#LN1017"><span class='Ref_To_Local'>subplanstate</span></a> <span class='Operator'>= </span><a href="execProcnode.c.html#LN138"><span class='Ref_to_Func'>ExecInitNode</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1016"><span class='Ref_To_Local'>subplan</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN809"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1018"><span class='Ref_To_Local'>sp_eflags</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="execMain.c.html#LN809"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN462"><span class='Ref_to_Member'>es_subplanstates</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN809"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN462"><span class='Ref_to_Member'>es_subplanstates</span></a><span class='Delimiter'>, 
</span>                                           <a href="execMain.c.html#LN1017"><span class='Ref_To_Local'>subplanstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="execMain.c.html#LN813"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Initialize the private state information for all the nodes in the query 
     * tree.  This opens files, allocates storage and leaves us ready to start 
     * processing tuples. 
     */ 
</span>    <a href="execMain.c.html#LN810"><span class='Ref_To_Local'>planstate</span></a> <span class='Operator'>= </span><a href="execProcnode.c.html#LN138"><span class='Ref_to_Func'>ExecInitNode</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN807"><span class='Ref_To_Local'>plan</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN809"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN803"><span class='Ref_to_Parameter'>eflags</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get the tuple descriptor describing the type of tuples to return. 
     */ 
</span>    <a href="execMain.c.html#LN811"><span class='Ref_To_Local'>tupType</span></a> <span class='Operator'>= </span><a href="execUtils.c.html#LN467"><span class='Ref_to_Func'>ExecGetResultType</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN810"><span class='Ref_To_Local'>planstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Initialize the junk filter if needed.  SELECT queries need a filter if 
     * there are any junk attrs in the top-level tlist. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN805"><span class='Ref_To_Local'>operation</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN650"><span class='Ref_to_EnumConst'>CMD_SELECT</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1056"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>junk_filter_needed</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN1057"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>tlist</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1057"><span class='Ref_To_Local'>tlist</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN807"><span class='Ref_To_Local'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1061"></a>            <a href="../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tle</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1057"><span class='Ref_To_Local'>tlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1061"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1373"><span class='Ref_to_Member'>resjunk</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="execMain.c.html#LN1056"><span class='Ref_To_Local'>junk_filter_needed</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1056"><span class='Ref_To_Local'>junk_filter_needed</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1072"></a>            <a href="../../include/nodes/execnodes.h.html#LN328"><span class='Ref_to_Struct'>JunkFilter</span></a> <span class='Operator'>*</span><span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span> 
            <a href="execMain.c.html#LN1072"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><a href="execJunk.c.html#LN59"><span class='Ref_to_Func'>ExecInitJunkFilter</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN810"><span class='Ref_To_Local'>planstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN812"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Delimiter'>, 
</span>                                   <a href="execMain.c.html#LN811"><span class='Ref_To_Local'>tupType</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN78"><span class='Ref_to_Member'>tdhasoid</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../include/executor/executor.h.html#LN402"><span class='Ref_to_Proto'>ExecInitExtraTupleSlot</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN809"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="execMain.c.html#LN809"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN414"><span class='Ref_to_Member'>es_junkFilter</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN1072"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Want to return the cleaned tuple type */ 
</span>            <a href="execMain.c.html#LN811"><span class='Ref_To_Local'>tupType</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN1072"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN332"><span class='Ref_to_Member'>jf_cleanTupType</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if operation==CMD_SELECT &raquo; </span> 
 
    <a href="execMain.c.html#LN803"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN46"><span class='Ref_to_Member'>tupDesc</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN811"><span class='Ref_To_Local'>tupType</span></a><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN803"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN48"><span class='Ref_to_Member'>planstate</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN810"><span class='Ref_To_Local'>planstate</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end InitPlan &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Check that a proposed result relation is a legal target for the operation 
 * 
 * Generally the parser and/or planner should have noticed any such mistake 
 * already, but let's make sure. 
 * 
 * Note: when changing this function, you probably also need to look at 
 * CheckValidRowMarkRel. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1098"></a><span class='Declare_Function'>CheckValidResultRel</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>resultRel</span><span class='Delimiter'>, </span><a href="../../include/nodes/nodes.h.html#LN647"><span class='Ref_to_Enum'>CmdType</span></a> <span class='Declare_Parameter'>operation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1100"></a>    <a href="../../include/utils/reltrigger.h.html#LN45"><span class='Ref_to_Struct'>TriggerDesc</span></a> <span class='Operator'>*</span><span class='Declare_Local'>trigDesc</span> <span class='Operator'>= </span><a href="execMain.c.html#LN1098"><span class='Ref_to_Parameter'>resultRel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN119"><span class='Ref_to_Member'>trigdesc</span></a><span class='Delimiter'>; 
</span><a name="LN1101"></a>    <a href="../../include/foreign/fdwapi.h.html#LN168"><span class='Ref_to_Struct'>FdwRoutine</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fdwroutine</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1098"><span class='Ref_to_Parameter'>resultRel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Operator'>: 
</span>            <a href="execReplication.c.html#LN520"><span class='Ref_to_Func'>CheckCmdReplicaIdentity</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1098"><span class='Ref_to_Parameter'>resultRel</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1098"><span class='Ref_to_Parameter'>operation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Operator'>: 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot change sequence \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1098"><span class='Ref_to_Parameter'>resultRel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN162"><span class='Ref_to_Const'>RELKIND_TOASTVALUE</span></a><span class='Operator'>: 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot change TOAST relation \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1098"><span class='Ref_to_Parameter'>resultRel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN163"><span class='Ref_to_Const'>RELKIND_VIEW</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Okay only if there's a suitable INSTEAD OF trigger.  Messages 
             * here should match rewriteHandler.c's rewriteTargetView, except 
             * that we omit errdetail because we haven't got the information 
             * handy (and given that we really shouldn't get here anyway, it's 
             * not worth great exertion to get). 
             */ 
</span>            <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1098"><span class='Ref_to_Parameter'>operation</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN652"><span class='Ref_to_EnumConst'>CMD_INSERT</span></a><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="execMain.c.html#LN1100"><span class='Ref_To_Local'>trigDesc</span></a> <span class='Operator'>|| !</span><a href="execMain.c.html#LN1100"><span class='Ref_To_Local'>trigDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN56"><span class='Ref_to_Member'>trig_insert_instead_row</span></a><span class='Parentheses'>) 
</span>                        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                          <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot insert into view \"%s\""</span><span class='Delimiter'>, 
</span>                                  <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1098"><span class='Ref_to_Parameter'>resultRel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                           <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"To enable inserting into the view, provide an INSTEAD OF INSERT trigger or an unconditional ON INSERT DO INSTEAD rule."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN651"><span class='Ref_to_EnumConst'>CMD_UPDATE</span></a><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="execMain.c.html#LN1100"><span class='Ref_To_Local'>trigDesc</span></a> <span class='Operator'>|| !</span><a href="execMain.c.html#LN1100"><span class='Ref_To_Local'>trigDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN61"><span class='Ref_to_Member'>trig_update_instead_row</span></a><span class='Parentheses'>) 
</span>                        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                          <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot update view \"%s\""</span><span class='Delimiter'>, 
</span>                                  <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1098"><span class='Ref_to_Parameter'>resultRel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                           <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"To enable updating the view, provide an INSTEAD OF UPDATE trigger or an unconditional ON UPDATE DO INSTEAD rule."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN653"><span class='Ref_to_EnumConst'>CMD_DELETE</span></a><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="execMain.c.html#LN1100"><span class='Ref_To_Local'>trigDesc</span></a> <span class='Operator'>|| !</span><a href="execMain.c.html#LN1100"><span class='Ref_To_Local'>trigDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN66"><span class='Ref_to_Member'>trig_delete_instead_row</span></a><span class='Parentheses'>) 
</span>                        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                          <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot delete from view \"%s\""</span><span class='Delimiter'>, 
</span>                                  <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1098"><span class='Ref_to_Parameter'>resultRel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                           <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"To enable deleting from the view, provide an INSTEAD OF DELETE trigger or an unconditional ON DELETE DO INSTEAD rule."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>default</span><span class='Operator'>: 
</span>                    <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized CmdType: %d"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="execMain.c.html#LN1098"><span class='Ref_to_Parameter'>operation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch operation &raquo; </span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/commands/matview.h.html#LN30"><span class='Ref_to_Proto'>MatViewIncrementalMaintenanceIsEnabled</span></a><span class='Parentheses'>())</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot change materialized view \"%s\""</span><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1098"><span class='Ref_to_Parameter'>resultRel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Okay only if the FDW supports it */ 
</span>            <a href="execMain.c.html#LN1101"><span class='Ref_To_Local'>fdwroutine</span></a> <span class='Operator'>= </span><a href="../../include/foreign/fdwapi.h.html#LN236"><span class='Ref_to_Proto'>GetFdwRoutineForRelation</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1098"><span class='Ref_to_Parameter'>resultRel</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1098"><span class='Ref_to_Parameter'>operation</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN652"><span class='Ref_to_EnumConst'>CMD_INSERT</span></a><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1101"><span class='Ref_To_Local'>fdwroutine</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/fdwapi.h.html#LN196"><span class='Ref_to_Member'>ExecForeignInsert</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot insert into foreign table \"%s\""</span><span class='Delimiter'>, 
</span>                                   <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1098"><span class='Ref_to_Parameter'>resultRel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1101"><span class='Ref_To_Local'>fdwroutine</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/fdwapi.h.html#LN200"><span class='Ref_to_Member'>IsForeignRelUpdatable</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>                        <span class='Parentheses'>(</span><a href="execMain.c.html#LN1101"><span class='Ref_To_Local'>fdwroutine</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/fdwapi.h.html#LN200"><span class='Ref_to_Member'>IsForeignRelUpdatable</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1098"><span class='Ref_to_Parameter'>resultRel</span></a><span class='Parentheses'>) </span><span class='Operator'>& </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><a href="../../include/nodes/nodes.h.html#LN652"><span class='Ref_to_EnumConst'>CMD_INSERT</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                          <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"foreign table \"%s\" does not allow inserts"</span><span class='Delimiter'>, 
</span>                               <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1098"><span class='Ref_to_Parameter'>resultRel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN651"><span class='Ref_to_EnumConst'>CMD_UPDATE</span></a><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1101"><span class='Ref_To_Local'>fdwroutine</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/fdwapi.h.html#LN197"><span class='Ref_to_Member'>ExecForeignUpdate</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot update foreign table \"%s\""</span><span class='Delimiter'>, 
</span>                                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1098"><span class='Ref_to_Parameter'>resultRel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1101"><span class='Ref_To_Local'>fdwroutine</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/fdwapi.h.html#LN200"><span class='Ref_to_Member'>IsForeignRelUpdatable</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>                        <span class='Parentheses'>(</span><a href="execMain.c.html#LN1101"><span class='Ref_To_Local'>fdwroutine</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/fdwapi.h.html#LN200"><span class='Ref_to_Member'>IsForeignRelUpdatable</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1098"><span class='Ref_to_Parameter'>resultRel</span></a><span class='Parentheses'>) </span><span class='Operator'>& </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><a href="../../include/nodes/nodes.h.html#LN651"><span class='Ref_to_EnumConst'>CMD_UPDATE</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                          <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"foreign table \"%s\" does not allow updates"</span><span class='Delimiter'>, 
</span>                               <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1098"><span class='Ref_to_Parameter'>resultRel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN653"><span class='Ref_to_EnumConst'>CMD_DELETE</span></a><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1101"><span class='Ref_To_Local'>fdwroutine</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/fdwapi.h.html#LN198"><span class='Ref_to_Member'>ExecForeignDelete</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot delete from foreign table \"%s\""</span><span class='Delimiter'>, 
</span>                                   <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1098"><span class='Ref_to_Parameter'>resultRel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1101"><span class='Ref_To_Local'>fdwroutine</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/fdwapi.h.html#LN200"><span class='Ref_to_Member'>IsForeignRelUpdatable</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>                        <span class='Parentheses'>(</span><a href="execMain.c.html#LN1101"><span class='Ref_To_Local'>fdwroutine</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/fdwapi.h.html#LN200"><span class='Ref_to_Member'>IsForeignRelUpdatable</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1098"><span class='Ref_to_Parameter'>resultRel</span></a><span class='Parentheses'>) </span><span class='Operator'>& </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><a href="../../include/nodes/nodes.h.html#LN653"><span class='Ref_to_EnumConst'>CMD_DELETE</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                          <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"foreign table \"%s\" does not allow deletes"</span><span class='Delimiter'>, 
</span>                               <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1098"><span class='Ref_to_Parameter'>resultRel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>default</span><span class='Operator'>: 
</span>                    <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized CmdType: %d"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="execMain.c.html#LN1098"><span class='Ref_to_Parameter'>operation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch operation &raquo; </span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot change relation \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1098"><span class='Ref_to_Parameter'>resultRel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch resultRel-&GT;rd_rel-&GT;re... &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end CheckValidResultRel &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Check that a proposed rowmark target relation is a legal target 
 * 
 * In most cases parser and/or planner should have noticed this already, but 
 * they don't cover all cases. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1233"></a><span class='Declare_Function'>CheckValidRowMarkRel</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/nodes/plannodes.h.html#LN951"><span class='Ref_to_Enum'>RowMarkType</span></a> <span class='Declare_Parameter'>markType</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1235"></a>    <a href="../../include/foreign/fdwapi.h.html#LN168"><span class='Ref_to_Struct'>FdwRoutine</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fdwroutine</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1233"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* OK */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Must disallow this because we don't vacuum sequences */ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot lock rows in sequence \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1233"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN162"><span class='Ref_to_Const'>RELKIND_TOASTVALUE</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* We could allow this, but there seems no good reason to */ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot lock rows in TOAST relation \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1233"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN163"><span class='Ref_to_Const'>RELKIND_VIEW</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Should not get here; planner should have expanded the view */ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot lock rows in view \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1233"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Allow referencing a matview, but not actual locking clauses */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1233"><span class='Ref_to_Parameter'>markType</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/plannodes.h.html#LN957"><span class='Ref_to_EnumConst'>ROW_MARK_REFERENCE</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                       <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot lock rows in materialized view \"%s\""</span><span class='Delimiter'>, 
</span>                              <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1233"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Okay only if the FDW supports it */ 
</span>            <a href="execMain.c.html#LN1235"><span class='Ref_To_Local'>fdwroutine</span></a> <span class='Operator'>= </span><a href="../../include/foreign/fdwapi.h.html#LN236"><span class='Ref_to_Proto'>GetFdwRoutineForRelation</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1233"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1235"><span class='Ref_To_Local'>fdwroutine</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/fdwapi.h.html#LN208"><span class='Ref_to_Member'>RefetchForeignRow</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot lock rows in foreign table \"%s\""</span><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1233"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot lock rows in relation \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1233"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch rel-&GT;rd_rel-&GT;relkind &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end CheckValidRowMarkRel &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Initialize ResultRelInfo data for one result relation 
 * 
 * Caution: before Postgres 9.1, this function included the relkind checking 
 * that's now in CheckValidResultRel, and it also did ExecOpenIndices if 
 * appropriate.  Be sure callers cover those needs. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1298"></a><span class='Declare_Function'>InitResultRelInfo</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>resultRelInfo</span><span class='Delimiter'>, 
</span><a name="LN1299"></a>                  <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>resultRelationDesc</span><span class='Delimiter'>, 
</span><a name="LN1300"></a>                  <a href="../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>resultRelationIndex</span><span class='Delimiter'>, 
</span><a name="LN1301"></a>                  <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>partition_root</span><span class='Delimiter'>, 
</span><a name="LN1302"></a>                  <span class='Keyword'>int </span><span class='Declare_Parameter'>instrument_options</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1304"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>partition_check</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1298"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN1298"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN371"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN36"><span class='Ref_to_EnumConst'>T_ResultRelInfo</span></a><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN1298"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN372"><span class='Ref_to_Member'>ri_RangeTableIndex</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN1300"><span class='Ref_to_Parameter'>resultRelationIndex</span></a><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN1298"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN1299"><span class='Ref_to_Parameter'>resultRelationDesc</span></a><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN1298"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN374"><span class='Ref_to_Member'>ri_NumIndices</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN1298"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN375"><span class='Ref_to_Member'>ri_IndexRelationDescs</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN1298"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN376"><span class='Ref_to_Member'>ri_IndexRelationInfo</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* make a copy so as not to depend on relcache info not changing... */ 
</span>    <a href="execMain.c.html#LN1298"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a> <span class='Operator'>= </span><a href="../../include/commands/trigger.h.html#LN127"><span class='Ref_to_Proto'>CopyTriggerDesc</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1299"><span class='Ref_to_Parameter'>resultRelationDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN119"><span class='Ref_to_Member'>trigdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1298"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1317"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>n</span> <span class='Operator'>= </span><a href="execMain.c.html#LN1298"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN48"><span class='Ref_to_Member'>numtriggers</span></a><span class='Delimiter'>; 
</span> 
        <a href="execMain.c.html#LN1298"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN378"><span class='Ref_to_Member'>ri_TrigFunctions</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1317"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN1298"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN379"><span class='Ref_to_Member'>ri_TrigWhenExprs</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a> <span class='Operator'>**</span><span class='Parentheses'>) 
</span>            <a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1317"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a> <span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1302"><span class='Ref_to_Parameter'>instrument_options</span></a><span class='Parentheses'>) 
</span>            <a href="execMain.c.html#LN1298"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN380"><span class='Ref_to_Member'>ri_TrigInstrument</span></a> <span class='Operator'>= </span><a href="instrument.c.html#LN28"><span class='Ref_to_Func'>InstrAlloc</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1317"><span class='Ref_To_Local'>n</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1302"><span class='Ref_to_Parameter'>instrument_options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="execMain.c.html#LN1298"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN378"><span class='Ref_to_Member'>ri_TrigFunctions</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN1298"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN379"><span class='Ref_to_Member'>ri_TrigWhenExprs</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN1298"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN380"><span class='Ref_to_Member'>ri_TrigInstrument</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1299"><span class='Ref_to_Parameter'>resultRelationDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a><span class='Parentheses'>) 
</span>        <a href="execMain.c.html#LN1298"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN381"><span class='Ref_to_Member'>ri_FdwRoutine</span></a> <span class='Operator'>= </span><a href="../../include/foreign/fdwapi.h.html#LN236"><span class='Ref_to_Proto'>GetFdwRoutineForRelation</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1299"><span class='Ref_to_Parameter'>resultRelationDesc</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="execMain.c.html#LN1298"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN381"><span class='Ref_to_Member'>ri_FdwRoutine</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN1298"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN382"><span class='Ref_to_Member'>ri_FdwState</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN1298"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN383"><span class='Ref_to_Member'>ri_usesFdwDirectModify</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN1298"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN386"><span class='Ref_to_Member'>ri_ConstraintExprs</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN1298"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN387"><span class='Ref_to_Member'>ri_junkFilter</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN1298"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN388"><span class='Ref_to_Member'>ri_projectReturning</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Partition constraint, which also includes the partition constraint of 
     * all the ancestors that are partitions.  Note that it will be checked 
     * even in the case of tuple-routing where this table is the target leaf 
     * partition, if there any BR triggers defined on the table.  Although 
     * tuple-routing implicitly preserves the partition constraint of the 
     * target partition for a given row, the BR triggers may change the row 
     * such that the constraint is no longer satisfied, which we must fail for 
     * by checking it explicitly. 
     * 
     * If this is a partitioned table, the partition constraint (if any) of a 
     * given row will be checked just before performing tuple-routing. 
     */ 
</span>    <a href="execMain.c.html#LN1304"><span class='Ref_To_Local'>partition_check</span></a> <span class='Operator'>= </span><a href="../../include/catalog/partition.h.html#LN83"><span class='Ref_to_Proto'>RelationGetPartitionQual</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1299"><span class='Ref_to_Parameter'>resultRelationDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="execMain.c.html#LN1298"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN391"><span class='Ref_to_Member'>ri_PartitionCheck</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN1304"><span class='Ref_To_Local'>partition_check</span></a><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN1298"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN393"><span class='Ref_to_Member'>ri_PartitionRoot</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN1301"><span class='Ref_to_Parameter'>partition_root</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end InitResultRelInfo &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *      ExecGetTriggerResultRel 
 * 
 * Get a ResultRelInfo for a trigger target relation.  Most of the time, 
 * triggers are fired on one of the result relations of the query, and so 
 * we can just return a member of the es_result_relations array.  (Note: in 
 * self-join situations there might be multiple members with the same OID; 
 * if so it doesn't matter which one we pick.)  However, it is sometimes 
 * necessary to fire triggers on other relations; this happens mainly when an 
 * RI update trigger queues additional triggers on other relations, which will 
 * be processed in the context of the outer query.  For efficiency's sake, 
 * we want to have a ResultRelInfo for those triggers too; that can avoid 
 * repeated re-opening of the relation.  (It also provides a way for EXPLAIN 
 * ANALYZE to report the runtimes of such triggers.)  So we make additional 
 * ResultRelInfo's as needed, and save them in es_trig_target_relations. 
 */ 
</span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>* 
</span><a name="LN1378"></a><span class='Declare_Function'>ExecGetTriggerResultRel</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1380"></a>    <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rInfo</span><span class='Delimiter'>; 
</span><a name="LN1381"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nr</span><span class='Delimiter'>; 
</span><a name="LN1382"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span><a name="LN1383"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN1384"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* First, search through the query result relations */ 
</span>    <a href="execMain.c.html#LN1380"><span class='Ref_To_Local'>rInfo</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN1378"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN420"><span class='Ref_to_Member'>es_result_relations</span></a><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN1381"><span class='Ref_To_Local'>nr</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN1378"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN421"><span class='Ref_to_Member'>es_num_result_relations</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1381"><span class='Ref_To_Local'>nr</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1380"><span class='Ref_To_Local'>rInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="execMain.c.html#LN1378"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <a href="execMain.c.html#LN1380"><span class='Ref_To_Local'>rInfo</span></a><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN1380"><span class='Ref_To_Local'>rInfo</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN1381"><span class='Ref_To_Local'>nr</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Comment_Multi_Line'>/* Nope, but maybe we already made an extra ResultRelInfo for it */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1382"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1378"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN435"><span class='Ref_to_Member'>es_trig_target_relations</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="execMain.c.html#LN1380"><span class='Ref_To_Local'>rInfo</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1382"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1380"><span class='Ref_To_Local'>rInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="execMain.c.html#LN1378"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <a href="execMain.c.html#LN1380"><span class='Ref_To_Local'>rInfo</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Comment_Multi_Line'>/* Nope, so we need a new one */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Open the target relation's relcache entry.  We assume that an 
     * appropriate lock is still held by the backend from whenever the trigger 
     * event got queued, so we need take no new lock here.  Also, we need not 
     * recheck the relkind, so no need for CheckValidResultRel. 
     */ 
</span>    <a href="execMain.c.html#LN1383"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1378"><span class='Ref_to_Parameter'>relid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make the new entry in the right context. 
     */ 
</span>    <a href="execMain.c.html#LN1384"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1378"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN447"><span class='Ref_to_Member'>es_query_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN1380"><span class='Ref_To_Local'>rInfo</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/executor/executor.h.html#LN180"><span class='Ref_to_Proto'>InitResultRelInfo</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1380"><span class='Ref_To_Local'>rInfo</span></a><span class='Delimiter'>, 
</span>                      <a href="execMain.c.html#LN1383"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, 
</span>                      <span class='Number'>0</span><span class='Delimiter'>,</span>        <span class='Comment_Single_Line'>/* dummy rangetable index */ 
</span>                      <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                      <a href="execMain.c.html#LN1378"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN457"><span class='Ref_to_Member'>es_instrument</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN1378"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN435"><span class='Ref_to_Member'>es_trig_target_relations</span></a> <span class='Operator'>= 
</span>        <a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1378"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN435"><span class='Ref_to_Member'>es_trig_target_relations</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1380"><span class='Ref_To_Local'>rInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1384"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Currently, we don't need any index information in ResultRelInfos used 
     * only for triggers, so no need to call ExecOpenIndices. 
     */ 
</span> 
    <span class='Control'>return</span> <a href="execMain.c.html#LN1380"><span class='Ref_To_Local'>rInfo</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecGetTriggerResultRel &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Close any relations that have been opened by ExecGetTriggerResultRel(). 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1439"></a><span class='Declare_Function'>ExecCleanUpTriggerState</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1441"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1441"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1439"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN435"><span class='Ref_to_Member'>es_trig_target_relations</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1445"></a>        <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>resultRelInfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1441"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Close indices and then the relation itself */ 
</span>        <a href="execIndexing.c.html#LN222"><span class='Ref_to_Func'>ExecCloseIndices</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1445"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1445"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 *      ExecContextForcesOids 
 * 
 * This is pretty grotty: when doing INSERT, UPDATE, or CREATE TABLE AS, 
 * we need to ensure that result tuples have space for an OID iff they are 
 * going to be stored into a relation that has OIDs.  In other contexts 
 * we are free to choose whether to leave space for OIDs in result tuples 
 * (we generally don't want to, but we do if a physical-tlist optimization 
 * is possible).  This routine checks the plan context and returns TRUE if the 
 * choice is forced, FALSE if the choice is not forced.  In the TRUE case, 
 * *hasoids is set to the required value. 
 * 
 * One reason this is ugly is that all plan nodes in the plan tree will emit 
 * tuples with space for an OID, though we really only need the topmost node 
 * to do so.  However, node types like Sort don't project new tuples but just 
 * return their inputs, and in those cases the requirement propagates down 
 * to the input node.  Eventually we might make this code smart enough to 
 * recognize how far down the requirement really goes, but for now we just 
 * make all plan nodes do the same thing if the top level forces the choice. 
 * 
 * We assume that if we are generating tuples for INSERT or UPDATE, 
 * estate-&GT;es_result_relation_info is already set up to describe the target 
 * relation.  Note that in an UPDATE that spans an inheritance tree, some of 
 * the target relations may have OIDs and some not.  We have to make the 
 * decisions on a per-relation basis as we initialize each of the subplans of 
 * the ModifyTable node, so ModifyTable has to set es_result_relation_info 
 * while initializing each subplan. 
 * 
 * CREATE TABLE AS is even uglier, because we don't have the target relation's 
 * descriptor available when this code runs; we have to look aside at the 
 * flags passed to ExecutorStart(). 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN1486"></a><span class='Declare_Function'>ExecContextForcesOids</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>planstate</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>hasoids</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1488"></a>    <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ri</span> <span class='Operator'>= </span><a href="execMain.c.html#LN1486"><span class='Ref_to_Parameter'>planstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN814"><span class='Ref_to_Member'>state</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN422"><span class='Ref_to_Member'>es_result_relation_info</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1488"><span class='Ref_To_Local'>ri</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1492"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span> <span class='Operator'>= </span><a href="execMain.c.html#LN1488"><span class='Ref_To_Local'>ri</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1492"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="execMain.c.html#LN1486"><span class='Ref_to_Parameter'>hasoids</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN1492"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relhasoids<span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1486"><span class='Ref_to_Parameter'>planstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN814"><span class='Ref_to_Member'>state</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN456"><span class='Ref_to_Member'>es_top_eflags</span></a> <span class='Operator'>& </span><a href="../../include/executor/executor.h.html#LN62"><span class='Ref_to_Const'>EXEC_FLAG_WITH_OIDS</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="execMain.c.html#LN1486"><span class='Ref_to_Parameter'>hasoids</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1486"><span class='Ref_to_Parameter'>planstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN814"><span class='Ref_to_Member'>state</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN456"><span class='Ref_to_Member'>es_top_eflags</span></a> <span class='Operator'>& </span><a href="../../include/executor/executor.h.html#LN63"><span class='Ref_to_Const'>EXEC_FLAG_WITHOUT_OIDS</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="execMain.c.html#LN1486"><span class='Ref_to_Parameter'>hasoids</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecContextForcesOids &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      ExecPostprocessPlan 
 * 
 *      Give plan nodes a final chance to execute before shutdown 
 * ---------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1522"></a><span class='Declare_Function'>ExecPostprocessPlan</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1524"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make sure nodes run forward. 
     */ 
</span>    <a href="execMain.c.html#LN1522"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN407"><span class='Ref_to_Member'>es_direction</span></a> <span class='Operator'>= </span><a href="../../include/access/sdir.h.html#LN25"><span class='Ref_to_EnumConst'>ForwardScanDirection</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Run any secondary ModifyTable nodes to completion, in case the main 
     * query did not fetch all rows from them.  (We do this to ensure that 
     * such nodes have predictable results.) 
     */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1524"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1522"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN464"><span class='Ref_to_Member'>es_auxmodifytables</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1538"></a>        <a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>ps</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1524"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1542"></a>            <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>slot</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Reset the per-output-tuple exprcontext each time */ 
</span>            <a href="../../include/executor/executor.h.html#LN464"><span class='Ref_to_Macro'>ResetPerTupleExprContext</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1522"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="execMain.c.html#LN1542"><span class='Ref_To_Local'>slot</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN229"><span class='Ref_to_Proto'>ExecProcNode</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1538"><span class='Ref_To_Local'>ps</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/executor/tuptable.h.html#LN137"><span class='Ref_to_Macro'>TupIsNull</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1542"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end ExecPostprocessPlan &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      ExecEndPlan 
 * 
 *      Cleans up the query plan -- closes files and frees up storage 
 * 
 * NOTE: we are no longer very worried about freeing storage per se 
 * in this code; FreeExecutorState should be guaranteed to release all 
 * memory that needs to be released.  What we are worried about doing 
 * is closing relations and dropping buffer pins.  Thus, for example, 
 * tuple tables must be cleared or dropped to ensure pins are released. 
 * ---------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1568"></a><span class='Declare_Function'>ExecEndPlan</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>planstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1570"></a>    <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>resultRelInfo</span><span class='Delimiter'>; 
</span><a name="LN1571"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN1572"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * shut down the node-type-specific query processing 
     */ 
</span>    <a href="../../include/executor/executor.h.html#LN231"><span class='Ref_to_Proto'>ExecEndNode</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1568"><span class='Ref_to_Parameter'>planstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * for subplans too 
     */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1572"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1568"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN462"><span class='Ref_to_Member'>es_subplanstates</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1584"></a>        <a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>subplanstate</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1572"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/executor/executor.h.html#LN231"><span class='Ref_to_Proto'>ExecEndNode</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1584"><span class='Ref_To_Local'>subplanstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * destroy the executor's tuple table.  Actually we only care about 
     * releasing buffer pins and tupdesc refcounts; there's no need to pfree 
     * the TupleTableSlots, since the containing memory context is about to go 
     * away anyway. 
     */ 
</span>    <a href="../../include/executor/tuptable.h.html#LN143"><span class='Ref_to_Proto'>ExecResetTupleTable</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1568"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN449"><span class='Ref_to_Member'>es_tupleTable</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * close the result relation(s) if any, but hold locks until xact commit. 
     */ 
</span>    <a href="execMain.c.html#LN1570"><span class='Ref_To_Local'>resultRelInfo</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN1568"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN420"><span class='Ref_to_Member'>es_result_relations</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1571"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN1568"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN421"><span class='Ref_to_Member'>es_num_result_relations</span></a><span class='Delimiter'>; </span><a href="execMain.c.html#LN1571"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="execMain.c.html#LN1571"><span class='Ref_To_Local'>i</span></a><span class='Operator'>--</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Close indices and then the relation itself */ 
</span>        <a href="execIndexing.c.html#LN222"><span class='Ref_to_Func'>ExecCloseIndices</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1570"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1570"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN1570"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Close the root target relation(s). */ 
</span>    <a href="execMain.c.html#LN1570"><span class='Ref_To_Local'>resultRelInfo</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN1568"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN431"><span class='Ref_to_Member'>es_root_result_relations</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1571"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN1568"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN432"><span class='Ref_to_Member'>es_num_root_result_relations</span></a><span class='Delimiter'>; </span><a href="execMain.c.html#LN1571"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="execMain.c.html#LN1571"><span class='Ref_To_Local'>i</span></a><span class='Operator'>--</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1570"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN1570"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* likewise close any trigger target relations */ 
</span>    <a href="../../include/executor/executor.h.html#LN186"><span class='Ref_to_Proto'>ExecCleanUpTriggerState</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1568"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * close any relations selected FOR [KEY] UPDATE/SHARE, again keeping 
     * locks 
     */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1572"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1568"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN451"><span class='Ref_to_Member'>es_rowMarks</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1626"></a>        <a href="../../include/nodes/execnodes.h.html#LN508"><span class='Ref_to_Struct'>ExecRowMark</span></a> <span class='Operator'>*</span><span class='Declare_Local'>erm</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN508"><span class='Ref_to_Struct'>ExecRowMark</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1572"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1626"><span class='Ref_To_Local'>erm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN510"><span class='Ref_to_Member'>relation</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1626"><span class='Ref_To_Local'>erm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN510"><span class='Ref_to_Member'>relation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end ExecEndPlan &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      ExecutePlan 
 * 
 *      Processes the query plan until we have retrieved 'numberTuples' tuples, 
 *      moving in the specified direction. 
 * 
 *      Runs to completion if numberTuples is 0 
 * 
 * Note: the ctid attribute is a 'junk' attribute that is removed before the 
 * user can see it 
 * ---------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1646"></a><span class='Declare_Function'>ExecutePlan</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN1647"></a>            <a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>planstate</span><span class='Delimiter'>, 
</span><a name="LN1648"></a>            <span class='Keyword'>bool </span><span class='Declare_Parameter'>use_parallel_mode</span><span class='Delimiter'>, 
</span><a name="LN1649"></a>            <a href="../../include/nodes/nodes.h.html#LN647"><span class='Ref_to_Enum'>CmdType</span></a> <span class='Declare_Parameter'>operation</span><span class='Delimiter'>, 
</span><a name="LN1650"></a>            <span class='Keyword'>bool </span><span class='Declare_Parameter'>sendTuples</span><span class='Delimiter'>, 
</span><a name="LN1651"></a>            <a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Parameter'>numberTuples</span><span class='Delimiter'>, 
</span><a name="LN1652"></a>            <a href="../../include/access/sdir.h.html#LN21"><span class='Ref_to_Enum'>ScanDirection</span></a> <span class='Declare_Parameter'>direction</span><span class='Delimiter'>, 
</span><a name="LN1653"></a>            <a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dest</span><span class='Delimiter'>, 
</span><a name="LN1654"></a>            <span class='Keyword'>bool </span><span class='Declare_Parameter'>execute_once</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1656"></a>    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>slot</span><span class='Delimiter'>; 
</span><a name="LN1657"></a>    <a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Local'>current_tuple_count</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initialize local variables 
     */ 
</span>    <a href="execMain.c.html#LN1657"><span class='Ref_To_Local'>current_tuple_count</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set the direction. 
     */ 
</span>    <a href="execMain.c.html#LN1646"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN407"><span class='Ref_to_Member'>es_direction</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN1652"><span class='Ref_to_Parameter'>direction</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the plan might potentially be executed multiple times, we must force 
     * it to run without parallelism, because we might exit early.  Also 
     * disable parallelism when writing into a relation, because no database 
     * changes are allowed in parallel mode. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="execMain.c.html#LN1654"><span class='Ref_to_Parameter'>execute_once</span></a> <span class='Operator'>|| </span><a href="execMain.c.html#LN1653"><span class='Ref_to_Parameter'>dest</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/dest.h.html#LN127"><span class='Ref_to_Member'>mydest</span></a> <span class='Operator'>== </span><a href="../../include/tcop/dest.h.html#LN94"><span class='Ref_to_EnumConst'>DestIntoRel</span></a><span class='Parentheses'>) 
</span>        <a href="execMain.c.html#LN1648"><span class='Ref_to_Parameter'>use_parallel_mode</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1648"><span class='Ref_to_Parameter'>use_parallel_mode</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/access/xact.h.html#LN403"><span class='Ref_to_Proto'>EnterParallelMode</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Loop until we've processed the proper number of tuples from the plan. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Reset the per-output-tuple exprcontext */ 
</span>        <a href="../../include/executor/executor.h.html#LN464"><span class='Ref_to_Macro'>ResetPerTupleExprContext</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1646"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Execute the plan and obtain a tuple 
         */ 
</span>        <a href="execMain.c.html#LN1656"><span class='Ref_To_Local'>slot</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN229"><span class='Ref_to_Proto'>ExecProcNode</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1647"><span class='Ref_to_Parameter'>planstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * if the tuple is null, then we assume there is nothing more to 
         * process so we just end the loop... 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/executor/tuptable.h.html#LN137"><span class='Ref_to_Macro'>TupIsNull</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1656"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Allow nodes to release or shut down resources. */ 
</span>            <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../include/executor/executor.h.html#LN232"><span class='Ref_to_Proto'>ExecShutdownNode</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1647"><span class='Ref_to_Parameter'>planstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If we have a junk filter, then project a new tuple with the junk 
         * removed. 
         * 
         * Store this new "clean" tuple in the junkfilter's resultSlot. 
         * (Formerly, we stored it back over the "dirty" tuple, which is WRONG 
         * because that tuple slot has the wrong descriptor.) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1646"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN414"><span class='Ref_to_Member'>es_junkFilter</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="execMain.c.html#LN1656"><span class='Ref_To_Local'>slot</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN160"><span class='Ref_to_Proto'>ExecFilterJunk</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1646"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN414"><span class='Ref_to_Member'>es_junkFilter</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1656"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If we are supposed to send the tuple somewhere, do so. (In 
         * practice, this is probably always the case at this point.) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1650"><span class='Ref_to_Parameter'>sendTuples</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * If we are not able to send the tuple, we assume the destination 
             * has closed and no more tuples can be sent. If that's the case, 
             * end the loop. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>((</span><span class='Operator'>*</span><a href="execMain.c.html#LN1653"><span class='Ref_to_Parameter'>dest</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/dest.h.html#LN117"><span class='Ref_to_Member'>receiveSlot</span></a><span class='Parentheses'>) (</span><a href="execMain.c.html#LN1656"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1653"><span class='Ref_to_Parameter'>dest</span></a><span class='Parentheses'>)))</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Count tuples processed, if this is a SELECT.  (For other operation 
         * types, the ModifyTable plan node must count the appropriate 
         * events.) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1649"><span class='Ref_to_Parameter'>operation</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN650"><span class='Ref_to_EnumConst'>CMD_SELECT</span></a><span class='Parentheses'>) 
</span>            <span class='Parentheses'>(</span><a href="execMain.c.html#LN1646"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN453"><span class='Ref_to_Member'>es_processed</span></a><span class='Parentheses'>)</span><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * check our tuple count.. if we've processed the proper number then 
         * quit, else loop again and process more tuples.  Zero numberTuples 
         * means no limit. 
         */ 
</span>        <a href="execMain.c.html#LN1657"><span class='Ref_To_Local'>current_tuple_count</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1651"><span class='Ref_to_Parameter'>numberTuples</span></a> <span class='Operator'>&& </span><a href="execMain.c.html#LN1651"><span class='Ref_to_Parameter'>numberTuples</span></a> <span class='Operator'>== </span><a href="execMain.c.html#LN1657"><span class='Ref_To_Local'>current_tuple_count</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Allow nodes to release or shut down resources. */ 
</span>            <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../include/executor/executor.h.html#LN232"><span class='Ref_to_Proto'>ExecShutdownNode</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1647"><span class='Ref_to_Parameter'>planstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1648"><span class='Ref_to_Parameter'>use_parallel_mode</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/access/xact.h.html#LN404"><span class='Ref_to_Proto'>ExitParallelMode</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecutePlan &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * ExecRelCheck --- check that tuple meets constraints for result relation 
 * 
 * Returns NULL if OK, else name of failed check constraint 
 */ 
</span><span class='Keyword'>static const char </span><span class='Operator'>* 
</span><a name="LN1764"></a><span class='Declare_Function'>ExecRelCheck</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>resultRelInfo</span><span class='Delimiter'>, 
</span><a name="LN1765"></a>             <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1767"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span> <span class='Operator'>= </span><a href="execMain.c.html#LN1764"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>; 
</span><a name="LN1768"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ncheck</span> <span class='Operator'>= </span><a href="execMain.c.html#LN1767"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN75"><span class='Ref_to_Member'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN41"><span class='Ref_to_Member'>num_check</span></a><span class='Delimiter'>; 
</span><a name="LN1769"></a>    <a href="../../include/access/tupdesc.h.html#LN27"><span class='Ref_to_Typedef'>ConstrCheck</span></a> <span class='Operator'>*</span><span class='Declare_Local'>check</span> <span class='Operator'>= </span><a href="execMain.c.html#LN1767"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN75"><span class='Ref_to_Member'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN39"><span class='Ref_to_Member'>check</span></a><span class='Delimiter'>; 
</span><a name="LN1770"></a>    <a href="../../include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>econtext</span><span class='Delimiter'>; 
</span><a name="LN1771"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldContext</span><span class='Delimiter'>; 
</span><a name="LN1772"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If first time through for this result relation, build expression 
     * nodetrees for rel's constraint expressions.  Keep them in the per-query 
     * memory context so they'll survive throughout the query. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1764"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN386"><span class='Ref_to_Member'>ri_ConstraintExprs</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="execMain.c.html#LN1771"><span class='Ref_To_Local'>oldContext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1765"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN447"><span class='Ref_to_Member'>es_query_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN1764"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN386"><span class='Ref_to_Member'>ri_ConstraintExprs</span></a> <span class='Operator'>= 
</span>            <span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a> <span class='Operator'>**</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1768"><span class='Ref_To_Local'>ncheck</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a> <span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1772"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="execMain.c.html#LN1772"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="execMain.c.html#LN1768"><span class='Ref_To_Local'>ncheck</span></a><span class='Delimiter'>; </span><a href="execMain.c.html#LN1772"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1786"></a>            <a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>checkconstr</span><span class='Delimiter'>; 
</span> 
            <a href="execMain.c.html#LN1786"><span class='Ref_To_Local'>checkconstr</span></a> <span class='Operator'>= </span><a href="../nodes/read.c.html#LN36"><span class='Ref_to_Func'>stringToNode</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1769"><span class='Ref_To_Local'>check</span></a><span class='Delimiter'>[</span><a href="execMain.c.html#LN1772"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/access/tupdesc.h.html#LN30"><span class='Ref_to_Member'>ccbin</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="execMain.c.html#LN1764"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN386"><span class='Ref_to_Member'>ri_ConstraintExprs</span></a><span class='Delimiter'>[</span><a href="execMain.c.html#LN1772"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                <a href="../../include/executor/executor.h.html#LN246"><span class='Ref_to_Proto'>ExecPrepareExpr</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1786"><span class='Ref_To_Local'>checkconstr</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1765"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1771"><span class='Ref_To_Local'>oldContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We will use the EState's per-tuple context for evaluating constraint 
     * expressions (creating it if it's not already there). 
     */ 
</span>    <a href="execMain.c.html#LN1770"><span class='Ref_To_Local'>econtext</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN455"><span class='Ref_to_Macro'>GetPerTupleExprContext</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1765"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Arrange for econtext's scan tuple to be the tuple under test */ 
</span>    <a href="execMain.c.html#LN1770"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN196"><span class='Ref_to_Member'>ecxt_scantuple</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN1765"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* And evaluate the constraints */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1772"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="execMain.c.html#LN1772"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="execMain.c.html#LN1768"><span class='Ref_To_Local'>ncheck</span></a><span class='Delimiter'>; </span><a href="execMain.c.html#LN1772"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1807"></a>        <a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>checkconstr</span> <span class='Operator'>= </span><a href="execMain.c.html#LN1764"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN386"><span class='Ref_to_Member'>ri_ConstraintExprs</span></a><span class='Delimiter'>[</span><a href="execMain.c.html#LN1772"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * NOTE: SQL specifies that a NULL result from a constraint expression 
         * is not to be treated as a failure.  Therefore, use ExecCheck not 
         * ExecQual. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/executor/executor.h.html#LN366"><span class='Ref_to_Proto'>ExecCheck</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1807"><span class='Ref_To_Local'>checkconstr</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1770"><span class='Ref_To_Local'>econtext</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <a href="execMain.c.html#LN1769"><span class='Ref_To_Local'>check</span></a><span class='Delimiter'>[</span><a href="execMain.c.html#LN1772"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/access/tupdesc.h.html#LN29"><span class='Ref_to_Member'>ccname</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* NULL result means no error */ 
</span>    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecRelCheck &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ExecPartitionCheck --- check that tuple meets the partition constraint. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1826"></a><span class='Declare_Function'>ExecPartitionCheck</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>resultRelInfo</span><span class='Delimiter'>, </span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Delimiter'>, 
</span><a name="LN1827"></a>                   <a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1829"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span> <span class='Operator'>= </span><a href="execMain.c.html#LN1826"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>; 
</span><a name="LN1830"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1829"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1831"></a>    <a href="../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>modifiedCols</span><span class='Delimiter'>; 
</span><a name="LN1832"></a>    <a href="../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>insertedCols</span><span class='Delimiter'>; 
</span><a name="LN1833"></a>    <a href="../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>updatedCols</span><span class='Delimiter'>; 
</span><a name="LN1834"></a>    <a href="../../include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>econtext</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If first time through, build expression state tree for the partition 
     * check expression.  Keep it in the per-query memory context so they'll 
     * survive throughout the query. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1826"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN392"><span class='Ref_to_Member'>ri_PartitionCheckExpr</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1843"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>qual</span> <span class='Operator'>= </span><a href="execMain.c.html#LN1826"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN391"><span class='Ref_to_Member'>ri_PartitionCheck</span></a><span class='Delimiter'>; 
</span> 
        <a href="execMain.c.html#LN1826"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN392"><span class='Ref_to_Member'>ri_PartitionCheckExpr</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN248"><span class='Ref_to_Proto'>ExecPrepareCheck</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1843"><span class='Ref_To_Local'>qual</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1827"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We will use the EState's per-tuple context for evaluating constraint 
     * expressions (creating it if it's not already there). 
     */ 
</span>    <a href="execMain.c.html#LN1834"><span class='Ref_To_Local'>econtext</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN455"><span class='Ref_to_Macro'>GetPerTupleExprContext</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1827"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Arrange for econtext's scan tuple to be the tuple under test */ 
</span>    <a href="execMain.c.html#LN1834"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN196"><span class='Ref_to_Member'>ecxt_scantuple</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN1826"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * As in case of the catalogued constraints, we treat a NULL result as 
     * success here, not a failure. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/executor/executor.h.html#LN366"><span class='Ref_to_Proto'>ExecCheck</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1826"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN392"><span class='Ref_to_Member'>ri_PartitionCheckExpr</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1834"><span class='Ref_To_Local'>econtext</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1863"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>val_desc</span><span class='Delimiter'>; 
</span><a name="LN1864"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>orig_rel</span> <span class='Operator'>= </span><a href="execMain.c.html#LN1829"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* See the comment above. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1826"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN393"><span class='Ref_to_Member'>ri_PartitionRoot</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1869"></a>            <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span> <span class='Operator'>= </span><a href="../../include/executor/tuptable.h.html#LN159"><span class='Ref_to_Proto'>ExecFetchSlotTuple</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1826"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1870"></a>            <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>old_tupdesc</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1829"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1871"></a>            <a href="../../include/access/tupconvert.h.html#LN20"><span class='Ref_to_Struct'>TupleConversionMap</span></a> <span class='Operator'>*</span><span class='Declare_Local'>map</span><span class='Delimiter'>; 
</span> 
            <a href="execMain.c.html#LN1829"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN1826"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN393"><span class='Ref_to_Member'>ri_PartitionRoot</span></a><span class='Delimiter'>; 
</span>            <a href="execMain.c.html#LN1830"><span class='Ref_To_Local'>tupdesc</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1829"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* a reverse map */ 
</span>            <a href="execMain.c.html#LN1871"><span class='Ref_To_Local'>map</span></a> <span class='Operator'>= </span><a href="../../include/access/tupconvert.h.html#LN36"><span class='Ref_to_Proto'>convert_tuples_by_name</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1870"><span class='Ref_To_Local'>old_tupdesc</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1830"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"could not convert row type"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1871"><span class='Ref_To_Local'>map</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="execMain.c.html#LN1869"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/tupconvert.h.html#LN44"><span class='Ref_to_Proto'>do_convert_tuple</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1869"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1871"><span class='Ref_To_Local'>map</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/executor/tuptable.h.html#LN147"><span class='Ref_to_Proto'>ExecStoreTuple</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1869"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1826"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="execMain.c.html#LN1832"><span class='Ref_To_Local'>insertedCols</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN114"><span class='Ref_to_Macro'>GetInsertedColumns</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1826"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1827"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN1833"><span class='Ref_To_Local'>updatedCols</span></a> <span class='Operator'>= </span><a href="../commands/trigger.c.html#LN74"><span class='Ref_to_Macro'>GetUpdatedColumns</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1826"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1827"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN1831"><span class='Ref_To_Local'>modifiedCols</span></a> <span class='Operator'>= </span><a href="../../include/nodes/bitmapset.h.html#LN70"><span class='Ref_to_Proto'>bms_union</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1832"><span class='Ref_To_Local'>insertedCols</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1833"><span class='Ref_To_Local'>updatedCols</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN1863"><span class='Ref_To_Local'>val_desc</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN94"><span class='Ref_to_Proto'>ExecBuildSlotValueDescription</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1829"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                 <a href="execMain.c.html#LN1826"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, 
</span>                                                 <a href="execMain.c.html#LN1830"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, 
</span>                                                 <a href="execMain.c.html#LN1831"><span class='Ref_To_Local'>modifiedCols</span></a><span class='Delimiter'>, 
</span>                                                 <span class='Number'>64</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CHECK_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>          <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"new row for relation \"%s\" violates partition constraint"</span><span class='Delimiter'>, 
</span>                 <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1864"><span class='Ref_To_Local'>orig_rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>            <a href="execMain.c.html#LN1863"><span class='Ref_To_Local'>val_desc</span></a> <span class='Operator'>? </span><a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Failing row contains %s."</span><span class='Delimiter'>, </span><a href="execMain.c.html#LN1863"><span class='Ref_To_Local'>val_desc</span></a><span class='Parentheses'>)</span> <span class='Operator'>: </span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !ExecCheck(resultRelI... &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end ExecPartitionCheck &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ExecConstraints - check constraints of the tuple in 'slot' 
 * 
 * This checks the traditional NOT NULL and check constraints, as well as 
 * the partition constraint, if any. 
 * 
 * Note: 'slot' contains the tuple to check the constraints of, which may 
 * have been converted from the original input tuple after tuple routing. 
 * 'resultRelInfo' is the original result relation, before tuple routing. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1912"></a><span class='Declare_Function'>ExecConstraints</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>resultRelInfo</span><span class='Delimiter'>, 
</span><a name="LN1913"></a>                <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1915"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span> <span class='Operator'>= </span><a href="execMain.c.html#LN1912"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>; 
</span><a name="LN1916"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1915"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1917"></a>    <a href="../../include/access/tupdesc.h.html#LN36"><span class='Ref_to_Typedef'>TupleConstr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>constr</span> <span class='Operator'>= </span><a href="execMain.c.html#LN1916"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN75"><span class='Ref_to_Member'>constr</span></a><span class='Delimiter'>; 
</span><a name="LN1918"></a>    <a href="../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>modifiedCols</span><span class='Delimiter'>; 
</span><a name="LN1919"></a>    <a href="../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>insertedCols</span><span class='Delimiter'>; 
</span><a name="LN1920"></a>    <a href="../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>updatedCols</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="execMain.c.html#LN1917"><span class='Ref_To_Local'>constr</span></a> <span class='Operator'>|| </span><a href="execMain.c.html#LN1912"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN391"><span class='Ref_to_Member'>ri_PartitionCheck</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1917"><span class='Ref_To_Local'>constr</span></a> <span class='Operator'>&& </span><a href="execMain.c.html#LN1917"><span class='Ref_To_Local'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN42"><span class='Ref_to_Member'>has_not_null</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1926"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>natts</span> <span class='Operator'>= </span><a href="execMain.c.html#LN1916"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; 
</span><a name="LN1927"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>attrChk</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1927"><span class='Ref_To_Local'>attrChk</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="execMain.c.html#LN1927"><span class='Ref_To_Local'>attrChk</span></a> <span class='Operator'>&LT;= </span><a href="execMain.c.html#LN1926"><span class='Ref_To_Local'>natts</span></a><span class='Delimiter'>; </span><a href="execMain.c.html#LN1927"><span class='Ref_To_Local'>attrChk</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1916"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="execMain.c.html#LN1927"><span class='Ref_To_Local'>attrChk</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attnotnull <span class='Operator'>&& 
</span>                <a href="../../include/executor/tuptable.h.html#LN170"><span class='Ref_to_Proto'>slot_attisnull</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1913"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1927"><span class='Ref_To_Local'>attrChk</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span><a name="LN1934"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>val_desc</span><span class='Delimiter'>; 
</span><a name="LN1935"></a>                <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>orig_rel</span> <span class='Operator'>= </span><a href="execMain.c.html#LN1915"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>; 
</span><a name="LN1936"></a>                <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>orig_tupdesc</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1915"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * If the tuple has been routed, it's been converted to the 
                 * partition's rowtype, which might differ from the root 
                 * table's.  We must convert it back to the root table's 
                 * rowtype so that val_desc shown error message matches the 
                 * input tuple. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1912"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN393"><span class='Ref_to_Member'>ri_PartitionRoot</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN1947"></a>                    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span> <span class='Operator'>= </span><a href="../../include/executor/tuptable.h.html#LN159"><span class='Ref_to_Proto'>ExecFetchSlotTuple</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1913"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1948"></a>                    <a href="../../include/access/tupconvert.h.html#LN20"><span class='Ref_to_Struct'>TupleConversionMap</span></a> <span class='Operator'>*</span><span class='Declare_Local'>map</span><span class='Delimiter'>; 
</span> 
                    <a href="execMain.c.html#LN1915"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN1912"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN393"><span class='Ref_to_Member'>ri_PartitionRoot</span></a><span class='Delimiter'>; 
</span>                    <a href="execMain.c.html#LN1916"><span class='Ref_To_Local'>tupdesc</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1915"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* a reverse map */ 
</span>                    <a href="execMain.c.html#LN1948"><span class='Ref_To_Local'>map</span></a> <span class='Operator'>= </span><a href="../../include/access/tupconvert.h.html#LN36"><span class='Ref_to_Proto'>convert_tuples_by_name</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1936"><span class='Ref_To_Local'>orig_tupdesc</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1916"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"could not convert row type"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1948"><span class='Ref_To_Local'>map</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="execMain.c.html#LN1947"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/tupconvert.h.html#LN44"><span class='Ref_to_Proto'>do_convert_tuple</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1947"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1948"><span class='Ref_To_Local'>map</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="../../include/executor/tuptable.h.html#LN147"><span class='Ref_to_Proto'>ExecStoreTuple</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1947"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1913"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span> 
                <a href="execMain.c.html#LN1919"><span class='Ref_To_Local'>insertedCols</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN114"><span class='Ref_to_Macro'>GetInsertedColumns</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1912"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1913"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="execMain.c.html#LN1920"><span class='Ref_To_Local'>updatedCols</span></a> <span class='Operator'>= </span><a href="../commands/trigger.c.html#LN74"><span class='Ref_to_Macro'>GetUpdatedColumns</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1912"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1913"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="execMain.c.html#LN1918"><span class='Ref_To_Local'>modifiedCols</span></a> <span class='Operator'>= </span><a href="../../include/nodes/bitmapset.h.html#LN70"><span class='Ref_to_Proto'>bms_union</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1919"><span class='Ref_To_Local'>insertedCols</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1920"><span class='Ref_To_Local'>updatedCols</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="execMain.c.html#LN1934"><span class='Ref_To_Local'>val_desc</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN94"><span class='Ref_to_Proto'>ExecBuildSlotValueDescription</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1915"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                         <a href="execMain.c.html#LN1913"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, 
</span>                                                         <a href="execMain.c.html#LN1916"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, 
</span>                                                         <a href="execMain.c.html#LN1918"><span class='Ref_To_Local'>modifiedCols</span></a><span class='Delimiter'>, 
</span>                                                         <span class='Number'>64</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NOT_NULL_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"null value in column \"%s\" violates not-null constraint"</span><span class='Delimiter'>, 
</span>                         <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1936"><span class='Ref_To_Local'>orig_tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="execMain.c.html#LN1927"><span class='Ref_To_Local'>attrChk</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                         <a href="execMain.c.html#LN1934"><span class='Ref_To_Local'>val_desc</span></a> <span class='Operator'>? </span><a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Failing row contains %s."</span><span class='Delimiter'>, </span><a href="execMain.c.html#LN1934"><span class='Ref_To_Local'>val_desc</span></a><span class='Parentheses'>)</span> <span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                         <a href="../../include/utils/relcache.h.html#LN77"><span class='Ref_to_Proto'>errtablecol</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1935"><span class='Ref_To_Local'>orig_rel</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1927"><span class='Ref_To_Local'>attrChk</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if tupdesc-&GT;attrs[attrCh... &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for attrChk=1;attrChk&LT;=na... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if constr&&constr-&GT;has_n... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1917"><span class='Ref_To_Local'>constr</span></a> <span class='Operator'>&& </span><a href="execMain.c.html#LN1917"><span class='Ref_To_Local'>constr</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN41"><span class='Ref_to_Member'>num_check</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1983"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>failed</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="execMain.c.html#LN1983"><span class='Ref_To_Local'>failed</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN1763"><span class='Ref_to_Func'>ExecRelCheck</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1912"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1913"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1913"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1987"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>val_desc</span><span class='Delimiter'>; 
</span><a name="LN1988"></a>            <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>orig_rel</span> <span class='Operator'>= </span><a href="execMain.c.html#LN1915"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* See the comment above. */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1912"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN393"><span class='Ref_to_Member'>ri_PartitionRoot</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1993"></a>                <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span> <span class='Operator'>= </span><a href="../../include/executor/tuptable.h.html#LN159"><span class='Ref_to_Proto'>ExecFetchSlotTuple</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1913"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1994"></a>                <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>old_tupdesc</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1915"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1995"></a>                <a href="../../include/access/tupconvert.h.html#LN20"><span class='Ref_to_Struct'>TupleConversionMap</span></a> <span class='Operator'>*</span><span class='Declare_Local'>map</span><span class='Delimiter'>; 
</span> 
                <a href="execMain.c.html#LN1915"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN1912"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN393"><span class='Ref_to_Member'>ri_PartitionRoot</span></a><span class='Delimiter'>; 
</span>                <a href="execMain.c.html#LN1916"><span class='Ref_To_Local'>tupdesc</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1915"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* a reverse map */ 
</span>                <a href="execMain.c.html#LN1995"><span class='Ref_To_Local'>map</span></a> <span class='Operator'>= </span><a href="../../include/access/tupconvert.h.html#LN36"><span class='Ref_to_Proto'>convert_tuples_by_name</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1994"><span class='Ref_To_Local'>old_tupdesc</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1916"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"could not convert row type"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1995"><span class='Ref_To_Local'>map</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="execMain.c.html#LN1993"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/tupconvert.h.html#LN44"><span class='Ref_to_Proto'>do_convert_tuple</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1993"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1995"><span class='Ref_To_Local'>map</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../include/executor/tuptable.h.html#LN147"><span class='Ref_to_Proto'>ExecStoreTuple</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1993"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1913"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="execMain.c.html#LN1919"><span class='Ref_To_Local'>insertedCols</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN114"><span class='Ref_to_Macro'>GetInsertedColumns</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1912"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1913"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="execMain.c.html#LN1920"><span class='Ref_To_Local'>updatedCols</span></a> <span class='Operator'>= </span><a href="../commands/trigger.c.html#LN74"><span class='Ref_to_Macro'>GetUpdatedColumns</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1912"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1913"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="execMain.c.html#LN1918"><span class='Ref_To_Local'>modifiedCols</span></a> <span class='Operator'>= </span><a href="../../include/nodes/bitmapset.h.html#LN70"><span class='Ref_to_Proto'>bms_union</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1919"><span class='Ref_To_Local'>insertedCols</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1920"><span class='Ref_To_Local'>updatedCols</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="execMain.c.html#LN1987"><span class='Ref_To_Local'>val_desc</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN94"><span class='Ref_to_Proto'>ExecBuildSlotValueDescription</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1915"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                     <a href="execMain.c.html#LN1913"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, 
</span>                                                     <a href="execMain.c.html#LN1916"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, 
</span>                                                     <a href="execMain.c.html#LN1918"><span class='Ref_To_Local'>modifiedCols</span></a><span class='Delimiter'>, 
</span>                                                     <span class='Number'>64</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CHECK_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"new row for relation \"%s\" violates check constraint \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1988"><span class='Ref_To_Local'>orig_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="execMain.c.html#LN1983"><span class='Ref_To_Local'>failed</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="execMain.c.html#LN1987"><span class='Ref_To_Local'>val_desc</span></a> <span class='Operator'>? </span><a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Failing row contains %s."</span><span class='Delimiter'>, </span><a href="execMain.c.html#LN1987"><span class='Ref_To_Local'>val_desc</span></a><span class='Parentheses'>)</span> <span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                     <a href="../../include/utils/relcache.h.html#LN79"><span class='Ref_to_Proto'>errtableconstraint</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1988"><span class='Ref_To_Local'>orig_rel</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1983"><span class='Ref_To_Local'>failed</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if (failed=ExecRelCheck(... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if constr&&constr-&GT;num_c... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN1912"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN391"><span class='Ref_to_Member'>ri_PartitionCheck</span></a><span class='Parentheses'>) 
</span>        <a href="execMain.c.html#LN105"><span class='Ref_to_Proto'>ExecPartitionCheck</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN1912"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1913"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN1913"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecConstraints &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * ExecWithCheckOptions -- check that tuple satisfies any WITH CHECK OPTIONs 
 * of the specified kind. 
 * 
 * Note that this needs to be called multiple times to ensure that all kinds of 
 * WITH CHECK OPTIONs are handled (both those from views which have the WITH 
 * CHECK OPTION set and from row level security policies).  See ExecInsert() 
 * and ExecUpdate(). 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2041"></a><span class='Declare_Function'>ExecWithCheckOptions</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1085"><span class='Ref_to_Enum'>WCOKind</span></a> <span class='Declare_Parameter'>kind</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>resultRelInfo</span><span class='Delimiter'>, 
</span><a name="LN2042"></a>                     <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2044"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span> <span class='Operator'>= </span><a href="execMain.c.html#LN2041"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>; 
</span><a name="LN2045"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2044"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2046"></a>    <a href="../../include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>econtext</span><span class='Delimiter'>; 
</span><a name="LN2047"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l1</span><span class='Delimiter'>, 
</span><a name="LN2048"></a>               <span class='Operator'>*</span><span class='Declare_Local'>l2</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We will use the EState's per-tuple context for evaluating constraint 
     * expressions (creating it if it's not already there). 
     */ 
</span>    <a href="execMain.c.html#LN2046"><span class='Ref_To_Local'>econtext</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN455"><span class='Ref_to_Macro'>GetPerTupleExprContext</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2042"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Arrange for econtext's scan tuple to be the tuple under test */ 
</span>    <a href="execMain.c.html#LN2046"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN196"><span class='Ref_to_Member'>ecxt_scantuple</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN2042"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check each of the constraints */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN179"><span class='Ref_to_Macro'>forboth</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2047"><span class='Ref_To_Local'>l1</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN2041"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN384"><span class='Ref_to_Member'>ri_WithCheckOptions</span></a><span class='Delimiter'>, 
</span>            <a href="execMain.c.html#LN2048"><span class='Ref_To_Local'>l2</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN2041"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN385"><span class='Ref_to_Member'>ri_WithCheckOptionExprs</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2063"></a>        <a href="../../include/nodes/parsenodes.h.html#LN1093"><span class='Ref_to_Struct'>WithCheckOption</span></a> <span class='Operator'>*</span><span class='Declare_Local'>wco</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1093"><span class='Ref_to_Struct'>WithCheckOption</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2047"><span class='Ref_To_Local'>l1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2064"></a>        <a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>wcoExpr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2048"><span class='Ref_To_Local'>l2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Skip any WCOs which are not the kind we are looking for at this 
         * time. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN2063"><span class='Ref_To_Local'>wco</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1096"><span class='Ref_to_Member'>kind</span></a> <span class='Operator'>!= </span><a href="execMain.c.html#LN2041"><span class='Ref_to_Parameter'>kind</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * WITH CHECK OPTION checks are intended to ensure that the new tuple 
         * is visible (in the case of a view) or that it passes the 
         * 'with-check' policy (in the case of row security). If the qual 
         * evaluates to NULL or FALSE, then the new tuple won't be included in 
         * the view or doesn't pass the 'with-check' policy for the table. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/executor/executor.h.html#LN344"><span class='Ref_to_Func'>ExecQual</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2064"><span class='Ref_To_Local'>wcoExpr</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN2046"><span class='Ref_To_Local'>econtext</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN2082"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>val_desc</span><span class='Delimiter'>; 
</span><a name="LN2083"></a>            <a href="../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>modifiedCols</span><span class='Delimiter'>; 
</span><a name="LN2084"></a>            <a href="../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>insertedCols</span><span class='Delimiter'>; 
</span><a name="LN2085"></a>            <a href="../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>updatedCols</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN2063"><span class='Ref_To_Local'>wco</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1096"><span class='Ref_to_Member'>kind</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * For WITH CHECK OPTIONs coming from views, we might be 
                     * able to provide the details on the row, depending on 
                     * the permissions on the relation (that is, if the user 
                     * could view it directly anyway).  For RLS violations, we 
                     * don't include the data since we don't know if the user 
                     * should be able to view the tuple as as that depends on 
                     * the USING policy. 
                     */ 
</span>                <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1087"><span class='Ref_to_EnumConst'>WCO_VIEW_CHECK</span></a><span class='Operator'>: 
</span>                    <a href="execMain.c.html#LN2084"><span class='Ref_To_Local'>insertedCols</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN114"><span class='Ref_to_Macro'>GetInsertedColumns</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2041"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN2042"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="execMain.c.html#LN2085"><span class='Ref_To_Local'>updatedCols</span></a> <span class='Operator'>= </span><a href="../commands/trigger.c.html#LN74"><span class='Ref_to_Macro'>GetUpdatedColumns</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2041"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN2042"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="execMain.c.html#LN2083"><span class='Ref_To_Local'>modifiedCols</span></a> <span class='Operator'>= </span><a href="../../include/nodes/bitmapset.h.html#LN70"><span class='Ref_to_Proto'>bms_union</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2084"><span class='Ref_To_Local'>insertedCols</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN2085"><span class='Ref_To_Local'>updatedCols</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="execMain.c.html#LN2082"><span class='Ref_To_Local'>val_desc</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN94"><span class='Ref_to_Proto'>ExecBuildSlotValueDescription</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2044"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                             <a href="execMain.c.html#LN2042"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, 
</span>                                                             <a href="execMain.c.html#LN2045"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, 
</span>                                                             <a href="execMain.c.html#LN2083"><span class='Ref_To_Local'>modifiedCols</span></a><span class='Delimiter'>, 
</span>                                                             <span class='Number'>64</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WITH_CHECK_OPTION_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                      <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"new row violates check option for view \"%s\""</span><span class='Delimiter'>, 
</span>                             <a href="execMain.c.html#LN2063"><span class='Ref_To_Local'>wco</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1097"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="execMain.c.html#LN2082"><span class='Ref_To_Local'>val_desc</span></a> <span class='Operator'>? </span><a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Failing row contains %s."</span><span class='Delimiter'>, 
</span>                                                  <a href="execMain.c.html#LN2082"><span class='Ref_To_Local'>val_desc</span></a><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1088"><span class='Ref_to_EnumConst'>WCO_RLS_INSERT_CHECK</span></a><span class='Operator'>: 
</span>                <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1089"><span class='Ref_to_EnumConst'>WCO_RLS_UPDATE_CHECK</span></a><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN2063"><span class='Ref_To_Local'>wco</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1098"><span class='Ref_to_Member'>polname</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"new row violates row-level security policy \"%s\" for table \"%s\""</span><span class='Delimiter'>, 
</span>                                        <a href="execMain.c.html#LN2063"><span class='Ref_To_Local'>wco</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1098"><span class='Ref_to_Member'>polname</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN2063"><span class='Ref_To_Local'>wco</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1097"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"new row violates row-level security policy for table \"%s\""</span><span class='Delimiter'>, 
</span>                                        <a href="execMain.c.html#LN2063"><span class='Ref_To_Local'>wco</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1097"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1090"><span class='Ref_to_EnumConst'>WCO_RLS_CONFLICT_CHECK</span></a><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN2063"><span class='Ref_To_Local'>wco</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1098"><span class='Ref_to_Member'>polname</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"new row violates row-level security policy \"%s\" (USING expression) for table \"%s\""</span><span class='Delimiter'>, 
</span>                                        <a href="execMain.c.html#LN2063"><span class='Ref_To_Local'>wco</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1098"><span class='Ref_to_Member'>polname</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN2063"><span class='Ref_To_Local'>wco</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1097"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"new row violates row-level security policy (USING expression) for table \"%s\""</span><span class='Delimiter'>, 
</span>                                        <a href="execMain.c.html#LN2063"><span class='Ref_To_Local'>wco</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1097"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>default</span><span class='Operator'>: 
</span>                    <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized WCO kind: %u"</span><span class='Delimiter'>, </span><a href="execMain.c.html#LN2063"><span class='Ref_To_Local'>wco</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1096"><span class='Ref_to_Member'>kind</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch wco-&GT;kind &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !ExecQual(wcoExpr,eco... &raquo; </span> 
    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end ExecWithCheckOptions &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ExecBuildSlotValueDescription -- construct a string representing a tuple 
 * 
 * This is intentionally very similar to BuildIndexValueDescription, but 
 * unlike that function, we truncate long field values (to at most maxfieldlen 
 * bytes).  That seems necessary here since heap field values could be very 
 * long, whereas index entries typically aren't so wide. 
 * 
 * Also, unlike the case with index entries, we need to be prepared to ignore 
 * dropped columns.  We used to use the slot's tuple descriptor to decode the 
 * data, but the slot's descriptor doesn't identify dropped columns, so we 
 * now need to be passed the relation's descriptor. 
 * 
 * Note that, like BuildIndexValueDescription, if the user does not have 
 * permission to view any of the columns involved, a NULL is returned.  Unlike 
 * BuildIndexValueDescription, if the user has access to view a subset of the 
 * column involved, that subset will be returned with a key identifying which 
 * columns they are. 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN2168"></a><span class='Declare_Function'>ExecBuildSlotValueDescription</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>reloid</span><span class='Delimiter'>, 
</span><a name="LN2169"></a>                              <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Delimiter'>, 
</span><a name="LN2170"></a>                              <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupdesc</span><span class='Delimiter'>, 
</span><a name="LN2171"></a>                              <a href="../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>modifiedCols</span><span class='Delimiter'>, 
</span><a name="LN2172"></a>                              <span class='Keyword'>int </span><span class='Declare_Parameter'>maxfieldlen</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2174"></a>    <a href="../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN2175"></a>    <a href="../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>collist</span><span class='Delimiter'>; 
</span><a name="LN2176"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>write_comma</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN2177"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>write_comma_collist</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN2178"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN2179"></a>    <a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span><a name="LN2180"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>table_perm</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN2181"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>any_perm</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check if RLS is enabled and should be active for the relation; if so, 
     * then don't return anything.  Otherwise, go through normal permission 
     * checks. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/rls.h.html#LN47"><span class='Ref_to_Proto'>check_enable_rls</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2168"><span class='Ref_to_Parameter'>reloid</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../include/utils/rls.h.html#LN44"><span class='Ref_to_EnumConst'>RLS_ENABLED</span></a><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="execMain.c.html#LN2174"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="execMain.c.html#LN2174"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>'('</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check if the user has permissions to see the row.  Table-level SELECT 
     * allows access to all columns.  If the user does not have table-level 
     * SELECT then we check each column and include those the user has SELECT 
     * rights on.  Additionally, we always include columns the user provided 
     * data for. 
     */ 
</span>    <a href="execMain.c.html#LN2179"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN283"><span class='Ref_to_Proto'>pg_class_aclcheck</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2168"><span class='Ref_to_Parameter'>reloid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN72"><span class='Ref_to_Const'>ACL_SELECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN2179"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Set up the buffer for the column list */ 
</span>        <a href="../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="execMain.c.html#LN2175"><span class='Ref_To_Local'>collist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="execMain.c.html#LN2175"><span class='Ref_To_Local'>collist</span></a><span class='Delimiter'>, </span><span class='String'>'('</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="execMain.c.html#LN2180"><span class='Ref_To_Local'>table_perm</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN2181"><span class='Ref_To_Local'>any_perm</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make sure the tuple is fully deconstructed */ 
</span>    <a href="../../include/executor/tuptable.h.html#LN168"><span class='Ref_to_Proto'>slot_getallattrs</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2169"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN2178"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="execMain.c.html#LN2178"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="execMain.c.html#LN2170"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; </span><a href="execMain.c.html#LN2178"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2217"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>column_perm</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN2218"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN2219"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>vallen</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* ignore dropped columns */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN2170"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="execMain.c.html#LN2178"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="execMain.c.html#LN2180"><span class='Ref_To_Local'>table_perm</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * No table-level SELECT, so need to make sure they either have 
             * SELECT rights on the column or that they have provided the data 
             * for the column.  If not, omit this column from the error 
             * message. 
             */ 
</span>            <a href="execMain.c.html#LN2179"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN279"><span class='Ref_to_Proto'>pg_attribute_aclcheck</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2168"><span class='Ref_to_Parameter'>reloid</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN2170"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="execMain.c.html#LN2178"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attnum<span class='Delimiter'>, 
</span>                                              <a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN72"><span class='Ref_to_Const'>ACL_SELECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/bitmapset.h.html#LN75"><span class='Ref_to_Proto'>bms_is_member</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2170"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="execMain.c.html#LN2178"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attnum <span class='Operator'>- </span><a href="../../include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a><span class='Delimiter'>, 
</span>                              <a href="execMain.c.html#LN2171"><span class='Ref_to_Parameter'>modifiedCols</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><a href="execMain.c.html#LN2179"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>== </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="execMain.c.html#LN2217"><span class='Ref_To_Local'>column_perm</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN2181"><span class='Ref_To_Local'>any_perm</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN2177"><span class='Ref_To_Local'>write_comma_collist</span></a><span class='Parentheses'>) 
</span>                    <a href="../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="execMain.c.html#LN2175"><span class='Ref_To_Local'>collist</span></a><span class='Delimiter'>, </span><span class='String'>", "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="execMain.c.html#LN2177"><span class='Ref_To_Local'>write_comma_collist</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
                <a href="../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="execMain.c.html#LN2175"><span class='Ref_To_Local'>collist</span></a><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2170"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="execMain.c.html#LN2178"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !table_perm &raquo; </span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN2180"><span class='Ref_To_Local'>table_perm</span></a> <span class='Operator'>|| </span><a href="execMain.c.html#LN2217"><span class='Ref_To_Local'>column_perm</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN2169"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/tuptable.h.html#LN125"><span class='Ref_to_Member'>tts_isnull</span></a><span class='Delimiter'>[</span><a href="execMain.c.html#LN2178"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                <a href="execMain.c.html#LN2218"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><span class='String'>"null"</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span><a name="LN2255"></a>                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>foutoid</span><span class='Delimiter'>; 
</span><a name="LN2256"></a>                <span class='Keyword'>bool</span>        <span class='Declare_Local'>typisvarlena</span><span class='Delimiter'>; 
</span> 
                <a href="../../include/utils/lsyscache.h.html#LN162"><span class='Ref_to_Proto'>getTypeOutputInfo</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2170"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="execMain.c.html#LN2178"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>, 
</span>                                  <span class='Operator'>&</span><a href="execMain.c.html#LN2255"><span class='Ref_To_Local'>foutoid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="execMain.c.html#LN2256"><span class='Ref_To_Local'>typisvarlena</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="execMain.c.html#LN2218"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN647"><span class='Ref_to_Proto'>OidOutputFunctionCall</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2255"><span class='Ref_To_Local'>foutoid</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN2169"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/tuptable.h.html#LN124"><span class='Ref_to_Member'>tts_values</span></a><span class='Delimiter'>[</span><a href="execMain.c.html#LN2178"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN2176"><span class='Ref_To_Local'>write_comma</span></a><span class='Parentheses'>) 
</span>                <a href="../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="execMain.c.html#LN2174"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>", "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="execMain.c.html#LN2176"><span class='Ref_To_Local'>write_comma</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* truncate if needed */ 
</span>            <a href="execMain.c.html#LN2219"><span class='Ref_To_Local'>vallen</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="execMain.c.html#LN2218"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN2219"><span class='Ref_To_Local'>vallen</span></a> <span class='Operator'>&LT;= </span><a href="execMain.c.html#LN2172"><span class='Ref_to_Parameter'>maxfieldlen</span></a><span class='Parentheses'>) 
</span>                <a href="../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="execMain.c.html#LN2174"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN2218"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="execMain.c.html#LN2219"><span class='Ref_To_Local'>vallen</span></a> <span class='Operator'>= </span><a href="../../include/mb/pg_wchar.h.html#LN530"><span class='Ref_to_Proto'>pg_mbcliplen</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2218"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN2219"><span class='Ref_To_Local'>vallen</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN2172"><span class='Ref_to_Parameter'>maxfieldlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="execMain.c.html#LN2174"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN2218"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN2219"><span class='Ref_To_Local'>vallen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="execMain.c.html#LN2174"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"..."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if table_perm||column_pe... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;tupdesc-&GT;natts;... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* If we end up with zero columns being returned, then return NULL. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="execMain.c.html#LN2181"><span class='Ref_To_Local'>any_perm</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="execMain.c.html#LN2174"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>')'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="execMain.c.html#LN2180"><span class='Ref_To_Local'>table_perm</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="execMain.c.html#LN2175"><span class='Ref_To_Local'>collist</span></a><span class='Delimiter'>, </span><span class='String'>") = "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="execMain.c.html#LN2175"><span class='Ref_To_Local'>collist</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN2174"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span> <a href="execMain.c.html#LN2175"><span class='Ref_To_Local'>collist</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="execMain.c.html#LN2174"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecBuildSlotValueDescription &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * ExecUpdateLockMode -- find the appropriate UPDATE tuple lock mode for a 
 * given ResultRelInfo 
 */ 
</span><a href="../../include/access/heapam.h.html#LN37"><span class='Ref_to_Enum'>LockTupleMode</span></a> 
<a name="LN2304"></a><span class='Declare_Function'>ExecUpdateLockMode</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>relinfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2306"></a>    <a href="../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>keyCols</span><span class='Delimiter'>; 
</span><a name="LN2307"></a>    <a href="../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>updatedCols</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Compute lock mode to use.  If columns that are part of the key have not 
     * been modified, then we can use a weaker lock, allowing for better 
     * concurrency. 
     */ 
</span>    <a href="execMain.c.html#LN2307"><span class='Ref_To_Local'>updatedCols</span></a> <span class='Operator'>= </span><a href="../commands/trigger.c.html#LN74"><span class='Ref_to_Macro'>GetUpdatedColumns</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2304"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN2304"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN2306"><span class='Ref_To_Local'>keyCols</span></a> <span class='Operator'>= </span><a href="../../include/utils/relcache.h.html#LN56"><span class='Ref_to_Proto'>RelationGetIndexAttrBitmap</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2304"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>, 
</span>                                         <a href="../../include/utils/relcache.h.html#LN51"><span class='Ref_to_EnumConst'>INDEX_ATTR_BITMAP_KEY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/bitmapset.h.html#LN76"><span class='Ref_to_Proto'>bms_overlap</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2306"><span class='Ref_To_Local'>keyCols</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN2307"><span class='Ref_To_Local'>updatedCols</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="../../include/access/heapam.h.html#LN46"><span class='Ref_to_EnumConst'>LockTupleExclusive</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/access/heapam.h.html#LN44"><span class='Ref_to_EnumConst'>LockTupleNoKeyExclusive</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecUpdateLockMode &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ExecFindRowMark -- find the ExecRowMark struct for given rangetable index 
 * 
 * If no such struct, either return NULL or throw error depending on missing_ok 
 */ 
</span><a href="../../include/nodes/execnodes.h.html#LN508"><span class='Ref_to_Struct'>ExecRowMark</span></a> <span class='Operator'>* 
</span><a name="LN2330"></a><span class='Declare_Function'>ExecFindRowMark</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>rti</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>missing_ok</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2332"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2332"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN2330"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN451"><span class='Ref_to_Member'>es_rowMarks</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2336"></a>        <a href="../../include/nodes/execnodes.h.html#LN508"><span class='Ref_to_Struct'>ExecRowMark</span></a> <span class='Operator'>*</span><span class='Declare_Local'>erm</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN508"><span class='Ref_to_Struct'>ExecRowMark</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2332"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN2336"><span class='Ref_To_Local'>erm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN512"><span class='Ref_to_Member'>rti</span></a> <span class='Operator'>== </span><a href="execMain.c.html#LN2330"><span class='Ref_to_Parameter'>rti</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="execMain.c.html#LN2336"><span class='Ref_To_Local'>erm</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="execMain.c.html#LN2330"><span class='Ref_to_Parameter'>missing_ok</span></a><span class='Parentheses'>) 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"failed to find ExecRowMark for rangetable index %u"</span><span class='Delimiter'>, </span><a href="execMain.c.html#LN2330"><span class='Ref_to_Parameter'>rti</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * ExecBuildAuxRowMark -- create an ExecAuxRowMark struct 
 * 
 * Inputs are the underlying ExecRowMark struct and the targetlist of the 
 * input plan node (not planstate node!).  We need the latter to find out 
 * the column numbers of the resjunk columns. 
 */ 
</span><a href="../../include/nodes/execnodes.h.html#LN535"><span class='Ref_to_Struct'>ExecAuxRowMark</span></a> <span class='Operator'>* 
</span><a name="LN2354"></a><span class='Declare_Function'>ExecBuildAuxRowMark</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN508"><span class='Ref_to_Struct'>ExecRowMark</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>erm</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>targetlist</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2356"></a>    <a href="../../include/nodes/execnodes.h.html#LN535"><span class='Ref_to_Struct'>ExecAuxRowMark</span></a> <span class='Operator'>*</span><span class='Declare_Local'>aerm</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN535"><span class='Ref_to_Struct'>ExecAuxRowMark</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN535"><span class='Ref_to_Struct'>ExecAuxRowMark</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN2357"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>resname</span><span class='Delimiter'>[</span><span class='Number'>32</span><span class='Delimiter'>]; 
</span> 
    <a href="execMain.c.html#LN2356"><span class='Ref_To_Local'>aerm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN537"><span class='Ref_to_Member'>rowmark</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN2354"><span class='Ref_to_Parameter'>erm</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Look up the resjunk columns associated with this rowmark */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN2354"><span class='Ref_to_Parameter'>erm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN515"><span class='Ref_to_Member'>markType</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/plannodes.h.html#LN958"><span class='Ref_to_EnumConst'>ROW_MARK_COPY</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* need ctid for all methods other than COPY */ 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2357"><span class='Ref_To_Local'>resname</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="execMain.c.html#LN2357"><span class='Ref_To_Local'>resname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"ctid%u"</span><span class='Delimiter'>, </span><a href="execMain.c.html#LN2354"><span class='Ref_to_Parameter'>erm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN514"><span class='Ref_to_Member'>rowmarkId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN2356"><span class='Ref_To_Local'>aerm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN538"><span class='Ref_to_Member'>ctidAttNo</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN156"><span class='Ref_to_Proto'>ExecFindJunkAttributeInTlist</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2354"><span class='Ref_to_Parameter'>targetlist</span></a><span class='Delimiter'>, 
</span>                                                       <a href="execMain.c.html#LN2357"><span class='Ref_To_Local'>resname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/attnum.h.html#LN33"><span class='Ref_to_Macro'>AttributeNumberIsValid</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2356"><span class='Ref_To_Local'>aerm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN538"><span class='Ref_to_Member'>ctidAttNo</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not find junk %s column"</span><span class='Delimiter'>, </span><a href="execMain.c.html#LN2357"><span class='Ref_To_Local'>resname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* need wholerow if COPY */ 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2357"><span class='Ref_To_Local'>resname</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="execMain.c.html#LN2357"><span class='Ref_To_Local'>resname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"wholerow%u"</span><span class='Delimiter'>, </span><a href="execMain.c.html#LN2354"><span class='Ref_to_Parameter'>erm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN514"><span class='Ref_to_Member'>rowmarkId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN2356"><span class='Ref_To_Local'>aerm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN540"><span class='Ref_to_Member'>wholeAttNo</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN156"><span class='Ref_to_Proto'>ExecFindJunkAttributeInTlist</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2354"><span class='Ref_to_Parameter'>targetlist</span></a><span class='Delimiter'>, 
</span>                                                        <a href="execMain.c.html#LN2357"><span class='Ref_To_Local'>resname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/attnum.h.html#LN33"><span class='Ref_to_Macro'>AttributeNumberIsValid</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2356"><span class='Ref_To_Local'>aerm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN540"><span class='Ref_to_Member'>wholeAttNo</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not find junk %s column"</span><span class='Delimiter'>, </span><a href="execMain.c.html#LN2357"><span class='Ref_To_Local'>resname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* if child rel, need tableoid */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN2354"><span class='Ref_to_Parameter'>erm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN512"><span class='Ref_to_Member'>rti</span></a> <span class='Operator'>!= </span><a href="execMain.c.html#LN2354"><span class='Ref_to_Parameter'>erm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN513"><span class='Ref_to_Member'>prti</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2357"><span class='Ref_To_Local'>resname</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="execMain.c.html#LN2357"><span class='Ref_To_Local'>resname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"tableoid%u"</span><span class='Delimiter'>, </span><a href="execMain.c.html#LN2354"><span class='Ref_to_Parameter'>erm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN514"><span class='Ref_to_Member'>rowmarkId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN2356"><span class='Ref_To_Local'>aerm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN539"><span class='Ref_to_Member'>toidAttNo</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN156"><span class='Ref_to_Proto'>ExecFindJunkAttributeInTlist</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2354"><span class='Ref_to_Parameter'>targetlist</span></a><span class='Delimiter'>, 
</span>                                                       <a href="execMain.c.html#LN2357"><span class='Ref_To_Local'>resname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/attnum.h.html#LN33"><span class='Ref_to_Macro'>AttributeNumberIsValid</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2356"><span class='Ref_To_Local'>aerm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN539"><span class='Ref_to_Member'>toidAttNo</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not find junk %s column"</span><span class='Delimiter'>, </span><a href="execMain.c.html#LN2357"><span class='Ref_To_Local'>resname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="execMain.c.html#LN2356"><span class='Ref_To_Local'>aerm</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecBuildAuxRowMark &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * EvalPlanQual logic --- recheck modified tuple(s) to see if we want to 
 * process the updated version under READ COMMITTED rules. 
 * 
 * See backend/executor/README for some info about how this works. 
 */ 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Check a modified tuple to see if we want to process its updated version 
 * under READ COMMITTED rules. 
 * 
 *  estate - outer executor state data 
 *  epqstate - state for EvalPlanQual rechecking 
 *  relation - table containing tuple 
 *  rti - rangetable index of table containing tuple 
 *  lockmode - requested tuple lock mode 
 *  *tid - t_ctid from the outdated tuple (ie, next updated version) 
 *  priorXmax - t_xmax from the outdated tuple 
 * 
 * *tid is also an output parameter: it's modified to hold the TID of the 
 * latest version of the tuple (note this may be changed even on failure) 
 * 
 * Returns a slot containing the new candidate update/delete tuple, or 
 * NULL if we determine we shouldn't process the row. 
 * 
 * Note: properly, lockmode should be declared as enum LockTupleMode, 
 * but we use "int" to avoid having to include heapam.h in executor.h. 
 */ 
</span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>* 
</span><a name="LN2425"></a><span class='Declare_Function'>EvalPlanQual</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN873"><span class='Ref_to_Struct'>EPQState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>epqstate</span><span class='Delimiter'>, 
</span><a name="LN2426"></a>             <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>rti</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>lockmode</span><span class='Delimiter'>, 
</span><a name="LN2427"></a>             <a href="../../include/storage/itemptr.h.html#LN47"><span class='Ref_to_Typedef'>ItemPointer</span></a> <span class='Declare_Parameter'>tid</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Parameter'>priorXmax</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2429"></a>    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>slot</span><span class='Delimiter'>; 
</span><a name="LN2430"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>copyTuple</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="execMain.c.html#LN2426"><span class='Ref_to_Parameter'>rti</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get and lock the updated version of the row; if fail, return NULL. 
     */ 
</span>    <a href="execMain.c.html#LN2430"><span class='Ref_To_Local'>copyTuple</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN198"><span class='Ref_to_Proto'>EvalPlanQualFetch</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2425"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN2426"><span class='Ref_to_Parameter'>relation</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN2426"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/lockoptions.h.html#LN38"><span class='Ref_to_EnumConst'>LockWaitBlock</span></a><span class='Delimiter'>, 
</span>                                  <a href="execMain.c.html#LN2427"><span class='Ref_to_Parameter'>tid</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN2427"><span class='Ref_to_Parameter'>priorXmax</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN2430"><span class='Ref_To_Local'>copyTuple</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * For UPDATE/DELETE we have to return tid of actual row we're executing 
     * PQ for. 
     */ 
</span>    <span class='Operator'>*</span><a href="execMain.c.html#LN2427"><span class='Ref_to_Parameter'>tid</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN2430"><span class='Ref_To_Local'>copyTuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Need to run a recheck subquery.  Initialize or reinitialize EPQ state. 
     */ 
</span>    <a href="../../include/executor/executor.h.html#LN222"><span class='Ref_to_Proto'>EvalPlanQualBegin</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2425"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN2425"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Free old test tuple, if any, and store new tuple where relation's scan 
     * node will see it 
     */ 
</span>    <a href="../../include/executor/executor.h.html#LN205"><span class='Ref_to_Proto'>EvalPlanQualSetTuple</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2425"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN2426"><span class='Ref_to_Parameter'>rti</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN2430"><span class='Ref_To_Local'>copyTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Fetch any non-locked source rows 
     */ 
</span>    <a href="../../include/executor/executor.h.html#LN220"><span class='Ref_to_Proto'>EvalPlanQualFetchRowMarks</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2425"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Run the EPQ query.  We assume it will return at most one tuple. 
     */ 
</span>    <a href="execMain.c.html#LN2429"><span class='Ref_To_Local'>slot</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN221"><span class='Ref_to_Proto'>EvalPlanQualNext</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2425"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we got a tuple, force the slot to materialize the tuple so that it 
     * is not dependent on any local state in the EPQ query (in particular, 
     * it's highly likely that the slot contains references to any pass-by-ref 
     * datums that may be present in copyTuple).  As with the next step, this 
     * is to guard against early re-use of the EPQ query. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/executor/tuptable.h.html#LN137"><span class='Ref_to_Macro'>TupIsNull</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2429"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>))</span> 
        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../include/executor/tuptable.h.html#LN162"><span class='Ref_to_Proto'>ExecMaterializeSlot</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2429"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Clear out the test tuple.  This is needed in case the EPQ query is 
     * re-used to test a tuple for a different relation.  (Not clear that can 
     * really happen, but let's be safe.) 
     */ 
</span>    <a href="../../include/executor/executor.h.html#LN205"><span class='Ref_to_Proto'>EvalPlanQualSetTuple</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2425"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN2426"><span class='Ref_to_Parameter'>rti</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="execMain.c.html#LN2429"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end EvalPlanQual &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Fetch a copy of the newest version of an outdated tuple 
 * 
 *  estate - executor state data 
 *  relation - table containing tuple 
 *  lockmode - requested tuple lock mode 
 *  wait_policy - requested lock wait policy 
 *  *tid - t_ctid from the outdated tuple (ie, next updated version) 
 *  priorXmax - t_xmax from the outdated tuple 
 * 
 * Returns a palloc'd copy of the newest tuple version, or NULL if we find 
 * that there is no newest version (ie, the row was deleted not updated). 
 * We also return NULL if the tuple is locked and the wait policy is to skip 
 * such tuples. 
 * 
 * If successful, we have locked the newest tuple version, so caller does not 
 * need to worry about it changing anymore. 
 * 
 * Note: properly, lockmode should be declared as enum LockTupleMode, 
 * but we use "int" to avoid having to include heapam.h in executor.h. 
 */ 
</span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> 
<a name="LN2512"></a><span class='Declare_Function'>EvalPlanQualFetch</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>lockmode</span><span class='Delimiter'>, 
</span><a name="LN2513"></a>                  <a href="../../include/nodes/lockoptions.h.html#LN35"><span class='Ref_to_Enum'>LockWaitPolicy</span></a> <span class='Declare_Parameter'>wait_policy</span><span class='Delimiter'>, 
</span><a name="LN2514"></a>                  <a href="../../include/storage/itemptr.h.html#LN47"><span class='Ref_to_Typedef'>ItemPointer</span></a> <span class='Declare_Parameter'>tid</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Parameter'>priorXmax</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2516"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>copyTuple</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN2517"></a>    <a href="../../include/access/htup.h.html#LN61"><span class='Ref_to_Struct'>HeapTupleData</span></a> <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN2518"></a>    <a href="../../include/utils/snapshot.h.html#LN51"><span class='Ref_to_Struct'>SnapshotData</span></a> <span class='Declare_Local'>SnapshotDirty</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * fetch target tuple 
     * 
     * Loop here to deal with updated or busy tuples 
     */ 
</span>    <a href="../../include/utils/tqual.h.html#LN99"><span class='Ref_to_Macro'>InitDirtySnapshot</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2518"><span class='Ref_To_Local'>SnapshotDirty</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN2517"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a> <span class='Operator'>= *</span><a href="execMain.c.html#LN2514"><span class='Ref_to_Parameter'>tid</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2529"></a>        <a href="../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>buffer</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/heapam.h.html#LN134"><span class='Ref_to_Proto'>heap_fetch</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2512"><span class='Ref_to_Parameter'>relation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="execMain.c.html#LN2518"><span class='Ref_To_Local'>SnapshotDirty</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="execMain.c.html#LN2517"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="execMain.c.html#LN2529"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN2533"></a>            <a href="../../include/utils/snapshot.h.html#LN118"><span class='Ref_to_Typedef'>HTSU_Result</span></a> <span class='Declare_Local'>test</span><span class='Delimiter'>; 
</span><a name="LN2534"></a>            <a href="../../include/access/heapam.h.html#LN67"><span class='Ref_to_Struct'>HeapUpdateFailureData</span></a> <span class='Declare_Local'>hufd</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If xmin isn't what we're expecting, the slot must have been 
             * recycled and reused for an unrelated tuple.  This implies that 
             * the latest version of the row was deleted, so we need do 
             * nothing.  (Should be safe to examine xmin without getting 
             * buffer's content lock.  We assume reading a TransactionId to be 
             * atomic, and Xmin never changes in an existing tuple, except to 
             * invalid or frozen, and neither of those can match priorXmax.) 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/transam.h.html#LN42"><span class='Ref_to_Macro'>TransactionIdEquals</span></a><span class='Parentheses'>(</span><a href="../../include/access/htup_details.h.html#LN306"><span class='Ref_to_Macro'>HeapTupleHeaderGetXmin</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2517"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="execMain.c.html#LN2514"><span class='Ref_to_Parameter'>priorXmax</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../include/storage/bufmgr.h.html#LN174"><span class='Ref_to_Proto'>ReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2529"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* otherwise xmin should not be dirty... */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/transam.h.html#LN40"><span class='Ref_to_Macro'>TransactionIdIsValid</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2518"><span class='Ref_To_Local'>SnapshotDirty</span></a><span class='Operator'>.</span><a href="../../include/utils/snapshot.h.html#LN65"><span class='Ref_to_Member'>xmin</span></a><span class='Parentheses'>))</span> 
                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"t_xmin is uncommitted in tuple to be updated"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If tuple is being updated by other transaction then we have to 
             * wait for its commit/abort, or die trying. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/transam.h.html#LN40"><span class='Ref_to_Macro'>TransactionIdIsValid</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2518"><span class='Ref_To_Local'>SnapshotDirty</span></a><span class='Operator'>.</span><a href="../../include/utils/snapshot.h.html#LN66"><span class='Ref_to_Member'>xmax</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../include/storage/bufmgr.h.html#LN174"><span class='Ref_to_Proto'>ReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2529"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN2513"><span class='Ref_to_Parameter'>wait_policy</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>case</span> <a href="../../include/nodes/lockoptions.h.html#LN38"><span class='Ref_to_EnumConst'>LockWaitBlock</span></a><span class='Operator'>: 
</span>                        <a href="../../include/storage/lmgr.h.html#LN73"><span class='Ref_to_Proto'>XactLockTableWait</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2518"><span class='Ref_To_Local'>SnapshotDirty</span></a><span class='Operator'>.</span><a href="../../include/utils/snapshot.h.html#LN66"><span class='Ref_to_Member'>xmax</span></a><span class='Delimiter'>, 
</span>                                          <a href="execMain.c.html#LN2512"><span class='Ref_to_Parameter'>relation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="execMain.c.html#LN2517"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../include/storage/lmgr.h.html#LN32"><span class='Ref_to_EnumConst'>XLTW_FetchUpdated</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <a href="../../include/nodes/lockoptions.h.html#LN40"><span class='Ref_to_EnumConst'>LockWaitSkip</span></a><span class='Operator'>: 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/storage/lmgr.h.html#LN75"><span class='Ref_to_Proto'>ConditionalXactLockTableWait</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2518"><span class='Ref_To_Local'>SnapshotDirty</span></a><span class='Operator'>.</span><a href="../../include/utils/snapshot.h.html#LN66"><span class='Ref_to_Member'>xmax</span></a><span class='Parentheses'>))</span> 
                            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* skip instead of waiting */ 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <a href="../../include/nodes/lockoptions.h.html#LN42"><span class='Ref_to_EnumConst'>LockWaitError</span></a><span class='Operator'>: 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/storage/lmgr.h.html#LN75"><span class='Ref_to_Proto'>ConditionalXactLockTableWait</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2518"><span class='Ref_To_Local'>SnapshotDirty</span></a><span class='Operator'>.</span><a href="../../include/utils/snapshot.h.html#LN66"><span class='Ref_to_Member'>xmax</span></a><span class='Parentheses'>))</span> 
                            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_LOCK_NOT_AVAILABLE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not obtain lock on row in relation \"%s\""</span><span class='Delimiter'>, 
</span>                                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2512"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>continue</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* loop back to repeat heap_fetch */ 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if TransactionIdIsValid(... &raquo; </span> 
 
            <span class='Comment_Multi_Line'>/* 
             * If tuple was inserted by our own transaction, we have to check 
             * cmin against es_output_cid: cmin &GT;= current CID means our 
             * command cannot see the tuple, so we should ignore it. Otherwise 
             * heap_lock_tuple() will throw an error, and so would any later 
             * attempt to update or delete the tuple.  (We need not check cmax 
             * because HeapTupleSatisfiesDirty will consider a tuple deleted 
             * by our transaction dead, regardless of cmax.) We just checked 
             * that priorXmax == xmin, so we can test that variable instead of 
             * doing HeapTupleHeaderGetXmin again. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2514"><span class='Ref_to_Parameter'>priorXmax</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                <a href="../../include/access/htup.h.html#LN79"><span class='Ref_to_Proto'>HeapTupleHeaderGetCmin</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2517"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><a href="execMain.c.html#LN2512"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN417"><span class='Ref_to_Member'>es_output_cid</span></a><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../include/storage/bufmgr.h.html#LN174"><span class='Ref_to_Proto'>ReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2529"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * This is a live tuple, so now try to lock it. 
             */ 
</span>            <a href="execMain.c.html#LN2533"><span class='Ref_To_Local'>test</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN164"><span class='Ref_to_Proto'>heap_lock_tuple</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2512"><span class='Ref_to_Parameter'>relation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="execMain.c.html#LN2517"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, 
</span>                                   <a href="execMain.c.html#LN2512"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN417"><span class='Ref_to_Member'>es_output_cid</span></a><span class='Delimiter'>, 
</span>                                   <a href="execMain.c.html#LN2512"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN2513"><span class='Ref_to_Parameter'>wait_policy</span></a><span class='Delimiter'>, 
</span>                                   <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="execMain.c.html#LN2529"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="execMain.c.html#LN2534"><span class='Ref_To_Local'>hufd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* We now have two pins on the buffer, get rid of one */ 
</span>            <a href="../../include/storage/bufmgr.h.html#LN174"><span class='Ref_to_Proto'>ReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2529"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN2533"><span class='Ref_To_Local'>test</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>case</span> <a href="../../include/utils/snapshot.h.html#LN122"><span class='Ref_to_EnumConst'>HeapTupleSelfUpdated</span></a><span class='Operator'>: 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * The target tuple was already updated or deleted by the 
                     * current command, or by a later command in the current 
                     * transaction.  We *must* ignore the tuple in the former 
                     * case, so as to avoid the "Halloween problem" of 
                     * repeated update attempts.  In the latter case it might 
                     * be sensible to fetch the updated tuple instead, but 
                     * doing so would require changing heap_update and 
                     * heap_delete to not complain about updating "invisible" 
                     * tuples, which seems pretty scary (heap_lock_tuple will 
                     * not complain, but few callers expect 
                     * HeapTupleInvisible, and we're not one of them).  So for 
                     * now, treat the tuple as deleted and do not process. 
                     */ 
</span>                    <a href="../../include/storage/bufmgr.h.html#LN174"><span class='Ref_to_Proto'>ReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2529"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <a href="../../include/utils/snapshot.h.html#LN120"><span class='Ref_to_EnumConst'>HeapTupleMayBeUpdated</span></a><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* successfully locked */ 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <a href="../../include/utils/snapshot.h.html#LN123"><span class='Ref_to_EnumConst'>HeapTupleUpdated</span></a><span class='Operator'>: 
</span>                    <a href="../../include/storage/bufmgr.h.html#LN174"><span class='Ref_to_Proto'>ReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2529"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/xact.h.html#LN42"><span class='Ref_to_Macro'>IsolationUsesXactSnapshot</span></a><span class='Parentheses'>())</span> 
                        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_T_R_SERIALIZATION_FAILURE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not serialize access due to concurrent update"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* Should not encounter speculative tuple on recheck */ 
</span>                    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup_details.h.html#LN422"><span class='Ref_to_Macro'>HeapTupleHeaderIsSpeculative</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2517"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../storage/page/itemptr.c.html#LN27"><span class='Ref_to_Func'>ItemPointerEquals</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="execMain.c.html#LN2534"><span class='Ref_To_Local'>hufd</span></a><span class='Operator'>.</span><a href="../../include/access/heapam.h.html#LN69"><span class='Ref_to_Member'>ctid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="execMain.c.html#LN2517"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>))</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* it was updated, so look at the updated version */ 
</span>                        <a href="execMain.c.html#LN2517"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN2534"><span class='Ref_To_Local'>hufd</span></a><span class='Operator'>.</span><a href="../../include/access/heapam.h.html#LN69"><span class='Ref_to_Member'>ctid</span></a><span class='Delimiter'>; 
</span>                        <span class='Comment_Multi_Line'>/* updated row should have xmin matching this xmax */ 
</span>                        <a href="execMain.c.html#LN2514"><span class='Ref_to_Parameter'>priorXmax</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN2534"><span class='Ref_To_Local'>hufd</span></a><span class='Operator'>.</span><a href="../../include/access/heapam.h.html#LN70"><span class='Ref_to_Member'>xmax</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Comment_Multi_Line'>/* tuple was deleted, so give up */ 
</span>                    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <a href="../../include/utils/snapshot.h.html#LN125"><span class='Ref_to_EnumConst'>HeapTupleWouldBlock</span></a><span class='Operator'>: 
</span>                    <a href="../../include/storage/bufmgr.h.html#LN174"><span class='Ref_to_Proto'>ReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2529"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <a href="../../include/utils/snapshot.h.html#LN121"><span class='Ref_to_EnumConst'>HeapTupleInvisible</span></a><span class='Operator'>: 
</span>                    <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"attempted to lock invisible tuple"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>default</span><span class='Operator'>: 
</span>                    <a href="../../include/storage/bufmgr.h.html#LN174"><span class='Ref_to_Proto'>ReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2529"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized heap_lock_tuple status: %u"</span><span class='Delimiter'>, 
</span>                         <a href="execMain.c.html#LN2533"><span class='Ref_To_Local'>test</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch test &raquo; </span> 
 
            <span class='Comment_Multi_Line'>/* 
             * We got tuple - now copy it for use by recheck query. 
             */ 
</span>            <a href="execMain.c.html#LN2516"><span class='Ref_To_Local'>copyTuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN606"><span class='Ref_to_Func'>heap_copytuple</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="execMain.c.html#LN2517"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/storage/bufmgr.h.html#LN174"><span class='Ref_to_Proto'>ReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2529"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if heap_fetch(relation,&... &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * If the referenced slot was actually empty, the latest version of 
         * the row must have been deleted, so we need do nothing. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN2517"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/storage/bufmgr.h.html#LN174"><span class='Ref_to_Proto'>ReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2529"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * As above, if xmin isn't what we're expecting, do nothing. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/transam.h.html#LN42"><span class='Ref_to_Macro'>TransactionIdEquals</span></a><span class='Parentheses'>(</span><a href="../../include/access/htup_details.h.html#LN306"><span class='Ref_to_Macro'>HeapTupleHeaderGetXmin</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2517"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="execMain.c.html#LN2514"><span class='Ref_to_Parameter'>priorXmax</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/storage/bufmgr.h.html#LN174"><span class='Ref_to_Proto'>ReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2529"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If we get here, the tuple was found but failed SnapshotDirty. 
         * Assuming the xmin is either a committed xact or our own xact (as it 
         * certainly should be if we're trying to modify the tuple), this must 
         * mean that the row was updated or deleted by either a committed xact 
         * or our own xact.  If it was deleted, we can ignore it; if it was 
         * updated then chain up to the next version and repeat the whole 
         * process. 
         * 
         * As above, it should be safe to examine xmax and t_ctid without the 
         * buffer content lock, because they can't be changing. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../storage/page/itemptr.c.html#LN27"><span class='Ref_to_Func'>ItemPointerEquals</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="execMain.c.html#LN2517"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="execMain.c.html#LN2517"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup_details.h.html#LN149"><span class='Ref_to_Member'>t_ctid</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* deleted, so forget about it */ 
</span>            <a href="../../include/storage/bufmgr.h.html#LN174"><span class='Ref_to_Proto'>ReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2529"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* updated, so look at the updated row */ 
</span>        <a href="execMain.c.html#LN2517"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN2517"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup_details.h.html#LN149"><span class='Ref_to_Member'>t_ctid</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* updated row should have xmin matching this xmax */ 
</span>        <a href="execMain.c.html#LN2514"><span class='Ref_to_Parameter'>priorXmax</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN358"><span class='Ref_to_Macro'>HeapTupleHeaderGetUpdateXid</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2517"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/storage/bufmgr.h.html#LN174"><span class='Ref_to_Proto'>ReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2529"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* loop back to fetch next in chain */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Return the copied tuple 
     */ 
</span>    <span class='Control'>return</span> <a href="execMain.c.html#LN2516"><span class='Ref_To_Local'>copyTuple</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end EvalPlanQualFetch &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * EvalPlanQualInit -- initialize during creation of a plan state node 
 * that might need to invoke EPQ processing. 
 * 
 * Note: subplan/auxrowmarks can be NULL/NIL if they will be set later 
 * with EvalPlanQualSetPlan. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2741"></a><span class='Declare_Function'>EvalPlanQualInit</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN873"><span class='Ref_to_Struct'>EPQState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>epqstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN2742"></a>                 <a href="../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>subplan</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>auxrowmarks</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>epqParam</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Mark the EPQ state inactive */ 
</span>    <a href="execMain.c.html#LN2741"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN875"><span class='Ref_to_Member'>estate</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN2741"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN876"><span class='Ref_to_Member'>planstate</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN2741"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN877"><span class='Ref_to_Member'>origslot</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* ... and remember data that EvalPlanQualBegin will need */ 
</span>    <a href="execMain.c.html#LN2741"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN878"><span class='Ref_to_Member'>plan</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN2742"><span class='Ref_to_Parameter'>subplan</span></a><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN2741"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN879"><span class='Ref_to_Member'>arowMarks</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN2742"><span class='Ref_to_Parameter'>auxrowmarks</span></a><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN2741"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN880"><span class='Ref_to_Member'>epqParam</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN2742"><span class='Ref_to_Parameter'>epqParam</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * EvalPlanQualSetPlan -- set or change subplan of an EPQState. 
 * 
 * We need this so that ModifyTable can deal with multiple subplans. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2760"></a><span class='Declare_Function'>EvalPlanQualSetPlan</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN873"><span class='Ref_to_Struct'>EPQState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>epqstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>subplan</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>auxrowmarks</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* If we have a live EPQ query, shut it down */ 
</span>    <a href="../../include/executor/executor.h.html#LN223"><span class='Ref_to_Proto'>EvalPlanQualEnd</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2760"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* And set/change the plan pointer */ 
</span>    <a href="execMain.c.html#LN2760"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN878"><span class='Ref_to_Member'>plan</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN2760"><span class='Ref_to_Parameter'>subplan</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* The rowmarks depend on the plan, too */ 
</span>    <a href="execMain.c.html#LN2760"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN879"><span class='Ref_to_Member'>arowMarks</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN2760"><span class='Ref_to_Parameter'>auxrowmarks</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Install one test tuple into EPQ state, or clear test tuple if tuple == NULL 
 * 
 * NB: passed tuple must be palloc'd; it may get freed later 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2776"></a><span class='Declare_Function'>EvalPlanQualSetTuple</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN873"><span class='Ref_to_Struct'>EPQState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>epqstate</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>rti</span><span class='Delimiter'>, </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tuple</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2778"></a>    <a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>estate</span> <span class='Operator'>= </span><a href="execMain.c.html#LN2776"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN875"><span class='Ref_to_Member'>estate</span></a><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="execMain.c.html#LN2776"><span class='Ref_to_Parameter'>rti</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * free old test tuple, if any, and store new tuple where relation's scan 
     * node will see it 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN2778"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN482"><span class='Ref_to_Member'>es_epqTuple</span></a><span class='Delimiter'>[</span><a href="execMain.c.html#LN2776"><span class='Ref_to_Parameter'>rti</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2778"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN482"><span class='Ref_to_Member'>es_epqTuple</span></a><span class='Delimiter'>[</span><a href="execMain.c.html#LN2776"><span class='Ref_to_Parameter'>rti</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN2778"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN482"><span class='Ref_to_Member'>es_epqTuple</span></a><span class='Delimiter'>[</span><a href="execMain.c.html#LN2776"><span class='Ref_to_Parameter'>rti</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="execMain.c.html#LN2776"><span class='Ref_to_Parameter'>tuple</span></a><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN2778"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN483"><span class='Ref_to_Member'>es_epqTupleSet</span></a><span class='Delimiter'>[</span><a href="execMain.c.html#LN2776"><span class='Ref_to_Parameter'>rti</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Fetch back the current test tuple (if any) for the specified RTI 
 */ 
</span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> 
<a name="LN2796"></a><span class='Declare_Function'>EvalPlanQualGetTuple</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN873"><span class='Ref_to_Struct'>EPQState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>epqstate</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>rti</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2798"></a>    <a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>estate</span> <span class='Operator'>= </span><a href="execMain.c.html#LN2796"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN875"><span class='Ref_to_Member'>estate</span></a><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="execMain.c.html#LN2796"><span class='Ref_to_Parameter'>rti</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="execMain.c.html#LN2798"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN482"><span class='Ref_to_Member'>es_epqTuple</span></a><span class='Delimiter'>[</span><a href="execMain.c.html#LN2796"><span class='Ref_to_Parameter'>rti</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Fetch the current row values for any non-locked relations that need 
 * to be scanned by an EvalPlanQual operation.  origslot must have been set 
 * to contain the current result row (top-level row) that we need to recheck. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2811"></a><span class='Declare_Function'>EvalPlanQualFetchRowMarks</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN873"><span class='Ref_to_Struct'>EPQState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>epqstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2813"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="execMain.c.html#LN2811"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN877"><span class='Ref_to_Member'>origslot</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2813"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN2811"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN879"><span class='Ref_to_Member'>arowMarks</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2819"></a>        <a href="../../include/nodes/execnodes.h.html#LN535"><span class='Ref_to_Struct'>ExecAuxRowMark</span></a> <span class='Operator'>*</span><span class='Declare_Local'>aerm</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN535"><span class='Ref_to_Struct'>ExecAuxRowMark</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2813"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2820"></a>        <a href="../../include/nodes/execnodes.h.html#LN508"><span class='Ref_to_Struct'>ExecRowMark</span></a> <span class='Operator'>*</span><span class='Declare_Local'>erm</span> <span class='Operator'>= </span><a href="execMain.c.html#LN2819"><span class='Ref_To_Local'>aerm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN537"><span class='Ref_to_Member'>rowmark</span></a><span class='Delimiter'>; 
</span><a name="LN2821"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>datum</span><span class='Delimiter'>; 
</span><a name="LN2822"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN2823"></a>        <a href="../../include/access/htup.h.html#LN61"><span class='Ref_to_Struct'>HeapTupleData</span></a> <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN961"><span class='Ref_to_Macro'>RowMarkRequiresRowShareLock</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2820"><span class='Ref_To_Local'>erm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN515"><span class='Ref_to_Member'>markType</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"EvalPlanQual doesn't support locking rowmarks"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* clear any leftover test tuple for this rel */ 
</span>        <a href="../../include/executor/executor.h.html#LN205"><span class='Ref_to_Proto'>EvalPlanQualSetTuple</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2811"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN2820"><span class='Ref_To_Local'>erm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN512"><span class='Ref_to_Member'>rti</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* if child rel, must check whether it produced this row */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN2820"><span class='Ref_To_Local'>erm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN512"><span class='Ref_to_Member'>rti</span></a> <span class='Operator'>!= </span><a href="execMain.c.html#LN2820"><span class='Ref_To_Local'>erm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN513"><span class='Ref_to_Member'>prti</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2834"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tableoid</span><span class='Delimiter'>; 
</span> 
            <a href="execMain.c.html#LN2821"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN158"><span class='Ref_to_Proto'>ExecGetJunkAttribute</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2811"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN877"><span class='Ref_to_Member'>origslot</span></a><span class='Delimiter'>, 
</span>                                         <a href="execMain.c.html#LN2819"><span class='Ref_To_Local'>aerm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN539"><span class='Ref_to_Member'>toidAttNo</span></a><span class='Delimiter'>, 
</span>                                         <span class='Operator'>&</span><a href="execMain.c.html#LN2822"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* non-locked rels could be on the inside of outer joins */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN2822"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <a href="execMain.c.html#LN2834"><span class='Ref_To_Local'>tableoid</span></a> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN505"><span class='Ref_to_Macro'>DatumGetObjectId</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2821"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2820"><span class='Ref_To_Local'>erm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN511"><span class='Ref_to_Member'>relid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN2834"><span class='Ref_To_Local'>tableoid</span></a> <span class='Operator'>!= </span><a href="execMain.c.html#LN2820"><span class='Ref_To_Local'>erm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN511"><span class='Ref_to_Member'>relid</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* this child is inactive right now */ 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN2820"><span class='Ref_To_Local'>erm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN515"><span class='Ref_to_Member'>markType</span></a> <span class='Operator'>== </span><a href="../../include/nodes/plannodes.h.html#LN957"><span class='Ref_to_EnumConst'>ROW_MARK_REFERENCE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2854"></a>            <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>copyTuple</span><span class='Delimiter'>; 
</span> 
            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="execMain.c.html#LN2820"><span class='Ref_To_Local'>erm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN510"><span class='Ref_to_Member'>relation</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* fetch the tuple's ctid */ 
</span>            <a href="execMain.c.html#LN2821"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN158"><span class='Ref_to_Proto'>ExecGetJunkAttribute</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2811"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN877"><span class='Ref_to_Member'>origslot</span></a><span class='Delimiter'>, 
</span>                                         <a href="execMain.c.html#LN2819"><span class='Ref_To_Local'>aerm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN538"><span class='Ref_to_Member'>ctidAttNo</span></a><span class='Delimiter'>, 
</span>                                         <span class='Operator'>&</span><a href="execMain.c.html#LN2822"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* non-locked rels could be on the inside of outer joins */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN2822"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* fetch requests on foreign tables must be passed to their FDW */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN2820"><span class='Ref_To_Local'>erm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN510"><span class='Ref_to_Member'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2869"></a>                <a href="../../include/foreign/fdwapi.h.html#LN168"><span class='Ref_to_Struct'>FdwRoutine</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fdwroutine</span><span class='Delimiter'>; 
</span><a name="LN2870"></a>                <span class='Keyword'>bool</span>        <span class='Declare_Local'>updated</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
                <a href="execMain.c.html#LN2869"><span class='Ref_To_Local'>fdwroutine</span></a> <span class='Operator'>= </span><a href="../../include/foreign/fdwapi.h.html#LN236"><span class='Ref_to_Proto'>GetFdwRoutineForRelation</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2820"><span class='Ref_To_Local'>erm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN510"><span class='Ref_to_Member'>relation</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* this should have been checked already, but let's be safe */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN2869"><span class='Ref_To_Local'>fdwroutine</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/fdwapi.h.html#LN208"><span class='Ref_to_Member'>RefetchForeignRow</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot lock rows in foreign table \"%s\""</span><span class='Delimiter'>, 
</span>                                  <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2820"><span class='Ref_To_Local'>erm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN510"><span class='Ref_to_Member'>relation</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>                <a href="execMain.c.html#LN2854"><span class='Ref_To_Local'>copyTuple</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN2869"><span class='Ref_To_Local'>fdwroutine</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/fdwapi.h.html#LN208"><span class='Ref_to_Member'>RefetchForeignRow</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2811"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN875"><span class='Ref_to_Member'>estate</span></a><span class='Delimiter'>, 
</span>                                                          <a href="execMain.c.html#LN2820"><span class='Ref_To_Local'>erm</span></a><span class='Delimiter'>, 
</span>                                                          <a href="execMain.c.html#LN2821"><span class='Ref_To_Local'>datum</span></a><span class='Delimiter'>, 
</span>                                                          <span class='Operator'>&</span><a href="execMain.c.html#LN2870"><span class='Ref_To_Local'>updated</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN2854"><span class='Ref_To_Local'>copyTuple</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"failed to fetch tuple for EvalPlanQual recheck"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Ideally we'd insist on updated == false here, but that 
                 * assumes that FDWs can track that exactly, which they might 
                 * not be able to.  So just ignore the flag. 
                 */ 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if erm-&GT;relation-&GT;rd_rel... &raquo; </span> 
            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* ordinary table, fetch the tuple */ 
</span><a name="LN2895"></a>                <a href="../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>buffer</span><span class='Delimiter'>; 
</span> 
                <a href="execMain.c.html#LN2823"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a> <span class='Operator'>= *</span><span class='Parentheses'>((</span><a href="../../include/storage/itemptr.h.html#LN47"><span class='Ref_to_Typedef'>ItemPointer</span></a><span class='Parentheses'>) </span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2821"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/heapam.h.html#LN134"><span class='Ref_to_Proto'>heap_fetch</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2820"><span class='Ref_To_Local'>erm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN510"><span class='Ref_to_Member'>relation</span></a><span class='Delimiter'>, </span><a href="../../include/utils/tqual.h.html#LN27"><span class='Ref_to_Const'>SnapshotAny</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="execMain.c.html#LN2823"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="execMain.c.html#LN2895"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, 
</span>                                <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
                    <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"failed to fetch tuple for EvalPlanQual recheck"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* successful, copy tuple */ 
</span>                <a href="execMain.c.html#LN2854"><span class='Ref_To_Local'>copyTuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN606"><span class='Ref_to_Func'>heap_copytuple</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="execMain.c.html#LN2823"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/storage/bufmgr.h.html#LN174"><span class='Ref_to_Proto'>ReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2895"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* store tuple */ 
</span>            <a href="../../include/executor/executor.h.html#LN205"><span class='Ref_to_Proto'>EvalPlanQualSetTuple</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2811"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN2820"><span class='Ref_To_Local'>erm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN512"><span class='Ref_to_Member'>rti</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN2854"><span class='Ref_To_Local'>copyTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if erm-&GT;markType==ROW_MA... &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span><a name="LN2912"></a>            <a href="../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Local'>td</span><span class='Delimiter'>; 
</span> 
            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="execMain.c.html#LN2820"><span class='Ref_To_Local'>erm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN515"><span class='Ref_to_Member'>markType</span></a> <span class='Operator'>== </span><a href="../../include/nodes/plannodes.h.html#LN958"><span class='Ref_to_EnumConst'>ROW_MARK_COPY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* fetch the whole-row Var for the relation */ 
</span>            <a href="execMain.c.html#LN2821"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN158"><span class='Ref_to_Proto'>ExecGetJunkAttribute</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2811"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN877"><span class='Ref_to_Member'>origslot</span></a><span class='Delimiter'>, 
</span>                                         <a href="execMain.c.html#LN2819"><span class='Ref_To_Local'>aerm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN540"><span class='Ref_to_Member'>wholeAttNo</span></a><span class='Delimiter'>, 
</span>                                         <span class='Operator'>&</span><a href="execMain.c.html#LN2822"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* non-locked rels could be on the inside of outer joins */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN2822"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <a href="execMain.c.html#LN2912"><span class='Ref_To_Local'>td</span></a> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN258"><span class='Ref_to_Macro'>DatumGetHeapTupleHeader</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2821"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* build a temporary HeapTuple control structure */ 
</span>            <a href="execMain.c.html#LN2823"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN438"><span class='Ref_to_Macro'>HeapTupleHeaderGetDatumLength</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2912"><span class='Ref_To_Local'>td</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="execMain.c.html#LN2823"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN2912"><span class='Ref_To_Local'>td</span></a><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* relation might be a foreign table, if so provide tableoid */ 
</span>            <a href="execMain.c.html#LN2823"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN2820"><span class='Ref_To_Local'>erm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN511"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* also copy t_ctid in case there's valid data there */ 
</span>            <a href="execMain.c.html#LN2823"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN2912"><span class='Ref_To_Local'>td</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup_details.h.html#LN149"><span class='Ref_to_Member'>t_ctid</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* copy and store tuple */ 
</span>            <a href="../../include/executor/executor.h.html#LN205"><span class='Ref_to_Proto'>EvalPlanQualSetTuple</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2811"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN2820"><span class='Ref_To_Local'>erm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN512"><span class='Ref_to_Member'>rti</span></a><span class='Delimiter'>, 
</span>                                 <a href="../access/common/heaptuple.c.html#LN606"><span class='Ref_to_Func'>heap_copytuple</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="execMain.c.html#LN2823"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end EvalPlanQualFetchRowMarks &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Fetch the next row (if any) from EvalPlanQual testing 
 * 
 * (In practice, there should never be more than one row...) 
 */ 
</span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>* 
</span><a name="LN2946"></a><span class='Declare_Function'>EvalPlanQualNext</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN873"><span class='Ref_to_Struct'>EPQState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>epqstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2948"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN2949"></a>    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>slot</span><span class='Delimiter'>; 
</span> 
    <a href="execMain.c.html#LN2948"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2946"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN875"><span class='Ref_to_Member'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN447"><span class='Ref_to_Member'>es_query_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN2949"><span class='Ref_To_Local'>slot</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN229"><span class='Ref_to_Proto'>ExecProcNode</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2946"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN876"><span class='Ref_to_Member'>planstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2948"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="execMain.c.html#LN2949"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Initialize or reset an EvalPlanQual state tree 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2962"></a><span class='Declare_Function'>EvalPlanQualBegin</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN873"><span class='Ref_to_Struct'>EPQState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>epqstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parentestate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2964"></a>    <a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>estate</span> <span class='Operator'>= </span><a href="execMain.c.html#LN2962"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN875"><span class='Ref_to_Member'>estate</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN2964"><span class='Ref_To_Local'>estate</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* First time through, so create a child EState */ 
</span>        <a href="execMain.c.html#LN103"><span class='Ref_to_Proto'>EvalPlanQualStart</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2962"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN2962"><span class='Ref_to_Parameter'>parentestate</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN2962"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN878"><span class='Ref_to_Member'>plan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * We already have a suitable child EPQ tree, so just reset it. 
         */ 
</span><a name="LN2976"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>rtsize</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2962"><span class='Ref_to_Parameter'>parentestate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN410"><span class='Ref_to_Member'>es_range_table</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2977"></a>        <a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>planstate</span> <span class='Operator'>= </span><a href="execMain.c.html#LN2962"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN876"><span class='Ref_to_Member'>planstate</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2964"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN484"><span class='Ref_to_Member'>es_epqScanDone</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="execMain.c.html#LN2976"><span class='Ref_To_Local'>rtsize</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Recopy current values of parent parameters */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN2962"><span class='Ref_to_Parameter'>parentestate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN411"><span class='Ref_to_Member'>es_plannedstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN91"><span class='Ref_to_Member'>nParamExec</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2984"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span> <span class='Operator'>= </span><a href="execMain.c.html#LN2962"><span class='Ref_to_Parameter'>parentestate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN411"><span class='Ref_to_Member'>es_plannedstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN91"><span class='Ref_to_Member'>nParamExec</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>--</span><a href="execMain.c.html#LN2984"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* copy value if any, but not execPlan link */ 
</span>                <a href="execMain.c.html#LN2964"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN442"><span class='Ref_to_Member'>es_param_exec_vals</span></a><span class='Delimiter'>[</span><a href="execMain.c.html#LN2984"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><span class='Keyword'>value </span><span class='Operator'>= 
</span>                    <a href="execMain.c.html#LN2962"><span class='Ref_to_Parameter'>parentestate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN442"><span class='Ref_to_Member'>es_param_exec_vals</span></a><span class='Delimiter'>[</span><a href="execMain.c.html#LN2984"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><span class='Keyword'>value</span><span class='Delimiter'>; 
</span>                <a href="execMain.c.html#LN2964"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN442"><span class='Ref_to_Member'>es_param_exec_vals</span></a><span class='Delimiter'>[</span><a href="execMain.c.html#LN2984"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/nodes/params.h.html#LN100"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>= 
</span>                    <a href="execMain.c.html#LN2962"><span class='Ref_to_Parameter'>parentestate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN442"><span class='Ref_to_Member'>es_param_exec_vals</span></a><span class='Delimiter'>[</span><a href="execMain.c.html#LN2984"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/nodes/params.h.html#LN100"><span class='Ref_to_Member'>isnull</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Mark child plan tree as needing rescan at all scan nodes.  The 
         * first ExecProcNode will take care of actually doing the rescan. 
         */ 
</span>        <a href="execMain.c.html#LN2977"><span class='Ref_To_Local'>planstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN836"><span class='Ref_to_Member'>chgParam</span></a> <span class='Operator'>= </span><a href="../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN2977"><span class='Ref_To_Local'>planstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN836"><span class='Ref_to_Member'>chgParam</span></a><span class='Delimiter'>, 
</span>                                             <a href="execMain.c.html#LN2962"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN880"><span class='Ref_to_Member'>epqParam</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end EvalPlanQualBegin &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Start execution of an EvalPlanQual plan tree. 
 * 
 * This is a cut-down version of ExecutorStart(): we copy some state from 
 * the top-level estate rather than initializing it fresh. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3012"></a><span class='Declare_Function'>EvalPlanQualStart</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN873"><span class='Ref_to_Struct'>EPQState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>epqstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parentestate</span><span class='Delimiter'>, </span><a href="../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>planTree</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3014"></a>    <a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>estate</span><span class='Delimiter'>; 
</span><a name="LN3015"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>rtsize</span><span class='Delimiter'>; 
</span><a name="LN3016"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN3017"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <a href="execMain.c.html#LN3015"><span class='Ref_To_Local'>rtsize</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3012"><span class='Ref_to_Parameter'>parentestate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN410"><span class='Ref_to_Member'>es_range_table</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="execMain.c.html#LN3012"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN875"><span class='Ref_to_Member'>estate</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN3014"><span class='Ref_To_Local'>estate</span></a> <span class='Operator'>= </span><a href="execUtils.c.html#LN78"><span class='Ref_to_Func'>CreateExecutorState</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="execMain.c.html#LN3016"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3014"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN447"><span class='Ref_to_Member'>es_query_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Child EPQ EStates share the parent's copy of unchanging state such as 
     * the snapshot, rangetable, result-rel info, and external Param info. 
     * They need their own copies of local state, including a tuple table, 
     * es_param_exec_vals, etc. 
     * 
     * The ResultRelInfo array management is trickier than it looks.  We 
     * create a fresh array for the child but copy all the content from the 
     * parent.  This is because it's okay for the child to share any 
     * per-relation state the parent has already created --- but if the child 
     * sets up any ResultRelInfo fields, such as its own junkfilter, that 
     * state must *not* propagate back to the parent.  (For one thing, the 
     * pointed-to data is in a memory context that won't last long enough.) 
     */ 
</span>    <a href="execMain.c.html#LN3014"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN407"><span class='Ref_to_Member'>es_direction</span></a> <span class='Operator'>= </span><a href="../../include/access/sdir.h.html#LN25"><span class='Ref_to_EnumConst'>ForwardScanDirection</span></a><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN3014"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN408"><span class='Ref_to_Member'>es_snapshot</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN3012"><span class='Ref_to_Parameter'>parentestate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN408"><span class='Ref_to_Member'>es_snapshot</span></a><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN3014"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN409"><span class='Ref_to_Member'>es_crosscheck_snapshot</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN3012"><span class='Ref_to_Parameter'>parentestate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN409"><span class='Ref_to_Member'>es_crosscheck_snapshot</span></a><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN3014"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN410"><span class='Ref_to_Member'>es_range_table</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN3012"><span class='Ref_to_Parameter'>parentestate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN410"><span class='Ref_to_Member'>es_range_table</span></a><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN3014"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN411"><span class='Ref_to_Member'>es_plannedstmt</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN3012"><span class='Ref_to_Parameter'>parentestate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN411"><span class='Ref_to_Member'>es_plannedstmt</span></a><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN3014"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN414"><span class='Ref_to_Member'>es_junkFilter</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN3012"><span class='Ref_to_Parameter'>parentestate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN414"><span class='Ref_to_Member'>es_junkFilter</span></a><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN3014"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN417"><span class='Ref_to_Member'>es_output_cid</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN3012"><span class='Ref_to_Parameter'>parentestate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN417"><span class='Ref_to_Member'>es_output_cid</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN3012"><span class='Ref_to_Parameter'>parentestate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN421"><span class='Ref_to_Member'>es_num_result_relations</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3048"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>numResultRelations</span> <span class='Operator'>= </span><a href="execMain.c.html#LN3012"><span class='Ref_to_Parameter'>parentestate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN421"><span class='Ref_to_Member'>es_num_result_relations</span></a><span class='Delimiter'>; 
</span><a name="LN3049"></a>        <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>resultRelInfos</span><span class='Delimiter'>; 
</span> 
        <a href="execMain.c.html#LN3049"><span class='Ref_To_Local'>resultRelInfos</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3048"><span class='Ref_To_Local'>numResultRelations</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="execMain.c.html#LN3049"><span class='Ref_To_Local'>resultRelInfos</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN3012"><span class='Ref_to_Parameter'>parentestate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN420"><span class='Ref_to_Member'>es_result_relations</span></a><span class='Delimiter'>, 
</span>               <a href="execMain.c.html#LN3048"><span class='Ref_To_Local'>numResultRelations</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN3014"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN420"><span class='Ref_to_Member'>es_result_relations</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN3049"><span class='Ref_To_Local'>resultRelInfos</span></a><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN3014"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN421"><span class='Ref_to_Member'>es_num_result_relations</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN3048"><span class='Ref_To_Local'>numResultRelations</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Comment_Multi_Line'>/* es_result_relation_info must NOT be copied */ 
</span>    <span class='Comment_Multi_Line'>/* es_trig_target_relations must NOT be copied */ 
</span>    <a href="execMain.c.html#LN3014"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN451"><span class='Ref_to_Member'>es_rowMarks</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN3012"><span class='Ref_to_Parameter'>parentestate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN451"><span class='Ref_to_Member'>es_rowMarks</span></a><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN3014"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN456"><span class='Ref_to_Member'>es_top_eflags</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN3012"><span class='Ref_to_Parameter'>parentestate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN456"><span class='Ref_to_Member'>es_top_eflags</span></a><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN3014"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN457"><span class='Ref_to_Member'>es_instrument</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN3012"><span class='Ref_to_Parameter'>parentestate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN457"><span class='Ref_to_Member'>es_instrument</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* es_auxmodifytables must NOT be copied */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The external param list is simply shared from parent.  The internal 
     * param workspace has to be local state, but we copy the initial values 
     * from the parent, so as to have access to any param values that were 
     * already set from other parts of the parent's plan tree. 
     */ 
</span>    <a href="execMain.c.html#LN3014"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN441"><span class='Ref_to_Member'>es_param_list_info</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN3012"><span class='Ref_to_Parameter'>parentestate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN441"><span class='Ref_to_Member'>es_param_list_info</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN3012"><span class='Ref_to_Parameter'>parentestate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN411"><span class='Ref_to_Member'>es_plannedstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN91"><span class='Ref_to_Member'>nParamExec</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3074"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span> <span class='Operator'>= </span><a href="execMain.c.html#LN3012"><span class='Ref_to_Parameter'>parentestate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN411"><span class='Ref_to_Member'>es_plannedstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN91"><span class='Ref_to_Member'>nParamExec</span></a><span class='Delimiter'>; 
</span> 
        <a href="execMain.c.html#LN3014"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN442"><span class='Ref_to_Member'>es_param_exec_vals</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/params.h.html#LN96"><span class='Ref_to_Struct'>ParamExecData</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3074"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/nodes/params.h.html#LN96"><span class='Ref_to_Struct'>ParamExecData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>--</span><a href="execMain.c.html#LN3074"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* copy value if any, but not execPlan link */ 
</span>            <a href="execMain.c.html#LN3014"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN442"><span class='Ref_to_Member'>es_param_exec_vals</span></a><span class='Delimiter'>[</span><a href="execMain.c.html#LN3074"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><span class='Keyword'>value </span><span class='Operator'>= 
</span>                <a href="execMain.c.html#LN3012"><span class='Ref_to_Parameter'>parentestate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN442"><span class='Ref_to_Member'>es_param_exec_vals</span></a><span class='Delimiter'>[</span><a href="execMain.c.html#LN3074"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><span class='Keyword'>value</span><span class='Delimiter'>; 
</span>            <a href="execMain.c.html#LN3014"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN442"><span class='Ref_to_Member'>es_param_exec_vals</span></a><span class='Delimiter'>[</span><a href="execMain.c.html#LN3074"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/nodes/params.h.html#LN100"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>= 
</span>                <a href="execMain.c.html#LN3012"><span class='Ref_to_Parameter'>parentestate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN442"><span class='Ref_to_Member'>es_param_exec_vals</span></a><span class='Delimiter'>[</span><a href="execMain.c.html#LN3074"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/nodes/params.h.html#LN100"><span class='Ref_to_Member'>isnull</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Each EState must have its own es_epqScanDone state, but if we have 
     * nested EPQ checks they should share es_epqTuple arrays.  This allows 
     * sub-rechecks to inherit the values being examined by an outer recheck. 
     */ 
</span>    <a href="execMain.c.html#LN3014"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN484"><span class='Ref_to_Member'>es_epqScanDone</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3015"><span class='Ref_To_Local'>rtsize</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN3012"><span class='Ref_to_Parameter'>parentestate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN482"><span class='Ref_to_Member'>es_epqTuple</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="execMain.c.html#LN3014"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN482"><span class='Ref_to_Member'>es_epqTuple</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN3012"><span class='Ref_to_Parameter'>parentestate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN482"><span class='Ref_to_Member'>es_epqTuple</span></a><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN3014"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN483"><span class='Ref_to_Member'>es_epqTupleSet</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN3012"><span class='Ref_to_Parameter'>parentestate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN483"><span class='Ref_to_Member'>es_epqTupleSet</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="execMain.c.html#LN3014"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN482"><span class='Ref_to_Member'>es_epqTuple</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3015"><span class='Ref_To_Local'>rtsize</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN3014"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN483"><span class='Ref_to_Member'>es_epqTupleSet</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3015"><span class='Ref_To_Local'>rtsize</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Each estate also has its own tuple table. 
     */ 
</span>    <a href="execMain.c.html#LN3014"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN449"><span class='Ref_to_Member'>es_tupleTable</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Initialize private state information for each SubPlan.  We must do this 
     * before running ExecInitNode on the main query tree, since 
     * ExecInitSubPlan expects to be able to find these entries. Some of the 
     * SubPlans might not be used in the part of the plan tree we intend to 
     * run, but since it's not easy to tell which, we just initialize them 
     * all. 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="execMain.c.html#LN3014"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN462"><span class='Ref_to_Member'>es_subplanstates</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3017"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN3012"><span class='Ref_to_Parameter'>parentestate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN411"><span class='Ref_to_Member'>es_plannedstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN80"><span class='Ref_to_Member'>subplans</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3123"></a>        <a href="../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>subplan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3017"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3124"></a>        <a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>subplanstate</span><span class='Delimiter'>; 
</span> 
        <a href="execMain.c.html#LN3124"><span class='Ref_To_Local'>subplanstate</span></a> <span class='Operator'>= </span><a href="execProcnode.c.html#LN138"><span class='Ref_to_Func'>ExecInitNode</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3123"><span class='Ref_To_Local'>subplan</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN3014"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN3014"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN462"><span class='Ref_to_Member'>es_subplanstates</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3014"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN462"><span class='Ref_to_Member'>es_subplanstates</span></a><span class='Delimiter'>, 
</span>                                           <a href="execMain.c.html#LN3124"><span class='Ref_To_Local'>subplanstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Initialize the private state information for all the nodes in the part 
     * of the plan tree we need to run.  This opens files, allocates storage 
     * and leaves us ready to start processing tuples. 
     */ 
</span>    <a href="execMain.c.html#LN3012"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN876"><span class='Ref_to_Member'>planstate</span></a> <span class='Operator'>= </span><a href="execProcnode.c.html#LN138"><span class='Ref_to_Func'>ExecInitNode</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3012"><span class='Ref_to_Parameter'>planTree</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN3014"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3016"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end EvalPlanQualStart &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * EvalPlanQualEnd -- shut down at termination of parent plan state node, 
 * or if we are done with the current EPQ child. 
 * 
 * This is a cut-down version of ExecutorEnd(); basically we want to do most 
 * of the normal cleanup, but *not* close result relations (which we are 
 * just sharing from the outer query).  We do, however, have to close any 
 * trigger target relations that got opened, since those are not shared. 
 * (There probably shouldn't be any of the latter, but just in case...) 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN3152"></a><span class='Declare_Function'>EvalPlanQualEnd</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN873"><span class='Ref_to_Struct'>EPQState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>epqstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3154"></a>    <a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>estate</span> <span class='Operator'>= </span><a href="execMain.c.html#LN3152"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN875"><span class='Ref_to_Member'>estate</span></a><span class='Delimiter'>; 
</span><a name="LN3155"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN3156"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN3154"><span class='Ref_To_Local'>estate</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>;</span>                 <span class='Comment_Single_Line'>/* idle, so nothing to do */ 
</span> 
    <a href="execMain.c.html#LN3155"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3154"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN447"><span class='Ref_to_Member'>es_query_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/executor/executor.h.html#LN231"><span class='Ref_to_Proto'>ExecEndNode</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3152"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN876"><span class='Ref_to_Member'>planstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3156"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN3154"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN462"><span class='Ref_to_Member'>es_subplanstates</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3167"></a>        <a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>subplanstate</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3156"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/executor/executor.h.html#LN231"><span class='Ref_to_Proto'>ExecEndNode</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3167"><span class='Ref_To_Local'>subplanstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* throw away the per-estate tuple table */ 
</span>    <a href="../../include/executor/tuptable.h.html#LN143"><span class='Ref_to_Proto'>ExecResetTupleTable</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3154"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN449"><span class='Ref_to_Member'>es_tupleTable</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* close any trigger target relations attached to this EState */ 
</span>    <a href="../../include/executor/executor.h.html#LN186"><span class='Ref_to_Proto'>ExecCleanUpTriggerState</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3154"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3155"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="execUtils.c.html#LN176"><span class='Ref_to_Func'>FreeExecutorState</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3154"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Mark EPQState idle */ 
</span>    <a href="execMain.c.html#LN3152"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN875"><span class='Ref_to_Member'>estate</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN3152"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN876"><span class='Ref_to_Member'>planstate</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN3152"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN877"><span class='Ref_to_Member'>origslot</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end EvalPlanQualEnd &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ExecSetupPartitionTupleRouting - set up information needed during 
 * tuple routing for partitioned tables 
 * 
 * Output arguments: 
 * 'pd' receives an array of PartitionDispatch objects with one entry for 
 *      every partitioned table in the partition tree 
 * 'partitions' receives an array of ResultRelInfo objects with one entry for 
 *      every leaf partition in the partition tree 
 * 'tup_conv_maps' receives an array of TupleConversionMap objects with one 
 *      entry for every leaf partition (required to convert input tuple based 
 *      on the root table's rowtype to a leaf partition's rowtype after tuple 
 *      routing is done 
 * 'partition_tuple_slot' receives a standalone TupleTableSlot to be used 
 *      to manipulate any given leaf partition's rowtype after that partition 
 *      is chosen by tuple-routing. 
 * 'num_parted' receives the number of partitioned tables in the partition 
 *      tree (= the number of entries in the 'pd' output array) 
 * 'num_partitions' receives the number of leaf partitions in the partition 
 *      tree (= the number of entries in the 'partitions' and 'tup_conv_maps' 
 *      output arrays 
 * 
 * Note that all the relations in the partition tree are locked using the 
 * RowExclusiveLock mode upon return from this function. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN3214"></a><span class='Declare_Function'>ExecSetupPartitionTupleRouting</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN3215"></a>                               <a href="../../include/catalog/partition.h.html#LN70"><span class='Ref_to_Typedef'>PartitionDispatch</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>pd</span><span class='Delimiter'>, 
</span><a name="LN3216"></a>                               <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>partitions</span><span class='Delimiter'>, 
</span><a name="LN3217"></a>                               <a href="../../include/access/tupconvert.h.html#LN20"><span class='Ref_to_Struct'>TupleConversionMap</span></a> <span class='Operator'>***</span><span class='Declare_Parameter'>tup_conv_maps</span><span class='Delimiter'>, 
</span><a name="LN3218"></a>                               <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>partition_tuple_slot</span><span class='Delimiter'>, 
</span><a name="LN3219"></a>                               <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>num_parted</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>num_partitions</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3221"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupDesc</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3214"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3222"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>leaf_parts</span><span class='Delimiter'>; 
</span><a name="LN3223"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span><a name="LN3224"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN3225"></a>    <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>leaf_part_rri</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get the tuple-routing information and lock partitions */ 
</span>    <span class='Operator'>*</span><a href="execMain.c.html#LN3215"><span class='Ref_to_Parameter'>pd</span></a> <span class='Operator'>= </span><a href="../../include/catalog/partition.h.html#LN87"><span class='Ref_to_Proto'>RelationGetPartitionDispatchInfo</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3214"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN3219"><span class='Ref_to_Parameter'>num_parted</span></a><span class='Delimiter'>, 
</span>                                           <span class='Operator'>&</span><a href="execMain.c.html#LN3222"><span class='Ref_To_Local'>leaf_parts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="execMain.c.html#LN3219"><span class='Ref_to_Parameter'>num_partitions</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3222"><span class='Ref_To_Local'>leaf_parts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="execMain.c.html#LN3216"><span class='Ref_to_Parameter'>partitions</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="execMain.c.html#LN3219"><span class='Ref_to_Parameter'>num_partitions</span></a> <span class='Operator'>* 
</span>                                           <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="execMain.c.html#LN3217"><span class='Ref_to_Parameter'>tup_conv_maps</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/access/tupconvert.h.html#LN20"><span class='Ref_to_Struct'>TupleConversionMap</span></a> <span class='Operator'>**</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="execMain.c.html#LN3219"><span class='Ref_to_Parameter'>num_partitions</span></a> <span class='Operator'>* 
</span>                                               <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/access/tupconvert.h.html#LN20"><span class='Ref_to_Struct'>TupleConversionMap</span></a> <span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Initialize an empty slot that will be used to manipulate tuples of any 
     * given partition's rowtype.  It is attached to the caller-specified node 
     * (such as ModifyTableState) and released when the node finishes 
     * processing. 
     */ 
</span>    <span class='Operator'>*</span><a href="execMain.c.html#LN3218"><span class='Ref_to_Parameter'>partition_tuple_slot</span></a> <span class='Operator'>= </span><a href="execTuples.c.html#LN109"><span class='Ref_to_Func'>MakeTupleTableSlot</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="execMain.c.html#LN3225"><span class='Ref_To_Local'>leaf_part_rri</span></a> <span class='Operator'>= *</span><a href="execMain.c.html#LN3216"><span class='Ref_to_Parameter'>partitions</span></a><span class='Delimiter'>; 
</span>    <a href="execMain.c.html#LN3224"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3223"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN3222"><span class='Ref_To_Local'>leaf_parts</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3248"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>partrel</span><span class='Delimiter'>; 
</span><a name="LN3249"></a>        <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>part_tupdesc</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We locked all the partitions above including the leaf partitions. 
         * Note that each of the relations in *partitions are eventually 
         * closed by the caller. 
         */ 
</span>        <a href="execMain.c.html#LN3248"><span class='Ref_To_Local'>partrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3223"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN3249"><span class='Ref_To_Local'>part_tupdesc</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3248"><span class='Ref_To_Local'>partrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Verify result relation is a valid target for the current operation. 
         */ 
</span>        <a href="../../include/executor/executor.h.html#LN179"><span class='Ref_to_Proto'>CheckValidResultRel</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3248"><span class='Ref_To_Local'>partrel</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/nodes.h.html#LN652"><span class='Ref_to_EnumConst'>CMD_INSERT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Save a tuple conversion map to convert a tuple routed to this 
         * partition from the parent's type to the partition's. 
         */ 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="execMain.c.html#LN3217"><span class='Ref_to_Parameter'>tup_conv_maps</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><a href="execMain.c.html#LN3224"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/access/tupconvert.h.html#LN36"><span class='Ref_to_Proto'>convert_tuples_by_name</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3221"><span class='Ref_To_Local'>tupDesc</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN3249"><span class='Ref_To_Local'>part_tupdesc</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"could not convert row type"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/executor/executor.h.html#LN180"><span class='Ref_to_Proto'>InitResultRelInfo</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3225"><span class='Ref_To_Local'>leaf_part_rri</span></a><span class='Delimiter'>, 
</span>                          <a href="execMain.c.html#LN3248"><span class='Ref_To_Local'>partrel</span></a><span class='Delimiter'>, 
</span>                          <span class='Number'>1</span><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* dummy */ 
</span>                          <a href="execMain.c.html#LN3214"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, 
</span>                          <span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Open partition indices (remember we do not support ON CONFLICT in 
         * case of partitioned tables, so we do not need support information 
         * for speculative insertion) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN3225"><span class='Ref_To_Local'>leaf_part_rri</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relhasindex <span class='Operator'>&& 
</span>            <a href="execMain.c.html#LN3225"><span class='Ref_To_Local'>leaf_part_rri</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN375"><span class='Ref_to_Member'>ri_IndexRelationDescs</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="execIndexing.c.html#LN147"><span class='Ref_to_Func'>ExecOpenIndices</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3225"><span class='Ref_To_Local'>leaf_part_rri</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="execMain.c.html#LN3225"><span class='Ref_To_Local'>leaf_part_rri</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN3224"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end ExecSetupPartitionTupleRouting &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ExecFindPartition -- Find a leaf partition in the partition tree rooted 
 * at parent, for the heap tuple contained in *slot 
 * 
 * estate must be non-NULL; we'll need it to compute any expressions in the 
 * partition key(s) 
 * 
 * If no leaf partition is found, this routine errors out with the appropriate 
 * error message, else it returns the leaf partition sequence number returned 
 * by get_partition_for_tuple() unchanged. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN3303"></a><span class='Declare_Function'>ExecFindPartition</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>resultRelInfo</span><span class='Delimiter'>, </span><a href="../../include/catalog/partition.h.html#LN70"><span class='Ref_to_Typedef'>PartitionDispatch</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pd</span><span class='Delimiter'>, 
</span><a name="LN3304"></a>                  <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3306"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN3307"></a>    <a href="../../include/catalog/partition.h.html#LN59"><span class='Ref_to_Struct'>PartitionDispatchData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>failed_at</span><span class='Delimiter'>; 
</span><a name="LN3308"></a>    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>failed_slot</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * First check the root table's partition constraint, if any.  No point in 
     * routing the tuple it if it doesn't belong in the root table itself. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN3303"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN391"><span class='Ref_to_Member'>ri_PartitionCheck</span></a><span class='Parentheses'>) 
</span>        <a href="execMain.c.html#LN105"><span class='Ref_to_Proto'>ExecPartitionCheck</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3303"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN3304"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN3304"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="execMain.c.html#LN3306"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/catalog/partition.h.html#LN95"><span class='Ref_to_Proto'>get_partition_for_tuple</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3303"><span class='Ref_to_Parameter'>pd</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN3304"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN3304"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, 
</span>                                     <span class='Operator'>&</span><a href="execMain.c.html#LN3307"><span class='Ref_To_Local'>failed_at</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="execMain.c.html#LN3308"><span class='Ref_To_Local'>failed_slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN3306"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3321"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>failed_rel</span><span class='Delimiter'>; 
</span><a name="LN3322"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>key_values</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN50"><span class='Ref_to_Const'>PARTITION_MAX_KEYS</span></a><span class='Delimiter'>]; 
</span><a name="LN3323"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>key_isnull</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN50"><span class='Ref_to_Const'>PARTITION_MAX_KEYS</span></a><span class='Delimiter'>]; 
</span><a name="LN3324"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>val_desc</span><span class='Delimiter'>; 
</span><a name="LN3325"></a>        <a href="../../include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ecxt</span> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN455"><span class='Ref_to_Macro'>GetPerTupleExprContext</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3304"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="execMain.c.html#LN3321"><span class='Ref_To_Local'>failed_rel</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN3307"><span class='Ref_To_Local'>failed_at</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN61"><span class='Ref_to_Member'>reldesc</span></a><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN3325"><span class='Ref_To_Local'>ecxt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN196"><span class='Ref_to_Member'>ecxt_scantuple</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN3308"><span class='Ref_To_Local'>failed_slot</span></a><span class='Delimiter'>; 
</span>        <a href="../../include/catalog/partition.h.html#LN90"><span class='Ref_to_Proto'>FormPartitionKeyDatum</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3307"><span class='Ref_To_Local'>failed_at</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN3308"><span class='Ref_To_Local'>failed_slot</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN3304"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, 
</span>                              <a href="execMain.c.html#LN3322"><span class='Ref_To_Local'>key_values</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN3323"><span class='Ref_To_Local'>key_isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="execMain.c.html#LN3324"><span class='Ref_To_Local'>val_desc</span></a> <span class='Operator'>= </span><a href="execMain.c.html#LN99"><span class='Ref_to_Proto'>ExecBuildSlotPartitionKeyDescription</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3321"><span class='Ref_To_Local'>failed_rel</span></a><span class='Delimiter'>, 
</span>                                                        <a href="execMain.c.html#LN3322"><span class='Ref_To_Local'>key_values</span></a><span class='Delimiter'>, 
</span>                                                        <a href="execMain.c.html#LN3323"><span class='Ref_To_Local'>key_isnull</span></a><span class='Delimiter'>, 
</span>                                                        <span class='Number'>64</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3321"><span class='Ref_To_Local'>failed_rel</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CHECK_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"no partition of relation \"%s\" found for row"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3321"><span class='Ref_To_Local'>failed_rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                 <a href="execMain.c.html#LN3324"><span class='Ref_To_Local'>val_desc</span></a> <span class='Operator'>? </span><a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Partition key of the failing row contains %s."</span><span class='Delimiter'>, </span><a href="execMain.c.html#LN3324"><span class='Ref_To_Local'>val_desc</span></a><span class='Parentheses'>)</span> <span class='Operator'>: </span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if result&LT;0 &raquo; </span> 
 
    <span class='Control'>return</span> <a href="execMain.c.html#LN3306"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecFindPartition &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * BuildSlotPartitionKeyDescription 
 * 
 * This works very much like BuildIndexValueDescription() and is currently 
 * used for building error messages when ExecFindPartition() fails to find 
 * partition for a row. 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN3354"></a><span class='Declare_Function'>ExecBuildSlotPartitionKeyDescription</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN3355"></a>                                     <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>values</span><span class='Delimiter'>, 
</span><a name="LN3356"></a>                                     <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isnull</span><span class='Delimiter'>, 
</span><a name="LN3357"></a>                                     <span class='Keyword'>int </span><span class='Declare_Parameter'>maxfieldlen</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3359"></a>    <a href="../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN3360"></a>    <a href="../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Local'>key</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN584"><span class='Ref_to_Macro'>RelationGetPartitionKey</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3354"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3361"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>partnatts</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN595"><span class='Ref_to_Func'>get_partition_natts</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3360"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3362"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN3363"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3354"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3364"></a>    <a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/rls.h.html#LN47"><span class='Ref_to_Proto'>check_enable_rls</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3363"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../include/utils/rls.h.html#LN44"><span class='Ref_to_EnumConst'>RLS_ENABLED</span></a><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If the user has table-level access, just go build the description. */ 
</span>    <a href="execMain.c.html#LN3364"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN283"><span class='Ref_to_Proto'>pg_class_aclcheck</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3363"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN72"><span class='Ref_to_Const'>ACL_SELECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN3364"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Step through the columns of the partition key and make sure the 
         * user has SELECT rights on all of them. 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN3362"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="execMain.c.html#LN3362"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="execMain.c.html#LN3361"><span class='Ref_To_Local'>partnatts</span></a><span class='Delimiter'>; </span><a href="execMain.c.html#LN3362"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN3379"></a>            <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>attnum</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN610"><span class='Ref_to_Func'>get_partition_col_attnum</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3360"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN3362"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If this partition key column is an expression, we return no 
             * detail rather than try to figure out what column(s) the 
             * expression includes and if the user has SELECT rights on them. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN3379"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>== </span><a href="../../include/access/attnum.h.html#LN22"><span class='Ref_to_Const'>InvalidAttrNumber</span></a> <span class='Operator'>|| 
</span>                <a href="../../include/utils/acl.h.html#LN279"><span class='Ref_to_Proto'>pg_attribute_aclcheck</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3363"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN3379"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                                      <a href="../../include/nodes/parsenodes.h.html#LN72"><span class='Ref_to_Const'>ACL_SELECT</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span> 
                <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if aclresult!=ACLCHECK_O... &raquo; </span> 
 
    <a href="../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="execMain.c.html#LN3359"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="execMain.c.html#LN3359"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"(%s) = ("</span><span class='Delimiter'>, 
</span>                     <a href="../../include/utils/ruleutils.h.html#LN23"><span class='Ref_to_Proto'>pg_get_partkeydef_columns</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3363"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN3362"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="execMain.c.html#LN3362"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="execMain.c.html#LN3361"><span class='Ref_To_Local'>partnatts</span></a><span class='Delimiter'>; </span><a href="execMain.c.html#LN3362"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3399"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN3400"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>vallen</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN3356"><span class='Ref_to_Parameter'>isnull</span></a><span class='Delimiter'>[</span><a href="execMain.c.html#LN3362"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <a href="execMain.c.html#LN3399"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><span class='String'>"null"</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span><a name="LN3406"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>foutoid</span><span class='Delimiter'>; 
</span><a name="LN3407"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>typisvarlena</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/utils/lsyscache.h.html#LN162"><span class='Ref_to_Proto'>getTypeOutputInfo</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN616"><span class='Ref_to_Func'>get_partition_col_typid</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3360"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN3362"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="execMain.c.html#LN3406"><span class='Ref_To_Local'>foutoid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="execMain.c.html#LN3407"><span class='Ref_To_Local'>typisvarlena</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="execMain.c.html#LN3399"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN647"><span class='Ref_to_Proto'>OidOutputFunctionCall</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3406"><span class='Ref_To_Local'>foutoid</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN3355"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>[</span><a href="execMain.c.html#LN3362"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN3362"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="execMain.c.html#LN3359"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>", "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* truncate if needed */ 
</span>        <a href="execMain.c.html#LN3400"><span class='Ref_To_Local'>vallen</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="execMain.c.html#LN3399"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="execMain.c.html#LN3400"><span class='Ref_To_Local'>vallen</span></a> <span class='Operator'>&LT;= </span><a href="execMain.c.html#LN3357"><span class='Ref_to_Parameter'>maxfieldlen</span></a><span class='Parentheses'>) 
</span>            <a href="../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="execMain.c.html#LN3359"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN3399"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="execMain.c.html#LN3400"><span class='Ref_To_Local'>vallen</span></a> <span class='Operator'>= </span><a href="../../include/mb/pg_wchar.h.html#LN530"><span class='Ref_to_Proto'>pg_mbcliplen</span></a><span class='Parentheses'>(</span><a href="execMain.c.html#LN3399"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN3400"><span class='Ref_To_Local'>vallen</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN3357"><span class='Ref_to_Parameter'>maxfieldlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="execMain.c.html#LN3359"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN3399"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><a href="execMain.c.html#LN3400"><span class='Ref_To_Local'>vallen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="execMain.c.html#LN3359"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"..."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;partnatts;i++ &raquo; </span> 
 
    <a href="../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="execMain.c.html#LN3359"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>')'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="execMain.c.html#LN3359"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecBuildSlotPartitionKeyDescription &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>