<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\executor\functions.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\executor\functions.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:39 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * functions.c 
 *    Execution of SQL-language functions 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/executor/functions.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xact.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_proc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"executor/functions.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"funcapi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/makefuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/nodeFuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_coerce.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_func.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/proc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"tcop/utility.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/datum.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/snapmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Specialized DestReceiver for collecting query output in a SQL function 
 */ 
</span><span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN42"></a>    <a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Declare_Member'>pub</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* publicly-known function pointers */ 
</span><a name="LN43"></a>    <a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Declare_Member'>tstore</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* where to put result tuples */ 
</span><a name="LN44"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Member'>cxt</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* context containing tstore */ 
</span><a name="LN45"></a>    <a href="../../include/nodes/execnodes.h.html#LN328"><span class='Ref_to_Struct'>JunkFilter</span></a> <span class='Operator'>*</span><span class='Declare_Member'>filter</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* filter to convert tuple type */ 
</span><a name="LN46"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>DR_sqlfunction</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * We have an execution_state record for each query in a function.  Each 
 * record contains a plantree for its query.  If the query is currently in 
 * F_EXEC_RUN state then there's a QueryDesc too. 
 * 
 * The "next" fields chain together all the execution_state records generated 
 * from a single original parsetree.  (There will only be more than one in 
 * case of rule expansion of the original parsetree.) 
 */ 
</span><span class='Control'>typedef</span> <span class='Control'>enum</span> 
<span class='Delimiter'>{ 
</span><a name="LN59"></a>    <span class='Declare_Enum_Const'>F_EXEC_START</span><span class='Delimiter'>, </span><span class='Declare_Enum_Const'>F_EXEC_RUN</span><span class='Delimiter'>, </span><span class='Declare_Enum_Const'>F_EXEC_DONE</span> 
<a name="LN60"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>ExecStatus</span><span class='Delimiter'>; 
</span> 
<a name="LN62"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>execution_state</span> 
<span class='Delimiter'>{ 
</span><a name="LN64"></a>    <span class='Control'>struct</span> <a href="functions.c.html#LN62"><span class='Ref_to_Struct'>execution_state</span></a> <span class='Operator'>*</span><span class='Declare_Member'>next</span><span class='Delimiter'>; 
</span><a name="LN65"></a>    <a href="functions.c.html#LN57"><span class='Ref_to_Typedef'>ExecStatus</span></a>  <span class='Declare_Member'>status</span><span class='Delimiter'>; 
</span><a name="LN66"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>setsResult</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* true if this query produces func's result */ 
</span><a name="LN67"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>lazyEval</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* true if should fetch one row at a time */ 
</span><a name="LN68"></a>    <a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a> <span class='Operator'>*</span><span class='Declare_Member'>stmt</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* plan for this query */ 
</span><a name="LN69"></a>    <a href="../../include/executor/execdesc.h.html#LN32"><span class='Ref_to_Struct'>QueryDesc</span></a>  <span class='Operator'>*</span><span class='Declare_Member'>qd</span><span class='Delimiter'>;</span>             <span class='Comment_Single_Line'>/* null unless status == RUN */ 
</span><a name="LN70"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>execution_state</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * An SQLFunctionCache record is built during the first call, 
 * and linked to from the fn_extra field of the FmgrInfo struct. 
 * 
 * Note that currently this has only the lifespan of the calling query. 
 * Someday we should rewrite this code to use plancache.c to save parse/plan 
 * results for longer than that. 
 * 
 * Physically, though, the data has the lifespan of the FmgrInfo that's used 
 * to call the function, and there are cases (particularly with indexes) 
 * where the FmgrInfo might survive across transactions.  We cannot assume 
 * that the parse/plan trees are good for longer than the (sub)transaction in 
 * which parsing was done, so we must mark the record with the LXID/subxid of 
 * its creation time, and regenerate everything if that's obsolete.  To avoid 
 * memory leakage when we do have to regenerate things, all the data is kept 
 * in a sub-context of the FmgrInfo's fn_mcxt. 
 */ 
</span><span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN92"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>fname</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* function name (for error msgs) */ 
</span><a name="LN93"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>src</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* function body text (for error msgs) */ 
</span> 
<a name="LN95"></a>    <a href="../../include/executor/functions.h.html#LN20"><span class='Ref_to_Typedef'>SQLFunctionParseInfoPtr</span></a> <span class='Declare_Member'>pinfo</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* data for parser callback hooks */ 
</span> 
<a name="LN97"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>rettype</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* actual return type */ 
</span><a name="LN98"></a>    <a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Member'>typlen</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* length of the return type */ 
</span><a name="LN99"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>typbyval</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* true if return type is pass by value */ 
</span><a name="LN100"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>returnsSet</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* true if returning multiple rows */ 
</span><a name="LN101"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>returnsTuple</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* true if returning whole tuple result */ 
</span><a name="LN102"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>shutdown_reg</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* true if registered shutdown callback */ 
</span><a name="LN103"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>readonly_func</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* true to run in "read only" mode */ 
</span><a name="LN104"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>lazyEval</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* true if using lazyEval for result query */ 
</span> 
<a name="LN106"></a>    <a href="../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Member'>paramLI</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* Param list representing current args */ 
</span> 
<a name="LN108"></a>    <a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Declare_Member'>tstore</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* where we accumulate result tuples */ 
</span> 
<a name="LN110"></a>    <a href="../../include/nodes/execnodes.h.html#LN328"><span class='Ref_to_Struct'>JunkFilter</span></a> <span class='Operator'>*</span><span class='Declare_Member'>junkFilter</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* will be NULL if function returns VOID */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * func_state is a List of execution_state records, each of which is the 
     * first for its original parsetree, with any additional records chained 
     * to it via the "next" fields.  This sublist structure is needed to keep 
     * track of where the original query boundaries are. 
     */ 
</span><a name="LN118"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>func_state</span><span class='Delimiter'>; 
</span> 
<a name="LN120"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Member'>fcontext</span><span class='Delimiter'>;</span>     <span class='Comment_Multi_Line'>/* memory context holding this struct and all 
                                 * subsidiary data */ 
</span> 
<a name="LN123"></a>    <a href="../../include/c.h.html#LN398"><span class='Ref_to_Typedef'>LocalTransactionId</span></a> <span class='Declare_Member'>lxid</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* lxid in which cache was made */ 
</span><a name="LN124"></a>    <a href="../../include/c.h.html#LN400"><span class='Ref_to_Typedef'>SubTransactionId</span></a> <span class='Declare_Member'>subxid</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* subxid in which cache was made */ 
</span><a name="LN125"></a><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end {anonSQLFunctionCache} &raquo; </span> <span class='Declare_Typedef'>SQLFunctionCache</span><span class='Delimiter'>; 
</span> 
<a name="LN127"></a><span class='Control'>typedef</span> <a href="functions.c.html#LN90"><span class='Ref_to_Typedef'>SQLFunctionCache</span></a> <span class='Operator'>*</span><span class='Declare_Typedef'>SQLFunctionCachePtr</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Data structure needed by the parser callback hooks to resolve parameter 
 * references during parsing of a SQL function's body.  This is separate from 
 * SQLFunctionCache since we sometimes do parsing separately from execution. 
 */ 
</span><a name="LN134"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>SQLFunctionParseInfo</span> 
<span class='Delimiter'>{ 
</span><a name="LN136"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>fname</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* function's name */ 
</span><a name="LN137"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>nargs</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* number of input arguments */ 
</span><a name="LN138"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Member'>argtypes</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* resolved types of input arguments */ 
</span><a name="LN139"></a>    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Member'>argnames</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* names of input arguments; NULL if none */ 
</span>    <span class='Comment_Multi_Line'>/* Note that argnames[i] can be NULL, if some args are unnamed */ 
</span><a name="LN141"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>collation</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* function's input collation, if known */ 
</span><a name="LN142"></a><span class='Delimiter'>}</span>   <span class='Declare_Typedef'>SQLFunctionParseInfo</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* non-export function prototypes */ 
</span><a name="LN146"></a><span class='Keyword'>static </span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>sql_fn_param_ref</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN241"><span class='Ref_to_Struct'>ParamRef</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pref</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN147"></a><span class='Keyword'>static </span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>sql_fn_post_column_ref</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, 
</span><a name="LN148"></a>                       <a href="../../include/nodes/parsenodes.h.html#LN231"><span class='Ref_to_Struct'>ColumnRef</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cref</span><span class='Delimiter'>, </span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN149"></a><span class='Keyword'>static </span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>sql_fn_make_param</span><span class='Parentheses'>(</span><a href="../../include/executor/functions.h.html#LN20"><span class='Ref_to_Typedef'>SQLFunctionParseInfoPtr</span></a> <span class='Declare_Parameter'>pinfo</span><span class='Delimiter'>, 
</span><a name="LN150"></a>                  <span class='Keyword'>int </span><span class='Declare_Parameter'>paramno</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>location</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN151"></a><span class='Keyword'>static </span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>sql_fn_resolve_param_name</span><span class='Parentheses'>(</span><a href="../../include/executor/functions.h.html#LN20"><span class='Ref_to_Typedef'>SQLFunctionParseInfoPtr</span></a> <span class='Declare_Parameter'>pinfo</span><span class='Delimiter'>, 
</span><a name="LN152"></a>                          <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>paramname</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>location</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN153"></a><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>init_execution_state</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>queryTree_list</span><span class='Delimiter'>, 
</span><a name="LN154"></a>                     <a href="functions.c.html#LN127"><span class='Ref_to_Typedef'>SQLFunctionCachePtr</span></a> <span class='Declare_Parameter'>fcache</span><span class='Delimiter'>, 
</span><a name="LN155"></a>                     <span class='Keyword'>bool </span><span class='Declare_Parameter'>lazyEvalOK</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN156"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>init_sql_fcache</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>finfo</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>collation</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>lazyEvalOK</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN157"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>postquel_start</span><span class='Parentheses'>(</span><a href="functions.c.html#LN62"><span class='Ref_to_Struct'>execution_state</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>es</span><span class='Delimiter'>, </span><a href="functions.c.html#LN127"><span class='Ref_to_Typedef'>SQLFunctionCachePtr</span></a> <span class='Declare_Parameter'>fcache</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN158"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>postquel_getnext</span><span class='Parentheses'>(</span><a href="functions.c.html#LN62"><span class='Ref_to_Struct'>execution_state</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>es</span><span class='Delimiter'>, </span><a href="functions.c.html#LN127"><span class='Ref_to_Typedef'>SQLFunctionCachePtr</span></a> <span class='Declare_Parameter'>fcache</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN159"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>postquel_end</span><span class='Parentheses'>(</span><a href="functions.c.html#LN62"><span class='Ref_to_Struct'>execution_state</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>es</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN160"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>postquel_sub_params</span><span class='Parentheses'>(</span><a href="functions.c.html#LN127"><span class='Ref_to_Typedef'>SQLFunctionCachePtr</span></a> <span class='Declare_Parameter'>fcache</span><span class='Delimiter'>, 
</span><a name="LN161"></a>                    <a href="../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN162"></a><span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>postquel_get_single_result</span><span class='Parentheses'>(</span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Delimiter'>, 
</span><a name="LN163"></a>                           <a href="../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Delimiter'>, 
</span><a name="LN164"></a>                           <a href="functions.c.html#LN127"><span class='Ref_to_Typedef'>SQLFunctionCachePtr</span></a> <span class='Declare_Parameter'>fcache</span><span class='Delimiter'>, 
</span><a name="LN165"></a>                           <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>resultcontext</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN166"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>sql_exec_error_callback</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN167"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ShutdownSQLFunction</span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>arg</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN168"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>sqlfunction_startup</span><span class='Parentheses'>(</span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>self</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>operation</span><span class='Delimiter'>, </span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>typeinfo</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN169"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>sqlfunction_receive</span><span class='Parentheses'>(</span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Delimiter'>, </span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>self</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN170"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>sqlfunction_shutdown</span><span class='Parentheses'>(</span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>self</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN171"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>sqlfunction_destroy</span><span class='Parentheses'>(</span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>self</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Prepare the SQLFunctionParseInfo struct for parsing a SQL function body 
 * 
 * This includes resolving actual types of polymorphic arguments. 
 * 
 * call_expr can be passed as NULL, but then we will fail if there are any 
 * polymorphic arguments. 
 */ 
</span><a href="../../include/executor/functions.h.html#LN20"><span class='Ref_to_Typedef'>SQLFunctionParseInfoPtr</span></a> 
<a name="LN183"></a><span class='Declare_Function'>prepare_sql_fn_parse_info</span><span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>procedureTuple</span><span class='Delimiter'>, 
</span><a name="LN184"></a>                          <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>call_expr</span><span class='Delimiter'>, 
</span><a name="LN185"></a>                          <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>inputCollation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN187"></a>    <a href="../../include/executor/functions.h.html#LN20"><span class='Ref_to_Typedef'>SQLFunctionParseInfoPtr</span></a> <span class='Declare_Local'>pinfo</span><span class='Delimiter'>; 
</span><a name="LN188"></a>    <a href="../../include/catalog/pg_proc.h.html#LN82"><span class='Ref_to_Typedef'>Form_pg_proc</span></a> <span class='Declare_Local'>procedureStruct</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_proc.h.html#LN82"><span class='Ref_to_Typedef'>Form_pg_proc</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN183"><span class='Ref_to_Parameter'>procedureTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN189"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nargs</span><span class='Delimiter'>; 
</span> 
    <a href="functions.c.html#LN187"><span class='Ref_To_Local'>pinfo</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/executor/functions.h.html#LN20"><span class='Ref_to_Typedef'>SQLFunctionParseInfoPtr</span></a><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="functions.c.html#LN134"><span class='Ref_to_Struct'>SQLFunctionParseInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Function's name (only) can be used to qualify argument names */ 
</span>    <a href="functions.c.html#LN187"><span class='Ref_To_Local'>pinfo</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN136"><span class='Ref_to_Member'>fname</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN188"><span class='Ref_To_Local'>procedureStruct</span></a><span class='Operator'>-&GT;</span>proname<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Save the function's input collation */ 
</span>    <a href="functions.c.html#LN187"><span class='Ref_To_Local'>pinfo</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN141"><span class='Ref_to_Member'>collation</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN185"><span class='Ref_to_Parameter'>inputCollation</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Copy input argument types from the pg_proc entry, then resolve any 
     * polymorphic types. 
     */ 
</span>    <a href="functions.c.html#LN187"><span class='Ref_To_Local'>pinfo</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN137"><span class='Ref_to_Member'>nargs</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN189"><span class='Ref_To_Local'>nargs</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN188"><span class='Ref_To_Local'>procedureStruct</span></a><span class='Operator'>-&GT;</span>pronargs<span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN189"><span class='Ref_To_Local'>nargs</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN206"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>argOidVect</span><span class='Delimiter'>; 
</span><a name="LN207"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>argnum</span><span class='Delimiter'>; 
</span> 
        <a href="functions.c.html#LN206"><span class='Ref_To_Local'>argOidVect</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN189"><span class='Ref_To_Local'>nargs</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="functions.c.html#LN206"><span class='Ref_To_Local'>argOidVect</span></a><span class='Delimiter'>, 
</span>               <a href="functions.c.html#LN188"><span class='Ref_To_Local'>procedureStruct</span></a><span class='Operator'>-&GT;</span>proargtypes<span class='Operator'>.</span>values<span class='Delimiter'>, 
</span>               <a href="functions.c.html#LN189"><span class='Ref_To_Local'>nargs</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN207"><span class='Ref_To_Local'>argnum</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="functions.c.html#LN207"><span class='Ref_To_Local'>argnum</span></a> <span class='Operator'>&LT; </span><a href="functions.c.html#LN189"><span class='Ref_To_Local'>nargs</span></a><span class='Delimiter'>; </span><a href="functions.c.html#LN207"><span class='Ref_To_Local'>argnum</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN216"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>argtype</span> <span class='Operator'>= </span><a href="functions.c.html#LN206"><span class='Ref_To_Local'>argOidVect</span></a><span class='Delimiter'>[</span><a href="functions.c.html#LN207"><span class='Ref_To_Local'>argnum</span></a><span class='Delimiter'>]; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN744"><span class='Ref_to_Macro'>IsPolymorphicType</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN216"><span class='Ref_To_Local'>argtype</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="functions.c.html#LN216"><span class='Ref_To_Local'>argtype</span></a> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN664"><span class='Ref_to_Proto'>get_call_expr_argtype</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN184"><span class='Ref_to_Parameter'>call_expr</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN207"><span class='Ref_To_Local'>argnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN216"><span class='Ref_To_Local'>argtype</span></a> <span class='Operator'>== </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not determine actual type of argument declared %s"</span><span class='Delimiter'>, 
</span>                                    <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN206"><span class='Ref_To_Local'>argOidVect</span></a><span class='Delimiter'>[</span><a href="functions.c.html#LN207"><span class='Ref_To_Local'>argnum</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>                <a href="functions.c.html#LN206"><span class='Ref_To_Local'>argOidVect</span></a><span class='Delimiter'>[</span><a href="functions.c.html#LN207"><span class='Ref_To_Local'>argnum</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="functions.c.html#LN216"><span class='Ref_To_Local'>argtype</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="functions.c.html#LN187"><span class='Ref_To_Local'>pinfo</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN138"><span class='Ref_to_Member'>argtypes</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN206"><span class='Ref_To_Local'>argOidVect</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if nargs&GT;0 &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Collect names of arguments, too, if any 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN189"><span class='Ref_To_Local'>nargs</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN238"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>proargnames</span><span class='Delimiter'>; 
</span><a name="LN239"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>proargmodes</span><span class='Delimiter'>; 
</span><a name="LN240"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>n_arg_names</span><span class='Delimiter'>; 
</span><a name="LN241"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span> 
        <a href="functions.c.html#LN238"><span class='Ref_To_Local'>proargnames</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN75"><span class='Ref_to_EnumConst'>PROCNAMEARGSNSP</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN183"><span class='Ref_to_Parameter'>procedureTuple</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../include/catalog/pg_proc.h.html#LN111"><span class='Ref_to_Const'>Anum_pg_proc_proargnames</span></a><span class='Delimiter'>, 
</span>                                      <span class='Operator'>&</span><a href="functions.c.html#LN241"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN241"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>            <a href="functions.c.html#LN238"><span class='Ref_To_Local'>proargnames</span></a> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* just to be sure */ 
</span> 
        <a href="functions.c.html#LN239"><span class='Ref_To_Local'>proargmodes</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN75"><span class='Ref_to_EnumConst'>PROCNAMEARGSNSP</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN183"><span class='Ref_to_Parameter'>procedureTuple</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../include/catalog/pg_proc.h.html#LN110"><span class='Ref_to_Const'>Anum_pg_proc_proargmodes</span></a><span class='Delimiter'>, 
</span>                                      <span class='Operator'>&</span><a href="functions.c.html#LN241"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN241"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>            <a href="functions.c.html#LN239"><span class='Ref_To_Local'>proargmodes</span></a> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* just to be sure */ 
</span> 
        <a href="functions.c.html#LN240"><span class='Ref_To_Local'>n_arg_names</span></a> <span class='Operator'>= </span><a href="../../include/funcapi.h.html#LN175"><span class='Ref_to_Proto'>get_func_input_arg_names</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN238"><span class='Ref_To_Local'>proargnames</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN239"><span class='Ref_To_Local'>proargmodes</span></a><span class='Delimiter'>, 
</span>                                               <span class='Operator'>&</span><a href="functions.c.html#LN187"><span class='Ref_To_Local'>pinfo</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN139"><span class='Ref_to_Member'>argnames</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Paranoia: ignore the result if too few array entries */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN240"><span class='Ref_To_Local'>n_arg_names</span></a> <span class='Operator'>&LT; </span><a href="functions.c.html#LN189"><span class='Ref_To_Local'>nargs</span></a><span class='Parentheses'>) 
</span>            <a href="functions.c.html#LN187"><span class='Ref_To_Local'>pinfo</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN139"><span class='Ref_to_Member'>argnames</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if nargs&GT;0 &raquo; </span> 
    <span class='Control'>else</span> 
        <a href="functions.c.html#LN187"><span class='Ref_To_Local'>pinfo</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN139"><span class='Ref_to_Member'>argnames</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="functions.c.html#LN187"><span class='Ref_To_Local'>pinfo</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end prepare_sql_fn_parse_info &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Parser setup hook for parsing a SQL function body. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN272"></a><span class='Declare_Function'>sql_fn_parser_setup</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../include/executor/functions.h.html#LN20"><span class='Ref_to_Typedef'>SQLFunctionParseInfoPtr</span></a> <span class='Declare_Parameter'>pinfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="functions.c.html#LN272"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/parser/parse_node.h.html#LN205"><span class='Ref_to_Member'>p_pre_columnref_hook</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="functions.c.html#LN272"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/parser/parse_node.h.html#LN206"><span class='Ref_to_Member'>p_post_columnref_hook</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN147"><span class='Ref_to_Proto'>sql_fn_post_column_ref</span></a><span class='Delimiter'>; 
</span>    <a href="functions.c.html#LN272"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/parser/parse_node.h.html#LN207"><span class='Ref_to_Member'>p_paramref_hook</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN146"><span class='Ref_to_Proto'>sql_fn_param_ref</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* no need to use p_coerce_param_hook */ 
</span>    <a href="functions.c.html#LN272"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/parser/parse_node.h.html#LN209"><span class='Ref_to_Member'>p_ref_hook_state</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="functions.c.html#LN272"><span class='Ref_to_Parameter'>pinfo</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * sql_fn_post_column_ref       parser callback for ColumnRefs 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN285"></a><span class='Declare_Function'>sql_fn_post_column_ref</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN231"><span class='Ref_to_Struct'>ColumnRef</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cref</span><span class='Delimiter'>, </span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN287"></a>    <a href="../../include/executor/functions.h.html#LN20"><span class='Ref_to_Typedef'>SQLFunctionParseInfoPtr</span></a> <span class='Declare_Local'>pinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/executor/functions.h.html#LN20"><span class='Ref_to_Typedef'>SQLFunctionParseInfoPtr</span></a><span class='Parentheses'>) </span><a href="functions.c.html#LN285"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/parser/parse_node.h.html#LN209"><span class='Ref_to_Member'>p_ref_hook_state</span></a><span class='Delimiter'>; 
</span><a name="LN288"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nnames</span><span class='Delimiter'>; 
</span><a name="LN289"></a>    <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>field1</span><span class='Delimiter'>; 
</span><a name="LN290"></a>    <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>subfield</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN291"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>name1</span><span class='Delimiter'>; 
</span><a name="LN292"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>name2</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN293"></a>    <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>param</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Never override a table-column reference.  This corresponds to 
     * considering the parameter names to appear in a scope outside the 
     * individual SQL commands, which is what we want. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN285"><span class='Ref_to_Parameter'>var</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/*---------- 
     * The allowed syntaxes are: 
     * 
     * A        A = parameter name 
     * A.B      A = function name, B = parameter name 
     *          OR: A = record-typed parameter name, B = field name 
     *          (the first possibility takes precedence) 
     * A.B.C    A = function name, B = record-typed parameter name, 
     *          C = field name 
     * A.*      Whole-row reference to composite parameter A. 
     * A.B.*    Same, with A = function name, B = parameter name 
     * 
     * Here, it's sufficient to ignore the "*" in the last two cases --- the 
     * main parser will take care of expanding the whole-row reference. 
     *---------- 
     */ 
</span>    <a href="functions.c.html#LN288"><span class='Ref_To_Local'>nnames</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN285"><span class='Ref_to_Parameter'>cref</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN234"><span class='Ref_to_Member'>fields</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN288"><span class='Ref_To_Local'>nnames</span></a> <span class='Operator'>&GT; </span><span class='Number'>3</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN130"><span class='Ref_to_Macro'>llast</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN285"><span class='Ref_to_Parameter'>cref</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN234"><span class='Ref_to_Member'>fields</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN367"><span class='Ref_to_Struct'>A_Star</span></a><span class='Parentheses'>))</span> 
        <a href="functions.c.html#LN288"><span class='Ref_To_Local'>nnames</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span> 
    <a href="functions.c.html#LN289"><span class='Ref_To_Local'>field1</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN285"><span class='Ref_to_Parameter'>cref</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN234"><span class='Ref_to_Member'>fields</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN289"><span class='Ref_To_Local'>field1</span></a><span class='Delimiter'>, </span>String<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="functions.c.html#LN291"><span class='Ref_To_Local'>name1</span></a> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN289"><span class='Ref_To_Local'>field1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN288"><span class='Ref_To_Local'>nnames</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="functions.c.html#LN290"><span class='Ref_To_Local'>subfield</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN115"><span class='Ref_to_Macro'>lsecond</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN285"><span class='Ref_to_Parameter'>cref</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN234"><span class='Ref_to_Member'>fields</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN290"><span class='Ref_To_Local'>subfield</span></a><span class='Delimiter'>, </span>String<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="functions.c.html#LN292"><span class='Ref_To_Local'>name2</span></a> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN290"><span class='Ref_To_Local'>subfield</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN288"><span class='Ref_To_Local'>nnames</span></a> <span class='Operator'>== </span><span class='Number'>3</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Three-part name: if the first part doesn't match the function name, 
         * we can fail immediately. Otherwise, look up the second part, and 
         * take the third part to be a field reference. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="functions.c.html#LN291"><span class='Ref_To_Local'>name1</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN287"><span class='Ref_To_Local'>pinfo</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN136"><span class='Ref_to_Member'>fname</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <a href="functions.c.html#LN293"><span class='Ref_To_Local'>param</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN151"><span class='Ref_to_Proto'>sql_fn_resolve_param_name</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN287"><span class='Ref_To_Local'>pinfo</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN292"><span class='Ref_To_Local'>name2</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN285"><span class='Ref_to_Parameter'>cref</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN235"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="functions.c.html#LN290"><span class='Ref_To_Local'>subfield</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN120"><span class='Ref_to_Macro'>lthird</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN285"><span class='Ref_to_Parameter'>cref</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN234"><span class='Ref_to_Member'>fields</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN290"><span class='Ref_To_Local'>subfield</span></a><span class='Delimiter'>, </span>String<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN288"><span class='Ref_To_Local'>nnames</span></a> <span class='Operator'>== </span><span class='Number'>2</span> <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="functions.c.html#LN291"><span class='Ref_To_Local'>name1</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN287"><span class='Ref_To_Local'>pinfo</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN136"><span class='Ref_to_Member'>fname</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Two-part name with first part matching function name: first see if 
         * second part matches any parameter name. 
         */ 
</span>        <a href="functions.c.html#LN293"><span class='Ref_To_Local'>param</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN151"><span class='Ref_to_Proto'>sql_fn_resolve_param_name</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN287"><span class='Ref_To_Local'>pinfo</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN292"><span class='Ref_To_Local'>name2</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN285"><span class='Ref_to_Parameter'>cref</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN235"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN293"><span class='Ref_To_Local'>param</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Yes, so this is a parameter reference, no subfield */ 
</span>            <a href="functions.c.html#LN290"><span class='Ref_To_Local'>subfield</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* No, so try to match as parameter name and subfield */ 
</span>            <a href="functions.c.html#LN293"><span class='Ref_To_Local'>param</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN151"><span class='Ref_to_Proto'>sql_fn_resolve_param_name</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN287"><span class='Ref_To_Local'>pinfo</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN291"><span class='Ref_To_Local'>name1</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN285"><span class='Ref_to_Parameter'>cref</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN235"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Single name, or parameter name followed by subfield */ 
</span>        <a href="functions.c.html#LN293"><span class='Ref_To_Local'>param</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN151"><span class='Ref_to_Proto'>sql_fn_resolve_param_name</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN287"><span class='Ref_To_Local'>pinfo</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN291"><span class='Ref_To_Local'>name1</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN285"><span class='Ref_to_Parameter'>cref</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN235"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="functions.c.html#LN293"><span class='Ref_To_Local'>param</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* No match */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN290"><span class='Ref_To_Local'>subfield</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Must be a reference to a field of a composite parameter; otherwise 
         * ParseFuncOrColumn will return NULL, and we'll fail back at the 
         * caller. 
         */ 
</span>        <a href="functions.c.html#LN293"><span class='Ref_To_Local'>param</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_func.h.html#LN32"><span class='Ref_to_Proto'>ParseFuncOrColumn</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN285"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN290"><span class='Ref_To_Local'>subfield</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <a href="../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN293"><span class='Ref_To_Local'>param</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                  <a href="functions.c.html#LN285"><span class='Ref_to_Parameter'>cref</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN235"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="functions.c.html#LN293"><span class='Ref_To_Local'>param</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end sql_fn_post_column_ref &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * sql_fn_param_ref     parser callback for ParamRefs ($n symbols) 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN401"></a><span class='Declare_Function'>sql_fn_param_ref</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN241"><span class='Ref_to_Struct'>ParamRef</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pref</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN403"></a>    <a href="../../include/executor/functions.h.html#LN20"><span class='Ref_to_Typedef'>SQLFunctionParseInfoPtr</span></a> <span class='Declare_Local'>pinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/executor/functions.h.html#LN20"><span class='Ref_to_Typedef'>SQLFunctionParseInfoPtr</span></a><span class='Parentheses'>) </span><a href="functions.c.html#LN401"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/parser/parse_node.h.html#LN209"><span class='Ref_to_Member'>p_ref_hook_state</span></a><span class='Delimiter'>; 
</span><a name="LN404"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>paramno</span> <span class='Operator'>= </span><a href="functions.c.html#LN401"><span class='Ref_to_Parameter'>pref</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN244"><span class='Ref_to_Member'>number</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check parameter number is valid */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN404"><span class='Ref_To_Local'>paramno</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="functions.c.html#LN404"><span class='Ref_To_Local'>paramno</span></a> <span class='Operator'>&GT; </span><a href="functions.c.html#LN403"><span class='Ref_To_Local'>pinfo</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN137"><span class='Ref_to_Member'>nargs</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* unknown parameter number */ 
</span> 
    <span class='Control'>return</span> <a href="functions.c.html#LN149"><span class='Ref_to_Proto'>sql_fn_make_param</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN403"><span class='Ref_To_Local'>pinfo</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN404"><span class='Ref_To_Local'>paramno</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN401"><span class='Ref_to_Parameter'>pref</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN245"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * sql_fn_make_param        construct a Param node for the given paramno 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN417"></a><span class='Declare_Function'>sql_fn_make_param</span><span class='Parentheses'>(</span><a href="../../include/executor/functions.h.html#LN20"><span class='Ref_to_Typedef'>SQLFunctionParseInfoPtr</span></a> <span class='Declare_Parameter'>pinfo</span><span class='Delimiter'>, 
</span><a name="LN418"></a>                  <span class='Keyword'>int </span><span class='Declare_Parameter'>paramno</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>location</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN420"></a>    <a href="../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>param</span><span class='Delimiter'>; 
</span> 
    <a href="functions.c.html#LN420"><span class='Ref_To_Local'>param</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="functions.c.html#LN420"><span class='Ref_To_Local'>param</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN243"><span class='Ref_to_Member'>paramkind</span></a> <span class='Operator'>= </span><a href="../../include/nodes/primnodes.h.html#LN234"><span class='Ref_to_EnumConst'>PARAM_EXTERN</span></a><span class='Delimiter'>; 
</span>    <a href="functions.c.html#LN420"><span class='Ref_To_Local'>param</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN244"><span class='Ref_to_Member'>paramid</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN418"><span class='Ref_to_Parameter'>paramno</span></a><span class='Delimiter'>; 
</span>    <a href="functions.c.html#LN420"><span class='Ref_To_Local'>param</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN245"><span class='Ref_to_Member'>paramtype</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN417"><span class='Ref_to_Parameter'>pinfo</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN138"><span class='Ref_to_Member'>argtypes</span></a><span class='Delimiter'>[</span><a href="functions.c.html#LN418"><span class='Ref_to_Parameter'>paramno</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>    <a href="functions.c.html#LN420"><span class='Ref_To_Local'>param</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN246"><span class='Ref_to_Member'>paramtypmod</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="functions.c.html#LN420"><span class='Ref_To_Local'>param</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN247"><span class='Ref_to_Member'>paramcollid</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN166"><span class='Ref_to_Proto'>get_typcollation</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN420"><span class='Ref_To_Local'>param</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN245"><span class='Ref_to_Member'>paramtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="functions.c.html#LN420"><span class='Ref_To_Local'>param</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN248"><span class='Ref_to_Member'>location</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN418"><span class='Ref_to_Parameter'>location</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we have a function input collation, allow it to override the 
     * type-derived collation for parameter symbols.  (XXX perhaps this should 
     * not happen if the type collation is not default?) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN417"><span class='Ref_to_Parameter'>pinfo</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN141"><span class='Ref_to_Member'>collation</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN420"><span class='Ref_To_Local'>param</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN247"><span class='Ref_to_Member'>paramcollid</span></a><span class='Parentheses'>))</span> 
        <a href="functions.c.html#LN420"><span class='Ref_To_Local'>param</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN247"><span class='Ref_to_Member'>paramcollid</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN417"><span class='Ref_to_Parameter'>pinfo</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN141"><span class='Ref_to_Member'>collation</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="functions.c.html#LN420"><span class='Ref_To_Local'>param</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end sql_fn_make_param &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Search for a function parameter of the given name; if there is one, 
 * construct and return a Param node for it.  If not, return NULL. 
 * Helper function for sql_fn_post_column_ref. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN447"></a><span class='Declare_Function'>sql_fn_resolve_param_name</span><span class='Parentheses'>(</span><a href="../../include/executor/functions.h.html#LN20"><span class='Ref_to_Typedef'>SQLFunctionParseInfoPtr</span></a> <span class='Declare_Parameter'>pinfo</span><span class='Delimiter'>, 
</span><a name="LN448"></a>                          <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>paramname</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>location</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN450"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN447"><span class='Ref_to_Parameter'>pinfo</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN139"><span class='Ref_to_Member'>argnames</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN450"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="functions.c.html#LN450"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="functions.c.html#LN447"><span class='Ref_to_Parameter'>pinfo</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN137"><span class='Ref_to_Member'>nargs</span></a><span class='Delimiter'>; </span><a href="functions.c.html#LN450"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN447"><span class='Ref_to_Parameter'>pinfo</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN139"><span class='Ref_to_Member'>argnames</span></a><span class='Delimiter'>[</span><a href="functions.c.html#LN450"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="functions.c.html#LN447"><span class='Ref_to_Parameter'>pinfo</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN139"><span class='Ref_to_Member'>argnames</span></a><span class='Delimiter'>[</span><a href="functions.c.html#LN450"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="functions.c.html#LN448"><span class='Ref_to_Parameter'>paramname</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <a href="functions.c.html#LN149"><span class='Ref_to_Proto'>sql_fn_make_param</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN447"><span class='Ref_to_Parameter'>pinfo</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN450"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="functions.c.html#LN448"><span class='Ref_to_Parameter'>location</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Set up the per-query execution_state records for a SQL function. 
 * 
 * The input is a List of Lists of parsed and rewritten, but not planned, 
 * querytrees.  The sublist structure denotes the original query boundaries. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN471"></a><span class='Declare_Function'>init_execution_state</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>queryTree_list</span><span class='Delimiter'>, 
</span><a name="LN472"></a>                     <a href="functions.c.html#LN127"><span class='Ref_to_Typedef'>SQLFunctionCachePtr</span></a> <span class='Declare_Parameter'>fcache</span><span class='Delimiter'>, 
</span><a name="LN473"></a>                     <span class='Keyword'>bool </span><span class='Declare_Parameter'>lazyEvalOK</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN475"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>eslist</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN476"></a>    <a href="functions.c.html#LN62"><span class='Ref_to_Struct'>execution_state</span></a> <span class='Operator'>*</span><span class='Declare_Local'>lasttages</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN477"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc1</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN477"><span class='Ref_To_Local'>lc1</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN471"><span class='Ref_to_Parameter'>queryTree_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN481"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>qtlist</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN477"><span class='Ref_To_Local'>lc1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN482"></a>        <a href="functions.c.html#LN62"><span class='Ref_to_Struct'>execution_state</span></a> <span class='Operator'>*</span><span class='Declare_Local'>firstes</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN483"></a>        <a href="functions.c.html#LN62"><span class='Ref_to_Struct'>execution_state</span></a> <span class='Operator'>*</span><span class='Declare_Local'>preves</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN484"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc2</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN484"><span class='Ref_To_Local'>lc2</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN481"><span class='Ref_To_Local'>qtlist</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN488"></a>            <a href="../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>queryTree</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN484"><span class='Ref_To_Local'>lc2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN489"></a>            <a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>stmt</span><span class='Delimiter'>; 
</span><a name="LN490"></a>            <a href="functions.c.html#LN62"><span class='Ref_to_Struct'>execution_state</span></a> <span class='Operator'>*</span><span class='Declare_Local'>newes</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Plan the query if needed */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN488"><span class='Ref_To_Local'>queryTree</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN109"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN654"><span class='Ref_to_EnumConst'>CMD_UTILITY</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Utility commands require no planning. */ 
</span>                <a href="functions.c.html#LN489"><span class='Ref_To_Local'>stmt</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="functions.c.html#LN489"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN44"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN654"><span class='Ref_to_EnumConst'>CMD_UTILITY</span></a><span class='Delimiter'>; 
</span>                <a href="functions.c.html#LN489"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN52"><span class='Ref_to_Member'>canSetTag</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN488"><span class='Ref_To_Local'>queryTree</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN115"><span class='Ref_to_Member'>canSetTag</span></a><span class='Delimiter'>; 
</span>                <a href="functions.c.html#LN489"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN93"><span class='Ref_to_Member'>utilityStmt</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN488"><span class='Ref_To_Local'>queryTree</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN117"><span class='Ref_to_Member'>utilityStmt</span></a><span class='Delimiter'>; 
</span>                <a href="functions.c.html#LN489"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN96"><span class='Ref_to_Member'>stmt_location</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN488"><span class='Ref_To_Local'>queryTree</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN179"><span class='Ref_to_Member'>stmt_location</span></a><span class='Delimiter'>; 
</span>                <a href="functions.c.html#LN489"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN97"><span class='Ref_to_Member'>stmt_len</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN488"><span class='Ref_To_Local'>queryTree</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN180"><span class='Ref_to_Member'>stmt_len</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
                <a href="functions.c.html#LN489"><span class='Ref_To_Local'>stmt</span></a> <span class='Operator'>= </span><a href="../../include/tcop/tcopprot.h.html#LN59"><span class='Ref_to_Proto'>pg_plan_query</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN488"><span class='Ref_To_Local'>queryTree</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../include/nodes/parsenodes.h.html#LN2610"><span class='Ref_to_Const'>CURSOR_OPT_PARALLEL_OK</span></a><span class='Delimiter'>, 
</span>                                     <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Precheck all commands for validity in a function.  This should 
             * generally match the restrictions spi.c applies. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN489"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN44"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN654"><span class='Ref_to_EnumConst'>CMD_UTILITY</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN489"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN93"><span class='Ref_to_Member'>utilityStmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1911"><span class='Ref_to_Struct'>CopyStmt</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>                    <span class='Parentheses'>((</span><a href="../../include/nodes/parsenodes.h.html#LN1911"><span class='Ref_to_Struct'>CopyStmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="functions.c.html#LN489"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN93"><span class='Ref_to_Member'>utilityStmt</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>filename <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot COPY to/from client in a SQL function"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN489"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN93"><span class='Ref_to_Member'>utilityStmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2902"><span class='Ref_to_Struct'>TransactionStmt</span></a><span class='Parentheses'>))</span> 
                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <span class='Comment_Multi_Line'>/* translator: %s is a SQL statement name */ 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"%s is not allowed in a SQL function"</span><span class='Delimiter'>, 
</span>                                    <a href="../../include/tcop/utility.h.html#LN48"><span class='Ref_to_Proto'>CreateCommandTag</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN489"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN93"><span class='Ref_to_Member'>utilityStmt</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN472"><span class='Ref_to_Parameter'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN103"><span class='Ref_to_Member'>readonly_func</span></a> <span class='Operator'>&& !</span><a href="../../include/tcop/utility.h.html#LN52"><span class='Ref_to_Proto'>CommandIsReadOnly</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN489"><span class='Ref_To_Local'>stmt</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <span class='Comment_Multi_Line'>/* translator: %s is a SQL statement name */ 
</span>                       <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"%s is not allowed in a non-volatile function"</span><span class='Delimiter'>, 
</span>                              <a href="../../include/tcop/utility.h.html#LN48"><span class='Ref_to_Proto'>CreateCommandTag</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="functions.c.html#LN489"><span class='Ref_To_Local'>stmt</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/xact.h.html#LN405"><span class='Ref_to_Proto'>IsInParallelMode</span></a><span class='Parentheses'>() </span><span class='Operator'>&& !</span><a href="../../include/tcop/utility.h.html#LN52"><span class='Ref_to_Proto'>CommandIsReadOnly</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN489"><span class='Ref_To_Local'>stmt</span></a><span class='Parentheses'>))</span> 
                <a href="../tcop/utility.c.html#LN252"><span class='Ref_to_Func'>PreventCommandIfParallelMode</span></a><span class='Parentheses'>(</span><a href="../../include/tcop/utility.h.html#LN48"><span class='Ref_to_Proto'>CreateCommandTag</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="functions.c.html#LN489"><span class='Ref_To_Local'>stmt</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* OK, build the execution_state for this query */ 
</span>            <a href="functions.c.html#LN490"><span class='Ref_To_Local'>newes</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="functions.c.html#LN62"><span class='Ref_to_Struct'>execution_state</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="functions.c.html#LN62"><span class='Ref_to_Struct'>execution_state</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN483"><span class='Ref_To_Local'>preves</span></a><span class='Parentheses'>) 
</span>                <a href="functions.c.html#LN483"><span class='Ref_To_Local'>preves</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN64"><span class='Ref_to_Member'>next</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN490"><span class='Ref_To_Local'>newes</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="functions.c.html#LN482"><span class='Ref_To_Local'>firstes</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN490"><span class='Ref_To_Local'>newes</span></a><span class='Delimiter'>; 
</span> 
            <a href="functions.c.html#LN490"><span class='Ref_To_Local'>newes</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN64"><span class='Ref_to_Member'>next</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="functions.c.html#LN490"><span class='Ref_To_Local'>newes</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN65"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN59"><span class='Ref_to_EnumConst'>F_EXEC_START</span></a><span class='Delimiter'>; 
</span>            <a href="functions.c.html#LN490"><span class='Ref_To_Local'>newes</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN66"><span class='Ref_to_Member'>setsResult</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* might change below */ 
</span>            <a href="functions.c.html#LN490"><span class='Ref_To_Local'>newes</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN67"><span class='Ref_to_Member'>lazyEval</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* might change below */ 
</span>            <a href="functions.c.html#LN490"><span class='Ref_To_Local'>newes</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN68"><span class='Ref_to_Member'>stmt</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN489"><span class='Ref_To_Local'>stmt</span></a><span class='Delimiter'>; 
</span>            <a href="functions.c.html#LN490"><span class='Ref_To_Local'>newes</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN69"><span class='Ref_to_Member'>qd</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN488"><span class='Ref_To_Local'>queryTree</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN115"><span class='Ref_to_Member'>canSetTag</span></a><span class='Parentheses'>) 
</span>                <a href="functions.c.html#LN476"><span class='Ref_To_Local'>lasttages</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN490"><span class='Ref_To_Local'>newes</span></a><span class='Delimiter'>; 
</span> 
            <a href="functions.c.html#LN483"><span class='Ref_To_Local'>preves</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN490"><span class='Ref_To_Local'>newes</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="functions.c.html#LN475"><span class='Ref_To_Local'>eslist</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN475"><span class='Ref_To_Local'>eslist</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN482"><span class='Ref_To_Local'>firstes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Mark the last canSetTag query as delivering the function result; then, 
     * if it is a plain SELECT, mark it for lazy evaluation. If it's not a 
     * SELECT we must always run it to completion. 
     * 
     * Note: at some point we might add additional criteria for whether to use 
     * lazy eval.  However, we should prefer to use it whenever the function 
     * doesn't return set, since fetching more than one row is useless in that 
     * case. 
     * 
     * Note: don't set setsResult if the function returns VOID, as evidenced 
     * by not having made a junkfilter.  This ensures we'll throw away any 
     * output from a utility statement that check_sql_fn_retval deemed to not 
     * have output. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN476"><span class='Ref_To_Local'>lasttages</span></a> <span class='Operator'>&& </span><a href="functions.c.html#LN472"><span class='Ref_to_Parameter'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN110"><span class='Ref_to_Member'>junkFilter</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="functions.c.html#LN476"><span class='Ref_To_Local'>lasttages</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN66"><span class='Ref_to_Member'>setsResult</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN473"><span class='Ref_to_Parameter'>lazyEvalOK</span></a> <span class='Operator'>&& 
</span>            <a href="functions.c.html#LN476"><span class='Ref_To_Local'>lasttages</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN68"><span class='Ref_to_Member'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN44"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN650"><span class='Ref_to_EnumConst'>CMD_SELECT</span></a> <span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="functions.c.html#LN476"><span class='Ref_To_Local'>lasttages</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN68"><span class='Ref_to_Member'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN50"><span class='Ref_to_Member'>hasModifyingCTE</span></a><span class='Parentheses'>) 
</span>            <a href="functions.c.html#LN472"><span class='Ref_to_Parameter'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN104"><span class='Ref_to_Member'>lazyEval</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN476"><span class='Ref_To_Local'>lasttages</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN67"><span class='Ref_to_Member'>lazyEval</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="functions.c.html#LN475"><span class='Ref_To_Local'>eslist</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end init_execution_state &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Initialize the SQLFunctionCache for a SQL function 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN592"></a><span class='Declare_Function'>init_sql_fcache</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>finfo</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>collation</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>lazyEvalOK</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN594"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>foid</span> <span class='Operator'>= </span><a href="functions.c.html#LN592"><span class='Ref_to_Parameter'>finfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a><span class='Delimiter'>; 
</span><a name="LN595"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>fcontext</span><span class='Delimiter'>; 
</span><a name="LN596"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN597"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>rettype</span><span class='Delimiter'>; 
</span><a name="LN598"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>procedureTuple</span><span class='Delimiter'>; 
</span><a name="LN599"></a>    <a href="../../include/catalog/pg_proc.h.html#LN82"><span class='Ref_to_Typedef'>Form_pg_proc</span></a> <span class='Declare_Local'>procedureStruct</span><span class='Delimiter'>; 
</span><a name="LN600"></a>    <a href="functions.c.html#LN127"><span class='Ref_to_Typedef'>SQLFunctionCachePtr</span></a> <span class='Declare_Local'>fcache</span><span class='Delimiter'>; 
</span><a name="LN601"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>raw_parsetree_list</span><span class='Delimiter'>; 
</span><a name="LN602"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>queryTree_list</span><span class='Delimiter'>; 
</span><a name="LN603"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>flat_query_list</span><span class='Delimiter'>; 
</span><a name="LN604"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span><a name="LN605"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>tmp</span><span class='Delimiter'>; 
</span><a name="LN606"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create memory context that holds all the SQLFunctionCache data.  It 
     * must be a child of whatever context holds the FmgrInfo. 
     */ 
</span>    <a href="functions.c.html#LN595"><span class='Ref_To_Local'>fcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN592"><span class='Ref_to_Parameter'>finfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/fmgr.h.html#LN64"><span class='Ref_to_Member'>fn_mcxt</span></a><span class='Delimiter'>, 
</span>                                     <span class='String'>"SQL function data"</span><span class='Delimiter'>, 
</span>                                     <a href="../../include/utils/memutils.h.html#LN164"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="functions.c.html#LN596"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN595"><span class='Ref_To_Local'>fcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create the struct proper, link it to fcontext and fn_extra.  Once this 
     * is done, we'll be able to recover the memory after failure, even if the 
     * FmgrInfo is long-lived. 
     */ 
</span>    <a href="functions.c.html#LN600"><span class='Ref_To_Local'>fcache</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="functions.c.html#LN127"><span class='Ref_to_Typedef'>SQLFunctionCachePtr</span></a><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="functions.c.html#LN90"><span class='Ref_to_Typedef'>SQLFunctionCache</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="functions.c.html#LN600"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN120"><span class='Ref_to_Member'>fcontext</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN595"><span class='Ref_To_Local'>fcontext</span></a><span class='Delimiter'>; 
</span>    <a href="functions.c.html#LN592"><span class='Ref_to_Parameter'>finfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/fmgr.h.html#LN63"><span class='Ref_to_Member'>fn_extra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="functions.c.html#LN600"><span class='Ref_To_Local'>fcache</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * get the procedure tuple corresponding to the given function Oid 
     */ 
</span>    <a href="functions.c.html#LN598"><span class='Ref_To_Local'>procedureTuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN76"><span class='Ref_to_EnumConst'>PROCOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN594"><span class='Ref_To_Local'>foid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN598"><span class='Ref_To_Local'>procedureTuple</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for function %u"</span><span class='Delimiter'>, </span><a href="functions.c.html#LN594"><span class='Ref_To_Local'>foid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="functions.c.html#LN599"><span class='Ref_To_Local'>procedureStruct</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_proc.h.html#LN82"><span class='Ref_to_Typedef'>Form_pg_proc</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN598"><span class='Ref_To_Local'>procedureTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * copy function name immediately for use by error reporting callback 
     */ 
</span>    <a href="functions.c.html#LN600"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN92"><span class='Ref_to_Member'>fname</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN599"><span class='Ref_To_Local'>procedureStruct</span></a><span class='Operator'>-&GT;</span>proname<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * get the result type from the procedure tuple, and check for polymorphic 
     * result type; if so, find out the actual result type. 
     */ 
</span>    <a href="functions.c.html#LN597"><span class='Ref_To_Local'>rettype</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN599"><span class='Ref_To_Local'>procedureStruct</span></a><span class='Operator'>-&GT;</span>prorettype<span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN744"><span class='Ref_to_Macro'>IsPolymorphicType</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN597"><span class='Ref_To_Local'>rettype</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="functions.c.html#LN597"><span class='Ref_To_Local'>rettype</span></a> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN662"><span class='Ref_to_Proto'>get_fn_expr_rettype</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN592"><span class='Ref_to_Parameter'>finfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN597"><span class='Ref_To_Local'>rettype</span></a> <span class='Operator'>== </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span>      <span class='Comment_Single_Line'>/* this probably should not happen */ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not determine actual result type for function declared to return type %s"</span><span class='Delimiter'>, 
</span>                            <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN599"><span class='Ref_To_Local'>procedureStruct</span></a><span class='Operator'>-&GT;</span>prorettype<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="functions.c.html#LN600"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN97"><span class='Ref_to_Member'>rettype</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN597"><span class='Ref_To_Local'>rettype</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Fetch the typlen and byval info for the result type */ 
</span>    <a href="../../include/utils/lsyscache.h.html#LN135"><span class='Ref_to_Proto'>get_typlenbyval</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN597"><span class='Ref_To_Local'>rettype</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="functions.c.html#LN600"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN98"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="functions.c.html#LN600"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN99"><span class='Ref_to_Member'>typbyval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Remember whether we're returning setof something */ 
</span>    <a href="functions.c.html#LN600"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN100"><span class='Ref_to_Member'>returnsSet</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN599"><span class='Ref_To_Local'>procedureStruct</span></a><span class='Operator'>-&GT;</span>proretset<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Remember if function is STABLE/IMMUTABLE */ 
</span>    <a href="functions.c.html#LN600"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN103"><span class='Ref_to_Member'>readonly_func</span></a> <span class='Operator'>= 
</span>        <span class='Parentheses'>(</span><a href="functions.c.html#LN599"><span class='Ref_To_Local'>procedureStruct</span></a><span class='Operator'>-&GT;</span>provolatile <span class='Operator'>!= </span><a href="../../include/catalog/pg_proc.h.html#LN5484"><span class='Ref_to_Const'>PROVOLATILE_VOLATILE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We need the actual argument types to pass to the parser.  Also make 
     * sure that parameter symbols are considered to have the function's 
     * resolved input collation. 
     */ 
</span>    <a href="functions.c.html#LN600"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN95"><span class='Ref_to_Member'>pinfo</span></a> <span class='Operator'>= </span><a href="../../include/executor/functions.h.html#LN24"><span class='Ref_to_Proto'>prepare_sql_fn_parse_info</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN598"><span class='Ref_To_Local'>procedureTuple</span></a><span class='Delimiter'>, 
</span>                                              <a href="functions.c.html#LN592"><span class='Ref_to_Parameter'>finfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/fmgr.h.html#LN65"><span class='Ref_to_Member'>fn_expr</span></a><span class='Delimiter'>, 
</span>                                              <a href="functions.c.html#LN592"><span class='Ref_to_Parameter'>collation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * And of course we need the function body text. 
     */ 
</span>    <a href="functions.c.html#LN605"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN76"><span class='Ref_to_EnumConst'>PROCOID</span></a><span class='Delimiter'>, 
</span>                          <a href="functions.c.html#LN598"><span class='Ref_To_Local'>procedureTuple</span></a><span class='Delimiter'>, 
</span>                          <a href="../../include/catalog/pg_proc.h.html#LN114"><span class='Ref_to_Const'>Anum_pg_proc_prosrc</span></a><span class='Delimiter'>, 
</span>                          <span class='Operator'>&</span><a href="functions.c.html#LN606"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN606"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"null prosrc for function %u"</span><span class='Delimiter'>, </span><a href="functions.c.html#LN594"><span class='Ref_To_Local'>foid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="functions.c.html#LN600"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN93"><span class='Ref_to_Member'>src</span></a> <span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN605"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Parse and rewrite the queries in the function text.  Use sublists to 
     * keep track of the original query boundaries.  But we also build a 
     * "flat" list of the rewritten queries to pass to check_sql_fn_retval. 
     * This is because the last canSetTag query determines the result type 
     * independently of query boundaries --- and it might not be in the last 
     * sublist, for example if the last query rewrites to DO INSTEAD NOTHING. 
     * (It might not be unreasonable to throw an error in such a case, but 
     * this is the historical behavior and it doesn't seem worth changing.) 
     * 
     * Note: since parsing and planning is done in fcontext, we will generate 
     * a lot of cruft that lives as long as the fcache does.  This is annoying 
     * but we'll not worry about it until the module is rewritten to use 
     * plancache.c. 
     */ 
</span>    <a href="functions.c.html#LN601"><span class='Ref_To_Local'>raw_parsetree_list</span></a> <span class='Operator'>= </span><a href="../../include/tcop/tcopprot.h.html#LN49"><span class='Ref_to_Proto'>pg_parse_query</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN600"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN93"><span class='Ref_to_Member'>src</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="functions.c.html#LN602"><span class='Ref_To_Local'>queryTree_list</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="functions.c.html#LN603"><span class='Ref_To_Local'>flat_query_list</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN604"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN601"><span class='Ref_To_Local'>raw_parsetree_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN709"></a>        <a href="../../include/nodes/parsenodes.h.html#LN1396"><span class='Ref_to_Struct'>RawStmt</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>parsetree</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1396"><span class='Ref_to_Struct'>RawStmt</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN604"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN710"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>queryTree_sublist</span><span class='Delimiter'>; 
</span> 
        <a href="functions.c.html#LN710"><span class='Ref_To_Local'>queryTree_sublist</span></a> <span class='Operator'>= </span><a href="../../include/tcop/tcopprot.h.html#LN54"><span class='Ref_to_Proto'>pg_analyze_and_rewrite_params</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN709"><span class='Ref_To_Local'>parsetree</span></a><span class='Delimiter'>, 
</span>                                                          <a href="functions.c.html#LN600"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN93"><span class='Ref_to_Member'>src</span></a><span class='Delimiter'>, 
</span>                                       <span class='Parentheses'>(</span><a href="../../include/nodes/params.h.html#LN65"><span class='Ref_to_Typedef'>ParserSetupHook</span></a><span class='Parentheses'>) </span><a href="../../include/executor/functions.h.html#LN28"><span class='Ref_to_Proto'>sql_fn_parser_setup</span></a><span class='Delimiter'>, 
</span>                                                          <a href="functions.c.html#LN600"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN95"><span class='Ref_to_Member'>pinfo</span></a><span class='Delimiter'>, 
</span>                                                          <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="functions.c.html#LN602"><span class='Ref_To_Local'>queryTree_list</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN602"><span class='Ref_To_Local'>queryTree_list</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN710"><span class='Ref_To_Local'>queryTree_sublist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="functions.c.html#LN603"><span class='Ref_To_Local'>flat_query_list</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN603"><span class='Ref_To_Local'>flat_query_list</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../include/nodes/pg_list.h.html#LN268"><span class='Ref_to_Proto'>list_copy</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN710"><span class='Ref_To_Local'>queryTree_sublist</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check that the function returns the type it claims to.  Although in 
     * simple cases this was already done when the function was defined, we 
     * have to recheck because database objects used in the function's queries 
     * might have changed type.  We'd have to do it anyway if the function had 
     * any polymorphic arguments. 
     * 
     * Note: we set fcache-&GT;returnsTuple according to whether we are returning 
     * the whole tuple result or just a single column.  In the latter case we 
     * clear returnsTuple because we need not act different from the scalar 
     * result case, even if it's a rowtype column.  (However, we have to force 
     * lazy eval mode in that case; otherwise we'd need extra code to expand 
     * the rowtype column into multiple columns, since we have no way to 
     * notify the caller that it should do that.) 
     * 
     * check_sql_fn_retval will also construct a JunkFilter we can use to 
     * coerce the returned rowtype to the desired form (unless the result type 
     * is VOID, in which case there's nothing to coerce to). 
     */ 
</span>    <a href="functions.c.html#LN600"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN101"><span class='Ref_to_Member'>returnsTuple</span></a> <span class='Operator'>= </span><a href="../../include/executor/functions.h.html#LN31"><span class='Ref_to_Proto'>check_sql_fn_retval</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN594"><span class='Ref_To_Local'>foid</span></a><span class='Delimiter'>, 
</span>                                               <a href="functions.c.html#LN597"><span class='Ref_To_Local'>rettype</span></a><span class='Delimiter'>, 
</span>                                               <a href="functions.c.html#LN603"><span class='Ref_To_Local'>flat_query_list</span></a><span class='Delimiter'>, 
</span>                                               <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                               <span class='Operator'>&</span><a href="functions.c.html#LN600"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN110"><span class='Ref_to_Member'>junkFilter</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN600"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN101"><span class='Ref_to_Member'>returnsTuple</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Make sure output rowtype is properly blessed */ 
</span>        <a href="../../include/funcapi.h.html#LN229"><span class='Ref_to_Proto'>BlessTupleDesc</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN600"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN110"><span class='Ref_to_Member'>junkFilter</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN334"><span class='Ref_to_Member'>jf_resultSlot</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/tuptable.h.html#LN120"><span class='Ref_to_Member'>tts_tupleDescriptor</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN600"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN100"><span class='Ref_to_Member'>returnsSet</span></a> <span class='Operator'>&& </span><a href="../../include/utils/lsyscache.h.html#LN150"><span class='Ref_to_Proto'>type_is_rowtype</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN600"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN97"><span class='Ref_to_Member'>rettype</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Returning rowtype as if it were scalar --- materialize won't work. 
         * Right now it's sufficient to override any caller preference for 
         * materialize mode, but to add more smarts in init_execution_state 
         * about this, we'd probably need a three-way flag instead of bool. 
         */ 
</span>        <a href="functions.c.html#LN592"><span class='Ref_to_Parameter'>lazyEvalOK</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Finally, plan the queries */ 
</span>    <a href="functions.c.html#LN600"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN118"><span class='Ref_to_Member'>func_state</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN153"><span class='Ref_to_Proto'>init_execution_state</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN602"><span class='Ref_To_Local'>queryTree_list</span></a><span class='Delimiter'>, 
</span>                                              <a href="functions.c.html#LN600"><span class='Ref_To_Local'>fcache</span></a><span class='Delimiter'>, 
</span>                                              <a href="functions.c.html#LN592"><span class='Ref_to_Parameter'>lazyEvalOK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Mark fcache with time of creation to show it's valid */ 
</span>    <a href="functions.c.html#LN600"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN123"><span class='Ref_to_Member'>lxid</span></a> <span class='Operator'>= </span><a href="../storage/lmgr/proc.c.html#LN66"><span class='Ref_to_Global_Var'>MyProc</span></a><span class='Operator'>-&GT;</span><a href="../../include/storage/proc.h.html#LN104"><span class='Ref_to_Member'>lxid</span></a><span class='Delimiter'>; 
</span>    <a href="functions.c.html#LN600"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN124"><span class='Ref_to_Member'>subxid</span></a> <span class='Operator'>= </span><a href="../../include/access/xact.h.html#LN336"><span class='Ref_to_Proto'>GetCurrentSubTransactionId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN598"><span class='Ref_To_Local'>procedureTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN596"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end init_sql_fcache &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* Start up execution of one execution_state node */ 
</span><span class='Keyword'>static void 
</span><a name="LN779"></a><span class='Declare_Function'>postquel_start</span><span class='Parentheses'>(</span><a href="functions.c.html#LN62"><span class='Ref_to_Struct'>execution_state</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>es</span><span class='Delimiter'>, </span><a href="functions.c.html#LN127"><span class='Ref_to_Typedef'>SQLFunctionCachePtr</span></a> <span class='Declare_Parameter'>fcache</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN781"></a>    <a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Local'>dest</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="functions.c.html#LN779"><span class='Ref_to_Parameter'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN69"><span class='Ref_to_Member'>qd</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Caller should have ensured a suitable snapshot is active */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/utils/snapmgr.h.html#LN78"><span class='Ref_to_Proto'>ActiveSnapshotSet</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If this query produces the function result, send its output to the 
     * tuplestore; else discard any output. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN779"><span class='Ref_to_Parameter'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN66"><span class='Ref_to_Member'>setsResult</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN794"></a>        <a href="functions.c.html#LN40"><span class='Ref_to_Typedef'>DR_sqlfunction</span></a> <span class='Operator'>*</span><span class='Declare_Local'>myState</span><span class='Delimiter'>; 
</span> 
        <a href="functions.c.html#LN781"><span class='Ref_To_Local'>dest</span></a> <span class='Operator'>= </span><a href="../tcop/dest.c.html#LN107"><span class='Ref_to_Func'>CreateDestReceiver</span></a><span class='Parentheses'>(</span><a href="../../include/tcop/dest.h.html#LN96"><span class='Ref_to_EnumConst'>DestSQLFunction</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* pass down the needed info to the dest receiver routines */ 
</span>        <a href="functions.c.html#LN794"><span class='Ref_To_Local'>myState</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="functions.c.html#LN40"><span class='Ref_to_Typedef'>DR_sqlfunction</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="functions.c.html#LN781"><span class='Ref_To_Local'>dest</span></a><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="functions.c.html#LN794"><span class='Ref_To_Local'>myState</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN42"><span class='Ref_to_Member'>pub</span></a><span class='Operator'>.</span><a href="../../include/tcop/dest.h.html#LN127"><span class='Ref_to_Member'>mydest</span></a> <span class='Operator'>== </span><a href="../../include/tcop/dest.h.html#LN96"><span class='Ref_to_EnumConst'>DestSQLFunction</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="functions.c.html#LN794"><span class='Ref_To_Local'>myState</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN43"><span class='Ref_to_Member'>tstore</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN779"><span class='Ref_to_Parameter'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN108"><span class='Ref_to_Member'>tstore</span></a><span class='Delimiter'>; 
</span>        <a href="functions.c.html#LN794"><span class='Ref_To_Local'>myState</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN44"><span class='Ref_to_Member'>cxt</span></a> <span class='Operator'>= </span><a href="../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>; 
</span>        <a href="functions.c.html#LN794"><span class='Ref_To_Local'>myState</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN45"><span class='Ref_to_Member'>filter</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN779"><span class='Ref_to_Parameter'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN110"><span class='Ref_to_Member'>junkFilter</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="functions.c.html#LN781"><span class='Ref_To_Local'>dest</span></a> <span class='Operator'>= </span><a href="../tcop/dest.c.html#LN90"><span class='Ref_to_Global_Var'>None_Receiver</span></a><span class='Delimiter'>; 
</span> 
    <a href="functions.c.html#LN779"><span class='Ref_to_Parameter'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN69"><span class='Ref_to_Member'>qd</span></a> <span class='Operator'>= </span><a href="../../include/executor/execdesc.h.html#LN58"><span class='Ref_to_Proto'>CreateQueryDesc</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN779"><span class='Ref_to_Parameter'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN68"><span class='Ref_to_Member'>stmt</span></a><span class='Delimiter'>, 
</span>                             <a href="functions.c.html#LN779"><span class='Ref_to_Parameter'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN93"><span class='Ref_to_Member'>src</span></a><span class='Delimiter'>, 
</span>                             <a href="../../include/utils/snapmgr.h.html#LN77"><span class='Ref_to_Proto'>GetActiveSnapshot</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                             <a href="../../include/utils/snapshot.h.html#LN24"><span class='Ref_to_Const'>InvalidSnapshot</span></a><span class='Delimiter'>, 
</span>                             <a href="functions.c.html#LN781"><span class='Ref_To_Local'>dest</span></a><span class='Delimiter'>, 
</span>                             <a href="functions.c.html#LN779"><span class='Ref_to_Parameter'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN106"><span class='Ref_to_Member'>paramLI</span></a><span class='Delimiter'>, 
</span>                             <a href="functions.c.html#LN779"><span class='Ref_to_Parameter'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN69"><span class='Ref_to_Member'>qd</span></a> <span class='Operator'>? </span><a href="functions.c.html#LN779"><span class='Ref_to_Parameter'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN69"><span class='Ref_to_Member'>qd</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN42"><span class='Ref_to_Member'>queryEnv</span></a> <span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                             <span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Utility commands don't need Executor. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN779"><span class='Ref_to_Parameter'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN69"><span class='Ref_to_Member'>qd</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN35"><span class='Ref_to_Member'>operation</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/nodes.h.html#LN654"><span class='Ref_to_EnumConst'>CMD_UTILITY</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * In lazyEval mode, do not let the executor set up an AfterTrigger 
         * context.  This is necessary not just an optimization, because we 
         * mustn't exit from the function execution with a stacked 
         * AfterTrigger level still active.  We are careful not to select 
         * lazyEval mode for any statement that could possibly queue triggers. 
         */ 
</span><a name="LN826"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>eflags</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN779"><span class='Ref_to_Parameter'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN67"><span class='Ref_to_Member'>lazyEval</span></a><span class='Parentheses'>) 
</span>            <a href="functions.c.html#LN826"><span class='Ref_To_Local'>eflags</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN61"><span class='Ref_to_Const'>EXEC_FLAG_SKIP_TRIGGERS</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="functions.c.html#LN826"><span class='Ref_To_Local'>eflags</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* default run-to-completion flags */ 
</span>        <a href="execMain.c.html#LN144"><span class='Ref_to_Func'>ExecutorStart</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN779"><span class='Ref_to_Parameter'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN69"><span class='Ref_to_Member'>qd</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN826"><span class='Ref_To_Local'>eflags</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="functions.c.html#LN779"><span class='Ref_to_Parameter'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN65"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN59"><span class='Ref_to_EnumConst'>F_EXEC_RUN</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end postquel_start &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* Run one execution_state; either to completion or to first result row */ 
/* Returns true if we ran to completion */ 
</span><span class='Keyword'>static bool 
</span><a name="LN841"></a><span class='Declare_Function'>postquel_getnext</span><span class='Parentheses'>(</span><a href="functions.c.html#LN62"><span class='Ref_to_Struct'>execution_state</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>es</span><span class='Delimiter'>, </span><a href="functions.c.html#LN127"><span class='Ref_to_Typedef'>SQLFunctionCachePtr</span></a> <span class='Declare_Parameter'>fcache</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN843"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN841"><span class='Ref_to_Parameter'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN69"><span class='Ref_to_Member'>qd</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN35"><span class='Ref_to_Member'>operation</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN654"><span class='Ref_to_EnumConst'>CMD_UTILITY</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/tcop/utility.h.html#LN33"><span class='Ref_to_Proto'>ProcessUtility</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN841"><span class='Ref_to_Parameter'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN69"><span class='Ref_to_Member'>qd</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN36"><span class='Ref_to_Member'>plannedstmt</span></a><span class='Delimiter'>, 
</span>                       <a href="functions.c.html#LN841"><span class='Ref_to_Parameter'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN93"><span class='Ref_to_Member'>src</span></a><span class='Delimiter'>, 
</span>                       <a href="../../include/tcop/utility.h.html#LN21"><span class='Ref_to_EnumConst'>PROCESS_UTILITY_QUERY</span></a><span class='Delimiter'>, 
</span>                       <a href="functions.c.html#LN841"><span class='Ref_to_Parameter'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN69"><span class='Ref_to_Member'>qd</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN41"><span class='Ref_to_Member'>params</span></a><span class='Delimiter'>, 
</span>                       <a href="functions.c.html#LN841"><span class='Ref_to_Parameter'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN69"><span class='Ref_to_Member'>qd</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN42"><span class='Ref_to_Member'>queryEnv</span></a><span class='Delimiter'>, 
</span>                       <a href="functions.c.html#LN841"><span class='Ref_to_Parameter'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN69"><span class='Ref_to_Member'>qd</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN40"><span class='Ref_to_Member'>dest</span></a><span class='Delimiter'>, 
</span>                       <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="functions.c.html#LN843"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* never stops early */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Run regular commands to completion unless lazyEval */ 
</span><a name="LN859"></a>        <a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Local'>count</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="functions.c.html#LN841"><span class='Ref_to_Parameter'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN67"><span class='Ref_to_Member'>lazyEval</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/executor/executor.h.html#LN169"><span class='Ref_to_Proto'>ExecutorRun</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN841"><span class='Ref_to_Parameter'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN69"><span class='Ref_to_Member'>qd</span></a><span class='Delimiter'>, </span><a href="../../include/access/sdir.h.html#LN25"><span class='Ref_to_EnumConst'>ForwardScanDirection</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN859"><span class='Ref_To_Local'>count</span></a><span class='Delimiter'>, </span><span class='Operator'>!</span><a href="functions.c.html#LN841"><span class='Ref_to_Parameter'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN100"><span class='Ref_to_Member'>returnsSet</span></a> <span class='Operator'>|| !</span><a href="functions.c.html#LN841"><span class='Ref_to_Parameter'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN67"><span class='Ref_to_Member'>lazyEval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If we requested run to completion OR there was no tuple returned, 
         * command must be complete. 
         */ 
</span>        <a href="functions.c.html#LN843"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="functions.c.html#LN859"><span class='Ref_To_Local'>count</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="functions.c.html#LN841"><span class='Ref_to_Parameter'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN69"><span class='Ref_to_Member'>qd</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN47"><span class='Ref_to_Member'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN453"><span class='Ref_to_Member'>es_processed</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="functions.c.html#LN843"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end postquel_getnext &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* Shut down execution of one execution_state node */ 
</span><span class='Keyword'>static void 
</span><a name="LN875"></a><span class='Declare_Function'>postquel_end</span><span class='Parentheses'>(</span><a href="functions.c.html#LN62"><span class='Ref_to_Struct'>execution_state</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>es</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* mark status done to ensure we don't do ExecutorEnd twice */ 
</span>    <a href="functions.c.html#LN875"><span class='Ref_to_Parameter'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN65"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN59"><span class='Ref_to_EnumConst'>F_EXEC_DONE</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Utility commands don't need Executor. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN875"><span class='Ref_to_Parameter'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN69"><span class='Ref_to_Member'>qd</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN35"><span class='Ref_to_Member'>operation</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/nodes.h.html#LN654"><span class='Ref_to_EnumConst'>CMD_UTILITY</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/executor/executor.h.html#LN173"><span class='Ref_to_Proto'>ExecutorFinish</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN875"><span class='Ref_to_Parameter'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN69"><span class='Ref_to_Member'>qd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/executor/executor.h.html#LN175"><span class='Ref_to_Proto'>ExecutorEnd</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN875"><span class='Ref_to_Parameter'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN69"><span class='Ref_to_Member'>qd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="functions.c.html#LN875"><span class='Ref_to_Parameter'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN69"><span class='Ref_to_Member'>qd</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN40"><span class='Ref_to_Member'>dest</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/dest.h.html#LN125"><span class='Ref_to_Member'>rDestroy</span></a><span class='Parentheses'>) (</span><a href="functions.c.html#LN875"><span class='Ref_to_Parameter'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN69"><span class='Ref_to_Member'>qd</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN40"><span class='Ref_to_Member'>dest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/executor/execdesc.h.html#LN67"><span class='Ref_to_Proto'>FreeQueryDesc</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN875"><span class='Ref_to_Parameter'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN69"><span class='Ref_to_Member'>qd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="functions.c.html#LN875"><span class='Ref_to_Parameter'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN69"><span class='Ref_to_Member'>qd</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* Build ParamListInfo array representing current arguments */ 
</span><span class='Keyword'>static void 
</span><a name="LN895"></a><span class='Declare_Function'>postquel_sub_params</span><span class='Parentheses'>(</span><a href="functions.c.html#LN127"><span class='Ref_to_Typedef'>SQLFunctionCachePtr</span></a> <span class='Declare_Parameter'>fcache</span><span class='Delimiter'>, 
</span><a name="LN896"></a>                    <a href="../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN898"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nargs</span> <span class='Operator'>= </span><a href="functions.c.html#LN896"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/fmgr.h.html#LN83"><span class='Ref_to_Member'>nargs</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN898"><span class='Ref_To_Local'>nargs</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN902"></a>        <a href="../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Local'>paramLI</span><span class='Delimiter'>; 
</span><a name="LN903"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN895"><span class='Ref_to_Parameter'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN106"><span class='Ref_to_Member'>paramLI</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="functions.c.html#LN902"><span class='Ref_To_Local'>paramLI</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/params.h.html#LN67"><span class='Ref_to_Struct'>ParamListInfoData</span></a><span class='Delimiter'>, </span>params<span class='Parentheses'>) </span><span class='Operator'>+ 
</span>                       <a href="functions.c.html#LN898"><span class='Ref_To_Local'>nargs</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/nodes/params.h.html#LN53"><span class='Ref_to_Struct'>ParamExternData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* we have static list of params, so no hooks needed */ 
</span>            <a href="functions.c.html#LN902"><span class='Ref_To_Local'>paramLI</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN69"><span class='Ref_to_Member'>paramFetch</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="functions.c.html#LN902"><span class='Ref_To_Local'>paramLI</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN70"><span class='Ref_to_Member'>paramFetchArg</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="functions.c.html#LN902"><span class='Ref_To_Local'>paramLI</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN71"><span class='Ref_to_Member'>parserSetup</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="functions.c.html#LN902"><span class='Ref_To_Local'>paramLI</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN72"><span class='Ref_to_Member'>parserSetupArg</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="functions.c.html#LN902"><span class='Ref_To_Local'>paramLI</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN73"><span class='Ref_to_Member'>numParams</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN898"><span class='Ref_To_Local'>nargs</span></a><span class='Delimiter'>; 
</span>            <a href="functions.c.html#LN902"><span class='Ref_To_Local'>paramLI</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN74"><span class='Ref_to_Member'>paramMask</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="functions.c.html#LN895"><span class='Ref_to_Parameter'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN106"><span class='Ref_to_Member'>paramLI</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN902"><span class='Ref_To_Local'>paramLI</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="functions.c.html#LN902"><span class='Ref_To_Local'>paramLI</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN895"><span class='Ref_to_Parameter'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN106"><span class='Ref_to_Member'>paramLI</span></a><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="functions.c.html#LN902"><span class='Ref_To_Local'>paramLI</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN73"><span class='Ref_to_Member'>numParams</span></a> <span class='Operator'>== </span><a href="functions.c.html#LN898"><span class='Ref_To_Local'>nargs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN903"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="functions.c.html#LN903"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="functions.c.html#LN898"><span class='Ref_To_Local'>nargs</span></a><span class='Delimiter'>; </span><a href="functions.c.html#LN903"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN927"></a>            <a href="../../include/nodes/params.h.html#LN53"><span class='Ref_to_Struct'>ParamExternData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>prm</span> <span class='Operator'>= &</span><a href="functions.c.html#LN902"><span class='Ref_To_Local'>paramLI</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN75"><span class='Ref_to_Member'>params</span></a><span class='Delimiter'>[</span><a href="functions.c.html#LN903"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
            <a href="functions.c.html#LN927"><span class='Ref_To_Local'>prm</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value </span><span class='Operator'>= </span><a href="functions.c.html#LN896"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/fmgr.h.html#LN84"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>[</span><a href="functions.c.html#LN903"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>            <a href="functions.c.html#LN927"><span class='Ref_To_Local'>prm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN56"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN896"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/fmgr.h.html#LN85"><span class='Ref_to_Member'>argnull</span></a><span class='Delimiter'>[</span><a href="functions.c.html#LN903"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>            <a href="functions.c.html#LN927"><span class='Ref_To_Local'>prm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN57"><span class='Ref_to_Member'>pflags</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="functions.c.html#LN927"><span class='Ref_To_Local'>prm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN58"><span class='Ref_to_Member'>ptype</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN895"><span class='Ref_to_Parameter'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN95"><span class='Ref_to_Member'>pinfo</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN138"><span class='Ref_to_Member'>argtypes</span></a><span class='Delimiter'>[</span><a href="functions.c.html#LN903"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if nargs&GT;0 &raquo; </span> 
    <span class='Control'>else</span> 
        <a href="functions.c.html#LN895"><span class='Ref_to_Parameter'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN106"><span class='Ref_to_Member'>paramLI</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end postquel_sub_params &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Extract the SQL function's value from a single result row.  This is used 
 * both for scalar (non-set) functions and for each row of a lazy-eval set 
 * result. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN945"></a><span class='Declare_Function'>postquel_get_single_result</span><span class='Parentheses'>(</span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Delimiter'>, 
</span><a name="LN946"></a>                           <a href="../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Delimiter'>, 
</span><a name="LN947"></a>                           <a href="functions.c.html#LN127"><span class='Ref_to_Typedef'>SQLFunctionCachePtr</span></a> <span class='Declare_Parameter'>fcache</span><span class='Delimiter'>, 
</span><a name="LN948"></a>                           <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>resultcontext</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN950"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>value</span><span class='Delimiter'>; 
</span><a name="LN951"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set up to return the function value.  For pass-by-reference datatypes, 
     * be sure to allocate the result in resultcontext, not the current memory 
     * context (which has query lifespan).  We can't leave the data in the 
     * TupleTableSlot because we intend to clear the slot before returning. 
     */ 
</span>    <a href="functions.c.html#LN951"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN948"><span class='Ref_to_Parameter'>resultcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN947"><span class='Ref_to_Parameter'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN101"><span class='Ref_to_Member'>returnsTuple</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* We must return the whole tuple as a Datum. */ 
</span>        <a href="functions.c.html#LN946"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/fmgr.h.html#LN82"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Keyword'>value </span><span class='Operator'>= </span><a href="../../include/executor/tuptable.h.html#LN161"><span class='Ref_to_Proto'>ExecFetchSlotTupleDatum</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN945"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Returning a scalar, which we have to extract from the first column 
         * of the SELECT result, and then copy into result context if needed. 
         */ 
</span>        <span class='Keyword'>value </span><span class='Operator'>= </span><a href="../../include/executor/tuptable.h.html#LN167"><span class='Ref_to_Proto'>slot_getattr</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN945"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="functions.c.html#LN946"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/fmgr.h.html#LN82"><span class='Ref_to_Member'>isnull</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="functions.c.html#LN946"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/fmgr.h.html#LN82"><span class='Ref_to_Member'>isnull</span></a><span class='Parentheses'>) 
</span>            <span class='Keyword'>value </span><span class='Operator'>= </span><a href="../../include/utils/datum.h.html#LN30"><span class='Ref_to_Proto'>datumCopy</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><a href="functions.c.html#LN947"><span class='Ref_to_Parameter'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN99"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN947"><span class='Ref_to_Parameter'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN98"><span class='Ref_to_Member'>typlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN951"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Keyword'>value</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end postquel_get_single_result &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * fmgr_sql: function call manager for SQL functions 
 */ 
</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN988"></a><span class='Declare_Function'>fmgr_sql</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN990"></a>    <a href="functions.c.html#LN127"><span class='Ref_to_Typedef'>SQLFunctionCachePtr</span></a> <span class='Declare_Local'>fcache</span><span class='Delimiter'>; 
</span><a name="LN991"></a>    ErrorContextCallback <span class='Declare_Local'>sqlerrcontext</span><span class='Delimiter'>; 
</span><a name="LN992"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN993"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>randomAccess</span><span class='Delimiter'>; 
</span><a name="LN994"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>lazyEvalOK</span><span class='Delimiter'>; 
</span><a name="LN995"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_first</span><span class='Delimiter'>; 
</span><a name="LN996"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>pushed_snapshot</span><span class='Delimiter'>; 
</span><a name="LN997"></a>    <a href="functions.c.html#LN62"><span class='Ref_to_Struct'>execution_state</span></a> <span class='Operator'>*</span><span class='Declare_Local'>es</span><span class='Delimiter'>; 
</span><a name="LN998"></a>    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>slot</span><span class='Delimiter'>; 
</span><a name="LN999"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN1000"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>eslist</span><span class='Delimiter'>; 
</span><a name="LN1001"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>eslc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Setup error traceback support for ereport() 
     */ 
</span>    <a href="functions.c.html#LN991"><span class='Ref_To_Local'>sqlerrcontext</span></a><span class='Operator'>.</span>callback <span class='Operator'>= </span><a href="functions.c.html#LN166"><span class='Ref_to_Proto'>sql_exec_error_callback</span></a><span class='Delimiter'>; 
</span>    <a href="functions.c.html#LN991"><span class='Ref_To_Local'>sqlerrcontext</span></a><span class='Operator'>.</span>arg <span class='Operator'>= </span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Delimiter'>; 
</span>    <a href="functions.c.html#LN991"><span class='Ref_To_Local'>sqlerrcontext</span></a><span class='Operator'>.</span>previous <span class='Operator'>= </span><a href="../utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a><span class='Delimiter'>; 
</span>    <a href="../utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a> <span class='Operator'>= &</span><a href="functions.c.html#LN991"><span class='Ref_To_Local'>sqlerrcontext</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check call context */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_retset<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1014"></a>        <a href="../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rsi</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span>fcinfo<span class='Operator'>-&GT;</span>resultinfo<span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * For simplicity, we require callers to support both set eval modes. 
         * There are cases where we must use one or must use the other, and 
         * it's not really worthwhile to postpone the check till we know. But 
         * note we do not require caller to provide an expectedDesc. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="functions.c.html#LN1014"><span class='Ref_To_Local'>rsi</span></a> <span class='Operator'>|| !</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1014"><span class='Ref_To_Local'>rsi</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>            <span class='Parentheses'>(</span><a href="functions.c.html#LN1014"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN267"><span class='Ref_to_Member'>allowedModes</span></a> <span class='Operator'>& </span><a href="../../include/nodes/execnodes.h.html#LN249"><span class='Ref_to_EnumConst'>SFRM_ValuePerCall</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            <span class='Parentheses'>(</span><a href="functions.c.html#LN1014"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN267"><span class='Ref_to_Member'>allowedModes</span></a> <span class='Operator'>& </span><a href="../../include/nodes/execnodes.h.html#LN250"><span class='Ref_to_EnumConst'>SFRM_Materialize</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"set-valued function called in context that cannot accept a set"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="functions.c.html#LN993"><span class='Ref_To_Local'>randomAccess</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN1014"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN267"><span class='Ref_to_Member'>allowedModes</span></a> <span class='Operator'>& </span><a href="../../include/nodes/execnodes.h.html#LN251"><span class='Ref_to_EnumConst'>SFRM_Materialize_Random</span></a><span class='Delimiter'>; 
</span>        <a href="functions.c.html#LN994"><span class='Ref_To_Local'>lazyEvalOK</span></a> <span class='Operator'>= !</span><span class='Parentheses'>(</span><a href="functions.c.html#LN1014"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN267"><span class='Ref_to_Member'>allowedModes</span></a> <span class='Operator'>& </span><a href="../../include/nodes/execnodes.h.html#LN252"><span class='Ref_to_EnumConst'>SFRM_Materialize_Preferred</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="functions.c.html#LN993"><span class='Ref_To_Local'>randomAccess</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="functions.c.html#LN994"><span class='Ref_To_Local'>lazyEvalOK</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Initialize fcache (build plans) if first time through; or re-initialize 
     * if the cache is stale. 
     */ 
</span>    <a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="functions.c.html#LN127"><span class='Ref_to_Typedef'>SQLFunctionCachePtr</span></a><span class='Parentheses'>) </span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra<span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN123"><span class='Ref_to_Member'>lxid</span></a> <span class='Operator'>!= </span><a href="../storage/lmgr/proc.c.html#LN66"><span class='Ref_to_Global_Var'>MyProc</span></a><span class='Operator'>-&GT;</span><a href="../../include/storage/proc.h.html#LN104"><span class='Ref_to_Member'>lxid</span></a> <span class='Operator'>|| 
</span>            <span class='Operator'>!</span><a href="../../include/access/xact.h.html#LN338"><span class='Ref_to_Proto'>SubTransactionIsActive</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN124"><span class='Ref_to_Member'>subxid</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* It's stale; unlink and delete */ 
</span>            fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN120"><span class='Ref_to_Member'>fcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="functions.c.html#LN156"><span class='Ref_to_Proto'>init_sql_fcache</span></a><span class='Parentheses'>(</span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Delimiter'>, </span><a href="../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="functions.c.html#LN994"><span class='Ref_To_Local'>lazyEvalOK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="functions.c.html#LN127"><span class='Ref_to_Typedef'>SQLFunctionCachePtr</span></a><span class='Parentheses'>) </span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra<span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Switch to context in which the fcache lives.  This ensures that our 
     * tuplestore etc will have sufficient lifetime.  The sub-executor is 
     * responsible for deleting per-tuple information.  (XXX in the case of a 
     * long-lived FmgrInfo, this policy represents more memory leakage, but 
     * it's not entirely clear where to keep stuff instead.) 
     */ 
</span>    <a href="functions.c.html#LN992"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN120"><span class='Ref_to_Member'>fcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Find first unfinished query in function, and note whether it's the 
     * first query. 
     */ 
</span>    <a href="functions.c.html#LN1000"><span class='Ref_To_Local'>eslist</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN118"><span class='Ref_to_Member'>func_state</span></a><span class='Delimiter'>; 
</span>    <a href="functions.c.html#LN997"><span class='Ref_To_Local'>es</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="functions.c.html#LN995"><span class='Ref_To_Local'>is_first</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1001"><span class='Ref_To_Local'>eslc</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN1000"><span class='Ref_To_Local'>eslist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="functions.c.html#LN997"><span class='Ref_To_Local'>es</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="functions.c.html#LN62"><span class='Ref_to_Struct'>execution_state</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1001"><span class='Ref_To_Local'>eslc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN997"><span class='Ref_To_Local'>es</span></a> <span class='Operator'>&& </span><a href="functions.c.html#LN997"><span class='Ref_To_Local'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN65"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>== </span><a href="functions.c.html#LN59"><span class='Ref_to_EnumConst'>F_EXEC_DONE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="functions.c.html#LN995"><span class='Ref_To_Local'>is_first</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="functions.c.html#LN997"><span class='Ref_To_Local'>es</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN997"><span class='Ref_To_Local'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN64"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN997"><span class='Ref_To_Local'>es</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Convert params to appropriate format if starting a fresh execution. (If 
     * continuing execution, we can re-use prior params.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN995"><span class='Ref_To_Local'>is_first</span></a> <span class='Operator'>&& </span><a href="functions.c.html#LN997"><span class='Ref_To_Local'>es</span></a> <span class='Operator'>&& </span><a href="functions.c.html#LN997"><span class='Ref_To_Local'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN65"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>== </span><a href="functions.c.html#LN59"><span class='Ref_to_EnumConst'>F_EXEC_START</span></a><span class='Parentheses'>) 
</span>        <a href="functions.c.html#LN160"><span class='Ref_to_Proto'>postquel_sub_params</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Delimiter'>, </span>fcinfo<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Build tuplestore to hold results, if we don't have one already. Note 
     * it's in the query-lifespan context. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN108"><span class='Ref_to_Member'>tstore</span></a><span class='Parentheses'>) 
</span>        <a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN108"><span class='Ref_to_Member'>tstore</span></a> <span class='Operator'>= </span><a href="../../include/utils/tuplestore.h.html#LN46"><span class='Ref_to_Proto'>tuplestore_begin_heap</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN993"><span class='Ref_To_Local'>randomAccess</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="../utils/init/globals.c.html#LN112"><span class='Ref_to_Global_Var'>work_mem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Execute each command in the function one after another until we either 
     * run out of commands or get a result row from a lazily-evaluated SELECT. 
     * 
     * Notes about snapshot management: 
     * 
     * In a read-only function, we just use the surrounding query's snapshot. 
     * 
     * In a non-read-only function, we rely on the fact that we'll never 
     * suspend execution between queries of the function: the only reason to 
     * suspend execution before completion is if we are returning a row from a 
     * lazily-evaluated SELECT.  So, when first entering this loop, we'll 
     * either start a new query (and push a fresh snapshot) or re-establish 
     * the active snapshot from the existing query descriptor.  If we need to 
     * start a new query in a subsequent execution of the loop, either we need 
     * a fresh snapshot (and pushed_snapshot is false) or the existing 
     * snapshot is on the active stack and we can just bump its command ID. 
     */ 
</span>    <a href="functions.c.html#LN996"><span class='Ref_To_Local'>pushed_snapshot</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN997"><span class='Ref_To_Local'>es</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1126"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>completed</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN997"><span class='Ref_To_Local'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN65"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>== </span><a href="functions.c.html#LN59"><span class='Ref_to_EnumConst'>F_EXEC_START</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * If not read-only, be sure to advance the command counter for 
             * each command, so that all work to date in this transaction is 
             * visible.  Take a new snapshot if we don't have one yet, 
             * otherwise just bump the command ID in the existing snapshot. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN103"><span class='Ref_to_Member'>readonly_func</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="functions.c.html#LN996"><span class='Ref_To_Local'>pushed_snapshot</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../include/utils/snapmgr.h.html#LN73"><span class='Ref_to_Proto'>PushActiveSnapshot</span></a><span class='Parentheses'>(</span><a href="../../include/utils/snapmgr.h.html#LN63"><span class='Ref_to_Proto'>GetTransactionSnapshot</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>                    <a href="functions.c.html#LN996"><span class='Ref_To_Local'>pushed_snapshot</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                    <a href="../../include/utils/snapmgr.h.html#LN75"><span class='Ref_to_Proto'>UpdateActiveSnapshotCommandId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="functions.c.html#LN157"><span class='Ref_to_Proto'>postquel_start</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN997"><span class='Ref_To_Local'>es</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if es-&GT;status==F_EXEC_ST... &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN103"><span class='Ref_to_Member'>readonly_func</span></a> <span class='Operator'>&& !</span><a href="functions.c.html#LN996"><span class='Ref_To_Local'>pushed_snapshot</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Re-establish active snapshot when re-entering function */ 
</span>            <a href="../../include/utils/snapmgr.h.html#LN73"><span class='Ref_to_Proto'>PushActiveSnapshot</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN997"><span class='Ref_To_Local'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN69"><span class='Ref_to_Member'>qd</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN38"><span class='Ref_to_Member'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="functions.c.html#LN996"><span class='Ref_To_Local'>pushed_snapshot</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="functions.c.html#LN1126"><span class='Ref_To_Local'>completed</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN158"><span class='Ref_to_Proto'>postquel_getnext</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN997"><span class='Ref_To_Local'>es</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If we ran the command to completion, we can shut it down now. Any 
         * row(s) we need to return are safely stashed in the tuplestore, and 
         * we want to be sure that, for example, AFTER triggers get fired 
         * before we return anything.  Also, if the function doesn't return 
         * set, we can shut it down anyway because it must be a SELECT and we 
         * don't care about fetching any more result rows. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1126"><span class='Ref_To_Local'>completed</span></a> <span class='Operator'>|| !</span><a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN100"><span class='Ref_to_Member'>returnsSet</span></a><span class='Parentheses'>) 
</span>            <a href="functions.c.html#LN159"><span class='Ref_to_Proto'>postquel_end</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN997"><span class='Ref_To_Local'>es</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Break from loop if we didn't shut down (implying we got a 
         * lazily-evaluated row).  Otherwise we'll press on till the whole 
         * function is done, relying on the tuplestore to keep hold of the 
         * data to eventually be returned.  This is necessary since an 
         * INSERT/UPDATE/DELETE RETURNING that sets the result might be 
         * followed by additional rule-inserted commands, and we want to 
         * finish doing all those commands before we return anything. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN997"><span class='Ref_To_Local'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN65"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>!= </span><a href="functions.c.html#LN59"><span class='Ref_to_EnumConst'>F_EXEC_DONE</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Advance to next execution_state, which might be in the next list. 
         */ 
</span>        <a href="functions.c.html#LN997"><span class='Ref_To_Local'>es</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN997"><span class='Ref_To_Local'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN64"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="functions.c.html#LN997"><span class='Ref_To_Local'>es</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="functions.c.html#LN1001"><span class='Ref_To_Local'>eslc</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1001"><span class='Ref_To_Local'>eslc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="functions.c.html#LN1001"><span class='Ref_To_Local'>eslc</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* end of function */ 
</span> 
            <a href="functions.c.html#LN997"><span class='Ref_To_Local'>es</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="functions.c.html#LN62"><span class='Ref_to_Struct'>execution_state</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1001"><span class='Ref_To_Local'>eslc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Flush the current snapshot so that we will take a new one for 
             * the new query list.  This ensures that new snaps are taken at 
             * original-query boundaries, matching the behavior of interactive 
             * execution. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN996"><span class='Ref_To_Local'>pushed_snapshot</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../include/utils/snapmgr.h.html#LN76"><span class='Ref_to_Proto'>PopActiveSnapshot</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                <a href="functions.c.html#LN996"><span class='Ref_To_Local'>pushed_snapshot</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while !es &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while es &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * The tuplestore now contains whatever row(s) we are supposed to return. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN100"><span class='Ref_to_Member'>returnsSet</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1213"></a>        <a href="../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rsi</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span>fcinfo<span class='Operator'>-&GT;</span>resultinfo<span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN997"><span class='Ref_To_Local'>es</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * If we stopped short of being done, we must have a lazy-eval 
             * row. 
             */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="functions.c.html#LN997"><span class='Ref_To_Local'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN67"><span class='Ref_to_Member'>lazyEval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Re-use the junkfilter's output slot to fetch back the tuple */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN110"><span class='Ref_to_Member'>junkFilter</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="functions.c.html#LN998"><span class='Ref_To_Local'>slot</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN110"><span class='Ref_to_Member'>junkFilter</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN334"><span class='Ref_to_Member'>jf_resultSlot</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/tuplestore.h.html#LN72"><span class='Ref_to_Proto'>tuplestore_gettupleslot</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN108"><span class='Ref_to_Member'>tstore</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="functions.c.html#LN998"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>))</span> 
                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"failed to fetch lazy-eval tuple"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Extract the result as a datum, and copy out from the slot */ 
</span>            <a href="functions.c.html#LN999"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN162"><span class='Ref_to_Proto'>postquel_get_single_result</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN998"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>, </span>fcinfo<span class='Delimiter'>, 
</span>                                                <a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN992"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Clear the tuplestore, but keep it for next time */ 
</span>            <span class='Comment_Multi_Line'>/* NB: this might delete the slot's content, but we don't care */ 
</span>            <a href="../../include/utils/tuplestore.h.html#LN86"><span class='Ref_to_Proto'>tuplestore_clear</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN108"><span class='Ref_to_Member'>tstore</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Let caller know we're not finished. 
             */ 
</span>            <a href="functions.c.html#LN1213"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN270"><span class='Ref_to_Member'>isDone</span></a> <span class='Operator'>= </span><a href="../../include/nodes/execnodes.h.html#LN237"><span class='Ref_to_EnumConst'>ExprMultipleResult</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Ensure we will get shut down cleanly if the exprcontext is not 
             * run to completion. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN102"><span class='Ref_to_Member'>shutdown_reg</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../include/executor/executor.h.html#LN487"><span class='Ref_to_Proto'>RegisterExprContextCallback</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1213"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN265"><span class='Ref_to_Member'>econtext</span></a><span class='Delimiter'>, 
</span>                                            <a href="functions.c.html#LN167"><span class='Ref_to_Proto'>ShutdownSQLFunction</span></a><span class='Delimiter'>, 
</span>                                            <a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN102"><span class='Ref_to_Member'>shutdown_reg</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if es &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN104"><span class='Ref_to_Member'>lazyEval</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * We are done with a lazy evaluation.  Clean up. 
             */ 
</span>            <a href="../../include/utils/tuplestore.h.html#LN86"><span class='Ref_to_Proto'>tuplestore_clear</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN108"><span class='Ref_to_Member'>tstore</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Let caller know we're finished. 
             */ 
</span>            <a href="functions.c.html#LN1213"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN270"><span class='Ref_to_Member'>isDone</span></a> <span class='Operator'>= </span><a href="../../include/nodes/execnodes.h.html#LN238"><span class='Ref_to_EnumConst'>ExprEndResult</span></a><span class='Delimiter'>; 
</span> 
            fcinfo<span class='Operator'>-&GT;</span>isnull <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="functions.c.html#LN999"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Deregister shutdown callback, if we made one */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN102"><span class='Ref_to_Member'>shutdown_reg</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../include/executor/executor.h.html#LN490"><span class='Ref_to_Proto'>UnregisterExprContextCallback</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1213"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN265"><span class='Ref_to_Member'>econtext</span></a><span class='Delimiter'>, 
</span>                                              <a href="functions.c.html#LN167"><span class='Ref_to_Proto'>ShutdownSQLFunction</span></a><span class='Delimiter'>, 
</span>                                              <a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN102"><span class='Ref_to_Member'>shutdown_reg</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if fcache-&GT;lazyEval &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * We are done with a non-lazy evaluation.  Return whatever is in 
             * the tuplestore.  (It is now caller's responsibility to free the 
             * tuplestore when done.) 
             */ 
</span>            <a href="functions.c.html#LN1213"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN269"><span class='Ref_to_Member'>returnMode</span></a> <span class='Operator'>= </span><a href="../../include/nodes/execnodes.h.html#LN250"><span class='Ref_to_EnumConst'>SFRM_Materialize</span></a><span class='Delimiter'>; 
</span>            <a href="functions.c.html#LN1213"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN272"><span class='Ref_to_Member'>setResult</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN108"><span class='Ref_to_Member'>tstore</span></a><span class='Delimiter'>; 
</span>            <a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN108"><span class='Ref_to_Member'>tstore</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* must copy desc because execSRF.c will free it */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN110"><span class='Ref_to_Member'>junkFilter</span></a><span class='Parentheses'>) 
</span>                <a href="functions.c.html#LN1213"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN273"><span class='Ref_to_Member'>setDesc</span></a> <span class='Operator'>= </span><a href="../../include/access/tupdesc.h.html#LN88"><span class='Ref_to_Proto'>CreateTupleDescCopy</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN110"><span class='Ref_to_Member'>junkFilter</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN332"><span class='Ref_to_Member'>jf_cleanTupType</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            fcinfo<span class='Operator'>-&GT;</span>isnull <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="functions.c.html#LN999"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Deregister shutdown callback, if we made one */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN102"><span class='Ref_to_Member'>shutdown_reg</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../include/executor/executor.h.html#LN490"><span class='Ref_to_Proto'>UnregisterExprContextCallback</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1213"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN265"><span class='Ref_to_Member'>econtext</span></a><span class='Delimiter'>, 
</span>                                              <a href="functions.c.html#LN167"><span class='Ref_to_Proto'>ShutdownSQLFunction</span></a><span class='Delimiter'>, 
</span>                                              <a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN102"><span class='Ref_to_Member'>shutdown_reg</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if fcache-&GT;returnsSet &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Non-set function.  If we got a row, return it; else return NULL. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN110"><span class='Ref_to_Member'>junkFilter</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Re-use the junkfilter's output slot to fetch back the tuple */ 
</span>            <a href="functions.c.html#LN998"><span class='Ref_To_Local'>slot</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN110"><span class='Ref_to_Member'>junkFilter</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN334"><span class='Ref_to_Member'>jf_resultSlot</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/tuplestore.h.html#LN72"><span class='Ref_to_Proto'>tuplestore_gettupleslot</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN108"><span class='Ref_to_Member'>tstore</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="functions.c.html#LN998"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>))</span> 
                <a href="functions.c.html#LN999"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN162"><span class='Ref_to_Proto'>postquel_get_single_result</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN998"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>, </span>fcinfo<span class='Delimiter'>, 
</span>                                                    <a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN992"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                fcinfo<span class='Operator'>-&GT;</span>isnull <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="functions.c.html#LN999"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Should only get here for VOID functions */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN97"><span class='Ref_to_Member'>rettype</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN689"><span class='Ref_to_Const'>VOIDOID</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            fcinfo<span class='Operator'>-&GT;</span>isnull <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="functions.c.html#LN999"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Clear the tuplestore, but keep it for next time */ 
</span>        <a href="../../include/utils/tuplestore.h.html#LN86"><span class='Ref_to_Proto'>tuplestore_clear</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN108"><span class='Ref_to_Member'>tstore</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Pop snapshot if we have pushed one */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN996"><span class='Ref_To_Local'>pushed_snapshot</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/snapmgr.h.html#LN76"><span class='Ref_to_Proto'>PopActiveSnapshot</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we've gone through every command in the function, we are done. Reset 
     * the execution states to start over again on next call. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN997"><span class='Ref_To_Local'>es</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1001"><span class='Ref_To_Local'>eslc</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN990"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN118"><span class='Ref_to_Member'>func_state</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="functions.c.html#LN997"><span class='Ref_To_Local'>es</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="functions.c.html#LN62"><span class='Ref_to_Struct'>execution_state</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1001"><span class='Ref_To_Local'>eslc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN997"><span class='Ref_To_Local'>es</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="functions.c.html#LN997"><span class='Ref_To_Local'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN65"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN59"><span class='Ref_to_EnumConst'>F_EXEC_START</span></a><span class='Delimiter'>; 
</span>                <a href="functions.c.html#LN997"><span class='Ref_To_Local'>es</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN997"><span class='Ref_To_Local'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN64"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN991"><span class='Ref_To_Local'>sqlerrcontext</span></a><span class='Operator'>.</span>previous<span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN992"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="functions.c.html#LN999"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end fmgr_sql &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * error context callback to let us supply a call-stack traceback 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1365"></a><span class='Declare_Function'>sql_exec_error_callback</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1367"></a>    <a href="../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>flinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="functions.c.html#LN1365"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>; 
</span><a name="LN1368"></a>    <a href="functions.c.html#LN127"><span class='Ref_to_Typedef'>SQLFunctionCachePtr</span></a> <span class='Declare_Local'>fcache</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="functions.c.html#LN127"><span class='Ref_to_Typedef'>SQLFunctionCachePtr</span></a><span class='Parentheses'>) </span><a href="functions.c.html#LN1367"><span class='Ref_To_Local'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/fmgr.h.html#LN63"><span class='Ref_to_Member'>fn_extra</span></a><span class='Delimiter'>; 
</span><a name="LN1369"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>syntaxerrposition</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We can do nothing useful if init_sql_fcache() didn't get as far as 
     * saving the function name 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1368"><span class='Ref_To_Local'>fcache</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="functions.c.html#LN1368"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN92"><span class='Ref_to_Member'>fname</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If there is a syntax error position, convert to internal syntax error 
     */ 
</span>    <a href="functions.c.html#LN1369"><span class='Ref_To_Local'>syntaxerrposition</span></a> <span class='Operator'>= </span><a href="../utils/error/elog.c.html#LN1255"><span class='Ref_to_Func'>geterrposition</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1369"><span class='Ref_To_Local'>syntaxerrposition</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="functions.c.html#LN1368"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN93"><span class='Ref_to_Member'>src</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../utils/error/elog.c.html#LN1123"><span class='Ref_to_Func'>errposition</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../utils/error/elog.c.html#LN1139"><span class='Ref_to_Func'>internalerrposition</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1369"><span class='Ref_To_Local'>syntaxerrposition</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../utils/error/elog.c.html#LN1159"><span class='Ref_to_Func'>internalerrquery</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1368"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN93"><span class='Ref_to_Member'>src</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Try to determine where in the function we failed.  If there is a query 
     * with non-null QueryDesc, finger it.  (We check this rather than looking 
     * for F_EXEC_RUN state, so that errors during ExecutorStart or 
     * ExecutorEnd are blamed on the appropriate query; see postquel_start and 
     * postquel_end.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1368"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN118"><span class='Ref_to_Member'>func_state</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1398"></a>        <a href="functions.c.html#LN62"><span class='Ref_to_Struct'>execution_state</span></a> <span class='Operator'>*</span><span class='Declare_Local'>es</span><span class='Delimiter'>; 
</span><a name="LN1399"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>query_num</span><span class='Delimiter'>; 
</span><a name="LN1400"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
        <a href="functions.c.html#LN1398"><span class='Ref_To_Local'>es</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="functions.c.html#LN1399"><span class='Ref_To_Local'>query_num</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1400"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN1368"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN118"><span class='Ref_to_Member'>func_state</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="functions.c.html#LN1398"><span class='Ref_To_Local'>es</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="functions.c.html#LN62"><span class='Ref_to_Struct'>execution_state</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1400"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1398"><span class='Ref_To_Local'>es</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1398"><span class='Ref_To_Local'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN69"><span class='Ref_to_Member'>qd</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    errcontext<span class='Parentheses'>(</span><span class='String'>"SQL function \"%s\" statement %d"</span><span class='Delimiter'>, 
</span>                               <a href="functions.c.html#LN1368"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN92"><span class='Ref_to_Member'>fname</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN1399"><span class='Ref_To_Local'>query_num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="functions.c.html#LN1398"><span class='Ref_To_Local'>es</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN1398"><span class='Ref_To_Local'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN64"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1398"><span class='Ref_To_Local'>es</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <a href="functions.c.html#LN1399"><span class='Ref_To_Local'>query_num</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1398"><span class='Ref_To_Local'>es</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * couldn't identify a running query; might be function entry, 
             * function exit, or between queries. 
             */ 
</span>            errcontext<span class='Parentheses'>(</span><span class='String'>"SQL function \"%s\""</span><span class='Delimiter'>, </span><a href="functions.c.html#LN1368"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN92"><span class='Ref_to_Member'>fname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if fcache-&GT;func_state &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Assume we failed during init_sql_fcache().  (It's possible that the 
         * function actually has an empty body, but in that case we may as 
         * well report all errors as being "during startup".) 
         */ 
</span>        errcontext<span class='Parentheses'>(</span><span class='String'>"SQL function \"%s\" during startup"</span><span class='Delimiter'>, </span><a href="functions.c.html#LN1368"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN92"><span class='Ref_to_Member'>fname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end sql_exec_error_callback &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * callback function in case a function-returning-set needs to be shut down 
 * before it has been run to completion 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1447"></a><span class='Declare_Function'>ShutdownSQLFunction</span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1449"></a>    <a href="functions.c.html#LN127"><span class='Ref_to_Typedef'>SQLFunctionCachePtr</span></a> <span class='Declare_Local'>fcache</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="functions.c.html#LN127"><span class='Ref_to_Typedef'>SQLFunctionCachePtr</span></a><span class='Parentheses'>) </span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1447"><span class='Ref_to_Parameter'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1450"></a>    <a href="functions.c.html#LN62"><span class='Ref_to_Struct'>execution_state</span></a> <span class='Operator'>*</span><span class='Declare_Local'>es</span><span class='Delimiter'>; 
</span><a name="LN1451"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1451"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN1449"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN118"><span class='Ref_to_Member'>func_state</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="functions.c.html#LN1450"><span class='Ref_To_Local'>es</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="functions.c.html#LN62"><span class='Ref_to_Struct'>execution_state</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1451"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1450"><span class='Ref_To_Local'>es</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Shut down anything still running */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1450"><span class='Ref_To_Local'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN65"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>== </span><a href="functions.c.html#LN59"><span class='Ref_to_EnumConst'>F_EXEC_RUN</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Re-establish active snapshot for any called functions */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="functions.c.html#LN1449"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN103"><span class='Ref_to_Member'>readonly_func</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/snapmgr.h.html#LN73"><span class='Ref_to_Proto'>PushActiveSnapshot</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1450"><span class='Ref_To_Local'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN69"><span class='Ref_to_Member'>qd</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN38"><span class='Ref_to_Member'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="functions.c.html#LN159"><span class='Ref_to_Proto'>postquel_end</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1450"><span class='Ref_To_Local'>es</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="functions.c.html#LN1449"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN103"><span class='Ref_to_Member'>readonly_func</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/snapmgr.h.html#LN76"><span class='Ref_to_Proto'>PopActiveSnapshot</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* Reset states to START in case we're called again */ 
</span>            <a href="functions.c.html#LN1450"><span class='Ref_To_Local'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN65"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN59"><span class='Ref_to_EnumConst'>F_EXEC_START</span></a><span class='Delimiter'>; 
</span>            <a href="functions.c.html#LN1450"><span class='Ref_To_Local'>es</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN1450"><span class='Ref_To_Local'>es</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN64"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Release tuplestore if we have one */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1449"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN108"><span class='Ref_to_Member'>tstore</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/tuplestore.h.html#LN88"><span class='Ref_to_Proto'>tuplestore_end</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1449"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN108"><span class='Ref_to_Member'>tstore</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="functions.c.html#LN1449"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN108"><span class='Ref_to_Member'>tstore</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* execUtils will deregister the callback... */ 
</span>    <a href="functions.c.html#LN1449"><span class='Ref_To_Local'>fcache</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN102"><span class='Ref_to_Member'>shutdown_reg</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ShutdownSQLFunction &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * check_sql_fn_retval() -- check return value of a list of sql parse trees. 
 * 
 * The return value of a sql function is the value returned by the last 
 * canSetTag query in the function.  We do some ad-hoc type checking here 
 * to be sure that the user is returning the type he claims.  There are 
 * also a couple of strange-looking features to assist callers in dealing 
 * with allowed special cases, such as binary-compatible result types. 
 * 
 * For a polymorphic function the passed rettype must be the actual resolved 
 * output type of the function; we should never see a polymorphic pseudotype 
 * such as ANYELEMENT as rettype.  (This means we can't check the type during 
 * function definition of a polymorphic function.) 
 * 
 * This function returns true if the sql function returns the entire tuple 
 * result of its final statement, or false if it returns just the first column 
 * result of that statement.  It throws an error if the final statement doesn't 
 * return the right type at all. 
 * 
 * Note that because we allow "SELECT rowtype_expression", the result can be 
 * false even when the declared function return type is a rowtype. 
 * 
 * If modifyTargetList isn't NULL, the function will modify the final 
 * statement's targetlist in two cases: 
 * (1) if the tlist returns values that are binary-coercible to the expected 
 * type rather than being exactly the expected type.  RelabelType nodes will 
 * be inserted to make the result types match exactly. 
 * (2) if there are dropped columns in the declared result rowtype.  NULL 
 * output columns will be inserted in the tlist to match them. 
 * (Obviously the caller must pass a parsetree that is okay to modify when 
 * using this flag.)  Note that this flag does not affect whether the tlist is 
 * considered to be a legal match to the result type, only how we react to 
 * allowed not-exact-match cases.  *modifyTargetList will be set true iff 
 * we had to make any "dangerous" changes that could modify the semantics of 
 * the statement.  If it is set true, the caller should not use the modified 
 * statement, but for simplicity we apply the changes anyway. 
 * 
 * If junkFilter isn't NULL, then *junkFilter is set to a JunkFilter defined 
 * to convert the function's tuple result to the correct output tuple type. 
 * Exception: if the function is defined to return VOID then *junkFilter is 
 * set to NULL. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN1530"></a><span class='Declare_Function'>check_sql_fn_retval</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>func_id</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>rettype</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>queryTreeList</span><span class='Delimiter'>, 
</span><a name="LN1531"></a>                    <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>modifyTargetList</span><span class='Delimiter'>, 
</span><a name="LN1532"></a>                    <a href="../../include/nodes/execnodes.h.html#LN328"><span class='Ref_to_Struct'>JunkFilter</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>junkFilter</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1534"></a>    <a href="../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>parse</span><span class='Delimiter'>; 
</span><a name="LN1535"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>      <span class='Operator'>**</span><span class='Declare_Local'>tlist_ptr</span><span class='Delimiter'>; 
</span><a name="LN1536"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tlist</span><span class='Delimiter'>; 
</span><a name="LN1537"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>tlistlen</span><span class='Delimiter'>; 
</span><a name="LN1538"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>fn_typtype</span><span class='Delimiter'>; 
</span><a name="LN1539"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>restype</span><span class='Delimiter'>; 
</span><a name="LN1540"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/c.h.html#LN676"><span class='Ref_to_Macro'>AssertArg</span></a><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/catalog/pg_type.h.html#LN744"><span class='Ref_to_Macro'>IsPolymorphicType</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1530"><span class='Ref_to_Parameter'>rettype</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1531"><span class='Ref_to_Parameter'>modifyTargetList</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="functions.c.html#LN1531"><span class='Ref_to_Parameter'>modifyTargetList</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* initialize for no change */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1532"><span class='Ref_to_Parameter'>junkFilter</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="functions.c.html#LN1532"><span class='Ref_to_Parameter'>junkFilter</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* initialize in case of VOID result */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Find the last canSetTag query in the list.  This isn't necessarily the 
     * last parsetree, because rule rewriting can insert queries after what 
     * the user wrote. 
     */ 
</span>    <a href="functions.c.html#LN1534"><span class='Ref_To_Local'>parse</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1540"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN1530"><span class='Ref_to_Parameter'>queryTreeList</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1557"></a>        <a href="../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>q</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN1540"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1557"><span class='Ref_To_Local'>q</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN115"><span class='Ref_to_Member'>canSetTag</span></a><span class='Parentheses'>) 
</span>            <a href="functions.c.html#LN1534"><span class='Ref_To_Local'>parse</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN1557"><span class='Ref_To_Local'>q</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If it's a plain SELECT, it returns whatever the targetlist says. 
     * Otherwise, if it's INSERT/UPDATE/DELETE with RETURNING, it returns 
     * that. Otherwise, the function return type must be VOID. 
     * 
     * Note: eventually replace this test with QueryReturnsTuples?  We'd need 
     * a more general method of determining the output type, though.  Also, it 
     * seems too dangerous to consider FETCH or EXECUTE as returning a 
     * determinable rowtype, since they depend on relatively short-lived 
     * entities. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1534"><span class='Ref_To_Local'>parse</span></a> <span class='Operator'>&& 
</span>        <a href="functions.c.html#LN1534"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN109"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN650"><span class='Ref_to_EnumConst'>CMD_SELECT</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="functions.c.html#LN1535"><span class='Ref_To_Local'>tlist_ptr</span></a> <span class='Operator'>= &</span><a href="functions.c.html#LN1534"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN137"><span class='Ref_to_Member'>targetList</span></a><span class='Delimiter'>; 
</span>        <a href="functions.c.html#LN1536"><span class='Ref_To_Local'>tlist</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN1534"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN137"><span class='Ref_to_Member'>targetList</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1534"><span class='Ref_To_Local'>parse</span></a> <span class='Operator'>&& 
</span>             <span class='Parentheses'>(</span><a href="functions.c.html#LN1534"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN109"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN652"><span class='Ref_to_EnumConst'>CMD_INSERT</span></a> <span class='Operator'>|| 
</span>              <a href="functions.c.html#LN1534"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN109"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN651"><span class='Ref_to_EnumConst'>CMD_UPDATE</span></a> <span class='Operator'>|| 
</span>              <a href="functions.c.html#LN1534"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN109"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN653"><span class='Ref_to_EnumConst'>CMD_DELETE</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>             <a href="functions.c.html#LN1534"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN143"><span class='Ref_to_Member'>returningList</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="functions.c.html#LN1535"><span class='Ref_To_Local'>tlist_ptr</span></a> <span class='Operator'>= &</span><a href="functions.c.html#LN1534"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN143"><span class='Ref_to_Member'>returningList</span></a><span class='Delimiter'>; 
</span>        <a href="functions.c.html#LN1536"><span class='Ref_To_Local'>tlist</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN1534"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN143"><span class='Ref_to_Member'>returningList</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Empty function body, or last statement is a utility command */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1530"><span class='Ref_to_Parameter'>rettype</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_type.h.html#LN689"><span class='Ref_to_Const'>VOIDOID</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_FUNCTION_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"return type mismatch in function declared to return %s"</span><span class='Delimiter'>, 
</span>                    <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1530"><span class='Ref_to_Parameter'>rettype</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Function's final statement must be SELECT or INSERT/UPDATE/DELETE RETURNING."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * OK, check that the targetlist returns something matching the declared 
     * type.  (We used to insist that the declared type not be VOID in this 
     * case, but that makes it hard to write a void function that exits after 
     * calling another void function.  Instead, we insist that the tlist 
     * return void ... so void is treated as if it were a scalar type below.) 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Count the non-junk entries in the result targetlist. 
     */ 
</span>    <a href="functions.c.html#LN1537"><span class='Ref_To_Local'>tlistlen</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN502"><span class='Ref_to_Proto'>ExecCleanTargetListLength</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1536"><span class='Ref_To_Local'>tlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="functions.c.html#LN1538"><span class='Ref_To_Local'>fn_typtype</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN149"><span class='Ref_to_Proto'>get_typtype</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1530"><span class='Ref_to_Parameter'>rettype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1538"><span class='Ref_To_Local'>fn_typtype</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN719"><span class='Ref_to_Const'>TYPTYPE_BASE</span></a> <span class='Operator'>|| 
</span>        <a href="functions.c.html#LN1538"><span class='Ref_To_Local'>fn_typtype</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN721"><span class='Ref_to_Const'>TYPTYPE_DOMAIN</span></a> <span class='Operator'>|| 
</span>        <a href="functions.c.html#LN1538"><span class='Ref_To_Local'>fn_typtype</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN722"><span class='Ref_to_Const'>TYPTYPE_ENUM</span></a> <span class='Operator'>|| 
</span>        <a href="functions.c.html#LN1538"><span class='Ref_To_Local'>fn_typtype</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN724"><span class='Ref_to_Const'>TYPTYPE_RANGE</span></a> <span class='Operator'>|| 
</span>        <a href="functions.c.html#LN1530"><span class='Ref_to_Parameter'>rettype</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN689"><span class='Ref_to_Const'>VOIDOID</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * For scalar-type returns, the target list must have exactly one 
         * non-junk entry, and its type must agree with what the user 
         * declared; except we allow binary-compatible types too. 
         */ 
</span><a name="LN1627"></a>        <a href="../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tle</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1537"><span class='Ref_To_Local'>tlistlen</span></a> <span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_FUNCTION_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"return type mismatch in function declared to return %s"</span><span class='Delimiter'>, 
</span>                    <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1530"><span class='Ref_to_Parameter'>rettype</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>              <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Final statement must return exactly one column."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* We assume here that non-junk TLEs must come first in tlists */ 
</span>        <a href="functions.c.html#LN1627"><span class='Ref_To_Local'>tle</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1536"><span class='Ref_To_Local'>tlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="functions.c.html#LN1627"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1373"><span class='Ref_to_Member'>resjunk</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="functions.c.html#LN1539"><span class='Ref_To_Local'>restype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="functions.c.html#LN1627"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/parser/parse_coerce.h.html#LN33"><span class='Ref_to_Proto'>IsBinaryCoercible</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1539"><span class='Ref_To_Local'>restype</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN1530"><span class='Ref_to_Parameter'>rettype</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_FUNCTION_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"return type mismatch in function declared to return %s"</span><span class='Delimiter'>, 
</span>                    <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1530"><span class='Ref_to_Parameter'>rettype</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Actual return type is %s."</span><span class='Delimiter'>, 
</span>                               <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1539"><span class='Ref_To_Local'>restype</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1531"><span class='Ref_to_Parameter'>modifyTargetList</span></a> <span class='Operator'>&& </span><a href="functions.c.html#LN1539"><span class='Ref_To_Local'>restype</span></a> <span class='Operator'>!= </span><a href="functions.c.html#LN1530"><span class='Ref_to_Parameter'>rettype</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="functions.c.html#LN1627"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/makefuncs.h.html#LN65"><span class='Ref_to_Proto'>makeRelabelType</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1627"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>, 
</span>                                                 <a href="functions.c.html#LN1530"><span class='Ref_to_Parameter'>rettype</span></a><span class='Delimiter'>, 
</span>                                                 <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                                 <a href="../../include/utils/lsyscache.h.html#LN166"><span class='Ref_to_Proto'>get_typcollation</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1530"><span class='Ref_to_Parameter'>rettype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                 <a href="../../include/nodes/primnodes.h.html#LN438"><span class='Ref_to_EnumConst'>COERCE_IMPLICIT_CAST</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Relabel is dangerous if TLE is a sort/group or setop column */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1627"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1369"><span class='Ref_to_Member'>ressortgroupref</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="functions.c.html#LN1534"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN162"><span class='Ref_to_Member'>setOperations</span></a><span class='Parentheses'>) 
</span>                <span class='Operator'>*</span><a href="functions.c.html#LN1531"><span class='Ref_to_Parameter'>modifyTargetList</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Set up junk filter if needed */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1532"><span class='Ref_to_Parameter'>junkFilter</span></a><span class='Parentheses'>) 
</span>            <span class='Operator'>*</span><a href="functions.c.html#LN1532"><span class='Ref_to_Parameter'>junkFilter</span></a> <span class='Operator'>= </span><a href="execJunk.c.html#LN59"><span class='Ref_to_Func'>ExecInitJunkFilter</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1536"><span class='Ref_To_Local'>tlist</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if fn_typtype==TYPTYPE_B... &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1538"><span class='Ref_To_Local'>fn_typtype</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN720"><span class='Ref_to_Const'>TYPTYPE_COMPOSITE</span></a> <span class='Operator'>|| </span><a href="functions.c.html#LN1530"><span class='Ref_to_Parameter'>rettype</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN679"><span class='Ref_to_Const'>RECORDOID</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Returns a rowtype */ 
</span><a name="LN1667"></a>        <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span><span class='Delimiter'>; 
</span><a name="LN1668"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>tupnatts</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* physical number of columns in tuple */ 
</span><a name="LN1669"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>tuplogcols</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* # of nondeleted columns in tuple */ 
</span><a name="LN1670"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>colindex</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* physical column index */ 
</span><a name="LN1671"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>newtlist</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* new non-junk tlist entries */ 
</span><a name="LN1672"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>junkattrs</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* new junk tlist entries */ 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If the target list is of length 1, and the type of the varnode in 
         * the target list matches the declared return type, this is okay. 
         * This can happen, for example, where the body of the function is 
         * 'SELECT func2()', where func2 has the same composite return type as 
         * the function that's calling it. 
         * 
         * XXX Note that if rettype is RECORD, the IsBinaryCoercible check 
         * will succeed for any composite restype.  For the moment we rely on 
         * runtime type checking to catch any discrepancy, but it'd be nice to 
         * do better at parse time. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1537"><span class='Ref_To_Local'>tlistlen</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1688"></a>            <a href="../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tle</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1536"><span class='Ref_To_Local'>tlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="functions.c.html#LN1688"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1373"><span class='Ref_to_Member'>resjunk</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="functions.c.html#LN1539"><span class='Ref_To_Local'>restype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="functions.c.html#LN1688"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/parser/parse_coerce.h.html#LN33"><span class='Ref_to_Proto'>IsBinaryCoercible</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1539"><span class='Ref_To_Local'>restype</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN1530"><span class='Ref_to_Parameter'>rettype</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1531"><span class='Ref_to_Parameter'>modifyTargetList</span></a> <span class='Operator'>&& </span><a href="functions.c.html#LN1539"><span class='Ref_To_Local'>restype</span></a> <span class='Operator'>!= </span><a href="functions.c.html#LN1530"><span class='Ref_to_Parameter'>rettype</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="functions.c.html#LN1688"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/makefuncs.h.html#LN65"><span class='Ref_to_Proto'>makeRelabelType</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1688"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>, 
</span>                                                         <a href="functions.c.html#LN1530"><span class='Ref_to_Parameter'>rettype</span></a><span class='Delimiter'>, 
</span>                                                         <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                                   <a href="../../include/utils/lsyscache.h.html#LN166"><span class='Ref_to_Proto'>get_typcollation</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1530"><span class='Ref_to_Parameter'>rettype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                       <a href="../../include/nodes/primnodes.h.html#LN438"><span class='Ref_to_EnumConst'>COERCE_IMPLICIT_CAST</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* Relabel is dangerous if sort/group or setop column */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1688"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1369"><span class='Ref_to_Member'>ressortgroupref</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="functions.c.html#LN1534"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN162"><span class='Ref_to_Member'>setOperations</span></a><span class='Parentheses'>) 
</span>                        <span class='Operator'>*</span><a href="functions.c.html#LN1531"><span class='Ref_to_Parameter'>modifyTargetList</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Comment_Multi_Line'>/* Set up junk filter if needed */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1532"><span class='Ref_to_Parameter'>junkFilter</span></a><span class='Parentheses'>) 
</span>                    <span class='Operator'>*</span><a href="functions.c.html#LN1532"><span class='Ref_to_Parameter'>junkFilter</span></a> <span class='Operator'>= </span><a href="execJunk.c.html#LN59"><span class='Ref_to_Func'>ExecInitJunkFilter</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1536"><span class='Ref_To_Local'>tlist</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* NOT returning whole tuple */ 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if tlistlen==1 &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* Is the rowtype fixed, or determined only at runtime? */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/funcapi.h.html#LN163"><span class='Ref_to_Proto'>get_func_result_type</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1530"><span class='Ref_to_Parameter'>func_id</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="functions.c.html#LN1667"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../include/funcapi.h.html#LN152"><span class='Ref_to_EnumConst'>TYPEFUNC_COMPOSITE</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Assume we are returning the whole tuple. Crosschecking against 
             * what the caller expects will happen at runtime. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1532"><span class='Ref_to_Parameter'>junkFilter</span></a><span class='Parentheses'>) 
</span>                <span class='Operator'>*</span><a href="functions.c.html#LN1532"><span class='Ref_to_Parameter'>junkFilter</span></a> <span class='Operator'>= </span><a href="execJunk.c.html#LN59"><span class='Ref_to_Func'>ExecInitJunkFilter</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1536"><span class='Ref_To_Local'>tlist</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="functions.c.html#LN1667"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Verify that the targetlist matches the return tuple type. We scan 
         * the non-deleted attributes to ensure that they match the datatypes 
         * of the non-resjunk columns.  For deleted attributes, insert NULL 
         * result columns if the caller asked for that. 
         */ 
</span>        <a href="functions.c.html#LN1668"><span class='Ref_To_Local'>tupnatts</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN1667"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; 
</span>        <a href="functions.c.html#LN1669"><span class='Ref_To_Local'>tuplogcols</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* we'll count nondeleted cols as we go */ 
</span>        <a href="functions.c.html#LN1670"><span class='Ref_To_Local'>colindex</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="functions.c.html#LN1671"><span class='Ref_To_Local'>newtlist</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* these are only used if modifyTargetList */ 
</span>        <a href="functions.c.html#LN1672"><span class='Ref_To_Local'>junkattrs</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1540"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN1536"><span class='Ref_To_Local'>tlist</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1739"></a>            <a href="../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tle</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1540"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1740"></a>            <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>attr</span><span class='Delimiter'>; 
</span><a name="LN1741"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tletype</span><span class='Delimiter'>; 
</span><a name="LN1742"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>atttype</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1739"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1373"><span class='Ref_to_Member'>resjunk</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1531"><span class='Ref_to_Parameter'>modifyTargetList</span></a><span class='Parentheses'>) 
</span>                    <a href="functions.c.html#LN1672"><span class='Ref_To_Local'>junkattrs</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1672"><span class='Ref_To_Local'>junkattrs</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN1739"><span class='Ref_To_Local'>tle</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>do</span> 
            <span class='Delimiter'>{ 
</span>                <a href="functions.c.html#LN1670"><span class='Ref_To_Local'>colindex</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1670"><span class='Ref_To_Local'>colindex</span></a> <span class='Operator'>&GT; </span><a href="functions.c.html#LN1668"><span class='Ref_To_Local'>tupnatts</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_FUNCTION_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"return type mismatch in function declared to return %s"</span><span class='Delimiter'>, 
</span>                                    <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1530"><span class='Ref_to_Parameter'>rettype</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                    <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Final statement returns too many columns."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <a href="functions.c.html#LN1740"><span class='Ref_To_Local'>attr</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN1667"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="functions.c.html#LN1670"><span class='Ref_To_Local'>colindex</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1740"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attisdropped <span class='Operator'>&& </span><a href="functions.c.html#LN1531"><span class='Ref_to_Parameter'>modifyTargetList</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN1763"></a>                    <a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>null_expr</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* The type of the null we insert isn't important */ 
</span>                    <a href="functions.c.html#LN1763"><span class='Ref_To_Local'>null_expr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/makefuncs.h.html#LN49"><span class='Ref_to_Proto'>makeConst</span></a><span class='Parentheses'>(</span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN24"><span class='Ref_to_Const'>INT4OID</span></a><span class='Delimiter'>, 
</span>                                                   <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                                   <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                                                   <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                   <span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                                   <span class='Boolean'>true</span><span class='Delimiter'>,</span>        <span class='Comment_Single_Line'>/* isnull */ 
</span>                                                   <span class='Boolean'>true </span><span class='Comment_Multi_Line'>/* byval */ </span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="functions.c.html#LN1671"><span class='Ref_To_Local'>newtlist</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1671"><span class='Ref_To_Local'>newtlist</span></a><span class='Delimiter'>, 
</span>                                       <a href="../../include/nodes/makefuncs.h.html#LN40"><span class='Ref_to_Proto'>makeTargetEntry</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1763"><span class='Ref_To_Local'>null_expr</span></a><span class='Delimiter'>, 
</span>                                                       <a href="functions.c.html#LN1670"><span class='Ref_To_Local'>colindex</span></a><span class='Delimiter'>, 
</span>                                                       <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                                       <span class='Boolean'>false</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* NULL insertion is dangerous in a setop */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1534"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN162"><span class='Ref_to_Member'>setOperations</span></a><span class='Parentheses'>) 
</span>                        <span class='Operator'>*</span><a href="functions.c.html#LN1531"><span class='Ref_to_Parameter'>modifyTargetList</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if attr-&GT;attisdropped&&m... &raquo; </span> 
            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end do &raquo; </span> <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1740"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="functions.c.html#LN1669"><span class='Ref_To_Local'>tuplogcols</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
            <a href="functions.c.html#LN1741"><span class='Ref_To_Local'>tletype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="functions.c.html#LN1739"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="functions.c.html#LN1742"><span class='Ref_To_Local'>atttype</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN1740"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/parser/parse_coerce.h.html#LN33"><span class='Ref_to_Proto'>IsBinaryCoercible</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1741"><span class='Ref_To_Local'>tletype</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN1742"><span class='Ref_To_Local'>atttype</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_FUNCTION_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"return type mismatch in function declared to return %s"</span><span class='Delimiter'>, 
</span>                                <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1530"><span class='Ref_to_Parameter'>rettype</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Final statement returns %s instead of %s at column %d."</span><span class='Delimiter'>, 
</span>                                   <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1741"><span class='Ref_To_Local'>tletype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1742"><span class='Ref_To_Local'>atttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="functions.c.html#LN1669"><span class='Ref_To_Local'>tuplogcols</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1531"><span class='Ref_to_Parameter'>modifyTargetList</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1741"><span class='Ref_To_Local'>tletype</span></a> <span class='Operator'>!= </span><a href="functions.c.html#LN1742"><span class='Ref_To_Local'>atttype</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="functions.c.html#LN1739"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/makefuncs.h.html#LN65"><span class='Ref_to_Proto'>makeRelabelType</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1739"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>, 
</span>                                                         <a href="functions.c.html#LN1742"><span class='Ref_To_Local'>atttype</span></a><span class='Delimiter'>, 
</span>                                                         <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                                   <a href="../../include/utils/lsyscache.h.html#LN166"><span class='Ref_to_Proto'>get_typcollation</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1742"><span class='Ref_To_Local'>atttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                       <a href="../../include/nodes/primnodes.h.html#LN438"><span class='Ref_to_EnumConst'>COERCE_IMPLICIT_CAST</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* Relabel is dangerous if sort/group or setop column */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1739"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1369"><span class='Ref_to_Member'>ressortgroupref</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="functions.c.html#LN1534"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN162"><span class='Ref_to_Member'>setOperations</span></a><span class='Parentheses'>) 
</span>                        <span class='Operator'>*</span><a href="functions.c.html#LN1531"><span class='Ref_to_Parameter'>modifyTargetList</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="functions.c.html#LN1739"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1367"><span class='Ref_to_Member'>resno</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN1670"><span class='Ref_To_Local'>colindex</span></a><span class='Delimiter'>; 
</span>                <a href="functions.c.html#LN1671"><span class='Ref_To_Local'>newtlist</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1671"><span class='Ref_To_Local'>newtlist</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN1739"><span class='Ref_To_Local'>tle</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* remaining columns in tupdesc had better all be dropped */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1670"><span class='Ref_To_Local'>colindex</span></a><span class='Operator'>++</span><span class='Delimiter'>; </span><a href="functions.c.html#LN1670"><span class='Ref_To_Local'>colindex</span></a> <span class='Operator'>&LT;= </span><a href="functions.c.html#LN1668"><span class='Ref_To_Local'>tupnatts</span></a><span class='Delimiter'>; </span><a href="functions.c.html#LN1670"><span class='Ref_To_Local'>colindex</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="functions.c.html#LN1667"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="functions.c.html#LN1670"><span class='Ref_To_Local'>colindex</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_FUNCTION_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"return type mismatch in function declared to return %s"</span><span class='Delimiter'>, 
</span>                                <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1530"><span class='Ref_to_Parameter'>rettype</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Final statement returns too few columns."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1531"><span class='Ref_to_Parameter'>modifyTargetList</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1825"></a>                <a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>null_expr</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* The type of the null we insert isn't important */ 
</span>                <a href="functions.c.html#LN1825"><span class='Ref_To_Local'>null_expr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/makefuncs.h.html#LN49"><span class='Ref_to_Proto'>makeConst</span></a><span class='Parentheses'>(</span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN24"><span class='Ref_to_Const'>INT4OID</span></a><span class='Delimiter'>, 
</span>                                               <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                               <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                                               <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                               <span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                               <span class='Boolean'>true</span><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* isnull */ 
</span>                                               <span class='Boolean'>true </span><span class='Comment_Multi_Line'>/* byval */ </span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="functions.c.html#LN1671"><span class='Ref_To_Local'>newtlist</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1671"><span class='Ref_To_Local'>newtlist</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../include/nodes/makefuncs.h.html#LN40"><span class='Ref_to_Proto'>makeTargetEntry</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1825"><span class='Ref_To_Local'>null_expr</span></a><span class='Delimiter'>, 
</span>                                                   <a href="functions.c.html#LN1670"><span class='Ref_To_Local'>colindex</span></a><span class='Delimiter'>, 
</span>                                                   <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                                   <span class='Boolean'>false</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* NULL insertion is dangerous in a setop */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1534"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN162"><span class='Ref_to_Member'>setOperations</span></a><span class='Parentheses'>) 
</span>                    <span class='Operator'>*</span><a href="functions.c.html#LN1531"><span class='Ref_to_Parameter'>modifyTargetList</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if modifyTargetList &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for colindex++;colindex&LT;=... &raquo; </span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1531"><span class='Ref_to_Parameter'>modifyTargetList</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* ensure resjunk columns are numbered correctly */ 
</span>            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1540"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN1672"><span class='Ref_To_Local'>junkattrs</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1851"></a>                <a href="../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tle</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1540"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="functions.c.html#LN1851"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1367"><span class='Ref_to_Member'>resno</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN1670"><span class='Ref_To_Local'>colindex</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Comment_Multi_Line'>/* replace the tlist with the modified one */ 
</span>            <span class='Operator'>*</span><a href="functions.c.html#LN1535"><span class='Ref_To_Local'>tlist_ptr</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1671"><span class='Ref_To_Local'>newtlist</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN1672"><span class='Ref_To_Local'>junkattrs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Set up junk filter if needed */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="functions.c.html#LN1532"><span class='Ref_to_Parameter'>junkFilter</span></a><span class='Parentheses'>) 
</span>            <span class='Operator'>*</span><a href="functions.c.html#LN1532"><span class='Ref_to_Parameter'>junkFilter</span></a> <span class='Operator'>= </span><a href="execJunk.c.html#LN134"><span class='Ref_to_Func'>ExecInitJunkFilterConversion</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1536"><span class='Ref_To_Local'>tlist</span></a><span class='Delimiter'>, 
</span>                                                <a href="../../include/access/tupdesc.h.html#LN88"><span class='Ref_to_Proto'>CreateTupleDescCopy</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1667"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                       <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Report that we are returning entire tuple result */ 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if fn_typtype==TYPTYPE_C... &raquo; </span> 
    <span class='Control'>else</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_FUNCTION_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"return type %s is not supported for SQL functions"</span><span class='Delimiter'>, 
</span>                        <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1530"><span class='Ref_to_Parameter'>rettype</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end check_sql_fn_retval &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * CreateSQLFunctionDestReceiver -- create a suitable DestReceiver object 
 */ 
</span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>* 
</span><a name="LN1882"></a><span class='Declare_Function'>CreateSQLFunctionDestReceiver</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1884"></a>    <a href="functions.c.html#LN40"><span class='Ref_to_Typedef'>DR_sqlfunction</span></a> <span class='Operator'>*</span><span class='Declare_Local'>self</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="functions.c.html#LN40"><span class='Ref_to_Typedef'>DR_sqlfunction</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="functions.c.html#LN40"><span class='Ref_to_Typedef'>DR_sqlfunction</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="functions.c.html#LN1884"><span class='Ref_To_Local'>self</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN42"><span class='Ref_to_Member'>pub</span></a><span class='Operator'>.</span><a href="../../include/tcop/dest.h.html#LN117"><span class='Ref_to_Member'>receiveSlot</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN169"><span class='Ref_to_Proto'>sqlfunction_receive</span></a><span class='Delimiter'>; 
</span>    <a href="functions.c.html#LN1884"><span class='Ref_To_Local'>self</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN42"><span class='Ref_to_Member'>pub</span></a><span class='Operator'>.</span><a href="../../include/tcop/dest.h.html#LN120"><span class='Ref_to_Member'>rStartup</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN168"><span class='Ref_to_Proto'>sqlfunction_startup</span></a><span class='Delimiter'>; 
</span>    <a href="functions.c.html#LN1884"><span class='Ref_To_Local'>self</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN42"><span class='Ref_to_Member'>pub</span></a><span class='Operator'>.</span><a href="../../include/tcop/dest.h.html#LN123"><span class='Ref_to_Member'>rShutdown</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN170"><span class='Ref_to_Proto'>sqlfunction_shutdown</span></a><span class='Delimiter'>; 
</span>    <a href="functions.c.html#LN1884"><span class='Ref_To_Local'>self</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN42"><span class='Ref_to_Member'>pub</span></a><span class='Operator'>.</span><a href="../../include/tcop/dest.h.html#LN125"><span class='Ref_to_Member'>rDestroy</span></a> <span class='Operator'>= </span><a href="functions.c.html#LN171"><span class='Ref_to_Proto'>sqlfunction_destroy</span></a><span class='Delimiter'>; 
</span>    <a href="functions.c.html#LN1884"><span class='Ref_To_Local'>self</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN42"><span class='Ref_to_Member'>pub</span></a><span class='Operator'>.</span><a href="../../include/tcop/dest.h.html#LN127"><span class='Ref_to_Member'>mydest</span></a> <span class='Operator'>= </span><a href="../../include/tcop/dest.h.html#LN96"><span class='Ref_to_EnumConst'>DestSQLFunction</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* private fields will be set by postquel_start */ 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="functions.c.html#LN1884"><span class='Ref_To_Local'>self</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * sqlfunction_startup --- executor startup 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1901"></a><span class='Declare_Function'>sqlfunction_startup</span><span class='Parentheses'>(</span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>self</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>operation</span><span class='Delimiter'>, </span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>typeinfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* no-op */ 
</span><span class='Delimiter'>} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * sqlfunction_receive --- receive one tuple 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1910"></a><span class='Declare_Function'>sqlfunction_receive</span><span class='Parentheses'>(</span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Delimiter'>, </span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>self</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1912"></a>    <a href="functions.c.html#LN40"><span class='Ref_to_Typedef'>DR_sqlfunction</span></a> <span class='Operator'>*</span><span class='Declare_Local'>myState</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="functions.c.html#LN40"><span class='Ref_to_Typedef'>DR_sqlfunction</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="functions.c.html#LN1910"><span class='Ref_to_Parameter'>self</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Filter tuple as needed */ 
</span>    <a href="functions.c.html#LN1910"><span class='Ref_to_Parameter'>slot</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN160"><span class='Ref_to_Proto'>ExecFilterJunk</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1912"><span class='Ref_To_Local'>myState</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN45"><span class='Ref_to_Member'>filter</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN1910"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Store the filtered tuple into the tuplestore */ 
</span>    <a href="../../include/utils/tuplestore.h.html#LN52"><span class='Ref_to_Proto'>tuplestore_puttupleslot</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1912"><span class='Ref_To_Local'>myState</span></a><span class='Operator'>-&GT;</span><a href="functions.c.html#LN43"><span class='Ref_to_Member'>tstore</span></a><span class='Delimiter'>, </span><a href="functions.c.html#LN1910"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * sqlfunction_shutdown --- executor end 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1927"></a><span class='Declare_Function'>sqlfunction_shutdown</span><span class='Parentheses'>(</span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>self</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* no-op */ 
</span><span class='Delimiter'>} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * sqlfunction_destroy --- release DestReceiver object 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1936"></a><span class='Declare_Function'>sqlfunction_destroy</span><span class='Parentheses'>(</span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>self</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="functions.c.html#LN1936"><span class='Ref_to_Parameter'>self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>