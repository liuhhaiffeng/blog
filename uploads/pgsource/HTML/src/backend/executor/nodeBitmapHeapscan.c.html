<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\executor\nodeBitmapHeapscan.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\executor\nodeBitmapHeapscan.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:39 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * nodeBitmapHeapscan.c 
 *    Routines to support bitmapped scans of relations 
 * 
 * NOTE: it is critical that this plan type only be used with MVCC-compliant 
 * snapshots (ie, regular snapshots, not SnapshotAny or one of the other 
 * special snapshots).  The reason is that since index and heap scans are 
 * decoupled, there can be no assurance that the index tuple prompting a 
 * visit to a particular heap TID still exists when the visit is made. 
 * Therefore the tuple might not exist anymore either (which is OK because 
 * heap_fetch will cope) --- but worse, the tuple slot could have been 
 * re-used for a newer tuple.  With an MVCC snapshot the newer tuple is 
 * certain to fail the time qual and so it will not be mistakenly returned, 
 * but with anything else we might return a tuple that doesn't meet the 
 * required index qual conditions. 
 * 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/executor/nodeBitmapHeapscan.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
/* 
 * INTERFACE ROUTINES 
 *      ExecBitmapHeapScan          scans a relation using bitmap info 
 *      ExecBitmapHeapNext          workhorse for above 
 *      ExecInitBitmapHeapScan      creates and initializes state info. 
 *      ExecReScanBitmapHeapScan    prepares to rescan the plan. 
 *      ExecEndBitmapHeapScan       releases all storage. 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;math.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/relscan.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/transam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"executor/execdebug.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"executor/nodeBitmapHeapscan.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"pgstat.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/bufmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/predicate.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/spccache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/snapmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/tqual.h"</span> 
 
 
<a name="LN53"></a><span class='Keyword'>static </span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>BitmapHeapNext</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1301"><span class='Ref_to_Struct'>BitmapHeapScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN54"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>bitgetpage</span><span class='Parentheses'>(</span><a href="../../include/access/heapam.h.html#LN99"><span class='Ref_to_Typedef'>HeapScanDesc</span></a> <span class='Declare_Parameter'>scan</span><span class='Delimiter'>, </span><a href="../../include/nodes/tidbitmap.h.html#LN39"><span class='Ref_to_Typedef'>TBMIterateResult</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tbmres</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN55"></a><span class='Keyword'>static inline void </span><span class='Declare_Prototype'>BitmapDoneInitializingSharedState</span><span class='Parentheses'>( 
</span><a name="LN56"></a>                                  <a href="../../include/nodes/execnodes.h.html#LN1269"><span class='Ref_to_Struct'>ParallelBitmapHeapState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN57"></a><span class='Keyword'>static inline void </span><span class='Declare_Prototype'>BitmapAdjustPrefetchIterator</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1301"><span class='Ref_to_Struct'>BitmapHeapScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, 
</span><a name="LN58"></a>                             <a href="../../include/nodes/tidbitmap.h.html#LN39"><span class='Ref_to_Typedef'>TBMIterateResult</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tbmres</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN59"></a><span class='Keyword'>static inline void </span><span class='Declare_Prototype'>BitmapAdjustPrefetchTarget</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1301"><span class='Ref_to_Struct'>BitmapHeapScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN60"></a><span class='Keyword'>static inline void </span><span class='Declare_Prototype'>BitmapPrefetch</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1301"><span class='Ref_to_Struct'>BitmapHeapScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, 
</span><a name="LN61"></a>               <a href="../../include/access/heapam.h.html#LN99"><span class='Ref_to_Typedef'>HeapScanDesc</span></a> <span class='Declare_Parameter'>scan</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN62"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>BitmapShouldInitializeSharedState</span><span class='Parentheses'>( 
</span><a name="LN63"></a>                                  <a href="../../include/nodes/execnodes.h.html#LN1269"><span class='Ref_to_Struct'>ParallelBitmapHeapState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      BitmapHeapNext 
 * 
 *      Retrieve next tuple from the BitmapHeapScan node's currentRelation 
 * ---------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>* 
</span><a name="LN73"></a><span class='Declare_Function'>BitmapHeapNext</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1301"><span class='Ref_to_Struct'>BitmapHeapScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN75"></a>    <a href="../../include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>econtext</span><span class='Delimiter'>; 
</span><a name="LN76"></a>    <a href="../../include/access/heapam.h.html#LN99"><span class='Ref_to_Typedef'>HeapScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN77"></a>    <a href="../nodes/tidbitmap.c.html#LN146"><span class='Ref_to_Struct'>TIDBitmap</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>tbm</span><span class='Delimiter'>; 
</span><a name="LN78"></a>    <a href="../nodes/tidbitmap.c.html#LN175"><span class='Ref_to_Struct'>TBMIterator</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tbmiterator</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN79"></a>    <a href="../nodes/tidbitmap.c.html#LN216"><span class='Ref_to_Struct'>TBMSharedIterator</span></a> <span class='Operator'>*</span><span class='Declare_Local'>shared_tbmiterator</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN80"></a>    <a href="../../include/nodes/tidbitmap.h.html#LN39"><span class='Ref_to_Typedef'>TBMIterateResult</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tbmres</span><span class='Delimiter'>; 
</span><a name="LN81"></a>    <a href="../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>targoffset</span><span class='Delimiter'>; 
</span><a name="LN82"></a>    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>slot</span><span class='Delimiter'>; 
</span><a name="LN83"></a>    <a href="../../include/nodes/execnodes.h.html#LN1269"><span class='Ref_to_Struct'>ParallelBitmapHeapState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pstate</span> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1318"><span class='Ref_to_Member'>pstate</span></a><span class='Delimiter'>; 
</span><a name="LN84"></a>    <a href="../utils/mmgr/dsa.c.html#LN353"><span class='Ref_to_Struct'>dsa_area</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>dsa</span> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1303"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN814"><span class='Ref_to_Member'>state</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN487"><span class='Ref_to_Member'>es_query_dsa</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * extract necessary information from index scan node 
     */ 
</span>    <a href="nodeBitmapHeapscan.c.html#LN75"><span class='Ref_To_Local'>econtext</span></a> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1303"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN842"><span class='Ref_to_Member'>ps_ExprContext</span></a><span class='Delimiter'>; 
</span>    <a href="nodeBitmapHeapscan.c.html#LN82"><span class='Ref_To_Local'>slot</span></a> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1303"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1060"><span class='Ref_to_Member'>ss_ScanTupleSlot</span></a><span class='Delimiter'>; 
</span>    <a href="nodeBitmapHeapscan.c.html#LN76"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1303"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1059"><span class='Ref_to_Member'>ss_currentScanDesc</span></a><span class='Delimiter'>; 
</span>    <a href="nodeBitmapHeapscan.c.html#LN77"><span class='Ref_To_Local'>tbm</span></a> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1305"><span class='Ref_to_Member'>tbm</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN83"><span class='Ref_To_Local'>pstate</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="nodeBitmapHeapscan.c.html#LN78"><span class='Ref_To_Local'>tbmiterator</span></a> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1306"><span class='Ref_to_Member'>tbmiterator</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="nodeBitmapHeapscan.c.html#LN79"><span class='Ref_To_Local'>shared_tbmiterator</span></a> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1316"><span class='Ref_to_Member'>shared_tbmiterator</span></a><span class='Delimiter'>; 
</span>    <a href="nodeBitmapHeapscan.c.html#LN80"><span class='Ref_To_Local'>tbmres</span></a> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1307"><span class='Ref_to_Member'>tbmres</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we haven't yet performed the underlying index scan, do it, and begin 
     * the iteration over the bitmap. 
     * 
     * For prefetching, we use *two* iterators, one for the pages we are 
     * actually scanning and another that runs ahead of the first for 
     * prefetching.  node-&GT;prefetch_pages tracks exactly how many pages ahead 
     * the prefetch iterator is.  Also, node-&GT;prefetch_target tracks the 
     * desired prefetch distance, which starts small and increases up to the 
     * node-&GT;prefetch_maximum.  This is to avoid doing a lot of prefetching in 
     * a scan that stops after a few tuples because of a LIMIT. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1315"><span class='Ref_to_Member'>initialized</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeBitmapHeapscan.c.html#LN83"><span class='Ref_To_Local'>pstate</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="nodeBitmapHeapscan.c.html#LN77"><span class='Ref_To_Local'>tbm</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../nodes/tidbitmap.c.html#LN146"><span class='Ref_to_Struct'>TIDBitmap</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/executor/executor.h.html#LN230"><span class='Ref_to_Proto'>MultiExecProcNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN854"><span class='Ref_to_Macro'>outerPlanState</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeBitmapHeapscan.c.html#LN77"><span class='Ref_To_Local'>tbm</span></a> <span class='Operator'>|| !</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN77"><span class='Ref_To_Local'>tbm</span></a><span class='Delimiter'>, </span><a href="../nodes/tidbitmap.c.html#LN146"><span class='Ref_to_Struct'>TIDBitmap</span></a><span class='Parentheses'>))</span> 
                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized result from subplan"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1305"><span class='Ref_to_Member'>tbm</span></a> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN77"><span class='Ref_To_Local'>tbm</span></a><span class='Delimiter'>; 
</span>            <a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1306"><span class='Ref_to_Member'>tbmiterator</span></a> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN78"><span class='Ref_To_Local'>tbmiterator</span></a> <span class='Operator'>= </span><a href="../../include/nodes/tidbitmap.h.html#LN64"><span class='Ref_to_Proto'>tbm_begin_iterate</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN77"><span class='Ref_To_Local'>tbm</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1307"><span class='Ref_to_Member'>tbmres</span></a> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN80"><span class='Ref_To_Local'>tbmres</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../include/pg_config_manual.h.html#LN145"><span class='Ref_to_Const'>USE_PREFETCH</span></a> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1313"><span class='Ref_to_Member'>prefetch_maximum</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1310"><span class='Ref_to_Member'>prefetch_iterator</span></a> <span class='Operator'>= </span><a href="../../include/nodes/tidbitmap.h.html#LN64"><span class='Ref_to_Proto'>tbm_begin_iterate</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN77"><span class='Ref_To_Local'>tbm</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1311"><span class='Ref_to_Member'>prefetch_pages</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1312"><span class='Ref_to_Member'>prefetch_target</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* USE_PREFETCH */ 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !pstate &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * The leader will immediately come out of the function, but 
             * others will be blocked until leader populates the TBM and wakes 
             * them up. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN62"><span class='Ref_to_Proto'>BitmapShouldInitializeSharedState</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN83"><span class='Ref_To_Local'>pstate</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="nodeBitmapHeapscan.c.html#LN77"><span class='Ref_To_Local'>tbm</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../nodes/tidbitmap.c.html#LN146"><span class='Ref_to_Struct'>TIDBitmap</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/executor/executor.h.html#LN230"><span class='Ref_to_Proto'>MultiExecProcNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN854"><span class='Ref_to_Macro'>outerPlanState</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeBitmapHeapscan.c.html#LN77"><span class='Ref_To_Local'>tbm</span></a> <span class='Operator'>|| !</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN77"><span class='Ref_To_Local'>tbm</span></a><span class='Delimiter'>, </span><a href="../nodes/tidbitmap.c.html#LN146"><span class='Ref_to_Struct'>TIDBitmap</span></a><span class='Parentheses'>))</span> 
                    <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized result from subplan"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1305"><span class='Ref_to_Member'>tbm</span></a> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN77"><span class='Ref_To_Local'>tbm</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Prepare to iterate over the TBM. This will return the 
                 * dsa_pointer of the iterator state which will be used by 
                 * multiple processes to iterate jointly. 
                 */ 
</span>                <a href="nodeBitmapHeapscan.c.html#LN83"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1271"><span class='Ref_to_Member'>tbmiterator</span></a> <span class='Operator'>= </span><a href="../../include/nodes/tidbitmap.h.html#LN65"><span class='Ref_to_Proto'>tbm_prepare_shared_iterate</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN77"><span class='Ref_To_Local'>tbm</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> <a href="../../include/pg_config_manual.h.html#LN145"><span class='Ref_to_Const'>USE_PREFETCH</span></a> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1313"><span class='Ref_to_Member'>prefetch_maximum</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="nodeBitmapHeapscan.c.html#LN83"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1272"><span class='Ref_to_Member'>prefetch_iterator</span></a> <span class='Operator'>= 
</span>                        <a href="../../include/nodes/tidbitmap.h.html#LN65"><span class='Ref_to_Proto'>tbm_prepare_shared_iterate</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN77"><span class='Ref_To_Local'>tbm</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * We don't need the mutex here as we haven't yet woke up 
                     * others. 
                     */ 
</span>                    <a href="nodeBitmapHeapscan.c.html#LN83"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1274"><span class='Ref_to_Member'>prefetch_pages</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <a href="nodeBitmapHeapscan.c.html#LN83"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1275"><span class='Ref_to_Member'>prefetch_target</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
 
                <span class='Comment_Multi_Line'>/* We have initialized the shared state so wake up others. */ 
</span>                <a href="nodeBitmapHeapscan.c.html#LN55"><span class='Ref_to_Proto'>BitmapDoneInitializingSharedState</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN83"><span class='Ref_To_Local'>pstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if BitmapShouldInitializ... &raquo; </span> 
 
            <span class='Comment_Multi_Line'>/* Allocate a private iterator and attach the shared state to it */ 
</span>            <a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1316"><span class='Ref_to_Member'>shared_tbmiterator</span></a> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN79"><span class='Ref_To_Local'>shared_tbmiterator</span></a> <span class='Operator'>= 
</span>                <a href="../../include/nodes/tidbitmap.h.html#LN70"><span class='Ref_to_Proto'>tbm_attach_shared_iterate</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN84"><span class='Ref_To_Local'>dsa</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN83"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1271"><span class='Ref_to_Member'>tbmiterator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1307"><span class='Ref_to_Member'>tbmres</span></a> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN80"><span class='Ref_To_Local'>tbmres</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../include/pg_config_manual.h.html#LN145"><span class='Ref_to_Const'>USE_PREFETCH</span></a> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1313"><span class='Ref_to_Member'>prefetch_maximum</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1317"><span class='Ref_to_Member'>shared_prefetch_iterator</span></a> <span class='Operator'>= 
</span>                    <a href="../../include/nodes/tidbitmap.h.html#LN70"><span class='Ref_to_Proto'>tbm_attach_shared_iterate</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN84"><span class='Ref_To_Local'>dsa</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN83"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1272"><span class='Ref_to_Member'>prefetch_iterator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* USE_PREFETCH */ 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
        <a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1315"><span class='Ref_to_Member'>initialized</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !node-&GT;initialized &raquo; </span> 
 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN191"></a>        <a href="../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>dp</span><span class='Delimiter'>; 
</span><a name="LN192"></a>        <a href="../../include/storage/itemid.h.html#LN30"><span class='Ref_to_Typedef'>ItemId</span></a>      <span class='Declare_Local'>lp</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Get next page of results if needed 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN80"><span class='Ref_To_Local'>tbmres</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeBitmapHeapscan.c.html#LN83"><span class='Ref_To_Local'>pstate</span></a><span class='Parentheses'>) 
</span>                <a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1307"><span class='Ref_to_Member'>tbmres</span></a> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN80"><span class='Ref_To_Local'>tbmres</span></a> <span class='Operator'>= </span><a href="../../include/nodes/tidbitmap.h.html#LN66"><span class='Ref_to_Proto'>tbm_iterate</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN78"><span class='Ref_To_Local'>tbmiterator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1307"><span class='Ref_to_Member'>tbmres</span></a> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN80"><span class='Ref_To_Local'>tbmres</span></a> <span class='Operator'>= </span><a href="../../include/nodes/tidbitmap.h.html#LN67"><span class='Ref_to_Proto'>tbm_shared_iterate</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN79"><span class='Ref_To_Local'>shared_tbmiterator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN80"><span class='Ref_To_Local'>tbmres</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* no more entries in the bitmap */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="nodeBitmapHeapscan.c.html#LN57"><span class='Ref_to_Proto'>BitmapAdjustPrefetchIterator</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN80"><span class='Ref_To_Local'>tbmres</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Ignore any claimed entries past what we think is the end of the 
             * relation.  (This is probably not necessary given that we got at 
             * least AccessShareLock on the table before performing any of the 
             * indexscans, but let's be safe.) 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN80"><span class='Ref_To_Local'>tbmres</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/tidbitmap.h.html#LN41"><span class='Ref_to_Member'>blockno</span></a> <span class='Operator'>&GT;= </span><a href="nodeBitmapHeapscan.c.html#LN76"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN58"><span class='Ref_to_Member'>rs_nblocks</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1307"><span class='Ref_to_Member'>tbmres</span></a> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN80"><span class='Ref_To_Local'>tbmres</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Fetch the current heap page and identify candidate tuples. 
             */ 
</span>            <a href="nodeBitmapHeapscan.c.html#LN54"><span class='Ref_to_Proto'>bitgetpage</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN76"><span class='Ref_To_Local'>scan</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN80"><span class='Ref_To_Local'>tbmres</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN80"><span class='Ref_To_Local'>tbmres</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/tidbitmap.h.html#LN42"><span class='Ref_to_Member'>ntuples</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1308"><span class='Ref_to_Member'>exact_pages</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1309"><span class='Ref_to_Member'>lossy_pages</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Set rs_cindex to first slot to examine 
             */ 
</span>            <a href="nodeBitmapHeapscan.c.html#LN76"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN74"><span class='Ref_to_Member'>rs_cindex</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Adjust the prefetch target */ 
</span>            <a href="nodeBitmapHeapscan.c.html#LN59"><span class='Ref_to_Proto'>BitmapAdjustPrefetchTarget</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if tbmres==NULL &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Continuing in previously obtained page; advance rs_cindex 
             */ 
</span>            <a href="nodeBitmapHeapscan.c.html#LN76"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN74"><span class='Ref_to_Member'>rs_cindex</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../include/pg_config_manual.h.html#LN145"><span class='Ref_to_Const'>USE_PREFETCH</span></a> 
 
            <span class='Comment_Multi_Line'>/* 
             * Try to prefetch at least a few pages even before we get to the 
             * second page if we don't stop reading after the first tuple. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeBitmapHeapscan.c.html#LN83"><span class='Ref_To_Local'>pstate</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1312"><span class='Ref_to_Member'>prefetch_target</span></a> <span class='Operator'>&LT; </span><a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1313"><span class='Ref_to_Member'>prefetch_maximum</span></a><span class='Parentheses'>) 
</span>                    <a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1312"><span class='Ref_to_Member'>prefetch_target</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN83"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1275"><span class='Ref_to_Member'>prefetch_target</span></a> <span class='Operator'>&LT; </span><a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1313"><span class='Ref_to_Member'>prefetch_maximum</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* take spinlock while updating shared state */ 
</span>                <a href="../../include/storage/spin.h.html#LN61"><span class='Ref_to_Macro'>SpinLockAcquire</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN83"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1273"><span class='Ref_to_Member'>mutex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN83"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1275"><span class='Ref_to_Member'>prefetch_target</span></a> <span class='Operator'>&LT; </span><a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1313"><span class='Ref_to_Member'>prefetch_maximum</span></a><span class='Parentheses'>) 
</span>                    <a href="nodeBitmapHeapscan.c.html#LN83"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1275"><span class='Ref_to_Member'>prefetch_target</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <a href="../../include/storage/spin.h.html#LN63"><span class='Ref_to_Macro'>SpinLockRelease</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN83"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1273"><span class='Ref_to_Member'>mutex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* USE_PREFETCH */ 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * Out of range?  If so, nothing more to look at on this page 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN76"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN74"><span class='Ref_to_Member'>rs_cindex</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="nodeBitmapHeapscan.c.html#LN76"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN74"><span class='Ref_to_Member'>rs_cindex</span></a> <span class='Operator'>&GT;= </span><a href="nodeBitmapHeapscan.c.html#LN76"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN75"><span class='Ref_to_Member'>rs_ntuples</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1307"><span class='Ref_to_Member'>tbmres</span></a> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN80"><span class='Ref_To_Local'>tbmres</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We issue prefetch requests *after* fetching the current page to try 
         * to avoid having prefetching interfere with the main I/O. Also, this 
         * should happen only when we have determined there is still something 
         * to do on the current page, else we may uselessly prefetch the same 
         * page we are just about to request for real. 
         */ 
</span>        <a href="nodeBitmapHeapscan.c.html#LN60"><span class='Ref_to_Proto'>BitmapPrefetch</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN76"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Okay to fetch the tuple 
         */ 
</span>        <a href="nodeBitmapHeapscan.c.html#LN81"><span class='Ref_To_Local'>targoffset</span></a> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN76"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN76"><span class='Ref_to_Member'>rs_vistuples</span></a><span class='Delimiter'>[</span><a href="nodeBitmapHeapscan.c.html#LN76"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN74"><span class='Ref_to_Member'>rs_cindex</span></a><span class='Delimiter'>]; 
</span>        <a href="nodeBitmapHeapscan.c.html#LN191"><span class='Ref_To_Local'>dp</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a><span class='Parentheses'>) </span><a href="../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN76"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN69"><span class='Ref_to_Member'>rs_cbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeBitmapHeapscan.c.html#LN192"><span class='Ref_To_Local'>lp</span></a> <span class='Operator'>= </span><a href="../../include/storage/bufpage.h.html#LN231"><span class='Ref_to_Macro'>PageGetItemId</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN191"><span class='Ref_To_Local'>dp</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN81"><span class='Ref_To_Local'>targoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/storage/itemid.h.html#LN97"><span class='Ref_to_Macro'>ItemIdIsNormal</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN192"><span class='Ref_To_Local'>lp</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="nodeBitmapHeapscan.c.html#LN76"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN67"><span class='Ref_to_Member'>rs_ctup</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a><span class='Parentheses'>) </span><a href="../../include/storage/bufpage.h.html#LN336"><span class='Ref_to_Macro'>PageGetItem</span></a><span class='Parentheses'>((</span><a href="../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a><span class='Parentheses'>) </span><a href="nodeBitmapHeapscan.c.html#LN191"><span class='Ref_To_Local'>dp</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN192"><span class='Ref_To_Local'>lp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeBitmapHeapscan.c.html#LN76"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN67"><span class='Ref_to_Member'>rs_ctup</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a> <span class='Operator'>= </span><a href="../../include/storage/itemid.h.html#LN57"><span class='Ref_to_Macro'>ItemIdGetLength</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN192"><span class='Ref_To_Local'>lp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeBitmapHeapscan.c.html#LN76"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN67"><span class='Ref_to_Member'>rs_ctup</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN76"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN46"><span class='Ref_to_Member'>rs_rd</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN115"><span class='Ref_to_Member'>rd_id</span></a><span class='Delimiter'>; 
</span>        <a href="../../include/storage/itemptr.h.html#LN103"><span class='Ref_to_Macro'>ItemPointerSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN76"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN67"><span class='Ref_to_Member'>rs_ctup</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN80"><span class='Ref_To_Local'>tbmres</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/tidbitmap.h.html#LN41"><span class='Ref_to_Member'>blockno</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN81"><span class='Ref_To_Local'>targoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/pgstat.h.html#LN1257"><span class='Ref_to_Macro'>pgstat_count_heap_fetch</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN76"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN46"><span class='Ref_to_Member'>rs_rd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Set up the result slot to point to this tuple. Note that the slot 
         * acquires a pin on the buffer. 
         */ 
</span>        <a href="../../include/executor/tuptable.h.html#LN147"><span class='Ref_to_Proto'>ExecStoreTuple</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN76"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN67"><span class='Ref_to_Member'>rs_ctup</span></a><span class='Delimiter'>, 
</span>                       <a href="nodeBitmapHeapscan.c.html#LN82"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>, 
</span>                       <a href="nodeBitmapHeapscan.c.html#LN76"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN69"><span class='Ref_to_Member'>rs_cbuf</span></a><span class='Delimiter'>, 
</span>                       <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If we are using lossy info, we have to recheck the qual conditions 
         * at every tuple. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN80"><span class='Ref_To_Local'>tbmres</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/tidbitmap.h.html#LN43"><span class='Ref_to_Member'>recheck</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="nodeBitmapHeapscan.c.html#LN75"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN196"><span class='Ref_to_Member'>ecxt_scantuple</span></a> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN82"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>; 
</span>            <a href="../../include/executor/executor.h.html#LN449"><span class='Ref_to_Macro'>ResetExprContext</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN75"><span class='Ref_To_Local'>econtext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/executor/executor.h.html#LN344"><span class='Ref_to_Func'>ExecQual</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1304"><span class='Ref_to_Member'>bitmapqualorig</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN75"><span class='Ref_To_Local'>econtext</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Fails recheck, so drop it and loop back for another */ 
</span>                <a href="../../include/nodes/execnodes.h.html#LN862"><span class='Ref_to_Macro'>InstrCountFiltered2</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN73"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/executor/tuptable.h.html#LN154"><span class='Ref_to_Proto'>ExecClearTuple</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN82"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* OK to return this tuple */ 
</span>        <span class='Control'>return</span> <a href="nodeBitmapHeapscan.c.html#LN82"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * if we get here it means we are at the end of the scan.. 
     */ 
</span>    <span class='Control'>return</span> <a href="../../include/executor/tuptable.h.html#LN154"><span class='Ref_to_Proto'>ExecClearTuple</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN82"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end BitmapHeapNext &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * bitgetpage - subroutine for BitmapHeapNext() 
 * 
 * This routine reads and pins the specified page of the relation, then 
 * builds an array indicating which tuples on the page are both potentially 
 * interesting according to the bitmap, and visible according to the snapshot. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN348"></a><span class='Declare_Function'>bitgetpage</span><span class='Parentheses'>(</span><a href="../../include/access/heapam.h.html#LN99"><span class='Ref_to_Typedef'>HeapScanDesc</span></a> <span class='Declare_Parameter'>scan</span><span class='Delimiter'>, </span><a href="../../include/nodes/tidbitmap.h.html#LN39"><span class='Ref_to_Typedef'>TBMIterateResult</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tbmres</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN350"></a>    <a href="../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Local'>page</span> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN348"><span class='Ref_to_Parameter'>tbmres</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/tidbitmap.h.html#LN41"><span class='Ref_to_Member'>blockno</span></a><span class='Delimiter'>; 
</span><a name="LN351"></a>    <a href="../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>buffer</span><span class='Delimiter'>; 
</span><a name="LN352"></a>    <a href="../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a>    <span class='Declare_Local'>snapshot</span><span class='Delimiter'>; 
</span><a name="LN353"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ntup</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Acquire pin on the target heap page, trading in any pin we held before. 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN350"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>&LT; </span><a href="nodeBitmapHeapscan.c.html#LN348"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN58"><span class='Ref_to_Member'>rs_nblocks</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="nodeBitmapHeapscan.c.html#LN348"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN69"><span class='Ref_to_Member'>rs_cbuf</span></a> <span class='Operator'>= </span><a href="../../include/storage/bufmgr.h.html#LN178"><span class='Ref_to_Proto'>ReleaseAndReadBuffer</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN348"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN69"><span class='Ref_to_Member'>rs_cbuf</span></a><span class='Delimiter'>, 
</span>                                         <a href="nodeBitmapHeapscan.c.html#LN348"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN46"><span class='Ref_to_Member'>rs_rd</span></a><span class='Delimiter'>, 
</span>                                         <a href="nodeBitmapHeapscan.c.html#LN350"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeBitmapHeapscan.c.html#LN351"><span class='Ref_To_Local'>buffer</span></a> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN348"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN69"><span class='Ref_to_Member'>rs_cbuf</span></a><span class='Delimiter'>; 
</span>    <a href="nodeBitmapHeapscan.c.html#LN352"><span class='Ref_To_Local'>snapshot</span></a> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN348"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN47"><span class='Ref_to_Member'>rs_snapshot</span></a><span class='Delimiter'>; 
</span> 
    <a href="nodeBitmapHeapscan.c.html#LN353"><span class='Ref_To_Local'>ntup</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Prune and repair fragmentation for the whole page, if possible. 
     */ 
</span>    <a href="../access/heap/pruneheap.c.html#LN73"><span class='Ref_to_Func'>heap_page_prune_opt</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN348"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN46"><span class='Ref_to_Member'>rs_rd</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN351"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We must hold share lock on the buffer content while examining tuple 
     * visibility.  Afterwards, however, the tuples we have found to be 
     * visible are guaranteed good as long as we hold the buffer pin. 
     */ 
</span>    <a href="../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN351"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><a href="../../include/storage/bufmgr.h.html#LN87"><span class='Ref_to_Const'>BUFFER_LOCK_SHARE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We need two separate strategies for lossy and non-lossy cases. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN348"><span class='Ref_to_Parameter'>tbmres</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/tidbitmap.h.html#LN42"><span class='Ref_to_Member'>ntuples</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Bitmap is non-lossy, so we just look through the offsets listed in 
         * tbmres; but we have to follow any HOT chain starting at each such 
         * offset. 
         */ 
</span><a name="LN390"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>curslot</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN390"><span class='Ref_To_Local'>curslot</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="nodeBitmapHeapscan.c.html#LN390"><span class='Ref_To_Local'>curslot</span></a> <span class='Operator'>&LT; </span><a href="nodeBitmapHeapscan.c.html#LN348"><span class='Ref_to_Parameter'>tbmres</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/tidbitmap.h.html#LN42"><span class='Ref_to_Member'>ntuples</span></a><span class='Delimiter'>; </span><a href="nodeBitmapHeapscan.c.html#LN390"><span class='Ref_To_Local'>curslot</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN394"></a>            <a href="../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>offnum</span> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN348"><span class='Ref_to_Parameter'>tbmres</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/tidbitmap.h.html#LN45"><span class='Ref_to_Member'>offsets</span></a><span class='Delimiter'>[</span><a href="nodeBitmapHeapscan.c.html#LN390"><span class='Ref_To_Local'>curslot</span></a><span class='Delimiter'>]; 
</span><a name="LN395"></a>            <a href="../../include/storage/itemptr.h.html#LN35"><span class='Ref_to_Struct'>ItemPointerData</span></a> <span class='Declare_Local'>tid</span><span class='Delimiter'>; 
</span><a name="LN396"></a>            <a href="../../include/access/htup.h.html#LN61"><span class='Ref_to_Struct'>HeapTupleData</span></a> <span class='Declare_Local'>heapTuple</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/storage/itemptr.h.html#LN103"><span class='Ref_to_Macro'>ItemPointerSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN395"><span class='Ref_To_Local'>tid</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN350"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN394"><span class='Ref_To_Local'>offnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/heapam.h.html#LN137"><span class='Ref_to_Proto'>heap_hot_search_buffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN395"><span class='Ref_To_Local'>tid</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN348"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN46"><span class='Ref_to_Member'>rs_rd</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN351"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN352"><span class='Ref_To_Local'>snapshot</span></a><span class='Delimiter'>, 
</span>                                       <span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN396"><span class='Ref_To_Local'>heapTuple</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> 
                <a href="nodeBitmapHeapscan.c.html#LN348"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN76"><span class='Ref_to_Member'>rs_vistuples</span></a><span class='Delimiter'>[</span><a href="nodeBitmapHeapscan.c.html#LN353"><span class='Ref_To_Local'>ntup</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/storage/itemptr.h.html#LN93"><span class='Ref_to_Macro'>ItemPointerGetOffsetNumber</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN395"><span class='Ref_To_Local'>tid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if tbmres-&GT;ntuples&GT;=0 &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Bitmap is lossy, so we must examine each item pointer on the page. 
         * But we can ignore HOT chains, since we'll check each tuple anyway. 
         */ 
</span><a name="LN410"></a>        <a href="../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>dp</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a><span class='Parentheses'>) </span><a href="../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN351"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN411"></a>        <a href="../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>maxoff</span> <span class='Operator'>= </span><a href="../../include/storage/bufpage.h.html#LN353"><span class='Ref_to_Macro'>PageGetMaxOffsetNumber</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN410"><span class='Ref_To_Local'>dp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN412"></a>        <a href="../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>offnum</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN412"><span class='Ref_To_Local'>offnum</span></a> <span class='Operator'>= </span><a href="../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Delimiter'>; </span><a href="nodeBitmapHeapscan.c.html#LN412"><span class='Ref_To_Local'>offnum</span></a> <span class='Operator'>&LT;= </span><a href="nodeBitmapHeapscan.c.html#LN411"><span class='Ref_To_Local'>maxoff</span></a><span class='Delimiter'>; </span><a href="nodeBitmapHeapscan.c.html#LN412"><span class='Ref_To_Local'>offnum</span></a> <span class='Operator'>= </span><a href="../../include/storage/off.h.html#LN52"><span class='Ref_to_Macro'>OffsetNumberNext</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN412"><span class='Ref_To_Local'>offnum</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN416"></a>            <a href="../../include/storage/itemid.h.html#LN30"><span class='Ref_to_Typedef'>ItemId</span></a>      <span class='Declare_Local'>lp</span><span class='Delimiter'>; 
</span><a name="LN417"></a>            <a href="../../include/access/htup.h.html#LN61"><span class='Ref_to_Struct'>HeapTupleData</span></a> <span class='Declare_Local'>loctup</span><span class='Delimiter'>; 
</span><a name="LN418"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>valid</span><span class='Delimiter'>; 
</span> 
            <a href="nodeBitmapHeapscan.c.html#LN416"><span class='Ref_To_Local'>lp</span></a> <span class='Operator'>= </span><a href="../../include/storage/bufpage.h.html#LN231"><span class='Ref_to_Macro'>PageGetItemId</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN410"><span class='Ref_To_Local'>dp</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN412"><span class='Ref_To_Local'>offnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/storage/itemid.h.html#LN97"><span class='Ref_to_Macro'>ItemIdIsNormal</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN416"><span class='Ref_To_Local'>lp</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <a href="nodeBitmapHeapscan.c.html#LN417"><span class='Ref_To_Local'>loctup</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a><span class='Parentheses'>) </span><a href="../../include/storage/bufpage.h.html#LN336"><span class='Ref_to_Macro'>PageGetItem</span></a><span class='Parentheses'>((</span><a href="../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a><span class='Parentheses'>) </span><a href="nodeBitmapHeapscan.c.html#LN410"><span class='Ref_To_Local'>dp</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN416"><span class='Ref_To_Local'>lp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="nodeBitmapHeapscan.c.html#LN417"><span class='Ref_To_Local'>loctup</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a> <span class='Operator'>= </span><a href="../../include/storage/itemid.h.html#LN57"><span class='Ref_to_Macro'>ItemIdGetLength</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN416"><span class='Ref_To_Local'>lp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="nodeBitmapHeapscan.c.html#LN417"><span class='Ref_To_Local'>loctup</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN348"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN46"><span class='Ref_to_Member'>rs_rd</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN115"><span class='Ref_to_Member'>rd_id</span></a><span class='Delimiter'>; 
</span>            <a href="../../include/storage/itemptr.h.html#LN103"><span class='Ref_to_Macro'>ItemPointerSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN417"><span class='Ref_To_Local'>loctup</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN350"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN412"><span class='Ref_To_Local'>offnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="nodeBitmapHeapscan.c.html#LN418"><span class='Ref_To_Local'>valid</span></a> <span class='Operator'>= </span><a href="../../include/utils/tqual.h.html#LN44"><span class='Ref_to_Macro'>HeapTupleSatisfiesVisibility</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN417"><span class='Ref_To_Local'>loctup</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN352"><span class='Ref_To_Local'>snapshot</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN351"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN418"><span class='Ref_To_Local'>valid</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="nodeBitmapHeapscan.c.html#LN348"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN76"><span class='Ref_to_Member'>rs_vistuples</span></a><span class='Delimiter'>[</span><a href="nodeBitmapHeapscan.c.html#LN353"><span class='Ref_To_Local'>ntup</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN412"><span class='Ref_To_Local'>offnum</span></a><span class='Delimiter'>; 
</span>                <a href="../../include/storage/predicate.h.html#LN52"><span class='Ref_to_Proto'>PredicateLockTuple</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN348"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN46"><span class='Ref_to_Member'>rs_rd</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN417"><span class='Ref_To_Local'>loctup</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN352"><span class='Ref_To_Local'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="../../include/storage/predicate.h.html#LN59"><span class='Ref_to_Proto'>CheckForSerializableConflictOut</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN418"><span class='Ref_To_Local'>valid</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN348"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN46"><span class='Ref_to_Member'>rs_rd</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN417"><span class='Ref_To_Local'>loctup</span></a><span class='Delimiter'>, 
</span>                                            <a href="nodeBitmapHeapscan.c.html#LN351"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN352"><span class='Ref_To_Local'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for offnum=FirstOffsetNum... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <a href="../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN351"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><a href="../../include/storage/bufmgr.h.html#LN86"><span class='Ref_to_Const'>BUFFER_LOCK_UNLOCK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN353"><span class='Ref_To_Local'>ntup</span></a> <span class='Operator'>&LT;= </span><a href="../../include/access/htup_details.h.html#LN574"><span class='Ref_to_Const'>MaxHeapTuplesPerPage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeBitmapHeapscan.c.html#LN348"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN75"><span class='Ref_to_Member'>rs_ntuples</span></a> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN353"><span class='Ref_To_Local'>ntup</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end bitgetpage &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *  BitmapDoneInitializingSharedState - Shared state is initialized 
 * 
 *  By this time the leader has already populated the TBM and initialized the 
 *  shared state so wake up other processes. 
 */ 
</span><span class='Keyword'>static inline void 
</span><a name="LN451"></a><span class='Declare_Function'>BitmapDoneInitializingSharedState</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1269"><span class='Ref_to_Struct'>ParallelBitmapHeapState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../include/storage/spin.h.html#LN61"><span class='Ref_to_Macro'>SpinLockAcquire</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN451"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1273"><span class='Ref_to_Member'>mutex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeBitmapHeapscan.c.html#LN451"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1276"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="../../include/nodes/execnodes.h.html#LN1253"><span class='Ref_to_EnumConst'>BM_FINISHED</span></a><span class='Delimiter'>; 
</span>    <a href="../../include/storage/spin.h.html#LN63"><span class='Ref_to_Macro'>SpinLockRelease</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN451"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1273"><span class='Ref_to_Member'>mutex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/storage/condition_variable.h.html#LN56"><span class='Ref_to_Proto'>ConditionVariableBroadcast</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN451"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1277"><span class='Ref_to_Member'>cv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 *  BitmapAdjustPrefetchIterator - Adjust the prefetch iterator 
 */ 
</span><span class='Keyword'>static inline void 
</span><a name="LN463"></a><span class='Declare_Function'>BitmapAdjustPrefetchIterator</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1301"><span class='Ref_to_Struct'>BitmapHeapScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, 
</span><a name="LN464"></a>                             <a href="../../include/nodes/tidbitmap.h.html#LN39"><span class='Ref_to_Typedef'>TBMIterateResult</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tbmres</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> <a href="../../include/pg_config_manual.h.html#LN145"><span class='Ref_to_Const'>USE_PREFETCH</span></a> 
<a name="LN467"></a>    <a href="../../include/nodes/execnodes.h.html#LN1269"><span class='Ref_to_Struct'>ParallelBitmapHeapState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pstate</span> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN463"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1318"><span class='Ref_to_Member'>pstate</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN467"><span class='Ref_To_Local'>pstate</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN471"></a>        <a href="../nodes/tidbitmap.c.html#LN175"><span class='Ref_to_Struct'>TBMIterator</span></a> <span class='Operator'>*</span><span class='Declare_Local'>prefetch_iterator</span> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN463"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1310"><span class='Ref_to_Member'>prefetch_iterator</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN463"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1311"><span class='Ref_to_Member'>prefetch_pages</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* The main iterator has closed the distance by one page */ 
</span>            <a href="nodeBitmapHeapscan.c.html#LN463"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1311"><span class='Ref_to_Member'>prefetch_pages</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN471"><span class='Ref_To_Local'>prefetch_iterator</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Do not let the prefetch iterator get behind the main one */ 
</span><a name="LN481"></a>            <a href="../../include/nodes/tidbitmap.h.html#LN39"><span class='Ref_to_Typedef'>TBMIterateResult</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tbmpre</span> <span class='Operator'>= </span><a href="../../include/nodes/tidbitmap.h.html#LN66"><span class='Ref_to_Proto'>tbm_iterate</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN471"><span class='Ref_To_Local'>prefetch_iterator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN481"><span class='Ref_To_Local'>tbmpre</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="nodeBitmapHeapscan.c.html#LN481"><span class='Ref_To_Local'>tbmpre</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/tidbitmap.h.html#LN41"><span class='Ref_to_Member'>blockno</span></a> <span class='Operator'>!= </span><a href="nodeBitmapHeapscan.c.html#LN464"><span class='Ref_to_Parameter'>tbmres</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/tidbitmap.h.html#LN41"><span class='Ref_to_Member'>blockno</span></a><span class='Parentheses'>) 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"prefetch and main iterators are out of sync"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN463"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1313"><span class='Ref_to_Member'>prefetch_maximum</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN491"></a>        <a href="../nodes/tidbitmap.c.html#LN216"><span class='Ref_to_Struct'>TBMSharedIterator</span></a> <span class='Operator'>*</span><span class='Declare_Local'>prefetch_iterator</span> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN463"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1317"><span class='Ref_to_Member'>shared_prefetch_iterator</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../include/storage/spin.h.html#LN61"><span class='Ref_to_Macro'>SpinLockAcquire</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN467"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1273"><span class='Ref_to_Member'>mutex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN467"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1274"><span class='Ref_to_Member'>prefetch_pages</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="nodeBitmapHeapscan.c.html#LN467"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1274"><span class='Ref_to_Member'>prefetch_pages</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>            <a href="../../include/storage/spin.h.html#LN63"><span class='Ref_to_Macro'>SpinLockRelease</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN467"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1273"><span class='Ref_to_Member'>mutex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Release the mutex before iterating */ 
</span>            <a href="../../include/storage/spin.h.html#LN63"><span class='Ref_to_Macro'>SpinLockRelease</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN467"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1273"><span class='Ref_to_Member'>mutex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * In case of shared mode, we can not ensure that the current 
             * blockno of the main iterator and that of the prefetch iterator 
             * are same.  It's possible that whatever blockno we are 
             * prefetching will be processed by another process.  Therefore, 
             * we don't validate the blockno here as we do in non-parallel 
             * case. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN491"><span class='Ref_To_Local'>prefetch_iterator</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/nodes/tidbitmap.h.html#LN67"><span class='Ref_to_Proto'>tbm_shared_iterate</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN491"><span class='Ref_To_Local'>prefetch_iterator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if node-&GT;prefetch_maximu... &raquo; </span> 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* USE_PREFETCH */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end BitmapAdjustPrefetchIterator &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * BitmapAdjustPrefetchTarget - Adjust the prefetch target 
 * 
 * Increase prefetch target if it's not yet at the max.  Note that 
 * we will increase it to zero after fetching the very first 
 * page/tuple, then to one after the second tuple is fetched, then 
 * it doubles as later pages are fetched. 
 */ 
</span><span class='Keyword'>static inline void 
</span><a name="LN528"></a><span class='Declare_Function'>BitmapAdjustPrefetchTarget</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1301"><span class='Ref_to_Struct'>BitmapHeapScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> <a href="../../include/pg_config_manual.h.html#LN145"><span class='Ref_to_Const'>USE_PREFETCH</span></a> 
<a name="LN531"></a>    <a href="../../include/nodes/execnodes.h.html#LN1269"><span class='Ref_to_Struct'>ParallelBitmapHeapState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pstate</span> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN528"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1318"><span class='Ref_to_Member'>pstate</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN531"><span class='Ref_To_Local'>pstate</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN528"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1312"><span class='Ref_to_Member'>prefetch_target</span></a> <span class='Operator'>&GT;= </span><a href="nodeBitmapHeapscan.c.html#LN528"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1313"><span class='Ref_to_Member'>prefetch_maximum</span></a><span class='Parentheses'>) 
</span>             <span class='Comment_Multi_Line'>/* don't increase any further */ </span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN528"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1312"><span class='Ref_to_Member'>prefetch_target</span></a> <span class='Operator'>&GT;= </span><a href="nodeBitmapHeapscan.c.html#LN528"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1313"><span class='Ref_to_Member'>prefetch_maximum</span></a> <span class='Operator'>/ </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>            <a href="nodeBitmapHeapscan.c.html#LN528"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1312"><span class='Ref_to_Member'>prefetch_target</span></a> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN528"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1313"><span class='Ref_to_Member'>prefetch_maximum</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN528"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1312"><span class='Ref_to_Member'>prefetch_target</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="nodeBitmapHeapscan.c.html#LN528"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1312"><span class='Ref_to_Member'>prefetch_target</span></a> <span class='Operator'>*= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="nodeBitmapHeapscan.c.html#LN528"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1312"><span class='Ref_to_Member'>prefetch_target</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Do an unlocked check first to save spinlock acquisitions. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN531"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1275"><span class='Ref_to_Member'>prefetch_target</span></a> <span class='Operator'>&LT; </span><a href="nodeBitmapHeapscan.c.html#LN528"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1313"><span class='Ref_to_Member'>prefetch_maximum</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/storage/spin.h.html#LN61"><span class='Ref_to_Macro'>SpinLockAcquire</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN531"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1273"><span class='Ref_to_Member'>mutex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN531"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1275"><span class='Ref_to_Member'>prefetch_target</span></a> <span class='Operator'>&GT;= </span><a href="nodeBitmapHeapscan.c.html#LN528"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1313"><span class='Ref_to_Member'>prefetch_maximum</span></a><span class='Parentheses'>) 
</span>             <span class='Comment_Multi_Line'>/* don't increase any further */ </span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN531"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1275"><span class='Ref_to_Member'>prefetch_target</span></a> <span class='Operator'>&GT;= </span><a href="nodeBitmapHeapscan.c.html#LN528"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1313"><span class='Ref_to_Member'>prefetch_maximum</span></a> <span class='Operator'>/ </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>            <a href="nodeBitmapHeapscan.c.html#LN531"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1275"><span class='Ref_to_Member'>prefetch_target</span></a> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN528"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1313"><span class='Ref_to_Member'>prefetch_maximum</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN531"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1275"><span class='Ref_to_Member'>prefetch_target</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="nodeBitmapHeapscan.c.html#LN531"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1275"><span class='Ref_to_Member'>prefetch_target</span></a> <span class='Operator'>*= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="nodeBitmapHeapscan.c.html#LN531"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1275"><span class='Ref_to_Member'>prefetch_target</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="../../include/storage/spin.h.html#LN63"><span class='Ref_to_Macro'>SpinLockRelease</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN531"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1273"><span class='Ref_to_Member'>mutex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* USE_PREFETCH */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end BitmapAdjustPrefetchTarget &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * BitmapPrefetch - Prefetch, if prefetch_pages are behind prefetch_target 
 */ 
</span><span class='Keyword'>static inline void 
</span><a name="LN567"></a><span class='Declare_Function'>BitmapPrefetch</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1301"><span class='Ref_to_Struct'>BitmapHeapScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="../../include/access/heapam.h.html#LN99"><span class='Ref_to_Typedef'>HeapScanDesc</span></a> <span class='Declare_Parameter'>scan</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> <a href="../../include/pg_config_manual.h.html#LN145"><span class='Ref_to_Const'>USE_PREFETCH</span></a> 
<a name="LN570"></a>    <a href="../../include/nodes/execnodes.h.html#LN1269"><span class='Ref_to_Struct'>ParallelBitmapHeapState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pstate</span> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN567"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1318"><span class='Ref_to_Member'>pstate</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN570"><span class='Ref_To_Local'>pstate</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN574"></a>        <a href="../nodes/tidbitmap.c.html#LN175"><span class='Ref_to_Struct'>TBMIterator</span></a> <span class='Operator'>*</span><span class='Declare_Local'>prefetch_iterator</span> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN567"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1310"><span class='Ref_to_Member'>prefetch_iterator</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN574"><span class='Ref_To_Local'>prefetch_iterator</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN567"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1311"><span class='Ref_to_Member'>prefetch_pages</span></a> <span class='Operator'>&LT; </span><a href="nodeBitmapHeapscan.c.html#LN567"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1312"><span class='Ref_to_Member'>prefetch_target</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN580"></a>                <a href="../../include/nodes/tidbitmap.h.html#LN39"><span class='Ref_to_Typedef'>TBMIterateResult</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tbmpre</span> <span class='Operator'>= </span><a href="../../include/nodes/tidbitmap.h.html#LN66"><span class='Ref_to_Proto'>tbm_iterate</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN574"><span class='Ref_To_Local'>prefetch_iterator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN580"><span class='Ref_To_Local'>tbmpre</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* No more pages to prefetch */ 
</span>                    <a href="../../include/nodes/tidbitmap.h.html#LN68"><span class='Ref_to_Proto'>tbm_end_iterate</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN574"><span class='Ref_To_Local'>prefetch_iterator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="nodeBitmapHeapscan.c.html#LN567"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1310"><span class='Ref_to_Member'>prefetch_iterator</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="nodeBitmapHeapscan.c.html#LN567"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1311"><span class='Ref_to_Member'>prefetch_pages</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <a href="../../include/storage/bufmgr.h.html#LN165"><span class='Ref_to_Proto'>PrefetchBuffer</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN567"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN46"><span class='Ref_to_Member'>rs_rd</span></a><span class='Delimiter'>, </span><a href="../../include/common/relpath.h.html#LN26"><span class='Ref_to_EnumConst'>MAIN_FORKNUM</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN580"><span class='Ref_To_Local'>tbmpre</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/tidbitmap.h.html#LN41"><span class='Ref_to_Member'>blockno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if pstate==NULL &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN570"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1274"><span class='Ref_to_Member'>prefetch_pages</span></a> <span class='Operator'>&LT; </span><a href="nodeBitmapHeapscan.c.html#LN570"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1275"><span class='Ref_to_Member'>prefetch_target</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN599"></a>        <a href="../nodes/tidbitmap.c.html#LN216"><span class='Ref_to_Struct'>TBMSharedIterator</span></a> <span class='Operator'>*</span><span class='Declare_Local'>prefetch_iterator</span> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN567"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1317"><span class='Ref_to_Member'>shared_prefetch_iterator</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN599"><span class='Ref_To_Local'>prefetch_iterator</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN605"></a>                <a href="../../include/nodes/tidbitmap.h.html#LN39"><span class='Ref_to_Typedef'>TBMIterateResult</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tbmpre</span><span class='Delimiter'>; 
</span><a name="LN606"></a>                <span class='Keyword'>bool</span>        <span class='Declare_Local'>do_prefetch</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Recheck under the mutex. If some other process has already 
                 * done enough prefetching then we need not to do anything. 
                 */ 
</span>                <a href="../../include/storage/spin.h.html#LN61"><span class='Ref_to_Macro'>SpinLockAcquire</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN570"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1273"><span class='Ref_to_Member'>mutex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN570"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1274"><span class='Ref_to_Member'>prefetch_pages</span></a> <span class='Operator'>&LT; </span><a href="nodeBitmapHeapscan.c.html#LN570"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1275"><span class='Ref_to_Member'>prefetch_target</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="nodeBitmapHeapscan.c.html#LN570"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1274"><span class='Ref_to_Member'>prefetch_pages</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                    <a href="nodeBitmapHeapscan.c.html#LN606"><span class='Ref_To_Local'>do_prefetch</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="../../include/storage/spin.h.html#LN63"><span class='Ref_to_Macro'>SpinLockRelease</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN570"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1273"><span class='Ref_to_Member'>mutex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeBitmapHeapscan.c.html#LN606"><span class='Ref_To_Local'>do_prefetch</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
                <a href="nodeBitmapHeapscan.c.html#LN605"><span class='Ref_To_Local'>tbmpre</span></a> <span class='Operator'>= </span><a href="../../include/nodes/tidbitmap.h.html#LN67"><span class='Ref_to_Proto'>tbm_shared_iterate</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN599"><span class='Ref_To_Local'>prefetch_iterator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN605"><span class='Ref_To_Local'>tbmpre</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* No more pages to prefetch */ 
</span>                    <a href="../../include/nodes/tidbitmap.h.html#LN69"><span class='Ref_to_Proto'>tbm_end_shared_iterate</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN599"><span class='Ref_To_Local'>prefetch_iterator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="nodeBitmapHeapscan.c.html#LN567"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1317"><span class='Ref_to_Member'>shared_prefetch_iterator</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <a href="../../include/storage/bufmgr.h.html#LN165"><span class='Ref_to_Proto'>PrefetchBuffer</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN567"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN46"><span class='Ref_to_Member'>rs_rd</span></a><span class='Delimiter'>, </span><a href="../../include/common/relpath.h.html#LN26"><span class='Ref_to_EnumConst'>MAIN_FORKNUM</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN605"><span class='Ref_To_Local'>tbmpre</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/tidbitmap.h.html#LN41"><span class='Ref_to_Member'>blockno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while 1 &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if prefetch_iterator &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if pstate-&GT;prefetch_page... &raquo; </span> 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* USE_PREFETCH */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end BitmapPrefetch &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * BitmapHeapRecheck -- access method routine to recheck a tuple in EvalPlanQual 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN643"></a><span class='Declare_Function'>BitmapHeapRecheck</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1301"><span class='Ref_to_Struct'>BitmapHeapScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN645"></a>    <a href="../../include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>econtext</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * extract necessary information from index scan node 
     */ 
</span>    <a href="nodeBitmapHeapscan.c.html#LN645"><span class='Ref_To_Local'>econtext</span></a> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN643"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1303"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN842"><span class='Ref_to_Member'>ps_ExprContext</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Does the tuple meet the original qual conditions? */ 
</span>    <a href="nodeBitmapHeapscan.c.html#LN645"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN196"><span class='Ref_to_Member'>ecxt_scantuple</span></a> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN643"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/executor/executor.h.html#LN449"><span class='Ref_to_Macro'>ResetExprContext</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN645"><span class='Ref_To_Local'>econtext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/executor/executor.h.html#LN344"><span class='Ref_to_Func'>ExecQual</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN643"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1304"><span class='Ref_to_Member'>bitmapqualorig</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN645"><span class='Ref_To_Local'>econtext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      ExecBitmapHeapScan(node) 
 * ---------------------------------------------------------------- 
 */ 
</span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>* 
</span><a name="LN665"></a><span class='Declare_Function'>ExecBitmapHeapScan</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1301"><span class='Ref_to_Struct'>BitmapHeapScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="execScan.c.html#LN119"><span class='Ref_to_Func'>ExecScan</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN665"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1303"><span class='Ref_to_Member'>ss</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/executor/executor.h.html#LN388"><span class='Ref_to_Typedef'>ExecScanAccessMtd</span></a><span class='Parentheses'>) </span><a href="nodeBitmapHeapscan.c.html#LN53"><span class='Ref_to_Proto'>BitmapHeapNext</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/executor/executor.h.html#LN389"><span class='Ref_to_Typedef'>ExecScanRecheckMtd</span></a><span class='Parentheses'>) </span><a href="nodeBitmapHeapscan.c.html#LN642"><span class='Ref_to_Func'>BitmapHeapRecheck</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      ExecReScanBitmapHeapScan(node) 
 * ---------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN677"></a><span class='Declare_Function'>ExecReScanBitmapHeapScan</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1301"><span class='Ref_to_Struct'>BitmapHeapScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN679"></a>    <a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>outerPlan</span> <span class='Operator'>= </span><a href="../../include/nodes/execnodes.h.html#LN854"><span class='Ref_to_Macro'>outerPlanState</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN677"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* rescan to release any page pin */ 
</span>    <a href="../../include/access/heapam.h.html#LN123"><span class='Ref_to_Proto'>heap_rescan</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN677"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1303"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1059"><span class='Ref_to_Member'>ss_currentScanDesc</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN677"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1306"><span class='Ref_to_Member'>tbmiterator</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/nodes/tidbitmap.h.html#LN68"><span class='Ref_to_Proto'>tbm_end_iterate</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN677"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1306"><span class='Ref_to_Member'>tbmiterator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN677"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1310"><span class='Ref_to_Member'>prefetch_iterator</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/nodes/tidbitmap.h.html#LN68"><span class='Ref_to_Proto'>tbm_end_iterate</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN677"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1310"><span class='Ref_to_Member'>prefetch_iterator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN677"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1316"><span class='Ref_to_Member'>shared_tbmiterator</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/nodes/tidbitmap.h.html#LN69"><span class='Ref_to_Proto'>tbm_end_shared_iterate</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN677"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1316"><span class='Ref_to_Member'>shared_tbmiterator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN677"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1317"><span class='Ref_to_Member'>shared_prefetch_iterator</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/nodes/tidbitmap.h.html#LN69"><span class='Ref_to_Proto'>tbm_end_shared_iterate</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN677"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1317"><span class='Ref_to_Member'>shared_prefetch_iterator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN677"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1305"><span class='Ref_to_Member'>tbm</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/nodes/tidbitmap.h.html#LN51"><span class='Ref_to_Proto'>tbm_free</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN677"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1305"><span class='Ref_to_Member'>tbm</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeBitmapHeapscan.c.html#LN677"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1305"><span class='Ref_to_Member'>tbm</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="nodeBitmapHeapscan.c.html#LN677"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1306"><span class='Ref_to_Member'>tbmiterator</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="nodeBitmapHeapscan.c.html#LN677"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1307"><span class='Ref_to_Member'>tbmres</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="nodeBitmapHeapscan.c.html#LN677"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1310"><span class='Ref_to_Member'>prefetch_iterator</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="nodeBitmapHeapscan.c.html#LN677"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1315"><span class='Ref_to_Member'>initialized</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="nodeBitmapHeapscan.c.html#LN677"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1316"><span class='Ref_to_Member'>shared_tbmiterator</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="nodeBitmapHeapscan.c.html#LN677"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1317"><span class='Ref_to_Member'>shared_prefetch_iterator</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Reset parallel bitmap state, if present */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN677"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1318"><span class='Ref_to_Member'>pstate</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN705"></a>        <a href="../utils/mmgr/dsa.c.html#LN353"><span class='Ref_to_Struct'>dsa_area</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>dsa</span> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN677"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1303"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN814"><span class='Ref_to_Member'>state</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN487"><span class='Ref_to_Member'>es_query_dsa</span></a><span class='Delimiter'>; 
</span> 
        <a href="nodeBitmapHeapscan.c.html#LN677"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1318"><span class='Ref_to_Member'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1276"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="../../include/nodes/execnodes.h.html#LN1251"><span class='Ref_to_EnumConst'>BM_INITIAL</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/dsa.h.html#LN80"><span class='Ref_to_Macro'>DsaPointerIsValid</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN677"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1318"><span class='Ref_to_Member'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1271"><span class='Ref_to_Member'>tbmiterator</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/nodes/tidbitmap.h.html#LN52"><span class='Ref_to_Proto'>tbm_free_shared_area</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN705"><span class='Ref_To_Local'>dsa</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN677"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1318"><span class='Ref_to_Member'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1271"><span class='Ref_to_Member'>tbmiterator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/dsa.h.html#LN80"><span class='Ref_to_Macro'>DsaPointerIsValid</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN677"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1318"><span class='Ref_to_Member'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1272"><span class='Ref_to_Member'>prefetch_iterator</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/nodes/tidbitmap.h.html#LN52"><span class='Ref_to_Proto'>tbm_free_shared_area</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN705"><span class='Ref_To_Local'>dsa</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN677"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1318"><span class='Ref_to_Member'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1272"><span class='Ref_to_Member'>prefetch_iterator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="nodeBitmapHeapscan.c.html#LN677"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1318"><span class='Ref_to_Member'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1271"><span class='Ref_to_Member'>tbmiterator</span></a> <span class='Operator'>= </span><a href="../../include/utils/dsa.h.html#LN77"><span class='Ref_to_Const'>InvalidDsaPointer</span></a><span class='Delimiter'>; 
</span>        <a href="nodeBitmapHeapscan.c.html#LN677"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1318"><span class='Ref_to_Member'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1272"><span class='Ref_to_Member'>prefetch_iterator</span></a> <span class='Operator'>= </span><a href="../../include/utils/dsa.h.html#LN77"><span class='Ref_to_Const'>InvalidDsaPointer</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="execScan.c.html#LN325"><span class='Ref_to_Func'>ExecScanReScan</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN677"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1303"><span class='Ref_to_Member'>ss</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * if chgParam of subnode is not null then plan will be re-scanned by 
     * first ExecProcNode. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN679"><span class='Ref_To_Local'>outerPlan</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN836"><span class='Ref_to_Member'>chgParam</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="execAmi.c.html#LN73"><span class='Ref_to_Func'>ExecReScan</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN679"><span class='Ref_To_Local'>outerPlan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecReScanBitmapHeapScan &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      ExecEndBitmapHeapScan 
 * ---------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN734"></a><span class='Declare_Function'>ExecEndBitmapHeapScan</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1301"><span class='Ref_to_Struct'>BitmapHeapScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN736"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span><a name="LN737"></a>    <a href="../../include/access/heapam.h.html#LN99"><span class='Ref_to_Typedef'>HeapScanDesc</span></a> <span class='Declare_Local'>scanDesc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * extract information from the node 
     */ 
</span>    <a href="nodeBitmapHeapscan.c.html#LN736"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN734"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1303"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1058"><span class='Ref_to_Member'>ss_currentRelation</span></a><span class='Delimiter'>; 
</span>    <a href="nodeBitmapHeapscan.c.html#LN737"><span class='Ref_To_Local'>scanDesc</span></a> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN734"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1303"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1059"><span class='Ref_to_Member'>ss_currentScanDesc</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Free the exprcontext 
     */ 
</span>    <a href="../../include/executor/executor.h.html#LN476"><span class='Ref_to_Proto'>ExecFreeExprContext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN734"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1303"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * clear out tuple table slots 
     */ 
</span>    <a href="../../include/executor/tuptable.h.html#LN154"><span class='Ref_to_Proto'>ExecClearTuple</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN734"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1303"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN841"><span class='Ref_to_Member'>ps_ResultTupleSlot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/executor/tuptable.h.html#LN154"><span class='Ref_to_Proto'>ExecClearTuple</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN734"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1303"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1060"><span class='Ref_to_Member'>ss_ScanTupleSlot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * close down subplans 
     */ 
</span>    <a href="../../include/executor/executor.h.html#LN231"><span class='Ref_to_Proto'>ExecEndNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN854"><span class='Ref_to_Macro'>outerPlanState</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN734"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * release bitmap if any 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN734"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1306"><span class='Ref_to_Member'>tbmiterator</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/nodes/tidbitmap.h.html#LN68"><span class='Ref_to_Proto'>tbm_end_iterate</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN734"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1306"><span class='Ref_to_Member'>tbmiterator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN734"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1310"><span class='Ref_to_Member'>prefetch_iterator</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/nodes/tidbitmap.h.html#LN68"><span class='Ref_to_Proto'>tbm_end_iterate</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN734"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1310"><span class='Ref_to_Member'>prefetch_iterator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN734"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1305"><span class='Ref_to_Member'>tbm</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/nodes/tidbitmap.h.html#LN51"><span class='Ref_to_Proto'>tbm_free</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN734"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1305"><span class='Ref_to_Member'>tbm</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN734"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1316"><span class='Ref_to_Member'>shared_tbmiterator</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/nodes/tidbitmap.h.html#LN69"><span class='Ref_to_Proto'>tbm_end_shared_iterate</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN734"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1316"><span class='Ref_to_Member'>shared_tbmiterator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN734"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1317"><span class='Ref_to_Member'>shared_prefetch_iterator</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/nodes/tidbitmap.h.html#LN69"><span class='Ref_to_Proto'>tbm_end_shared_iterate</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN734"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1317"><span class='Ref_to_Member'>shared_prefetch_iterator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * close heap scan 
     */ 
</span>    <a href="../../include/access/heapam.h.html#LN126"><span class='Ref_to_Proto'>heap_endscan</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN737"><span class='Ref_To_Local'>scanDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * close the heap relation. 
     */ 
</span>    <a href="../../include/executor/executor.h.html#LN483"><span class='Ref_to_Proto'>ExecCloseScanRelation</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN736"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecEndBitmapHeapScan &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      ExecInitBitmapHeapScan 
 * 
 *      Initializes the scan's state information. 
 * ---------------------------------------------------------------- 
 */ 
</span><a href="../../include/nodes/execnodes.h.html#LN1301"><span class='Ref_to_Struct'>BitmapHeapScanState</span></a> <span class='Operator'>* 
</span><a name="LN793"></a><span class='Declare_Function'>ExecInitBitmapHeapScan</span><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN459"><span class='Ref_to_Struct'>BitmapHeapScan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>eflags</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN795"></a>    <a href="../../include/nodes/execnodes.h.html#LN1301"><span class='Ref_to_Struct'>BitmapHeapScanState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>scanstate</span><span class='Delimiter'>; 
</span><a name="LN796"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>currentRelation</span><span class='Delimiter'>; 
</span><a name="LN797"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>io_concurrency</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* check for unsupported flags */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN793"><span class='Ref_to_Parameter'>eflags</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><a href="../../include/executor/executor.h.html#LN59"><span class='Ref_to_Const'>EXEC_FLAG_BACKWARD</span></a> <span class='Operator'>| </span><a href="../../include/executor/executor.h.html#LN60"><span class='Ref_to_Const'>EXEC_FLAG_MARK</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Assert caller didn't ask for an unsafe snapshot --- see comments at 
     * head of file. 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/utils/tqual.h.html#LN30"><span class='Ref_to_Macro'>IsMVCCSnapshot</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN793"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN408"><span class='Ref_to_Member'>es_snapshot</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * create state structure 
     */ 
</span>    <a href="nodeBitmapHeapscan.c.html#LN795"><span class='Ref_To_Local'>scanstate</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1301"><span class='Ref_to_Struct'>BitmapHeapScanState</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeBitmapHeapscan.c.html#LN795"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1303"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN812"><span class='Ref_to_Member'>plan</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeBitmapHeapscan.c.html#LN793"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span>    <a href="nodeBitmapHeapscan.c.html#LN795"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1303"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN814"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN793"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>; 
</span> 
    <a href="nodeBitmapHeapscan.c.html#LN795"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1305"><span class='Ref_to_Member'>tbm</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="nodeBitmapHeapscan.c.html#LN795"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1306"><span class='Ref_to_Member'>tbmiterator</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="nodeBitmapHeapscan.c.html#LN795"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1307"><span class='Ref_to_Member'>tbmres</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="nodeBitmapHeapscan.c.html#LN795"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1308"><span class='Ref_to_Member'>exact_pages</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="nodeBitmapHeapscan.c.html#LN795"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1309"><span class='Ref_to_Member'>lossy_pages</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="nodeBitmapHeapscan.c.html#LN795"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1310"><span class='Ref_to_Member'>prefetch_iterator</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="nodeBitmapHeapscan.c.html#LN795"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1311"><span class='Ref_to_Member'>prefetch_pages</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="nodeBitmapHeapscan.c.html#LN795"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1312"><span class='Ref_to_Member'>prefetch_target</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* may be updated below */ 
</span>    <a href="nodeBitmapHeapscan.c.html#LN795"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1313"><span class='Ref_to_Member'>prefetch_maximum</span></a> <span class='Operator'>= </span><a href="../storage/buffer/bufmgr.c.html#LN128"><span class='Ref_to_Global_Var'>target_prefetch_pages</span></a><span class='Delimiter'>; 
</span>    <a href="nodeBitmapHeapscan.c.html#LN795"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1314"><span class='Ref_to_Member'>pscan_len</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="nodeBitmapHeapscan.c.html#LN795"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1315"><span class='Ref_to_Member'>initialized</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="nodeBitmapHeapscan.c.html#LN795"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1316"><span class='Ref_to_Member'>shared_tbmiterator</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="nodeBitmapHeapscan.c.html#LN795"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1318"><span class='Ref_to_Member'>pstate</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Miscellaneous initialization 
     * 
     * create expression context for node 
     */ 
</span>    <a href="execUtils.c.html#LN416"><span class='Ref_to_Func'>ExecAssignExprContext</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN793"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN795"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1303"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initialize child expressions 
     */ 
</span>    <a href="nodeBitmapHeapscan.c.html#LN795"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1303"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN826"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>= 
</span>        <a href="execExpr.c.html#LN158"><span class='Ref_to_Func'>ExecInitQual</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN793"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN461"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeBitmapHeapscan.c.html#LN795"><span class='Ref_To_Local'>scanstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeBitmapHeapscan.c.html#LN795"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1304"><span class='Ref_to_Member'>bitmapqualorig</span></a> <span class='Operator'>= 
</span>        <a href="execExpr.c.html#LN158"><span class='Ref_to_Func'>ExecInitQual</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN793"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN462"><span class='Ref_to_Member'>bitmapqualorig</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeBitmapHeapscan.c.html#LN795"><span class='Ref_To_Local'>scanstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * tuple table initialization 
     */ 
</span>    <a href="../../include/executor/executor.h.html#LN400"><span class='Ref_to_Proto'>ExecInitResultTupleSlot</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN793"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN795"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1303"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/executor/executor.h.html#LN401"><span class='Ref_to_Proto'>ExecInitScanTupleSlot</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN793"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN795"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1303"><span class='Ref_to_Member'>ss</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * open the base relation and acquire appropriate lock on it. 
     */ 
</span>    <a href="nodeBitmapHeapscan.c.html#LN796"><span class='Ref_To_Local'>currentRelation</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN482"><span class='Ref_to_Proto'>ExecOpenScanRelation</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN793"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN793"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN461"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../include/nodes/plannodes.h.html#LN328"><span class='Ref_to_Member'>scanrelid</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN793"><span class='Ref_to_Parameter'>eflags</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Determine the maximum for prefetch_target.  If the tablespace has a 
     * specific IO concurrency set, use that to compute the corresponding 
     * maximum value; otherwise, we already initialized to the value computed 
     * by the GUC machinery. 
     */ 
</span>    <a href="nodeBitmapHeapscan.c.html#LN797"><span class='Ref_To_Local'>io_concurrency</span></a> <span class='Operator'>= 
</span>        <a href="../../include/utils/spccache.h.html#LN17"><span class='Ref_to_Proto'>get_tablespace_io_concurrency</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN796"><span class='Ref_To_Local'>currentRelation</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltablespace<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN797"><span class='Ref_To_Local'>io_concurrency</span></a> <span class='Operator'>!= </span><a href="../storage/buffer/bufmgr.c.html#LN111"><span class='Ref_to_Global_Var'>effective_io_concurrency</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN866"></a>        <span class='Keyword'>double</span>      <span class='Declare_Local'>maximum</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/storage/bufmgr.h.html#LN164"><span class='Ref_to_Proto'>ComputeIoConcurrency</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN797"><span class='Ref_To_Local'>io_concurrency</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN866"><span class='Ref_To_Local'>maximum</span></a><span class='Parentheses'>))</span> 
            <a href="nodeBitmapHeapscan.c.html#LN795"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1313"><span class='Ref_to_Member'>prefetch_maximum</span></a> <span class='Operator'>= </span><a href="../../port/rint.c.html#LN20"><span class='Ref_to_Func'>rint</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN866"><span class='Ref_To_Local'>maximum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="nodeBitmapHeapscan.c.html#LN795"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1303"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1058"><span class='Ref_to_Member'>ss_currentRelation</span></a> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN796"><span class='Ref_To_Local'>currentRelation</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Even though we aren't going to do a conventional seqscan, it is useful 
     * to create a HeapScanDesc --- most of the fields in it are usable. 
     */ 
</span>    <a href="nodeBitmapHeapscan.c.html#LN795"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1303"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1059"><span class='Ref_to_Member'>ss_currentScanDesc</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN115"><span class='Ref_to_Proto'>heap_beginscan_bm</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN796"><span class='Ref_To_Local'>currentRelation</span></a><span class='Delimiter'>, 
</span>                                                         <a href="nodeBitmapHeapscan.c.html#LN793"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN408"><span class='Ref_to_Member'>es_snapshot</span></a><span class='Delimiter'>, 
</span>                                                         <span class='Number'>0</span><span class='Delimiter'>, 
</span>                                                         <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * get the scan type from the relation descriptor. 
     */ 
</span>    <a href="../../include/executor/executor.h.html#LN477"><span class='Ref_to_Proto'>ExecAssignScanType</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN795"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1303"><span class='Ref_to_Member'>ss</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN796"><span class='Ref_To_Local'>currentRelation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Initialize result tuple type and projection info. 
     */ 
</span>    <a href="execUtils.c.html#LN438"><span class='Ref_to_Func'>ExecAssignResultTypeFromTL</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN795"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1303"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="execScan.c.html#LN233"><span class='Ref_to_Func'>ExecAssignScanProjectionInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN795"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1303"><span class='Ref_to_Member'>ss</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initialize child nodes 
     * 
     * We do this last because the child nodes will open indexscans on our 
     * relation's indexes, and we want to be sure we have acquired a lock on 
     * the relation first. 
     */ 
</span>    <a href="../../include/nodes/execnodes.h.html#LN854"><span class='Ref_to_Macro'>outerPlanState</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN795"><span class='Ref_To_Local'>scanstate</span></a><span class='Parentheses'>) </span><span class='Operator'>= </span><a href="execProcnode.c.html#LN138"><span class='Ref_to_Func'>ExecInitNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN173"><span class='Ref_to_Macro'>outerPlan</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN793"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN793"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN793"><span class='Ref_to_Parameter'>eflags</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * all done. 
     */ 
</span>    <span class='Control'>return</span> <a href="nodeBitmapHeapscan.c.html#LN795"><span class='Ref_To_Local'>scanstate</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecInitBitmapHeapScan &raquo; </span> 
 
<span class='Comment_Multi_Line'>/*---------------- 
 *      BitmapShouldInitializeSharedState 
 * 
 *      The first process to come here and see the state to the BM_INITIAL 
 *      will become the leader for the parallel bitmap scan and will be 
 *      responsible for populating the TIDBitmap.  The other processes will 
 *      be blocked by the condition variable until the leader wakes them up. 
 * --------------- 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN919"></a><span class='Declare_Function'>BitmapShouldInitializeSharedState</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1269"><span class='Ref_to_Struct'>ParallelBitmapHeapState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN921"></a>    <a href="../../include/nodes/execnodes.h.html#LN1249"><span class='Ref_to_Typedef'>SharedBitmapState</span></a> <span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/storage/spin.h.html#LN61"><span class='Ref_to_Macro'>SpinLockAcquire</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN919"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1273"><span class='Ref_to_Member'>mutex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeBitmapHeapscan.c.html#LN921"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN919"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1276"><span class='Ref_to_Member'>state</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN919"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1276"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>== </span><a href="../../include/nodes/execnodes.h.html#LN1251"><span class='Ref_to_EnumConst'>BM_INITIAL</span></a><span class='Parentheses'>) 
</span>            <a href="nodeBitmapHeapscan.c.html#LN919"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1276"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="../../include/nodes/execnodes.h.html#LN1252"><span class='Ref_to_EnumConst'>BM_INPROGRESS</span></a><span class='Delimiter'>; 
</span>        <a href="../../include/storage/spin.h.html#LN63"><span class='Ref_to_Macro'>SpinLockRelease</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN919"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1273"><span class='Ref_to_Member'>mutex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Exit if bitmap is done, or if we're the leader. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN921"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/execnodes.h.html#LN1252"><span class='Ref_to_EnumConst'>BM_INPROGRESS</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Wait for the leader to wake us up. */ 
</span>        <a href="../../include/storage/condition_variable.h.html#LN44"><span class='Ref_to_Proto'>ConditionVariableSleep</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN919"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1277"><span class='Ref_to_Member'>cv</span></a><span class='Delimiter'>, </span><a href="../../include/pgstat.h.html#LN809"><span class='Ref_to_EnumConst'>WAIT_EVENT_PARALLEL_BITMAP_SCAN</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/storage/condition_variable.h.html#LN45"><span class='Ref_to_Proto'>ConditionVariableCancelSleep</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN921"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>== </span><a href="../../include/nodes/execnodes.h.html#LN1251"><span class='Ref_to_EnumConst'>BM_INITIAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end BitmapShouldInitializeSharedState &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      ExecBitmapHeapEstimate 
 * 
 *      estimates the space required to serialize bitmap scan node. 
 * ---------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN951"></a><span class='Declare_Function'>ExecBitmapHeapEstimate</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1301"><span class='Ref_to_Struct'>BitmapHeapScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, 
</span><a name="LN952"></a>                       <a href="../../include/access/parallel.h.html#LN31"><span class='Ref_to_Struct'>ParallelContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pcxt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN954"></a>    <a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>estate</span> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN951"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1303"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN814"><span class='Ref_to_Member'>state</span></a><span class='Delimiter'>; 
</span> 
    <a href="nodeBitmapHeapscan.c.html#LN951"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1314"><span class='Ref_to_Member'>pscan_len</span></a> <span class='Operator'>= </span><a href="../../include/storage/shmem.h.html#LN44"><span class='Ref_to_Proto'>add_size</span></a><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1269"><span class='Ref_to_Struct'>ParallelBitmapHeapState</span></a><span class='Delimiter'>, 
</span>                                        phs_snapshot_data<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                               <a href="../../include/utils/snapmgr.h.html#LN107"><span class='Ref_to_Proto'>EstimateSnapshotSpace</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN954"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN408"><span class='Ref_to_Member'>es_snapshot</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/storage/shm_toc.h.html#LN50"><span class='Ref_to_Macro'>shm_toc_estimate_chunk</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN952"><span class='Ref_to_Parameter'>pcxt</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/parallel.h.html#LN40"><span class='Ref_to_Member'>estimator</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN951"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1314"><span class='Ref_to_Member'>pscan_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/storage/shm_toc.h.html#LN52"><span class='Ref_to_Macro'>shm_toc_estimate_keys</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN952"><span class='Ref_to_Parameter'>pcxt</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/parallel.h.html#LN40"><span class='Ref_to_Member'>estimator</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      ExecBitmapHeapInitializeDSM 
 * 
 *      Set up a parallel bitmap heap scan descriptor. 
 * ---------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN971"></a><span class='Declare_Function'>ExecBitmapHeapInitializeDSM</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1301"><span class='Ref_to_Struct'>BitmapHeapScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, 
</span><a name="LN972"></a>                            <a href="../../include/access/parallel.h.html#LN31"><span class='Ref_to_Struct'>ParallelContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pcxt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN974"></a>    <a href="../../include/nodes/execnodes.h.html#LN1269"><span class='Ref_to_Struct'>ParallelBitmapHeapState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pstate</span><span class='Delimiter'>; 
</span><a name="LN975"></a>    <a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>estate</span> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN971"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1303"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN814"><span class='Ref_to_Member'>state</span></a><span class='Delimiter'>; 
</span> 
    <a href="nodeBitmapHeapscan.c.html#LN974"><span class='Ref_To_Local'>pstate</span></a> <span class='Operator'>= </span><a href="../../include/storage/shm_toc.h.html#LN31"><span class='Ref_to_Proto'>shm_toc_allocate</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN972"><span class='Ref_to_Parameter'>pcxt</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/parallel.h.html#LN43"><span class='Ref_to_Member'>toc</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN971"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1314"><span class='Ref_to_Member'>pscan_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="nodeBitmapHeapscan.c.html#LN974"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1271"><span class='Ref_to_Member'>tbmiterator</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="nodeBitmapHeapscan.c.html#LN974"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1272"><span class='Ref_to_Member'>prefetch_iterator</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Initialize the mutex */ 
</span>    <a href="../../include/storage/spin.h.html#LN59"><span class='Ref_to_Macro'>SpinLockInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN974"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1273"><span class='Ref_to_Member'>mutex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeBitmapHeapscan.c.html#LN974"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1274"><span class='Ref_to_Member'>prefetch_pages</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="nodeBitmapHeapscan.c.html#LN974"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1275"><span class='Ref_to_Member'>prefetch_target</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="nodeBitmapHeapscan.c.html#LN974"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1276"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="../../include/nodes/execnodes.h.html#LN1251"><span class='Ref_to_EnumConst'>BM_INITIAL</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/storage/condition_variable.h.html#LN34"><span class='Ref_to_Proto'>ConditionVariableInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeBitmapHeapscan.c.html#LN974"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1277"><span class='Ref_to_Member'>cv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/snapmgr.h.html#LN108"><span class='Ref_to_Proto'>SerializeSnapshot</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN975"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN408"><span class='Ref_to_Member'>es_snapshot</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN974"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1278"><span class='Ref_to_Member'>phs_snapshot_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/storage/shm_toc.h.html#LN33"><span class='Ref_to_Proto'>shm_toc_insert</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN972"><span class='Ref_to_Parameter'>pcxt</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/parallel.h.html#LN43"><span class='Ref_to_Member'>toc</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN971"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1303"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN812"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN142"><span class='Ref_to_Member'>plan_node_id</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN974"><span class='Ref_To_Local'>pstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeBitmapHeapscan.c.html#LN971"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1318"><span class='Ref_to_Member'>pstate</span></a> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN974"><span class='Ref_To_Local'>pstate</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecBitmapHeapInitializeDSM &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      ExecBitmapHeapInitializeWorker 
 * 
 *      Copy relevant information from TOC into planstate. 
 * ---------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1002"></a><span class='Declare_Function'>ExecBitmapHeapInitializeWorker</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1301"><span class='Ref_to_Struct'>BitmapHeapScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="../storage/ipc/shm_toc.c.html#LN25"><span class='Ref_to_Struct'>shm_toc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>toc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1004"></a>    <a href="../../include/nodes/execnodes.h.html#LN1269"><span class='Ref_to_Struct'>ParallelBitmapHeapState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pstate</span><span class='Delimiter'>; 
</span><a name="LN1005"></a>    <a href="../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a>    <span class='Declare_Local'>snapshot</span><span class='Delimiter'>; 
</span> 
    <a href="nodeBitmapHeapscan.c.html#LN1004"><span class='Ref_To_Local'>pstate</span></a> <span class='Operator'>= </span><a href="../../include/storage/shm_toc.h.html#LN34"><span class='Ref_to_Proto'>shm_toc_lookup</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN1002"><span class='Ref_to_Parameter'>toc</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN1002"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1303"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN812"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN142"><span class='Ref_to_Member'>plan_node_id</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeBitmapHeapscan.c.html#LN1002"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1318"><span class='Ref_to_Member'>pstate</span></a> <span class='Operator'>= </span><a href="nodeBitmapHeapscan.c.html#LN1004"><span class='Ref_To_Local'>pstate</span></a><span class='Delimiter'>; 
</span> 
    <a href="nodeBitmapHeapscan.c.html#LN1005"><span class='Ref_To_Local'>snapshot</span></a> <span class='Operator'>= </span><a href="../../include/utils/snapmgr.h.html#LN109"><span class='Ref_to_Proto'>RestoreSnapshot</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN1004"><span class='Ref_To_Local'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1278"><span class='Ref_to_Member'>phs_snapshot_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN181"><span class='Ref_to_Proto'>heap_update_snapshot</span></a><span class='Parentheses'>(</span><a href="nodeBitmapHeapscan.c.html#LN1002"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1303"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1059"><span class='Ref_to_Member'>ss_currentScanDesc</span></a><span class='Delimiter'>, </span><a href="nodeBitmapHeapscan.c.html#LN1005"><span class='Ref_To_Local'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>