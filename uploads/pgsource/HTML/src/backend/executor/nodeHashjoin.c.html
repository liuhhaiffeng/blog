<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\executor\nodeHashjoin.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\executor\nodeHashjoin.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:39 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * nodeHashjoin.c 
 *    Routines to handle hash join nodes 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/executor/nodeHashjoin.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"executor/executor.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"executor/hashjoin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"executor/nodeHash.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"executor/nodeHashjoin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * States of the ExecHashJoin state machine 
 */ 
</span><a name="LN29"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>HJ_BUILD_HASHTABLE</span>      <span class='Number'>1</span> 
<a name="LN30"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>HJ_NEED_NEW_OUTER</span>       <span class='Number'>2</span> 
<a name="LN31"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>HJ_SCAN_BUCKET</span>          <span class='Number'>3</span> 
<a name="LN32"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>HJ_FILL_OUTER_TUPLE</span>     <span class='Number'>4</span> 
<a name="LN33"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>HJ_FILL_INNER_TUPLES</span>    <span class='Number'>5</span> 
<a name="LN34"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>HJ_NEED_NEW_BATCH</span>       <span class='Number'>6</span> 
 
<span class='Comment_Multi_Line'>/* Returns true if doing null-fill on outer relation */ 
</span><a name="LN37"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>HJ_FILL_OUTER</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>hjstate</span><span class='Parentheses'>)</span>  <span class='Parentheses'>((</span><a href="nodeHashjoin.c.html#LN37"><span class='Ref_to_Parameter'>hjstate</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>hj_NullInnerTupleSlot <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
<span class='Comment_Multi_Line'>/* Returns true if doing null-fill on inner relation */ 
</span><a name="LN39"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>HJ_FILL_INNER</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>hjstate</span><span class='Parentheses'>)</span>  <span class='Parentheses'>((</span><a href="nodeHashjoin.c.html#LN39"><span class='Ref_to_Parameter'>hjstate</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>hj_NullOuterTupleSlot <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
 
<a name="LN41"></a><span class='Keyword'>static </span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>ExecHashJoinOuterGetTuple</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>outerNode</span><span class='Delimiter'>, 
</span><a name="LN42"></a>                          <a href="../../include/nodes/execnodes.h.html#LN1648"><span class='Ref_to_Struct'>HashJoinState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hjstate</span><span class='Delimiter'>, 
</span><a name="LN43"></a>                          <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hashvalue</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN44"></a><span class='Keyword'>static </span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>ExecHashJoinGetSavedTuple</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1648"><span class='Ref_to_Struct'>HashJoinState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hjstate</span><span class='Delimiter'>, 
</span><a name="LN45"></a>                          <a href="../storage/file/buffile.c.html#LN58"><span class='Ref_to_Struct'>BufFile</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>file</span><span class='Delimiter'>, 
</span><a name="LN46"></a>                          <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hashvalue</span><span class='Delimiter'>, 
</span><a name="LN47"></a>                          <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tupleSlot</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN48"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>ExecHashJoinNewBatch</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1648"><span class='Ref_to_Struct'>HashJoinState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hjstate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      ExecHashJoin 
 * 
 *      This function implements the Hybrid Hashjoin algorithm. 
 * 
 *      Note: the relation we build hash table on is the "inner" 
 *            the other one is "outer". 
 * ---------------------------------------------------------------- 
 */ 
</span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span>                <span class='Comment_Single_Line'>/* return: a tuple or NULL */ 
</span><a name="LN61"></a><span class='Declare_Function'>ExecHashJoin</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1648"><span class='Ref_to_Struct'>HashJoinState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN63"></a>    <a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>outerNode</span><span class='Delimiter'>; 
</span><a name="LN64"></a>    <a href="../../include/nodes/execnodes.h.html#LN1920"><span class='Ref_to_Struct'>HashState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>hashNode</span><span class='Delimiter'>; 
</span><a name="LN65"></a>    <a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>joinqual</span><span class='Delimiter'>; 
</span><a name="LN66"></a>    <a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>otherqual</span><span class='Delimiter'>; 
</span><a name="LN67"></a>    <a href="../../include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>econtext</span><span class='Delimiter'>; 
</span><a name="LN68"></a>    <a href="../../include/nodes/execnodes.h.html#LN1646"><span class='Ref_to_Typedef'>HashJoinTable</span></a> <span class='Declare_Local'>hashtable</span><span class='Delimiter'>; 
</span><a name="LN69"></a>    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>outerTupleSlot</span><span class='Delimiter'>; 
</span><a name="LN70"></a>    <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>hashvalue</span><span class='Delimiter'>; 
</span><a name="LN71"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>batchno</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * get information from HashJoin node 
     */ 
</span>    <a href="nodeHashjoin.c.html#LN65"><span class='Ref_To_Local'>joinqual</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1650"><span class='Ref_to_Member'>js</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1551"><span class='Ref_to_Member'>joinqual</span></a><span class='Delimiter'>; 
</span>    <a href="nodeHashjoin.c.html#LN66"><span class='Ref_To_Local'>otherqual</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1650"><span class='Ref_to_Member'>js</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1547"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN826"><span class='Ref_to_Member'>qual</span></a><span class='Delimiter'>; 
</span>    <a href="nodeHashjoin.c.html#LN64"><span class='Ref_To_Local'>hashNode</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1920"><span class='Ref_to_Struct'>HashState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/execnodes.h.html#LN853"><span class='Ref_to_Macro'>innerPlanState</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeHashjoin.c.html#LN63"><span class='Ref_To_Local'>outerNode</span></a> <span class='Operator'>= </span><a href="../../include/nodes/execnodes.h.html#LN854"><span class='Ref_to_Macro'>outerPlanState</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeHashjoin.c.html#LN68"><span class='Ref_To_Local'>hashtable</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1655"><span class='Ref_to_Member'>hj_HashTable</span></a><span class='Delimiter'>; 
</span>    <a href="nodeHashjoin.c.html#LN67"><span class='Ref_To_Local'>econtext</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1650"><span class='Ref_to_Member'>js</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1547"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN842"><span class='Ref_to_Member'>ps_ExprContext</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Reset per-tuple memory context to free any expression evaluation 
     * storage allocated in the previous tuple cycle. 
     */ 
</span>    <a href="../../include/executor/executor.h.html#LN449"><span class='Ref_to_Macro'>ResetExprContext</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN67"><span class='Ref_To_Local'>econtext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * run the hash join state machine 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1665"><span class='Ref_to_Member'>hj_JoinState</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="nodeHashjoin.c.html#LN29"><span class='Ref_to_Const'>HJ_BUILD_HASHTABLE</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * First time through: build hash table for inner relation. 
                 */ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN68"><span class='Ref_To_Local'>hashtable</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * If the outer relation is completely empty, and it's not 
                 * right/full join, we can quit without building the hash 
                 * table.  However, for an inner join it is only a win to 
                 * check this when the outer relation's startup cost is less 
                 * than the projected cost of building the hash table. 
                 * Otherwise it's best to build the hash table first and see 
                 * if the inner relation is empty.  (When it's a left join, we 
                 * should always make this check, since we aren't going to be 
                 * able to skip the join on the strength of an empty inner 
                 * relation anyway.) 
                 * 
                 * If we are rescanning the join, we make use of information 
                 * gained on the previous scan: don't bother to try the 
                 * prefetch if the previous scan found the outer relation 
                 * nonempty. This is not 100% reliable since with new 
                 * parameters the outer relation might yield different 
                 * results, but it's a good heuristic. 
                 * 
                 * The only way to make the check is to try to fetch a tuple 
                 * from the outer plan node.  If we succeed, we have to stash 
                 * it away for later consumption by ExecHashJoinOuterGetTuple. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN39"><span class='Ref_to_Macro'>HJ_FILL_INNER</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* no chance to not build the hash table */ 
</span>                    <a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1664"><span class='Ref_to_Member'>hj_FirstOuterTupleSlot</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN37"><span class='Ref_to_Macro'>HJ_FILL_OUTER</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>                         <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN63"><span class='Ref_To_Local'>outerNode</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN812"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN124"><span class='Ref_to_Member'>startup_cost</span></a> <span class='Operator'>&LT; </span><a href="nodeHashjoin.c.html#LN64"><span class='Ref_To_Local'>hashNode</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1922"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN812"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN125"><span class='Ref_to_Member'>total_cost</span></a> <span class='Operator'>&& 
</span>                          <span class='Operator'>!</span><a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1667"><span class='Ref_to_Member'>hj_OuterNotEmpty</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1664"><span class='Ref_to_Member'>hj_FirstOuterTupleSlot</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN229"><span class='Ref_to_Proto'>ExecProcNode</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN63"><span class='Ref_To_Local'>outerNode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/executor/tuptable.h.html#LN137"><span class='Ref_to_Macro'>TupIsNull</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1664"><span class='Ref_to_Member'>hj_FirstOuterTupleSlot</span></a><span class='Parentheses'>))</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1667"><span class='Ref_to_Member'>hj_OuterNotEmpty</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                        <a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1667"><span class='Ref_to_Member'>hj_OuterNotEmpty</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                    <a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1664"><span class='Ref_to_Member'>hj_FirstOuterTupleSlot</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * create the hash table 
                 */ 
</span>                <a href="nodeHashjoin.c.html#LN68"><span class='Ref_To_Local'>hashtable</span></a> <span class='Operator'>= </span><a href="../../include/executor/nodeHash.h.html#LN24"><span class='Ref_to_Proto'>ExecHashTableCreate</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/plannodes.h.html#LN863"><span class='Ref_to_Struct'>Hash</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeHashjoin.c.html#LN64"><span class='Ref_To_Local'>hashNode</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1922"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN812"><span class='Ref_to_Member'>plan</span></a><span class='Delimiter'>, 
</span>                                                <a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1654"><span class='Ref_to_Member'>hj_HashOperators</span></a><span class='Delimiter'>, 
</span>                                                <a href="nodeHashjoin.c.html#LN39"><span class='Ref_to_Macro'>HJ_FILL_INNER</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1655"><span class='Ref_to_Member'>hj_HashTable</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN68"><span class='Ref_To_Local'>hashtable</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * execute the Hash node, to build the hash table 
                 */ 
</span>                <a href="nodeHashjoin.c.html#LN64"><span class='Ref_To_Local'>hashNode</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1923"><span class='Ref_to_Member'>hashtable</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN68"><span class='Ref_To_Local'>hashtable</span></a><span class='Delimiter'>; 
</span>                <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../include/executor/executor.h.html#LN230"><span class='Ref_to_Proto'>MultiExecProcNode</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeHashjoin.c.html#LN64"><span class='Ref_To_Local'>hashNode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * If the inner relation is completely empty, and we're not 
                 * doing a left outer join, we can quit without scanning the 
                 * outer relation. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN68"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN155"><span class='Ref_to_Member'>totalTuples</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& !</span><a href="nodeHashjoin.c.html#LN37"><span class='Ref_to_Macro'>HJ_FILL_OUTER</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * need to remember whether nbatch has increased since we 
                 * began scanning the outer relation 
                 */ 
</span>                <a href="nodeHashjoin.c.html#LN68"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN151"><span class='Ref_to_Member'>nbatch_outstart</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN68"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN147"><span class='Ref_to_Member'>nbatch</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Reset OuterNotEmpty for scan.  (It's OK if we fetched a 
                 * tuple above, because ExecHashJoinOuterGetTuple will 
                 * immediately set it again.) 
                 */ 
</span>                <a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1667"><span class='Ref_to_Member'>hj_OuterNotEmpty</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
                <a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1665"><span class='Ref_to_Member'>hj_JoinState</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN30"><span class='Ref_to_Const'>HJ_NEED_NEW_OUTER</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* FALL THRU */ 
</span> 
            <span class='Control'>case</span> <a href="nodeHashjoin.c.html#LN30"><span class='Ref_to_Const'>HJ_NEED_NEW_OUTER</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * We don't have an outer tuple, try to get the next one 
                 */ 
</span>                <a href="nodeHashjoin.c.html#LN69"><span class='Ref_To_Local'>outerTupleSlot</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN41"><span class='Ref_to_Proto'>ExecHashJoinOuterGetTuple</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN63"><span class='Ref_To_Local'>outerNode</span></a><span class='Delimiter'>, 
</span>                                                           <a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, 
</span>                                                           <span class='Operator'>&</span><a href="nodeHashjoin.c.html#LN70"><span class='Ref_To_Local'>hashvalue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/executor/tuptable.h.html#LN137"><span class='Ref_to_Macro'>TupIsNull</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN69"><span class='Ref_To_Local'>outerTupleSlot</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* end of batch, or maybe whole join */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN39"><span class='Ref_to_Macro'>HJ_FILL_INNER</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>))</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* set up to scan for unmatched inner tuples */ 
</span>                        <a href="../../include/executor/nodeHash.h.html#LN41"><span class='Ref_to_Proto'>ExecPrepHashTableForUnmatched</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1665"><span class='Ref_to_Member'>hj_JoinState</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN33"><span class='Ref_to_Const'>HJ_FILL_INNER_TUPLES</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                        <a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1665"><span class='Ref_to_Member'>hj_JoinState</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN34"><span class='Ref_to_Const'>HJ_NEED_NEW_BATCH</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <a href="nodeHashjoin.c.html#LN67"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN198"><span class='Ref_to_Member'>ecxt_outertuple</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN69"><span class='Ref_To_Local'>outerTupleSlot</span></a><span class='Delimiter'>; 
</span>                <a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1666"><span class='Ref_to_Member'>hj_MatchedOuter</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Find the corresponding bucket for this tuple in the main 
                 * hash table or skew hash table. 
                 */ 
</span>                <a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1656"><span class='Ref_to_Member'>hj_CurHashValue</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN70"><span class='Ref_To_Local'>hashvalue</span></a><span class='Delimiter'>; 
</span>                <a href="../../include/executor/nodeHash.h.html#LN36"><span class='Ref_to_Proto'>ExecHashGetBucketAndBatch</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN68"><span class='Ref_To_Local'>hashtable</span></a><span class='Delimiter'>, </span><a href="nodeHashjoin.c.html#LN70"><span class='Ref_To_Local'>hashvalue</span></a><span class='Delimiter'>, 
</span>                                          <span class='Operator'>&</span><a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1657"><span class='Ref_to_Member'>hj_CurBucketNo</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeHashjoin.c.html#LN71"><span class='Ref_To_Local'>batchno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1658"><span class='Ref_to_Member'>hj_CurSkewBucketNo</span></a> <span class='Operator'>= </span><a href="../../include/executor/nodeHash.h.html#LN50"><span class='Ref_to_Proto'>ExecHashGetSkewBucket</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN68"><span class='Ref_To_Local'>hashtable</span></a><span class='Delimiter'>, 
</span>                                                                 <a href="nodeHashjoin.c.html#LN70"><span class='Ref_To_Local'>hashvalue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1659"><span class='Ref_to_Member'>hj_CurTuple</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * The tuple might not belong to the current batch (where 
                 * "current batch" includes the skew buckets if any). 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN71"><span class='Ref_To_Local'>batchno</span></a> <span class='Operator'>!= </span><a href="nodeHashjoin.c.html#LN68"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN148"><span class='Ref_to_Member'>curbatch</span></a> <span class='Operator'>&& 
</span>                    <a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1658"><span class='Ref_to_Member'>hj_CurSkewBucketNo</span></a> <span class='Operator'>== </span><a href="../../include/executor/hashjoin.h.html#LN100"><span class='Ref_to_Const'>INVALID_SKEW_BUCKET_NO</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * Need to postpone this outer tuple to a later batch. 
                     * Save it in the corresponding outer-batch file. 
                     */ 
</span>                    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN71"><span class='Ref_To_Local'>batchno</span></a> <span class='Operator'>&GT; </span><a href="nodeHashjoin.c.html#LN68"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN148"><span class='Ref_to_Member'>curbatch</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../include/executor/nodeHashjoin.h.html#LN24"><span class='Ref_to_Proto'>ExecHashJoinSaveTuple</span></a><span class='Parentheses'>(</span><a href="../../include/executor/tuptable.h.html#LN160"><span class='Ref_to_Proto'>ExecFetchSlotMinimalTuple</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN69"><span class='Ref_To_Local'>outerTupleSlot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                          <a href="nodeHashjoin.c.html#LN70"><span class='Ref_To_Local'>hashvalue</span></a><span class='Delimiter'>, 
</span>                                        <span class='Operator'>&</span><a href="nodeHashjoin.c.html#LN68"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN166"><span class='Ref_to_Member'>outerBatchFile</span></a><span class='Delimiter'>[</span><a href="nodeHashjoin.c.html#LN71"><span class='Ref_To_Local'>batchno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* Loop around, staying in HJ_NEED_NEW_OUTER state */ 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* OK, let's scan the bucket for matches */ 
</span>                <a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1665"><span class='Ref_to_Member'>hj_JoinState</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN31"><span class='Ref_to_Const'>HJ_SCAN_BUCKET</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* FALL THRU */ 
</span> 
            <span class='Control'>case</span> <a href="nodeHashjoin.c.html#LN31"><span class='Ref_to_Const'>HJ_SCAN_BUCKET</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * We check for interrupts here because this corresponds to 
                 * where we'd fetch a row from a child plan node in other join 
                 * types. 
                 */ 
</span>                <a href="../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Scan the selected hash bucket for matches to current outer 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/executor/nodeHash.h.html#LN40"><span class='Ref_to_Proto'>ExecScanHashBucket</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="nodeHashjoin.c.html#LN67"><span class='Ref_To_Local'>econtext</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* out of matches; check for possible outer-join fill */ 
</span>                    <a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1665"><span class='Ref_to_Member'>hj_JoinState</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN32"><span class='Ref_to_Const'>HJ_FILL_OUTER_TUPLE</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * We've got a match, but still need to test non-hashed quals. 
                 * ExecScanHashBucket already set up all the state needed to 
                 * call ExecQual. 
                 * 
                 * If we pass the qual, then save state for next call and have 
                 * ExecProject form the projection, store it in the tuple 
                 * table, and return the slot. 
                 * 
                 * Only the joinquals determine tuple match status, but all 
                 * quals must pass to actually return the tuple. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN65"><span class='Ref_To_Local'>joinqual</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="../../include/executor/executor.h.html#LN344"><span class='Ref_to_Func'>ExecQual</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN65"><span class='Ref_To_Local'>joinqual</span></a><span class='Delimiter'>, </span><a href="nodeHashjoin.c.html#LN67"><span class='Ref_To_Local'>econtext</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1666"><span class='Ref_to_Member'>hj_MatchedOuter</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <a href="../../include/access/htup_details.h.html#LN521"><span class='Ref_to_Macro'>HeapTupleHeaderSetMatch</span></a><span class='Parentheses'>(</span><a href="../../include/executor/hashjoin.h.html#LN71"><span class='Ref_to_Macro'>HJTUPLE_MINTUPLE</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1659"><span class='Ref_to_Member'>hj_CurTuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* In an antijoin, we never return a matched tuple */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1650"><span class='Ref_to_Member'>js</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1548"><span class='Ref_to_Member'>jointype</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN692"><span class='Ref_to_EnumConst'>JOIN_ANTI</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1665"><span class='Ref_to_Member'>hj_JoinState</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN30"><span class='Ref_to_Const'>HJ_NEED_NEW_OUTER</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * If we only need to join to the first matching inner 
                     * tuple, then consider returning this one, but after that 
                     * continue with next outer tuple. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1650"><span class='Ref_to_Member'>js</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1549"><span class='Ref_to_Member'>single_match</span></a><span class='Parentheses'>) 
</span>                        <a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1665"><span class='Ref_to_Member'>hj_JoinState</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN30"><span class='Ref_to_Const'>HJ_NEED_NEW_OUTER</span></a><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN66"><span class='Ref_To_Local'>otherqual</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="../../include/executor/executor.h.html#LN344"><span class='Ref_to_Func'>ExecQual</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN66"><span class='Ref_To_Local'>otherqual</span></a><span class='Delimiter'>, </span><a href="nodeHashjoin.c.html#LN67"><span class='Ref_To_Local'>econtext</span></a><span class='Parentheses'>))</span> 
                        <span class='Control'>return</span> <a href="../../include/executor/executor.h.html#LN307"><span class='Ref_to_Func'>ExecProject</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1650"><span class='Ref_to_Member'>js</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1547"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN843"><span class='Ref_to_Member'>ps_ProjInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <a href="../../include/nodes/execnodes.h.html#LN862"><span class='Ref_to_Macro'>InstrCountFiltered2</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if joinqual==NULL||ExecQ... &raquo; </span> 
                <span class='Control'>else</span> 
                    <a href="../../include/nodes/execnodes.h.html#LN857"><span class='Ref_to_Macro'>InstrCountFiltered1</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="nodeHashjoin.c.html#LN32"><span class='Ref_to_Const'>HJ_FILL_OUTER_TUPLE</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * The current outer tuple has run out of matches, so check 
                 * whether to emit a dummy outer-join tuple.  Whether we emit 
                 * one or not, the next state is NEED_NEW_OUTER. 
                 */ 
</span>                <a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1665"><span class='Ref_to_Member'>hj_JoinState</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN30"><span class='Ref_to_Const'>HJ_NEED_NEW_OUTER</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1666"><span class='Ref_to_Member'>hj_MatchedOuter</span></a> <span class='Operator'>&& 
</span>                    <a href="nodeHashjoin.c.html#LN37"><span class='Ref_to_Macro'>HJ_FILL_OUTER</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * Generate a fake join tuple with nulls for the inner 
                     * tuple, and return it if it passes the non-join quals. 
                     */ 
</span>                    <a href="nodeHashjoin.c.html#LN67"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN197"><span class='Ref_to_Member'>ecxt_innertuple</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1663"><span class='Ref_to_Member'>hj_NullInnerTupleSlot</span></a><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN66"><span class='Ref_To_Local'>otherqual</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="../../include/executor/executor.h.html#LN344"><span class='Ref_to_Func'>ExecQual</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN66"><span class='Ref_To_Local'>otherqual</span></a><span class='Delimiter'>, </span><a href="nodeHashjoin.c.html#LN67"><span class='Ref_To_Local'>econtext</span></a><span class='Parentheses'>))</span> 
                        <span class='Control'>return</span> <a href="../../include/executor/executor.h.html#LN307"><span class='Ref_to_Func'>ExecProject</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1650"><span class='Ref_to_Member'>js</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1547"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN843"><span class='Ref_to_Member'>ps_ProjInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <a href="../../include/nodes/execnodes.h.html#LN862"><span class='Ref_to_Macro'>InstrCountFiltered2</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="nodeHashjoin.c.html#LN33"><span class='Ref_to_Const'>HJ_FILL_INNER_TUPLES</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * We have finished a batch, but we are doing right/full join, 
                 * so any unmatched inner tuples in the hashtable have to be 
                 * emitted before we continue to the next batch. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/executor/nodeHash.h.html#LN42"><span class='Ref_to_Proto'>ExecScanHashTableForUnmatched</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="nodeHashjoin.c.html#LN67"><span class='Ref_To_Local'>econtext</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* no more unmatched tuples */ 
</span>                    <a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1665"><span class='Ref_to_Member'>hj_JoinState</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN34"><span class='Ref_to_Const'>HJ_NEED_NEW_BATCH</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Generate a fake join tuple with nulls for the outer tuple, 
                 * and return it if it passes the non-join quals. 
                 */ 
</span>                <a href="nodeHashjoin.c.html#LN67"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN198"><span class='Ref_to_Member'>ecxt_outertuple</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1662"><span class='Ref_to_Member'>hj_NullOuterTupleSlot</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN66"><span class='Ref_To_Local'>otherqual</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="../../include/executor/executor.h.html#LN344"><span class='Ref_to_Func'>ExecQual</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN66"><span class='Ref_To_Local'>otherqual</span></a><span class='Delimiter'>, </span><a href="nodeHashjoin.c.html#LN67"><span class='Ref_To_Local'>econtext</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <a href="../../include/executor/executor.h.html#LN307"><span class='Ref_to_Func'>ExecProject</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1650"><span class='Ref_to_Member'>js</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1547"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN843"><span class='Ref_to_Member'>ps_ProjInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="../../include/nodes/execnodes.h.html#LN862"><span class='Ref_to_Macro'>InstrCountFiltered2</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="nodeHashjoin.c.html#LN34"><span class='Ref_to_Const'>HJ_NEED_NEW_BATCH</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Try to advance to next batch.  Done if there are no more. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeHashjoin.c.html#LN48"><span class='Ref_to_Proto'>ExecHashJoinNewBatch</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* end of join */ 
</span>                <a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1665"><span class='Ref_to_Member'>hj_JoinState</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN30"><span class='Ref_to_Const'>HJ_NEED_NEW_OUTER</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized hashjoin state: %d"</span><span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="nodeHashjoin.c.html#LN61"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1665"><span class='Ref_to_Member'>hj_JoinState</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch node-&GT;hj_JoinState &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end ExecHashJoin &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      ExecInitHashJoin 
 * 
 *      Init routine for HashJoin node. 
 * ---------------------------------------------------------------- 
 */ 
</span><a href="../../include/nodes/execnodes.h.html#LN1648"><span class='Ref_to_Struct'>HashJoinState</span></a> <span class='Operator'>* 
</span><a name="LN381"></a><span class='Declare_Function'>ExecInitHashJoin</span><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN724"><span class='Ref_to_Struct'>HashJoin</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>eflags</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN383"></a>    <a href="../../include/nodes/execnodes.h.html#LN1648"><span class='Ref_to_Struct'>HashJoinState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>hjstate</span><span class='Delimiter'>; 
</span><a name="LN384"></a>    <a href="../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>outerNode</span><span class='Delimiter'>; 
</span><a name="LN385"></a>    <a href="../../include/nodes/plannodes.h.html#LN863"><span class='Ref_to_Struct'>Hash</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>hashNode</span><span class='Delimiter'>; 
</span><a name="LN386"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>lclauses</span><span class='Delimiter'>; 
</span><a name="LN387"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>rclauses</span><span class='Delimiter'>; 
</span><a name="LN388"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>hoperators</span><span class='Delimiter'>; 
</span><a name="LN389"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* check for unsupported flags */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN381"><span class='Ref_to_Parameter'>eflags</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><a href="../../include/executor/executor.h.html#LN59"><span class='Ref_to_Const'>EXEC_FLAG_BACKWARD</span></a> <span class='Operator'>| </span><a href="../../include/executor/executor.h.html#LN60"><span class='Ref_to_Const'>EXEC_FLAG_MARK</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * create state structure 
     */ 
</span>    <a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1648"><span class='Ref_to_Struct'>HashJoinState</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1650"><span class='Ref_to_Member'>js</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1547"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN812"><span class='Ref_to_Member'>plan</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeHashjoin.c.html#LN381"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span>    <a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1650"><span class='Ref_to_Member'>js</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1547"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN814"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN381"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Miscellaneous initialization 
     * 
     * create expression context for node 
     */ 
</span>    <a href="execUtils.c.html#LN416"><span class='Ref_to_Func'>ExecAssignExprContext</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN381"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1650"><span class='Ref_to_Member'>js</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1547"><span class='Ref_to_Member'>ps</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initialize child expressions 
     */ 
</span>    <a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1650"><span class='Ref_to_Member'>js</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1547"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN826"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>= 
</span>        <a href="execExpr.c.html#LN158"><span class='Ref_to_Func'>ExecInitQual</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN381"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN726"><span class='Ref_to_Member'>join</span></a><span class='Operator'>.</span><a href="../../include/nodes/plannodes.h.html#LN667"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1650"><span class='Ref_to_Member'>js</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1548"><span class='Ref_to_Member'>jointype</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN381"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN726"><span class='Ref_to_Member'>join</span></a><span class='Operator'>.</span><a href="../../include/nodes/plannodes.h.html#LN668"><span class='Ref_to_Member'>jointype</span></a><span class='Delimiter'>; 
</span>    <a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1650"><span class='Ref_to_Member'>js</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1551"><span class='Ref_to_Member'>joinqual</span></a> <span class='Operator'>= 
</span>        <a href="execExpr.c.html#LN158"><span class='Ref_to_Func'>ExecInitQual</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN381"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN726"><span class='Ref_to_Member'>join</span></a><span class='Operator'>.</span><a href="../../include/nodes/plannodes.h.html#LN670"><span class='Ref_to_Member'>joinqual</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1651"><span class='Ref_to_Member'>hashclauses</span></a> <span class='Operator'>= 
</span>        <a href="execExpr.c.html#LN158"><span class='Ref_to_Func'>ExecInitQual</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN381"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN727"><span class='Ref_to_Member'>hashclauses</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initialize child nodes 
     * 
     * Note: we could suppress the REWIND flag for the inner input, which 
     * would amount to betting that the hash will be a single batch.  Not 
     * clear if this would be a win or not. 
     */ 
</span>    <a href="nodeHashjoin.c.html#LN384"><span class='Ref_To_Local'>outerNode</span></a> <span class='Operator'>= </span><a href="../../include/nodes/plannodes.h.html#LN173"><span class='Ref_to_Macro'>outerPlan</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN381"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeHashjoin.c.html#LN385"><span class='Ref_To_Local'>hashNode</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN863"><span class='Ref_to_Struct'>Hash</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/plannodes.h.html#LN172"><span class='Ref_to_Macro'>innerPlan</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN381"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/execnodes.h.html#LN854"><span class='Ref_to_Macro'>outerPlanState</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Parentheses'>) </span><span class='Operator'>= </span><a href="execProcnode.c.html#LN138"><span class='Ref_to_Func'>ExecInitNode</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN384"><span class='Ref_To_Local'>outerNode</span></a><span class='Delimiter'>, </span><a href="nodeHashjoin.c.html#LN381"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="nodeHashjoin.c.html#LN381"><span class='Ref_to_Parameter'>eflags</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/execnodes.h.html#LN853"><span class='Ref_to_Macro'>innerPlanState</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Parentheses'>) </span><span class='Operator'>= </span><a href="execProcnode.c.html#LN138"><span class='Ref_to_Func'>ExecInitNode</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeHashjoin.c.html#LN385"><span class='Ref_To_Local'>hashNode</span></a><span class='Delimiter'>, </span><a href="nodeHashjoin.c.html#LN381"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="nodeHashjoin.c.html#LN381"><span class='Ref_to_Parameter'>eflags</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * tuple table initialization 
     */ 
</span>    <a href="../../include/executor/executor.h.html#LN400"><span class='Ref_to_Proto'>ExecInitResultTupleSlot</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN381"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1650"><span class='Ref_to_Member'>js</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1547"><span class='Ref_to_Member'>ps</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1660"><span class='Ref_to_Member'>hj_OuterTupleSlot</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN402"><span class='Ref_to_Proto'>ExecInitExtraTupleSlot</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN381"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * detect whether we need only consider the first matching inner tuple 
     */ 
</span>    <a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1650"><span class='Ref_to_Member'>js</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1549"><span class='Ref_to_Member'>single_match</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN381"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN726"><span class='Ref_to_Member'>join</span></a><span class='Operator'>.</span><a href="../../include/nodes/plannodes.h.html#LN669"><span class='Ref_to_Member'>inner_unique</span></a> <span class='Operator'>|| 
</span>                                <a href="nodeHashjoin.c.html#LN381"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN726"><span class='Ref_to_Member'>join</span></a><span class='Operator'>.</span><a href="../../include/nodes/plannodes.h.html#LN668"><span class='Ref_to_Member'>jointype</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN691"><span class='Ref_to_EnumConst'>JOIN_SEMI</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* set up null tuples for outer joins, if needed */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN381"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN726"><span class='Ref_to_Member'>join</span></a><span class='Operator'>.</span><a href="../../include/nodes/plannodes.h.html#LN668"><span class='Ref_to_Member'>jointype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN677"><span class='Ref_to_EnumConst'>JOIN_INNER</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN691"><span class='Ref_to_EnumConst'>JOIN_SEMI</span></a><span class='Operator'>: 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN678"><span class='Ref_to_EnumConst'>JOIN_LEFT</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN692"><span class='Ref_to_EnumConst'>JOIN_ANTI</span></a><span class='Operator'>: 
</span>            <a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1663"><span class='Ref_to_Member'>hj_NullInnerTupleSlot</span></a> <span class='Operator'>= 
</span>                <a href="../../include/executor/executor.h.html#LN403"><span class='Ref_to_Proto'>ExecInitNullTupleSlot</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN381"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, 
</span>                                 <a href="execUtils.c.html#LN467"><span class='Ref_to_Func'>ExecGetResultType</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN853"><span class='Ref_to_Macro'>innerPlanState</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN680"><span class='Ref_to_EnumConst'>JOIN_RIGHT</span></a><span class='Operator'>: 
</span>            <a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1662"><span class='Ref_to_Member'>hj_NullOuterTupleSlot</span></a> <span class='Operator'>= 
</span>                <a href="../../include/executor/executor.h.html#LN403"><span class='Ref_to_Proto'>ExecInitNullTupleSlot</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN381"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, 
</span>                                 <a href="execUtils.c.html#LN467"><span class='Ref_to_Func'>ExecGetResultType</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN854"><span class='Ref_to_Macro'>outerPlanState</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN679"><span class='Ref_to_EnumConst'>JOIN_FULL</span></a><span class='Operator'>: 
</span>            <a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1662"><span class='Ref_to_Member'>hj_NullOuterTupleSlot</span></a> <span class='Operator'>= 
</span>                <a href="../../include/executor/executor.h.html#LN403"><span class='Ref_to_Proto'>ExecInitNullTupleSlot</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN381"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, 
</span>                                 <a href="execUtils.c.html#LN467"><span class='Ref_to_Func'>ExecGetResultType</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN854"><span class='Ref_to_Macro'>outerPlanState</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1663"><span class='Ref_to_Member'>hj_NullInnerTupleSlot</span></a> <span class='Operator'>= 
</span>                <a href="../../include/executor/executor.h.html#LN403"><span class='Ref_to_Proto'>ExecInitNullTupleSlot</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN381"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, 
</span>                                 <a href="execUtils.c.html#LN467"><span class='Ref_to_Func'>ExecGetResultType</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN853"><span class='Ref_to_Macro'>innerPlanState</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized join type: %d"</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="nodeHashjoin.c.html#LN381"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN726"><span class='Ref_to_Member'>join</span></a><span class='Operator'>.</span><a href="../../include/nodes/plannodes.h.html#LN668"><span class='Ref_to_Member'>jointype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch node-&GT;join.jointype &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * now for some voodoo.  our temporary tuple slot is actually the result 
     * tuple slot of the Hash node (which is our inner plan).  we can do this 
     * because Hash nodes don't return tuples via ExecProcNode() -- instead 
     * the hash join node uses ExecScanHashBucket() to get at the contents of 
     * the hash table.  -cim 6/9/91 
     */ 
</span>    <span class='Delimiter'>{ 
</span><a name="LN482"></a>        <a href="../../include/nodes/execnodes.h.html#LN1920"><span class='Ref_to_Struct'>HashState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>hashstate</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1920"><span class='Ref_to_Struct'>HashState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/execnodes.h.html#LN853"><span class='Ref_to_Macro'>innerPlanState</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN483"></a>        <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>slot</span> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN482"><span class='Ref_To_Local'>hashstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1922"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN841"><span class='Ref_to_Member'>ps_ResultTupleSlot</span></a><span class='Delimiter'>; 
</span> 
        <a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1661"><span class='Ref_to_Member'>hj_HashTupleSlot</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN483"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initialize tuple type and projection info 
     */ 
</span>    <a href="execUtils.c.html#LN438"><span class='Ref_to_Func'>ExecAssignResultTypeFromTL</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1650"><span class='Ref_to_Member'>js</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1547"><span class='Ref_to_Member'>ps</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/executor/executor.h.html#LN474"><span class='Ref_to_Proto'>ExecAssignProjectionInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1650"><span class='Ref_to_Member'>js</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1547"><span class='Ref_to_Member'>ps</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/executor/tuptable.h.html#LN146"><span class='Ref_to_Proto'>ExecSetSlotDescriptor</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1660"><span class='Ref_to_Member'>hj_OuterTupleSlot</span></a><span class='Delimiter'>, 
</span>                          <a href="execUtils.c.html#LN467"><span class='Ref_to_Func'>ExecGetResultType</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN854"><span class='Ref_to_Macro'>outerPlanState</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initialize hash-specific info 
     */ 
</span>    <a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1655"><span class='Ref_to_Member'>hj_HashTable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1664"><span class='Ref_to_Member'>hj_FirstOuterTupleSlot</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1656"><span class='Ref_to_Member'>hj_CurHashValue</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1657"><span class='Ref_to_Member'>hj_CurBucketNo</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1658"><span class='Ref_to_Member'>hj_CurSkewBucketNo</span></a> <span class='Operator'>= </span><a href="../../include/executor/hashjoin.h.html#LN100"><span class='Ref_to_Const'>INVALID_SKEW_BUCKET_NO</span></a><span class='Delimiter'>; 
</span>    <a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1659"><span class='Ref_to_Member'>hj_CurTuple</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Deconstruct the hash clauses into outer and inner argument values, so 
     * that we can evaluate those subexpressions separately.  Also make a list 
     * of the hash operator OIDs, in preparation for looking up the hash 
     * functions to use. 
     */ 
</span>    <a href="nodeHashjoin.c.html#LN386"><span class='Ref_To_Local'>lclauses</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="nodeHashjoin.c.html#LN387"><span class='Ref_To_Local'>rclauses</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="nodeHashjoin.c.html#LN388"><span class='Ref_To_Local'>hoperators</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN389"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="nodeHashjoin.c.html#LN381"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN727"><span class='Ref_to_Member'>hashclauses</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN519"></a>        <a href="../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>hclause</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a><span class='Delimiter'>, </span><a href="nodeHashjoin.c.html#LN389"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="nodeHashjoin.c.html#LN386"><span class='Ref_To_Local'>lclauses</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN386"><span class='Ref_To_Local'>lclauses</span></a><span class='Delimiter'>, </span><a href="execExpr.c.html#LN111"><span class='Ref_to_Func'>ExecInitExpr</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN519"><span class='Ref_To_Local'>hclause</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN500"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                  <span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="nodeHashjoin.c.html#LN387"><span class='Ref_To_Local'>rclauses</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN387"><span class='Ref_To_Local'>rclauses</span></a><span class='Delimiter'>, </span><a href="execExpr.c.html#LN111"><span class='Ref_to_Func'>ExecInitExpr</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN115"><span class='Ref_to_Macro'>lsecond</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN519"><span class='Ref_To_Local'>hclause</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN500"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                  <span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="nodeHashjoin.c.html#LN388"><span class='Ref_To_Local'>hoperators</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN388"><span class='Ref_To_Local'>hoperators</span></a><span class='Delimiter'>, </span><a href="nodeHashjoin.c.html#LN519"><span class='Ref_To_Local'>hclause</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN494"><span class='Ref_to_Member'>opno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1652"><span class='Ref_to_Member'>hj_OuterHashKeys</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN386"><span class='Ref_To_Local'>lclauses</span></a><span class='Delimiter'>; 
</span>    <a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1653"><span class='Ref_to_Member'>hj_InnerHashKeys</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN387"><span class='Ref_To_Local'>rclauses</span></a><span class='Delimiter'>; 
</span>    <a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1654"><span class='Ref_to_Member'>hj_HashOperators</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN388"><span class='Ref_To_Local'>hoperators</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* child Hash node needs to evaluate inner hash keys, too */ 
</span>    <span class='Parentheses'>((</span><a href="../../include/nodes/execnodes.h.html#LN1920"><span class='Ref_to_Struct'>HashState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/execnodes.h.html#LN853"><span class='Ref_to_Macro'>innerPlanState</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>hashkeys <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN387"><span class='Ref_To_Local'>rclauses</span></a><span class='Delimiter'>; 
</span> 
    <a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1665"><span class='Ref_to_Member'>hj_JoinState</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN29"><span class='Ref_to_Const'>HJ_BUILD_HASHTABLE</span></a><span class='Delimiter'>; 
</span>    <a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1666"><span class='Ref_to_Member'>hj_MatchedOuter</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1667"><span class='Ref_to_Member'>hj_OuterNotEmpty</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="nodeHashjoin.c.html#LN383"><span class='Ref_To_Local'>hjstate</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecInitHashJoin &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      ExecEndHashJoin 
 * 
 *      clean up routine for HashJoin node 
 * ---------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN547"></a><span class='Declare_Function'>ExecEndHashJoin</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1648"><span class='Ref_to_Struct'>HashJoinState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * Free hash table 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN547"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1655"><span class='Ref_to_Member'>hj_HashTable</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/executor/nodeHash.h.html#LN26"><span class='Ref_to_Proto'>ExecHashTableDestroy</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN547"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1655"><span class='Ref_to_Member'>hj_HashTable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeHashjoin.c.html#LN547"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1655"><span class='Ref_to_Member'>hj_HashTable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Free the exprcontext 
     */ 
</span>    <a href="../../include/executor/executor.h.html#LN476"><span class='Ref_to_Proto'>ExecFreeExprContext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeHashjoin.c.html#LN547"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1650"><span class='Ref_to_Member'>js</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1547"><span class='Ref_to_Member'>ps</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * clean out the tuple table 
     */ 
</span>    <a href="../../include/executor/tuptable.h.html#LN154"><span class='Ref_to_Proto'>ExecClearTuple</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN547"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1650"><span class='Ref_to_Member'>js</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1547"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN841"><span class='Ref_to_Member'>ps_ResultTupleSlot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/executor/tuptable.h.html#LN154"><span class='Ref_to_Proto'>ExecClearTuple</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN547"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1660"><span class='Ref_to_Member'>hj_OuterTupleSlot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/executor/tuptable.h.html#LN154"><span class='Ref_to_Proto'>ExecClearTuple</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN547"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1661"><span class='Ref_to_Member'>hj_HashTupleSlot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * clean up subtrees 
     */ 
</span>    <a href="../../include/executor/executor.h.html#LN231"><span class='Ref_to_Proto'>ExecEndNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN854"><span class='Ref_to_Macro'>outerPlanState</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN547"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/executor/executor.h.html#LN231"><span class='Ref_to_Proto'>ExecEndNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN853"><span class='Ref_to_Macro'>innerPlanState</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN547"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecEndHashJoin &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ExecHashJoinOuterGetTuple 
 * 
 *      get the next outer tuple for hashjoin: either by 
 *      executing the outer plan node in the first pass, or from 
 *      the temp files for the hashjoin batches. 
 * 
 * Returns a null slot if no more outer tuples (within the current batch). 
 * 
 * On success, the tuple's hash value is stored at *hashvalue --- this is 
 * either originally computed, or re-read from the temp file. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>* 
</span><a name="LN590"></a><span class='Declare_Function'>ExecHashJoinOuterGetTuple</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>outerNode</span><span class='Delimiter'>, 
</span><a name="LN591"></a>                          <a href="../../include/nodes/execnodes.h.html#LN1648"><span class='Ref_to_Struct'>HashJoinState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hjstate</span><span class='Delimiter'>, 
</span><a name="LN592"></a>                          <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hashvalue</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN594"></a>    <a href="../../include/nodes/execnodes.h.html#LN1646"><span class='Ref_to_Typedef'>HashJoinTable</span></a> <span class='Declare_Local'>hashtable</span> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN591"><span class='Ref_to_Parameter'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1655"><span class='Ref_to_Member'>hj_HashTable</span></a><span class='Delimiter'>; 
</span><a name="LN595"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>curbatch</span> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN594"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN148"><span class='Ref_to_Member'>curbatch</span></a><span class='Delimiter'>; 
</span><a name="LN596"></a>    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>slot</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN595"><span class='Ref_To_Local'>curbatch</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span>          <span class='Comment_Single_Line'>/* if it is the first pass */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Check to see if first outer tuple was already fetched by 
         * ExecHashJoin() and not used yet. 
         */ 
</span>        <a href="nodeHashjoin.c.html#LN596"><span class='Ref_To_Local'>slot</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN591"><span class='Ref_to_Parameter'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1664"><span class='Ref_to_Member'>hj_FirstOuterTupleSlot</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/executor/tuptable.h.html#LN137"><span class='Ref_to_Macro'>TupIsNull</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN596"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>))</span> 
            <a href="nodeHashjoin.c.html#LN591"><span class='Ref_to_Parameter'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1664"><span class='Ref_to_Member'>hj_FirstOuterTupleSlot</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="nodeHashjoin.c.html#LN596"><span class='Ref_To_Local'>slot</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN229"><span class='Ref_to_Proto'>ExecProcNode</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN590"><span class='Ref_to_Parameter'>outerNode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/executor/tuptable.h.html#LN137"><span class='Ref_to_Macro'>TupIsNull</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN596"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * We have to compute the tuple's hash value. 
             */ 
</span><a name="LN615"></a>            <a href="../../include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>econtext</span> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN591"><span class='Ref_to_Parameter'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1650"><span class='Ref_to_Member'>js</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1547"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN842"><span class='Ref_to_Member'>ps_ExprContext</span></a><span class='Delimiter'>; 
</span> 
            <a href="nodeHashjoin.c.html#LN615"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN198"><span class='Ref_to_Member'>ecxt_outertuple</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN596"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/executor/nodeHash.h.html#LN30"><span class='Ref_to_Proto'>ExecHashGetHashValue</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN594"><span class='Ref_To_Local'>hashtable</span></a><span class='Delimiter'>, </span><a href="nodeHashjoin.c.html#LN615"><span class='Ref_To_Local'>econtext</span></a><span class='Delimiter'>, 
</span>                                     <a href="nodeHashjoin.c.html#LN591"><span class='Ref_to_Parameter'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1652"><span class='Ref_to_Member'>hj_OuterHashKeys</span></a><span class='Delimiter'>, 
</span>                                     <span class='Boolean'>true</span><span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* outer tuple */ 
</span>                                     <a href="nodeHashjoin.c.html#LN37"><span class='Ref_to_Macro'>HJ_FILL_OUTER</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN591"><span class='Ref_to_Parameter'>hjstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="nodeHashjoin.c.html#LN592"><span class='Ref_to_Parameter'>hashvalue</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* remember outer relation is not empty for possible rescan */ 
</span>                <a href="nodeHashjoin.c.html#LN591"><span class='Ref_to_Parameter'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1667"><span class='Ref_to_Member'>hj_OuterNotEmpty</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>return</span> <a href="nodeHashjoin.c.html#LN596"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * That tuple couldn't match because of a NULL, so discard it and 
             * continue with the next one. 
             */ 
</span>            <a href="nodeHashjoin.c.html#LN596"><span class='Ref_To_Local'>slot</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN229"><span class='Ref_to_Proto'>ExecProcNode</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN590"><span class='Ref_to_Parameter'>outerNode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while !TupIsNull(slot) &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if curbatch==0 &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN595"><span class='Ref_To_Local'>curbatch</span></a> <span class='Operator'>&LT; </span><a href="nodeHashjoin.c.html#LN594"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN147"><span class='Ref_to_Member'>nbatch</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN639"></a>        <a href="../storage/file/buffile.c.html#LN58"><span class='Ref_to_Struct'>BufFile</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>file</span> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN594"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN166"><span class='Ref_to_Member'>outerBatchFile</span></a><span class='Delimiter'>[</span><a href="nodeHashjoin.c.html#LN595"><span class='Ref_To_Local'>curbatch</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * In outer-join cases, we could get here even though the batch file 
         * is empty. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN639"><span class='Ref_To_Local'>file</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <a href="nodeHashjoin.c.html#LN596"><span class='Ref_To_Local'>slot</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN44"><span class='Ref_to_Proto'>ExecHashJoinGetSavedTuple</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN591"><span class='Ref_to_Parameter'>hjstate</span></a><span class='Delimiter'>, 
</span>                                         <a href="nodeHashjoin.c.html#LN639"><span class='Ref_To_Local'>file</span></a><span class='Delimiter'>, 
</span>                                         <a href="nodeHashjoin.c.html#LN592"><span class='Ref_to_Parameter'>hashvalue</span></a><span class='Delimiter'>, 
</span>                                         <a href="nodeHashjoin.c.html#LN591"><span class='Ref_to_Parameter'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1660"><span class='Ref_to_Member'>hj_OuterTupleSlot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/executor/tuptable.h.html#LN137"><span class='Ref_to_Macro'>TupIsNull</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN596"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <a href="nodeHashjoin.c.html#LN596"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* End of this batch */ 
</span>    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecHashJoinOuterGetTuple &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ExecHashJoinNewBatch 
 *      switch to a new hashjoin batch 
 * 
 * Returns true if successful, false if there are no more batches. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN667"></a><span class='Declare_Function'>ExecHashJoinNewBatch</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1648"><span class='Ref_to_Struct'>HashJoinState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hjstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN669"></a>    <a href="../../include/nodes/execnodes.h.html#LN1646"><span class='Ref_to_Typedef'>HashJoinTable</span></a> <span class='Declare_Local'>hashtable</span> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN667"><span class='Ref_to_Parameter'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1655"><span class='Ref_to_Member'>hj_HashTable</span></a><span class='Delimiter'>; 
</span><a name="LN670"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nbatch</span><span class='Delimiter'>; 
</span><a name="LN671"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>curbatch</span><span class='Delimiter'>; 
</span><a name="LN672"></a>    <a href="../storage/file/buffile.c.html#LN58"><span class='Ref_to_Struct'>BufFile</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>innerFile</span><span class='Delimiter'>; 
</span><a name="LN673"></a>    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>slot</span><span class='Delimiter'>; 
</span><a name="LN674"></a>    <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>hashvalue</span><span class='Delimiter'>; 
</span> 
    <a href="nodeHashjoin.c.html#LN670"><span class='Ref_To_Local'>nbatch</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN669"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN147"><span class='Ref_to_Member'>nbatch</span></a><span class='Delimiter'>; 
</span>    <a href="nodeHashjoin.c.html#LN671"><span class='Ref_To_Local'>curbatch</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN669"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN148"><span class='Ref_to_Member'>curbatch</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN671"><span class='Ref_To_Local'>curbatch</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * We no longer need the previous outer batch file; close it right 
         * away to free disk space. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN669"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN166"><span class='Ref_to_Member'>outerBatchFile</span></a><span class='Delimiter'>[</span><a href="nodeHashjoin.c.html#LN671"><span class='Ref_To_Local'>curbatch</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <a href="../../include/storage/buffile.h.html#LN37"><span class='Ref_to_Proto'>BufFileClose</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN669"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN166"><span class='Ref_to_Member'>outerBatchFile</span></a><span class='Delimiter'>[</span><a href="nodeHashjoin.c.html#LN671"><span class='Ref_To_Local'>curbatch</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeHashjoin.c.html#LN669"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN166"><span class='Ref_to_Member'>outerBatchFile</span></a><span class='Delimiter'>[</span><a href="nodeHashjoin.c.html#LN671"><span class='Ref_To_Local'>curbatch</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span>    <span class='Comment_Single_Line'>/* we just finished the first batch */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Reset some of the skew optimization state variables, since we no 
         * longer need to consider skew tuples after the first batch. The 
         * memory context reset we are about to do will release the skew 
         * hashtable itself. 
         */ 
</span>        <a href="nodeHashjoin.c.html#LN669"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN141"><span class='Ref_to_Member'>skewEnabled</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="nodeHashjoin.c.html#LN669"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN142"><span class='Ref_to_Member'>skewBucket</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="nodeHashjoin.c.html#LN669"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN145"><span class='Ref_to_Member'>skewBucketNums</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="nodeHashjoin.c.html#LN669"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN144"><span class='Ref_to_Member'>nSkewBuckets</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="nodeHashjoin.c.html#LN669"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN180"><span class='Ref_to_Member'>spaceUsedSkew</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We can always skip over any batches that are completely empty on both 
     * sides.  We can sometimes skip over batches that are empty on only one 
     * side, but there are exceptions: 
     * 
     * 1. In a left/full outer join, we have to process outer batches even if 
     * the inner batch is empty.  Similarly, in a right/full outer join, we 
     * have to process inner batches even if the outer batch is empty. 
     * 
     * 2. If we have increased nbatch since the initial estimate, we have to 
     * scan inner batches since they might contain tuples that need to be 
     * reassigned to later inner batches. 
     * 
     * 3. Similarly, if we have increased nbatch since starting the outer 
     * scan, we have to rescan outer batches in case they contain tuples that 
     * need to be reassigned. 
     */ 
</span>    <a href="nodeHashjoin.c.html#LN671"><span class='Ref_To_Local'>curbatch</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN671"><span class='Ref_To_Local'>curbatch</span></a> <span class='Operator'>&LT; </span><a href="nodeHashjoin.c.html#LN670"><span class='Ref_To_Local'>nbatch</span></a> <span class='Operator'>&& 
</span>           <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN669"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN166"><span class='Ref_to_Member'>outerBatchFile</span></a><span class='Delimiter'>[</span><a href="nodeHashjoin.c.html#LN671"><span class='Ref_To_Local'>curbatch</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>            <a href="nodeHashjoin.c.html#LN669"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN165"><span class='Ref_to_Member'>innerBatchFile</span></a><span class='Delimiter'>[</span><a href="nodeHashjoin.c.html#LN671"><span class='Ref_To_Local'>curbatch</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN669"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN166"><span class='Ref_to_Member'>outerBatchFile</span></a><span class='Delimiter'>[</span><a href="nodeHashjoin.c.html#LN671"><span class='Ref_To_Local'>curbatch</span></a><span class='Delimiter'>] </span><span class='Operator'>&& 
</span>            <a href="nodeHashjoin.c.html#LN37"><span class='Ref_to_Macro'>HJ_FILL_OUTER</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN667"><span class='Ref_to_Parameter'>hjstate</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>break</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* must process due to rule 1 */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN669"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN165"><span class='Ref_to_Member'>innerBatchFile</span></a><span class='Delimiter'>[</span><a href="nodeHashjoin.c.html#LN671"><span class='Ref_To_Local'>curbatch</span></a><span class='Delimiter'>] </span><span class='Operator'>&& 
</span>            <a href="nodeHashjoin.c.html#LN39"><span class='Ref_to_Macro'>HJ_FILL_INNER</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN667"><span class='Ref_to_Parameter'>hjstate</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>break</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* must process due to rule 1 */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN669"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN165"><span class='Ref_to_Member'>innerBatchFile</span></a><span class='Delimiter'>[</span><a href="nodeHashjoin.c.html#LN671"><span class='Ref_To_Local'>curbatch</span></a><span class='Delimiter'>] </span><span class='Operator'>&& 
</span>            <a href="nodeHashjoin.c.html#LN670"><span class='Ref_To_Local'>nbatch</span></a> <span class='Operator'>!= </span><a href="nodeHashjoin.c.html#LN669"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN150"><span class='Ref_to_Member'>nbatch_original</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* must process due to rule 2 */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN669"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN166"><span class='Ref_to_Member'>outerBatchFile</span></a><span class='Delimiter'>[</span><a href="nodeHashjoin.c.html#LN671"><span class='Ref_To_Local'>curbatch</span></a><span class='Delimiter'>] </span><span class='Operator'>&& 
</span>            <a href="nodeHashjoin.c.html#LN670"><span class='Ref_To_Local'>nbatch</span></a> <span class='Operator'>!= </span><a href="nodeHashjoin.c.html#LN669"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN151"><span class='Ref_to_Member'>nbatch_outstart</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* must process due to rule 3 */ 
</span>        <span class='Comment_Multi_Line'>/* We can ignore this batch. */ 
</span>        <span class='Comment_Multi_Line'>/* Release associated temp files right away. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN669"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN165"><span class='Ref_to_Member'>innerBatchFile</span></a><span class='Delimiter'>[</span><a href="nodeHashjoin.c.html#LN671"><span class='Ref_To_Local'>curbatch</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <a href="../../include/storage/buffile.h.html#LN37"><span class='Ref_to_Proto'>BufFileClose</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN669"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN165"><span class='Ref_to_Member'>innerBatchFile</span></a><span class='Delimiter'>[</span><a href="nodeHashjoin.c.html#LN671"><span class='Ref_To_Local'>curbatch</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeHashjoin.c.html#LN669"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN165"><span class='Ref_to_Member'>innerBatchFile</span></a><span class='Delimiter'>[</span><a href="nodeHashjoin.c.html#LN671"><span class='Ref_To_Local'>curbatch</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN669"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN166"><span class='Ref_to_Member'>outerBatchFile</span></a><span class='Delimiter'>[</span><a href="nodeHashjoin.c.html#LN671"><span class='Ref_To_Local'>curbatch</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <a href="../../include/storage/buffile.h.html#LN37"><span class='Ref_to_Proto'>BufFileClose</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN669"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN166"><span class='Ref_to_Member'>outerBatchFile</span></a><span class='Delimiter'>[</span><a href="nodeHashjoin.c.html#LN671"><span class='Ref_To_Local'>curbatch</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeHashjoin.c.html#LN669"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN166"><span class='Ref_to_Member'>outerBatchFile</span></a><span class='Delimiter'>[</span><a href="nodeHashjoin.c.html#LN671"><span class='Ref_To_Local'>curbatch</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="nodeHashjoin.c.html#LN671"><span class='Ref_To_Local'>curbatch</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while curbatch&LT;nbatch&&(has... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN671"><span class='Ref_To_Local'>curbatch</span></a> <span class='Operator'>&GT;= </span><a href="nodeHashjoin.c.html#LN670"><span class='Ref_To_Local'>nbatch</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* no more batches */ 
</span> 
    <a href="nodeHashjoin.c.html#LN669"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN148"><span class='Ref_to_Member'>curbatch</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN671"><span class='Ref_To_Local'>curbatch</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Reload the hash table with the new inner batch (which could be empty) 
     */ 
</span>    <a href="../../include/executor/nodeHash.h.html#LN44"><span class='Ref_to_Proto'>ExecHashTableReset</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN669"><span class='Ref_To_Local'>hashtable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="nodeHashjoin.c.html#LN672"><span class='Ref_To_Local'>innerFile</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN669"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN165"><span class='Ref_to_Member'>innerBatchFile</span></a><span class='Delimiter'>[</span><a href="nodeHashjoin.c.html#LN671"><span class='Ref_To_Local'>curbatch</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN672"><span class='Ref_To_Local'>innerFile</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/storage/buffile.h.html#LN40"><span class='Ref_to_Proto'>BufFileSeek</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN672"><span class='Ref_To_Local'>innerFile</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0L</span><span class='Delimiter'>, </span>SEEK_SET<span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                   <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not rewind hash-join temporary file: %m"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="nodeHashjoin.c.html#LN673"><span class='Ref_To_Local'>slot</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN44"><span class='Ref_to_Proto'>ExecHashJoinGetSavedTuple</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN667"><span class='Ref_to_Parameter'>hjstate</span></a><span class='Delimiter'>, 
</span>                                                 <a href="nodeHashjoin.c.html#LN672"><span class='Ref_To_Local'>innerFile</span></a><span class='Delimiter'>, 
</span>                                                 <span class='Operator'>&</span><a href="nodeHashjoin.c.html#LN674"><span class='Ref_To_Local'>hashvalue</span></a><span class='Delimiter'>, 
</span>                                                 <a href="nodeHashjoin.c.html#LN667"><span class='Ref_to_Parameter'>hjstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1661"><span class='Ref_to_Member'>hj_HashTupleSlot</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * NOTE: some tuples may be sent to future batches.  Also, it is 
             * possible for hashtable-&GT;nbatch to be increased here! 
             */ 
</span>            <a href="../../include/executor/nodeHash.h.html#LN27"><span class='Ref_to_Proto'>ExecHashTableInsert</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN669"><span class='Ref_To_Local'>hashtable</span></a><span class='Delimiter'>, </span><a href="nodeHashjoin.c.html#LN673"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>, </span><a href="nodeHashjoin.c.html#LN674"><span class='Ref_To_Local'>hashvalue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * after we build the hash table, the inner batch file is no longer 
         * needed 
         */ 
</span>        <a href="../../include/storage/buffile.h.html#LN37"><span class='Ref_to_Proto'>BufFileClose</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN672"><span class='Ref_To_Local'>innerFile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeHashjoin.c.html#LN669"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN165"><span class='Ref_to_Member'>innerBatchFile</span></a><span class='Delimiter'>[</span><a href="nodeHashjoin.c.html#LN671"><span class='Ref_To_Local'>curbatch</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if innerFile!=NULL &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Rewind outer batch file (if present), so that we can start reading it. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN669"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN166"><span class='Ref_to_Member'>outerBatchFile</span></a><span class='Delimiter'>[</span><a href="nodeHashjoin.c.html#LN671"><span class='Ref_To_Local'>curbatch</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/storage/buffile.h.html#LN40"><span class='Ref_to_Proto'>BufFileSeek</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN669"><span class='Ref_To_Local'>hashtable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN166"><span class='Ref_to_Member'>outerBatchFile</span></a><span class='Delimiter'>[</span><a href="nodeHashjoin.c.html#LN671"><span class='Ref_To_Local'>curbatch</span></a><span class='Delimiter'>], </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0L</span><span class='Delimiter'>, </span>SEEK_SET<span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                   <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not rewind hash-join temporary file: %m"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecHashJoinNewBatch &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ExecHashJoinSaveTuple 
 *      save a tuple to a batch file. 
 * 
 * The data recorded in the file for each tuple is its hash value, 
 * then the tuple in MinimalTuple format. 
 * 
 * Note: it is important always to call this in the regular executor 
 * context, not in a shorter-lived context; else the temp file buffers 
 * will get messed up. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN814"></a><span class='Declare_Function'>ExecHashJoinSaveTuple</span><span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN26"><span class='Ref_to_Typedef'>MinimalTuple</span></a> <span class='Declare_Parameter'>tuple</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>hashvalue</span><span class='Delimiter'>, 
</span><a name="LN815"></a>                      <a href="../storage/file/buffile.c.html#LN58"><span class='Ref_to_Struct'>BufFile</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>fileptr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN817"></a>    <a href="../storage/file/buffile.c.html#LN58"><span class='Ref_to_Struct'>BufFile</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>file</span> <span class='Operator'>= *</span><a href="nodeHashjoin.c.html#LN815"><span class='Ref_to_Parameter'>fileptr</span></a><span class='Delimiter'>; 
</span><a name="LN818"></a>    size_t      <span class='Declare_Local'>written</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN817"><span class='Ref_To_Local'>file</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* First write to this batch file, so open it. */ 
</span>        <a href="nodeHashjoin.c.html#LN817"><span class='Ref_To_Local'>file</span></a> <span class='Operator'>= </span><a href="../../include/storage/buffile.h.html#LN36"><span class='Ref_to_Proto'>BufFileCreateTemp</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="nodeHashjoin.c.html#LN815"><span class='Ref_to_Parameter'>fileptr</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN817"><span class='Ref_To_Local'>file</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="nodeHashjoin.c.html#LN818"><span class='Ref_To_Local'>written</span></a> <span class='Operator'>= </span><a href="../../include/storage/buffile.h.html#LN39"><span class='Ref_to_Proto'>BufFileWrite</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN817"><span class='Ref_To_Local'>file</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="nodeHashjoin.c.html#LN814"><span class='Ref_to_Parameter'>hashvalue</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN818"><span class='Ref_To_Local'>written</span></a> <span class='Operator'>!= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not write to hash-join temporary file: %m"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="nodeHashjoin.c.html#LN818"><span class='Ref_To_Local'>written</span></a> <span class='Operator'>= </span><a href="../../include/storage/buffile.h.html#LN39"><span class='Ref_to_Proto'>BufFileWrite</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN817"><span class='Ref_To_Local'>file</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeHashjoin.c.html#LN814"><span class='Ref_to_Parameter'>tuple</span></a><span class='Delimiter'>, </span><a href="nodeHashjoin.c.html#LN814"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup_details.h.html#LN628"><span class='Ref_to_Member'>t_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN818"><span class='Ref_To_Local'>written</span></a> <span class='Operator'>!= </span><a href="nodeHashjoin.c.html#LN814"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup_details.h.html#LN628"><span class='Ref_to_Member'>t_len</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not write to hash-join temporary file: %m"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecHashJoinSaveTuple &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ExecHashJoinGetSavedTuple 
 *      read the next tuple from a batch file.  Return NULL if no more. 
 * 
 * On success, *hashvalue is set to the tuple's hash value, and the tuple 
 * itself is stored in the given slot. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>* 
</span><a name="LN848"></a><span class='Declare_Function'>ExecHashJoinGetSavedTuple</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1648"><span class='Ref_to_Struct'>HashJoinState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hjstate</span><span class='Delimiter'>, 
</span><a name="LN849"></a>                          <a href="../storage/file/buffile.c.html#LN58"><span class='Ref_to_Struct'>BufFile</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>file</span><span class='Delimiter'>, 
</span><a name="LN850"></a>                          <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hashvalue</span><span class='Delimiter'>, 
</span><a name="LN851"></a>                          <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tupleSlot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN853"></a>    <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>header</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN854"></a>    size_t      <span class='Declare_Local'>nread</span><span class='Delimiter'>; 
</span><a name="LN855"></a>    <a href="../../include/access/htup.h.html#LN26"><span class='Ref_to_Typedef'>MinimalTuple</span></a> <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We check for interrupts here because this is typically taken as an 
     * alternative code path to an ExecProcNode() call, which would include 
     * such a check. 
     */ 
</span>    <a href="../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Since both the hash value and the MinimalTuple length word are uint32, 
     * we can read them both in one BufFileRead() call without any type 
     * cheating. 
     */ 
</span>    <a href="nodeHashjoin.c.html#LN854"><span class='Ref_To_Local'>nread</span></a> <span class='Operator'>= </span><a href="../../include/storage/buffile.h.html#LN38"><span class='Ref_to_Proto'>BufFileRead</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN849"><span class='Ref_to_Parameter'>file</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeHashjoin.c.html#LN853"><span class='Ref_To_Local'>header</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN853"><span class='Ref_To_Local'>header</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN854"><span class='Ref_To_Local'>nread</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span>             <span class='Comment_Single_Line'>/* end of file */ 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/executor/tuptable.h.html#LN154"><span class='Ref_to_Proto'>ExecClearTuple</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN851"><span class='Ref_to_Parameter'>tupleSlot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN854"><span class='Ref_To_Local'>nread</span></a> <span class='Operator'>!= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN853"><span class='Ref_To_Local'>header</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not read from hash-join temporary file: %m"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="nodeHashjoin.c.html#LN850"><span class='Ref_to_Parameter'>hashvalue</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN853"><span class='Ref_To_Local'>header</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>    <a href="nodeHashjoin.c.html#LN855"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN26"><span class='Ref_to_Typedef'>MinimalTuple</span></a><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN853"><span class='Ref_To_Local'>header</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeHashjoin.c.html#LN855"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup_details.h.html#LN628"><span class='Ref_to_Member'>t_len</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN853"><span class='Ref_To_Local'>header</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>    <a href="nodeHashjoin.c.html#LN854"><span class='Ref_To_Local'>nread</span></a> <span class='Operator'>= </span><a href="../../include/storage/buffile.h.html#LN38"><span class='Ref_to_Proto'>BufFileRead</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN849"><span class='Ref_to_Parameter'>file</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeHashjoin.c.html#LN855"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>+ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                        <a href="nodeHashjoin.c.html#LN853"><span class='Ref_To_Local'>header</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN854"><span class='Ref_To_Local'>nread</span></a> <span class='Operator'>!= </span><a href="nodeHashjoin.c.html#LN853"><span class='Ref_To_Local'>header</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not read from hash-join temporary file: %m"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="../../include/executor/tuptable.h.html#LN151"><span class='Ref_to_Proto'>ExecStoreMinimalTuple</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN855"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="nodeHashjoin.c.html#LN851"><span class='Ref_to_Parameter'>tupleSlot</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecHashJoinGetSavedTuple &raquo; </span> 
 
 
<span class='Keyword'>void 
</span><a name="LN894"></a><span class='Declare_Function'>ExecReScanHashJoin</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1648"><span class='Ref_to_Struct'>HashJoinState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * In a multi-batch join, we currently have to do rescans the hard way, 
     * primarily because batch temp files may have already been released. But 
     * if it's a single-batch join, and there is no parameter change for the 
     * inner subnode, then we can just re-use the existing hash table without 
     * rebuilding it. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN894"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1655"><span class='Ref_to_Member'>hj_HashTable</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN894"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1655"><span class='Ref_to_Member'>hj_HashTable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/hashjoin.h.html#LN147"><span class='Ref_to_Member'>nbatch</span></a> <span class='Operator'>== </span><span class='Number'>1</span> <span class='Operator'>&& 
</span>            <a href="nodeHashjoin.c.html#LN894"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1650"><span class='Ref_to_Member'>js</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1547"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN828"><span class='Ref_to_Member'>righttree</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN836"><span class='Ref_to_Member'>chgParam</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Okay to reuse the hash table; needn't rescan inner, either. 
             * 
             * However, if it's a right/full join, we'd better reset the 
             * inner-tuple match flags contained in the table. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN39"><span class='Ref_to_Macro'>HJ_FILL_INNER</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN894"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/executor/nodeHash.h.html#LN45"><span class='Ref_to_Proto'>ExecHashTableResetMatchFlags</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN894"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1655"><span class='Ref_to_Member'>hj_HashTable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Also, we need to reset our state about the emptiness of the 
             * outer relation, so that the new scan of the outer will update 
             * it correctly if it turns out to be empty this time. (There's no 
             * harm in clearing it now because ExecHashJoin won't need the 
             * info.  In the other cases, where the hash table doesn't exist 
             * or we are destroying it, we leave this state alone because 
             * ExecHashJoin will need it the first time through.) 
             */ 
</span>            <a href="nodeHashjoin.c.html#LN894"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1667"><span class='Ref_to_Member'>hj_OuterNotEmpty</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* ExecHashJoin can skip the BUILD_HASHTABLE step */ 
</span>            <a href="nodeHashjoin.c.html#LN894"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1665"><span class='Ref_to_Member'>hj_JoinState</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN30"><span class='Ref_to_Const'>HJ_NEED_NEW_OUTER</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if node-&GT;hj_HashTable-&GT;n... &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* must destroy and rebuild hash table */ 
</span>            <a href="../../include/executor/nodeHash.h.html#LN26"><span class='Ref_to_Proto'>ExecHashTableDestroy</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN894"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1655"><span class='Ref_to_Member'>hj_HashTable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="nodeHashjoin.c.html#LN894"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1655"><span class='Ref_to_Member'>hj_HashTable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="nodeHashjoin.c.html#LN894"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1665"><span class='Ref_to_Member'>hj_JoinState</span></a> <span class='Operator'>= </span><a href="nodeHashjoin.c.html#LN29"><span class='Ref_to_Const'>HJ_BUILD_HASHTABLE</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * if chgParam of subnode is not null then plan will be re-scanned 
             * by first ExecProcNode. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN894"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1650"><span class='Ref_to_Member'>js</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1547"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN828"><span class='Ref_to_Member'>righttree</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN836"><span class='Ref_to_Member'>chgParam</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="execAmi.c.html#LN73"><span class='Ref_to_Func'>ExecReScan</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN894"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1650"><span class='Ref_to_Member'>js</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1547"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN828"><span class='Ref_to_Member'>righttree</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if node-&GT;hj_HashTable!=N... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Always reset intra-tuple state */ 
</span>    <a href="nodeHashjoin.c.html#LN894"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1656"><span class='Ref_to_Member'>hj_CurHashValue</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="nodeHashjoin.c.html#LN894"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1657"><span class='Ref_to_Member'>hj_CurBucketNo</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="nodeHashjoin.c.html#LN894"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1658"><span class='Ref_to_Member'>hj_CurSkewBucketNo</span></a> <span class='Operator'>= </span><a href="../../include/executor/hashjoin.h.html#LN100"><span class='Ref_to_Const'>INVALID_SKEW_BUCKET_NO</span></a><span class='Delimiter'>; 
</span>    <a href="nodeHashjoin.c.html#LN894"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1659"><span class='Ref_to_Member'>hj_CurTuple</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="nodeHashjoin.c.html#LN894"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1666"><span class='Ref_to_Member'>hj_MatchedOuter</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="nodeHashjoin.c.html#LN894"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1664"><span class='Ref_to_Member'>hj_FirstOuterTupleSlot</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * if chgParam of subnode is not null then plan will be re-scanned by 
     * first ExecProcNode. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN894"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1650"><span class='Ref_to_Member'>js</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1547"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN827"><span class='Ref_to_Member'>lefttree</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN836"><span class='Ref_to_Member'>chgParam</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="execAmi.c.html#LN73"><span class='Ref_to_Func'>ExecReScan</span></a><span class='Parentheses'>(</span><a href="nodeHashjoin.c.html#LN894"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1650"><span class='Ref_to_Member'>js</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1547"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN827"><span class='Ref_to_Member'>lefttree</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecReScanHashJoin &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>