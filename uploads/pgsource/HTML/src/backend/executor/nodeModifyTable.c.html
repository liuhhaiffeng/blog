<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\executor\nodeModifyTable.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\executor\nodeModifyTable.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:39 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * nodeModifyTable.c 
 *    routines to handle ModifyTable nodes. 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/executor/nodeModifyTable.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
/* INTERFACE ROUTINES 
 *      ExecInitModifyTable - initialize the ModifyTable node 
 *      ExecModifyTable     - retrieve the next tuple from the node 
 *      ExecEndModifyTable  - shut down the ModifyTable node 
 *      ExecReScanModifyTable - rescan the ModifyTable node 
 * 
 *   NOTES 
 *      Each ModifyTable node contains a list of one or more subplans, 
 *      much like an Append node.  There is one subplan per result relation. 
 *      The key reason for this is that in an inherited UPDATE command, each 
 *      result relation could have a different schema (more or different 
 *      columns) requiring a different plan tree to produce it.  In an 
 *      inherited DELETE, all the subplans should produce the same output 
 *      rowtype, but we might still find that different plans are appropriate 
 *      for different child relations. 
 * 
 *      If the query specifies RETURNING, then the ModifyTable returns a 
 *      RETURNING tuple after completing each row insert, update, or delete. 
 *      It must be called again to continue the operation.  Without RETURNING, 
 *      we just loop within the node until all the work is done, then 
 *      return NULL.  This avoids useless call/return overhead. 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xact.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/trigger.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"executor/executor.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"executor/nodeModifyTable.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"foreign/fdwapi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/nodeFuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parsetree.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/bufmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/lmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/tqual.h"</span> 
 
 
<a name="LN56"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>ExecOnConflictUpdate</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN916"><span class='Ref_to_Struct'>ModifyTableState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>mtstate</span><span class='Delimiter'>, 
</span><a name="LN57"></a>                     <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>resultRelInfo</span><span class='Delimiter'>, 
</span><a name="LN58"></a>                     <a href="../../include/storage/itemptr.h.html#LN47"><span class='Ref_to_Typedef'>ItemPointer</span></a> <span class='Declare_Parameter'>conflictTid</span><span class='Delimiter'>, 
</span><a name="LN59"></a>                     <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>planSlot</span><span class='Delimiter'>, 
</span><a name="LN60"></a>                     <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>excludedSlot</span><span class='Delimiter'>, 
</span><a name="LN61"></a>                     <a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN62"></a>                     <span class='Keyword'>bool </span><span class='Declare_Parameter'>canSetTag</span><span class='Delimiter'>, 
</span><a name="LN63"></a>                     <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>returning</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Verify that the tuples to be produced by INSERT or UPDATE match the 
 * target relation's rowtype 
 * 
 * We do this to guard against stale plans.  If plan invalidation is 
 * functioning properly then we should never get a failure here, but better 
 * safe than sorry.  Note that this is called after we have obtained lock 
 * on the target rel, so the rowtype can't change underneath us. 
 * 
 * The plan output is represented by its targetlist, because that makes 
 * handling the dropped-column case easier. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN78"></a><span class='Declare_Function'>ExecCheckPlanOutput</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>resultRel</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>targetList</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN80"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>resultDesc</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN78"><span class='Ref_to_Parameter'>resultRel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN81"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>attno</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN82"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN82"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN78"><span class='Ref_to_Parameter'>targetList</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN86"></a>        <a href="../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tle</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN82"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN87"></a>        <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>attr</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN86"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1373"><span class='Ref_to_Member'>resjunk</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* ignore junk tlist items */ 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN81"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>&GT;= </span><a href="nodeModifyTable.c.html#LN80"><span class='Ref_To_Local'>resultDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"table row type and query-specified row type do not match"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Query has too many columns."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="nodeModifyTable.c.html#LN87"><span class='Ref_To_Local'>attr</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN80"><span class='Ref_To_Local'>resultDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="nodeModifyTable.c.html#LN81"><span class='Ref_To_Local'>attno</span></a><span class='Operator'>++</span><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeModifyTable.c.html#LN87"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Normal case: demand type match */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeModifyTable.c.html#LN86"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><a href="nodeModifyTable.c.html#LN87"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>atttypid<span class='Parentheses'>)</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"table row type and query-specified row type do not match"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Table has type %s at ordinal position %d, but query expects %s."</span><span class='Delimiter'>, 
</span>                                   <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN87"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>atttypid<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="nodeModifyTable.c.html#LN81"><span class='Ref_To_Local'>attno</span></a><span class='Delimiter'>, 
</span>                             <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeModifyTable.c.html#LN86"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)))))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * For a dropped column, we can't check atttypid (it's likely 0). 
             * In any case the planner has most likely inserted an INT4 null. 
             * What we insist on is just *some* NULL constant. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN86"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a><span class='Parentheses'>)</span> <span class='Operator'>|| 
</span>                <span class='Operator'>!</span><span class='Parentheses'>((</span><a href="../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeModifyTable.c.html#LN86"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>constisnull<span class='Parentheses'>)</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"table row type and query-specified row type do not match"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Query provides a value for a dropped column at ordinal position %d."</span><span class='Delimiter'>, 
</span>                                   <a href="nodeModifyTable.c.html#LN81"><span class='Ref_To_Local'>attno</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN81"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>!= </span><a href="nodeModifyTable.c.html#LN80"><span class='Ref_To_Local'>resultDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>          <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"table row type and query-specified row type do not match"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Query has too few columns."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecCheckPlanOutput &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ExecProcessReturning --- evaluate a RETURNING list 
 * 
 * projectReturning: RETURNING projection info for current result rel 
 * tupleSlot: slot holding tuple actually inserted/updated/deleted 
 * planSlot: slot holding tuple returned by top subplan node 
 * 
 * Note: If tupleSlot is NULL, the FDW should have already provided econtext's 
 * scan tuple. 
 * 
 * Returns a slot holding the result tuple 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>* 
</span><a name="LN147"></a><span class='Declare_Function'>ExecProcessReturning</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>resultRelInfo</span><span class='Delimiter'>, 
</span><a name="LN148"></a>                     <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tupleSlot</span><span class='Delimiter'>, 
</span><a name="LN149"></a>                     <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>planSlot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN151"></a>    <a href="../../include/nodes/execnodes.h.html#LN291"><span class='Ref_to_Struct'>ProjectionInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>projectReturning</span> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN147"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN388"><span class='Ref_to_Member'>ri_projectReturning</span></a><span class='Delimiter'>; 
</span><a name="LN152"></a>    <a href="../../include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>econtext</span> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN151"><span class='Ref_To_Local'>projectReturning</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN297"><span class='Ref_to_Member'>pi_exprContext</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Reset per-tuple memory context to free any expression evaluation 
     * storage allocated in the previous cycle. 
     */ 
</span>    <a href="../../include/executor/executor.h.html#LN449"><span class='Ref_to_Macro'>ResetExprContext</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN152"><span class='Ref_To_Local'>econtext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make tuple and any needed join variables available to ExecProject */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN148"><span class='Ref_to_Parameter'>tupleSlot</span></a><span class='Parentheses'>) 
</span>        <a href="nodeModifyTable.c.html#LN152"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN196"><span class='Ref_to_Member'>ecxt_scantuple</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN148"><span class='Ref_to_Parameter'>tupleSlot</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN165"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * RETURNING expressions might reference the tableoid column, so 
         * initialize t_tableOid before evaluating them. 
         */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/executor/tuptable.h.html#LN137"><span class='Ref_to_Macro'>TupIsNull</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN152"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN196"><span class='Ref_to_Member'>ecxt_scantuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="nodeModifyTable.c.html#LN165"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/executor/tuptable.h.html#LN162"><span class='Ref_to_Proto'>ExecMaterializeSlot</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN152"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN196"><span class='Ref_to_Member'>ecxt_scantuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeModifyTable.c.html#LN165"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN147"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="nodeModifyTable.c.html#LN152"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN198"><span class='Ref_to_Member'>ecxt_outertuple</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN149"><span class='Ref_to_Parameter'>planSlot</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Compute the RETURNING expressions */ 
</span>    <span class='Control'>return</span> <a href="../../include/executor/executor.h.html#LN307"><span class='Ref_to_Func'>ExecProject</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN151"><span class='Ref_To_Local'>projectReturning</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecProcessReturning &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ExecCheckHeapTupleVisible -- verify heap tuple is visible 
 * 
 * It would not be consistent with guarantees of the higher isolation levels to 
 * proceed with avoiding insertion (taking speculative insertion's alternative 
 * path) on the basis of another tuple that is not visible to MVCC snapshot. 
 * Check for the need to raise a serialization failure, and do so as necessary. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN190"></a><span class='Declare_Function'>ExecCheckHeapTupleVisible</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN191"></a>                          <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tuple</span><span class='Delimiter'>, 
</span><a name="LN192"></a>                          <a href="../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a> <span class='Declare_Parameter'>buffer</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/xact.h.html#LN42"><span class='Ref_to_Macro'>IsolationUsesXactSnapshot</span></a><span class='Parentheses'>())</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We need buffer pin and lock to call HeapTupleSatisfiesVisibility. 
     * Caller should be holding pin, but not lock. 
     */ 
</span>    <a href="../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN192"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../include/storage/bufmgr.h.html#LN87"><span class='Ref_to_Const'>BUFFER_LOCK_SHARE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/tqual.h.html#LN44"><span class='Ref_to_Macro'>HeapTupleSatisfiesVisibility</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN191"><span class='Ref_to_Parameter'>tuple</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN190"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN408"><span class='Ref_to_Member'>es_snapshot</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN192"><span class='Ref_to_Parameter'>buffer</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * We should not raise a serialization failure if the conflict is 
         * against a tuple inserted by our own transaction, even if it's not 
         * visible to our snapshot.  (This would happen, for example, if 
         * conflicting keys are proposed for insertion in a single command.) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="../../include/access/htup_details.h.html#LN306"><span class='Ref_to_Macro'>HeapTupleHeaderGetXmin</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN191"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Parentheses'>)))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_T_R_SERIALIZATION_FAILURE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not serialize access due to concurrent update"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN192"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../include/storage/bufmgr.h.html#LN86"><span class='Ref_to_Const'>BUFFER_LOCK_UNLOCK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecCheckHeapTupleVisible &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ExecCheckTIDVisible -- convenience variant of ExecCheckHeapTupleVisible() 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN222"></a><span class='Declare_Function'>ExecCheckTIDVisible</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN223"></a>                    <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>relinfo</span><span class='Delimiter'>, 
</span><a name="LN224"></a>                    <a href="../../include/storage/itemptr.h.html#LN47"><span class='Ref_to_Typedef'>ItemPointer</span></a> <span class='Declare_Parameter'>tid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN226"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN223"><span class='Ref_to_Parameter'>relinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>; 
</span><a name="LN227"></a>    <a href="../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>buffer</span><span class='Delimiter'>; 
</span><a name="LN228"></a>    <a href="../../include/access/htup.h.html#LN61"><span class='Ref_to_Struct'>HeapTupleData</span></a> <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Redundantly check isolation level */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/xact.h.html#LN42"><span class='Ref_to_Macro'>IsolationUsesXactSnapshot</span></a><span class='Parentheses'>())</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="nodeModifyTable.c.html#LN228"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a> <span class='Operator'>= *</span><a href="nodeModifyTable.c.html#LN224"><span class='Ref_to_Parameter'>tid</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/heapam.h.html#LN134"><span class='Ref_to_Proto'>heap_fetch</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN226"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/utils/tqual.h.html#LN27"><span class='Ref_to_Const'>SnapshotAny</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN228"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN227"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"failed to fetch conflicting tuple for ON CONFLICT"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeModifyTable.c.html#LN189"><span class='Ref_to_Func'>ExecCheckHeapTupleVisible</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN222"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN228"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN227"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/storage/bufmgr.h.html#LN174"><span class='Ref_to_Proto'>ReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN227"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      ExecInsert 
 * 
 *      For INSERT, we have to insert the tuple into the target relation 
 *      and insert appropriate tuples into the index relations. 
 * 
 *      Returns RETURNING result if any, otherwise NULL. 
 * ---------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>* 
</span><a name="LN251"></a><span class='Declare_Function'>ExecInsert</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN916"><span class='Ref_to_Struct'>ModifyTableState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>mtstate</span><span class='Delimiter'>, 
</span><a name="LN252"></a>           <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Delimiter'>, 
</span><a name="LN253"></a>           <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>planSlot</span><span class='Delimiter'>, 
</span><a name="LN254"></a>           <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arbiterIndexes</span><span class='Delimiter'>, 
</span><a name="LN255"></a>           <a href="../../include/nodes/nodes.h.html#LN797"><span class='Ref_to_Enum'>OnConflictAction</span></a> <span class='Declare_Parameter'>onconflict</span><span class='Delimiter'>, 
</span><a name="LN256"></a>           <a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN257"></a>           <span class='Keyword'>bool </span><span class='Declare_Parameter'>canSetTag</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN259"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN260"></a>    <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>resultRelInfo</span><span class='Delimiter'>; 
</span><a name="LN261"></a>    <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>saved_resultRelInfo</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN262"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>resultRelationDesc</span><span class='Delimiter'>; 
</span><a name="LN263"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>newId</span><span class='Delimiter'>; 
</span><a name="LN264"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>recheckIndexes</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN265"></a>    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * get the heap tuple out of the tuple table slot, making sure we have a 
     * writable copy 
     */ 
</span>    <a href="nodeModifyTable.c.html#LN259"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/executor/tuptable.h.html#LN162"><span class='Ref_to_Proto'>ExecMaterializeSlot</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN252"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * get information on the (current) result relation 
     */ 
</span>    <a href="nodeModifyTable.c.html#LN260"><span class='Ref_To_Local'>resultRelInfo</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN256"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN422"><span class='Ref_to_Member'>es_result_relation_info</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Determine the partition to heap_insert the tuple into */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN251"><span class='Ref_to_Parameter'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN939"><span class='Ref_to_Member'>mt_partition_dispatch_info</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN281"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>leaf_part_index</span><span class='Delimiter'>; 
</span><a name="LN282"></a>        <a href="../../include/access/tupconvert.h.html#LN20"><span class='Ref_to_Struct'>TupleConversionMap</span></a> <span class='Operator'>*</span><span class='Declare_Local'>map</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Away we go ... If we end up not finding a partition after all, 
         * ExecFindPartition() does not return and errors out instead. 
         * Otherwise, the returned value is to be used as an index into arrays 
         * mt_partitions[] and mt_partition_tupconv_maps[] that will get us 
         * the ResultRelInfo and TupleConversionMap for the partition, 
         * respectively. 
         */ 
</span>        <a href="nodeModifyTable.c.html#LN281"><span class='Ref_To_Local'>leaf_part_index</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN214"><span class='Ref_to_Proto'>ExecFindPartition</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN260"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, 
</span>                                         <a href="nodeModifyTable.c.html#LN251"><span class='Ref_to_Parameter'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN939"><span class='Ref_to_Member'>mt_partition_dispatch_info</span></a><span class='Delimiter'>, 
</span>                                            <a href="nodeModifyTable.c.html#LN252"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, 
</span>                                            <a href="nodeModifyTable.c.html#LN256"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN281"><span class='Ref_To_Local'>leaf_part_index</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>               <a href="nodeModifyTable.c.html#LN281"><span class='Ref_To_Local'>leaf_part_index</span></a> <span class='Operator'>&LT; </span><a href="nodeModifyTable.c.html#LN251"><span class='Ref_to_Parameter'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN942"><span class='Ref_to_Member'>mt_num_partitions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Save the old ResultRelInfo and switch to the one corresponding to 
         * the selected partition. 
         */ 
</span>        <a href="nodeModifyTable.c.html#LN261"><span class='Ref_To_Local'>saved_resultRelInfo</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN260"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>; 
</span>        <a href="nodeModifyTable.c.html#LN260"><span class='Ref_To_Local'>resultRelInfo</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN251"><span class='Ref_to_Parameter'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN944"><span class='Ref_to_Member'>mt_partitions</span></a> <span class='Operator'>+ </span><a href="nodeModifyTable.c.html#LN281"><span class='Ref_To_Local'>leaf_part_index</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* We do not yet have a way to insert into a foreign partition */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN260"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN381"><span class='Ref_to_Member'>ri_FdwRoutine</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot route inserted tuples to a foreign table"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* For ExecInsertIndexTuples() to work on the partition's indexes */ 
</span>        <a href="nodeModifyTable.c.html#LN256"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN422"><span class='Ref_to_Member'>es_result_relation_info</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN260"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We might need to convert from the parent rowtype to the partition 
         * rowtype. 
         */ 
</span>        <a href="nodeModifyTable.c.html#LN282"><span class='Ref_To_Local'>map</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN251"><span class='Ref_to_Parameter'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN945"><span class='Ref_to_Member'>mt_partition_tupconv_maps</span></a><span class='Delimiter'>[</span><a href="nodeModifyTable.c.html#LN281"><span class='Ref_To_Local'>leaf_part_index</span></a><span class='Delimiter'>]; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN282"><span class='Ref_To_Local'>map</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN322"></a>            <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>partrel</span> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN260"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>; 
</span> 
            <a href="nodeModifyTable.c.html#LN259"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/tupconvert.h.html#LN44"><span class='Ref_to_Proto'>do_convert_tuple</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN259"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN282"><span class='Ref_To_Local'>map</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * We must use the partition's tuple descriptor from this point 
             * on, until we're finished dealing with the partition. Use the 
             * dedicated slot for that. 
             */ 
</span>            <a href="nodeModifyTable.c.html#LN252"><span class='Ref_to_Parameter'>slot</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN251"><span class='Ref_to_Parameter'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN947"><span class='Ref_to_Member'>mt_partition_tuple_slot</span></a><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN252"><span class='Ref_to_Parameter'>slot</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/executor/tuptable.h.html#LN146"><span class='Ref_to_Proto'>ExecSetSlotDescriptor</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN252"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN322"><span class='Ref_To_Local'>partrel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../include/executor/tuptable.h.html#LN147"><span class='Ref_to_Proto'>ExecStoreTuple</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN259"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN252"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if mtstate-&GT;mt_partition... &raquo; </span> 
 
    <a href="nodeModifyTable.c.html#LN262"><span class='Ref_To_Local'>resultRelationDesc</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN260"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the result relation has OIDs, force the tuple's OID to zero so that 
     * heap_insert will assign a fresh OID.  Usually the OID already will be 
     * zero at this point, but there are corner cases where the plan tree can 
     * return a tuple extracted literally from some table with the same 
     * rowtype. 
     * 
     * XXX if we ever wanted to allow users to assign their own OIDs to new 
     * rows, this'd be the place to do it.  For the moment, we make a point of 
     * doing this before calling triggers, so that a user-supplied trigger 
     * could hack the OID if desired. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN262"><span class='Ref_To_Local'>resultRelationDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relhasoids<span class='Parentheses'>) 
</span>        <a href="../../include/access/htup_details.h.html#LN697"><span class='Ref_to_Macro'>HeapTupleSetOid</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN259"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * BEFORE ROW INSERT Triggers. 
     * 
     * Note: We fire BEFORE ROW TRIGGERS for every attempted insertion in an 
     * INSERT ... ON CONFLICT statement.  We cannot check for constraint 
     * violations before firing these triggers, because they can change the 
     * values to insert.  Also, they can run arbitrary user-defined code with 
     * side-effects that we can't cancel by just not inserting the tuple. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN260"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a> <span class='Operator'>&& 
</span>        <a href="nodeModifyTable.c.html#LN260"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN54"><span class='Ref_to_Member'>trig_insert_before_row</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="nodeModifyTable.c.html#LN252"><span class='Ref_to_Parameter'>slot</span></a> <span class='Operator'>= </span><a href="../../include/commands/trigger.h.html#LN135"><span class='Ref_to_Proto'>ExecBRInsertTriggers</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN256"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN260"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN252"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN252"><span class='Ref_to_Parameter'>slot</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span>       <span class='Comment_Single_Line'>/* "do nothing" */ 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* trigger might have changed tuple */ 
</span>        <a href="nodeModifyTable.c.html#LN259"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/executor/tuptable.h.html#LN162"><span class='Ref_to_Proto'>ExecMaterializeSlot</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN252"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* INSTEAD OF ROW INSERT Triggers */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN260"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a> <span class='Operator'>&& 
</span>        <a href="nodeModifyTable.c.html#LN260"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN56"><span class='Ref_to_Member'>trig_insert_instead_row</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="nodeModifyTable.c.html#LN252"><span class='Ref_to_Parameter'>slot</span></a> <span class='Operator'>= </span><a href="../../include/commands/trigger.h.html#LN142"><span class='Ref_to_Proto'>ExecIRInsertTriggers</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN256"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN260"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN252"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN252"><span class='Ref_to_Parameter'>slot</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span>       <span class='Comment_Single_Line'>/* "do nothing" */ 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* trigger might have changed tuple */ 
</span>        <a href="nodeModifyTable.c.html#LN259"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/executor/tuptable.h.html#LN162"><span class='Ref_to_Proto'>ExecMaterializeSlot</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN252"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="nodeModifyTable.c.html#LN263"><span class='Ref_To_Local'>newId</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN260"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN381"><span class='Ref_to_Member'>ri_FdwRoutine</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * insert into foreign table: let the FDW do it 
         */ 
</span>        <a href="nodeModifyTable.c.html#LN252"><span class='Ref_to_Parameter'>slot</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN260"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN381"><span class='Ref_to_Member'>ri_FdwRoutine</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/fdwapi.h.html#LN196"><span class='Ref_to_Member'>ExecForeignInsert</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN256"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, 
</span>                                                               <a href="nodeModifyTable.c.html#LN260"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, 
</span>                                                               <a href="nodeModifyTable.c.html#LN252"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, 
</span>                                                               <a href="nodeModifyTable.c.html#LN253"><span class='Ref_to_Parameter'>planSlot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN252"><span class='Ref_to_Parameter'>slot</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span>       <span class='Comment_Single_Line'>/* "do nothing" */ 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* FDW might have changed tuple */ 
</span>        <a href="nodeModifyTable.c.html#LN259"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/executor/tuptable.h.html#LN162"><span class='Ref_to_Proto'>ExecMaterializeSlot</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN252"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * AFTER ROW Triggers or RETURNING expressions might reference the 
         * tableoid column, so initialize t_tableOid before evaluating them. 
         */ 
</span>        <a href="nodeModifyTable.c.html#LN259"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN262"><span class='Ref_To_Local'>resultRelationDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="nodeModifyTable.c.html#LN263"><span class='Ref_To_Local'>newId</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if resultRelInfo-&GT;ri_Fdw... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * We always check the partition constraint, including when the tuple 
         * got here via tuple-routing.  However we don't need to in the latter 
         * case if no BR trigger is defined on the partition.  Note that a BR 
         * trigger might modify the tuple such that the partition constraint 
         * is no longer satisfied, so we need to check in that case. 
         */ 
</span><a name="LN423"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>check_partition_constr</span> <span class='Operator'>= 
</span>        <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN260"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN391"><span class='Ref_to_Member'>ri_PartitionCheck</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Constraints might reference the tableoid column, so initialize 
         * t_tableOid before evaluating them. 
         */ 
</span>        <a href="nodeModifyTable.c.html#LN259"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN262"><span class='Ref_To_Local'>resultRelationDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Check any RLS INSERT WITH CHECK policies 
         * 
         * ExecWithCheckOptions() will skip any WCOs which are not of the kind 
         * we are looking for at this point. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN260"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN384"><span class='Ref_to_Member'>ri_WithCheckOptions</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/executor/executor.h.html#LN190"><span class='Ref_to_Proto'>ExecWithCheckOptions</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1088"><span class='Ref_to_EnumConst'>WCO_RLS_INSERT_CHECK</span></a><span class='Delimiter'>, 
</span>                                 <a href="nodeModifyTable.c.html#LN260"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN252"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN256"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * No need though if the tuple has been routed, and a BR trigger 
         * doesn't exist. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN261"><span class='Ref_To_Local'>saved_resultRelInfo</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>            <span class='Operator'>!</span><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN260"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a> <span class='Operator'>&& 
</span>              <a href="nodeModifyTable.c.html#LN260"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN54"><span class='Ref_to_Member'>trig_insert_before_row</span></a><span class='Parentheses'>))</span> 
            <a href="nodeModifyTable.c.html#LN423"><span class='Ref_To_Local'>check_partition_constr</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Check the constraints of the tuple */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN262"><span class='Ref_To_Local'>resultRelationDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN75"><span class='Ref_to_Member'>constr</span></a> <span class='Operator'>|| </span><a href="nodeModifyTable.c.html#LN423"><span class='Ref_To_Local'>check_partition_constr</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/executor/executor.h.html#LN188"><span class='Ref_to_Proto'>ExecConstraints</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN260"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN252"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN256"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN255"><span class='Ref_to_Parameter'>onconflict</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/nodes.h.html#LN799"><span class='Ref_to_EnumConst'>ONCONFLICT_NONE</span></a> <span class='Operator'>&& </span><a href="nodeModifyTable.c.html#LN260"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN374"><span class='Ref_to_Member'>ri_NumIndices</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Perform a speculative insertion. */ 
</span><a name="LN458"></a>            <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>specToken</span><span class='Delimiter'>; 
</span><a name="LN459"></a>            <a href="../../include/storage/itemptr.h.html#LN35"><span class='Ref_to_Struct'>ItemPointerData</span></a> <span class='Declare_Local'>conflictTid</span><span class='Delimiter'>; 
</span><a name="LN460"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>specConflict</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Do a non-conclusive check for conflicts first. 
             * 
             * We're not holding any locks yet, so this doesn't guarantee that 
             * the later insert won't conflict.  But it avoids leaving behind 
             * a lot of canceled speculative insertions, if you run a lot of 
             * INSERT ON CONFLICT statements that do conflict. 
             * 
             * We loop back here if we find a conflict below, either during 
             * the pre-check, or when we re-check after inserting the tuple 
             * speculatively. 
             */ 
</span><a name="LN474"></a>    <span class='Label'>vlock</span><span class='Operator'>: 
</span>            <a href="nodeModifyTable.c.html#LN460"><span class='Ref_To_Local'>specConflict</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="execIndexing.c.html#LN473"><span class='Ref_to_Func'>ExecCheckIndexConstraints</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN252"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN256"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN459"><span class='Ref_To_Local'>conflictTid</span></a><span class='Delimiter'>, 
</span>                                           <a href="nodeModifyTable.c.html#LN254"><span class='Ref_to_Parameter'>arbiterIndexes</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* committed conflict tuple found */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN255"><span class='Ref_to_Parameter'>onconflict</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN801"><span class='Ref_to_EnumConst'>ONCONFLICT_UPDATE</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * In case of ON CONFLICT DO UPDATE, execute the UPDATE 
                     * part.  Be prepared to retry if the UPDATE fails because 
                     * of another concurrent UPDATE/DELETE to the conflict 
                     * tuple. 
                     */ 
</span><a name="LN488"></a>                    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>returning</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN56"><span class='Ref_to_Proto'>ExecOnConflictUpdate</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN251"><span class='Ref_to_Parameter'>mtstate</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN260"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, 
</span>                                             <span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN459"><span class='Ref_To_Local'>conflictTid</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN253"><span class='Ref_to_Parameter'>planSlot</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN252"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, 
</span>                                             <a href="nodeModifyTable.c.html#LN256"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN257"><span class='Ref_to_Parameter'>canSetTag</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN488"><span class='Ref_To_Local'>returning</span></a><span class='Parentheses'>))</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="../../include/nodes/execnodes.h.html#LN862"><span class='Ref_to_Macro'>InstrCountFiltered2</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN251"><span class='Ref_to_Parameter'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>return</span> <a href="nodeModifyTable.c.html#LN488"><span class='Ref_To_Local'>returning</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                        <span class='Control'>goto</span> <span class='Symbol_Characters'>&uarr;</span><a href="nodeModifyTable.c.html#LN474"><span class='Ref_to_Label'>vlock</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if onconflict==ONCONFLIC... &raquo; </span> 
                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * In case of ON CONFLICT DO NOTHING, do nothing. However, 
                     * verify that the tuple is visible to the executor's MVCC 
                     * snapshot at higher isolation levels. 
                     */ 
</span>                    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN255"><span class='Ref_to_Parameter'>onconflict</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN800"><span class='Ref_to_EnumConst'>ONCONFLICT_NOTHING</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="nodeModifyTable.c.html#LN221"><span class='Ref_to_Func'>ExecCheckTIDVisible</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN256"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN260"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN459"><span class='Ref_To_Local'>conflictTid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../include/nodes/execnodes.h.html#LN862"><span class='Ref_to_Macro'>InstrCountFiltered2</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN251"><span class='Ref_to_Parameter'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !ExecCheckIndexConstr... &raquo; </span> 
 
            <span class='Comment_Multi_Line'>/* 
             * Before we start insertion proper, acquire our "speculative 
             * insertion lock".  Others can use that to wait for us to decide 
             * if we're going to go ahead with the insertion, instead of 
             * waiting for the whole transaction to complete. 
             */ 
</span>            <a href="nodeModifyTable.c.html#LN458"><span class='Ref_To_Local'>specToken</span></a> <span class='Operator'>= </span><a href="../../include/storage/lmgr.h.html#LN82"><span class='Ref_to_Proto'>SpeculativeInsertionLockAcquire</span></a><span class='Parentheses'>(</span><a href="../../include/access/xact.h.html#LN333"><span class='Ref_to_Proto'>GetCurrentTransactionId</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>            <a href="../../include/access/htup_details.h.html#LN433"><span class='Ref_to_Macro'>HeapTupleHeaderSetSpeculativeToken</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN259"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN458"><span class='Ref_To_Local'>specToken</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* insert the tuple, with the speculative token */ 
</span>            <a href="nodeModifyTable.c.html#LN263"><span class='Ref_To_Local'>newId</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN151"><span class='Ref_to_Proto'>heap_insert</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN262"><span class='Ref_To_Local'>resultRelationDesc</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN259"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, 
</span>                                <a href="nodeModifyTable.c.html#LN256"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN417"><span class='Ref_to_Member'>es_output_cid</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/access/heapam.h.html#LN30"><span class='Ref_to_Const'>HEAP_INSERT_SPECULATIVE</span></a><span class='Delimiter'>, 
</span>                                <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* insert index entries for tuple */ 
</span>            <a href="nodeModifyTable.c.html#LN264"><span class='Ref_To_Local'>recheckIndexes</span></a> <span class='Operator'>= </span><a href="execIndexing.c.html#LN269"><span class='Ref_to_Func'>ExecInsertIndexTuples</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN252"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN259"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                 <a href="nodeModifyTable.c.html#LN256"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN460"><span class='Ref_To_Local'>specConflict</span></a><span class='Delimiter'>, 
</span>                                                   <a href="nodeModifyTable.c.html#LN254"><span class='Ref_to_Parameter'>arbiterIndexes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* adjust the tuple's state accordingly */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeModifyTable.c.html#LN460"><span class='Ref_To_Local'>specConflict</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/access/heapam.h.html#LN158"><span class='Ref_to_Proto'>heap_finish_speculative</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN262"><span class='Ref_To_Local'>resultRelationDesc</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN259"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../include/access/heapam.h.html#LN159"><span class='Ref_to_Proto'>heap_abort_speculative</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN262"><span class='Ref_To_Local'>resultRelationDesc</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN259"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Wake up anyone waiting for our decision.  They will re-check 
             * the tuple, see that it's no longer speculative, and wait on our 
             * XID as if this was a regularly inserted tuple all along.  Or if 
             * we killed the tuple, they will see it's dead, and proceed as if 
             * the tuple never existed. 
             */ 
</span>            <a href="../../include/storage/lmgr.h.html#LN83"><span class='Ref_to_Proto'>SpeculativeInsertionLockRelease</span></a><span class='Parentheses'>(</span><a href="../../include/access/xact.h.html#LN333"><span class='Ref_to_Proto'>GetCurrentTransactionId</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If there was a conflict, start from the beginning.  We'll do 
             * the pre-check again, which will now find the conflicting tuple 
             * (unless it aborts before we get there). 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN460"><span class='Ref_To_Local'>specConflict</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN264"><span class='Ref_To_Local'>recheckIndexes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&uarr;</span><a href="nodeModifyTable.c.html#LN474"><span class='Ref_to_Label'>vlock</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* Since there was no insertion conflict, we're done */ 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if onconflict!=ONCONFLIC... &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * insert the tuple normally. 
             * 
             * Note: heap_insert returns the tid (location) of the new tuple 
             * in the t_self field. 
             */ 
</span>            <a href="nodeModifyTable.c.html#LN263"><span class='Ref_To_Local'>newId</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN151"><span class='Ref_to_Proto'>heap_insert</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN262"><span class='Ref_To_Local'>resultRelationDesc</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN259"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, 
</span>                                <a href="nodeModifyTable.c.html#LN256"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN417"><span class='Ref_to_Member'>es_output_cid</span></a><span class='Delimiter'>, 
</span>                                <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* insert index entries for tuple */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN260"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN374"><span class='Ref_to_Member'>ri_NumIndices</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="nodeModifyTable.c.html#LN264"><span class='Ref_To_Local'>recheckIndexes</span></a> <span class='Operator'>= </span><a href="execIndexing.c.html#LN269"><span class='Ref_to_Func'>ExecInsertIndexTuples</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN252"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN259"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                       <a href="nodeModifyTable.c.html#LN256"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                                       <a href="nodeModifyTable.c.html#LN254"><span class='Ref_to_Parameter'>arbiterIndexes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN257"><span class='Ref_to_Parameter'>canSetTag</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN256"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN453"><span class='Ref_to_Member'>es_processed</span></a><span class='Parentheses'>)</span><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="nodeModifyTable.c.html#LN256"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN454"><span class='Ref_to_Member'>es_lastoid</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN263"><span class='Ref_To_Local'>newId</span></a><span class='Delimiter'>; 
</span>        <a href="../../include/access/heapam.h.html#LN145"><span class='Ref_to_Proto'>setLastTid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN259"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* AFTER ROW INSERT Triggers */ 
</span>    <a href="../../include/commands/trigger.h.html#LN138"><span class='Ref_to_Proto'>ExecARInsertTriggers</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN256"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN260"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN259"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN264"><span class='Ref_To_Local'>recheckIndexes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN264"><span class='Ref_To_Local'>recheckIndexes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check any WITH CHECK OPTION constraints from parent views.  We are 
     * required to do this after testing all constraints and uniqueness 
     * violations per the SQL spec, so we do it after actually inserting the 
     * record into the heap and all indexes. 
     * 
     * ExecWithCheckOptions will elog(ERROR) if a violation is found, so the 
     * tuple will never be seen, if it violates the WITH CHECK OPTION. 
     * 
     * ExecWithCheckOptions() will skip any WCOs which are not of the kind we 
     * are looking for at this point. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN260"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN384"><span class='Ref_to_Member'>ri_WithCheckOptions</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/executor/executor.h.html#LN190"><span class='Ref_to_Proto'>ExecWithCheckOptions</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1087"><span class='Ref_to_EnumConst'>WCO_VIEW_CHECK</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN260"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN252"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN256"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Process RETURNING if present */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN260"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN388"><span class='Ref_to_Member'>ri_projectReturning</span></a><span class='Parentheses'>) 
</span>        <a href="nodeModifyTable.c.html#LN265"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN146"><span class='Ref_to_Func'>ExecProcessReturning</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN260"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN252"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN253"><span class='Ref_to_Parameter'>planSlot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN261"><span class='Ref_To_Local'>saved_resultRelInfo</span></a><span class='Parentheses'>) 
</span>        <a href="nodeModifyTable.c.html#LN256"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN422"><span class='Ref_to_Member'>es_result_relation_info</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN261"><span class='Ref_To_Local'>saved_resultRelInfo</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="nodeModifyTable.c.html#LN265"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecInsert &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      ExecDelete 
 * 
 *      DELETE is like UPDATE, except that we delete the tuple and no 
 *      index modifications are needed. 
 * 
 *      When deleting from a table, tupleid identifies the tuple to 
 *      delete and oldtuple is NULL.  When deleting from a view, 
 *      oldtuple is passed to the INSTEAD OF triggers and identifies 
 *      what to delete, and tupleid is invalid.  When deleting from a 
 *      foreign table, tupleid is invalid; the FDW has to figure out 
 *      which row to delete using data from the planSlot.  oldtuple is 
 *      passed to foreign table triggers; it is NULL when the foreign 
 *      table has no relevant triggers. 
 * 
 *      Returns RETURNING result if any, otherwise NULL. 
 * ---------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>* 
</span><a name="LN638"></a><span class='Declare_Function'>ExecDelete</span><span class='Parentheses'>(</span><a href="../../include/storage/itemptr.h.html#LN47"><span class='Ref_to_Typedef'>ItemPointer</span></a> <span class='Declare_Parameter'>tupleid</span><span class='Delimiter'>, 
</span><a name="LN639"></a>           <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>oldtuple</span><span class='Delimiter'>, 
</span><a name="LN640"></a>           <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>planSlot</span><span class='Delimiter'>, 
</span><a name="LN641"></a>           <a href="../../include/nodes/execnodes.h.html#LN873"><span class='Ref_to_Struct'>EPQState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>epqstate</span><span class='Delimiter'>, 
</span><a name="LN642"></a>           <a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN643"></a>           <span class='Keyword'>bool </span><span class='Declare_Parameter'>canSetTag</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN645"></a>    <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>resultRelInfo</span><span class='Delimiter'>; 
</span><a name="LN646"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>resultRelationDesc</span><span class='Delimiter'>; 
</span><a name="LN647"></a>    <a href="../../include/utils/snapshot.h.html#LN118"><span class='Ref_to_Typedef'>HTSU_Result</span></a> <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN648"></a>    <a href="../../include/access/heapam.h.html#LN67"><span class='Ref_to_Struct'>HeapUpdateFailureData</span></a> <span class='Declare_Local'>hufd</span><span class='Delimiter'>; 
</span><a name="LN649"></a>    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>slot</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * get information on the (current) result relation 
     */ 
</span>    <a href="nodeModifyTable.c.html#LN645"><span class='Ref_To_Local'>resultRelInfo</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN642"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN422"><span class='Ref_to_Member'>es_result_relation_info</span></a><span class='Delimiter'>; 
</span>    <a href="nodeModifyTable.c.html#LN646"><span class='Ref_To_Local'>resultRelationDesc</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN645"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* BEFORE ROW DELETE Triggers */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN645"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a> <span class='Operator'>&& 
</span>        <a href="nodeModifyTable.c.html#LN645"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN64"><span class='Ref_to_Member'>trig_delete_before_row</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN661"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>dodelete</span><span class='Delimiter'>; 
</span> 
        <a href="nodeModifyTable.c.html#LN661"><span class='Ref_To_Local'>dodelete</span></a> <span class='Operator'>= </span><a href="../../include/commands/trigger.h.html#LN149"><span class='Ref_to_Proto'>ExecBRDeleteTriggers</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN642"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN641"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN645"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, 
</span>                                        <a href="nodeModifyTable.c.html#LN638"><span class='Ref_to_Parameter'>tupleid</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN639"><span class='Ref_to_Parameter'>oldtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeModifyTable.c.html#LN661"><span class='Ref_To_Local'>dodelete</span></a><span class='Parentheses'>)</span>          <span class='Comment_Single_Line'>/* "do nothing" */ 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* INSTEAD OF ROW DELETE Triggers */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN645"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a> <span class='Operator'>&& 
</span>        <a href="nodeModifyTable.c.html#LN645"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN66"><span class='Ref_to_Member'>trig_delete_instead_row</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN674"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>dodelete</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN639"><span class='Ref_to_Parameter'>oldtuple</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeModifyTable.c.html#LN674"><span class='Ref_To_Local'>dodelete</span></a> <span class='Operator'>= </span><a href="../../include/commands/trigger.h.html#LN158"><span class='Ref_to_Proto'>ExecIRDeleteTriggers</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN642"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN645"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN639"><span class='Ref_to_Parameter'>oldtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeModifyTable.c.html#LN674"><span class='Ref_To_Local'>dodelete</span></a><span class='Parentheses'>)</span>          <span class='Comment_Single_Line'>/* "do nothing" */ 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN645"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN381"><span class='Ref_to_Member'>ri_FdwRoutine</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN684"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * delete from foreign table: let the FDW do it 
         * 
         * We offer the trigger tuple slot as a place to store RETURNING data, 
         * although the FDW can return some other slot if it wants.  Set up 
         * the slot's tupdesc so the FDW doesn't need to do that for itself. 
         */ 
</span>        <a href="nodeModifyTable.c.html#LN649"><span class='Ref_To_Local'>slot</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN642"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN436"><span class='Ref_to_Member'>es_trig_tuple_slot</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN649"><span class='Ref_To_Local'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/tuptable.h.html#LN120"><span class='Ref_to_Member'>tts_tupleDescriptor</span></a> <span class='Operator'>!= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN646"><span class='Ref_To_Local'>resultRelationDesc</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/executor/tuptable.h.html#LN146"><span class='Ref_to_Proto'>ExecSetSlotDescriptor</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN649"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN646"><span class='Ref_To_Local'>resultRelationDesc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="nodeModifyTable.c.html#LN649"><span class='Ref_To_Local'>slot</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN645"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN381"><span class='Ref_to_Member'>ri_FdwRoutine</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/fdwapi.h.html#LN198"><span class='Ref_to_Member'>ExecForeignDelete</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN642"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, 
</span>                                                               <a href="nodeModifyTable.c.html#LN645"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, 
</span>                                                               <a href="nodeModifyTable.c.html#LN649"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>, 
</span>                                                               <a href="nodeModifyTable.c.html#LN640"><span class='Ref_to_Parameter'>planSlot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN649"><span class='Ref_To_Local'>slot</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span>       <span class='Comment_Single_Line'>/* "do nothing" */ 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * RETURNING expressions might reference the tableoid column, so 
         * initialize t_tableOid before evaluating them. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN649"><span class='Ref_To_Local'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/tuptable.h.html#LN115"><span class='Ref_to_Member'>tts_isempty</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/executor/tuptable.h.html#LN156"><span class='Ref_to_Proto'>ExecStoreAllNullTuple</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN649"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeModifyTable.c.html#LN684"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/executor/tuptable.h.html#LN162"><span class='Ref_to_Proto'>ExecMaterializeSlot</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN649"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeModifyTable.c.html#LN684"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN646"><span class='Ref_To_Local'>resultRelationDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if resultRelInfo-&GT;ri_Fdw... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * delete the tuple 
         * 
         * Note: if es_crosscheck_snapshot isn't InvalidSnapshot, we check 
         * that the row to be deleted is visible to that snapshot, and throw a 
         * can't-serialize error if not. This is a special-case behavior 
         * needed for referential integrity updates in transaction-snapshot 
         * mode transactions. 
         */ 
</span><a name="LN725"></a><span class='Label'>ldelete</span><span class='Operator'>:</span><span class='Delimiter'>; 
</span>        <a href="nodeModifyTable.c.html#LN647"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN155"><span class='Ref_to_Proto'>heap_delete</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN646"><span class='Ref_To_Local'>resultRelationDesc</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN638"><span class='Ref_to_Parameter'>tupleid</span></a><span class='Delimiter'>, 
</span>                             <a href="nodeModifyTable.c.html#LN642"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN417"><span class='Ref_to_Member'>es_output_cid</span></a><span class='Delimiter'>, 
</span>                             <a href="nodeModifyTable.c.html#LN642"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN409"><span class='Ref_to_Member'>es_crosscheck_snapshot</span></a><span class='Delimiter'>, 
</span>                             <span class='Boolean'>true </span><span class='Comment_Multi_Line'>/* wait for commit */ </span><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN648"><span class='Ref_To_Local'>hufd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN647"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../include/utils/snapshot.h.html#LN122"><span class='Ref_to_EnumConst'>HeapTupleSelfUpdated</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * The target tuple was already updated or deleted by the 
                 * current command, or by a later command in the current 
                 * transaction.  The former case is possible in a join DELETE 
                 * where multiple tuples join to the same target tuple. This 
                 * is somewhat questionable, but Postgres has always allowed 
                 * it: we just ignore additional deletion attempts. 
                 * 
                 * The latter case arises if the tuple is modified by a 
                 * command in a BEFORE trigger, or perhaps by a command in a 
                 * volatile function used in the query.  In such situations we 
                 * should not ignore the deletion, but it is equally unsafe to 
                 * proceed.  We don't want to discard the original DELETE 
                 * while keeping the triggered actions based on its deletion; 
                 * and it would be no better to allow the original DELETE 
                 * while discarding updates that it triggered.  The row update 
                 * carries some information that might be important according 
                 * to business rules; so throwing an error is the only safe 
                 * course. 
                 * 
                 * If a trigger actually intends this type of interaction, it 
                 * can re-execute the DELETE and then return NULL to cancel 
                 * the outer delete. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN648"><span class='Ref_To_Local'>hufd</span></a><span class='Operator'>.</span><a href="../../include/access/heapam.h.html#LN71"><span class='Ref_to_Member'>cmax</span></a> <span class='Operator'>!= </span><a href="nodeModifyTable.c.html#LN642"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN417"><span class='Ref_to_Member'>es_output_cid</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_TRIGGERED_DATA_CHANGE_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"tuple to be updated was already modified by an operation triggered by the current command"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Consider using an AFTER trigger instead of a BEFORE trigger to propagate changes to other rows."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Else, already deleted by self; nothing to do */ 
</span>                <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../include/utils/snapshot.h.html#LN120"><span class='Ref_to_EnumConst'>HeapTupleMayBeUpdated</span></a><span class='Operator'>: 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../include/utils/snapshot.h.html#LN123"><span class='Ref_to_EnumConst'>HeapTupleUpdated</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/xact.h.html#LN42"><span class='Ref_to_Macro'>IsolationUsesXactSnapshot</span></a><span class='Parentheses'>())</span> 
                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_T_R_SERIALIZATION_FAILURE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not serialize access due to concurrent update"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../storage/page/itemptr.c.html#LN27"><span class='Ref_to_Func'>ItemPointerEquals</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN638"><span class='Ref_to_Parameter'>tupleid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN648"><span class='Ref_To_Local'>hufd</span></a><span class='Operator'>.</span><a href="../../include/access/heapam.h.html#LN69"><span class='Ref_to_Member'>ctid</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span><a name="LN778"></a>                    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>epqslot</span><span class='Delimiter'>; 
</span> 
                    <a href="nodeModifyTable.c.html#LN778"><span class='Ref_To_Local'>epqslot</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN195"><span class='Ref_to_Proto'>EvalPlanQual</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN642"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, 
</span>                                           <a href="nodeModifyTable.c.html#LN641"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Delimiter'>, 
</span>                                           <a href="nodeModifyTable.c.html#LN646"><span class='Ref_To_Local'>resultRelationDesc</span></a><span class='Delimiter'>, 
</span>                                           <a href="nodeModifyTable.c.html#LN645"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN372"><span class='Ref_to_Member'>ri_RangeTableIndex</span></a><span class='Delimiter'>, 
</span>                                           <a href="../../include/access/heapam.h.html#LN46"><span class='Ref_to_EnumConst'>LockTupleExclusive</span></a><span class='Delimiter'>, 
</span>                                           <span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN648"><span class='Ref_To_Local'>hufd</span></a><span class='Operator'>.</span><a href="../../include/access/heapam.h.html#LN69"><span class='Ref_to_Member'>ctid</span></a><span class='Delimiter'>, 
</span>                                           <a href="nodeModifyTable.c.html#LN648"><span class='Ref_To_Local'>hufd</span></a><span class='Operator'>.</span><a href="../../include/access/heapam.h.html#LN70"><span class='Ref_to_Member'>xmax</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/executor/tuptable.h.html#LN137"><span class='Ref_to_Macro'>TupIsNull</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN778"><span class='Ref_To_Local'>epqslot</span></a><span class='Parentheses'>))</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Operator'>*</span><a href="nodeModifyTable.c.html#LN638"><span class='Ref_to_Parameter'>tupleid</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN648"><span class='Ref_To_Local'>hufd</span></a><span class='Operator'>.</span><a href="../../include/access/heapam.h.html#LN69"><span class='Ref_to_Member'>ctid</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>goto</span> <span class='Symbol_Characters'>&uarr;</span><a href="nodeModifyTable.c.html#LN725"><span class='Ref_to_Label'>ldelete</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span>                <span class='Comment_Multi_Line'>/* tuple already deleted; nothing to do */ 
</span>                <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized heap_delete status: %u"</span><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN647"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch result &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * Note: Normally one would think that we have to delete index tuples 
         * associated with the heap tuple now... 
         * 
         * ... but in POSTGRES, we have no need to do this because VACUUM will 
         * take care of it later.  We can't delete index tuples immediately 
         * anyway, since the tuple is still visible to other transactions. 
         */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN643"><span class='Ref_to_Parameter'>canSetTag</span></a><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN642"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN453"><span class='Ref_to_Member'>es_processed</span></a><span class='Parentheses'>)</span><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* AFTER ROW DELETE Triggers */ 
</span>    <a href="../../include/commands/trigger.h.html#LN154"><span class='Ref_to_Proto'>ExecARDeleteTriggers</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN642"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN645"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN638"><span class='Ref_to_Parameter'>tupleid</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN639"><span class='Ref_to_Parameter'>oldtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Process RETURNING if present */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN645"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN388"><span class='Ref_to_Member'>ri_projectReturning</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * We have to put the target tuple into a slot, which means first we 
         * gotta fetch it.  We can use the trigger tuple slot. 
         */ 
</span><a name="LN824"></a>        <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rslot</span><span class='Delimiter'>; 
</span><a name="LN825"></a>        <a href="../../include/access/htup.h.html#LN61"><span class='Ref_to_Struct'>HeapTupleData</span></a> <span class='Declare_Local'>deltuple</span><span class='Delimiter'>; 
</span><a name="LN826"></a>        <a href="../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>delbuffer</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN645"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN381"><span class='Ref_to_Member'>ri_FdwRoutine</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* FDW must have provided a slot containing the deleted row */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/executor/tuptable.h.html#LN137"><span class='Ref_to_Macro'>TupIsNull</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN649"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="nodeModifyTable.c.html#LN826"><span class='Ref_To_Local'>delbuffer</span></a> <span class='Operator'>= </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="nodeModifyTable.c.html#LN649"><span class='Ref_To_Local'>slot</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN642"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN436"><span class='Ref_to_Member'>es_trig_tuple_slot</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN639"><span class='Ref_to_Parameter'>oldtuple</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="nodeModifyTable.c.html#LN825"><span class='Ref_To_Local'>deltuple</span></a> <span class='Operator'>= *</span><a href="nodeModifyTable.c.html#LN639"><span class='Ref_to_Parameter'>oldtuple</span></a><span class='Delimiter'>; 
</span>                <a href="nodeModifyTable.c.html#LN826"><span class='Ref_To_Local'>delbuffer</span></a> <span class='Operator'>= </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="nodeModifyTable.c.html#LN825"><span class='Ref_To_Local'>deltuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a> <span class='Operator'>= *</span><a href="nodeModifyTable.c.html#LN638"><span class='Ref_to_Parameter'>tupleid</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/heapam.h.html#LN134"><span class='Ref_to_Proto'>heap_fetch</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN646"><span class='Ref_To_Local'>resultRelationDesc</span></a><span class='Delimiter'>, </span><a href="../../include/utils/tqual.h.html#LN27"><span class='Ref_to_Const'>SnapshotAny</span></a><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN825"><span class='Ref_To_Local'>deltuple</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN826"><span class='Ref_To_Local'>delbuffer</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
                    <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"failed to fetch deleted tuple for DELETE RETURNING"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN649"><span class='Ref_To_Local'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/tuptable.h.html#LN120"><span class='Ref_to_Member'>tts_tupleDescriptor</span></a> <span class='Operator'>!= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN646"><span class='Ref_To_Local'>resultRelationDesc</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/executor/tuptable.h.html#LN146"><span class='Ref_to_Proto'>ExecSetSlotDescriptor</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN649"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN646"><span class='Ref_To_Local'>resultRelationDesc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../include/executor/tuptable.h.html#LN147"><span class='Ref_to_Proto'>ExecStoreTuple</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN825"><span class='Ref_To_Local'>deltuple</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN649"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>, </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
        <a href="nodeModifyTable.c.html#LN824"><span class='Ref_To_Local'>rslot</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN146"><span class='Ref_to_Func'>ExecProcessReturning</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN645"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN649"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN640"><span class='Ref_to_Parameter'>planSlot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Before releasing the target tuple again, make sure rslot has a 
         * local copy of any pass-by-reference values. 
         */ 
</span>        <a href="../../include/executor/tuptable.h.html#LN162"><span class='Ref_to_Proto'>ExecMaterializeSlot</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN824"><span class='Ref_To_Local'>rslot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/executor/tuptable.h.html#LN154"><span class='Ref_to_Proto'>ExecClearTuple</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN649"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/storage/bufmgr.h.html#LN113"><span class='Ref_to_Macro'>BufferIsValid</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN826"><span class='Ref_To_Local'>delbuffer</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/storage/bufmgr.h.html#LN174"><span class='Ref_to_Proto'>ReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN826"><span class='Ref_To_Local'>delbuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span> <a href="nodeModifyTable.c.html#LN824"><span class='Ref_To_Local'>rslot</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if resultRelInfo-&GT;ri_pro... &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecDelete &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      ExecUpdate 
 * 
 *      note: we can't run UPDATE queries with transactions 
 *      off because UPDATEs are actually INSERTs and our 
 *      scan will mistakenly loop forever, updating the tuple 
 *      it just inserted..  This should be fixed but until it 
 *      is, we don't want to get stuck in an infinite loop 
 *      which corrupts your database.. 
 * 
 *      When updating a table, tupleid identifies the tuple to 
 *      update and oldtuple is NULL.  When updating a view, oldtuple 
 *      is passed to the INSTEAD OF triggers and identifies what to 
 *      update, and tupleid is invalid.  When updating a foreign table, 
 *      tupleid is invalid; the FDW has to figure out which row to 
 *      update using data from the planSlot.  oldtuple is passed to 
 *      foreign table triggers; it is NULL when the foreign table has 
 *      no relevant triggers. 
 * 
 *      Returns RETURNING result if any, otherwise NULL. 
 * ---------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>* 
</span><a name="LN896"></a><span class='Declare_Function'>ExecUpdate</span><span class='Parentheses'>(</span><a href="../../include/storage/itemptr.h.html#LN47"><span class='Ref_to_Typedef'>ItemPointer</span></a> <span class='Declare_Parameter'>tupleid</span><span class='Delimiter'>, 
</span><a name="LN897"></a>           <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>oldtuple</span><span class='Delimiter'>, 
</span><a name="LN898"></a>           <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Delimiter'>, 
</span><a name="LN899"></a>           <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>planSlot</span><span class='Delimiter'>, 
</span><a name="LN900"></a>           <a href="../../include/nodes/execnodes.h.html#LN873"><span class='Ref_to_Struct'>EPQState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>epqstate</span><span class='Delimiter'>, 
</span><a name="LN901"></a>           <a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN902"></a>           <span class='Keyword'>bool </span><span class='Declare_Parameter'>canSetTag</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN904"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN905"></a>    <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>resultRelInfo</span><span class='Delimiter'>; 
</span><a name="LN906"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>resultRelationDesc</span><span class='Delimiter'>; 
</span><a name="LN907"></a>    <a href="../../include/utils/snapshot.h.html#LN118"><span class='Ref_to_Typedef'>HTSU_Result</span></a> <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN908"></a>    <a href="../../include/access/heapam.h.html#LN67"><span class='Ref_to_Struct'>HeapUpdateFailureData</span></a> <span class='Declare_Local'>hufd</span><span class='Delimiter'>; 
</span><a name="LN909"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>recheckIndexes</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * abort the operation if not running transactions 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/miscadmin.h.html#LN369"><span class='Ref_to_Macro'>IsBootstrapProcessingMode</span></a><span class='Parentheses'>())</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cannot UPDATE during bootstrap"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * get the heap tuple out of the tuple table slot, making sure we have a 
     * writable copy 
     */ 
</span>    <a href="nodeModifyTable.c.html#LN904"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/executor/tuptable.h.html#LN162"><span class='Ref_to_Proto'>ExecMaterializeSlot</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN898"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * get information on the (current) result relation 
     */ 
</span>    <a href="nodeModifyTable.c.html#LN905"><span class='Ref_To_Local'>resultRelInfo</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN901"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN422"><span class='Ref_to_Member'>es_result_relation_info</span></a><span class='Delimiter'>; 
</span>    <a href="nodeModifyTable.c.html#LN906"><span class='Ref_To_Local'>resultRelationDesc</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN905"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* BEFORE ROW UPDATE Triggers */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN905"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a> <span class='Operator'>&& 
</span>        <a href="nodeModifyTable.c.html#LN905"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN59"><span class='Ref_to_Member'>trig_update_before_row</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="nodeModifyTable.c.html#LN898"><span class='Ref_to_Parameter'>slot</span></a> <span class='Operator'>= </span><a href="../../include/commands/trigger.h.html#LN165"><span class='Ref_to_Proto'>ExecBRUpdateTriggers</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN901"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN900"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN905"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, 
</span>                                    <a href="nodeModifyTable.c.html#LN896"><span class='Ref_to_Parameter'>tupleid</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN897"><span class='Ref_to_Parameter'>oldtuple</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN898"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN898"><span class='Ref_to_Parameter'>slot</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span>       <span class='Comment_Single_Line'>/* "do nothing" */ 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* trigger might have changed tuple */ 
</span>        <a href="nodeModifyTable.c.html#LN904"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/executor/tuptable.h.html#LN162"><span class='Ref_to_Proto'>ExecMaterializeSlot</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN898"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* INSTEAD OF ROW UPDATE Triggers */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN905"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a> <span class='Operator'>&& 
</span>        <a href="nodeModifyTable.c.html#LN905"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN61"><span class='Ref_to_Member'>trig_update_instead_row</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="nodeModifyTable.c.html#LN898"><span class='Ref_to_Parameter'>slot</span></a> <span class='Operator'>= </span><a href="../../include/commands/trigger.h.html#LN177"><span class='Ref_to_Proto'>ExecIRUpdateTriggers</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN901"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN905"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, 
</span>                                    <a href="nodeModifyTable.c.html#LN897"><span class='Ref_to_Parameter'>oldtuple</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN898"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN898"><span class='Ref_to_Parameter'>slot</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span>       <span class='Comment_Single_Line'>/* "do nothing" */ 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* trigger might have changed tuple */ 
</span>        <a href="nodeModifyTable.c.html#LN904"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/executor/tuptable.h.html#LN162"><span class='Ref_to_Proto'>ExecMaterializeSlot</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN898"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN905"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN381"><span class='Ref_to_Member'>ri_FdwRoutine</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * update in foreign table: let the FDW do it 
         */ 
</span>        <a href="nodeModifyTable.c.html#LN898"><span class='Ref_to_Parameter'>slot</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN905"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN381"><span class='Ref_to_Member'>ri_FdwRoutine</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/fdwapi.h.html#LN197"><span class='Ref_to_Member'>ExecForeignUpdate</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN901"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, 
</span>                                                               <a href="nodeModifyTable.c.html#LN905"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, 
</span>                                                               <a href="nodeModifyTable.c.html#LN898"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, 
</span>                                                               <a href="nodeModifyTable.c.html#LN899"><span class='Ref_to_Parameter'>planSlot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN898"><span class='Ref_to_Parameter'>slot</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span>       <span class='Comment_Single_Line'>/* "do nothing" */ 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* FDW might have changed tuple */ 
</span>        <a href="nodeModifyTable.c.html#LN904"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/executor/tuptable.h.html#LN162"><span class='Ref_to_Proto'>ExecMaterializeSlot</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN898"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * AFTER ROW Triggers or RETURNING expressions might reference the 
         * tableoid column, so initialize t_tableOid before evaluating them. 
         */ 
</span>        <a href="nodeModifyTable.c.html#LN904"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN906"><span class='Ref_To_Local'>resultRelationDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if resultRelInfo-&GT;ri_Fdw... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN980"></a>        <a href="../../include/access/heapam.h.html#LN37"><span class='Ref_to_Enum'>LockTupleMode</span></a> <span class='Declare_Local'>lockmode</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Constraints might reference the tableoid column, so initialize 
         * t_tableOid before evaluating them. 
         */ 
</span>        <a href="nodeModifyTable.c.html#LN904"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN906"><span class='Ref_To_Local'>resultRelationDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Check any RLS UPDATE WITH CHECK policies 
         * 
         * If we generate a new candidate tuple after EvalPlanQual testing, we 
         * must loop back here and recheck any RLS policies and constraints. 
         * (We don't need to redo triggers, however.  If there are any BEFORE 
         * triggers then trigger.c will have done heap_lock_tuple to lock the 
         * correct tuple, so there's no need to do them again.) 
         * 
         * ExecWithCheckOptions() will skip any WCOs which are not of the kind 
         * we are looking for at this point. 
         */ 
</span><a name="LN1000"></a><span class='Label'>lreplace</span><span class='Operator'>:</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN905"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN384"><span class='Ref_to_Member'>ri_WithCheckOptions</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/executor/executor.h.html#LN190"><span class='Ref_to_Proto'>ExecWithCheckOptions</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1089"><span class='Ref_to_EnumConst'>WCO_RLS_UPDATE_CHECK</span></a><span class='Delimiter'>, 
</span>                                 <a href="nodeModifyTable.c.html#LN905"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN898"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN901"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Check the constraints of the tuple.  Note that we pass the same 
         * slot for the orig_slot argument, because unlike ExecInsert(), no 
         * tuple-routing is performed here, hence the slot remains unchanged. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN906"><span class='Ref_To_Local'>resultRelationDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN75"><span class='Ref_to_Member'>constr</span></a> <span class='Operator'>|| </span><a href="nodeModifyTable.c.html#LN905"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN391"><span class='Ref_to_Member'>ri_PartitionCheck</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/executor/executor.h.html#LN188"><span class='Ref_to_Proto'>ExecConstraints</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN905"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN898"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN901"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * replace the heap tuple 
         * 
         * Note: if es_crosscheck_snapshot isn't InvalidSnapshot, we check 
         * that the row to be updated is visible to that snapshot, and throw a 
         * can't-serialize error if not. This is a special-case behavior 
         * needed for referential integrity updates in transaction-snapshot 
         * mode transactions. 
         */ 
</span>        <a href="nodeModifyTable.c.html#LN907"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN160"><span class='Ref_to_Proto'>heap_update</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN906"><span class='Ref_To_Local'>resultRelationDesc</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN896"><span class='Ref_to_Parameter'>tupleid</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN904"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, 
</span>                             <a href="nodeModifyTable.c.html#LN901"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN417"><span class='Ref_to_Member'>es_output_cid</span></a><span class='Delimiter'>, 
</span>                             <a href="nodeModifyTable.c.html#LN901"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN409"><span class='Ref_to_Member'>es_crosscheck_snapshot</span></a><span class='Delimiter'>, 
</span>                             <span class='Boolean'>true </span><span class='Comment_Multi_Line'>/* wait for commit */ </span><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN908"><span class='Ref_To_Local'>hufd</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN980"><span class='Ref_To_Local'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN907"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../include/utils/snapshot.h.html#LN122"><span class='Ref_to_EnumConst'>HeapTupleSelfUpdated</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * The target tuple was already updated or deleted by the 
                 * current command, or by a later command in the current 
                 * transaction.  The former case is possible in a join UPDATE 
                 * where multiple tuples join to the same target tuple. This 
                 * is pretty questionable, but Postgres has always allowed it: 
                 * we just execute the first update action and ignore 
                 * additional update attempts. 
                 * 
                 * The latter case arises if the tuple is modified by a 
                 * command in a BEFORE trigger, or perhaps by a command in a 
                 * volatile function used in the query.  In such situations we 
                 * should not ignore the update, but it is equally unsafe to 
                 * proceed.  We don't want to discard the original UPDATE 
                 * while keeping the triggered actions based on it; and we 
                 * have no principled way to merge this update with the 
                 * previous ones.  So throwing an error is the only safe 
                 * course. 
                 * 
                 * If a trigger actually intends this type of interaction, it 
                 * can re-execute the UPDATE (assuming it can figure out how) 
                 * and then return NULL to cancel the outer update. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN908"><span class='Ref_To_Local'>hufd</span></a><span class='Operator'>.</span><a href="../../include/access/heapam.h.html#LN71"><span class='Ref_to_Member'>cmax</span></a> <span class='Operator'>!= </span><a href="nodeModifyTable.c.html#LN901"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN417"><span class='Ref_to_Member'>es_output_cid</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_TRIGGERED_DATA_CHANGE_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"tuple to be updated was already modified by an operation triggered by the current command"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Consider using an AFTER trigger instead of a BEFORE trigger to propagate changes to other rows."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Else, already updated by self; nothing to do */ 
</span>                <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../include/utils/snapshot.h.html#LN120"><span class='Ref_to_EnumConst'>HeapTupleMayBeUpdated</span></a><span class='Operator'>: 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../include/utils/snapshot.h.html#LN123"><span class='Ref_to_EnumConst'>HeapTupleUpdated</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/xact.h.html#LN42"><span class='Ref_to_Macro'>IsolationUsesXactSnapshot</span></a><span class='Parentheses'>())</span> 
                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_T_R_SERIALIZATION_FAILURE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not serialize access due to concurrent update"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../storage/page/itemptr.c.html#LN27"><span class='Ref_to_Func'>ItemPointerEquals</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN896"><span class='Ref_to_Parameter'>tupleid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN908"><span class='Ref_To_Local'>hufd</span></a><span class='Operator'>.</span><a href="../../include/access/heapam.h.html#LN69"><span class='Ref_to_Member'>ctid</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span><a name="LN1073"></a>                    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>epqslot</span><span class='Delimiter'>; 
</span> 
                    <a href="nodeModifyTable.c.html#LN1073"><span class='Ref_To_Local'>epqslot</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN195"><span class='Ref_to_Proto'>EvalPlanQual</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN901"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, 
</span>                                           <a href="nodeModifyTable.c.html#LN900"><span class='Ref_to_Parameter'>epqstate</span></a><span class='Delimiter'>, 
</span>                                           <a href="nodeModifyTable.c.html#LN906"><span class='Ref_To_Local'>resultRelationDesc</span></a><span class='Delimiter'>, 
</span>                                           <a href="nodeModifyTable.c.html#LN905"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN372"><span class='Ref_to_Member'>ri_RangeTableIndex</span></a><span class='Delimiter'>, 
</span>                                           <a href="nodeModifyTable.c.html#LN980"><span class='Ref_To_Local'>lockmode</span></a><span class='Delimiter'>, 
</span>                                           <span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN908"><span class='Ref_To_Local'>hufd</span></a><span class='Operator'>.</span><a href="../../include/access/heapam.h.html#LN69"><span class='Ref_to_Member'>ctid</span></a><span class='Delimiter'>, 
</span>                                           <a href="nodeModifyTable.c.html#LN908"><span class='Ref_To_Local'>hufd</span></a><span class='Operator'>.</span><a href="../../include/access/heapam.h.html#LN70"><span class='Ref_to_Member'>xmax</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/executor/tuptable.h.html#LN137"><span class='Ref_to_Macro'>TupIsNull</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1073"><span class='Ref_To_Local'>epqslot</span></a><span class='Parentheses'>))</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Operator'>*</span><a href="nodeModifyTable.c.html#LN896"><span class='Ref_to_Parameter'>tupleid</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN908"><span class='Ref_To_Local'>hufd</span></a><span class='Operator'>.</span><a href="../../include/access/heapam.h.html#LN69"><span class='Ref_to_Member'>ctid</span></a><span class='Delimiter'>; 
</span>                        <a href="nodeModifyTable.c.html#LN898"><span class='Ref_to_Parameter'>slot</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN160"><span class='Ref_to_Proto'>ExecFilterJunk</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN905"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN387"><span class='Ref_to_Member'>ri_junkFilter</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1073"><span class='Ref_To_Local'>epqslot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="nodeModifyTable.c.html#LN904"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/executor/tuptable.h.html#LN162"><span class='Ref_to_Proto'>ExecMaterializeSlot</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN898"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>goto</span> <span class='Symbol_Characters'>&uarr;</span><a href="nodeModifyTable.c.html#LN1000"><span class='Ref_to_Label'>lreplace</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span>                <span class='Comment_Multi_Line'>/* tuple already deleted; nothing to do */ 
</span>                <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized heap_update status: %u"</span><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN907"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch result &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * Note: instead of having to update the old index tuples associated 
         * with the heap tuple, all we do is form and insert new index tuples. 
         * This is because UPDATEs are actually DELETEs and INSERTs, and index 
         * tuple deletion is done later by VACUUM (see notes in ExecDelete). 
         * All we do here is insert new index tuples.  -cim 9/27/89 
         */ 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * insert index entries for tuple 
         * 
         * Note: heap_update returns the tid (location) of the new tuple in 
         * the t_self field. 
         * 
         * If it's a HOT update, we mustn't insert new index entries. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN905"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN374"><span class='Ref_to_Member'>ri_NumIndices</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& !</span><a href="../../include/access/htup_details.h.html#LN685"><span class='Ref_to_Macro'>HeapTupleIsHeapOnly</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN904"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <a href="nodeModifyTable.c.html#LN909"><span class='Ref_To_Local'>recheckIndexes</span></a> <span class='Operator'>= </span><a href="execIndexing.c.html#LN269"><span class='Ref_to_Func'>ExecInsertIndexTuples</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN898"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN904"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                   <a href="nodeModifyTable.c.html#LN901"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN902"><span class='Ref_to_Parameter'>canSetTag</span></a><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN901"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN453"><span class='Ref_to_Member'>es_processed</span></a><span class='Parentheses'>)</span><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* AFTER ROW UPDATE Triggers */ 
</span>    <a href="../../include/commands/trigger.h.html#LN171"><span class='Ref_to_Proto'>ExecARUpdateTriggers</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN901"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN905"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN896"><span class='Ref_to_Parameter'>tupleid</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN897"><span class='Ref_to_Parameter'>oldtuple</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN904"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, 
</span>                         <a href="nodeModifyTable.c.html#LN909"><span class='Ref_To_Local'>recheckIndexes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN909"><span class='Ref_To_Local'>recheckIndexes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check any WITH CHECK OPTION constraints from parent views.  We are 
     * required to do this after testing all constraints and uniqueness 
     * violations per the SQL spec, so we do it after actually updating the 
     * record in the heap and all indexes. 
     * 
     * ExecWithCheckOptions() will skip any WCOs which are not of the kind we 
     * are looking for at this point. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN905"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN384"><span class='Ref_to_Member'>ri_WithCheckOptions</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/executor/executor.h.html#LN190"><span class='Ref_to_Proto'>ExecWithCheckOptions</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1087"><span class='Ref_to_EnumConst'>WCO_VIEW_CHECK</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN905"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN898"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN901"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Process RETURNING if present */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN905"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN388"><span class='Ref_to_Member'>ri_projectReturning</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="nodeModifyTable.c.html#LN146"><span class='Ref_to_Func'>ExecProcessReturning</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN905"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN898"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN899"><span class='Ref_to_Parameter'>planSlot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecUpdate &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ExecOnConflictUpdate --- execute UPDATE of INSERT ON CONFLICT DO UPDATE 
 * 
 * Try to lock tuple for update as part of speculative insertion.  If 
 * a qual originating from ON CONFLICT DO UPDATE is satisfied, update 
 * (but still lock row, even though it may not satisfy estate's 
 * snapshot). 
 * 
 * Returns true if if we're done (with or without an update), or false if 
 * the caller must retry the INSERT from scratch. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1159"></a><span class='Declare_Function'>ExecOnConflictUpdate</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN916"><span class='Ref_to_Struct'>ModifyTableState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>mtstate</span><span class='Delimiter'>, 
</span><a name="LN1160"></a>                     <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>resultRelInfo</span><span class='Delimiter'>, 
</span><a name="LN1161"></a>                     <a href="../../include/storage/itemptr.h.html#LN47"><span class='Ref_to_Typedef'>ItemPointer</span></a> <span class='Declare_Parameter'>conflictTid</span><span class='Delimiter'>, 
</span><a name="LN1162"></a>                     <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>planSlot</span><span class='Delimiter'>, 
</span><a name="LN1163"></a>                     <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>excludedSlot</span><span class='Delimiter'>, 
</span><a name="LN1164"></a>                     <a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN1165"></a>                     <span class='Keyword'>bool </span><span class='Declare_Parameter'>canSetTag</span><span class='Delimiter'>, 
</span><a name="LN1166"></a>                     <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>returning</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1168"></a>    <a href="../../include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>econtext</span> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1159"><span class='Ref_to_Parameter'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN842"><span class='Ref_to_Member'>ps_ExprContext</span></a><span class='Delimiter'>; 
</span><a name="LN1169"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1160"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>; 
</span><a name="LN1170"></a>    <a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>onConflictSetWhere</span> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1160"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN390"><span class='Ref_to_Member'>ri_onConflictSetWhere</span></a><span class='Delimiter'>; 
</span><a name="LN1171"></a>    <a href="../../include/access/htup.h.html#LN61"><span class='Ref_to_Struct'>HeapTupleData</span></a> <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN1172"></a>    <a href="../../include/access/heapam.h.html#LN67"><span class='Ref_to_Struct'>HeapUpdateFailureData</span></a> <span class='Declare_Local'>hufd</span><span class='Delimiter'>; 
</span><a name="LN1173"></a>    <a href="../../include/access/heapam.h.html#LN37"><span class='Ref_to_Enum'>LockTupleMode</span></a> <span class='Declare_Local'>lockmode</span><span class='Delimiter'>; 
</span><a name="LN1174"></a>    <a href="../../include/utils/snapshot.h.html#LN118"><span class='Ref_to_Typedef'>HTSU_Result</span></a> <span class='Declare_Local'>test</span><span class='Delimiter'>; 
</span><a name="LN1175"></a>    <a href="../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>buffer</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Determine lock mode to use */ 
</span>    <a href="nodeModifyTable.c.html#LN1173"><span class='Ref_To_Local'>lockmode</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN192"><span class='Ref_to_Proto'>ExecUpdateLockMode</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1164"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1160"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Lock tuple for update.  Don't follow updates when tuple cannot be 
     * locked without doing so.  A row locking conflict here means our 
     * previous conclusion that the tuple is conclusively committed is not 
     * true anymore. 
     */ 
</span>    <a href="nodeModifyTable.c.html#LN1171"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a> <span class='Operator'>= *</span><a href="nodeModifyTable.c.html#LN1161"><span class='Ref_to_Parameter'>conflictTid</span></a><span class='Delimiter'>; 
</span>    <a href="nodeModifyTable.c.html#LN1174"><span class='Ref_To_Local'>test</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN164"><span class='Ref_to_Proto'>heap_lock_tuple</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1169"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN1171"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1164"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN417"><span class='Ref_to_Member'>es_output_cid</span></a><span class='Delimiter'>, 
</span>                           <a href="nodeModifyTable.c.html#LN1173"><span class='Ref_To_Local'>lockmode</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/lockoptions.h.html#LN38"><span class='Ref_to_EnumConst'>LockWaitBlock</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN1175"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, 
</span>                           <span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN1172"><span class='Ref_To_Local'>hufd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1174"><span class='Ref_To_Local'>test</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/utils/snapshot.h.html#LN120"><span class='Ref_to_EnumConst'>HeapTupleMayBeUpdated</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* success! */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../include/utils/snapshot.h.html#LN121"><span class='Ref_to_EnumConst'>HeapTupleInvisible</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * This can occur when a just inserted tuple is updated again in 
             * the same command. E.g. because multiple rows with the same 
             * conflicting key values are inserted. 
             * 
             * This is somewhat similar to the ExecUpdate() 
             * HeapTupleSelfUpdated case.  We do not want to proceed because 
             * it would lead to the same row being updated a second time in 
             * some unspecified order, and in contrast to plain UPDATEs 
             * there's no historical behavior to break. 
             * 
             * It is the user's responsibility to prevent this situation from 
             * occurring.  These problems are why SQL-2003 similarly specifies 
             * that for SQL MERGE, an exception must be raised in the event of 
             * an attempt to update the same row twice. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><a href="../../include/access/htup_details.h.html#LN306"><span class='Ref_to_Macro'>HeapTupleHeaderGetXmin</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1171"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Parentheses'>)))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CARDINALITY_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"ON CONFLICT DO UPDATE command cannot affect row a second time"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Ensure that no rows proposed for insertion within the same command have duplicate constrained values."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* This shouldn't happen */ 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"attempted to lock invisible tuple"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../include/utils/snapshot.h.html#LN122"><span class='Ref_to_EnumConst'>HeapTupleSelfUpdated</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * This state should never be reached. As a dirty snapshot is used 
             * to find conflicting tuples, speculative insertion wouldn't have 
             * seen this row to conflict with. 
             */ 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected self-updated tuple"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../include/utils/snapshot.h.html#LN123"><span class='Ref_to_EnumConst'>HeapTupleUpdated</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/xact.h.html#LN42"><span class='Ref_to_Macro'>IsolationUsesXactSnapshot</span></a><span class='Parentheses'>())</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_T_R_SERIALIZATION_FAILURE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not serialize access due to concurrent update"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Tell caller to try again from the very start. 
             * 
             * It does not make sense to use the usual EvalPlanQual() style 
             * loop here, as the new version of the row might not conflict 
             * anymore, or the conflicting tuple has actually been deleted. 
             */ 
</span>            <a href="../../include/storage/bufmgr.h.html#LN174"><span class='Ref_to_Proto'>ReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1175"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized heap_lock_tuple status: %u"</span><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1174"><span class='Ref_To_Local'>test</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch test &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Success, the tuple is locked. 
     * 
     * Reset per-tuple memory context to free any expression evaluation 
     * storage allocated in the previous cycle. 
     */ 
</span>    <a href="../../include/executor/executor.h.html#LN449"><span class='Ref_to_Macro'>ResetExprContext</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1168"><span class='Ref_To_Local'>econtext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Verify that the tuple is visible to our MVCC snapshot if the current 
     * isolation level mandates that. 
     * 
     * It's not sufficient to rely on the check within ExecUpdate() as e.g. 
     * CONFLICT ... WHERE clause may prevent us from reaching that. 
     * 
     * This means we only ever continue when a new command in the current 
     * transaction could see the row, even though in READ COMMITTED mode the 
     * tuple will not be visible according to the current statement's 
     * snapshot.  This is in line with the way UPDATE deals with newer tuple 
     * versions. 
     */ 
</span>    <a href="nodeModifyTable.c.html#LN189"><span class='Ref_to_Func'>ExecCheckHeapTupleVisible</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1164"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN1171"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1175"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Store target's existing tuple in the state's dedicated slot */ 
</span>    <a href="../../include/executor/tuptable.h.html#LN147"><span class='Ref_to_Proto'>ExecStoreTuple</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN1171"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1159"><span class='Ref_to_Parameter'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN934"><span class='Ref_to_Member'>mt_existing</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1175"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make tuple and any needed join variables available to ExecQual and 
     * ExecProject.  The EXCLUDED tuple is installed in ecxt_innertuple, while 
     * the target's existing tuple is installed in the scantuple.  EXCLUDED 
     * has been made to reference INNER_VAR in setrefs.c, but there is no 
     * other redirection. 
     */ 
</span>    <a href="nodeModifyTable.c.html#LN1168"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN196"><span class='Ref_to_Member'>ecxt_scantuple</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1159"><span class='Ref_to_Parameter'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN934"><span class='Ref_to_Member'>mt_existing</span></a><span class='Delimiter'>; 
</span>    <a href="nodeModifyTable.c.html#LN1168"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN197"><span class='Ref_to_Member'>ecxt_innertuple</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1163"><span class='Ref_to_Parameter'>excludedSlot</span></a><span class='Delimiter'>; 
</span>    <a href="nodeModifyTable.c.html#LN1168"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN198"><span class='Ref_to_Member'>ecxt_outertuple</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/executor/executor.h.html#LN344"><span class='Ref_to_Func'>ExecQual</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1170"><span class='Ref_To_Local'>onConflictSetWhere</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1168"><span class='Ref_To_Local'>econtext</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/storage/bufmgr.h.html#LN174"><span class='Ref_to_Proto'>ReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1175"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/nodes/execnodes.h.html#LN857"><span class='Ref_to_Macro'>InstrCountFiltered1</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN1159"><span class='Ref_to_Parameter'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* done with the tuple */ 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1160"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN384"><span class='Ref_to_Member'>ri_WithCheckOptions</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Check target's existing tuple against UPDATE-applicable USING 
         * security barrier quals (if any), enforced here as RLS checks/WCOs. 
         * 
         * The rewriter creates UPDATE RLS checks/WCOs for UPDATE security 
         * quals, and stores them as WCOs of "kind" WCO_RLS_CONFLICT_CHECK, 
         * but that's almost the extent of its special handling for ON 
         * CONFLICT DO UPDATE. 
         * 
         * The rewriter will also have associated UPDATE applicable straight 
         * RLS checks/WCOs for the benefit of the ExecUpdate() call that 
         * follows.  INSERTs and UPDATEs naturally have mutually exclusive WCO 
         * kinds, so there is no danger of spurious over-enforcement in the 
         * INSERT or UPDATE path. 
         */ 
</span>        <a href="../../include/executor/executor.h.html#LN190"><span class='Ref_to_Proto'>ExecWithCheckOptions</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1090"><span class='Ref_to_EnumConst'>WCO_RLS_CONFLICT_CHECK</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1160"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Delimiter'>, 
</span>                             <a href="nodeModifyTable.c.html#LN1159"><span class='Ref_to_Parameter'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN934"><span class='Ref_to_Member'>mt_existing</span></a><span class='Delimiter'>, 
</span>                             <a href="nodeModifyTable.c.html#LN1159"><span class='Ref_to_Parameter'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN814"><span class='Ref_to_Member'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if resultRelInfo-&GT;ri_Wit... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Project the new tuple version */ 
</span>    <a href="../../include/executor/executor.h.html#LN307"><span class='Ref_to_Func'>ExecProject</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1160"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN389"><span class='Ref_to_Member'>ri_onConflictSetProj</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Note that it is possible that the target tuple has been modified in 
     * this session, after the above heap_lock_tuple. We choose to not error 
     * out in that case, in line with ExecUpdate's treatment of similar cases. 
     * This can happen if an UPDATE is triggered from within ExecQual(), 
     * ExecWithCheckOptions() or ExecProject() above, e.g. by selecting from a 
     * wCTE in the ON CONFLICT's SET. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* Execute UPDATE with projection */ 
</span>    <span class='Operator'>*</span><a href="nodeModifyTable.c.html#LN1166"><span class='Ref_to_Parameter'>returning</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN895"><span class='Ref_to_Func'>ExecUpdate</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN1171"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                            <a href="nodeModifyTable.c.html#LN1159"><span class='Ref_to_Parameter'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN937"><span class='Ref_to_Member'>mt_conflproj</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1162"><span class='Ref_to_Parameter'>planSlot</span></a><span class='Delimiter'>, 
</span>                            <span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN1159"><span class='Ref_to_Parameter'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN929"><span class='Ref_to_Member'>mt_epqstate</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1159"><span class='Ref_to_Parameter'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN814"><span class='Ref_to_Member'>state</span></a><span class='Delimiter'>, 
</span>                            <a href="nodeModifyTable.c.html#LN1165"><span class='Ref_to_Parameter'>canSetTag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/storage/bufmgr.h.html#LN174"><span class='Ref_to_Proto'>ReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1175"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecOnConflictUpdate &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Process BEFORE EACH STATEMENT triggers 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1345"></a><span class='Declare_Function'>fireBSTriggers</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN916"><span class='Ref_to_Struct'>ModifyTableState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1347"></a>    <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>resultRelInfo</span> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1345"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN925"><span class='Ref_to_Member'>resultRelInfo</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the node modifies a partitioned table, we must fire its triggers. 
     * Note that in that case, node-&GT;resultRelInfo points to the first leaf 
     * partition, not the root table. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1345"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN926"><span class='Ref_to_Member'>rootResultRelInfo</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="nodeModifyTable.c.html#LN1347"><span class='Ref_To_Local'>resultRelInfo</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1345"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN926"><span class='Ref_to_Member'>rootResultRelInfo</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1345"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN919"><span class='Ref_to_Member'>operation</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN652"><span class='Ref_to_EnumConst'>CMD_INSERT</span></a><span class='Operator'>: 
</span>            <a href="../../include/commands/trigger.h.html#LN131"><span class='Ref_to_Proto'>ExecBSInsertTriggers</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1345"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN814"><span class='Ref_to_Member'>state</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1347"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1345"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN931"><span class='Ref_to_Member'>mt_onconflict</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN801"><span class='Ref_to_EnumConst'>ONCONFLICT_UPDATE</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/commands/trigger.h.html#LN161"><span class='Ref_to_Proto'>ExecBSUpdateTriggers</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1345"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN814"><span class='Ref_to_Member'>state</span></a><span class='Delimiter'>, 
</span>                                     <a href="nodeModifyTable.c.html#LN1347"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN651"><span class='Ref_to_EnumConst'>CMD_UPDATE</span></a><span class='Operator'>: 
</span>            <a href="../../include/commands/trigger.h.html#LN161"><span class='Ref_to_Proto'>ExecBSUpdateTriggers</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1345"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN814"><span class='Ref_to_Member'>state</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1347"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN653"><span class='Ref_to_EnumConst'>CMD_DELETE</span></a><span class='Operator'>: 
</span>            <a href="../../include/commands/trigger.h.html#LN145"><span class='Ref_to_Proto'>ExecBSDeleteTriggers</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1345"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN814"><span class='Ref_to_Member'>state</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1347"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unknown operation"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end fireBSTriggers &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Process AFTER EACH STATEMENT triggers 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1381"></a><span class='Declare_Function'>fireASTriggers</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN916"><span class='Ref_to_Struct'>ModifyTableState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1383"></a>    <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>resultRelInfo</span> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1381"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN925"><span class='Ref_to_Member'>resultRelInfo</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the node modifies a partitioned table, we must fire its triggers. 
     * Note that in that case, node-&GT;resultRelInfo points to the first leaf 
     * partition, not the root table. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1381"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN926"><span class='Ref_to_Member'>rootResultRelInfo</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="nodeModifyTable.c.html#LN1383"><span class='Ref_To_Local'>resultRelInfo</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1381"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN926"><span class='Ref_to_Member'>rootResultRelInfo</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1381"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN919"><span class='Ref_to_Member'>operation</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN652"><span class='Ref_to_EnumConst'>CMD_INSERT</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1381"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN931"><span class='Ref_to_Member'>mt_onconflict</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN801"><span class='Ref_to_EnumConst'>ONCONFLICT_UPDATE</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/commands/trigger.h.html#LN163"><span class='Ref_to_Proto'>ExecASUpdateTriggers</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1381"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN814"><span class='Ref_to_Member'>state</span></a><span class='Delimiter'>, 
</span>                                     <a href="nodeModifyTable.c.html#LN1383"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/commands/trigger.h.html#LN133"><span class='Ref_to_Proto'>ExecASInsertTriggers</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1381"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN814"><span class='Ref_to_Member'>state</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1383"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN651"><span class='Ref_to_EnumConst'>CMD_UPDATE</span></a><span class='Operator'>: 
</span>            <a href="../../include/commands/trigger.h.html#LN163"><span class='Ref_to_Proto'>ExecASUpdateTriggers</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1381"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN814"><span class='Ref_to_Member'>state</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1383"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN653"><span class='Ref_to_EnumConst'>CMD_DELETE</span></a><span class='Operator'>: 
</span>            <a href="../../include/commands/trigger.h.html#LN147"><span class='Ref_to_Proto'>ExecASDeleteTriggers</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1381"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN814"><span class='Ref_to_Member'>state</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1383"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unknown operation"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end fireASTriggers &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *     ExecModifyTable 
 * 
 *      Perform table modifications as required, and return RETURNING results 
 *      if needed. 
 * ---------------------------------------------------------------- 
 */ 
</span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>* 
</span><a name="LN1422"></a><span class='Declare_Function'>ExecModifyTable</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN916"><span class='Ref_to_Struct'>ModifyTableState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1424"></a>    <a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>estate</span> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1422"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN814"><span class='Ref_to_Member'>state</span></a><span class='Delimiter'>; 
</span><a name="LN1425"></a>    <a href="../../include/nodes/nodes.h.html#LN647"><span class='Ref_to_Enum'>CmdType</span></a>     <span class='Declare_Local'>operation</span> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1422"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN919"><span class='Ref_to_Member'>operation</span></a><span class='Delimiter'>; 
</span><a name="LN1426"></a>    <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>saved_resultRelInfo</span><span class='Delimiter'>; 
</span><a name="LN1427"></a>    <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>resultRelInfo</span><span class='Delimiter'>; 
</span><a name="LN1428"></a>    <a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>subplanstate</span><span class='Delimiter'>; 
</span><a name="LN1429"></a>    <a href="../../include/nodes/execnodes.h.html#LN328"><span class='Ref_to_Struct'>JunkFilter</span></a> <span class='Operator'>*</span><span class='Declare_Local'>junkfilter</span><span class='Delimiter'>; 
</span><a name="LN1430"></a>    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>slot</span><span class='Delimiter'>; 
</span><a name="LN1431"></a>    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>planSlot</span><span class='Delimiter'>; 
</span><a name="LN1432"></a>    <a href="../../include/storage/itemptr.h.html#LN47"><span class='Ref_to_Typedef'>ItemPointer</span></a> <span class='Declare_Local'>tupleid</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1433"></a>    <a href="../../include/storage/itemptr.h.html#LN35"><span class='Ref_to_Struct'>ItemPointerData</span></a> <span class='Declare_Local'>tuple_ctid</span><span class='Delimiter'>; 
</span><a name="LN1434"></a>    <a href="../../include/access/htup.h.html#LN61"><span class='Ref_to_Struct'>HeapTupleData</span></a> <span class='Declare_Local'>oldtupdata</span><span class='Delimiter'>; 
</span><a name="LN1435"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>oldtuple</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * This should NOT get called during EvalPlanQual; we should have passed a 
     * subplan tree to EvalPlanQual, instead.  Use a runtime test not just 
     * Assert because this condition is easy to miss in testing.  (Note: 
     * although ModifyTable should not get executed within an EvalPlanQual 
     * operation, we do have to allow it to be initialized and shut down in 
     * case it is within a CTE subplan.  Hence this test must be here, not in 
     * ExecInitModifyTable.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1424"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN482"><span class='Ref_to_Member'>es_epqTuple</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"ModifyTable should not be called during EvalPlanQual"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we've already completed processing, don't try to do more.  We need 
     * this test because ExecPostprocessPlan might call us an extra time, and 
     * our subplan's nodes aren't necessarily robust against being called 
     * extra times. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1422"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN921"><span class='Ref_to_Member'>mt_done</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * On first call, fire BEFORE STATEMENT triggers before proceeding. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1422"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN930"><span class='Ref_to_Member'>fireBSTriggers</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="nodeModifyTable.c.html#LN1344"><span class='Ref_to_Func'>fireBSTriggers</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1422"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeModifyTable.c.html#LN1422"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN930"><span class='Ref_to_Member'>fireBSTriggers</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Preload local variables */ 
</span>    <a href="nodeModifyTable.c.html#LN1427"><span class='Ref_To_Local'>resultRelInfo</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1422"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN925"><span class='Ref_to_Member'>resultRelInfo</span></a> <span class='Operator'>+ </span><a href="nodeModifyTable.c.html#LN1422"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN924"><span class='Ref_to_Member'>mt_whichplan</span></a><span class='Delimiter'>; 
</span>    <a href="nodeModifyTable.c.html#LN1428"><span class='Ref_To_Local'>subplanstate</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1422"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN922"><span class='Ref_to_Member'>mt_plans</span></a><span class='Delimiter'>[</span><a href="nodeModifyTable.c.html#LN1422"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN924"><span class='Ref_to_Member'>mt_whichplan</span></a><span class='Delimiter'>]; 
</span>    <a href="nodeModifyTable.c.html#LN1429"><span class='Ref_To_Local'>junkfilter</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1427"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN387"><span class='Ref_to_Member'>ri_junkFilter</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * es_result_relation_info must point to the currently active result 
     * relation while we are within this ModifyTable node.  Even though 
     * ModifyTable nodes can't be nested statically, they can be nested 
     * dynamically (since our subplan could include a reference to a modifying 
     * CTE).  So we have to save and restore the caller's value. 
     */ 
</span>    <a href="nodeModifyTable.c.html#LN1426"><span class='Ref_To_Local'>saved_resultRelInfo</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1424"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN422"><span class='Ref_to_Member'>es_result_relation_info</span></a><span class='Delimiter'>; 
</span> 
    <a href="nodeModifyTable.c.html#LN1424"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN422"><span class='Ref_to_Member'>es_result_relation_info</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1427"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Fetch rows from subplan(s), and execute the required table modification 
     * for each row. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Reset the per-output-tuple exprcontext.  This is needed because 
         * triggers expect to use that context as workspace.  It's a bit ugly 
         * to do this below the top level of the plan, however.  We might need 
         * to rethink this later. 
         */ 
</span>        <a href="../../include/executor/executor.h.html#LN464"><span class='Ref_to_Macro'>ResetPerTupleExprContext</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1424"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="nodeModifyTable.c.html#LN1431"><span class='Ref_To_Local'>planSlot</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN229"><span class='Ref_to_Proto'>ExecProcNode</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1428"><span class='Ref_To_Local'>subplanstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/executor/tuptable.h.html#LN137"><span class='Ref_to_Macro'>TupIsNull</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1431"><span class='Ref_To_Local'>planSlot</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* advance to next subplan if any */ 
</span>            <a href="nodeModifyTable.c.html#LN1422"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN924"><span class='Ref_to_Member'>mt_whichplan</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1422"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN924"><span class='Ref_to_Member'>mt_whichplan</span></a> <span class='Operator'>&LT; </span><a href="nodeModifyTable.c.html#LN1422"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN923"><span class='Ref_to_Member'>mt_nplans</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="nodeModifyTable.c.html#LN1427"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <a href="nodeModifyTable.c.html#LN1428"><span class='Ref_To_Local'>subplanstate</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1422"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN922"><span class='Ref_to_Member'>mt_plans</span></a><span class='Delimiter'>[</span><a href="nodeModifyTable.c.html#LN1422"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN924"><span class='Ref_to_Member'>mt_whichplan</span></a><span class='Delimiter'>]; 
</span>                <a href="nodeModifyTable.c.html#LN1429"><span class='Ref_To_Local'>junkfilter</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1427"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN387"><span class='Ref_to_Member'>ri_junkFilter</span></a><span class='Delimiter'>; 
</span>                <a href="nodeModifyTable.c.html#LN1424"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN422"><span class='Ref_to_Member'>es_result_relation_info</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1427"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>; 
</span>                <a href="../../include/executor/executor.h.html#LN203"><span class='Ref_to_Proto'>EvalPlanQualSetPlan</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN1422"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN929"><span class='Ref_to_Member'>mt_epqstate</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1428"><span class='Ref_To_Local'>subplanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN812"><span class='Ref_to_Member'>plan</span></a><span class='Delimiter'>, 
</span>                                    <a href="nodeModifyTable.c.html#LN1422"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN928"><span class='Ref_to_Member'>mt_arowmarks</span></a><span class='Delimiter'>[</span><a href="nodeModifyTable.c.html#LN1422"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN924"><span class='Ref_to_Member'>mt_whichplan</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If resultRelInfo-&GT;ri_usesFdwDirectModify is true, all we need to do 
         * here is compute the RETURNING expressions. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1427"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN383"><span class='Ref_to_Member'>ri_usesFdwDirectModify</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1427"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN388"><span class='Ref_to_Member'>ri_projectReturning</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * A scan slot containing the data that was actually inserted, 
             * updated or deleted has already been made available to 
             * ExecProcessReturning by IterateDirectModify, so no need to 
             * provide it here. 
             */ 
</span>            <a href="nodeModifyTable.c.html#LN1430"><span class='Ref_To_Local'>slot</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN146"><span class='Ref_to_Func'>ExecProcessReturning</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1427"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1431"><span class='Ref_To_Local'>planSlot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="nodeModifyTable.c.html#LN1424"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN422"><span class='Ref_to_Member'>es_result_relation_info</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1426"><span class='Ref_To_Local'>saved_resultRelInfo</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="nodeModifyTable.c.html#LN1430"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../include/executor/executor.h.html#LN219"><span class='Ref_to_Macro'>EvalPlanQualSetSlot</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN1422"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN929"><span class='Ref_to_Member'>mt_epqstate</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1431"><span class='Ref_To_Local'>planSlot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeModifyTable.c.html#LN1430"><span class='Ref_To_Local'>slot</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1431"><span class='Ref_To_Local'>planSlot</span></a><span class='Delimiter'>; 
</span> 
        <a href="nodeModifyTable.c.html#LN1435"><span class='Ref_To_Local'>oldtuple</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1429"><span class='Ref_To_Local'>junkfilter</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * extract the 'ctid' or 'wholerow' junk attribute. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1425"><span class='Ref_To_Local'>operation</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN651"><span class='Ref_to_EnumConst'>CMD_UPDATE</span></a> <span class='Operator'>|| </span><a href="nodeModifyTable.c.html#LN1425"><span class='Ref_To_Local'>operation</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN653"><span class='Ref_to_EnumConst'>CMD_DELETE</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1548"></a>                <span class='Keyword'>char</span>        <span class='Declare_Local'>relkind</span><span class='Delimiter'>; 
</span><a name="LN1549"></a>                <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>datum</span><span class='Delimiter'>; 
</span><a name="LN1550"></a>                <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span> 
                <a href="nodeModifyTable.c.html#LN1548"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1427"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind<span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1548"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a> <span class='Operator'>|| </span><a href="nodeModifyTable.c.html#LN1548"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="nodeModifyTable.c.html#LN1549"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN158"><span class='Ref_to_Proto'>ExecGetJunkAttribute</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1430"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>, 
</span>                                                 <a href="nodeModifyTable.c.html#LN1429"><span class='Ref_To_Local'>junkfilter</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN335"><span class='Ref_to_Member'>jf_junkAttNo</span></a><span class='Delimiter'>, 
</span>                                                 <span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN1550"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* shouldn't ever get a null result... */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1550"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>                        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"ctid is NULL"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="nodeModifyTable.c.html#LN1432"><span class='Ref_To_Local'>tupleid</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/storage/itemptr.h.html#LN47"><span class='Ref_to_Typedef'>ItemPointer</span></a><span class='Parentheses'>) </span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1549"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="nodeModifyTable.c.html#LN1433"><span class='Ref_To_Local'>tuple_ctid</span></a> <span class='Operator'>= *</span><a href="nodeModifyTable.c.html#LN1432"><span class='Ref_To_Local'>tupleid</span></a><span class='Delimiter'>;</span>      <span class='Comment_Multi_Line'>/* be sure we don't free 
                                                 * ctid!! */ 
</span>                    <a href="nodeModifyTable.c.html#LN1432"><span class='Ref_To_Local'>tupleid</span></a> <span class='Operator'>= &</span><a href="nodeModifyTable.c.html#LN1433"><span class='Ref_To_Local'>tuple_ctid</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Use the wholerow attribute, when available, to reconstruct 
                 * the old relation tuple. 
                 * 
                 * Foreign table updates have a wholerow attribute when the 
                 * relation has an AFTER ROW trigger.  Note that the wholerow 
                 * attribute does not carry system columns.  Foreign table 
                 * triggers miss seeing those, except that we know enough here 
                 * to set t_tableOid.  Quite separately from this, the FDW may 
                 * fetch its own junk attrs to identify the row. 
                 * 
                 * Other relevant relkinds, currently limited to views, always 
                 * have a wholerow attribute. 
                 */ 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/attnum.h.html#LN33"><span class='Ref_to_Macro'>AttributeNumberIsValid</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1429"><span class='Ref_To_Local'>junkfilter</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN335"><span class='Ref_to_Member'>jf_junkAttNo</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="nodeModifyTable.c.html#LN1549"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN158"><span class='Ref_to_Proto'>ExecGetJunkAttribute</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1430"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>, 
</span>                                                 <a href="nodeModifyTable.c.html#LN1429"><span class='Ref_To_Local'>junkfilter</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN335"><span class='Ref_to_Member'>jf_junkAttNo</span></a><span class='Delimiter'>, 
</span>                                                 <span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN1550"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* shouldn't ever get a null result... */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1550"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>                        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"wholerow is NULL"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="nodeModifyTable.c.html#LN1434"><span class='Ref_To_Local'>oldtupdata</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN258"><span class='Ref_to_Macro'>DatumGetHeapTupleHeader</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1549"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="nodeModifyTable.c.html#LN1434"><span class='Ref_To_Local'>oldtupdata</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a> <span class='Operator'>= 
</span>                        <a href="../../include/access/htup_details.h.html#LN438"><span class='Ref_to_Macro'>HeapTupleHeaderGetDatumLength</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1434"><span class='Ref_To_Local'>oldtupdata</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../include/storage/itemptr.h.html#LN148"><span class='Ref_to_Macro'>ItemPointerSetInvalid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1434"><span class='Ref_To_Local'>oldtupdata</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* Historically, view triggers see invalid t_tableOid. */ 
</span>                    <a href="nodeModifyTable.c.html#LN1434"><span class='Ref_To_Local'>oldtupdata</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>= 
</span>                        <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1548"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN163"><span class='Ref_to_Const'>RELKIND_VIEW</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a> <span class='Operator'>: 
</span>                        <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1427"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="nodeModifyTable.c.html#LN1435"><span class='Ref_To_Local'>oldtuple</span></a> <span class='Operator'>= &</span><a href="nodeModifyTable.c.html#LN1434"><span class='Ref_To_Local'>oldtupdata</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if AttributeNumberIsVali... &raquo; </span> 
                <span class='Control'>else</span> 
                    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1548"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if operation==CMD_UPDATE... &raquo; </span> 
 
            <span class='Comment_Multi_Line'>/* 
             * apply the junkfilter if needed. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1425"><span class='Ref_To_Local'>operation</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/nodes.h.html#LN653"><span class='Ref_to_EnumConst'>CMD_DELETE</span></a><span class='Parentheses'>) 
</span>                <a href="nodeModifyTable.c.html#LN1430"><span class='Ref_To_Local'>slot</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN160"><span class='Ref_to_Proto'>ExecFilterJunk</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1429"><span class='Ref_To_Local'>junkfilter</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1430"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if junkfilter!=NULL &raquo; </span> 
 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1425"><span class='Ref_To_Local'>operation</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN652"><span class='Ref_to_EnumConst'>CMD_INSERT</span></a><span class='Operator'>: 
</span>                <a href="nodeModifyTable.c.html#LN1430"><span class='Ref_To_Local'>slot</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN250"><span class='Ref_to_Func'>ExecInsert</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1422"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1430"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1431"><span class='Ref_To_Local'>planSlot</span></a><span class='Delimiter'>, 
</span>                                <a href="nodeModifyTable.c.html#LN1422"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN932"><span class='Ref_to_Member'>mt_arbiterindexes</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1422"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN931"><span class='Ref_to_Member'>mt_onconflict</span></a><span class='Delimiter'>, 
</span>                                  <a href="nodeModifyTable.c.html#LN1424"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1422"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN920"><span class='Ref_to_Member'>canSetTag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN651"><span class='Ref_to_EnumConst'>CMD_UPDATE</span></a><span class='Operator'>: 
</span>                <a href="nodeModifyTable.c.html#LN1430"><span class='Ref_To_Local'>slot</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN895"><span class='Ref_to_Func'>ExecUpdate</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1432"><span class='Ref_To_Local'>tupleid</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1435"><span class='Ref_To_Local'>oldtuple</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1430"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1431"><span class='Ref_To_Local'>planSlot</span></a><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN1422"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN929"><span class='Ref_to_Member'>mt_epqstate</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1424"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1422"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN920"><span class='Ref_to_Member'>canSetTag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN653"><span class='Ref_to_EnumConst'>CMD_DELETE</span></a><span class='Operator'>: 
</span>                <a href="nodeModifyTable.c.html#LN1430"><span class='Ref_To_Local'>slot</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN637"><span class='Ref_to_Func'>ExecDelete</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1432"><span class='Ref_To_Local'>tupleid</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1435"><span class='Ref_To_Local'>oldtuple</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1431"><span class='Ref_To_Local'>planSlot</span></a><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN1422"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN929"><span class='Ref_to_Member'>mt_epqstate</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1424"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1422"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN920"><span class='Ref_to_Member'>canSetTag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unknown operation"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If we got a RETURNING result, return it to caller.  We'll continue 
         * the work on next call. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1430"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="nodeModifyTable.c.html#LN1424"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN422"><span class='Ref_to_Member'>es_result_relation_info</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1426"><span class='Ref_To_Local'>saved_resultRelInfo</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="nodeModifyTable.c.html#LN1430"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Restore es_result_relation_info before exiting */ 
</span>    <a href="nodeModifyTable.c.html#LN1424"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN422"><span class='Ref_to_Member'>es_result_relation_info</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1426"><span class='Ref_To_Local'>saved_resultRelInfo</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We're done, but fire AFTER STATEMENT triggers before exiting. 
     */ 
</span>    <a href="nodeModifyTable.c.html#LN1380"><span class='Ref_to_Func'>fireASTriggers</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1422"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="nodeModifyTable.c.html#LN1422"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN921"><span class='Ref_to_Member'>mt_done</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecModifyTable &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      ExecInitModifyTable 
 * ---------------------------------------------------------------- 
 */ 
</span><a href="../../include/nodes/execnodes.h.html#LN916"><span class='Ref_to_Struct'>ModifyTableState</span></a> <span class='Operator'>* 
</span><a name="LN1662"></a><span class='Declare_Function'>ExecInitModifyTable</span><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN213"><span class='Ref_to_Struct'>ModifyTable</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>eflags</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1664"></a>    <a href="../../include/nodes/execnodes.h.html#LN916"><span class='Ref_to_Struct'>ModifyTableState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>mtstate</span><span class='Delimiter'>; 
</span><a name="LN1665"></a>    <a href="../../include/nodes/nodes.h.html#LN647"><span class='Ref_to_Enum'>CmdType</span></a>     <span class='Declare_Local'>operation</span> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN216"><span class='Ref_to_Member'>operation</span></a><span class='Delimiter'>; 
</span><a name="LN1666"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nplans</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN224"><span class='Ref_to_Member'>plans</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1667"></a>    <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>saved_resultRelInfo</span><span class='Delimiter'>; 
</span><a name="LN1668"></a>    <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>resultRelInfo</span><span class='Delimiter'>; 
</span><a name="LN1669"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupDesc</span><span class='Delimiter'>; 
</span><a name="LN1670"></a>    <a href="../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>subplan</span><span class='Delimiter'>; 
</span><a name="LN1671"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span><a name="LN1672"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN1673"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* check for unsupported flags */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>eflags</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><a href="../../include/executor/executor.h.html#LN59"><span class='Ref_to_Const'>EXEC_FLAG_BACKWARD</span></a> <span class='Operator'>| </span><a href="../../include/executor/executor.h.html#LN60"><span class='Ref_to_Const'>EXEC_FLAG_MARK</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * create state structure 
     */ 
</span>    <a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN916"><span class='Ref_to_Struct'>ModifyTableState</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN812"><span class='Ref_to_Member'>plan</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span>    <a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN814"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>; 
</span> 
    <a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN919"><span class='Ref_to_Member'>operation</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1665"><span class='Ref_To_Local'>operation</span></a><span class='Delimiter'>; 
</span>    <a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN920"><span class='Ref_to_Member'>canSetTag</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN217"><span class='Ref_to_Member'>canSetTag</span></a><span class='Delimiter'>; 
</span>    <a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN921"><span class='Ref_to_Member'>mt_done</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN922"><span class='Ref_to_Member'>mt_plans</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a> <span class='Operator'>**</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="nodeModifyTable.c.html#LN1666"><span class='Ref_To_Local'>nplans</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN925"><span class='Ref_to_Member'>resultRelInfo</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN420"><span class='Ref_to_Member'>es_result_relations</span></a> <span class='Operator'>+ </span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN222"><span class='Ref_to_Member'>resultRelIndex</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If modifying a partitioned table, initialize the root table info */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN223"><span class='Ref_to_Member'>rootResultRelIndex</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN926"><span class='Ref_to_Member'>rootResultRelInfo</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN431"><span class='Ref_to_Member'>es_root_result_relations</span></a> <span class='Operator'>+ 
</span>            <a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN223"><span class='Ref_to_Member'>rootResultRelIndex</span></a><span class='Delimiter'>; 
</span> 
    <a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN928"><span class='Ref_to_Member'>mt_arowmarks</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="nodeModifyTable.c.html#LN1666"><span class='Ref_To_Local'>nplans</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN923"><span class='Ref_to_Member'>mt_nplans</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1666"><span class='Ref_To_Local'>nplans</span></a><span class='Delimiter'>; 
</span>    <a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN931"><span class='Ref_to_Member'>mt_onconflict</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN231"><span class='Ref_to_Member'>onConflictAction</span></a><span class='Delimiter'>; 
</span>    <a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN932"><span class='Ref_to_Member'>mt_arbiterindexes</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN232"><span class='Ref_to_Member'>arbiterIndexes</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* set up epqstate with dummy subplan data for the moment */ 
</span>    <a href="../../include/executor/executor.h.html#LN201"><span class='Ref_to_Proto'>EvalPlanQualInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN929"><span class='Ref_to_Member'>mt_epqstate</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN230"><span class='Ref_to_Member'>epqParam</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN930"><span class='Ref_to_Member'>fireBSTriggers</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * call ExecInitNode on each of the plans to be executed and save the 
     * results into the array "mt_plans".  This is also a convenient place to 
     * verify that the proposed target relations are valid and open their 
     * indexes for insertion of new index entries.  Note we *must* set 
     * estate-&GT;es_result_relation_info correctly while we initialize each 
     * sub-plan; ExecContextForcesOids depends on that! 
     */ 
</span>    <a href="nodeModifyTable.c.html#LN1667"><span class='Ref_To_Local'>saved_resultRelInfo</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN422"><span class='Ref_to_Member'>es_result_relation_info</span></a><span class='Delimiter'>; 
</span> 
    <a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN925"><span class='Ref_to_Member'>resultRelInfo</span></a><span class='Delimiter'>; 
</span>    <a href="nodeModifyTable.c.html#LN1672"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1671"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN224"><span class='Ref_to_Member'>plans</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="nodeModifyTable.c.html#LN1670"><span class='Ref_To_Local'>subplan</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1671"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Initialize the usesFdwDirectModify flag */ 
</span>        <a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN383"><span class='Ref_to_Member'>ri_usesFdwDirectModify</span></a> <span class='Operator'>= </span><a href="../../include/nodes/bitmapset.h.html#LN75"><span class='Ref_to_Proto'>bms_is_member</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1672"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, 
</span>                                                 <a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN228"><span class='Ref_to_Member'>fdwDirectModifyPlans</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Verify result relation is a valid target for the current operation 
         */ 
</span>        <a href="../../include/executor/executor.h.html#LN179"><span class='Ref_to_Proto'>CheckValidResultRel</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1665"><span class='Ref_To_Local'>operation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If there are indices on the result relation, open them and save 
         * descriptors in the result relation info, so that we can add new 
         * index entries for the tuples we add/update.  We need not do this 
         * for a DELETE, however, since deletion doesn't affect indexes. Also, 
         * inside an EvalPlanQual operation, the indexes might be open 
         * already, since we share the resultrel state with the original 
         * query. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relhasindex <span class='Operator'>&& 
</span>            <a href="nodeModifyTable.c.html#LN1665"><span class='Ref_To_Local'>operation</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/nodes.h.html#LN653"><span class='Ref_to_EnumConst'>CMD_DELETE</span></a> <span class='Operator'>&& 
</span>            <a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN375"><span class='Ref_to_Member'>ri_IndexRelationDescs</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="execIndexing.c.html#LN147"><span class='Ref_to_Func'>ExecOpenIndices</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN931"><span class='Ref_to_Member'>mt_onconflict</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/nodes.h.html#LN799"><span class='Ref_to_EnumConst'>ONCONFLICT_NONE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Now init the plan for this result rel */ 
</span>        <a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN422"><span class='Ref_to_Member'>es_result_relation_info</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>; 
</span>        <a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN922"><span class='Ref_to_Member'>mt_plans</span></a><span class='Delimiter'>[</span><a href="nodeModifyTable.c.html#LN1672"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="execProcnode.c.html#LN138"><span class='Ref_to_Func'>ExecInitNode</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1670"><span class='Ref_To_Local'>subplan</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>eflags</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Also let FDWs init themselves for foreign-table result rels */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN383"><span class='Ref_to_Member'>ri_usesFdwDirectModify</span></a> <span class='Operator'>&& 
</span>            <a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN381"><span class='Ref_to_Member'>ri_FdwRoutine</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>            <a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN381"><span class='Ref_to_Member'>ri_FdwRoutine</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/fdwapi.h.html#LN195"><span class='Ref_to_Member'>BeginForeignModify</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1754"></a>            <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>fdw_private</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN223"><span class='Ref_to_Proto'>list_nth</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN227"><span class='Ref_to_Member'>fdwPrivLists</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1672"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN381"><span class='Ref_to_Member'>ri_FdwRoutine</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/fdwapi.h.html#LN195"><span class='Ref_to_Member'>BeginForeignModify</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Delimiter'>, 
</span>                                                             <a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, 
</span>                                                             <a href="nodeModifyTable.c.html#LN1754"><span class='Ref_To_Local'>fdw_private</span></a><span class='Delimiter'>, 
</span>                                                             <a href="nodeModifyTable.c.html#LN1672"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, 
</span>                                                             <a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>eflags</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="nodeModifyTable.c.html#LN1672"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN422"><span class='Ref_to_Member'>es_result_relation_info</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1667"><span class='Ref_To_Local'>saved_resultRelInfo</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* The root table RT index is at the head of the partitioned_rels list */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN220"><span class='Ref_to_Member'>partitioned_rels</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1772"></a>        <a href="../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a>       <span class='Declare_Local'>root_rti</span><span class='Delimiter'>; 
</span><a name="LN1773"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>root_oid</span><span class='Delimiter'>; 
</span> 
        <a href="nodeModifyTable.c.html#LN1772"><span class='Ref_To_Local'>root_rti</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN111"><span class='Ref_to_Macro'>linitial_int</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN220"><span class='Ref_to_Member'>partitioned_rels</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeModifyTable.c.html#LN1773"><span class='Ref_To_Local'>root_oid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parsetree.h.html#LN40"><span class='Ref_to_Macro'>getrelid</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1772"><span class='Ref_To_Local'>root_rti</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN410"><span class='Ref_to_Member'>es_range_table</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeModifyTable.c.html#LN1673"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1773"><span class='Ref_To_Local'>root_oid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* locked by InitPlan */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="nodeModifyTable.c.html#LN1673"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN925"><span class='Ref_to_Member'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build state for INSERT tuple routing */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1665"><span class='Ref_To_Local'>operation</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN652"><span class='Ref_to_EnumConst'>CMD_INSERT</span></a> <span class='Operator'>&& 
</span>        <a href="nodeModifyTable.c.html#LN1673"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1786"></a>        <a href="../../include/catalog/partition.h.html#LN70"><span class='Ref_to_Typedef'>PartitionDispatch</span></a> <span class='Operator'>*</span><span class='Declare_Local'>partition_dispatch_info</span><span class='Delimiter'>; 
</span><a name="LN1787"></a>        <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>partitions</span><span class='Delimiter'>; 
</span><a name="LN1788"></a>        <a href="../../include/access/tupconvert.h.html#LN20"><span class='Ref_to_Struct'>TupleConversionMap</span></a> <span class='Operator'>**</span><span class='Declare_Local'>partition_tupconv_maps</span><span class='Delimiter'>; 
</span><a name="LN1789"></a>        <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>partition_tuple_slot</span><span class='Delimiter'>; 
</span><a name="LN1790"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>num_parted</span><span class='Delimiter'>, 
</span><a name="LN1791"></a>                    <span class='Declare_Local'>num_partitions</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/executor/executor.h.html#LN208"><span class='Ref_to_Proto'>ExecSetupPartitionTupleRouting</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1673"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, 
</span>                                       <span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN1786"><span class='Ref_To_Local'>partition_dispatch_info</span></a><span class='Delimiter'>, 
</span>                                       <span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN1787"><span class='Ref_To_Local'>partitions</span></a><span class='Delimiter'>, 
</span>                                       <span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN1788"><span class='Ref_To_Local'>partition_tupconv_maps</span></a><span class='Delimiter'>, 
</span>                                       <span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN1789"><span class='Ref_To_Local'>partition_tuple_slot</span></a><span class='Delimiter'>, 
</span>                                       <span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN1790"><span class='Ref_To_Local'>num_parted</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN1791"><span class='Ref_To_Local'>num_partitions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN939"><span class='Ref_to_Member'>mt_partition_dispatch_info</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1786"><span class='Ref_To_Local'>partition_dispatch_info</span></a><span class='Delimiter'>; 
</span>        <a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN941"><span class='Ref_to_Member'>mt_num_dispatch</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1790"><span class='Ref_To_Local'>num_parted</span></a><span class='Delimiter'>; 
</span>        <a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN944"><span class='Ref_to_Member'>mt_partitions</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1787"><span class='Ref_To_Local'>partitions</span></a><span class='Delimiter'>; 
</span>        <a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN942"><span class='Ref_to_Member'>mt_num_partitions</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1791"><span class='Ref_To_Local'>num_partitions</span></a><span class='Delimiter'>; 
</span>        <a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN945"><span class='Ref_to_Member'>mt_partition_tupconv_maps</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1788"><span class='Ref_To_Local'>partition_tupconv_maps</span></a><span class='Delimiter'>; 
</span>        <a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN947"><span class='Ref_to_Member'>mt_partition_tuple_slot</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1789"><span class='Ref_To_Local'>partition_tuple_slot</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if operation==CMD_INSERT... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Initialize any WITH CHECK OPTION constraints if needed. 
     */ 
</span>    <a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN925"><span class='Ref_to_Member'>resultRelInfo</span></a><span class='Delimiter'>; 
</span>    <a href="nodeModifyTable.c.html#LN1672"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1671"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN225"><span class='Ref_to_Member'>withCheckOptionLists</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1814"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>wcoList</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1671"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1815"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>wcoExprs</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1816"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>ll</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1816"><span class='Ref_To_Local'>ll</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1814"><span class='Ref_To_Local'>wcoList</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1820"></a>            <a href="../../include/nodes/parsenodes.h.html#LN1093"><span class='Ref_to_Struct'>WithCheckOption</span></a> <span class='Operator'>*</span><span class='Declare_Local'>wco</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1093"><span class='Ref_to_Struct'>WithCheckOption</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1816"><span class='Ref_To_Local'>ll</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1821"></a>            <a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>wcoExpr</span> <span class='Operator'>= </span><a href="execExpr.c.html#LN158"><span class='Ref_to_Func'>ExecInitQual</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeModifyTable.c.html#LN1820"><span class='Ref_To_Local'>wco</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1099"><span class='Ref_to_Member'>qual</span></a><span class='Delimiter'>, 
</span>                                               <a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN922"><span class='Ref_to_Member'>mt_plans</span></a><span class='Delimiter'>[</span><a href="nodeModifyTable.c.html#LN1672"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="nodeModifyTable.c.html#LN1815"><span class='Ref_To_Local'>wcoExprs</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1815"><span class='Ref_To_Local'>wcoExprs</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1821"><span class='Ref_To_Local'>wcoExpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN384"><span class='Ref_to_Member'>ri_WithCheckOptions</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1814"><span class='Ref_To_Local'>wcoList</span></a><span class='Delimiter'>; 
</span>        <a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN385"><span class='Ref_to_Member'>ri_WithCheckOptionExprs</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1815"><span class='Ref_To_Local'>wcoExprs</span></a><span class='Delimiter'>; 
</span>        <a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="nodeModifyTable.c.html#LN1672"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Build WITH CHECK OPTION constraints for each leaf partition rel. Note 
     * that we didn't build the withCheckOptionList for each partition within 
     * the planner, but simple translation of the varattnos for each partition 
     * will suffice.  This only occurs for the INSERT case; UPDATE/DELETE 
     * cases are handled above. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN225"><span class='Ref_to_Member'>withCheckOptionLists</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>&& </span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN942"><span class='Ref_to_Member'>mt_num_partitions</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1842"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>wcoList</span><span class='Delimiter'>; 
</span><a name="LN1843"></a>        <a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>plan</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * In case of INSERT on partitioned tables, there is only one plan. 
         * Likewise, there is only one WITH CHECK OPTIONS list, not one per 
         * partition.  We make a copy of the WCO qual for each partition; note 
         * that, if there are SubPlans in there, they all end up attached to 
         * the one parent Plan node. 
         */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1665"><span class='Ref_To_Local'>operation</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN652"><span class='Ref_to_EnumConst'>CMD_INSERT</span></a> <span class='Operator'>&& 
</span>               <a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN225"><span class='Ref_to_Member'>withCheckOptionLists</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>1</span> <span class='Operator'>&& 
</span>               <a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN923"><span class='Ref_to_Member'>mt_nplans</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeModifyTable.c.html#LN1842"><span class='Ref_To_Local'>wcoList</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN225"><span class='Ref_to_Member'>withCheckOptionLists</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeModifyTable.c.html#LN1843"><span class='Ref_To_Local'>plan</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN922"><span class='Ref_to_Member'>mt_plans</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>        <a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN944"><span class='Ref_to_Member'>mt_partitions</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1672"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="nodeModifyTable.c.html#LN1672"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN942"><span class='Ref_to_Member'>mt_num_partitions</span></a><span class='Delimiter'>; </span><a href="nodeModifyTable.c.html#LN1672"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1860"></a>            <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>partrel</span> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>; 
</span><a name="LN1861"></a>            <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>mapped_wcoList</span><span class='Delimiter'>; 
</span><a name="LN1862"></a>            <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>wcoExprs</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1863"></a>            <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>ll</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* varno = node-&GT;nominalRelation */ 
</span>            <a href="nodeModifyTable.c.html#LN1861"><span class='Ref_To_Local'>mapped_wcoList</span></a> <span class='Operator'>= </span><a href="../../include/catalog/partition.h.html#LN81"><span class='Ref_to_Proto'>map_partition_varattnos</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1842"><span class='Ref_To_Local'>wcoList</span></a><span class='Delimiter'>, 
</span>                                                     <a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN218"><span class='Ref_to_Member'>nominalRelation</span></a><span class='Delimiter'>, 
</span>                                                     <a href="nodeModifyTable.c.html#LN1860"><span class='Ref_To_Local'>partrel</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1673"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1863"><span class='Ref_To_Local'>ll</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1861"><span class='Ref_To_Local'>mapped_wcoList</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1871"></a>                <a href="../../include/nodes/parsenodes.h.html#LN1093"><span class='Ref_to_Struct'>WithCheckOption</span></a> <span class='Operator'>*</span><span class='Declare_Local'>wco</span> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1093"><span class='Ref_to_Struct'>WithCheckOption</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1863"><span class='Ref_To_Local'>ll</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN1872"></a>                <a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>wcoExpr</span> <span class='Operator'>= </span><a href="execExpr.c.html#LN158"><span class='Ref_to_Func'>ExecInitQual</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1871"><span class='Ref_To_Local'>wco</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1099"><span class='Ref_to_Member'>qual</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                   <a href="nodeModifyTable.c.html#LN1843"><span class='Ref_To_Local'>plan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="nodeModifyTable.c.html#LN1862"><span class='Ref_To_Local'>wcoExprs</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1862"><span class='Ref_To_Local'>wcoExprs</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1872"><span class='Ref_To_Local'>wcoExpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN384"><span class='Ref_to_Member'>ri_WithCheckOptions</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1861"><span class='Ref_To_Local'>mapped_wcoList</span></a><span class='Delimiter'>; 
</span>            <a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN385"><span class='Ref_to_Member'>ri_WithCheckOptionExprs</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1862"><span class='Ref_To_Local'>wcoExprs</span></a><span class='Delimiter'>; 
</span>            <a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;mtstate-&GT;mt_num... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if node-&GT;withCheckOption... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Initialize RETURNING projections if needed. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN226"><span class='Ref_to_Member'>returningLists</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1889"></a>        <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>slot</span><span class='Delimiter'>; 
</span><a name="LN1890"></a>        <a href="../../include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>econtext</span><span class='Delimiter'>; 
</span><a name="LN1891"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>returningList</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Initialize result tuple slot and assign its rowtype using the first 
         * RETURNING list.  We assume the rest will look the same. 
         */ 
</span>        <a href="nodeModifyTable.c.html#LN1669"><span class='Ref_To_Local'>tupDesc</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN405"><span class='Ref_to_Proto'>ExecTypeFromTL</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN226"><span class='Ref_to_Member'>returningLists</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Set up a slot for the output of the RETURNING projection(s) */ 
</span>        <a href="../../include/executor/executor.h.html#LN400"><span class='Ref_to_Proto'>ExecInitResultTupleSlot</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="execUtils.c.html#LN426"><span class='Ref_to_Func'>ExecAssignResultType</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1669"><span class='Ref_To_Local'>tupDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeModifyTable.c.html#LN1889"><span class='Ref_To_Local'>slot</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN841"><span class='Ref_to_Member'>ps_ResultTupleSlot</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Need an econtext too */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN842"><span class='Ref_to_Member'>ps_ExprContext</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="execUtils.c.html#LN416"><span class='Ref_to_Func'>ExecAssignExprContext</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeModifyTable.c.html#LN1890"><span class='Ref_To_Local'>econtext</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN842"><span class='Ref_to_Member'>ps_ExprContext</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Build a projection for each result rel. 
         */ 
</span>        <a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN925"><span class='Ref_to_Member'>resultRelInfo</span></a><span class='Delimiter'>; 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1671"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN226"><span class='Ref_to_Member'>returningLists</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1916"></a>            <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>rlist</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1671"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN388"><span class='Ref_to_Member'>ri_projectReturning</span></a> <span class='Operator'>= 
</span>                <a href="../../include/executor/executor.h.html#LN241"><span class='Ref_to_Proto'>ExecBuildProjectionInfo</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1916"><span class='Ref_To_Local'>rlist</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1890"><span class='Ref_To_Local'>econtext</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1889"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Delimiter'>, 
</span>                                     <a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Build a projection for each leaf partition rel.  Note that we 
         * didn't build the returningList for each partition within the 
         * planner, but simple translation of the varattnos for each partition 
         * will suffice.  This only occurs for the INSERT case; UPDATE/DELETE 
         * are handled above. 
         */ 
</span>        <a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN944"><span class='Ref_to_Member'>mt_partitions</span></a><span class='Delimiter'>; 
</span>        <a href="nodeModifyTable.c.html#LN1891"><span class='Ref_To_Local'>returningList</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN226"><span class='Ref_to_Member'>returningLists</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1672"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="nodeModifyTable.c.html#LN1672"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN942"><span class='Ref_to_Member'>mt_num_partitions</span></a><span class='Delimiter'>; </span><a href="nodeModifyTable.c.html#LN1672"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1935"></a>            <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>partrel</span> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>; 
</span><a name="LN1936"></a>            <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>rlist</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* varno = node-&GT;nominalRelation */ 
</span>            <a href="nodeModifyTable.c.html#LN1936"><span class='Ref_To_Local'>rlist</span></a> <span class='Operator'>= </span><a href="../../include/catalog/partition.h.html#LN81"><span class='Ref_to_Proto'>map_partition_varattnos</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1891"><span class='Ref_To_Local'>returningList</span></a><span class='Delimiter'>, 
</span>                                            <a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN218"><span class='Ref_to_Member'>nominalRelation</span></a><span class='Delimiter'>, 
</span>                                            <a href="nodeModifyTable.c.html#LN1935"><span class='Ref_To_Local'>partrel</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1673"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN388"><span class='Ref_to_Member'>ri_projectReturning</span></a> <span class='Operator'>= 
</span>                <a href="../../include/executor/executor.h.html#LN241"><span class='Ref_to_Proto'>ExecBuildProjectionInfo</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1936"><span class='Ref_To_Local'>rlist</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1890"><span class='Ref_To_Local'>econtext</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1889"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Delimiter'>, 
</span>                                     <a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if node-&GT;returningLists &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * We still must construct a dummy result tuple type, because InitPlan 
         * expects one (maybe should change that?). 
         */ 
</span>        <a href="nodeModifyTable.c.html#LN1669"><span class='Ref_To_Local'>tupDesc</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN405"><span class='Ref_to_Proto'>ExecTypeFromTL</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/executor/executor.h.html#LN400"><span class='Ref_to_Proto'>ExecInitResultTupleSlot</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="execUtils.c.html#LN426"><span class='Ref_to_Func'>ExecAssignResultType</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1669"><span class='Ref_To_Local'>tupDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN842"><span class='Ref_to_Member'>ps_ExprContext</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Close the root partitioned rel if we opened it above. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1673"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>!= </span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN925"><span class='Ref_to_Member'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1673"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If needed, Initialize target list, projection and qual for ON CONFLICT 
     * DO UPDATE. 
     */ 
</span>    <a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN925"><span class='Ref_to_Member'>resultRelInfo</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN231"><span class='Ref_to_Member'>onConflictAction</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN801"><span class='Ref_to_EnumConst'>ONCONFLICT_UPDATE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1972"></a>        <a href="../../include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>econtext</span><span class='Delimiter'>; 
</span><a name="LN1973"></a>        <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupDesc</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* insert may only have one plan, inheritance is not expanded */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1666"><span class='Ref_To_Local'>nplans</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* already exists if created by RETURNING processing above */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN842"><span class='Ref_to_Member'>ps_ExprContext</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="execUtils.c.html#LN416"><span class='Ref_to_Func'>ExecAssignExprContext</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="nodeModifyTable.c.html#LN1972"><span class='Ref_To_Local'>econtext</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN842"><span class='Ref_to_Member'>ps_ExprContext</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* initialize slot for the existing tuple */ 
</span>        <a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN934"><span class='Ref_to_Member'>mt_existing</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN402"><span class='Ref_to_Proto'>ExecInitExtraTupleSlot</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN814"><span class='Ref_to_Member'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/executor/tuptable.h.html#LN146"><span class='Ref_to_Proto'>ExecSetSlotDescriptor</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN934"><span class='Ref_to_Member'>mt_existing</span></a><span class='Delimiter'>, 
</span>                              <a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* carried forward solely for the benefit of explain */ 
</span>        <a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN935"><span class='Ref_to_Member'>mt_excludedtlist</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN236"><span class='Ref_to_Member'>exclRelTlist</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* create target slot for UPDATE SET projection */ 
</span>        <a href="nodeModifyTable.c.html#LN1973"><span class='Ref_To_Local'>tupDesc</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN405"><span class='Ref_to_Proto'>ExecTypeFromTL</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN233"><span class='Ref_to_Member'>onConflictSet</span></a><span class='Delimiter'>, 
</span>                         <a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relhasoids<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN937"><span class='Ref_to_Member'>mt_conflproj</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN402"><span class='Ref_to_Proto'>ExecInitExtraTupleSlot</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN814"><span class='Ref_to_Member'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/executor/tuptable.h.html#LN146"><span class='Ref_to_Proto'>ExecSetSlotDescriptor</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN937"><span class='Ref_to_Member'>mt_conflproj</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1973"><span class='Ref_To_Local'>tupDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* build UPDATE SET projection state */ 
</span>        <a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN389"><span class='Ref_to_Member'>ri_onConflictSetProj</span></a> <span class='Operator'>= 
</span>            <a href="../../include/executor/executor.h.html#LN241"><span class='Ref_to_Proto'>ExecBuildProjectionInfo</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN233"><span class='Ref_to_Member'>onConflictSet</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1972"><span class='Ref_To_Local'>econtext</span></a><span class='Delimiter'>, 
</span>                                    <a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN937"><span class='Ref_to_Member'>mt_conflproj</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Delimiter'>, 
</span>                                    <a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* build DO UPDATE WHERE clause expression */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN234"><span class='Ref_to_Member'>onConflictWhere</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2007"></a>            <a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>qualexpr</span><span class='Delimiter'>; 
</span> 
            <a href="nodeModifyTable.c.html#LN2007"><span class='Ref_To_Local'>qualexpr</span></a> <span class='Operator'>= </span><a href="execExpr.c.html#LN158"><span class='Ref_to_Func'>ExecInitQual</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN234"><span class='Ref_to_Member'>onConflictWhere</span></a><span class='Delimiter'>, 
</span>                                    <span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN390"><span class='Ref_to_Member'>ri_onConflictSetWhere</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN2007"><span class='Ref_To_Local'>qualexpr</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if node-&GT;onConflictActio... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If we have any secondary relations in an UPDATE or DELETE, they need to 
     * be treated like non-locked relations in SELECT FOR UPDATE, ie, the 
     * EvalPlanQual mechanism needs to be told about them.  Locate the 
     * relevant ExecRowMarks. 
     */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1671"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN229"><span class='Ref_to_Member'>rowMarks</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2024"></a>        <a href="../../include/nodes/plannodes.h.html#LN1002"><span class='Ref_to_Struct'>PlanRowMark</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rc</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN1002"><span class='Ref_to_Struct'>PlanRowMark</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1671"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2025"></a>        <a href="../../include/nodes/execnodes.h.html#LN508"><span class='Ref_to_Struct'>ExecRowMark</span></a> <span class='Operator'>*</span><span class='Declare_Local'>erm</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* ignore "parent" rowmarks; they are irrelevant at runtime */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN2024"><span class='Ref_To_Local'>rc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN1012"><span class='Ref_to_Member'>isParent</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* find ExecRowMark (same for all subplans) */ 
</span>        <a href="nodeModifyTable.c.html#LN2025"><span class='Ref_To_Local'>erm</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN193"><span class='Ref_to_Proto'>ExecFindRowMark</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN2024"><span class='Ref_To_Local'>rc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN1005"><span class='Ref_to_Member'>rti</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* build ExecAuxRowMark for each subplan */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1672"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="nodeModifyTable.c.html#LN1672"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="nodeModifyTable.c.html#LN1666"><span class='Ref_To_Local'>nplans</span></a><span class='Delimiter'>; </span><a href="nodeModifyTable.c.html#LN1672"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2037"></a>            <a href="../../include/nodes/execnodes.h.html#LN535"><span class='Ref_to_Struct'>ExecAuxRowMark</span></a> <span class='Operator'>*</span><span class='Declare_Local'>aerm</span><span class='Delimiter'>; 
</span> 
            <a href="nodeModifyTable.c.html#LN1670"><span class='Ref_To_Local'>subplan</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN922"><span class='Ref_to_Member'>mt_plans</span></a><span class='Delimiter'>[</span><a href="nodeModifyTable.c.html#LN1672"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN812"><span class='Ref_to_Member'>plan</span></a><span class='Delimiter'>; 
</span>            <a href="nodeModifyTable.c.html#LN2037"><span class='Ref_To_Local'>aerm</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN194"><span class='Ref_to_Proto'>ExecBuildAuxRowMark</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN2025"><span class='Ref_To_Local'>erm</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1670"><span class='Ref_To_Local'>subplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN928"><span class='Ref_to_Member'>mt_arowmarks</span></a><span class='Delimiter'>[</span><a href="nodeModifyTable.c.html#LN1672"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN928"><span class='Ref_to_Member'>mt_arowmarks</span></a><span class='Delimiter'>[</span><a href="nodeModifyTable.c.html#LN1672"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="nodeModifyTable.c.html#LN2037"><span class='Ref_To_Local'>aerm</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* select first subplan */ 
</span>    <a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN924"><span class='Ref_to_Member'>mt_whichplan</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="nodeModifyTable.c.html#LN1670"><span class='Ref_To_Local'>subplan</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN224"><span class='Ref_to_Member'>plans</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/executor/executor.h.html#LN203"><span class='Ref_to_Proto'>EvalPlanQualSetPlan</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN929"><span class='Ref_to_Member'>mt_epqstate</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1670"><span class='Ref_To_Local'>subplan</span></a><span class='Delimiter'>, 
</span>                        <a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN928"><span class='Ref_to_Member'>mt_arowmarks</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Initialize the junk filter(s) if needed.  INSERT queries need a filter 
     * if there are any junk attrs in the tlist.  UPDATE and DELETE always 
     * need a filter, since there's always a junk 'ctid' or 'wholerow' 
     * attribute present --- no need to look first. 
     * 
     * If there are multiple result relations, each one needs its own junk 
     * filter.  Note multiple rels are only possible for UPDATE/DELETE, so we 
     * can't be fooled by some needing a filter and some not. 
     * 
     * This section of code is also a convenient place to verify that the 
     * output of an INSERT or UPDATE matches the target table(s). 
     */ 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2065"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>junk_filter_needed</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1665"><span class='Ref_To_Local'>operation</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN652"><span class='Ref_to_EnumConst'>CMD_INSERT</span></a><span class='Operator'>: 
</span>                <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1671"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="nodeModifyTable.c.html#LN1670"><span class='Ref_To_Local'>subplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN2072"></a>                    <a href="../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tle</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1671"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN2072"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1373"><span class='Ref_to_Member'>resjunk</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="nodeModifyTable.c.html#LN2065"><span class='Ref_To_Local'>junk_filter_needed</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN651"><span class='Ref_to_EnumConst'>CMD_UPDATE</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN653"><span class='Ref_to_EnumConst'>CMD_DELETE</span></a><span class='Operator'>: 
</span>                <a href="nodeModifyTable.c.html#LN2065"><span class='Ref_To_Local'>junk_filter_needed</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unknown operation"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch operation &raquo; </span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN2065"><span class='Ref_To_Local'>junk_filter_needed</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN925"><span class='Ref_to_Member'>resultRelInfo</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1672"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="nodeModifyTable.c.html#LN1672"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="nodeModifyTable.c.html#LN1666"><span class='Ref_To_Local'>nplans</span></a><span class='Delimiter'>; </span><a href="nodeModifyTable.c.html#LN1672"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2095"></a>                <a href="../../include/nodes/execnodes.h.html#LN328"><span class='Ref_to_Struct'>JunkFilter</span></a> <span class='Operator'>*</span><span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span> 
                <a href="nodeModifyTable.c.html#LN1670"><span class='Ref_To_Local'>subplan</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN922"><span class='Ref_to_Member'>mt_plans</span></a><span class='Delimiter'>[</span><a href="nodeModifyTable.c.html#LN1672"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN812"><span class='Ref_to_Member'>plan</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1665"><span class='Ref_To_Local'>operation</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN652"><span class='Ref_to_EnumConst'>CMD_INSERT</span></a> <span class='Operator'>|| </span><a href="nodeModifyTable.c.html#LN1665"><span class='Ref_To_Local'>operation</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN651"><span class='Ref_to_EnumConst'>CMD_UPDATE</span></a><span class='Parentheses'>) 
</span>                    <a href="nodeModifyTable.c.html#LN77"><span class='Ref_to_Func'>ExecCheckPlanOutput</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>, 
</span>                                        <a href="nodeModifyTable.c.html#LN1670"><span class='Ref_To_Local'>subplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="nodeModifyTable.c.html#LN2095"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><a href="execJunk.c.html#LN59"><span class='Ref_to_Func'>ExecInitJunkFilter</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1670"><span class='Ref_To_Local'>subplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Delimiter'>, 
</span>                            <a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN78"><span class='Ref_to_Member'>tdhasoid</span></a><span class='Delimiter'>, 
</span>                                       <a href="../../include/executor/executor.h.html#LN402"><span class='Ref_to_Proto'>ExecInitExtraTupleSlot</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1665"><span class='Ref_To_Local'>operation</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN651"><span class='Ref_to_EnumConst'>CMD_UPDATE</span></a> <span class='Operator'>|| </span><a href="nodeModifyTable.c.html#LN1665"><span class='Ref_To_Local'>operation</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN653"><span class='Ref_to_EnumConst'>CMD_DELETE</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* For UPDATE/DELETE, find the appropriate junk attr now */ 
</span><a name="LN2109"></a>                    <span class='Keyword'>char</span>        <span class='Declare_Local'>relkind</span><span class='Delimiter'>; 
</span> 
                    <a href="nodeModifyTable.c.html#LN2109"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind<span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN2109"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a> <span class='Operator'>|| 
</span>                        <a href="nodeModifyTable.c.html#LN2109"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a> <span class='Operator'>|| 
</span>                        <a href="nodeModifyTable.c.html#LN2109"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="nodeModifyTable.c.html#LN2095"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN335"><span class='Ref_to_Member'>jf_junkAttNo</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN154"><span class='Ref_to_Proto'>ExecFindJunkAttribute</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN2095"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>, </span><span class='String'>"ctid"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/attnum.h.html#LN33"><span class='Ref_to_Macro'>AttributeNumberIsValid</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN2095"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN335"><span class='Ref_to_Member'>jf_junkAttNo</span></a><span class='Parentheses'>))</span> 
                            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not find junk ctid column"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN2109"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * When there is an AFTER trigger, there should be a 
                         * wholerow attribute. 
                         */ 
</span>                        <a href="nodeModifyTable.c.html#LN2095"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN335"><span class='Ref_to_Member'>jf_junkAttNo</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN154"><span class='Ref_to_Proto'>ExecFindJunkAttribute</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN2095"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>, </span><span class='String'>"wholerow"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="nodeModifyTable.c.html#LN2095"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN335"><span class='Ref_to_Member'>jf_junkAttNo</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN154"><span class='Ref_to_Proto'>ExecFindJunkAttribute</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN2095"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>, </span><span class='String'>"wholerow"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/attnum.h.html#LN33"><span class='Ref_to_Macro'>AttributeNumberIsValid</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN2095"><span class='Ref_To_Local'>j</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN335"><span class='Ref_to_Member'>jf_junkAttNo</span></a><span class='Parentheses'>))</span> 
                            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not find junk wholerow column"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if operation==CMD_UPDATE... &raquo; </span> 
 
                <a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN387"><span class='Ref_to_Member'>ri_junkFilter</span></a> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN2095"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>; 
</span>                <a href="nodeModifyTable.c.html#LN1668"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nplans;i++ &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if junk_filter_needed &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1665"><span class='Ref_To_Local'>operation</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN652"><span class='Ref_to_EnumConst'>CMD_INSERT</span></a><span class='Parentheses'>) 
</span>                <a href="nodeModifyTable.c.html#LN77"><span class='Ref_to_Func'>ExecCheckPlanOutput</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN925"><span class='Ref_to_Member'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>, 
</span>                                    <a href="nodeModifyTable.c.html#LN1670"><span class='Ref_To_Local'>subplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set up a tuple table slot for use for trigger output tuples. In a plan 
     * containing multiple ModifyTable nodes, all can share one such slot, so 
     * we keep it in the estate. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN436"><span class='Ref_to_Member'>es_trig_tuple_slot</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN436"><span class='Ref_to_Member'>es_trig_tuple_slot</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN402"><span class='Ref_to_Proto'>ExecInitExtraTupleSlot</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Lastly, if this is not the primary (canSetTag) ModifyTable node, add it 
     * to estate-&GT;es_auxmodifytables so that it will be run to completion by 
     * ExecPostprocessPlan.  (It'd actually work fine to add the primary 
     * ModifyTable node too, but there's no need.)  Note the use of lcons not 
     * lappend: we need later-initialized ModifyTable nodes to be shut down 
     * before earlier ones.  This ensures that we don't throw away RETURNING 
     * rows that need to be seen by a later CTE subplan. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN920"><span class='Ref_to_Member'>canSetTag</span></a><span class='Parentheses'>) 
</span>        <a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN464"><span class='Ref_to_Member'>es_auxmodifytables</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN215"><span class='Ref_to_Proto'>lcons</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Delimiter'>, 
</span>                                           <a href="nodeModifyTable.c.html#LN1662"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN464"><span class='Ref_to_Member'>es_auxmodifytables</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="nodeModifyTable.c.html#LN1664"><span class='Ref_To_Local'>mtstate</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecInitModifyTable &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      ExecEndModifyTable 
 * 
 *      Shuts down the plan. 
 * 
 *      Returns nothing of interest. 
 * ---------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2181"></a><span class='Declare_Function'>ExecEndModifyTable</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN916"><span class='Ref_to_Struct'>ModifyTableState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2183"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Allow any FDWs to shut down 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN2183"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="nodeModifyTable.c.html#LN2183"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="nodeModifyTable.c.html#LN2181"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN923"><span class='Ref_to_Member'>mt_nplans</span></a><span class='Delimiter'>; </span><a href="nodeModifyTable.c.html#LN2183"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2190"></a>        <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>resultRelInfo</span> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN2181"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN925"><span class='Ref_to_Member'>resultRelInfo</span></a> <span class='Operator'>+ </span><a href="nodeModifyTable.c.html#LN2183"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeModifyTable.c.html#LN2190"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN383"><span class='Ref_to_Member'>ri_usesFdwDirectModify</span></a> <span class='Operator'>&& 
</span>            <a href="nodeModifyTable.c.html#LN2190"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN381"><span class='Ref_to_Member'>ri_FdwRoutine</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>            <a href="nodeModifyTable.c.html#LN2190"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN381"><span class='Ref_to_Member'>ri_FdwRoutine</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/fdwapi.h.html#LN199"><span class='Ref_to_Member'>EndForeignModify</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="nodeModifyTable.c.html#LN2190"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN381"><span class='Ref_to_Member'>ri_FdwRoutine</span></a><span class='Operator'>-&GT;</span><a href="../../include/foreign/fdwapi.h.html#LN199"><span class='Ref_to_Member'>EndForeignModify</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN2181"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN814"><span class='Ref_to_Member'>state</span></a><span class='Delimiter'>, 
</span>                                                           <a href="nodeModifyTable.c.html#LN2190"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Close all the partitioned tables, leaf partitions, and their indices 
     * 
     * Remember node-&GT;mt_partition_dispatch_info[0] corresponds to the root 
     * partitioned table, which we must not try to close, because it is the 
     * main target table of the query that will be closed by ExecEndPlan(). 
     * Also, tupslot is NULL for the root partitioned table. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN2183"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="nodeModifyTable.c.html#LN2183"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="nodeModifyTable.c.html#LN2181"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN941"><span class='Ref_to_Member'>mt_num_dispatch</span></a><span class='Delimiter'>; </span><a href="nodeModifyTable.c.html#LN2183"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2209"></a>        <a href="../../include/catalog/partition.h.html#LN70"><span class='Ref_to_Typedef'>PartitionDispatch</span></a> <span class='Declare_Local'>pd</span> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN2181"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN939"><span class='Ref_to_Member'>mt_partition_dispatch_info</span></a><span class='Delimiter'>[</span><a href="nodeModifyTable.c.html#LN2183"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN2209"><span class='Ref_To_Local'>pd</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN61"><span class='Ref_to_Member'>reldesc</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/executor/tuptable.h.html#LN145"><span class='Ref_to_Proto'>ExecDropSingleTupleTableSlot</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN2209"><span class='Ref_To_Local'>pd</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN65"><span class='Ref_to_Member'>tupslot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN2183"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="nodeModifyTable.c.html#LN2183"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="nodeModifyTable.c.html#LN2181"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN942"><span class='Ref_to_Member'>mt_num_partitions</span></a><span class='Delimiter'>; </span><a href="nodeModifyTable.c.html#LN2183"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2216"></a>        <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>resultRelInfo</span> <span class='Operator'>= </span><a href="nodeModifyTable.c.html#LN2181"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN944"><span class='Ref_to_Member'>mt_partitions</span></a> <span class='Operator'>+ </span><a href="nodeModifyTable.c.html#LN2183"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span> 
        <a href="execIndexing.c.html#LN222"><span class='Ref_to_Func'>ExecCloseIndices</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN2216"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN2216"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Release the standalone partition tuple descriptor, if any */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN2181"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN947"><span class='Ref_to_Member'>mt_partition_tuple_slot</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/executor/tuptable.h.html#LN145"><span class='Ref_to_Proto'>ExecDropSingleTupleTableSlot</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN2181"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN947"><span class='Ref_to_Member'>mt_partition_tuple_slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Free the exprcontext 
     */ 
</span>    <a href="../../include/executor/executor.h.html#LN476"><span class='Ref_to_Proto'>ExecFreeExprContext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN2181"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * clean out the tuple table 
     */ 
</span>    <a href="../../include/executor/tuptable.h.html#LN154"><span class='Ref_to_Proto'>ExecClearTuple</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN2181"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN841"><span class='Ref_to_Member'>ps_ResultTupleSlot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Terminate EPQ execution if active 
     */ 
</span>    <a href="../../include/executor/executor.h.html#LN223"><span class='Ref_to_Proto'>EvalPlanQualEnd</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeModifyTable.c.html#LN2181"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN929"><span class='Ref_to_Member'>mt_epqstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * shut down subplans 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN2183"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="nodeModifyTable.c.html#LN2183"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="nodeModifyTable.c.html#LN2181"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN923"><span class='Ref_to_Member'>mt_nplans</span></a><span class='Delimiter'>; </span><a href="nodeModifyTable.c.html#LN2183"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="../../include/executor/executor.h.html#LN231"><span class='Ref_to_Proto'>ExecEndNode</span></a><span class='Parentheses'>(</span><a href="nodeModifyTable.c.html#LN2181"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN922"><span class='Ref_to_Member'>mt_plans</span></a><span class='Delimiter'>[</span><a href="nodeModifyTable.c.html#LN2183"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecEndModifyTable &raquo; </span> 
 
<span class='Keyword'>void 
</span><a name="LN2249"></a><span class='Declare_Function'>ExecReScanModifyTable</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN916"><span class='Ref_to_Struct'>ModifyTableState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * Currently, we don't need to support rescan on ModifyTable nodes. The 
     * semantics of that would be a bit debatable anyway. 
     */ 
</span>    <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"ExecReScanModifyTable is not implemented"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>