<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\executor\nodeSamplescan.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\executor\nodeSamplescan.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:40 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * nodeSamplescan.c 
 *    Support routines for sample scans of relations (table sampling). 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/executor/nodeSamplescan.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/hash.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/relscan.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/tsmapi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"executor/executor.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"executor/nodeSamplescan.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"pgstat.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/predicate.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/tqual.h"</span> 
 
<a name="LN28"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>InitScanRelation</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1077"><span class='Ref_to_Struct'>SampleScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>eflags</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN29"></a><span class='Keyword'>static </span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>SampleNext</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1077"><span class='Ref_to_Struct'>SampleScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN30"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>tablesample_init</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1077"><span class='Ref_to_Struct'>SampleScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>scanstate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN31"></a><span class='Keyword'>static </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Prototype'>tablesample_getnext</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1077"><span class='Ref_to_Struct'>SampleScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>scanstate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN32"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>SampleTupleVisible</span><span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tuple</span><span class='Delimiter'>, </span><a href="../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Parameter'>tupoffset</span><span class='Delimiter'>, 
</span><a name="LN33"></a>                   <a href="../../include/access/heapam.h.html#LN99"><span class='Ref_to_Typedef'>HeapScanDesc</span></a> <span class='Declare_Parameter'>scan</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *                      Scan Support 
 * ---------------------------------------------------------------- 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      SampleNext 
 * 
 *      This is a workhorse for ExecSampleScan 
 * ---------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>* 
</span><a name="LN47"></a><span class='Declare_Function'>SampleNext</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1077"><span class='Ref_to_Struct'>SampleScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN49"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN50"></a>    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>slot</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * if this is first call within a scan, initialize 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeSamplescan.c.html#LN47"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1087"><span class='Ref_to_Member'>begun</span></a><span class='Parentheses'>) 
</span>        <a href="nodeSamplescan.c.html#LN30"><span class='Ref_to_Proto'>tablesample_init</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN47"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * get the next tuple, and store it in our result slot 
     */ 
</span>    <a href="nodeSamplescan.c.html#LN49"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="nodeSamplescan.c.html#LN31"><span class='Ref_to_Proto'>tablesample_getnext</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN47"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="nodeSamplescan.c.html#LN50"><span class='Ref_To_Local'>slot</span></a> <span class='Operator'>= </span><a href="nodeSamplescan.c.html#LN47"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1079"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1060"><span class='Ref_to_Member'>ss_ScanTupleSlot</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN49"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/executor/tuptable.h.html#LN147"><span class='Ref_to_Proto'>ExecStoreTuple</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN49"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>,</span>   <span class='Comment_Single_Line'>/* tuple to store */ 
</span>                       <a href="nodeSamplescan.c.html#LN50"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* slot to store in */ 
</span>                       <a href="nodeSamplescan.c.html#LN47"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1079"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1059"><span class='Ref_to_Member'>ss_currentScanDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN69"><span class='Ref_to_Member'>rs_cbuf</span></a><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* tuple's buffer */ 
</span>                       <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* don't pfree this pointer */ 
</span>    <span class='Control'>else</span> 
        <a href="../../include/executor/tuptable.h.html#LN154"><span class='Ref_to_Proto'>ExecClearTuple</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN50"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="nodeSamplescan.c.html#LN50"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SampleNext &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * SampleRecheck -- access method routine to recheck a tuple in EvalPlanQual 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN80"></a><span class='Declare_Function'>SampleRecheck</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1077"><span class='Ref_to_Struct'>SampleScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * No need to recheck for SampleScan, since like SeqScan we don't pass any 
     * checkable keys to heap_beginscan. 
     */ 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      ExecSampleScan(node) 
 * 
 *      Scans the relation using the sampling method and returns 
 *      the next qualifying tuple. 
 *      We call the ExecScan() routine and pass it the appropriate 
 *      access method functions. 
 * ---------------------------------------------------------------- 
 */ 
</span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>* 
</span><a name="LN99"></a><span class='Declare_Function'>ExecSampleScan</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1077"><span class='Ref_to_Struct'>SampleScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="execScan.c.html#LN119"><span class='Ref_to_Func'>ExecScan</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/execnodes.h.html#LN1055"><span class='Ref_to_Struct'>ScanState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeSamplescan.c.html#LN99"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/executor/executor.h.html#LN388"><span class='Ref_to_Typedef'>ExecScanAccessMtd</span></a><span class='Parentheses'>) </span><a href="nodeSamplescan.c.html#LN29"><span class='Ref_to_Proto'>SampleNext</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/executor/executor.h.html#LN389"><span class='Ref_to_Typedef'>ExecScanRecheckMtd</span></a><span class='Parentheses'>) </span><a href="nodeSamplescan.c.html#LN79"><span class='Ref_to_Func'>SampleRecheck</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      InitScanRelation 
 * 
 *      Set up to access the scan relation. 
 * ---------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN113"></a><span class='Declare_Function'>InitScanRelation</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1077"><span class='Ref_to_Struct'>SampleScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>eflags</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN115"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>currentRelation</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * get the relation object id from the relid'th entry in the range table, 
     * open that relation and acquire appropriate lock on it. 
     */ 
</span>    <a href="nodeSamplescan.c.html#LN115"><span class='Ref_To_Local'>currentRelation</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN482"><span class='Ref_to_Proto'>ExecOpenScanRelation</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN113"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, 
</span>                           <span class='Parentheses'>((</span><a href="../../include/nodes/plannodes.h.html#LN341"><span class='Ref_to_Struct'>SampleScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeSamplescan.c.html#LN113"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1079"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN812"><span class='Ref_to_Member'>plan</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>scan<span class='Operator'>.</span>scanrelid<span class='Delimiter'>, 
</span>                                           <a href="nodeSamplescan.c.html#LN113"><span class='Ref_to_Parameter'>eflags</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="nodeSamplescan.c.html#LN113"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1079"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1058"><span class='Ref_to_Member'>ss_currentRelation</span></a> <span class='Operator'>= </span><a href="nodeSamplescan.c.html#LN115"><span class='Ref_To_Local'>currentRelation</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* we won't set up the HeapScanDesc till later */ 
</span>    <a href="nodeSamplescan.c.html#LN113"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1079"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1059"><span class='Ref_to_Member'>ss_currentScanDesc</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* and report the scan tuple slot's rowtype */ 
</span>    <a href="../../include/executor/executor.h.html#LN477"><span class='Ref_to_Proto'>ExecAssignScanType</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeSamplescan.c.html#LN113"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1079"><span class='Ref_to_Member'>ss</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN115"><span class='Ref_To_Local'>currentRelation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end InitScanRelation &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      ExecInitSampleScan 
 * ---------------------------------------------------------------- 
 */ 
</span><a href="../../include/nodes/execnodes.h.html#LN1077"><span class='Ref_to_Struct'>SampleScanState</span></a> <span class='Operator'>* 
</span><a name="LN140"></a><span class='Declare_Function'>ExecInitSampleScan</span><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN341"><span class='Ref_to_Struct'>SampleScan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>eflags</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN142"></a>    <a href="../../include/nodes/execnodes.h.html#LN1077"><span class='Ref_to_Struct'>SampleScanState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>scanstate</span><span class='Delimiter'>; 
</span><a name="LN143"></a>    <a href="../../include/nodes/parsenodes.h.html#LN1071"><span class='Ref_to_Struct'>TableSampleClause</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tsc</span> <span class='Operator'>= </span><a href="nodeSamplescan.c.html#LN140"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN345"><span class='Ref_to_Member'>tablesample</span></a><span class='Delimiter'>; 
</span><a name="LN144"></a>    <a href="../../include/access/tsmapi.h.html#LN54"><span class='Ref_to_Struct'>TsmRoutine</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tsm</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN173"><span class='Ref_to_Macro'>outerPlan</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN140"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN172"><span class='Ref_to_Macro'>innerPlan</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN140"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * create state structure 
     */ 
</span>    <a href="nodeSamplescan.c.html#LN142"><span class='Ref_To_Local'>scanstate</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1077"><span class='Ref_to_Struct'>SampleScanState</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeSamplescan.c.html#LN142"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1079"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN812"><span class='Ref_to_Member'>plan</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeSamplescan.c.html#LN140"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span>    <a href="nodeSamplescan.c.html#LN142"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1079"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN814"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="nodeSamplescan.c.html#LN140"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Miscellaneous initialization 
     * 
     * create expression context for node 
     */ 
</span>    <a href="execUtils.c.html#LN416"><span class='Ref_to_Func'>ExecAssignExprContext</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN140"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeSamplescan.c.html#LN142"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1079"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initialize child expressions 
     */ 
</span>    <a href="nodeSamplescan.c.html#LN142"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1079"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN826"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>= 
</span>        <a href="execExpr.c.html#LN158"><span class='Ref_to_Func'>ExecInitQual</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN140"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN343"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../include/nodes/plannodes.h.html#LN327"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeSamplescan.c.html#LN142"><span class='Ref_To_Local'>scanstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="nodeSamplescan.c.html#LN142"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1080"><span class='Ref_to_Member'>args</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN240"><span class='Ref_to_Proto'>ExecInitExprList</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN143"><span class='Ref_To_Local'>tsc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1075"><span class='Ref_to_Member'>args</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeSamplescan.c.html#LN142"><span class='Ref_To_Local'>scanstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeSamplescan.c.html#LN142"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1081"><span class='Ref_to_Member'>repeatable</span></a> <span class='Operator'>= 
</span>        <a href="execExpr.c.html#LN111"><span class='Ref_to_Func'>ExecInitExpr</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN143"><span class='Ref_To_Local'>tsc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1076"><span class='Ref_to_Member'>repeatable</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeSamplescan.c.html#LN142"><span class='Ref_To_Local'>scanstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * tuple table initialization 
     */ 
</span>    <a href="../../include/executor/executor.h.html#LN400"><span class='Ref_to_Proto'>ExecInitResultTupleSlot</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN140"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeSamplescan.c.html#LN142"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1079"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/executor/executor.h.html#LN401"><span class='Ref_to_Proto'>ExecInitScanTupleSlot</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN140"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeSamplescan.c.html#LN142"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1079"><span class='Ref_to_Member'>ss</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initialize scan relation 
     */ 
</span>    <a href="nodeSamplescan.c.html#LN28"><span class='Ref_to_Proto'>InitScanRelation</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN142"><span class='Ref_To_Local'>scanstate</span></a><span class='Delimiter'>, </span><a href="nodeSamplescan.c.html#LN140"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="nodeSamplescan.c.html#LN140"><span class='Ref_to_Parameter'>eflags</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Initialize result tuple type and projection info. 
     */ 
</span>    <a href="execUtils.c.html#LN438"><span class='Ref_to_Func'>ExecAssignResultTypeFromTL</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeSamplescan.c.html#LN142"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1079"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="execScan.c.html#LN233"><span class='Ref_to_Func'>ExecAssignScanProjectionInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeSamplescan.c.html#LN142"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1079"><span class='Ref_to_Member'>ss</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we don't have a REPEATABLE clause, select a random seed.  We want to 
     * do this just once, since the seed shouldn't change over rescans. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN143"><span class='Ref_To_Local'>tsc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1076"><span class='Ref_to_Member'>repeatable</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="nodeSamplescan.c.html#LN142"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1088"><span class='Ref_to_Member'>seed</span></a> <span class='Operator'>= </span><a href="../../port/random.c.html#LN20"><span class='Ref_to_Func'>random</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Finally, initialize the TABLESAMPLE method handler. 
     */ 
</span>    <a href="nodeSamplescan.c.html#LN144"><span class='Ref_To_Local'>tsm</span></a> <span class='Operator'>= </span><a href="../access/tablesample/tablesample.c.html#LN25"><span class='Ref_to_Func'>GetTsmRoutine</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN143"><span class='Ref_To_Local'>tsc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1074"><span class='Ref_to_Member'>tsmhandler</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeSamplescan.c.html#LN142"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1083"><span class='Ref_to_Member'>tsmroutine</span></a> <span class='Operator'>= </span><a href="nodeSamplescan.c.html#LN144"><span class='Ref_To_Local'>tsm</span></a><span class='Delimiter'>; 
</span>    <a href="nodeSamplescan.c.html#LN142"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1084"><span class='Ref_to_Member'>tsm_state</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN144"><span class='Ref_To_Local'>tsm</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tsmapi.h.html#LN69"><span class='Ref_to_Member'>InitSampleScan</span></a><span class='Parentheses'>) 
</span>        <a href="nodeSamplescan.c.html#LN144"><span class='Ref_To_Local'>tsm</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tsmapi.h.html#LN69"><span class='Ref_to_Member'>InitSampleScan</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN142"><span class='Ref_To_Local'>scanstate</span></a><span class='Delimiter'>, </span><a href="nodeSamplescan.c.html#LN140"><span class='Ref_to_Parameter'>eflags</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We'll do BeginSampleScan later; we can't evaluate params yet */ 
</span>    <a href="nodeSamplescan.c.html#LN142"><span class='Ref_To_Local'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1087"><span class='Ref_to_Member'>begun</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="nodeSamplescan.c.html#LN142"><span class='Ref_To_Local'>scanstate</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecInitSampleScan &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      ExecEndSampleScan 
 * 
 *      frees any storage allocated through C routines. 
 * ---------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN220"></a><span class='Declare_Function'>ExecEndSampleScan</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1077"><span class='Ref_to_Struct'>SampleScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * Tell sampling function that we finished the scan. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN220"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1083"><span class='Ref_to_Member'>tsmroutine</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tsmapi.h.html#LN73"><span class='Ref_to_Member'>EndSampleScan</span></a><span class='Parentheses'>) 
</span>        <a href="nodeSamplescan.c.html#LN220"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1083"><span class='Ref_to_Member'>tsmroutine</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tsmapi.h.html#LN73"><span class='Ref_to_Member'>EndSampleScan</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN220"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Free the exprcontext 
     */ 
</span>    <a href="../../include/executor/executor.h.html#LN476"><span class='Ref_to_Proto'>ExecFreeExprContext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeSamplescan.c.html#LN220"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1079"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * clean out the tuple table 
     */ 
</span>    <a href="../../include/executor/tuptable.h.html#LN154"><span class='Ref_to_Proto'>ExecClearTuple</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN220"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1079"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN841"><span class='Ref_to_Member'>ps_ResultTupleSlot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/executor/tuptable.h.html#LN154"><span class='Ref_to_Proto'>ExecClearTuple</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN220"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1079"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1060"><span class='Ref_to_Member'>ss_ScanTupleSlot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * close heap scan 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN220"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1079"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1059"><span class='Ref_to_Member'>ss_currentScanDesc</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/access/heapam.h.html#LN126"><span class='Ref_to_Proto'>heap_endscan</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN220"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1079"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1059"><span class='Ref_to_Member'>ss_currentScanDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * close the heap relation. 
     */ 
</span>    <a href="../../include/executor/executor.h.html#LN483"><span class='Ref_to_Proto'>ExecCloseScanRelation</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN220"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1079"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1058"><span class='Ref_to_Member'>ss_currentRelation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecEndSampleScan &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      ExecReScanSampleScan 
 * 
 *      Rescans the relation. 
 * 
 * ---------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN259"></a><span class='Declare_Function'>ExecReScanSampleScan</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1077"><span class='Ref_to_Struct'>SampleScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Remember we need to do BeginSampleScan again (if we did it at all) */ 
</span>    <a href="nodeSamplescan.c.html#LN259"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1087"><span class='Ref_to_Member'>begun</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="execScan.c.html#LN325"><span class='Ref_to_Func'>ExecScanReScan</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeSamplescan.c.html#LN259"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1079"><span class='Ref_to_Member'>ss</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Initialize the TABLESAMPLE method: evaluate params and call BeginSampleScan. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN272"></a><span class='Declare_Function'>tablesample_init</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1077"><span class='Ref_to_Struct'>SampleScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>scanstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN274"></a>    <a href="../../include/access/tsmapi.h.html#LN54"><span class='Ref_to_Struct'>TsmRoutine</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tsm</span> <span class='Operator'>= </span><a href="nodeSamplescan.c.html#LN272"><span class='Ref_to_Parameter'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1083"><span class='Ref_to_Member'>tsmroutine</span></a><span class='Delimiter'>; 
</span><a name="LN275"></a>    <a href="../../include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>econtext</span> <span class='Operator'>= </span><a href="nodeSamplescan.c.html#LN272"><span class='Ref_to_Parameter'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1079"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN842"><span class='Ref_to_Member'>ps_ExprContext</span></a><span class='Delimiter'>; 
</span><a name="LN276"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>params</span><span class='Delimiter'>; 
</span><a name="LN277"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>datum</span><span class='Delimiter'>; 
</span><a name="LN278"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN279"></a>    <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>seed</span><span class='Delimiter'>; 
</span><a name="LN280"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>allow_sync</span><span class='Delimiter'>; 
</span><a name="LN281"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN282"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>arg</span><span class='Delimiter'>; 
</span> 
    <a href="nodeSamplescan.c.html#LN276"><span class='Ref_To_Local'>params</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN272"><span class='Ref_to_Parameter'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1080"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="nodeSamplescan.c.html#LN281"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN282"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, </span><a href="nodeSamplescan.c.html#LN272"><span class='Ref_to_Parameter'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1080"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN289"></a>        <a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>argstate</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN282"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="nodeSamplescan.c.html#LN276"><span class='Ref_To_Local'>params</span></a><span class='Delimiter'>[</span><a href="nodeSamplescan.c.html#LN281"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN279"><span class='Ref_to_Func'>ExecEvalExprSwitchContext</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN289"><span class='Ref_To_Local'>argstate</span></a><span class='Delimiter'>, 
</span>                                              <a href="nodeSamplescan.c.html#LN275"><span class='Ref_To_Local'>econtext</span></a><span class='Delimiter'>, 
</span>                                              <span class='Operator'>&</span><a href="nodeSamplescan.c.html#LN278"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN278"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TABLESAMPLE_ARGUMENT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"TABLESAMPLE parameter cannot be null"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="nodeSamplescan.c.html#LN281"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN272"><span class='Ref_to_Parameter'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1081"><span class='Ref_to_Member'>repeatable</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="nodeSamplescan.c.html#LN277"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN279"><span class='Ref_to_Func'>ExecEvalExprSwitchContext</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN272"><span class='Ref_to_Parameter'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1081"><span class='Ref_to_Member'>repeatable</span></a><span class='Delimiter'>, 
</span>                                          <a href="nodeSamplescan.c.html#LN275"><span class='Ref_To_Local'>econtext</span></a><span class='Delimiter'>, 
</span>                                          <span class='Operator'>&</span><a href="nodeSamplescan.c.html#LN278"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN278"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TABLESAMPLE_REPEAT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"TABLESAMPLE REPEATABLE parameter cannot be null"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * The REPEATABLE parameter has been coerced to float8 by the parser. 
         * The reason for using float8 at the SQL level is that it will 
         * produce unsurprising results both for users used to databases that 
         * accept only integers in the REPEATABLE clause and for those who 
         * might expect that REPEATABLE works like setseed() (a float in the 
         * range from -1 to 1). 
         * 
         * We use hashfloat8() to convert the supplied value into a suitable 
         * seed.  For regression-testing purposes, that has the convenient 
         * property that REPEATABLE(0) gives a machine-independent result. 
         */ 
</span>        <a href="nodeSamplescan.c.html#LN279"><span class='Ref_To_Local'>seed</span></a> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN491"><span class='Ref_to_Macro'>DatumGetUInt32</span></a><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../access/hash/hashfunc.c.html#LN118"><span class='Ref_to_Func'>hashfloat8</span></a><span class='Delimiter'>, </span><a href="nodeSamplescan.c.html#LN277"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if scanstate-&GT;repeatable &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Use the seed selected by ExecInitSampleScan */ 
</span>        <a href="nodeSamplescan.c.html#LN279"><span class='Ref_To_Local'>seed</span></a> <span class='Operator'>= </span><a href="nodeSamplescan.c.html#LN272"><span class='Ref_to_Parameter'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1088"><span class='Ref_to_Member'>seed</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Set default values for params that BeginSampleScan can adjust */ 
</span>    <a href="nodeSamplescan.c.html#LN272"><span class='Ref_to_Parameter'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1085"><span class='Ref_to_Member'>use_bulkread</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="nodeSamplescan.c.html#LN272"><span class='Ref_to_Parameter'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1086"><span class='Ref_to_Member'>use_pagemode</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Let tablesample method do its thing */ 
</span>    <a href="nodeSamplescan.c.html#LN274"><span class='Ref_To_Local'>tsm</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tsmapi.h.html#LN70"><span class='Ref_to_Member'>BeginSampleScan</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN272"><span class='Ref_to_Parameter'>scanstate</span></a><span class='Delimiter'>, 
</span>                         <a href="nodeSamplescan.c.html#LN276"><span class='Ref_To_Local'>params</span></a><span class='Delimiter'>, 
</span>                         <a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN272"><span class='Ref_to_Parameter'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1080"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="nodeSamplescan.c.html#LN279"><span class='Ref_To_Local'>seed</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We'll use syncscan if there's no NextSampleBlock function */ 
</span>    <a href="nodeSamplescan.c.html#LN280"><span class='Ref_To_Local'>allow_sync</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN274"><span class='Ref_To_Local'>tsm</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tsmapi.h.html#LN71"><span class='Ref_to_Member'>NextSampleBlock</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Now we can create or reset the HeapScanDesc */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN272"><span class='Ref_to_Parameter'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1079"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1059"><span class='Ref_to_Member'>ss_currentScanDesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="nodeSamplescan.c.html#LN272"><span class='Ref_to_Parameter'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1079"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1059"><span class='Ref_to_Member'>ss_currentScanDesc</span></a> <span class='Operator'>= 
</span>            <a href="../../include/access/heapam.h.html#LN117"><span class='Ref_to_Proto'>heap_beginscan_sampling</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN272"><span class='Ref_to_Parameter'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1079"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1058"><span class='Ref_to_Member'>ss_currentRelation</span></a><span class='Delimiter'>, 
</span>                                    <a href="nodeSamplescan.c.html#LN272"><span class='Ref_to_Parameter'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1079"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN814"><span class='Ref_to_Member'>state</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN408"><span class='Ref_to_Member'>es_snapshot</span></a><span class='Delimiter'>, 
</span>                                    <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                    <a href="nodeSamplescan.c.html#LN272"><span class='Ref_to_Parameter'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1085"><span class='Ref_to_Member'>use_bulkread</span></a><span class='Delimiter'>, 
</span>                                    <a href="nodeSamplescan.c.html#LN280"><span class='Ref_To_Local'>allow_sync</span></a><span class='Delimiter'>, 
</span>                                    <a href="nodeSamplescan.c.html#LN272"><span class='Ref_to_Parameter'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1086"><span class='Ref_to_Member'>use_pagemode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/access/heapam.h.html#LN124"><span class='Ref_to_Proto'>heap_rescan_set_params</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN272"><span class='Ref_to_Parameter'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1079"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1059"><span class='Ref_to_Member'>ss_currentScanDesc</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                               <a href="nodeSamplescan.c.html#LN272"><span class='Ref_to_Parameter'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1085"><span class='Ref_to_Member'>use_bulkread</span></a><span class='Delimiter'>, 
</span>                               <a href="nodeSamplescan.c.html#LN280"><span class='Ref_To_Local'>allow_sync</span></a><span class='Delimiter'>, 
</span>                               <a href="nodeSamplescan.c.html#LN272"><span class='Ref_to_Parameter'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1086"><span class='Ref_to_Member'>use_pagemode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN276"><span class='Ref_To_Local'>params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* And we're initialized. */ 
</span>    <a href="nodeSamplescan.c.html#LN272"><span class='Ref_to_Parameter'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1087"><span class='Ref_to_Member'>begun</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end tablesample_init &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Get next tuple from TABLESAMPLE method. 
 * 
 * Note: an awful lot of this is copied-and-pasted from heapam.c.  It would 
 * perhaps be better to refactor to share more code. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> 
<a name="LN376"></a><span class='Declare_Function'>tablesample_getnext</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1077"><span class='Ref_to_Struct'>SampleScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>scanstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN378"></a>    <a href="../../include/access/tsmapi.h.html#LN54"><span class='Ref_to_Struct'>TsmRoutine</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tsm</span> <span class='Operator'>= </span><a href="nodeSamplescan.c.html#LN376"><span class='Ref_to_Parameter'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1083"><span class='Ref_to_Member'>tsmroutine</span></a><span class='Delimiter'>; 
</span><a name="LN379"></a>    <a href="../../include/access/heapam.h.html#LN99"><span class='Ref_to_Typedef'>HeapScanDesc</span></a> <span class='Declare_Local'>scan</span> <span class='Operator'>= </span><a href="nodeSamplescan.c.html#LN376"><span class='Ref_to_Parameter'>scanstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1079"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1059"><span class='Ref_to_Member'>ss_currentScanDesc</span></a><span class='Delimiter'>; 
</span><a name="LN380"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span> <span class='Operator'>= &</span><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN379"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN67"><span class='Ref_to_Member'>rs_ctup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN381"></a>    <a href="../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a>    <span class='Declare_Local'>snapshot</span> <span class='Operator'>= </span><a href="nodeSamplescan.c.html#LN379"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN47"><span class='Ref_to_Member'>rs_snapshot</span></a><span class='Delimiter'>; 
</span><a name="LN382"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>pagemode</span> <span class='Operator'>= </span><a href="nodeSamplescan.c.html#LN379"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN52"><span class='Ref_to_Member'>rs_pageatatime</span></a><span class='Delimiter'>; 
</span><a name="LN383"></a>    <a href="../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Local'>blockno</span><span class='Delimiter'>; 
</span><a name="LN384"></a>    <a href="../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span><a name="LN385"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>all_visible</span><span class='Delimiter'>; 
</span><a name="LN386"></a>    <a href="../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>maxoffset</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeSamplescan.c.html#LN379"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN66"><span class='Ref_to_Member'>rs_inited</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * return null immediately if relation is empty 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN379"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN58"><span class='Ref_to_Member'>rs_nblocks</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/storage/bufmgr.h.html#LN113"><span class='Ref_to_Macro'>BufferIsValid</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN379"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN69"><span class='Ref_to_Member'>rs_cbuf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="nodeSamplescan.c.html#LN380"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN378"><span class='Ref_To_Local'>tsm</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tsmapi.h.html#LN71"><span class='Ref_to_Member'>NextSampleBlock</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="nodeSamplescan.c.html#LN383"><span class='Ref_To_Local'>blockno</span></a> <span class='Operator'>= </span><a href="nodeSamplescan.c.html#LN378"><span class='Ref_To_Local'>tsm</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tsmapi.h.html#LN71"><span class='Ref_to_Member'>NextSampleBlock</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN376"><span class='Ref_to_Parameter'>scanstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/storage/block.h.html#LN69"><span class='Ref_to_Macro'>BlockNumberIsValid</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN383"><span class='Ref_To_Local'>blockno</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="nodeSamplescan.c.html#LN380"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="nodeSamplescan.c.html#LN383"><span class='Ref_To_Local'>blockno</span></a> <span class='Operator'>= </span><a href="nodeSamplescan.c.html#LN379"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN59"><span class='Ref_to_Member'>rs_startblock</span></a><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN383"><span class='Ref_To_Local'>blockno</span></a> <span class='Operator'>&LT; </span><a href="nodeSamplescan.c.html#LN379"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN58"><span class='Ref_to_Member'>rs_nblocks</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/access/heapam.h.html#LN122"><span class='Ref_to_Proto'>heapgetpage</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN379"><span class='Ref_To_Local'>scan</span></a><span class='Delimiter'>, </span><a href="nodeSamplescan.c.html#LN383"><span class='Ref_To_Local'>blockno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeSamplescan.c.html#LN379"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN66"><span class='Ref_to_Member'>rs_inited</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !scan-&GT;rs_inited &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* continue from previously returned page/tuple */ 
</span>        <a href="nodeSamplescan.c.html#LN383"><span class='Ref_To_Local'>blockno</span></a> <span class='Operator'>= </span><a href="nodeSamplescan.c.html#LN379"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN68"><span class='Ref_to_Member'>rs_cblock</span></a><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* current page */ 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * When not using pagemode, we must lock the buffer during tuple 
     * visibility checks. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeSamplescan.c.html#LN382"><span class='Ref_To_Local'>pagemode</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN379"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN69"><span class='Ref_to_Member'>rs_cbuf</span></a><span class='Delimiter'>, </span><a href="../../include/storage/bufmgr.h.html#LN87"><span class='Ref_to_Const'>BUFFER_LOCK_SHARE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="nodeSamplescan.c.html#LN384"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a><span class='Parentheses'>) </span><a href="../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN379"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN69"><span class='Ref_to_Member'>rs_cbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeSamplescan.c.html#LN385"><span class='Ref_To_Local'>all_visible</span></a> <span class='Operator'>= </span><a href="../../include/storage/bufpage.h.html#LN381"><span class='Ref_to_Macro'>PageIsAllVisible</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN384"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>) </span><span class='Operator'>&& !</span><a href="nodeSamplescan.c.html#LN381"><span class='Ref_To_Local'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/snapshot.h.html#LN92"><span class='Ref_to_Member'>takenDuringRecovery</span></a><span class='Delimiter'>; 
</span>    <a href="nodeSamplescan.c.html#LN386"><span class='Ref_To_Local'>maxoffset</span></a> <span class='Operator'>= </span><a href="../../include/storage/bufpage.h.html#LN353"><span class='Ref_to_Macro'>PageGetMaxOffsetNumber</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN384"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN433"></a>        <a href="../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>tupoffset</span><span class='Delimiter'>; 
</span><a name="LN434"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>finished</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Ask the tablesample method which tuples to check on this page. */ 
</span>        <a href="nodeSamplescan.c.html#LN433"><span class='Ref_To_Local'>tupoffset</span></a> <span class='Operator'>= </span><a href="nodeSamplescan.c.html#LN378"><span class='Ref_To_Local'>tsm</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tsmapi.h.html#LN72"><span class='Ref_to_Member'>NextSampleTuple</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN376"><span class='Ref_to_Parameter'>scanstate</span></a><span class='Delimiter'>, 
</span>                                         <a href="nodeSamplescan.c.html#LN383"><span class='Ref_To_Local'>blockno</span></a><span class='Delimiter'>, 
</span>                                         <a href="nodeSamplescan.c.html#LN386"><span class='Ref_To_Local'>maxoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/storage/off.h.html#LN39"><span class='Ref_to_Macro'>OffsetNumberIsValid</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN433"><span class='Ref_To_Local'>tupoffset</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN445"></a>            <a href="../../include/storage/itemid.h.html#LN30"><span class='Ref_to_Typedef'>ItemId</span></a>      <span class='Declare_Local'>itemid</span><span class='Delimiter'>; 
</span><a name="LN446"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>visible</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Skip invalid tuple pointers. */ 
</span>            <a href="nodeSamplescan.c.html#LN445"><span class='Ref_To_Local'>itemid</span></a> <span class='Operator'>= </span><a href="../../include/storage/bufpage.h.html#LN231"><span class='Ref_to_Macro'>PageGetItemId</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN384"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="nodeSamplescan.c.html#LN433"><span class='Ref_To_Local'>tupoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/storage/itemid.h.html#LN97"><span class='Ref_to_Macro'>ItemIdIsNormal</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN445"><span class='Ref_To_Local'>itemid</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <a href="nodeSamplescan.c.html#LN380"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a><span class='Parentheses'>) </span><a href="../../include/storage/bufpage.h.html#LN336"><span class='Ref_to_Macro'>PageGetItem</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN384"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="nodeSamplescan.c.html#LN445"><span class='Ref_To_Local'>itemid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="nodeSamplescan.c.html#LN380"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a> <span class='Operator'>= </span><a href="../../include/storage/itemid.h.html#LN57"><span class='Ref_to_Macro'>ItemIdGetLength</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN445"><span class='Ref_To_Local'>itemid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/storage/itemptr.h.html#LN103"><span class='Ref_to_Macro'>ItemPointerSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN380"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="nodeSamplescan.c.html#LN383"><span class='Ref_To_Local'>blockno</span></a><span class='Delimiter'>, </span><a href="nodeSamplescan.c.html#LN433"><span class='Ref_To_Local'>tupoffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN385"><span class='Ref_To_Local'>all_visible</span></a><span class='Parentheses'>) 
</span>                <a href="nodeSamplescan.c.html#LN446"><span class='Ref_To_Local'>visible</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="nodeSamplescan.c.html#LN446"><span class='Ref_To_Local'>visible</span></a> <span class='Operator'>= </span><a href="nodeSamplescan.c.html#LN32"><span class='Ref_to_Proto'>SampleTupleVisible</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN380"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="nodeSamplescan.c.html#LN433"><span class='Ref_To_Local'>tupoffset</span></a><span class='Delimiter'>, </span><a href="nodeSamplescan.c.html#LN379"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* in pagemode, heapgetpage did this for us */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeSamplescan.c.html#LN382"><span class='Ref_To_Local'>pagemode</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/storage/predicate.h.html#LN59"><span class='Ref_to_Proto'>CheckForSerializableConflictOut</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN446"><span class='Ref_To_Local'>visible</span></a><span class='Delimiter'>, </span><a href="nodeSamplescan.c.html#LN379"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN46"><span class='Ref_to_Member'>rs_rd</span></a><span class='Delimiter'>, </span><a href="nodeSamplescan.c.html#LN380"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, 
</span>                                                <a href="nodeSamplescan.c.html#LN379"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN69"><span class='Ref_to_Member'>rs_cbuf</span></a><span class='Delimiter'>, </span><a href="nodeSamplescan.c.html#LN381"><span class='Ref_To_Local'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN446"><span class='Ref_To_Local'>visible</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Found visible tuple, return it. */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeSamplescan.c.html#LN382"><span class='Ref_To_Local'>pagemode</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN379"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN69"><span class='Ref_to_Member'>rs_cbuf</span></a><span class='Delimiter'>, </span><a href="../../include/storage/bufmgr.h.html#LN86"><span class='Ref_to_Const'>BUFFER_LOCK_UNLOCK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Try next tuple from same page. */ 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if OffsetNumberIsValid(t... &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * if we get here, it means we've exhausted the items on this page and 
         * it's time to move to the next. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeSamplescan.c.html#LN382"><span class='Ref_To_Local'>pagemode</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN379"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN69"><span class='Ref_to_Member'>rs_cbuf</span></a><span class='Delimiter'>, </span><a href="../../include/storage/bufmgr.h.html#LN86"><span class='Ref_to_Const'>BUFFER_LOCK_UNLOCK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN378"><span class='Ref_To_Local'>tsm</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tsmapi.h.html#LN71"><span class='Ref_to_Member'>NextSampleBlock</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="nodeSamplescan.c.html#LN383"><span class='Ref_To_Local'>blockno</span></a> <span class='Operator'>= </span><a href="nodeSamplescan.c.html#LN378"><span class='Ref_To_Local'>tsm</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tsmapi.h.html#LN71"><span class='Ref_to_Member'>NextSampleBlock</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN376"><span class='Ref_to_Parameter'>scanstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeSamplescan.c.html#LN379"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN63"><span class='Ref_to_Member'>rs_syncscan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="nodeSamplescan.c.html#LN434"><span class='Ref_To_Local'>finished</span></a> <span class='Operator'>= !</span><a href="../../include/storage/block.h.html#LN69"><span class='Ref_to_Macro'>BlockNumberIsValid</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN383"><span class='Ref_To_Local'>blockno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Without NextSampleBlock, just do a plain forward seqscan. */ 
</span>            <a href="nodeSamplescan.c.html#LN383"><span class='Ref_To_Local'>blockno</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN383"><span class='Ref_To_Local'>blockno</span></a> <span class='Operator'>&GT;= </span><a href="nodeSamplescan.c.html#LN379"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN58"><span class='Ref_to_Member'>rs_nblocks</span></a><span class='Parentheses'>) 
</span>                <a href="nodeSamplescan.c.html#LN383"><span class='Ref_To_Local'>blockno</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Report our new scan position for synchronization purposes. 
             * 
             * Note: we do this before checking for end of scan so that the 
             * final state of the position hint is back at the start of the 
             * rel.  That's not strictly necessary, but otherwise when you run 
             * the same query multiple times the starting position would shift 
             * a little bit backwards on every invocation, which is confusing. 
             * We don't guarantee any specific ordering in general, though. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN379"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN63"><span class='Ref_to_Member'>rs_syncscan</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/access/heapam.h.html#LN195"><span class='Ref_to_Proto'>ss_report_location</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN379"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN46"><span class='Ref_to_Member'>rs_rd</span></a><span class='Delimiter'>, </span><a href="nodeSamplescan.c.html#LN383"><span class='Ref_To_Local'>blockno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="nodeSamplescan.c.html#LN434"><span class='Ref_To_Local'>finished</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN383"><span class='Ref_To_Local'>blockno</span></a> <span class='Operator'>== </span><a href="nodeSamplescan.c.html#LN379"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN59"><span class='Ref_to_Member'>rs_startblock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * Reached end of scan? 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN434"><span class='Ref_To_Local'>finished</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/storage/bufmgr.h.html#LN113"><span class='Ref_to_Macro'>BufferIsValid</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN379"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN69"><span class='Ref_to_Member'>rs_cbuf</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/storage/bufmgr.h.html#LN174"><span class='Ref_to_Proto'>ReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN379"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN69"><span class='Ref_to_Member'>rs_cbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="nodeSamplescan.c.html#LN379"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN69"><span class='Ref_to_Member'>rs_cbuf</span></a> <span class='Operator'>= </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span>            <a href="nodeSamplescan.c.html#LN379"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN68"><span class='Ref_to_Member'>rs_cblock</span></a> <span class='Operator'>= </span><a href="../../include/storage/block.h.html#LN32"><span class='Ref_to_Const'>InvalidBlockNumber</span></a><span class='Delimiter'>; 
</span>            <a href="nodeSamplescan.c.html#LN380"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="nodeSamplescan.c.html#LN379"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN66"><span class='Ref_to_Member'>rs_inited</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN383"><span class='Ref_To_Local'>blockno</span></a> <span class='Operator'>&LT; </span><a href="nodeSamplescan.c.html#LN379"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN58"><span class='Ref_to_Member'>rs_nblocks</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/access/heapam.h.html#LN122"><span class='Ref_to_Proto'>heapgetpage</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN379"><span class='Ref_To_Local'>scan</span></a><span class='Delimiter'>, </span><a href="nodeSamplescan.c.html#LN383"><span class='Ref_To_Local'>blockno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Re-establish state for new page */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeSamplescan.c.html#LN382"><span class='Ref_To_Local'>pagemode</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN379"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN69"><span class='Ref_to_Member'>rs_cbuf</span></a><span class='Delimiter'>, </span><a href="../../include/storage/bufmgr.h.html#LN87"><span class='Ref_to_Const'>BUFFER_LOCK_SHARE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="nodeSamplescan.c.html#LN384"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a><span class='Parentheses'>) </span><a href="../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN379"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN69"><span class='Ref_to_Member'>rs_cbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeSamplescan.c.html#LN385"><span class='Ref_To_Local'>all_visible</span></a> <span class='Operator'>= </span><a href="../../include/storage/bufpage.h.html#LN381"><span class='Ref_to_Macro'>PageIsAllVisible</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN384"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>) </span><span class='Operator'>&& !</span><a href="nodeSamplescan.c.html#LN381"><span class='Ref_To_Local'>snapshot</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/snapshot.h.html#LN92"><span class='Ref_to_Member'>takenDuringRecovery</span></a><span class='Delimiter'>; 
</span>        <a href="nodeSamplescan.c.html#LN386"><span class='Ref_To_Local'>maxoffset</span></a> <span class='Operator'>= </span><a href="../../include/storage/bufpage.h.html#LN353"><span class='Ref_to_Macro'>PageGetMaxOffsetNumber</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN384"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Count successfully-fetched tuples as heap fetches */ 
</span>    <a href="../../include/pgstat.h.html#LN1252"><span class='Ref_to_Macro'>pgstat_count_heap_getnext</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN379"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN46"><span class='Ref_to_Member'>rs_rd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Operator'>&</span><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN379"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN67"><span class='Ref_to_Member'>rs_ctup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end tablesample_getnext &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Check visibility of the tuple. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN553"></a><span class='Declare_Function'>SampleTupleVisible</span><span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tuple</span><span class='Delimiter'>, </span><a href="../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Parameter'>tupoffset</span><span class='Delimiter'>, </span><a href="../../include/access/heapam.h.html#LN99"><span class='Ref_to_Typedef'>HeapScanDesc</span></a> <span class='Declare_Parameter'>scan</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN553"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN52"><span class='Ref_to_Member'>rs_pageatatime</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * In pageatatime mode, heapgetpage() already did visibility checks, 
         * so just look at the info it left in rs_vistuples[]. 
         * 
         * We use a binary search over the known-sorted array.  Note: we could 
         * save some effort if we insisted that NextSampleTuple select tuples 
         * in increasing order, but it's not clear that there would be enough 
         * gain to justify the restriction. 
         */ 
</span><a name="LN566"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>start</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, 
</span><a name="LN567"></a>                    <span class='Declare_Local'>end</span> <span class='Operator'>= </span><a href="nodeSamplescan.c.html#LN553"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN75"><span class='Ref_to_Member'>rs_ntuples</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN566"><span class='Ref_To_Local'>start</span></a> <span class='Operator'>&LT;= </span><a href="nodeSamplescan.c.html#LN567"><span class='Ref_To_Local'>end</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN571"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>mid</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN566"><span class='Ref_To_Local'>start</span></a> <span class='Operator'>+ </span><a href="nodeSamplescan.c.html#LN567"><span class='Ref_To_Local'>end</span></a><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>2</span><span class='Delimiter'>; 
</span><a name="LN572"></a>            <a href="../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>curoffset</span> <span class='Operator'>= </span><a href="nodeSamplescan.c.html#LN553"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN76"><span class='Ref_to_Member'>rs_vistuples</span></a><span class='Delimiter'>[</span><a href="nodeSamplescan.c.html#LN571"><span class='Ref_To_Local'>mid</span></a><span class='Delimiter'>]; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN553"><span class='Ref_to_Parameter'>tupoffset</span></a> <span class='Operator'>== </span><a href="nodeSamplescan.c.html#LN572"><span class='Ref_To_Local'>curoffset</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN553"><span class='Ref_to_Parameter'>tupoffset</span></a> <span class='Operator'>&LT; </span><a href="nodeSamplescan.c.html#LN572"><span class='Ref_To_Local'>curoffset</span></a><span class='Parentheses'>) 
</span>                <a href="nodeSamplescan.c.html#LN567"><span class='Ref_To_Local'>end</span></a> <span class='Operator'>= </span><a href="nodeSamplescan.c.html#LN571"><span class='Ref_To_Local'>mid</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="nodeSamplescan.c.html#LN566"><span class='Ref_To_Local'>start</span></a> <span class='Operator'>= </span><a href="nodeSamplescan.c.html#LN571"><span class='Ref_To_Local'>mid</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if scan-&GT;rs_pageatatime &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Otherwise, we have to check the tuple individually. */ 
</span>        <span class='Control'>return</span> <a href="../../include/utils/tqual.h.html#LN44"><span class='Ref_to_Macro'>HeapTupleSatisfiesVisibility</span></a><span class='Parentheses'>(</span><a href="nodeSamplescan.c.html#LN553"><span class='Ref_to_Parameter'>tuple</span></a><span class='Delimiter'>, 
</span>                                            <a href="nodeSamplescan.c.html#LN553"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN47"><span class='Ref_to_Member'>rs_snapshot</span></a><span class='Delimiter'>, 
</span>                                            <a href="nodeSamplescan.c.html#LN553"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/relscan.h.html#LN69"><span class='Ref_to_Member'>rs_cbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end SampleTupleVisible &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>