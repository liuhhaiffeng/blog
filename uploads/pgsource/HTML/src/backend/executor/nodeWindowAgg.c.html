<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\executor\nodeWindowAgg.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\executor\nodeWindowAgg.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:40 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * nodeWindowAgg.c 
 *    routines to handle WindowAgg nodes. 
 * 
 * A WindowAgg node evaluates "window functions" across suitable partitions 
 * of the input tuple set.  Any one WindowAgg works for just a single window 
 * specification, though it can evaluate multiple window functions sharing 
 * identical window specifications.  The input tuples are required to be 
 * delivered in sorted order, with the PARTITION BY columns (if any) as 
 * major sort keys and the ORDER BY columns (if any) as minor sort keys. 
 * (The planner generates a stack of WindowAggs with intervening Sort nodes 
 * as needed, if a query involves more than one window specification.) 
 * 
 * Since window functions can require access to any or all of the rows in 
 * the current partition, we accumulate rows of the partition into a 
 * tuplestore.  The window functions are called using the WindowObject API 
 * so that they can access those rows as needed. 
 * 
 * We also support using plain aggregate functions as window functions. 
 * For these, the regular Agg-node environment is emulated for each partition. 
 * As required by the SQL spec, the output represents the value of the 
 * aggregate function over all rows in the current row's window frame. 
 * 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * IDENTIFICATION 
 *    src/backend/executor/nodeWindowAgg.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/objectaccess.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_aggregate.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_proc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"executor/executor.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"executor/nodeWindowAgg.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/nodeFuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/clauses.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_agg.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_coerce.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/acl.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/datum.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"windowapi.h"</span> 
 
<span class='Comment_Multi_Line'>/* 
 * All the window function APIs are called with this object, which is passed 
 * to window functions as fcinfo-&GT;context. 
 */ 
</span><a name="LN58"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>WindowObjectData</span> 
<span class='Delimiter'>{ 
</span><a name="LN60"></a>    <a href="../../include/nodes/nodes.h.html#LN25"><span class='Ref_to_Enum'>NodeTag</span></a>     <span class='Declare_Member'>type</span><span class='Delimiter'>; 
</span><a name="LN61"></a>    <a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Member'>winstate</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* parent WindowAggState */ 
</span><a name="LN62"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>argstates</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* ExprState trees for fn's arguments */ 
</span><a name="LN63"></a>    <span class='Keyword'>void</span>       <span class='Operator'>*</span><span class='Declare_Member'>localmem</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* WinGetPartitionLocalMemory's chunk */ 
</span><a name="LN64"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>markptr</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* tuplestore mark pointer for this fn */ 
</span><a name="LN65"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>readptr</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* tuplestore read pointer for this fn */ 
</span><a name="LN66"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>markpos</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* row that markptr is positioned on */ 
</span><a name="LN67"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>seekpos</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* row that readptr is positioned on */ 
</span><a name="LN68"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>WindowObjectData</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * We have one WindowStatePerFunc struct for each window function and 
 * window aggregate handled by this node. 
 */ 
</span><a name="LN74"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>WindowStatePerFuncData</span> 
<span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Links to WindowFunc expr and state nodes this working state is for */ 
</span><a name="LN77"></a>    <a href="../../include/nodes/execnodes.h.html#LN641"><span class='Ref_to_Struct'>WindowFuncExprState</span></a> <span class='Operator'>*</span><span class='Declare_Member'>wfuncstate</span><span class='Delimiter'>; 
</span><a name="LN78"></a>    <a href="../../include/nodes/primnodes.h.html#LN351"><span class='Ref_to_Struct'>WindowFunc</span></a> <span class='Operator'>*</span><span class='Declare_Member'>wfunc</span><span class='Delimiter'>; 
</span> 
<a name="LN80"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>numArguments</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* number of arguments */ 
</span> 
<a name="LN82"></a>    <a href="../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a>    <span class='Declare_Member'>flinfo</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* fmgr lookup data for window function */ 
</span> 
<a name="LN84"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>winCollation</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* collation derived for window function */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We need the len and byval info for the result of each function in order 
     * to know how to copy/delete values. 
     */ 
</span><a name="LN90"></a>    <a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Member'>resulttypeLen</span><span class='Delimiter'>; 
</span><a name="LN91"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>resulttypeByVal</span><span class='Delimiter'>; 
</span> 
<a name="LN93"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>plain_agg</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* is it just a plain aggregate function? */ 
</span><a name="LN94"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>aggno</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* if so, index of its PerAggData */ 
</span> 
<a name="LN96"></a>    <a href="../../include/windowapi.h.html#LN36"><span class='Ref_to_Typedef'>WindowObject</span></a> <span class='Declare_Member'>winobj</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* object used in window function API */ 
</span><a name="LN97"></a><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end WindowStatePerFuncData &raquo; </span>   <span class='Declare_Typedef'>WindowStatePerFuncData</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * For plain aggregate window functions, we also have one of these. 
 */ 
</span><a name="LN102"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>WindowStatePerAggData</span> 
<span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Oids of transition functions */ 
</span><a name="LN105"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>transfn_oid</span><span class='Delimiter'>; 
</span><a name="LN106"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>invtransfn_oid</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* may be InvalidOid */ 
</span><a name="LN107"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>finalfn_oid</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* may be InvalidOid */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * fmgr lookup data for transition functions --- only valid when 
     * corresponding oid is not InvalidOid.  Note in particular that fn_strict 
     * flags are kept here. 
     */ 
</span><a name="LN114"></a>    <a href="../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a>    <span class='Declare_Member'>transfn</span><span class='Delimiter'>; 
</span><a name="LN115"></a>    <a href="../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a>    <span class='Declare_Member'>invtransfn</span><span class='Delimiter'>; 
</span><a name="LN116"></a>    <a href="../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a>    <span class='Declare_Member'>finalfn</span><span class='Delimiter'>; 
</span> 
<a name="LN118"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>numFinalArgs</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* number of arguments to pass to finalfn */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initial value from pg_aggregate entry 
     */ 
</span><a name="LN123"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Member'>initValue</span><span class='Delimiter'>; 
</span><a name="LN124"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>initValueIsNull</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * cached value for current frame boundaries 
     */ 
</span><a name="LN129"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Member'>resultValue</span><span class='Delimiter'>; 
</span><a name="LN130"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>resultValueIsNull</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We need the len and byval info for the agg's input, result, and 
     * transition data types in order to know how to copy/delete values. 
     */ 
</span><a name="LN136"></a>    <a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Member'>inputtypeLen</span><span class='Delimiter'>, 
</span><a name="LN137"></a>                <span class='Declare_Member'>resulttypeLen</span><span class='Delimiter'>, 
</span><a name="LN138"></a>                <span class='Declare_Member'>transtypeLen</span><span class='Delimiter'>; 
</span><a name="LN139"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>inputtypeByVal</span><span class='Delimiter'>, 
</span><a name="LN140"></a>                <span class='Declare_Member'>resulttypeByVal</span><span class='Delimiter'>, 
</span><a name="LN141"></a>                <span class='Declare_Member'>transtypeByVal</span><span class='Delimiter'>; 
</span> 
<a name="LN143"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>wfuncno</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* index of associated PerFuncData */ 
</span> 
    <span class='Comment_Multi_Line'>/* Context holding transition value and possibly other subsidiary data */ 
</span><a name="LN146"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Member'>aggcontext</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* may be private, or winstate-&GT;aggcontext */ 
</span> 
    <span class='Comment_Multi_Line'>/* Current transition value */ 
</span><a name="LN149"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Member'>transValue</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* current transition value */ 
</span><a name="LN150"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>transValueIsNull</span><span class='Delimiter'>; 
</span> 
<a name="LN152"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>transValueCount</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* number of currently-aggregated rows */ 
</span> 
    <span class='Comment_Multi_Line'>/* Data local to eval_windowaggregates() */ 
</span><a name="LN155"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>restart</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* need to restart this agg in this cycle? */ 
</span><a name="LN156"></a><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end WindowStatePerAggData &raquo; </span> <span class='Declare_Typedef'>WindowStatePerAggData</span><span class='Delimiter'>; 
</span> 
<a name="LN158"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>initialize_windowaggregate</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>winstate</span><span class='Delimiter'>, 
</span><a name="LN159"></a>                           <a href="../../include/nodes/execnodes.h.html#LN1789"><span class='Ref_to_Typedef'>WindowStatePerFunc</span></a> <span class='Declare_Parameter'>perfuncstate</span><span class='Delimiter'>, 
</span><a name="LN160"></a>                           <a href="../../include/nodes/execnodes.h.html#LN1790"><span class='Ref_to_Typedef'>WindowStatePerAgg</span></a> <span class='Declare_Parameter'>peraggstate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN161"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>advance_windowaggregate</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>winstate</span><span class='Delimiter'>, 
</span><a name="LN162"></a>                        <a href="../../include/nodes/execnodes.h.html#LN1789"><span class='Ref_to_Typedef'>WindowStatePerFunc</span></a> <span class='Declare_Parameter'>perfuncstate</span><span class='Delimiter'>, 
</span><a name="LN163"></a>                        <a href="../../include/nodes/execnodes.h.html#LN1790"><span class='Ref_to_Typedef'>WindowStatePerAgg</span></a> <span class='Declare_Parameter'>peraggstate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN164"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>advance_windowaggregate_base</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>winstate</span><span class='Delimiter'>, 
</span><a name="LN165"></a>                             <a href="../../include/nodes/execnodes.h.html#LN1789"><span class='Ref_to_Typedef'>WindowStatePerFunc</span></a> <span class='Declare_Parameter'>perfuncstate</span><span class='Delimiter'>, 
</span><a name="LN166"></a>                             <a href="../../include/nodes/execnodes.h.html#LN1790"><span class='Ref_to_Typedef'>WindowStatePerAgg</span></a> <span class='Declare_Parameter'>peraggstate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN167"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>finalize_windowaggregate</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>winstate</span><span class='Delimiter'>, 
</span><a name="LN168"></a>                         <a href="../../include/nodes/execnodes.h.html#LN1789"><span class='Ref_to_Typedef'>WindowStatePerFunc</span></a> <span class='Declare_Parameter'>perfuncstate</span><span class='Delimiter'>, 
</span><a name="LN169"></a>                         <a href="../../include/nodes/execnodes.h.html#LN1790"><span class='Ref_to_Typedef'>WindowStatePerAgg</span></a> <span class='Declare_Parameter'>peraggstate</span><span class='Delimiter'>, 
</span><a name="LN170"></a>                         <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN172"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>eval_windowaggregates</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>winstate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN173"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>eval_windowfunction</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>winstate</span><span class='Delimiter'>, 
</span><a name="LN174"></a>                    <a href="../../include/nodes/execnodes.h.html#LN1789"><span class='Ref_to_Typedef'>WindowStatePerFunc</span></a> <span class='Declare_Parameter'>perfuncstate</span><span class='Delimiter'>, 
</span><a name="LN175"></a>                    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN177"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>begin_partition</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>winstate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN178"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>spool_tuples</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>winstate</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Declare_Parameter'>pos</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN179"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>release_partition</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>winstate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN181"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>row_is_in_frame</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>winstate</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Declare_Parameter'>pos</span><span class='Delimiter'>, 
</span><a name="LN182"></a>                <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN183"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>update_frameheadpos</span><span class='Parentheses'>(</span><a href="../../include/windowapi.h.html#LN36"><span class='Ref_to_Typedef'>WindowObject</span></a> <span class='Declare_Parameter'>winobj</span><span class='Delimiter'>, </span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN184"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>update_frametailpos</span><span class='Parentheses'>(</span><a href="../../include/windowapi.h.html#LN36"><span class='Ref_to_Typedef'>WindowObject</span></a> <span class='Declare_Parameter'>winobj</span><span class='Delimiter'>, </span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN186"></a><span class='Keyword'>static </span><a href="nodeWindowAgg.c.html#LN102"><span class='Ref_to_Struct'>WindowStatePerAggData</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>initialize_peragg</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>winstate</span><span class='Delimiter'>, 
</span><a name="LN187"></a>                  <a href="../../include/nodes/primnodes.h.html#LN351"><span class='Ref_to_Struct'>WindowFunc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>wfunc</span><span class='Delimiter'>, 
</span><a name="LN188"></a>                  <a href="../../include/nodes/execnodes.h.html#LN1790"><span class='Ref_to_Typedef'>WindowStatePerAgg</span></a> <span class='Declare_Parameter'>peraggstate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN189"></a><span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>GetAggInitVal</span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>textInitVal</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>transtype</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN191"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>are_peers</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>winstate</span><span class='Delimiter'>, </span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot1</span><span class='Delimiter'>, 
</span><a name="LN192"></a>          <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN193"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>window_gettupleslot</span><span class='Parentheses'>(</span><a href="../../include/windowapi.h.html#LN36"><span class='Ref_to_Typedef'>WindowObject</span></a> <span class='Declare_Parameter'>winobj</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Declare_Parameter'>pos</span><span class='Delimiter'>, 
</span><a name="LN194"></a>                    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * initialize_windowaggregate 
 * parallel to initialize_aggregates in nodeAgg.c 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN202"></a><span class='Declare_Function'>initialize_windowaggregate</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>winstate</span><span class='Delimiter'>, 
</span><a name="LN203"></a>                           <a href="../../include/nodes/execnodes.h.html#LN1789"><span class='Ref_to_Typedef'>WindowStatePerFunc</span></a> <span class='Declare_Parameter'>perfuncstate</span><span class='Delimiter'>, 
</span><a name="LN204"></a>                           <a href="../../include/nodes/execnodes.h.html#LN1790"><span class='Ref_to_Typedef'>WindowStatePerAgg</span></a> <span class='Declare_Parameter'>peraggstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN206"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldContext</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we're using a private aggcontext, we may reset it here.  But if the 
     * context is shared, we don't know which other aggregates may still need 
     * it, so we must leave it to the caller to reset at an appropriate time. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN204"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN146"><span class='Ref_to_Member'>aggcontext</span></a> <span class='Operator'>!= </span><a href="nodeWindowAgg.c.html#LN202"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1824"><span class='Ref_to_Member'>aggcontext</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/memutils.h.html#LN66"><span class='Ref_to_Macro'>MemoryContextResetAndDeleteChildren</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN204"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN146"><span class='Ref_to_Member'>aggcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN204"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN124"><span class='Ref_to_Member'>initValueIsNull</span></a><span class='Parentheses'>) 
</span>        <a href="nodeWindowAgg.c.html#LN204"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN149"><span class='Ref_to_Member'>transValue</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN204"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN123"><span class='Ref_to_Member'>initValue</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="nodeWindowAgg.c.html#LN206"><span class='Ref_To_Local'>oldContext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN204"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN146"><span class='Ref_to_Member'>aggcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN204"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN149"><span class='Ref_to_Member'>transValue</span></a> <span class='Operator'>= </span><a href="../../include/utils/datum.h.html#LN30"><span class='Ref_to_Proto'>datumCopy</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN204"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN123"><span class='Ref_to_Member'>initValue</span></a><span class='Delimiter'>, 
</span>                                            <a href="nodeWindowAgg.c.html#LN204"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN141"><span class='Ref_to_Member'>transtypeByVal</span></a><span class='Delimiter'>, 
</span>                                            <a href="nodeWindowAgg.c.html#LN204"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN138"><span class='Ref_to_Member'>transtypeLen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN206"><span class='Ref_To_Local'>oldContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="nodeWindowAgg.c.html#LN204"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN150"><span class='Ref_to_Member'>transValueIsNull</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN204"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN124"><span class='Ref_to_Member'>initValueIsNull</span></a><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN204"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN152"><span class='Ref_to_Member'>transValueCount</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN204"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN129"><span class='Ref_to_Member'>resultValue</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN204"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN130"><span class='Ref_to_Member'>resultValueIsNull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end initialize_windowaggregate &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * advance_windowaggregate 
 * parallel to advance_aggregates in nodeAgg.c 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN237"></a><span class='Declare_Function'>advance_windowaggregate</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>winstate</span><span class='Delimiter'>, 
</span><a name="LN238"></a>                        <a href="../../include/nodes/execnodes.h.html#LN1789"><span class='Ref_to_Typedef'>WindowStatePerFunc</span></a> <span class='Declare_Parameter'>perfuncstate</span><span class='Delimiter'>, 
</span><a name="LN239"></a>                        <a href="../../include/nodes/execnodes.h.html#LN1790"><span class='Ref_to_Typedef'>WindowStatePerAgg</span></a> <span class='Declare_Parameter'>peraggstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN241"></a>    <a href="../../include/nodes/execnodes.h.html#LN641"><span class='Ref_to_Struct'>WindowFuncExprState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>wfuncstate</span> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN238"><span class='Ref_to_Parameter'>perfuncstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN77"><span class='Ref_to_Member'>wfuncstate</span></a><span class='Delimiter'>; 
</span><a name="LN242"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numArguments</span> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN238"><span class='Ref_to_Parameter'>perfuncstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN80"><span class='Ref_to_Member'>numArguments</span></a><span class='Delimiter'>; 
</span><a name="LN243"></a>    <a href="../../include/fmgr.h.html#LN76"><span class='Ref_to_Struct'>FunctionCallInfoData</span></a> <span class='Declare_Local'>fcinfodata</span><span class='Delimiter'>; 
</span><a name="LN244"></a>    <a href="../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Local'>fcinfo</span> <span class='Operator'>= &</span><a href="nodeWindowAgg.c.html#LN243"><span class='Ref_To_Local'>fcinfodata</span></a><span class='Delimiter'>; 
</span><a name="LN245"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>newVal</span><span class='Delimiter'>; 
</span><a name="LN246"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>arg</span><span class='Delimiter'>; 
</span><a name="LN247"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN248"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldContext</span><span class='Delimiter'>; 
</span><a name="LN249"></a>    <a href="../../include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>econtext</span> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN237"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1826"><span class='Ref_to_Member'>tmpcontext</span></a><span class='Delimiter'>; 
</span><a name="LN250"></a>    <a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>filter</span> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN241"><span class='Ref_To_Local'>wfuncstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN646"><span class='Ref_to_Member'>aggfilter</span></a><span class='Delimiter'>; 
</span> 
    <a href="nodeWindowAgg.c.html#LN248"><span class='Ref_To_Local'>oldContext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN249"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN202"><span class='Ref_to_Member'>ecxt_per_tuple_memory</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Skip anything FILTERed out */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN250"><span class='Ref_To_Local'>filter</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN257"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN258"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>res</span> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN264"><span class='Ref_to_Func'>ExecEvalExpr</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN250"><span class='Ref_To_Local'>filter</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN249"><span class='Ref_To_Local'>econtext</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN257"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN257"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>|| !</span><a href="../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN258"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN248"><span class='Ref_To_Local'>oldContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* We start from 1, since the 0th arg will be the transition value */ 
</span>    <a href="nodeWindowAgg.c.html#LN247"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN246"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN241"><span class='Ref_To_Local'>wfuncstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN645"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN271"></a>        <a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>argstate</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN246"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="nodeWindowAgg.c.html#LN244"><span class='Ref_To_Local'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/fmgr.h.html#LN84"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>[</span><a href="nodeWindowAgg.c.html#LN247"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN264"><span class='Ref_to_Func'>ExecEvalExpr</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN271"><span class='Ref_To_Local'>argstate</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN249"><span class='Ref_To_Local'>econtext</span></a><span class='Delimiter'>, 
</span>                                      <span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN244"><span class='Ref_To_Local'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/fmgr.h.html#LN85"><span class='Ref_to_Member'>argnull</span></a><span class='Delimiter'>[</span><a href="nodeWindowAgg.c.html#LN247"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN247"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN239"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN114"><span class='Ref_to_Member'>transfn</span></a><span class='Operator'>.</span><a href="../../include/fmgr.h.html#LN60"><span class='Ref_to_Member'>fn_strict</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * For a strict transfn, nothing happens when there's a NULL input; we 
         * just keep the prior transValue.  Note transValueCount doesn't 
         * change either. 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN247"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="nodeWindowAgg.c.html#LN247"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="nodeWindowAgg.c.html#LN242"><span class='Ref_To_Local'>numArguments</span></a><span class='Delimiter'>; </span><a href="nodeWindowAgg.c.html#LN247"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN244"><span class='Ref_To_Local'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/fmgr.h.html#LN85"><span class='Ref_to_Member'>argnull</span></a><span class='Delimiter'>[</span><a href="nodeWindowAgg.c.html#LN247"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN248"><span class='Ref_To_Local'>oldContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * For strict transition functions with initial value NULL we use the 
         * first non-NULL input as the initial state.  (We already checked 
         * that the agg's input type is binary-compatible with its transtype, 
         * so straight copy here is OK.) 
         * 
         * We must copy the datum into aggcontext if it is pass-by-ref.  We do 
         * not need to pfree the old transValue, since it's NULL. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN239"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN152"><span class='Ref_to_Member'>transValueCount</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="nodeWindowAgg.c.html#LN239"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN150"><span class='Ref_to_Member'>transValueIsNull</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN239"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN146"><span class='Ref_to_Member'>aggcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="nodeWindowAgg.c.html#LN239"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN149"><span class='Ref_to_Member'>transValue</span></a> <span class='Operator'>= </span><a href="../../include/utils/datum.h.html#LN30"><span class='Ref_to_Proto'>datumCopy</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN244"><span class='Ref_To_Local'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/fmgr.h.html#LN84"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                                                <a href="nodeWindowAgg.c.html#LN239"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN141"><span class='Ref_to_Member'>transtypeByVal</span></a><span class='Delimiter'>, 
</span>                                                <a href="nodeWindowAgg.c.html#LN239"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN138"><span class='Ref_to_Member'>transtypeLen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="nodeWindowAgg.c.html#LN239"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN150"><span class='Ref_to_Member'>transValueIsNull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="nodeWindowAgg.c.html#LN239"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN152"><span class='Ref_to_Member'>transValueCount</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN248"><span class='Ref_To_Local'>oldContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN239"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN150"><span class='Ref_to_Member'>transValueIsNull</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Don't call a strict function with NULL inputs.  Note it is 
             * possible to get here despite the above tests, if the transfn is 
             * strict *and* returned a NULL on a prior cycle.  If that happens 
             * we will propagate the NULL all the way to the end.  That can 
             * only happen if there's no inverse transition function, though, 
             * since we disallow transitions back to NULL when there is one. 
             */ 
</span>            <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN248"><span class='Ref_To_Local'>oldContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN239"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN106"><span class='Ref_to_Member'>invtransfn_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if peraggstate-&GT;transfn.... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * OK to call the transition function.  Set winstate-&GT;curaggcontext while 
     * calling it, for possible use by AggCheckCallContext. 
     */ 
</span>    <a href="../../include/fmgr.h.html#LN119"><span class='Ref_to_Macro'>InitFunctionCallInfoData</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="nodeWindowAgg.c.html#LN244"><span class='Ref_To_Local'>fcinfo</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN239"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN114"><span class='Ref_to_Member'>transfn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="nodeWindowAgg.c.html#LN242"><span class='Ref_To_Local'>numArguments</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                             <a href="nodeWindowAgg.c.html#LN238"><span class='Ref_to_Parameter'>perfuncstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN84"><span class='Ref_to_Member'>winCollation</span></a><span class='Delimiter'>, 
</span>                             <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeWindowAgg.c.html#LN237"><span class='Ref_to_Parameter'>winstate</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN244"><span class='Ref_To_Local'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/fmgr.h.html#LN84"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN239"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN149"><span class='Ref_to_Member'>transValue</span></a><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN244"><span class='Ref_To_Local'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/fmgr.h.html#LN85"><span class='Ref_to_Member'>argnull</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN239"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN150"><span class='Ref_to_Member'>transValueIsNull</span></a><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN237"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1825"><span class='Ref_to_Member'>curaggcontext</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN239"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN146"><span class='Ref_to_Member'>aggcontext</span></a><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN245"><span class='Ref_To_Local'>newVal</span></a> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN136"><span class='Ref_to_Macro'>FunctionCallInvoke</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN244"><span class='Ref_To_Local'>fcinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN237"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1825"><span class='Ref_to_Member'>curaggcontext</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Moving-aggregate transition functions must not return null, see 
     * advance_windowaggregate_base(). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN244"><span class='Ref_To_Local'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/fmgr.h.html#LN82"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>&& </span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN239"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN106"><span class='Ref_to_Member'>invtransfn_oid</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"moving-aggregate transition function must not return null"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We must track the number of rows included in transValue, since to 
     * remove the last input, advance_windowaggregate_base() mustn't call the 
     * inverse transition function, but simply reset transValue back to its 
     * initial value. 
     */ 
</span>    <a href="nodeWindowAgg.c.html#LN239"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN152"><span class='Ref_to_Member'>transValueCount</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If pass-by-ref datatype, must copy the new value into aggcontext and 
     * free the prior transValue.  But if transfn returned a pointer to its 
     * first input, we don't need to do anything.  Also, if transfn returned a 
     * pointer to a R/W expanded object that is already a child of the 
     * aggcontext, assume we can adopt that value without copying it. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeWindowAgg.c.html#LN239"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN141"><span class='Ref_to_Member'>transtypeByVal</span></a> <span class='Operator'>&& 
</span>        <a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN245"><span class='Ref_To_Local'>newVal</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN239"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN149"><span class='Ref_to_Member'>transValue</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeWindowAgg.c.html#LN244"><span class='Ref_To_Local'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/fmgr.h.html#LN82"><span class='Ref_to_Member'>isnull</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN239"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN146"><span class='Ref_to_Member'>aggcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/expandeddatum.h.html#LN139"><span class='Ref_to_Macro'>DatumIsReadWriteExpandedObject</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN245"><span class='Ref_To_Local'>newVal</span></a><span class='Delimiter'>, 
</span>                                               <span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                               <a href="nodeWindowAgg.c.html#LN239"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN138"><span class='Ref_to_Member'>transtypeLen</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>                <a href="../../include/utils/memutils.h.html#LN81"><span class='Ref_to_Proto'>MemoryContextGetParent</span></a><span class='Parentheses'>(</span><a href="../utils/adt/expandeddatum.c.html#LN27"><span class='Ref_to_Func'>DatumGetEOHP</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN245"><span class='Ref_To_Local'>newVal</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="../../include/utils/expandeddatum.h.html#LN106"><span class='Ref_to_Member'>eoh_context</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><a href="../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Parentheses'>)</span> 
                 <span class='Comment_Multi_Line'>/* do nothing */ </span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="nodeWindowAgg.c.html#LN245"><span class='Ref_To_Local'>newVal</span></a> <span class='Operator'>= </span><a href="../../include/utils/datum.h.html#LN30"><span class='Ref_to_Proto'>datumCopy</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN245"><span class='Ref_To_Local'>newVal</span></a><span class='Delimiter'>, 
</span>                                   <a href="nodeWindowAgg.c.html#LN239"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN141"><span class='Ref_to_Member'>transtypeByVal</span></a><span class='Delimiter'>, 
</span>                                   <a href="nodeWindowAgg.c.html#LN239"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN138"><span class='Ref_to_Member'>transtypeLen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeWindowAgg.c.html#LN239"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN150"><span class='Ref_to_Member'>transValueIsNull</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/expandeddatum.h.html#LN139"><span class='Ref_to_Macro'>DatumIsReadWriteExpandedObject</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN239"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN149"><span class='Ref_to_Member'>transValue</span></a><span class='Delimiter'>, 
</span>                                               <span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                               <a href="nodeWindowAgg.c.html#LN239"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN138"><span class='Ref_to_Member'>transtypeLen</span></a><span class='Parentheses'>))</span> 
                <a href="../utils/adt/expandeddatum.c.html#LN134"><span class='Ref_to_Func'>DeleteExpandedObject</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN239"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN149"><span class='Ref_to_Member'>transValue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN239"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN149"><span class='Ref_to_Member'>transValue</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !peraggstate-&GT;transty... &raquo; </span> 
 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN248"><span class='Ref_To_Local'>oldContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN239"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN149"><span class='Ref_to_Member'>transValue</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN245"><span class='Ref_To_Local'>newVal</span></a><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN239"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN150"><span class='Ref_to_Member'>transValueIsNull</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN244"><span class='Ref_To_Local'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/fmgr.h.html#LN82"><span class='Ref_to_Member'>isnull</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end advance_windowaggregate &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * advance_windowaggregate_base 
 * Remove the oldest tuple from an aggregation. 
 * 
 * This is very much like advance_windowaggregate, except that we will call 
 * the inverse transition function (which caller must have checked is 
 * available). 
 * 
 * Returns true if we successfully removed the current row from this 
 * aggregate, false if not (in the latter case, caller is responsible 
 * for cleaning up by restarting the aggregation). 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN414"></a><span class='Declare_Function'>advance_windowaggregate_base</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>winstate</span><span class='Delimiter'>, 
</span><a name="LN415"></a>                             <a href="../../include/nodes/execnodes.h.html#LN1789"><span class='Ref_to_Typedef'>WindowStatePerFunc</span></a> <span class='Declare_Parameter'>perfuncstate</span><span class='Delimiter'>, 
</span><a name="LN416"></a>                             <a href="../../include/nodes/execnodes.h.html#LN1790"><span class='Ref_to_Typedef'>WindowStatePerAgg</span></a> <span class='Declare_Parameter'>peraggstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN418"></a>    <a href="../../include/nodes/execnodes.h.html#LN641"><span class='Ref_to_Struct'>WindowFuncExprState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>wfuncstate</span> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN415"><span class='Ref_to_Parameter'>perfuncstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN77"><span class='Ref_to_Member'>wfuncstate</span></a><span class='Delimiter'>; 
</span><a name="LN419"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numArguments</span> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN415"><span class='Ref_to_Parameter'>perfuncstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN80"><span class='Ref_to_Member'>numArguments</span></a><span class='Delimiter'>; 
</span><a name="LN420"></a>    <a href="../../include/fmgr.h.html#LN76"><span class='Ref_to_Struct'>FunctionCallInfoData</span></a> <span class='Declare_Local'>fcinfodata</span><span class='Delimiter'>; 
</span><a name="LN421"></a>    <a href="../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Local'>fcinfo</span> <span class='Operator'>= &</span><a href="nodeWindowAgg.c.html#LN420"><span class='Ref_To_Local'>fcinfodata</span></a><span class='Delimiter'>; 
</span><a name="LN422"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>newVal</span><span class='Delimiter'>; 
</span><a name="LN423"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>arg</span><span class='Delimiter'>; 
</span><a name="LN424"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN425"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldContext</span><span class='Delimiter'>; 
</span><a name="LN426"></a>    <a href="../../include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>econtext</span> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN414"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1826"><span class='Ref_to_Member'>tmpcontext</span></a><span class='Delimiter'>; 
</span><a name="LN427"></a>    <a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>filter</span> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN418"><span class='Ref_To_Local'>wfuncstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN646"><span class='Ref_to_Member'>aggfilter</span></a><span class='Delimiter'>; 
</span> 
    <a href="nodeWindowAgg.c.html#LN425"><span class='Ref_To_Local'>oldContext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN426"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN202"><span class='Ref_to_Member'>ecxt_per_tuple_memory</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Skip anything FILTERed out */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN427"><span class='Ref_To_Local'>filter</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN434"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN435"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>res</span> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN264"><span class='Ref_to_Func'>ExecEvalExpr</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN427"><span class='Ref_To_Local'>filter</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN426"><span class='Ref_To_Local'>econtext</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN434"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN434"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>|| !</span><a href="../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN435"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN425"><span class='Ref_To_Local'>oldContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* We start from 1, since the 0th arg will be the transition value */ 
</span>    <a href="nodeWindowAgg.c.html#LN424"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN423"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN418"><span class='Ref_To_Local'>wfuncstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN645"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN448"></a>        <a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>argstate</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN423"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="nodeWindowAgg.c.html#LN421"><span class='Ref_To_Local'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/fmgr.h.html#LN84"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>[</span><a href="nodeWindowAgg.c.html#LN424"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN264"><span class='Ref_to_Func'>ExecEvalExpr</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN448"><span class='Ref_To_Local'>argstate</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN426"><span class='Ref_To_Local'>econtext</span></a><span class='Delimiter'>, 
</span>                                      <span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN421"><span class='Ref_To_Local'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/fmgr.h.html#LN85"><span class='Ref_to_Member'>argnull</span></a><span class='Delimiter'>[</span><a href="nodeWindowAgg.c.html#LN424"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN424"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN416"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN115"><span class='Ref_to_Member'>invtransfn</span></a><span class='Operator'>.</span><a href="../../include/fmgr.h.html#LN60"><span class='Ref_to_Member'>fn_strict</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * For a strict (inv)transfn, nothing happens when there's a NULL 
         * input; we just keep the prior transValue.  Note transValueCount 
         * doesn't change either. 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN424"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="nodeWindowAgg.c.html#LN424"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="nodeWindowAgg.c.html#LN419"><span class='Ref_To_Local'>numArguments</span></a><span class='Delimiter'>; </span><a href="nodeWindowAgg.c.html#LN424"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN421"><span class='Ref_To_Local'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/fmgr.h.html#LN85"><span class='Ref_to_Member'>argnull</span></a><span class='Delimiter'>[</span><a href="nodeWindowAgg.c.html#LN424"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN425"><span class='Ref_To_Local'>oldContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* There should still be an added but not yet removed value */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN416"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN152"><span class='Ref_to_Member'>transValueCount</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * In moving-aggregate mode, the state must never be NULL, except possibly 
     * before any rows have been aggregated (which is surely not the case at 
     * this point).  This restriction allows us to interpret a NULL result 
     * from the inverse function as meaning "sorry, can't do an inverse 
     * transition in this case".  We already checked this in 
     * advance_windowaggregate, but just for safety, check again. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN416"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN150"><span class='Ref_to_Member'>transValueIsNull</span></a><span class='Parentheses'>) 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"aggregate transition value is NULL before inverse transition"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We mustn't use the inverse transition function to remove the last 
     * input.  Doing so would yield a non-NULL state, whereas we should be in 
     * the initial state afterwards which may very well be NULL.  So instead, 
     * we simply re-initialize the aggregate in this case. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN416"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN152"><span class='Ref_to_Member'>transValueCount</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN425"><span class='Ref_To_Local'>oldContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN158"><span class='Ref_to_Proto'>initialize_windowaggregate</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN414"><span class='Ref_to_Parameter'>winstate</span></a><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN414"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1801"><span class='Ref_to_Member'>perfunc</span></a><span class='Delimiter'>[</span><a href="nodeWindowAgg.c.html#LN416"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN143"><span class='Ref_to_Member'>wfuncno</span></a><span class='Delimiter'>], 
</span>                                   <a href="nodeWindowAgg.c.html#LN416"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * OK to call the inverse transition function.  Set 
     * winstate-&GT;curaggcontext while calling it, for possible use by 
     * AggCheckCallContext. 
     */ 
</span>    <a href="../../include/fmgr.h.html#LN119"><span class='Ref_to_Macro'>InitFunctionCallInfoData</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="nodeWindowAgg.c.html#LN421"><span class='Ref_To_Local'>fcinfo</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN416"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN115"><span class='Ref_to_Member'>invtransfn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="nodeWindowAgg.c.html#LN419"><span class='Ref_To_Local'>numArguments</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                             <a href="nodeWindowAgg.c.html#LN415"><span class='Ref_to_Parameter'>perfuncstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN84"><span class='Ref_to_Member'>winCollation</span></a><span class='Delimiter'>, 
</span>                             <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeWindowAgg.c.html#LN414"><span class='Ref_to_Parameter'>winstate</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN421"><span class='Ref_To_Local'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/fmgr.h.html#LN84"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN416"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN149"><span class='Ref_to_Member'>transValue</span></a><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN421"><span class='Ref_To_Local'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/fmgr.h.html#LN85"><span class='Ref_to_Member'>argnull</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN416"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN150"><span class='Ref_to_Member'>transValueIsNull</span></a><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN414"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1825"><span class='Ref_to_Member'>curaggcontext</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN416"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN146"><span class='Ref_to_Member'>aggcontext</span></a><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN422"><span class='Ref_To_Local'>newVal</span></a> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN136"><span class='Ref_to_Macro'>FunctionCallInvoke</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN421"><span class='Ref_To_Local'>fcinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN414"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1825"><span class='Ref_to_Member'>curaggcontext</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the function returns NULL, report failure, forcing a restart. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN421"><span class='Ref_To_Local'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/fmgr.h.html#LN82"><span class='Ref_to_Member'>isnull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN425"><span class='Ref_To_Local'>oldContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Update number of rows included in transValue */ 
</span>    <a href="nodeWindowAgg.c.html#LN416"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN152"><span class='Ref_to_Member'>transValueCount</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If pass-by-ref datatype, must copy the new value into aggcontext and 
     * free the prior transValue.  But if invtransfn returned a pointer to its 
     * first input, we don't need to do anything.  Also, if invtransfn 
     * returned a pointer to a R/W expanded object that is already a child of 
     * the aggcontext, assume we can adopt that value without copying it. 
     * 
     * Note: the checks for null values here will never fire, but it seems 
     * best to have this stanza look just like advance_windowaggregate. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeWindowAgg.c.html#LN416"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN141"><span class='Ref_to_Member'>transtypeByVal</span></a> <span class='Operator'>&& 
</span>        <a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN422"><span class='Ref_To_Local'>newVal</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN416"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN149"><span class='Ref_to_Member'>transValue</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeWindowAgg.c.html#LN421"><span class='Ref_To_Local'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/fmgr.h.html#LN82"><span class='Ref_to_Member'>isnull</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN416"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN146"><span class='Ref_to_Member'>aggcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/expandeddatum.h.html#LN139"><span class='Ref_to_Macro'>DatumIsReadWriteExpandedObject</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN422"><span class='Ref_To_Local'>newVal</span></a><span class='Delimiter'>, 
</span>                                               <span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                               <a href="nodeWindowAgg.c.html#LN416"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN138"><span class='Ref_to_Member'>transtypeLen</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>                <a href="../../include/utils/memutils.h.html#LN81"><span class='Ref_to_Proto'>MemoryContextGetParent</span></a><span class='Parentheses'>(</span><a href="../utils/adt/expandeddatum.c.html#LN27"><span class='Ref_to_Func'>DatumGetEOHP</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN422"><span class='Ref_To_Local'>newVal</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="../../include/utils/expandeddatum.h.html#LN106"><span class='Ref_to_Member'>eoh_context</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><a href="../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Parentheses'>)</span> 
                 <span class='Comment_Multi_Line'>/* do nothing */ </span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="nodeWindowAgg.c.html#LN422"><span class='Ref_To_Local'>newVal</span></a> <span class='Operator'>= </span><a href="../../include/utils/datum.h.html#LN30"><span class='Ref_to_Proto'>datumCopy</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN422"><span class='Ref_To_Local'>newVal</span></a><span class='Delimiter'>, 
</span>                                   <a href="nodeWindowAgg.c.html#LN416"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN141"><span class='Ref_to_Member'>transtypeByVal</span></a><span class='Delimiter'>, 
</span>                                   <a href="nodeWindowAgg.c.html#LN416"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN138"><span class='Ref_to_Member'>transtypeLen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeWindowAgg.c.html#LN416"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN150"><span class='Ref_to_Member'>transValueIsNull</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/expandeddatum.h.html#LN139"><span class='Ref_to_Macro'>DatumIsReadWriteExpandedObject</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN416"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN149"><span class='Ref_to_Member'>transValue</span></a><span class='Delimiter'>, 
</span>                                               <span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                               <a href="nodeWindowAgg.c.html#LN416"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN138"><span class='Ref_to_Member'>transtypeLen</span></a><span class='Parentheses'>))</span> 
                <a href="../utils/adt/expandeddatum.c.html#LN134"><span class='Ref_to_Func'>DeleteExpandedObject</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN416"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN149"><span class='Ref_to_Member'>transValue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN416"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN149"><span class='Ref_to_Member'>transValue</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !peraggstate-&GT;transty... &raquo; </span> 
 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN425"><span class='Ref_To_Local'>oldContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN416"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN149"><span class='Ref_to_Member'>transValue</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN422"><span class='Ref_To_Local'>newVal</span></a><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN416"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN150"><span class='Ref_to_Member'>transValueIsNull</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN421"><span class='Ref_To_Local'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/fmgr.h.html#LN82"><span class='Ref_to_Member'>isnull</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end advance_windowaggregate_base &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * finalize_windowaggregate 
 * parallel to finalize_aggregate in nodeAgg.c 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN577"></a><span class='Declare_Function'>finalize_windowaggregate</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>winstate</span><span class='Delimiter'>, 
</span><a name="LN578"></a>                         <a href="../../include/nodes/execnodes.h.html#LN1789"><span class='Ref_to_Typedef'>WindowStatePerFunc</span></a> <span class='Declare_Parameter'>perfuncstate</span><span class='Delimiter'>, 
</span><a name="LN579"></a>                         <a href="../../include/nodes/execnodes.h.html#LN1790"><span class='Ref_to_Typedef'>WindowStatePerAgg</span></a> <span class='Declare_Parameter'>peraggstate</span><span class='Delimiter'>, 
</span><a name="LN580"></a>                         <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN582"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldContext</span><span class='Delimiter'>; 
</span> 
    <a href="nodeWindowAgg.c.html#LN582"><span class='Ref_To_Local'>oldContext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN577"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN842"><span class='Ref_to_Member'>ps_ExprContext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN202"><span class='Ref_to_Member'>ecxt_per_tuple_memory</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Apply the agg's finalfn if one is provided, else return transValue. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN579"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN107"><span class='Ref_to_Member'>finalfn_oid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN591"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>numFinalArgs</span> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN579"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN118"><span class='Ref_to_Member'>numFinalArgs</span></a><span class='Delimiter'>; 
</span><a name="LN592"></a>        <a href="../../include/fmgr.h.html#LN76"><span class='Ref_to_Struct'>FunctionCallInfoData</span></a> <span class='Declare_Local'>fcinfo</span><span class='Delimiter'>; 
</span><a name="LN593"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>anynull</span><span class='Delimiter'>; 
</span><a name="LN594"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/fmgr.h.html#LN119"><span class='Ref_to_Macro'>InitFunctionCallInfoData</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN592"><span class='Ref_To_Local'>fcinfo</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN579"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN116"><span class='Ref_to_Member'>finalfn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="nodeWindowAgg.c.html#LN591"><span class='Ref_To_Local'>numFinalArgs</span></a><span class='Delimiter'>, 
</span>                                 <a href="nodeWindowAgg.c.html#LN578"><span class='Ref_to_Parameter'>perfuncstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN84"><span class='Ref_to_Member'>winCollation</span></a><span class='Delimiter'>, 
</span>                                 <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeWindowAgg.c.html#LN577"><span class='Ref_to_Parameter'>winstate</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN592"><span class='Ref_To_Local'>fcinfo</span></a><span class='Operator'>.</span><a href="../../include/fmgr.h.html#LN84"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/expandeddatum.h.html#LN143"><span class='Ref_to_Macro'>MakeExpandedObjectReadOnly</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN579"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN149"><span class='Ref_to_Member'>transValue</span></a><span class='Delimiter'>, 
</span>                                               <a href="nodeWindowAgg.c.html#LN579"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN150"><span class='Ref_to_Member'>transValueIsNull</span></a><span class='Delimiter'>, 
</span>                                                   <a href="nodeWindowAgg.c.html#LN579"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN138"><span class='Ref_to_Member'>transtypeLen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN592"><span class='Ref_To_Local'>fcinfo</span></a><span class='Operator'>.</span><a href="../../include/fmgr.h.html#LN85"><span class='Ref_to_Member'>argnull</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN579"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN150"><span class='Ref_to_Member'>transValueIsNull</span></a><span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN593"><span class='Ref_To_Local'>anynull</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN579"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN150"><span class='Ref_to_Member'>transValueIsNull</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Fill any remaining argument positions with nulls */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN594"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="nodeWindowAgg.c.html#LN594"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="nodeWindowAgg.c.html#LN591"><span class='Ref_To_Local'>numFinalArgs</span></a><span class='Delimiter'>; </span><a href="nodeWindowAgg.c.html#LN594"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="nodeWindowAgg.c.html#LN592"><span class='Ref_To_Local'>fcinfo</span></a><span class='Operator'>.</span><a href="../../include/fmgr.h.html#LN84"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>[</span><a href="nodeWindowAgg.c.html#LN594"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="nodeWindowAgg.c.html#LN592"><span class='Ref_To_Local'>fcinfo</span></a><span class='Operator'>.</span><a href="../../include/fmgr.h.html#LN85"><span class='Ref_to_Member'>argnull</span></a><span class='Delimiter'>[</span><a href="nodeWindowAgg.c.html#LN594"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="nodeWindowAgg.c.html#LN593"><span class='Ref_To_Local'>anynull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN592"><span class='Ref_To_Local'>fcinfo</span></a><span class='Operator'>.</span><a href="../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/fmgr.h.html#LN60"><span class='Ref_to_Member'>fn_strict</span></a> <span class='Operator'>&& </span><a href="nodeWindowAgg.c.html#LN593"><span class='Ref_To_Local'>anynull</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* don't call a strict function with NULL inputs */ 
</span>            <span class='Operator'>*</span><a href="nodeWindowAgg.c.html#LN580"><span class='Ref_to_Parameter'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="nodeWindowAgg.c.html#LN580"><span class='Ref_to_Parameter'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="nodeWindowAgg.c.html#LN577"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1825"><span class='Ref_to_Member'>curaggcontext</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN579"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN146"><span class='Ref_to_Member'>aggcontext</span></a><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="nodeWindowAgg.c.html#LN580"><span class='Ref_to_Parameter'>result</span></a> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN136"><span class='Ref_to_Macro'>FunctionCallInvoke</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN592"><span class='Ref_To_Local'>fcinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="nodeWindowAgg.c.html#LN577"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1825"><span class='Ref_to_Member'>curaggcontext</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="nodeWindowAgg.c.html#LN580"><span class='Ref_to_Parameter'>isnull</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN592"><span class='Ref_To_Local'>fcinfo</span></a><span class='Operator'>.</span><a href="../../include/fmgr.h.html#LN82"><span class='Ref_to_Member'>isnull</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if OidIsValid(peraggstat... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Don't need MakeExpandedObjectReadOnly; datumCopy will copy it */ 
</span>        <span class='Operator'>*</span><a href="nodeWindowAgg.c.html#LN580"><span class='Ref_to_Parameter'>result</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN579"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN149"><span class='Ref_to_Member'>transValue</span></a><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="nodeWindowAgg.c.html#LN580"><span class='Ref_to_Parameter'>isnull</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN579"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN150"><span class='Ref_to_Member'>transValueIsNull</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If result is pass-by-ref, make sure it is in the right context. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeWindowAgg.c.html#LN579"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN140"><span class='Ref_to_Member'>resulttypeByVal</span></a> <span class='Operator'>&& !*</span><a href="nodeWindowAgg.c.html#LN580"><span class='Ref_to_Parameter'>isnull</span></a> <span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="../../include/utils/memutils.h.html#LN91"><span class='Ref_to_Proto'>MemoryContextContains</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, 
</span>                               <a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="nodeWindowAgg.c.html#LN580"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)))</span> 
        <span class='Operator'>*</span><a href="nodeWindowAgg.c.html#LN580"><span class='Ref_to_Parameter'>result</span></a> <span class='Operator'>= </span><a href="../../include/utils/datum.h.html#LN30"><span class='Ref_to_Proto'>datumCopy</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="nodeWindowAgg.c.html#LN580"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, 
</span>                            <a href="nodeWindowAgg.c.html#LN579"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN140"><span class='Ref_to_Member'>resulttypeByVal</span></a><span class='Delimiter'>, 
</span>                            <a href="nodeWindowAgg.c.html#LN579"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN137"><span class='Ref_to_Member'>resulttypeLen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN582"><span class='Ref_To_Local'>oldContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end finalize_windowaggregate &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * eval_windowaggregates 
 * evaluate plain aggregates being used as window functions 
 * 
 * This differs from nodeAgg.c in two ways.  First, if the window's frame 
 * start position moves, we use the inverse transition function (if it exists) 
 * to remove rows from the transition value.  And second, we expect to be 
 * able to call aggregate final functions repeatedly after aggregating more 
 * data onto the same transition value.  This is not a behavior required by 
 * nodeAgg.c. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN659"></a><span class='Declare_Function'>eval_windowaggregates</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>winstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN661"></a>    <a href="../../include/nodes/execnodes.h.html#LN1790"><span class='Ref_to_Typedef'>WindowStatePerAgg</span></a> <span class='Declare_Local'>peraggstate</span><span class='Delimiter'>; 
</span><a name="LN662"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>wfuncno</span><span class='Delimiter'>, 
</span><a name="LN663"></a>                <span class='Declare_Local'>numaggs</span><span class='Delimiter'>, 
</span><a name="LN664"></a>                <span class='Declare_Local'>numaggs_restart</span><span class='Delimiter'>, 
</span><a name="LN665"></a>                <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN666"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>aggregatedupto_nonrestarted</span><span class='Delimiter'>; 
</span><a name="LN667"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldContext</span><span class='Delimiter'>; 
</span><a name="LN668"></a>    <a href="../../include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>econtext</span><span class='Delimiter'>; 
</span><a name="LN669"></a>    <a href="../../include/windowapi.h.html#LN36"><span class='Ref_to_Typedef'>WindowObject</span></a> <span class='Declare_Local'>agg_winobj</span><span class='Delimiter'>; 
</span><a name="LN670"></a>    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>agg_row_slot</span><span class='Delimiter'>; 
</span><a name="LN671"></a>    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>temp_slot</span><span class='Delimiter'>; 
</span> 
    <a href="nodeWindowAgg.c.html#LN663"><span class='Ref_To_Local'>numaggs</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1799"><span class='Ref_to_Member'>numaggs</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN663"><span class='Ref_To_Local'>numaggs</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>;</span>                 <span class='Comment_Single_Line'>/* nothing to do */ 
</span> 
    <span class='Comment_Multi_Line'>/* final output execution is in ps_ExprContext */ 
</span>    <a href="nodeWindowAgg.c.html#LN668"><span class='Ref_To_Local'>econtext</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN842"><span class='Ref_to_Member'>ps_ExprContext</span></a><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN669"><span class='Ref_To_Local'>agg_winobj</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1812"><span class='Ref_to_Member'>agg_winobj</span></a><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN670"><span class='Ref_To_Local'>agg_row_slot</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1844"><span class='Ref_to_Member'>agg_row_slot</span></a><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN671"><span class='Ref_To_Local'>temp_slot</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1845"><span class='Ref_to_Member'>temp_slot_1</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Currently, we support only a subset of the SQL-standard window framing 
     * rules. 
     * 
     * If the frame start is UNBOUNDED_PRECEDING, the window frame consists of 
     * a contiguous group of rows extending forward from the start of the 
     * partition, and rows only enter the frame, never exit it, as the current 
     * row advances forward.  This makes it possible to use an incremental 
     * strategy for evaluating aggregates: we run the transition function for 
     * each row added to the frame, and run the final function whenever we 
     * need the current aggregate value.  This is considerably more efficient 
     * than the naive approach of re-running the entire aggregate calculation 
     * for each current row.  It does assume that the final function doesn't 
     * damage the running transition value, but we have the same assumption in 
     * nodeAgg.c too (when it rescans an existing hash table). 
     * 
     * If the frame start does sometimes move, we can still optimize as above 
     * whenever successive rows share the same frame head, but if the frame 
     * head moves beyond the previous head we try to remove those rows using 
     * the aggregate's inverse transition function.  This function restores 
     * the aggregate's current state to what it would be if the removed row 
     * had never been aggregated in the first place.  Inverse transition 
     * functions may optionally return NULL, indicating that the function was 
     * unable to remove the tuple from aggregation.  If this happens, or if 
     * the aggregate doesn't have an inverse transition function at all, we 
     * must perform the aggregation all over again for all tuples within the 
     * new frame boundaries. 
     * 
     * In many common cases, multiple rows share the same frame and hence the 
     * same aggregate value. (In particular, if there's no ORDER BY in a RANGE 
     * window, then all rows are peers and so they all have window frame equal 
     * to the whole partition.)  We optimize such cases by calculating the 
     * aggregate value once when we reach the first row of a peer group, and 
     * then returning the saved value for all subsequent rows. 
     * 
     * 'aggregatedupto' keeps track of the first row that has not yet been 
     * accumulated into the aggregate transition values.  Whenever we start a 
     * new peer group, we accumulate forward to the end of the peer group. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * First, update the frame head position. 
     * 
     * The frame head should never move backwards, and the code below wouldn't 
     * cope if it did, so for safety we complain if it does. 
     */ 
</span>    <a href="nodeWindowAgg.c.html#LN183"><span class='Ref_to_Proto'>update_frameheadpos</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN669"><span class='Ref_To_Local'>agg_winobj</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN671"><span class='Ref_To_Local'>temp_slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1809"><span class='Ref_to_Member'>frameheadpos</span></a> <span class='Operator'>&LT; </span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1814"><span class='Ref_to_Member'>aggregatedbase</span></a><span class='Parentheses'>) 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"window frame head moved backward"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the frame didn't change compared to the previous row, we can re-use 
     * the result values that were previously saved at the bottom of this 
     * function.  Since we don't know the current frame's end yet, this is not 
     * possible to check for fully.  But if the frame end mode is UNBOUNDED 
     * FOLLOWING or CURRENT ROW, and the current row lies within the previous 
     * row's frame, then the two frames' ends must coincide.  Note that on the 
     * first row aggregatedbase == aggregatedupto, meaning this test must 
     * fail, so we don't need to check the "there was no previous row" case 
     * explicitly here. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1814"><span class='Ref_to_Member'>aggregatedbase</span></a> <span class='Operator'>== </span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1809"><span class='Ref_to_Member'>frameheadpos</span></a> <span class='Operator'>&& 
</span>        <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1817"><span class='Ref_to_Member'>frameOptions</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN511"><span class='Ref_to_Const'>FRAMEOPTION_END_UNBOUNDED_FOLLOWING</span></a> <span class='Operator'>| 
</span>                                   <a href="../../include/nodes/parsenodes.h.html#LN513"><span class='Ref_to_Const'>FRAMEOPTION_END_CURRENT_ROW</span></a><span class='Parentheses'>))</span> <span class='Operator'>&& 
</span>        <a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1814"><span class='Ref_to_Member'>aggregatedbase</span></a> <span class='Operator'>&LT;= </span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1808"><span class='Ref_to_Member'>currentpos</span></a> <span class='Operator'>&& 
</span>        <a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1815"><span class='Ref_to_Member'>aggregatedupto</span></a> <span class='Operator'>&GT; </span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1808"><span class='Ref_to_Member'>currentpos</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN665"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="nodeWindowAgg.c.html#LN665"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="nodeWindowAgg.c.html#LN663"><span class='Ref_To_Local'>numaggs</span></a><span class='Delimiter'>; </span><a href="nodeWindowAgg.c.html#LN665"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a> <span class='Operator'>= &</span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1802"><span class='Ref_to_Member'>peragg</span></a><span class='Delimiter'>[</span><a href="nodeWindowAgg.c.html#LN665"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>            <a href="nodeWindowAgg.c.html#LN662"><span class='Ref_To_Local'>wfuncno</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN143"><span class='Ref_to_Member'>wfuncno</span></a><span class='Delimiter'>; 
</span>            <a href="nodeWindowAgg.c.html#LN668"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN212"><span class='Ref_to_Member'>ecxt_aggvalues</span></a><span class='Delimiter'>[</span><a href="nodeWindowAgg.c.html#LN662"><span class='Ref_To_Local'>wfuncno</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN129"><span class='Ref_to_Member'>resultValue</span></a><span class='Delimiter'>; 
</span>            <a href="nodeWindowAgg.c.html#LN668"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN213"><span class='Ref_to_Member'>ecxt_aggnulls</span></a><span class='Delimiter'>[</span><a href="nodeWindowAgg.c.html#LN662"><span class='Ref_To_Local'>wfuncno</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN130"><span class='Ref_to_Member'>resultValueIsNull</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/*---------- 
     * Initialize restart flags. 
     * 
     * We restart the aggregation: 
     *   - if we're processing the first row in the partition, or 
     *   - if the frame's head moved and we cannot use an inverse 
     *     transition function, or 
     *   - if the new frame doesn't overlap the old one 
     * 
     * Note that we don't strictly need to restart in the last case, but if 
     * we're going to remove all rows from the aggregation anyway, a restart 
     * surely is faster. 
     *---------- 
     */ 
</span>    <a href="nodeWindowAgg.c.html#LN664"><span class='Ref_To_Local'>numaggs_restart</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN665"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="nodeWindowAgg.c.html#LN665"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="nodeWindowAgg.c.html#LN663"><span class='Ref_To_Local'>numaggs</span></a><span class='Delimiter'>; </span><a href="nodeWindowAgg.c.html#LN665"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a> <span class='Operator'>= &</span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1802"><span class='Ref_to_Member'>peragg</span></a><span class='Delimiter'>[</span><a href="nodeWindowAgg.c.html#LN665"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1808"><span class='Ref_to_Member'>currentpos</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1814"><span class='Ref_to_Member'>aggregatedbase</span></a> <span class='Operator'>!= </span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1809"><span class='Ref_to_Member'>frameheadpos</span></a> <span class='Operator'>&& 
</span>             <span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN106"><span class='Ref_to_Member'>invtransfn_oid</span></a><span class='Parentheses'>))</span> <span class='Operator'>|| 
</span>            <a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1815"><span class='Ref_to_Member'>aggregatedupto</span></a> <span class='Operator'>&LT;= </span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1809"><span class='Ref_to_Member'>frameheadpos</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN155"><span class='Ref_to_Member'>restart</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="nodeWindowAgg.c.html#LN664"><span class='Ref_To_Local'>numaggs_restart</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN155"><span class='Ref_to_Member'>restart</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we have any possibly-moving aggregates, attempt to advance 
     * aggregatedbase to match the frame's head by removing input rows that 
     * fell off the top of the frame from the aggregations.  This can fail, 
     * i.e. advance_windowaggregate_base() can return false, in which case 
     * we'll restart that aggregate below. 
     */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN664"><span class='Ref_To_Local'>numaggs_restart</span></a> <span class='Operator'>&LT; </span><a href="nodeWindowAgg.c.html#LN663"><span class='Ref_To_Local'>numaggs</span></a> <span class='Operator'>&& 
</span>           <a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1814"><span class='Ref_to_Member'>aggregatedbase</span></a> <span class='Operator'>&LT; </span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1809"><span class='Ref_to_Member'>frameheadpos</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Fetch the next tuple of those being removed. This should never fail 
         * as we should have been here before. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeWindowAgg.c.html#LN193"><span class='Ref_to_Proto'>window_gettupleslot</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN669"><span class='Ref_To_Local'>agg_winobj</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1814"><span class='Ref_to_Member'>aggregatedbase</span></a><span class='Delimiter'>, 
</span>                                 <a href="nodeWindowAgg.c.html#LN671"><span class='Ref_To_Local'>temp_slot</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not re-fetch previously fetched frame row"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Set tuple context for evaluation of aggregate arguments */ 
</span>        <a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1826"><span class='Ref_to_Member'>tmpcontext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN198"><span class='Ref_to_Member'>ecxt_outertuple</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN671"><span class='Ref_To_Local'>temp_slot</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Perform the inverse transition for each aggregate function in the 
         * window, unless it has already been marked as needing a restart. 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN665"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="nodeWindowAgg.c.html#LN665"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="nodeWindowAgg.c.html#LN663"><span class='Ref_To_Local'>numaggs</span></a><span class='Delimiter'>; </span><a href="nodeWindowAgg.c.html#LN665"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN817"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>ok</span><span class='Delimiter'>; 
</span> 
            <a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a> <span class='Operator'>= &</span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1802"><span class='Ref_to_Member'>peragg</span></a><span class='Delimiter'>[</span><a href="nodeWindowAgg.c.html#LN665"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN155"><span class='Ref_to_Member'>restart</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <a href="nodeWindowAgg.c.html#LN662"><span class='Ref_To_Local'>wfuncno</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN143"><span class='Ref_to_Member'>wfuncno</span></a><span class='Delimiter'>; 
</span>            <a href="nodeWindowAgg.c.html#LN817"><span class='Ref_To_Local'>ok</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN164"><span class='Ref_to_Proto'>advance_windowaggregate_base</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Delimiter'>, 
</span>                                              <span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1801"><span class='Ref_to_Member'>perfunc</span></a><span class='Delimiter'>[</span><a href="nodeWindowAgg.c.html#LN662"><span class='Ref_To_Local'>wfuncno</span></a><span class='Delimiter'>], 
</span>                                              <a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeWindowAgg.c.html#LN817"><span class='Ref_To_Local'>ok</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Inverse transition function has failed, must restart */ 
</span>                <a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN155"><span class='Ref_to_Member'>restart</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="nodeWindowAgg.c.html#LN664"><span class='Ref_To_Local'>numaggs_restart</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Reset per-input-tuple context after each tuple */ 
</span>        <a href="../../include/executor/executor.h.html#LN449"><span class='Ref_to_Macro'>ResetExprContext</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1826"><span class='Ref_to_Member'>tmpcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* And advance the aggregated-row state */ 
</span>        <a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1814"><span class='Ref_to_Member'>aggregatedbase</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="../../include/executor/tuptable.h.html#LN154"><span class='Ref_to_Proto'>ExecClearTuple</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN671"><span class='Ref_To_Local'>temp_slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while numaggs_restart&LT;numag... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If we successfully advanced the base rows of all the aggregates, 
     * aggregatedbase now equals frameheadpos; but if we failed for any, we 
     * must forcibly update aggregatedbase. 
     */ 
</span>    <a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1814"><span class='Ref_to_Member'>aggregatedbase</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1809"><span class='Ref_to_Member'>frameheadpos</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we created a mark pointer for aggregates, keep it pushed up to frame 
     * head, so that tuplestore can discard unnecessary rows. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN669"><span class='Ref_To_Local'>agg_winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN64"><span class='Ref_to_Member'>markptr</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../include/windowapi.h.html#LN48"><span class='Ref_to_Proto'>WinSetMarkPosition</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN669"><span class='Ref_To_Local'>agg_winobj</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1809"><span class='Ref_to_Member'>frameheadpos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now restart the aggregates that require it. 
     * 
     * We assume that aggregates using the shared context always restart if 
     * *any* aggregate restarts, and we may thus clean up the shared 
     * aggcontext if that is the case.  Private aggcontexts are reset by 
     * initialize_windowaggregate() if their owning aggregate restarts. If we 
     * aren't restarting an aggregate, we need to free any previously saved 
     * result for it, else we'll leak memory. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN664"><span class='Ref_To_Local'>numaggs_restart</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/memutils.h.html#LN66"><span class='Ref_to_Macro'>MemoryContextResetAndDeleteChildren</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1824"><span class='Ref_to_Member'>aggcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN665"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="nodeWindowAgg.c.html#LN665"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="nodeWindowAgg.c.html#LN663"><span class='Ref_To_Local'>numaggs</span></a><span class='Delimiter'>; </span><a href="nodeWindowAgg.c.html#LN665"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a> <span class='Operator'>= &</span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1802"><span class='Ref_to_Member'>peragg</span></a><span class='Delimiter'>[</span><a href="nodeWindowAgg.c.html#LN665"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Comment_Multi_Line'>/* Aggregates using the shared ctx must restart if *any* agg does */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN146"><span class='Ref_to_Member'>aggcontext</span></a> <span class='Operator'>!= </span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1824"><span class='Ref_to_Member'>aggcontext</span></a> <span class='Operator'>|| 
</span>               <a href="nodeWindowAgg.c.html#LN664"><span class='Ref_To_Local'>numaggs_restart</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>               <a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN155"><span class='Ref_to_Member'>restart</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN155"><span class='Ref_to_Member'>restart</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="nodeWindowAgg.c.html#LN662"><span class='Ref_To_Local'>wfuncno</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN143"><span class='Ref_to_Member'>wfuncno</span></a><span class='Delimiter'>; 
</span>            <a href="nodeWindowAgg.c.html#LN158"><span class='Ref_to_Proto'>initialize_windowaggregate</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Delimiter'>, 
</span>                                       <span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1801"><span class='Ref_to_Member'>perfunc</span></a><span class='Delimiter'>[</span><a href="nodeWindowAgg.c.html#LN662"><span class='Ref_To_Local'>wfuncno</span></a><span class='Delimiter'>], 
</span>                                       <a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN130"><span class='Ref_to_Member'>resultValueIsNull</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN140"><span class='Ref_to_Member'>resulttypeByVal</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN129"><span class='Ref_to_Member'>resultValue</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN129"><span class='Ref_to_Member'>resultValue</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN130"><span class='Ref_to_Member'>resultValueIsNull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;numaggs;i++ &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Non-restarted aggregates now contain the rows between aggregatedbase 
     * (i.e., frameheadpos) and aggregatedupto, while restarted aggregates 
     * contain no rows.  If there are any restarted aggregates, we must thus 
     * begin aggregating anew at frameheadpos, otherwise we may simply 
     * continue at aggregatedupto.  We must remember the old value of 
     * aggregatedupto to know how long to skip advancing non-restarted 
     * aggregates.  If we modify aggregatedupto, we must also clear 
     * agg_row_slot, per the loop invariant below. 
     */ 
</span>    <a href="nodeWindowAgg.c.html#LN666"><span class='Ref_To_Local'>aggregatedupto_nonrestarted</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1815"><span class='Ref_to_Member'>aggregatedupto</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN664"><span class='Ref_To_Local'>numaggs_restart</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>        <a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1815"><span class='Ref_to_Member'>aggregatedupto</span></a> <span class='Operator'>!= </span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1809"><span class='Ref_to_Member'>frameheadpos</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1815"><span class='Ref_to_Member'>aggregatedupto</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1809"><span class='Ref_to_Member'>frameheadpos</span></a><span class='Delimiter'>; 
</span>        <a href="../../include/executor/tuptable.h.html#LN154"><span class='Ref_to_Proto'>ExecClearTuple</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN670"><span class='Ref_To_Local'>agg_row_slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Advance until we reach a row not in frame (or end of partition). 
     * 
     * Note the loop invariant: agg_row_slot is either empty or holds the row 
     * at position aggregatedupto.  We advance aggregatedupto after processing 
     * a row. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Fetch next row if we didn't already */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/executor/tuptable.h.html#LN137"><span class='Ref_to_Macro'>TupIsNull</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN670"><span class='Ref_To_Local'>agg_row_slot</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeWindowAgg.c.html#LN193"><span class='Ref_to_Proto'>window_gettupleslot</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN669"><span class='Ref_To_Local'>agg_winobj</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1815"><span class='Ref_to_Member'>aggregatedupto</span></a><span class='Delimiter'>, 
</span>                                     <a href="nodeWindowAgg.c.html#LN670"><span class='Ref_To_Local'>agg_row_slot</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>break</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* must be end of partition */ 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Exit loop (for now) if not in frame */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeWindowAgg.c.html#LN181"><span class='Ref_to_Proto'>row_is_in_frame</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1815"><span class='Ref_to_Member'>aggregatedupto</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN670"><span class='Ref_To_Local'>agg_row_slot</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Set tuple context for evaluation of aggregate arguments */ 
</span>        <a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1826"><span class='Ref_to_Member'>tmpcontext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN198"><span class='Ref_to_Member'>ecxt_outertuple</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN670"><span class='Ref_To_Local'>agg_row_slot</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Accumulate row into the aggregates */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN665"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="nodeWindowAgg.c.html#LN665"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="nodeWindowAgg.c.html#LN663"><span class='Ref_To_Local'>numaggs</span></a><span class='Delimiter'>; </span><a href="nodeWindowAgg.c.html#LN665"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a> <span class='Operator'>= &</span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1802"><span class='Ref_to_Member'>peragg</span></a><span class='Delimiter'>[</span><a href="nodeWindowAgg.c.html#LN665"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
            <span class='Comment_Multi_Line'>/* Non-restarted aggs skip until aggregatedupto_nonrestarted */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN155"><span class='Ref_to_Member'>restart</span></a> <span class='Operator'>&& 
</span>                <a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1815"><span class='Ref_to_Member'>aggregatedupto</span></a> <span class='Operator'>&LT; </span><a href="nodeWindowAgg.c.html#LN666"><span class='Ref_To_Local'>aggregatedupto_nonrestarted</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <a href="nodeWindowAgg.c.html#LN662"><span class='Ref_To_Local'>wfuncno</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN143"><span class='Ref_to_Member'>wfuncno</span></a><span class='Delimiter'>; 
</span>            <a href="nodeWindowAgg.c.html#LN161"><span class='Ref_to_Proto'>advance_windowaggregate</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Delimiter'>, 
</span>                                    <span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1801"><span class='Ref_to_Member'>perfunc</span></a><span class='Delimiter'>[</span><a href="nodeWindowAgg.c.html#LN662"><span class='Ref_To_Local'>wfuncno</span></a><span class='Delimiter'>], 
</span>                                    <a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Reset per-input-tuple context after each tuple */ 
</span>        <a href="../../include/executor/executor.h.html#LN449"><span class='Ref_to_Macro'>ResetExprContext</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1826"><span class='Ref_to_Member'>tmpcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* And advance the aggregated-row state */ 
</span>        <a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1815"><span class='Ref_to_Member'>aggregatedupto</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="../../include/executor/tuptable.h.html#LN154"><span class='Ref_to_Proto'>ExecClearTuple</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN670"><span class='Ref_To_Local'>agg_row_slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* The frame's end is not supposed to move backwards, ever */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN666"><span class='Ref_To_Local'>aggregatedupto_nonrestarted</span></a> <span class='Operator'>&LT;= </span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1815"><span class='Ref_to_Member'>aggregatedupto</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * finalize aggregates and fill result/isnull fields. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN665"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="nodeWindowAgg.c.html#LN665"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="nodeWindowAgg.c.html#LN663"><span class='Ref_To_Local'>numaggs</span></a><span class='Delimiter'>; </span><a href="nodeWindowAgg.c.html#LN665"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN968"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN969"></a>        <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span> 
        <a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a> <span class='Operator'>= &</span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1802"><span class='Ref_to_Member'>peragg</span></a><span class='Delimiter'>[</span><a href="nodeWindowAgg.c.html#LN665"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>        <a href="nodeWindowAgg.c.html#LN662"><span class='Ref_To_Local'>wfuncno</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN143"><span class='Ref_to_Member'>wfuncno</span></a><span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN968"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= &</span><a href="nodeWindowAgg.c.html#LN668"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN212"><span class='Ref_to_Member'>ecxt_aggvalues</span></a><span class='Delimiter'>[</span><a href="nodeWindowAgg.c.html#LN662"><span class='Ref_To_Local'>wfuncno</span></a><span class='Delimiter'>]; 
</span>        <a href="nodeWindowAgg.c.html#LN969"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>= &</span><a href="nodeWindowAgg.c.html#LN668"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN213"><span class='Ref_to_Member'>ecxt_aggnulls</span></a><span class='Delimiter'>[</span><a href="nodeWindowAgg.c.html#LN662"><span class='Ref_To_Local'>wfuncno</span></a><span class='Delimiter'>]; 
</span>        <a href="nodeWindowAgg.c.html#LN167"><span class='Ref_to_Proto'>finalize_windowaggregate</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Delimiter'>, 
</span>                                 <span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN659"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1801"><span class='Ref_to_Member'>perfunc</span></a><span class='Delimiter'>[</span><a href="nodeWindowAgg.c.html#LN662"><span class='Ref_To_Local'>wfuncno</span></a><span class='Delimiter'>], 
</span>                                 <a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a><span class='Delimiter'>, 
</span>                                 <a href="nodeWindowAgg.c.html#LN968"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN969"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * save the result in case next row shares the same frame. 
         * 
         * XXX in some framing modes, eg ROWS/END_CURRENT_ROW, we can know in 
         * advance that the next row can't possibly share the same frame. Is 
         * it worth detecting that and skipping this code? 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN140"><span class='Ref_to_Member'>resulttypeByVal</span></a> <span class='Operator'>&& !*</span><a href="nodeWindowAgg.c.html#LN969"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="nodeWindowAgg.c.html#LN667"><span class='Ref_To_Local'>oldContext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN146"><span class='Ref_to_Member'>aggcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN129"><span class='Ref_to_Member'>resultValue</span></a> <span class='Operator'>= 
</span>                <a href="../../include/utils/datum.h.html#LN30"><span class='Ref_to_Proto'>datumCopy</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="nodeWindowAgg.c.html#LN968"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                          <a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN140"><span class='Ref_to_Member'>resulttypeByVal</span></a><span class='Delimiter'>, 
</span>                          <a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN137"><span class='Ref_to_Member'>resulttypeLen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN667"><span class='Ref_To_Local'>oldContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN129"><span class='Ref_to_Member'>resultValue</span></a> <span class='Operator'>= *</span><a href="nodeWindowAgg.c.html#LN968"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="nodeWindowAgg.c.html#LN661"><span class='Ref_To_Local'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN130"><span class='Ref_to_Member'>resultValueIsNull</span></a> <span class='Operator'>= *</span><a href="nodeWindowAgg.c.html#LN969"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;numaggs;i++ &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end eval_windowaggregates &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * eval_windowfunction 
 * 
 * Arguments of window functions are not evaluated here, because a window 
 * function can need random access to arbitrary rows in the partition. 
 * The window function uses the special WinGetFuncArgInPartition and 
 * WinGetFuncArgInFrame functions to evaluate the arguments for the rows 
 * it wants. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1014"></a><span class='Declare_Function'>eval_windowfunction</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>winstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN1789"><span class='Ref_to_Typedef'>WindowStatePerFunc</span></a> <span class='Declare_Parameter'>perfuncstate</span><span class='Delimiter'>, 
</span><a name="LN1015"></a>                    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1017"></a>    <a href="../../include/fmgr.h.html#LN76"><span class='Ref_to_Struct'>FunctionCallInfoData</span></a> <span class='Declare_Local'>fcinfo</span><span class='Delimiter'>; 
</span><a name="LN1018"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldContext</span><span class='Delimiter'>; 
</span> 
    <a href="nodeWindowAgg.c.html#LN1018"><span class='Ref_To_Local'>oldContext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1014"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN842"><span class='Ref_to_Member'>ps_ExprContext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN202"><span class='Ref_to_Member'>ecxt_per_tuple_memory</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We don't pass any normal arguments to a window function, but we do pass 
     * it the number of arguments, in order to permit window function 
     * implementations to support varying numbers of arguments.  The real info 
     * goes through the WindowObject, which is passed via fcinfo-&GT;context. 
     */ 
</span>    <a href="../../include/fmgr.h.html#LN119"><span class='Ref_to_Macro'>InitFunctionCallInfoData</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1017"><span class='Ref_To_Local'>fcinfo</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1014"><span class='Ref_to_Parameter'>perfuncstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN82"><span class='Ref_to_Member'>flinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="nodeWindowAgg.c.html#LN1014"><span class='Ref_to_Parameter'>perfuncstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN80"><span class='Ref_to_Member'>numArguments</span></a><span class='Delimiter'>, 
</span>                             <a href="nodeWindowAgg.c.html#LN1014"><span class='Ref_to_Parameter'>perfuncstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN84"><span class='Ref_to_Member'>winCollation</span></a><span class='Delimiter'>, 
</span>                             <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeWindowAgg.c.html#LN1014"><span class='Ref_to_Parameter'>perfuncstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN96"><span class='Ref_to_Member'>winobj</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Just in case, make all the regular argument slots be null */ 
</span>    memset<span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1017"><span class='Ref_To_Local'>fcinfo</span></a><span class='Operator'>.</span><a href="../../include/fmgr.h.html#LN85"><span class='Ref_to_Member'>argnull</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN1014"><span class='Ref_to_Parameter'>perfuncstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN80"><span class='Ref_to_Member'>numArguments</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Window functions don't have a current aggregate context, either */ 
</span>    <a href="nodeWindowAgg.c.html#LN1014"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1825"><span class='Ref_to_Member'>curaggcontext</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="nodeWindowAgg.c.html#LN1015"><span class='Ref_to_Parameter'>result</span></a> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN136"><span class='Ref_to_Macro'>FunctionCallInvoke</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN1017"><span class='Ref_To_Local'>fcinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="nodeWindowAgg.c.html#LN1015"><span class='Ref_to_Parameter'>isnull</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1017"><span class='Ref_To_Local'>fcinfo</span></a><span class='Operator'>.</span><a href="../../include/fmgr.h.html#LN82"><span class='Ref_to_Member'>isnull</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make sure pass-by-ref data is allocated in the appropriate context. (We 
     * need this in case the function returns a pointer into some short-lived 
     * tuple, as is entirely possible.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeWindowAgg.c.html#LN1014"><span class='Ref_to_Parameter'>perfuncstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN91"><span class='Ref_to_Member'>resulttypeByVal</span></a> <span class='Operator'>&& !</span><a href="nodeWindowAgg.c.html#LN1017"><span class='Ref_To_Local'>fcinfo</span></a><span class='Operator'>.</span><a href="../../include/fmgr.h.html#LN82"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="../../include/utils/memutils.h.html#LN91"><span class='Ref_to_Proto'>MemoryContextContains</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, 
</span>                               <a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="nodeWindowAgg.c.html#LN1015"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)))</span> 
        <span class='Operator'>*</span><a href="nodeWindowAgg.c.html#LN1015"><span class='Ref_to_Parameter'>result</span></a> <span class='Operator'>= </span><a href="../../include/utils/datum.h.html#LN30"><span class='Ref_to_Proto'>datumCopy</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="nodeWindowAgg.c.html#LN1015"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, 
</span>                            <a href="nodeWindowAgg.c.html#LN1014"><span class='Ref_to_Parameter'>perfuncstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN91"><span class='Ref_to_Member'>resulttypeByVal</span></a><span class='Delimiter'>, 
</span>                            <a href="nodeWindowAgg.c.html#LN1014"><span class='Ref_to_Parameter'>perfuncstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN90"><span class='Ref_to_Member'>resulttypeLen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1018"><span class='Ref_To_Local'>oldContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end eval_windowfunction &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * begin_partition 
 * Start buffering rows of the next partition. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1060"></a><span class='Declare_Function'>begin_partition</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>winstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1062"></a>    <a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>outerPlan</span> <span class='Operator'>= </span><a href="../../include/nodes/execnodes.h.html#LN854"><span class='Ref_to_Macro'>outerPlanState</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1060"><span class='Ref_to_Parameter'>winstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1063"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numfuncs</span> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1060"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1798"><span class='Ref_to_Member'>numfuncs</span></a><span class='Delimiter'>; 
</span><a name="LN1064"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="nodeWindowAgg.c.html#LN1060"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1830"><span class='Ref_to_Member'>partition_spooled</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN1060"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1835"><span class='Ref_to_Member'>framehead_valid</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN1060"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1837"><span class='Ref_to_Member'>frametail_valid</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN1060"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1807"><span class='Ref_to_Member'>spooled_rows</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN1060"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1808"><span class='Ref_to_Member'>currentpos</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN1060"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1809"><span class='Ref_to_Member'>frameheadpos</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN1060"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1810"><span class='Ref_to_Member'>frametailpos</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="../../include/executor/tuptable.h.html#LN154"><span class='Ref_to_Proto'>ExecClearTuple</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1060"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1844"><span class='Ref_to_Member'>agg_row_slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If this is the very first partition, we need to fetch the first input 
     * row to store in first_part_slot. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/executor/tuptable.h.html#LN137"><span class='Ref_to_Macro'>TupIsNull</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1060"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1840"><span class='Ref_to_Member'>first_part_slot</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1081"></a>        <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>outerslot</span> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN229"><span class='Ref_to_Proto'>ExecProcNode</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1062"><span class='Ref_To_Local'>outerPlan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/executor/tuptable.h.html#LN137"><span class='Ref_to_Macro'>TupIsNull</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1081"><span class='Ref_To_Local'>outerslot</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/executor/tuptable.h.html#LN163"><span class='Ref_to_Proto'>ExecCopySlot</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1060"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1840"><span class='Ref_to_Member'>first_part_slot</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN1081"><span class='Ref_To_Local'>outerslot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* outer plan is empty, so we have nothing to do */ 
</span>            <a href="nodeWindowAgg.c.html#LN1060"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1830"><span class='Ref_to_Member'>partition_spooled</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="nodeWindowAgg.c.html#LN1060"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1833"><span class='Ref_to_Member'>more_partitions</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Create new tuplestore for this partition */ 
</span>    <a href="nodeWindowAgg.c.html#LN1060"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1805"><span class='Ref_to_Member'>buffer</span></a> <span class='Operator'>= </span><a href="../../include/utils/tuplestore.h.html#LN46"><span class='Ref_to_Proto'>tuplestore_begin_heap</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="../utils/init/globals.c.html#LN112"><span class='Ref_to_Global_Var'>work_mem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set up read pointers for the tuplestore.  The current pointer doesn't 
     * need BACKWARD capability, but the per-window-function read pointers do, 
     * and the aggregate pointer does if frame start is movable. 
     */ 
</span>    <a href="nodeWindowAgg.c.html#LN1060"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1806"><span class='Ref_to_Member'>current_ptr</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* read pointer 0 is pre-allocated */ 
</span> 
    <span class='Comment_Multi_Line'>/* reset default REWIND capability bit for current ptr */ 
</span>    <a href="../../include/utils/tuplestore.h.html#LN50"><span class='Ref_to_Proto'>tuplestore_set_eflags</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1060"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1805"><span class='Ref_to_Member'>buffer</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* create read pointers for aggregates, if needed */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1060"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1799"><span class='Ref_to_Member'>numaggs</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1110"></a>        <a href="../../include/windowapi.h.html#LN36"><span class='Ref_to_Typedef'>WindowObject</span></a> <span class='Declare_Local'>agg_winobj</span> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1060"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1812"><span class='Ref_to_Member'>agg_winobj</span></a><span class='Delimiter'>; 
</span><a name="LN1111"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>readptr_flags</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* If the frame head is potentially movable ... */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1060"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1817"><span class='Ref_to_Member'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN508"><span class='Ref_to_Const'>FRAMEOPTION_START_UNBOUNDED_PRECEDING</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* ... create a mark pointer to track the frame head */ 
</span>            <a href="nodeWindowAgg.c.html#LN1110"><span class='Ref_To_Local'>agg_winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN64"><span class='Ref_to_Member'>markptr</span></a> <span class='Operator'>= </span><a href="../../include/utils/tuplestore.h.html#LN61"><span class='Ref_to_Proto'>tuplestore_alloc_read_pointer</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1060"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1805"><span class='Ref_to_Member'>buffer</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* and the read pointer will need BACKWARD capability */ 
</span>            <a href="nodeWindowAgg.c.html#LN1111"><span class='Ref_To_Local'>readptr_flags</span></a> <span class='Operator'>|= </span><a href="../../include/executor/executor.h.html#LN59"><span class='Ref_to_Const'>EXEC_FLAG_BACKWARD</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="nodeWindowAgg.c.html#LN1110"><span class='Ref_To_Local'>agg_winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN65"><span class='Ref_to_Member'>readptr</span></a> <span class='Operator'>= </span><a href="../../include/utils/tuplestore.h.html#LN61"><span class='Ref_to_Proto'>tuplestore_alloc_read_pointer</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1060"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1805"><span class='Ref_to_Member'>buffer</span></a><span class='Delimiter'>, 
</span>                                                            <a href="nodeWindowAgg.c.html#LN1111"><span class='Ref_To_Local'>readptr_flags</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN1110"><span class='Ref_To_Local'>agg_winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN66"><span class='Ref_to_Member'>markpos</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN1110"><span class='Ref_To_Local'>agg_winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN67"><span class='Ref_to_Member'>seekpos</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Also reset the row counters for aggregates */ 
</span>        <a href="nodeWindowAgg.c.html#LN1060"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1814"><span class='Ref_to_Member'>aggregatedbase</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN1060"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1815"><span class='Ref_to_Member'>aggregatedupto</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if winstate-&GT;numaggs&GT;0 &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* create mark and read pointers for each real window function */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1064"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="nodeWindowAgg.c.html#LN1064"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="nodeWindowAgg.c.html#LN1063"><span class='Ref_To_Local'>numfuncs</span></a><span class='Delimiter'>; </span><a href="nodeWindowAgg.c.html#LN1064"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1135"></a>        <a href="../../include/nodes/execnodes.h.html#LN1789"><span class='Ref_to_Typedef'>WindowStatePerFunc</span></a> <span class='Declare_Local'>perfuncstate</span> <span class='Operator'>= &</span><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1060"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1801"><span class='Ref_to_Member'>perfunc</span></a><span class='Delimiter'>[</span><a href="nodeWindowAgg.c.html#LN1064"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeWindowAgg.c.html#LN1135"><span class='Ref_To_Local'>perfuncstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN93"><span class='Ref_to_Member'>plain_agg</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1139"></a>            <a href="../../include/windowapi.h.html#LN36"><span class='Ref_to_Typedef'>WindowObject</span></a> <span class='Declare_Local'>winobj</span> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1135"><span class='Ref_To_Local'>perfuncstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN96"><span class='Ref_to_Member'>winobj</span></a><span class='Delimiter'>; 
</span> 
            <a href="nodeWindowAgg.c.html#LN1139"><span class='Ref_To_Local'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN64"><span class='Ref_to_Member'>markptr</span></a> <span class='Operator'>= </span><a href="../../include/utils/tuplestore.h.html#LN61"><span class='Ref_to_Proto'>tuplestore_alloc_read_pointer</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1060"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1805"><span class='Ref_to_Member'>buffer</span></a><span class='Delimiter'>, 
</span>                                                            <span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="nodeWindowAgg.c.html#LN1139"><span class='Ref_To_Local'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN65"><span class='Ref_to_Member'>readptr</span></a> <span class='Operator'>= </span><a href="../../include/utils/tuplestore.h.html#LN61"><span class='Ref_to_Proto'>tuplestore_alloc_read_pointer</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1060"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1805"><span class='Ref_to_Member'>buffer</span></a><span class='Delimiter'>, 
</span>                                                         <a href="../../include/executor/executor.h.html#LN59"><span class='Ref_to_Const'>EXEC_FLAG_BACKWARD</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="nodeWindowAgg.c.html#LN1139"><span class='Ref_To_Local'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN66"><span class='Ref_to_Member'>markpos</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <a href="nodeWindowAgg.c.html#LN1139"><span class='Ref_To_Local'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN67"><span class='Ref_to_Member'>seekpos</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Store the first tuple into the tuplestore (it's always available now; 
     * we either read it above, or saved it at the end of previous partition) 
     */ 
</span>    <a href="../../include/utils/tuplestore.h.html#LN52"><span class='Ref_to_Proto'>tuplestore_puttupleslot</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1060"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1805"><span class='Ref_to_Member'>buffer</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN1060"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1840"><span class='Ref_to_Member'>first_part_slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN1060"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1807"><span class='Ref_to_Member'>spooled_rows</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end begin_partition &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Read tuples from the outer node, up to and including position 'pos', and 
 * store them into the tuplestore. If pos is -1, reads the whole partition. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1163"></a><span class='Declare_Function'>spool_tuples</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>winstate</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Declare_Parameter'>pos</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1165"></a>    <a href="../../include/nodes/plannodes.h.html#LN800"><span class='Ref_to_Struct'>WindowAgg</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>node</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN800"><span class='Ref_to_Struct'>WindowAgg</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeWindowAgg.c.html#LN1163"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN812"><span class='Ref_to_Member'>plan</span></a><span class='Delimiter'>; 
</span><a name="LN1166"></a>    <a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>outerPlan</span><span class='Delimiter'>; 
</span><a name="LN1167"></a>    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>outerslot</span><span class='Delimiter'>; 
</span><a name="LN1168"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeWindowAgg.c.html#LN1163"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1805"><span class='Ref_to_Member'>buffer</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>;</span>                 <span class='Comment_Single_Line'>/* just a safety check */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1163"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1830"><span class='Ref_to_Member'>partition_spooled</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>;</span>                 <span class='Comment_Single_Line'>/* whole partition done already */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the tuplestore has spilled to disk, alternate reading and writing 
     * becomes quite expensive due to frequent buffer flushes.  It's cheaper 
     * to force the entire partition to get spooled in one go. 
     * 
     * XXX this is a horrid kluge --- it'd be better to fix the performance 
     * problem inside tuplestore.  FIXME 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/tuplestore.h.html#LN70"><span class='Ref_to_Proto'>tuplestore_in_memory</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1163"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1805"><span class='Ref_to_Member'>buffer</span></a><span class='Parentheses'>))</span> 
        <a href="nodeWindowAgg.c.html#LN1163"><span class='Ref_to_Parameter'>pos</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="nodeWindowAgg.c.html#LN1166"><span class='Ref_To_Local'>outerPlan</span></a> <span class='Operator'>= </span><a href="../../include/nodes/execnodes.h.html#LN854"><span class='Ref_to_Macro'>outerPlanState</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1163"><span class='Ref_to_Parameter'>winstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Must be in query context to call outerplan */ 
</span>    <a href="nodeWindowAgg.c.html#LN1168"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1163"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN842"><span class='Ref_to_Member'>ps_ExprContext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN201"><span class='Ref_to_Member'>ecxt_per_query_memory</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1163"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1807"><span class='Ref_to_Member'>spooled_rows</span></a> <span class='Operator'>&LT;= </span><a href="nodeWindowAgg.c.html#LN1163"><span class='Ref_to_Parameter'>pos</span></a> <span class='Operator'>|| </span><a href="nodeWindowAgg.c.html#LN1163"><span class='Ref_to_Parameter'>pos</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="nodeWindowAgg.c.html#LN1167"><span class='Ref_To_Local'>outerslot</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN229"><span class='Ref_to_Proto'>ExecProcNode</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1166"><span class='Ref_To_Local'>outerPlan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/executor/tuptable.h.html#LN137"><span class='Ref_to_Macro'>TupIsNull</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1167"><span class='Ref_To_Local'>outerslot</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* reached the end of the last partition */ 
</span>            <a href="nodeWindowAgg.c.html#LN1163"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1830"><span class='Ref_to_Member'>partition_spooled</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="nodeWindowAgg.c.html#LN1163"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1833"><span class='Ref_to_Member'>more_partitions</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1165"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN804"><span class='Ref_to_Member'>partNumCols</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Check if this tuple still belongs to the current partition */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="execGrouping.c.html#LN67"><span class='Ref_to_Func'>execTuplesMatch</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1163"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1840"><span class='Ref_to_Member'>first_part_slot</span></a><span class='Delimiter'>, 
</span>                                 <a href="nodeWindowAgg.c.html#LN1167"><span class='Ref_To_Local'>outerslot</span></a><span class='Delimiter'>, 
</span>                                 <a href="nodeWindowAgg.c.html#LN1165"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN804"><span class='Ref_to_Member'>partNumCols</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN1165"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN805"><span class='Ref_to_Member'>partColIdx</span></a><span class='Delimiter'>, 
</span>                                 <a href="nodeWindowAgg.c.html#LN1163"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1803"><span class='Ref_to_Member'>partEqfunctions</span></a><span class='Delimiter'>, 
</span>                                 <a href="nodeWindowAgg.c.html#LN1163"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1826"><span class='Ref_to_Member'>tmpcontext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN202"><span class='Ref_to_Member'>ecxt_per_tuple_memory</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * end of partition; copy the tuple for the next cycle. 
                 */ 
</span>                <a href="../../include/executor/tuptable.h.html#LN163"><span class='Ref_to_Proto'>ExecCopySlot</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1163"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1840"><span class='Ref_to_Member'>first_part_slot</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN1167"><span class='Ref_To_Local'>outerslot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="nodeWindowAgg.c.html#LN1163"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1830"><span class='Ref_to_Member'>partition_spooled</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="nodeWindowAgg.c.html#LN1163"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1833"><span class='Ref_to_Member'>more_partitions</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Still in partition, so save it into the tuplestore */ 
</span>        <a href="../../include/utils/tuplestore.h.html#LN52"><span class='Ref_to_Proto'>tuplestore_puttupleslot</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1163"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1805"><span class='Ref_to_Member'>buffer</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN1167"><span class='Ref_To_Local'>outerslot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN1163"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1807"><span class='Ref_to_Member'>spooled_rows</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while winstate-&GT;spooled_row... &raquo; </span> 
 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1168"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end spool_tuples &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * release_partition 
 * clear information kept within a partition, including 
 * tuplestore and aggregate results. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1235"></a><span class='Declare_Function'>release_partition</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>winstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1237"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1237"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="nodeWindowAgg.c.html#LN1237"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="nodeWindowAgg.c.html#LN1235"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1798"><span class='Ref_to_Member'>numfuncs</span></a><span class='Delimiter'>; </span><a href="nodeWindowAgg.c.html#LN1237"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1241"></a>        <a href="../../include/nodes/execnodes.h.html#LN1789"><span class='Ref_to_Typedef'>WindowStatePerFunc</span></a> <span class='Declare_Local'>perfuncstate</span> <span class='Operator'>= &</span><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1235"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1801"><span class='Ref_to_Member'>perfunc</span></a><span class='Delimiter'>[</span><a href="nodeWindowAgg.c.html#LN1237"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Release any partition-local state of this window function */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1241"><span class='Ref_To_Local'>perfuncstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN96"><span class='Ref_to_Member'>winobj</span></a><span class='Parentheses'>) 
</span>            <a href="nodeWindowAgg.c.html#LN1241"><span class='Ref_To_Local'>perfuncstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN96"><span class='Ref_to_Member'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN63"><span class='Ref_to_Member'>localmem</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Release all partition-local memory (in particular, any partition-local 
     * state that we might have trashed our pointers to in the above loop, and 
     * any aggregate temp data).  We don't rely on retail pfree because some 
     * aggregates might have allocated data we don't have direct pointers to. 
     */ 
</span>    <a href="../../include/utils/memutils.h.html#LN66"><span class='Ref_to_Macro'>MemoryContextResetAndDeleteChildren</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1235"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1823"><span class='Ref_to_Member'>partcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/memutils.h.html#LN66"><span class='Ref_to_Macro'>MemoryContextResetAndDeleteChildren</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1235"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1824"><span class='Ref_to_Member'>aggcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1237"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="nodeWindowAgg.c.html#LN1237"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="nodeWindowAgg.c.html#LN1235"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1799"><span class='Ref_to_Member'>numaggs</span></a><span class='Delimiter'>; </span><a href="nodeWindowAgg.c.html#LN1237"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1235"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1802"><span class='Ref_to_Member'>peragg</span></a><span class='Delimiter'>[</span><a href="nodeWindowAgg.c.html#LN1237"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="nodeWindowAgg.c.html#LN146"><span class='Ref_to_Member'>aggcontext</span></a> <span class='Operator'>!= </span><a href="nodeWindowAgg.c.html#LN1235"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1824"><span class='Ref_to_Member'>aggcontext</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/memutils.h.html#LN66"><span class='Ref_to_Macro'>MemoryContextResetAndDeleteChildren</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1235"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1802"><span class='Ref_to_Member'>peragg</span></a><span class='Delimiter'>[</span><a href="nodeWindowAgg.c.html#LN1237"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="nodeWindowAgg.c.html#LN146"><span class='Ref_to_Member'>aggcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1235"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1805"><span class='Ref_to_Member'>buffer</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/tuplestore.h.html#LN88"><span class='Ref_to_Proto'>tuplestore_end</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1235"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1805"><span class='Ref_to_Member'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN1235"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1805"><span class='Ref_to_Member'>buffer</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN1235"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1830"><span class='Ref_to_Member'>partition_spooled</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end release_partition &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * row_is_in_frame 
 * Determine whether a row is in the current row's window frame according 
 * to our window framing rule 
 * 
 * The caller must have already determined that the row is in the partition 
 * and fetched it into a slot.  This function just encapsulates the framing 
 * rules. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1278"></a><span class='Declare_Function'>row_is_in_frame</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>winstate</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Declare_Parameter'>pos</span><span class='Delimiter'>, </span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1280"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>frameOptions</span> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1278"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1817"><span class='Ref_to_Member'>frameOptions</span></a><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1278"><span class='Ref_to_Parameter'>pos</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* else caller error */ 
</span> 
    <span class='Comment_Multi_Line'>/* First, check frame starting conditions */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1280"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN512"><span class='Ref_to_Const'>FRAMEOPTION_START_CURRENT_ROW</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1280"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN506"><span class='Ref_to_Const'>FRAMEOPTION_ROWS</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* rows before current row are out of frame */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1278"><span class='Ref_to_Parameter'>pos</span></a> <span class='Operator'>&LT; </span><a href="nodeWindowAgg.c.html#LN1278"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1808"><span class='Ref_to_Member'>currentpos</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1280"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN505"><span class='Ref_to_Const'>FRAMEOPTION_RANGE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* preceding row that is not peer is out of frame */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1278"><span class='Ref_to_Parameter'>pos</span></a> <span class='Operator'>&LT; </span><a href="nodeWindowAgg.c.html#LN1278"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1808"><span class='Ref_to_Member'>currentpos</span></a> <span class='Operator'>&& 
</span>                <span class='Operator'>!</span><a href="nodeWindowAgg.c.html#LN191"><span class='Ref_to_Proto'>are_peers</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1278"><span class='Ref_to_Parameter'>winstate</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN1278"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN1278"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1060"><span class='Ref_to_Member'>ss_ScanTupleSlot</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1280"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN519"><span class='Ref_to_Const'>FRAMEOPTION_START_VALUE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1280"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN506"><span class='Ref_to_Const'>FRAMEOPTION_ROWS</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1307"></a>            <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>offset</span> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN610"><span class='Ref_to_Macro'>DatumGetInt64</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1278"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1820"><span class='Ref_to_Member'>startOffsetValue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* rows before current row + offset are out of frame */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1280"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN514"><span class='Ref_to_Const'>FRAMEOPTION_START_VALUE_PRECEDING</span></a><span class='Parentheses'>) 
</span>                <a href="nodeWindowAgg.c.html#LN1307"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>= -</span><a href="nodeWindowAgg.c.html#LN1307"><span class='Ref_To_Local'>offset</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1278"><span class='Ref_to_Parameter'>pos</span></a> <span class='Operator'>&LT; </span><a href="nodeWindowAgg.c.html#LN1278"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1808"><span class='Ref_to_Member'>currentpos</span></a> <span class='Operator'>+ </span><a href="nodeWindowAgg.c.html#LN1307"><span class='Ref_To_Local'>offset</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1280"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN505"><span class='Ref_to_Const'>FRAMEOPTION_RANGE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* parser should have rejected this */ 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"window frame with value offset is not implemented"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if frameOptions&FRAMEOPT... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Okay so far, now check frame ending conditions */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1280"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN513"><span class='Ref_to_Const'>FRAMEOPTION_END_CURRENT_ROW</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1280"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN506"><span class='Ref_to_Const'>FRAMEOPTION_ROWS</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* rows after current row are out of frame */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1278"><span class='Ref_to_Parameter'>pos</span></a> <span class='Operator'>&GT; </span><a href="nodeWindowAgg.c.html#LN1278"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1808"><span class='Ref_to_Member'>currentpos</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1280"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN505"><span class='Ref_to_Const'>FRAMEOPTION_RANGE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* following row that is not peer is out of frame */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1278"><span class='Ref_to_Parameter'>pos</span></a> <span class='Operator'>&GT; </span><a href="nodeWindowAgg.c.html#LN1278"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1808"><span class='Ref_to_Member'>currentpos</span></a> <span class='Operator'>&& 
</span>                <span class='Operator'>!</span><a href="nodeWindowAgg.c.html#LN191"><span class='Ref_to_Proto'>are_peers</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1278"><span class='Ref_to_Parameter'>winstate</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN1278"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN1278"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1060"><span class='Ref_to_Member'>ss_ScanTupleSlot</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1280"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN521"><span class='Ref_to_Const'>FRAMEOPTION_END_VALUE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1280"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN506"><span class='Ref_to_Const'>FRAMEOPTION_ROWS</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1348"></a>            <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>offset</span> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN610"><span class='Ref_to_Macro'>DatumGetInt64</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1278"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1821"><span class='Ref_to_Member'>endOffsetValue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* rows after current row + offset are out of frame */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1280"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN515"><span class='Ref_to_Const'>FRAMEOPTION_END_VALUE_PRECEDING</span></a><span class='Parentheses'>) 
</span>                <a href="nodeWindowAgg.c.html#LN1348"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>= -</span><a href="nodeWindowAgg.c.html#LN1348"><span class='Ref_To_Local'>offset</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1278"><span class='Ref_to_Parameter'>pos</span></a> <span class='Operator'>&GT; </span><a href="nodeWindowAgg.c.html#LN1278"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1808"><span class='Ref_to_Member'>currentpos</span></a> <span class='Operator'>+ </span><a href="nodeWindowAgg.c.html#LN1348"><span class='Ref_To_Local'>offset</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1280"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN505"><span class='Ref_to_Const'>FRAMEOPTION_RANGE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* parser should have rejected this */ 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"window frame with value offset is not implemented"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if frameOptions&FRAMEOPT... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* If we get here, it's in frame */ 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end row_is_in_frame &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * update_frameheadpos 
 * make frameheadpos valid for the current row 
 * 
 * Uses the winobj's read pointer for any required fetches; hence, if the 
 * frame mode is one that requires row comparisons, the winobj's mark must 
 * not be past the currently known frame head.  Also uses the specified slot 
 * for any required fetches. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1380"></a><span class='Declare_Function'>update_frameheadpos</span><span class='Parentheses'>(</span><a href="../../include/windowapi.h.html#LN36"><span class='Ref_to_Typedef'>WindowObject</span></a> <span class='Declare_Parameter'>winobj</span><span class='Delimiter'>, </span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1382"></a>    <a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>winstate</span> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1380"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN61"><span class='Ref_to_Member'>winstate</span></a><span class='Delimiter'>; 
</span><a name="LN1383"></a>    <a href="../../include/nodes/plannodes.h.html#LN800"><span class='Ref_to_Struct'>WindowAgg</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>node</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN800"><span class='Ref_to_Struct'>WindowAgg</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeWindowAgg.c.html#LN1382"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN812"><span class='Ref_to_Member'>plan</span></a><span class='Delimiter'>; 
</span><a name="LN1384"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>frameOptions</span> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1382"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1817"><span class='Ref_to_Member'>frameOptions</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1382"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1835"><span class='Ref_to_Member'>framehead_valid</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>;</span>                 <span class='Comment_Single_Line'>/* already known for current row */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1384"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN508"><span class='Ref_to_Const'>FRAMEOPTION_START_UNBOUNDED_PRECEDING</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* In UNBOUNDED PRECEDING mode, frame head is always row 0 */ 
</span>        <a href="nodeWindowAgg.c.html#LN1382"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1809"><span class='Ref_to_Member'>frameheadpos</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN1382"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1835"><span class='Ref_to_Member'>framehead_valid</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1384"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN512"><span class='Ref_to_Const'>FRAMEOPTION_START_CURRENT_ROW</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1384"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN506"><span class='Ref_to_Const'>FRAMEOPTION_ROWS</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* In ROWS mode, frame head is the same as current */ 
</span>            <a href="nodeWindowAgg.c.html#LN1382"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1809"><span class='Ref_to_Member'>frameheadpos</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1382"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1808"><span class='Ref_to_Member'>currentpos</span></a><span class='Delimiter'>; 
</span>            <a href="nodeWindowAgg.c.html#LN1382"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1835"><span class='Ref_to_Member'>framehead_valid</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1384"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN505"><span class='Ref_to_Const'>FRAMEOPTION_RANGE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1405"></a>            <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>fhprev</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* If no ORDER BY, all rows are peers with each other */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1383"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN807"><span class='Ref_to_Member'>ordNumCols</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="nodeWindowAgg.c.html#LN1382"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1809"><span class='Ref_to_Member'>frameheadpos</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <a href="nodeWindowAgg.c.html#LN1382"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1835"><span class='Ref_to_Member'>framehead_valid</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * In RANGE START_CURRENT mode, frame head is the first row that 
             * is a peer of current row.  We search backwards from current, 
             * which could be a bit inefficient if peer sets are large. Might 
             * be better to have a separate read pointer that moves forward 
             * tracking the frame head. 
             */ 
</span>            <a href="nodeWindowAgg.c.html#LN1405"><span class='Ref_To_Local'>fhprev</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1382"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1808"><span class='Ref_to_Member'>currentpos</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* assume the frame head can't go backwards */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1405"><span class='Ref_To_Local'>fhprev</span></a> <span class='Operator'>&LT; </span><a href="nodeWindowAgg.c.html#LN1382"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1809"><span class='Ref_to_Member'>frameheadpos</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeWindowAgg.c.html#LN193"><span class='Ref_to_Proto'>window_gettupleslot</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1380"><span class='Ref_to_Parameter'>winobj</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN1405"><span class='Ref_To_Local'>fhprev</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN1380"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>break</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* start of partition */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeWindowAgg.c.html#LN191"><span class='Ref_to_Proto'>are_peers</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1382"><span class='Ref_To_Local'>winstate</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN1380"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN1382"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1060"><span class='Ref_to_Member'>ss_ScanTupleSlot</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>break</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* not peer of current row */ 
</span>                <a href="nodeWindowAgg.c.html#LN1405"><span class='Ref_To_Local'>fhprev</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="nodeWindowAgg.c.html#LN1382"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1809"><span class='Ref_to_Member'>frameheadpos</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1405"><span class='Ref_To_Local'>fhprev</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <a href="nodeWindowAgg.c.html#LN1382"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1835"><span class='Ref_to_Member'>framehead_valid</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if frameOptions&FRAMEOPT... &raquo; </span> 
        <span class='Control'>else</span> 
            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if frameOptions&FRAMEOPT... &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1384"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN519"><span class='Ref_to_Const'>FRAMEOPTION_START_VALUE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1384"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN506"><span class='Ref_to_Const'>FRAMEOPTION_ROWS</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* In ROWS mode, bound is physically n before/after current */ 
</span><a name="LN1445"></a>            <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>offset</span> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN610"><span class='Ref_to_Macro'>DatumGetInt64</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1382"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1820"><span class='Ref_to_Member'>startOffsetValue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1384"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN514"><span class='Ref_to_Const'>FRAMEOPTION_START_VALUE_PRECEDING</span></a><span class='Parentheses'>) 
</span>                <a href="nodeWindowAgg.c.html#LN1445"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>= -</span><a href="nodeWindowAgg.c.html#LN1445"><span class='Ref_To_Local'>offset</span></a><span class='Delimiter'>; 
</span> 
            <a href="nodeWindowAgg.c.html#LN1382"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1809"><span class='Ref_to_Member'>frameheadpos</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1382"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1808"><span class='Ref_to_Member'>currentpos</span></a> <span class='Operator'>+ </span><a href="nodeWindowAgg.c.html#LN1445"><span class='Ref_To_Local'>offset</span></a><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* frame head can't go before first row */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1382"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1809"><span class='Ref_to_Member'>frameheadpos</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="nodeWindowAgg.c.html#LN1382"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1809"><span class='Ref_to_Member'>frameheadpos</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1382"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1809"><span class='Ref_to_Member'>frameheadpos</span></a> <span class='Operator'>&GT; </span><a href="nodeWindowAgg.c.html#LN1382"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1808"><span class='Ref_to_Member'>currentpos</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* make sure frameheadpos is not past end of partition */ 
</span>                <a href="nodeWindowAgg.c.html#LN178"><span class='Ref_to_Proto'>spool_tuples</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1382"><span class='Ref_To_Local'>winstate</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN1382"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1809"><span class='Ref_to_Member'>frameheadpos</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1382"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1809"><span class='Ref_to_Member'>frameheadpos</span></a> <span class='Operator'>&GT; </span><a href="nodeWindowAgg.c.html#LN1382"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1807"><span class='Ref_to_Member'>spooled_rows</span></a><span class='Parentheses'>) 
</span>                    <a href="nodeWindowAgg.c.html#LN1382"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1809"><span class='Ref_to_Member'>frameheadpos</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1382"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1807"><span class='Ref_to_Member'>spooled_rows</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="nodeWindowAgg.c.html#LN1382"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1835"><span class='Ref_to_Member'>framehead_valid</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if frameOptions&FRAMEOPT... &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1384"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN505"><span class='Ref_to_Const'>FRAMEOPTION_RANGE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* parser should have rejected this */ 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"window frame with value offset is not implemented"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if frameOptions&FRAMEOPT... &raquo; </span> 
    <span class='Control'>else</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end update_frameheadpos &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * update_frametailpos 
 * make frametailpos valid for the current row 
 * 
 * Uses the winobj's read pointer for any required fetches; hence, if the 
 * frame mode is one that requires row comparisons, the winobj's mark must 
 * not be past the currently known frame tail.  Also uses the specified slot 
 * for any required fetches. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1485"></a><span class='Declare_Function'>update_frametailpos</span><span class='Parentheses'>(</span><a href="../../include/windowapi.h.html#LN36"><span class='Ref_to_Typedef'>WindowObject</span></a> <span class='Declare_Parameter'>winobj</span><span class='Delimiter'>, </span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1487"></a>    <a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>winstate</span> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1485"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN61"><span class='Ref_to_Member'>winstate</span></a><span class='Delimiter'>; 
</span><a name="LN1488"></a>    <a href="../../include/nodes/plannodes.h.html#LN800"><span class='Ref_to_Struct'>WindowAgg</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>node</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN800"><span class='Ref_to_Struct'>WindowAgg</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeWindowAgg.c.html#LN1487"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN812"><span class='Ref_to_Member'>plan</span></a><span class='Delimiter'>; 
</span><a name="LN1489"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>frameOptions</span> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1487"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1817"><span class='Ref_to_Member'>frameOptions</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1487"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1837"><span class='Ref_to_Member'>frametail_valid</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>;</span>                 <span class='Comment_Single_Line'>/* already known for current row */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1489"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN511"><span class='Ref_to_Const'>FRAMEOPTION_END_UNBOUNDED_FOLLOWING</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* In UNBOUNDED FOLLOWING mode, all partition rows are in frame */ 
</span>        <a href="nodeWindowAgg.c.html#LN178"><span class='Ref_to_Proto'>spool_tuples</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1487"><span class='Ref_To_Local'>winstate</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN1487"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1810"><span class='Ref_to_Member'>frametailpos</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1487"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1807"><span class='Ref_to_Member'>spooled_rows</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN1487"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1837"><span class='Ref_to_Member'>frametail_valid</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1489"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN513"><span class='Ref_to_Const'>FRAMEOPTION_END_CURRENT_ROW</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1489"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN506"><span class='Ref_to_Const'>FRAMEOPTION_ROWS</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* In ROWS mode, exactly the rows up to current are in frame */ 
</span>            <a href="nodeWindowAgg.c.html#LN1487"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1810"><span class='Ref_to_Member'>frametailpos</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1487"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1808"><span class='Ref_to_Member'>currentpos</span></a><span class='Delimiter'>; 
</span>            <a href="nodeWindowAgg.c.html#LN1487"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1837"><span class='Ref_to_Member'>frametail_valid</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1489"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN505"><span class='Ref_to_Const'>FRAMEOPTION_RANGE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1511"></a>            <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>ftnext</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* If no ORDER BY, all rows are peers with each other */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1488"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN807"><span class='Ref_to_Member'>ordNumCols</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="nodeWindowAgg.c.html#LN178"><span class='Ref_to_Proto'>spool_tuples</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1487"><span class='Ref_To_Local'>winstate</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="nodeWindowAgg.c.html#LN1487"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1810"><span class='Ref_to_Member'>frametailpos</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1487"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1807"><span class='Ref_to_Member'>spooled_rows</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <a href="nodeWindowAgg.c.html#LN1487"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1837"><span class='Ref_to_Member'>frametail_valid</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Else we have to search for the first non-peer of the current 
             * row.  We assume the current value of frametailpos is a lower 
             * bound on the possible frame tail location, ie, frame tail never 
             * goes backward, and that currentpos is also a lower bound, ie, 
             * frame end always &GT;= current row. 
             */ 
</span>            <a href="nodeWindowAgg.c.html#LN1511"><span class='Ref_To_Local'>ftnext</span></a> <span class='Operator'>= </span><a href="../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1487"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1810"><span class='Ref_to_Member'>frametailpos</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN1487"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1808"><span class='Ref_to_Member'>currentpos</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeWindowAgg.c.html#LN193"><span class='Ref_to_Proto'>window_gettupleslot</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1485"><span class='Ref_to_Parameter'>winobj</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN1511"><span class='Ref_To_Local'>ftnext</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN1485"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>break</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* end of partition */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeWindowAgg.c.html#LN191"><span class='Ref_to_Proto'>are_peers</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1487"><span class='Ref_To_Local'>winstate</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN1485"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN1487"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1060"><span class='Ref_to_Member'>ss_ScanTupleSlot</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>break</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* not peer of current row */ 
</span>                <a href="nodeWindowAgg.c.html#LN1511"><span class='Ref_To_Local'>ftnext</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="nodeWindowAgg.c.html#LN1487"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1810"><span class='Ref_to_Member'>frametailpos</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1511"><span class='Ref_To_Local'>ftnext</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <a href="nodeWindowAgg.c.html#LN1487"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1837"><span class='Ref_to_Member'>frametail_valid</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if frameOptions&FRAMEOPT... &raquo; </span> 
        <span class='Control'>else</span> 
            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if frameOptions&FRAMEOPT... &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1489"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN521"><span class='Ref_to_Const'>FRAMEOPTION_END_VALUE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1489"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN506"><span class='Ref_to_Const'>FRAMEOPTION_ROWS</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* In ROWS mode, bound is physically n before/after current */ 
</span><a name="LN1549"></a>            <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>offset</span> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN610"><span class='Ref_to_Macro'>DatumGetInt64</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1487"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1821"><span class='Ref_to_Member'>endOffsetValue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1489"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN515"><span class='Ref_to_Const'>FRAMEOPTION_END_VALUE_PRECEDING</span></a><span class='Parentheses'>) 
</span>                <a href="nodeWindowAgg.c.html#LN1549"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>= -</span><a href="nodeWindowAgg.c.html#LN1549"><span class='Ref_To_Local'>offset</span></a><span class='Delimiter'>; 
</span> 
            <a href="nodeWindowAgg.c.html#LN1487"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1810"><span class='Ref_to_Member'>frametailpos</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1487"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1808"><span class='Ref_to_Member'>currentpos</span></a> <span class='Operator'>+ </span><a href="nodeWindowAgg.c.html#LN1549"><span class='Ref_To_Local'>offset</span></a><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* smallest allowable value of frametailpos is -1 */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1487"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1810"><span class='Ref_to_Member'>frametailpos</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="nodeWindowAgg.c.html#LN1487"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1810"><span class='Ref_to_Member'>frametailpos</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1487"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1810"><span class='Ref_to_Member'>frametailpos</span></a> <span class='Operator'>&GT; </span><a href="nodeWindowAgg.c.html#LN1487"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1808"><span class='Ref_to_Member'>currentpos</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* make sure frametailpos is not past last row of partition */ 
</span>                <a href="nodeWindowAgg.c.html#LN178"><span class='Ref_to_Proto'>spool_tuples</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1487"><span class='Ref_To_Local'>winstate</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN1487"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1810"><span class='Ref_to_Member'>frametailpos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1487"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1810"><span class='Ref_to_Member'>frametailpos</span></a> <span class='Operator'>&GT;= </span><a href="nodeWindowAgg.c.html#LN1487"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1807"><span class='Ref_to_Member'>spooled_rows</span></a><span class='Parentheses'>) 
</span>                    <a href="nodeWindowAgg.c.html#LN1487"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1810"><span class='Ref_to_Member'>frametailpos</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1487"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1807"><span class='Ref_to_Member'>spooled_rows</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="nodeWindowAgg.c.html#LN1487"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1837"><span class='Ref_to_Member'>frametail_valid</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if frameOptions&FRAMEOPT... &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1489"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN505"><span class='Ref_to_Const'>FRAMEOPTION_RANGE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* parser should have rejected this */ 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"window frame with value offset is not implemented"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if frameOptions&FRAMEOPT... &raquo; </span> 
    <span class='Control'>else</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end update_frametailpos &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ----------------- 
 * ExecWindowAgg 
 * 
 *  ExecWindowAgg receives tuples from its outer subplan and 
 *  stores them into a tuplestore, then processes window functions. 
 *  This node doesn't reduce nor qualify any row so the number of 
 *  returned rows is exactly the same as its outer subplan's result. 
 * ----------------- 
 */ 
</span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>* 
</span><a name="LN1590"></a><span class='Declare_Function'>ExecWindowAgg</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>winstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1592"></a>    <a href="../../include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>econtext</span><span class='Delimiter'>; 
</span><a name="LN1593"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN1594"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numfuncs</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1829"><span class='Ref_to_Member'>all_done</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Compute frame offset values, if any, during first call. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1828"><span class='Ref_to_Member'>all_first</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1604"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>frameOptions</span> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1817"><span class='Ref_to_Member'>frameOptions</span></a><span class='Delimiter'>; 
</span><a name="LN1605"></a>        <a href="../../include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>econtext</span> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN842"><span class='Ref_to_Member'>ps_ExprContext</span></a><span class='Delimiter'>; 
</span><a name="LN1606"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>value</span><span class='Delimiter'>; 
</span><a name="LN1607"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN1608"></a>        <a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN1609"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>byval</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1604"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN519"><span class='Ref_to_Const'>FRAMEOPTION_START_VALUE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1818"><span class='Ref_to_Member'>startOffset</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Keyword'>value </span><span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN279"><span class='Ref_to_Func'>ExecEvalExprSwitchContext</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1818"><span class='Ref_to_Member'>startOffset</span></a><span class='Delimiter'>, 
</span>                                              <a href="nodeWindowAgg.c.html#LN1605"><span class='Ref_To_Local'>econtext</span></a><span class='Delimiter'>, 
</span>                                              <span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN1607"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1607"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"frame starting offset must not be null"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* copy value into query-lifespan context */ 
</span>            <a href="../../include/utils/lsyscache.h.html#LN135"><span class='Ref_to_Proto'>get_typlenbyval</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1818"><span class='Ref_to_Member'>startOffset</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN82"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN1608"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN1609"><span class='Ref_To_Local'>byval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1820"><span class='Ref_to_Member'>startOffsetValue</span></a> <span class='Operator'>= </span><a href="../../include/utils/datum.h.html#LN30"><span class='Ref_to_Proto'>datumCopy</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN1609"><span class='Ref_To_Local'>byval</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN1608"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1604"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN506"><span class='Ref_to_Const'>FRAMEOPTION_ROWS</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* value is known to be int8 */ 
</span><a name="LN1628"></a>                <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>offset</span> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN610"><span class='Ref_to_Macro'>DatumGetInt64</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1628"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                      <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"frame starting offset must not be negative"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if frameOptions&FRAMEOPT... &raquo; </span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1604"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN521"><span class='Ref_to_Const'>FRAMEOPTION_END_VALUE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1819"><span class='Ref_to_Member'>endOffset</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Keyword'>value </span><span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN279"><span class='Ref_to_Func'>ExecEvalExprSwitchContext</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1819"><span class='Ref_to_Member'>endOffset</span></a><span class='Delimiter'>, 
</span>                                              <a href="nodeWindowAgg.c.html#LN1605"><span class='Ref_To_Local'>econtext</span></a><span class='Delimiter'>, 
</span>                                              <span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN1607"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1607"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"frame ending offset must not be null"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* copy value into query-lifespan context */ 
</span>            <a href="../../include/utils/lsyscache.h.html#LN135"><span class='Ref_to_Proto'>get_typlenbyval</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1819"><span class='Ref_to_Member'>endOffset</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN82"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN1608"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN1609"><span class='Ref_To_Local'>byval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1821"><span class='Ref_to_Member'>endOffsetValue</span></a> <span class='Operator'>= </span><a href="../../include/utils/datum.h.html#LN30"><span class='Ref_to_Proto'>datumCopy</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN1609"><span class='Ref_To_Local'>byval</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN1608"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1604"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN506"><span class='Ref_to_Const'>FRAMEOPTION_ROWS</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* value is known to be int8 */ 
</span><a name="LN1653"></a>                <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>offset</span> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN610"><span class='Ref_to_Macro'>DatumGetInt64</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1653"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"frame ending offset must not be negative"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if frameOptions&FRAMEOPT... &raquo; </span> 
        <a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1828"><span class='Ref_to_Member'>all_first</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if winstate-&GT;all_first &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1805"><span class='Ref_to_Member'>buffer</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Initialize for first partition and set current row = 0 */ 
</span>        <a href="nodeWindowAgg.c.html#LN177"><span class='Ref_to_Proto'>begin_partition</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* If there are no input rows, we'll detect that and exit below */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Advance current row within partition */ 
</span>        <a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1808"><span class='Ref_to_Member'>currentpos</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* This might mean that the frame moves, too */ 
</span>        <a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1835"><span class='Ref_to_Member'>framehead_valid</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1837"><span class='Ref_to_Member'>frametail_valid</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Spool all tuples up to and including the current row, if we haven't 
     * already 
     */ 
</span>    <a href="nodeWindowAgg.c.html#LN178"><span class='Ref_to_Proto'>spool_tuples</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1808"><span class='Ref_to_Member'>currentpos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Move to the next partition if we reached the end of this partition */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1830"><span class='Ref_to_Member'>partition_spooled</span></a> <span class='Operator'>&& 
</span>        <a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1808"><span class='Ref_to_Member'>currentpos</span></a> <span class='Operator'>&GT;= </span><a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1807"><span class='Ref_to_Member'>spooled_rows</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="nodeWindowAgg.c.html#LN179"><span class='Ref_to_Proto'>release_partition</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1833"><span class='Ref_to_Member'>more_partitions</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="nodeWindowAgg.c.html#LN177"><span class='Ref_to_Proto'>begin_partition</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1807"><span class='Ref_to_Member'>spooled_rows</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1829"><span class='Ref_to_Member'>all_done</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* final output execution is in ps_ExprContext */ 
</span>    <a href="nodeWindowAgg.c.html#LN1592"><span class='Ref_To_Local'>econtext</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN842"><span class='Ref_to_Member'>ps_ExprContext</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Clear the per-output-tuple context for current row */ 
</span>    <a href="../../include/executor/executor.h.html#LN449"><span class='Ref_to_Macro'>ResetExprContext</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1592"><span class='Ref_To_Local'>econtext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Read the current row from the tuplestore, and save in ScanTupleSlot. 
     * (We can't rely on the outerplan's output slot because we may have to 
     * read beyond the current row.  Also, we have to actually copy the row 
     * out of the tuplestore, since window function evaluation might cause the 
     * tuplestore to dump its state to disk.) 
     * 
     * Current row must be in the tuplestore, since we spooled it above. 
     */ 
</span>    <a href="../../include/utils/tuplestore.h.html#LN63"><span class='Ref_to_Proto'>tuplestore_select_read_pointer</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1805"><span class='Ref_to_Member'>buffer</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1806"><span class='Ref_to_Member'>current_ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/tuplestore.h.html#LN72"><span class='Ref_to_Proto'>tuplestore_gettupleslot</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1805"><span class='Ref_to_Member'>buffer</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                 <a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1060"><span class='Ref_to_Member'>ss_ScanTupleSlot</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected end of tuplestore"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Evaluate true window functions 
     */ 
</span>    <a href="nodeWindowAgg.c.html#LN1594"><span class='Ref_To_Local'>numfuncs</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1798"><span class='Ref_to_Member'>numfuncs</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1593"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="nodeWindowAgg.c.html#LN1593"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="nodeWindowAgg.c.html#LN1594"><span class='Ref_To_Local'>numfuncs</span></a><span class='Delimiter'>; </span><a href="nodeWindowAgg.c.html#LN1593"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1729"></a>        <a href="../../include/nodes/execnodes.h.html#LN1789"><span class='Ref_to_Typedef'>WindowStatePerFunc</span></a> <span class='Declare_Local'>perfuncstate</span> <span class='Operator'>= &</span><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1801"><span class='Ref_to_Member'>perfunc</span></a><span class='Delimiter'>[</span><a href="nodeWindowAgg.c.html#LN1593"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1729"><span class='Ref_To_Local'>perfuncstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN93"><span class='Ref_to_Member'>plain_agg</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN173"><span class='Ref_to_Proto'>eval_windowfunction</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN1729"><span class='Ref_To_Local'>perfuncstate</span></a><span class='Delimiter'>, 
</span>              <span class='Operator'>&</span><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1592"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN212"><span class='Ref_to_Member'>ecxt_aggvalues</span></a><span class='Delimiter'>[</span><a href="nodeWindowAgg.c.html#LN1729"><span class='Ref_To_Local'>perfuncstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN77"><span class='Ref_to_Member'>wfuncstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN647"><span class='Ref_to_Member'>wfuncno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <span class='Operator'>&</span><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1592"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN213"><span class='Ref_to_Member'>ecxt_aggnulls</span></a><span class='Delimiter'>[</span><a href="nodeWindowAgg.c.html#LN1729"><span class='Ref_To_Local'>perfuncstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN77"><span class='Ref_to_Member'>wfuncstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN647"><span class='Ref_to_Member'>wfuncno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Evaluate aggregates 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1799"><span class='Ref_to_Member'>numaggs</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="nodeWindowAgg.c.html#LN172"><span class='Ref_to_Proto'>eval_windowaggregates</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Truncate any no-longer-needed rows from the tuplestore. 
     */ 
</span>    <a href="../../include/utils/tuplestore.h.html#LN68"><span class='Ref_to_Proto'>tuplestore_trim</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1805"><span class='Ref_to_Member'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Form and return a projection tuple using the windowfunc results and the 
     * current row.  Setting ecxt_outertuple arranges that any Vars will be 
     * evaluated with respect to that row. 
     */ 
</span>    <a href="nodeWindowAgg.c.html#LN1592"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN198"><span class='Ref_to_Member'>ecxt_outertuple</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1060"><span class='Ref_to_Member'>ss_ScanTupleSlot</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/executor/executor.h.html#LN307"><span class='Ref_to_Func'>ExecProject</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1590"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN843"><span class='Ref_to_Member'>ps_ProjInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecWindowAgg &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ----------------- 
 * ExecInitWindowAgg 
 * 
 *  Creates the run-time information for the WindowAgg node produced by the 
 *  planner and initializes its outer subtree 
 * ----------------- 
 */ 
</span><a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>* 
</span><a name="LN1767"></a><span class='Declare_Function'>ExecInitWindowAgg</span><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN800"><span class='Ref_to_Struct'>WindowAgg</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>eflags</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1769"></a>    <a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>winstate</span><span class='Delimiter'>; 
</span><a name="LN1770"></a>    <a href="../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>outerPlan</span><span class='Delimiter'>; 
</span><a name="LN1771"></a>    <a href="../../include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>econtext</span><span class='Delimiter'>; 
</span><a name="LN1772"></a>    <a href="../../include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tmpcontext</span><span class='Delimiter'>; 
</span><a name="LN1773"></a>    <a href="../../include/nodes/execnodes.h.html#LN1789"><span class='Ref_to_Typedef'>WindowStatePerFunc</span></a> <span class='Declare_Local'>perfunc</span><span class='Delimiter'>; 
</span><a name="LN1774"></a>    <a href="../../include/nodes/execnodes.h.html#LN1790"><span class='Ref_to_Typedef'>WindowStatePerAgg</span></a> <span class='Declare_Local'>peragg</span><span class='Delimiter'>; 
</span><a name="LN1775"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numfuncs</span><span class='Delimiter'>, 
</span><a name="LN1776"></a>                <span class='Declare_Local'>wfuncno</span><span class='Delimiter'>, 
</span><a name="LN1777"></a>                <span class='Declare_Local'>numaggs</span><span class='Delimiter'>, 
</span><a name="LN1778"></a>                <span class='Declare_Local'>aggno</span><span class='Delimiter'>; 
</span><a name="LN1779"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* check for unsupported flags */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1767"><span class='Ref_to_Parameter'>eflags</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><a href="../../include/executor/executor.h.html#LN59"><span class='Ref_to_Const'>EXEC_FLAG_BACKWARD</span></a> <span class='Operator'>| </span><a href="../../include/executor/executor.h.html#LN60"><span class='Ref_to_Const'>EXEC_FLAG_MARK</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * create state structure 
     */ 
</span>    <a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN812"><span class='Ref_to_Member'>plan</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeWindowAgg.c.html#LN1767"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN814"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1767"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create expression contexts.  We need two, one for per-input-tuple 
     * processing and one for per-output-tuple processing.  We cheat a little 
     * by using ExecAssignExprContext() to build both. 
     */ 
</span>    <a href="execUtils.c.html#LN416"><span class='Ref_to_Func'>ExecAssignExprContext</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1767"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN1772"><span class='Ref_To_Local'>tmpcontext</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN842"><span class='Ref_to_Member'>ps_ExprContext</span></a><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1826"><span class='Ref_to_Member'>tmpcontext</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1772"><span class='Ref_To_Local'>tmpcontext</span></a><span class='Delimiter'>; 
</span>    <a href="execUtils.c.html#LN416"><span class='Ref_to_Func'>ExecAssignExprContext</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1767"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create long-lived context for storage of partition-local memory etc */ 
</span>    <a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1823"><span class='Ref_to_Member'>partcontext</span></a> <span class='Operator'>= 
</span>        <a href="../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, 
</span>                              <span class='String'>"WindowAgg Partition"</span><span class='Delimiter'>, 
</span>                              <a href="../../include/utils/memutils.h.html#LN164"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create mid-lived context for aggregate trans values etc. 
     * 
     * Note that moving aggregates each use their own private context, not 
     * this one. 
     */ 
</span>    <a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1824"><span class='Ref_to_Member'>aggcontext</span></a> <span class='Operator'>= 
</span>        <a href="../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, 
</span>                              <span class='String'>"WindowAgg Aggregates"</span><span class='Delimiter'>, 
</span>                              <a href="../../include/utils/memutils.h.html#LN164"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * tuple table initialization 
     */ 
</span>    <a href="../../include/executor/executor.h.html#LN401"><span class='Ref_to_Proto'>ExecInitScanTupleSlot</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1767"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/executor/executor.h.html#LN400"><span class='Ref_to_Proto'>ExecInitResultTupleSlot</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1767"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1840"><span class='Ref_to_Member'>first_part_slot</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN402"><span class='Ref_to_Proto'>ExecInitExtraTupleSlot</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1767"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1844"><span class='Ref_to_Member'>agg_row_slot</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN402"><span class='Ref_to_Proto'>ExecInitExtraTupleSlot</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1767"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1845"><span class='Ref_to_Member'>temp_slot_1</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN402"><span class='Ref_to_Proto'>ExecInitExtraTupleSlot</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1767"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1846"><span class='Ref_to_Member'>temp_slot_2</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN402"><span class='Ref_to_Proto'>ExecInitExtraTupleSlot</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1767"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * WindowAgg nodes never have quals, since they can only occur at the 
     * logical top level of a query (ie, after any WHERE or HAVING filters) 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1767"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN802"><span class='Ref_to_Member'>plan</span></a><span class='Operator'>.</span><a href="../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN826"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initialize child nodes 
     */ 
</span>    <a href="nodeWindowAgg.c.html#LN1770"><span class='Ref_To_Local'>outerPlan</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1770"><span class='Ref_To_Local'>outerPlan</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1767"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/execnodes.h.html#LN854"><span class='Ref_to_Macro'>outerPlanState</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Parentheses'>) </span><span class='Operator'>= </span><a href="execProcnode.c.html#LN138"><span class='Ref_to_Func'>ExecInitNode</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1770"><span class='Ref_To_Local'>outerPlan</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN1767"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN1767"><span class='Ref_to_Parameter'>eflags</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initialize source tuple type (which is also the tuple type that we'll 
     * store in the tuplestore and use in all our working slots). 
     */ 
</span>    <a href="../../include/executor/executor.h.html#LN478"><span class='Ref_to_Proto'>ExecAssignScanTypeFromOuterPlan</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/executor/tuptable.h.html#LN146"><span class='Ref_to_Proto'>ExecSetSlotDescriptor</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1840"><span class='Ref_to_Member'>first_part_slot</span></a><span class='Delimiter'>, 
</span>                          <a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1060"><span class='Ref_to_Member'>ss_ScanTupleSlot</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/tuptable.h.html#LN120"><span class='Ref_to_Member'>tts_tupleDescriptor</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/executor/tuptable.h.html#LN146"><span class='Ref_to_Proto'>ExecSetSlotDescriptor</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1844"><span class='Ref_to_Member'>agg_row_slot</span></a><span class='Delimiter'>, 
</span>                          <a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1060"><span class='Ref_to_Member'>ss_ScanTupleSlot</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/tuptable.h.html#LN120"><span class='Ref_to_Member'>tts_tupleDescriptor</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/executor/tuptable.h.html#LN146"><span class='Ref_to_Proto'>ExecSetSlotDescriptor</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1845"><span class='Ref_to_Member'>temp_slot_1</span></a><span class='Delimiter'>, 
</span>                          <a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1060"><span class='Ref_to_Member'>ss_ScanTupleSlot</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/tuptable.h.html#LN120"><span class='Ref_to_Member'>tts_tupleDescriptor</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/executor/tuptable.h.html#LN146"><span class='Ref_to_Proto'>ExecSetSlotDescriptor</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1846"><span class='Ref_to_Member'>temp_slot_2</span></a><span class='Delimiter'>, 
</span>                          <a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1060"><span class='Ref_to_Member'>ss_ScanTupleSlot</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/tuptable.h.html#LN120"><span class='Ref_to_Member'>tts_tupleDescriptor</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Initialize result tuple type and projection info. 
     */ 
</span>    <a href="execUtils.c.html#LN438"><span class='Ref_to_Func'>ExecAssignResultTypeFromTL</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/executor/executor.h.html#LN474"><span class='Ref_to_Proto'>ExecAssignProjectionInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Set up data for comparing tuples */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1767"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN804"><span class='Ref_to_Member'>partNumCols</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1803"><span class='Ref_to_Member'>partEqfunctions</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN126"><span class='Ref_to_Proto'>execTuplesMatchPrepare</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1767"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN804"><span class='Ref_to_Member'>partNumCols</span></a><span class='Delimiter'>, 
</span>                                                        <a href="nodeWindowAgg.c.html#LN1767"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN806"><span class='Ref_to_Member'>partOperators</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1767"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN807"><span class='Ref_to_Member'>ordNumCols</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1804"><span class='Ref_to_Member'>ordEqfunctions</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN126"><span class='Ref_to_Proto'>execTuplesMatchPrepare</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1767"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN807"><span class='Ref_to_Member'>ordNumCols</span></a><span class='Delimiter'>, 
</span>                                                          <a href="nodeWindowAgg.c.html#LN1767"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN809"><span class='Ref_to_Member'>ordOperators</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * WindowAgg nodes use aggvalues and aggnulls as well as Agg nodes. 
     */ 
</span>    <a href="nodeWindowAgg.c.html#LN1775"><span class='Ref_To_Local'>numfuncs</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1798"><span class='Ref_to_Member'>numfuncs</span></a><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN1777"><span class='Ref_To_Local'>numaggs</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1799"><span class='Ref_to_Member'>numaggs</span></a><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN1771"><span class='Ref_To_Local'>econtext</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN842"><span class='Ref_to_Member'>ps_ExprContext</span></a><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN1771"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN212"><span class='Ref_to_Member'>ecxt_aggvalues</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="nodeWindowAgg.c.html#LN1775"><span class='Ref_To_Local'>numfuncs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN1771"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN213"><span class='Ref_to_Member'>ecxt_aggnulls</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="nodeWindowAgg.c.html#LN1775"><span class='Ref_To_Local'>numfuncs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * allocate per-wfunc/per-agg state information. 
     */ 
</span>    <a href="nodeWindowAgg.c.html#LN1773"><span class='Ref_To_Local'>perfunc</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1789"><span class='Ref_to_Typedef'>WindowStatePerFunc</span></a><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN74"><span class='Ref_to_Struct'>WindowStatePerFuncData</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="nodeWindowAgg.c.html#LN1775"><span class='Ref_To_Local'>numfuncs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN1774"><span class='Ref_To_Local'>peragg</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1790"><span class='Ref_to_Typedef'>WindowStatePerAgg</span></a><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN102"><span class='Ref_to_Struct'>WindowStatePerAggData</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="nodeWindowAgg.c.html#LN1777"><span class='Ref_To_Local'>numaggs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1801"><span class='Ref_to_Member'>perfunc</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1773"><span class='Ref_To_Local'>perfunc</span></a><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1802"><span class='Ref_to_Member'>peragg</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1774"><span class='Ref_To_Local'>peragg</span></a><span class='Delimiter'>; 
</span> 
    <a href="nodeWindowAgg.c.html#LN1776"><span class='Ref_To_Local'>wfuncno</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN1778"><span class='Ref_To_Local'>aggno</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1779"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1797"><span class='Ref_to_Member'>funcs</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1891"></a>        <a href="../../include/nodes/execnodes.h.html#LN641"><span class='Ref_to_Struct'>WindowFuncExprState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>wfuncstate</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN641"><span class='Ref_to_Struct'>WindowFuncExprState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1779"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1892"></a>        <a href="../../include/nodes/primnodes.h.html#LN351"><span class='Ref_to_Struct'>WindowFunc</span></a> <span class='Operator'>*</span><span class='Declare_Local'>wfunc</span> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1891"><span class='Ref_To_Local'>wfuncstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN644"><span class='Ref_to_Member'>wfunc</span></a><span class='Delimiter'>; 
</span><a name="LN1893"></a>        <a href="../../include/nodes/execnodes.h.html#LN1789"><span class='Ref_to_Typedef'>WindowStatePerFunc</span></a> <span class='Declare_Local'>perfuncstate</span><span class='Delimiter'>; 
</span><a name="LN1894"></a>        <a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span><a name="LN1895"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1892"><span class='Ref_To_Local'>wfunc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN360"><span class='Ref_to_Member'>winref</span></a> <span class='Operator'>!= </span><a href="nodeWindowAgg.c.html#LN1767"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN803"><span class='Ref_to_Member'>winref</span></a><span class='Parentheses'>)</span>      <span class='Comment_Single_Line'>/* planner screwed up? */ 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"WindowFunc with winref %u assigned to WindowAgg with winref %u"</span><span class='Delimiter'>, 
</span>                 <a href="nodeWindowAgg.c.html#LN1892"><span class='Ref_To_Local'>wfunc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN360"><span class='Ref_to_Member'>winref</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN1767"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN803"><span class='Ref_to_Member'>winref</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Look for a previous duplicate window function */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1895"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="nodeWindowAgg.c.html#LN1895"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="nodeWindowAgg.c.html#LN1776"><span class='Ref_To_Local'>wfuncno</span></a><span class='Delimiter'>; </span><a href="nodeWindowAgg.c.html#LN1895"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1892"><span class='Ref_To_Local'>wfunc</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN1773"><span class='Ref_To_Local'>perfunc</span></a><span class='Delimiter'>[</span><a href="nodeWindowAgg.c.html#LN1895"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="nodeWindowAgg.c.html#LN78"><span class='Ref_to_Member'>wfunc</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>                <span class='Operator'>!</span><a href="../../include/optimizer/clauses.h.html#LN60"><span class='Ref_to_Proto'>contain_volatile_functions</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeWindowAgg.c.html#LN1892"><span class='Ref_To_Local'>wfunc</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1895"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="nodeWindowAgg.c.html#LN1776"><span class='Ref_To_Local'>wfuncno</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Found a match to an existing entry, so just mark it */ 
</span>            <a href="nodeWindowAgg.c.html#LN1891"><span class='Ref_To_Local'>wfuncstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN647"><span class='Ref_to_Member'>wfuncno</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1895"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Nope, so assign a new PerAgg record */ 
</span>        <a href="nodeWindowAgg.c.html#LN1893"><span class='Ref_To_Local'>perfuncstate</span></a> <span class='Operator'>= &</span><a href="nodeWindowAgg.c.html#LN1773"><span class='Ref_To_Local'>perfunc</span></a><span class='Delimiter'>[</span><span class='Operator'>++</span><a href="nodeWindowAgg.c.html#LN1776"><span class='Ref_To_Local'>wfuncno</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Comment_Multi_Line'>/* Mark WindowFunc state node with assigned index in the result array */ 
</span>        <a href="nodeWindowAgg.c.html#LN1891"><span class='Ref_To_Local'>wfuncstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN647"><span class='Ref_to_Member'>wfuncno</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1776"><span class='Ref_To_Local'>wfuncno</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Check permission to call window function */ 
</span>        <a href="nodeWindowAgg.c.html#LN1894"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN285"><span class='Ref_to_Proto'>pg_proc_aclcheck</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1892"><span class='Ref_To_Local'>wfunc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN354"><span class='Ref_to_Member'>winfnoid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                                     <a href="../../include/nodes/parsenodes.h.html#LN78"><span class='Ref_to_Const'>ACL_EXECUTE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1894"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1894"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN184"><span class='Ref_to_EnumConst'>ACL_KIND_PROC</span></a><span class='Delimiter'>, 
</span>                           <a href="../../include/utils/lsyscache.h.html#LN110"><span class='Ref_to_Proto'>get_func_name</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1892"><span class='Ref_To_Local'>wfunc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN354"><span class='Ref_to_Member'>winfnoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../include/catalog/objectaccess.h.html#LN178"><span class='Ref_to_Macro'>InvokeFunctionExecuteHook</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1892"><span class='Ref_To_Local'>wfunc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN354"><span class='Ref_to_Member'>winfnoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Fill in the perfuncstate data */ 
</span>        <a href="nodeWindowAgg.c.html#LN1893"><span class='Ref_To_Local'>perfuncstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN77"><span class='Ref_to_Member'>wfuncstate</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1891"><span class='Ref_To_Local'>wfuncstate</span></a><span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN1893"><span class='Ref_To_Local'>perfuncstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN78"><span class='Ref_to_Member'>wfunc</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1892"><span class='Ref_To_Local'>wfunc</span></a><span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN1893"><span class='Ref_To_Local'>perfuncstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN80"><span class='Ref_to_Member'>numArguments</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1891"><span class='Ref_To_Local'>wfuncstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN645"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/fmgr.h.html#LN99"><span class='Ref_to_Proto'>fmgr_info_cxt</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1892"><span class='Ref_To_Local'>wfunc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN354"><span class='Ref_to_Member'>winfnoid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN1893"><span class='Ref_To_Local'>perfuncstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN82"><span class='Ref_to_Member'>flinfo</span></a><span class='Delimiter'>, 
</span>                      <a href="nodeWindowAgg.c.html#LN1771"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN201"><span class='Ref_to_Member'>ecxt_per_query_memory</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/fmgr.h.html#LN103"><span class='Ref_to_Macro'>fmgr_info_set_expr</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeWindowAgg.c.html#LN1892"><span class='Ref_To_Local'>wfunc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN1893"><span class='Ref_To_Local'>perfuncstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN82"><span class='Ref_to_Member'>flinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="nodeWindowAgg.c.html#LN1893"><span class='Ref_To_Local'>perfuncstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN84"><span class='Ref_to_Member'>winCollation</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1892"><span class='Ref_To_Local'>wfunc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN357"><span class='Ref_to_Member'>inputcollid</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/lsyscache.h.html#LN135"><span class='Ref_to_Proto'>get_typlenbyval</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1892"><span class='Ref_To_Local'>wfunc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN355"><span class='Ref_to_Member'>wintype</span></a><span class='Delimiter'>, 
</span>                        <span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN1893"><span class='Ref_To_Local'>perfuncstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN90"><span class='Ref_to_Member'>resulttypeLen</span></a><span class='Delimiter'>, 
</span>                        <span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN1893"><span class='Ref_To_Local'>perfuncstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN91"><span class='Ref_to_Member'>resulttypeByVal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If it's really just a plain aggregate function, we'll emulate the 
         * Agg environment for it. 
         */ 
</span>        <a href="nodeWindowAgg.c.html#LN1893"><span class='Ref_To_Local'>perfuncstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN93"><span class='Ref_to_Member'>plain_agg</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1892"><span class='Ref_To_Local'>wfunc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN362"><span class='Ref_to_Member'>winagg</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1892"><span class='Ref_To_Local'>wfunc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN362"><span class='Ref_to_Member'>winagg</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1951"></a>            <a href="../../include/nodes/execnodes.h.html#LN1790"><span class='Ref_to_Typedef'>WindowStatePerAgg</span></a> <span class='Declare_Local'>peraggstate</span><span class='Delimiter'>; 
</span> 
            <a href="nodeWindowAgg.c.html#LN1893"><span class='Ref_To_Local'>perfuncstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN94"><span class='Ref_to_Member'>aggno</span></a> <span class='Operator'>= ++</span><a href="nodeWindowAgg.c.html#LN1778"><span class='Ref_To_Local'>aggno</span></a><span class='Delimiter'>; 
</span>            <a href="nodeWindowAgg.c.html#LN1951"><span class='Ref_To_Local'>peraggstate</span></a> <span class='Operator'>= &</span><a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1802"><span class='Ref_to_Member'>peragg</span></a><span class='Delimiter'>[</span><a href="nodeWindowAgg.c.html#LN1778"><span class='Ref_To_Local'>aggno</span></a><span class='Delimiter'>]; 
</span>            <a href="nodeWindowAgg.c.html#LN186"><span class='Ref_to_Proto'>initialize_peragg</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN1892"><span class='Ref_To_Local'>wfunc</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN1951"><span class='Ref_To_Local'>peraggstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="nodeWindowAgg.c.html#LN1951"><span class='Ref_To_Local'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN143"><span class='Ref_to_Member'>wfuncno</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1776"><span class='Ref_To_Local'>wfuncno</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1960"></a>            <a href="../../include/windowapi.h.html#LN36"><span class='Ref_to_Typedef'>WindowObject</span></a> <span class='Declare_Local'>winobj</span> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN58"><span class='Ref_to_Struct'>WindowObjectData</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="nodeWindowAgg.c.html#LN1960"><span class='Ref_To_Local'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN61"><span class='Ref_to_Member'>winstate</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Delimiter'>; 
</span>            <a href="nodeWindowAgg.c.html#LN1960"><span class='Ref_To_Local'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN62"><span class='Ref_to_Member'>argstates</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1891"><span class='Ref_To_Local'>wfuncstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN645"><span class='Ref_to_Member'>args</span></a><span class='Delimiter'>; 
</span>            <a href="nodeWindowAgg.c.html#LN1960"><span class='Ref_To_Local'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN63"><span class='Ref_to_Member'>localmem</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="nodeWindowAgg.c.html#LN1893"><span class='Ref_To_Local'>perfuncstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN96"><span class='Ref_to_Member'>winobj</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1960"><span class='Ref_To_Local'>winobj</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Update numfuncs, numaggs to match number of unique functions found */ 
</span>    <a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1798"><span class='Ref_to_Member'>numfuncs</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1776"><span class='Ref_To_Local'>wfuncno</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1799"><span class='Ref_to_Member'>numaggs</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1778"><span class='Ref_To_Local'>aggno</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Set up WindowObject for aggregates, if needed */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1799"><span class='Ref_to_Member'>numaggs</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1976"></a>        <a href="../../include/windowapi.h.html#LN36"><span class='Ref_to_Typedef'>WindowObject</span></a> <span class='Declare_Local'>agg_winobj</span> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN58"><span class='Ref_to_Struct'>WindowObjectData</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="nodeWindowAgg.c.html#LN1976"><span class='Ref_To_Local'>agg_winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN61"><span class='Ref_to_Member'>winstate</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN1976"><span class='Ref_To_Local'>agg_winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN62"><span class='Ref_to_Member'>argstates</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN1976"><span class='Ref_To_Local'>agg_winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN63"><span class='Ref_to_Member'>localmem</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* make sure markptr = -1 to invalidate. It may not get used */ 
</span>        <a href="nodeWindowAgg.c.html#LN1976"><span class='Ref_To_Local'>agg_winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN64"><span class='Ref_to_Member'>markptr</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN1976"><span class='Ref_To_Local'>agg_winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN65"><span class='Ref_to_Member'>readptr</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1812"><span class='Ref_to_Member'>agg_winobj</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1976"><span class='Ref_To_Local'>agg_winobj</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* copy frame options to state node for easy access */ 
</span>    <a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1817"><span class='Ref_to_Member'>frameOptions</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN1767"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN810"><span class='Ref_to_Member'>frameOptions</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* initialize frame bound offset expressions */ 
</span>    <a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1818"><span class='Ref_to_Member'>startOffset</span></a> <span class='Operator'>= </span><a href="execExpr.c.html#LN111"><span class='Ref_to_Func'>ExecInitExpr</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeWindowAgg.c.html#LN1767"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN811"><span class='Ref_to_Member'>startOffset</span></a><span class='Delimiter'>, 
</span>                                         <span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1819"><span class='Ref_to_Member'>endOffset</span></a> <span class='Operator'>= </span><a href="execExpr.c.html#LN111"><span class='Ref_to_Func'>ExecInitExpr</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeWindowAgg.c.html#LN1767"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN812"><span class='Ref_to_Member'>endOffset</span></a><span class='Delimiter'>, 
</span>                                       <span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1828"><span class='Ref_to_Member'>all_first</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1830"><span class='Ref_to_Member'>partition_spooled</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1833"><span class='Ref_to_Member'>more_partitions</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="nodeWindowAgg.c.html#LN1769"><span class='Ref_To_Local'>winstate</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecInitWindowAgg &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ----------------- 
 * ExecEndWindowAgg 
 * ----------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2008"></a><span class='Declare_Function'>ExecEndWindowAgg</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2010"></a>    <a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>outerPlan</span><span class='Delimiter'>; 
</span><a name="LN2011"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="nodeWindowAgg.c.html#LN179"><span class='Ref_to_Proto'>release_partition</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2008"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/executor/tuptable.h.html#LN154"><span class='Ref_to_Proto'>ExecClearTuple</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2008"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1060"><span class='Ref_to_Member'>ss_ScanTupleSlot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/executor/tuptable.h.html#LN154"><span class='Ref_to_Proto'>ExecClearTuple</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2008"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1840"><span class='Ref_to_Member'>first_part_slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/executor/tuptable.h.html#LN154"><span class='Ref_to_Proto'>ExecClearTuple</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2008"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1844"><span class='Ref_to_Member'>agg_row_slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/executor/tuptable.h.html#LN154"><span class='Ref_to_Proto'>ExecClearTuple</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2008"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1845"><span class='Ref_to_Member'>temp_slot_1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/executor/tuptable.h.html#LN154"><span class='Ref_to_Proto'>ExecClearTuple</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2008"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1846"><span class='Ref_to_Member'>temp_slot_2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Free both the expr contexts. 
     */ 
</span>    <a href="../../include/executor/executor.h.html#LN476"><span class='Ref_to_Proto'>ExecFreeExprContext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN2008"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN2008"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN842"><span class='Ref_to_Member'>ps_ExprContext</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2008"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1826"><span class='Ref_to_Member'>tmpcontext</span></a><span class='Delimiter'>; 
</span>    <a href="../../include/executor/executor.h.html#LN476"><span class='Ref_to_Proto'>ExecFreeExprContext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN2008"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2011"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="nodeWindowAgg.c.html#LN2011"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="nodeWindowAgg.c.html#LN2008"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1799"><span class='Ref_to_Member'>numaggs</span></a><span class='Delimiter'>; </span><a href="nodeWindowAgg.c.html#LN2011"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2008"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1802"><span class='Ref_to_Member'>peragg</span></a><span class='Delimiter'>[</span><a href="nodeWindowAgg.c.html#LN2011"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="nodeWindowAgg.c.html#LN146"><span class='Ref_to_Member'>aggcontext</span></a> <span class='Operator'>!= </span><a href="nodeWindowAgg.c.html#LN2008"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1824"><span class='Ref_to_Member'>aggcontext</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2008"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1802"><span class='Ref_to_Member'>peragg</span></a><span class='Delimiter'>[</span><a href="nodeWindowAgg.c.html#LN2011"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="nodeWindowAgg.c.html#LN146"><span class='Ref_to_Member'>aggcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2008"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1823"><span class='Ref_to_Member'>partcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2008"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1824"><span class='Ref_to_Member'>aggcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2008"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1801"><span class='Ref_to_Member'>perfunc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2008"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1802"><span class='Ref_to_Member'>peragg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="nodeWindowAgg.c.html#LN2010"><span class='Ref_To_Local'>outerPlan</span></a> <span class='Operator'>= </span><a href="../../include/nodes/execnodes.h.html#LN854"><span class='Ref_to_Macro'>outerPlanState</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2008"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/executor/executor.h.html#LN231"><span class='Ref_to_Proto'>ExecEndNode</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2010"><span class='Ref_To_Local'>outerPlan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecEndWindowAgg &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ----------------- 
 * ExecReScanWindowAgg 
 * ----------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2048"></a><span class='Declare_Function'>ExecReScanWindowAgg</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2050"></a>    <a href="../../include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>outerPlan</span> <span class='Operator'>= </span><a href="../../include/nodes/execnodes.h.html#LN854"><span class='Ref_to_Macro'>outerPlanState</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2048"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2051"></a>    <a href="../../include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>econtext</span> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2048"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN842"><span class='Ref_to_Member'>ps_ExprContext</span></a><span class='Delimiter'>; 
</span> 
    <a href="nodeWindowAgg.c.html#LN2048"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1829"><span class='Ref_to_Member'>all_done</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN2048"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1828"><span class='Ref_to_Member'>all_first</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* release tuplestore et al */ 
</span>    <a href="nodeWindowAgg.c.html#LN179"><span class='Ref_to_Proto'>release_partition</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2048"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* release all temp tuples, but especially first_part_slot */ 
</span>    <a href="../../include/executor/tuptable.h.html#LN154"><span class='Ref_to_Proto'>ExecClearTuple</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2048"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1060"><span class='Ref_to_Member'>ss_ScanTupleSlot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/executor/tuptable.h.html#LN154"><span class='Ref_to_Proto'>ExecClearTuple</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2048"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1840"><span class='Ref_to_Member'>first_part_slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/executor/tuptable.h.html#LN154"><span class='Ref_to_Proto'>ExecClearTuple</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2048"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1844"><span class='Ref_to_Member'>agg_row_slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/executor/tuptable.h.html#LN154"><span class='Ref_to_Proto'>ExecClearTuple</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2048"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1845"><span class='Ref_to_Member'>temp_slot_1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/executor/tuptable.h.html#LN154"><span class='Ref_to_Proto'>ExecClearTuple</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2048"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1846"><span class='Ref_to_Member'>temp_slot_2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Forget current wfunc values */ 
</span>    <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2051"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN212"><span class='Ref_to_Member'>ecxt_aggvalues</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="nodeWindowAgg.c.html#LN2048"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1798"><span class='Ref_to_Member'>numfuncs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2051"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN213"><span class='Ref_to_Member'>ecxt_aggnulls</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="nodeWindowAgg.c.html#LN2048"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1798"><span class='Ref_to_Member'>numfuncs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * if chgParam of subnode is not null then plan will be re-scanned by 
     * first ExecProcNode. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2050"><span class='Ref_To_Local'>outerPlan</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN836"><span class='Ref_to_Member'>chgParam</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="execAmi.c.html#LN73"><span class='Ref_to_Func'>ExecReScan</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2050"><span class='Ref_To_Local'>outerPlan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecReScanWindowAgg &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * initialize_peragg 
 * 
 * Almost same as in nodeAgg.c, except we don't support DISTINCT currently. 
 */ 
</span><span class='Keyword'>static </span><a href="nodeWindowAgg.c.html#LN102"><span class='Ref_to_Struct'>WindowStatePerAggData</span></a> <span class='Operator'>* 
</span><a name="LN2084"></a><span class='Declare_Function'>initialize_peragg</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>winstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN351"><span class='Ref_to_Struct'>WindowFunc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>wfunc</span><span class='Delimiter'>, 
</span><a name="LN2085"></a>                  <a href="../../include/nodes/execnodes.h.html#LN1790"><span class='Ref_to_Typedef'>WindowStatePerAgg</span></a> <span class='Declare_Parameter'>peraggstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2087"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>inputTypes</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN36"><span class='Ref_to_Const'>FUNC_MAX_ARGS</span></a><span class='Delimiter'>]; 
</span><a name="LN2088"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numArguments</span><span class='Delimiter'>; 
</span><a name="LN2089"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>aggTuple</span><span class='Delimiter'>; 
</span><a name="LN2090"></a>    <a href="../../include/catalog/pg_aggregate.h.html#LN86"><span class='Ref_to_Typedef'>Form_pg_aggregate</span></a> <span class='Declare_Local'>aggform</span><span class='Delimiter'>; 
</span><a name="LN2091"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>aggtranstype</span><span class='Delimiter'>; 
</span><a name="LN2092"></a>    <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>initvalAttNo</span><span class='Delimiter'>; 
</span><a name="LN2093"></a>    <a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span><a name="LN2094"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>transfn_oid</span><span class='Delimiter'>, 
</span><a name="LN2095"></a>                <span class='Declare_Local'>invtransfn_oid</span><span class='Delimiter'>, 
</span><a name="LN2096"></a>                <span class='Declare_Local'>finalfn_oid</span><span class='Delimiter'>; 
</span><a name="LN2097"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>finalextra</span><span class='Delimiter'>; 
</span><a name="LN2098"></a>    <a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>transfnexpr</span><span class='Delimiter'>, 
</span><a name="LN2099"></a>               <span class='Operator'>*</span><span class='Declare_Local'>invtransfnexpr</span><span class='Delimiter'>, 
</span><a name="LN2100"></a>               <span class='Operator'>*</span><span class='Declare_Local'>finalfnexpr</span><span class='Delimiter'>; 
</span><a name="LN2101"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>textInitVal</span><span class='Delimiter'>; 
</span><a name="LN2102"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN2103"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <a href="nodeWindowAgg.c.html#LN2088"><span class='Ref_To_Local'>numArguments</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2084"><span class='Ref_to_Parameter'>wfunc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN358"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="nodeWindowAgg.c.html#LN2102"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2103"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2084"><span class='Ref_to_Parameter'>wfunc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN358"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="nodeWindowAgg.c.html#LN2087"><span class='Ref_To_Local'>inputTypes</span></a><span class='Delimiter'>[</span><a href="nodeWindowAgg.c.html#LN2102"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2103"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="nodeWindowAgg.c.html#LN2089"><span class='Ref_To_Local'>aggTuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN33"><span class='Ref_to_EnumConst'>AGGFNOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2084"><span class='Ref_to_Parameter'>wfunc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN354"><span class='Ref_to_Member'>winfnoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2089"><span class='Ref_To_Local'>aggTuple</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for aggregate %u"</span><span class='Delimiter'>, 
</span>             <a href="nodeWindowAgg.c.html#LN2084"><span class='Ref_to_Parameter'>wfunc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN354"><span class='Ref_to_Member'>winfnoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN2090"><span class='Ref_To_Local'>aggform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_aggregate.h.html#LN86"><span class='Ref_to_Typedef'>Form_pg_aggregate</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2089"><span class='Ref_To_Local'>aggTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Figure out whether we want to use the moving-aggregate implementation, 
     * and collect the right set of fields from the pg_attribute entry. 
     * 
     * If the frame head can't move, we don't need moving-aggregate code. Even 
     * if we'd like to use it, don't do so if the aggregate's arguments (and 
     * FILTER clause if any) contain any calls to volatile functions. 
     * Otherwise, the difference between restarting and not restarting the 
     * aggregation would be user-visible. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2090"><span class='Ref_To_Local'>aggform</span></a><span class='Operator'>-&GT;</span>aggminvtransfn<span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>        <span class='Operator'>!</span><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2084"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1817"><span class='Ref_to_Member'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN508"><span class='Ref_to_Const'>FRAMEOPTION_START_UNBOUNDED_PRECEDING</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="../../include/optimizer/clauses.h.html#LN60"><span class='Ref_to_Proto'>contain_volatile_functions</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeWindowAgg.c.html#LN2084"><span class='Ref_to_Parameter'>wfunc</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="nodeWindowAgg.c.html#LN2085"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN105"><span class='Ref_to_Member'>transfn_oid</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2094"><span class='Ref_To_Local'>transfn_oid</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2090"><span class='Ref_To_Local'>aggform</span></a><span class='Operator'>-&GT;</span>aggmtransfn<span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN2085"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN106"><span class='Ref_to_Member'>invtransfn_oid</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2095"><span class='Ref_To_Local'>invtransfn_oid</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2090"><span class='Ref_To_Local'>aggform</span></a><span class='Operator'>-&GT;</span>aggminvtransfn<span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN2085"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN107"><span class='Ref_to_Member'>finalfn_oid</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2096"><span class='Ref_To_Local'>finalfn_oid</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2090"><span class='Ref_To_Local'>aggform</span></a><span class='Operator'>-&GT;</span>aggmfinalfn<span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN2097"><span class='Ref_To_Local'>finalextra</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2090"><span class='Ref_To_Local'>aggform</span></a><span class='Operator'>-&GT;</span>aggmfinalextra<span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN2091"><span class='Ref_To_Local'>aggtranstype</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2090"><span class='Ref_To_Local'>aggform</span></a><span class='Operator'>-&GT;</span>aggmtranstype<span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN2092"><span class='Ref_To_Local'>initvalAttNo</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_aggregate.h.html#LN113"><span class='Ref_to_Const'>Anum_pg_aggregate_aggminitval</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="nodeWindowAgg.c.html#LN2085"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN105"><span class='Ref_to_Member'>transfn_oid</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2094"><span class='Ref_To_Local'>transfn_oid</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2090"><span class='Ref_To_Local'>aggform</span></a><span class='Operator'>-&GT;</span>aggtransfn<span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN2085"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN106"><span class='Ref_to_Member'>invtransfn_oid</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2095"><span class='Ref_To_Local'>invtransfn_oid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN2085"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN107"><span class='Ref_to_Member'>finalfn_oid</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2096"><span class='Ref_To_Local'>finalfn_oid</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2090"><span class='Ref_To_Local'>aggform</span></a><span class='Operator'>-&GT;</span>aggfinalfn<span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN2097"><span class='Ref_To_Local'>finalextra</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2090"><span class='Ref_To_Local'>aggform</span></a><span class='Operator'>-&GT;</span>aggfinalextra<span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN2091"><span class='Ref_To_Local'>aggtranstype</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2090"><span class='Ref_To_Local'>aggform</span></a><span class='Operator'>-&GT;</span>aggtranstype<span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN2092"><span class='Ref_To_Local'>initvalAttNo</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_aggregate.h.html#LN112"><span class='Ref_to_Const'>Anum_pg_aggregate_agginitval</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * ExecInitWindowAgg already checked permission to call aggregate function 
     * ... but we still need to check the component functions 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* Check that aggregate owner has permission to call component fns */ 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2157"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>procTuple</span><span class='Delimiter'>; 
</span><a name="LN2158"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>aggOwner</span><span class='Delimiter'>; 
</span> 
        <a href="nodeWindowAgg.c.html#LN2157"><span class='Ref_To_Local'>procTuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN76"><span class='Ref_to_EnumConst'>PROCOID</span></a><span class='Delimiter'>, 
</span>                                    <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2084"><span class='Ref_to_Parameter'>wfunc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN354"><span class='Ref_to_Member'>winfnoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2157"><span class='Ref_To_Local'>procTuple</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for function %u"</span><span class='Delimiter'>, 
</span>                 <a href="nodeWindowAgg.c.html#LN2084"><span class='Ref_to_Parameter'>wfunc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN354"><span class='Ref_to_Member'>winfnoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN2158"><span class='Ref_To_Local'>aggOwner</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_proc.h.html#LN82"><span class='Ref_to_Typedef'>Form_pg_proc</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2157"><span class='Ref_To_Local'>procTuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>proowner<span class='Delimiter'>; 
</span>        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2157"><span class='Ref_To_Local'>procTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="nodeWindowAgg.c.html#LN2093"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN285"><span class='Ref_to_Proto'>pg_proc_aclcheck</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2094"><span class='Ref_To_Local'>transfn_oid</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2158"><span class='Ref_To_Local'>aggOwner</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../include/nodes/parsenodes.h.html#LN78"><span class='Ref_to_Const'>ACL_EXECUTE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2093"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2093"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN184"><span class='Ref_to_EnumConst'>ACL_KIND_PROC</span></a><span class='Delimiter'>, 
</span>                           <a href="../../include/utils/lsyscache.h.html#LN110"><span class='Ref_to_Proto'>get_func_name</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2094"><span class='Ref_To_Local'>transfn_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../include/catalog/objectaccess.h.html#LN178"><span class='Ref_to_Macro'>InvokeFunctionExecuteHook</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2094"><span class='Ref_To_Local'>transfn_oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2095"><span class='Ref_To_Local'>invtransfn_oid</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="nodeWindowAgg.c.html#LN2093"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN285"><span class='Ref_to_Proto'>pg_proc_aclcheck</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2095"><span class='Ref_To_Local'>invtransfn_oid</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2158"><span class='Ref_To_Local'>aggOwner</span></a><span class='Delimiter'>, 
</span>                                         <a href="../../include/nodes/parsenodes.h.html#LN78"><span class='Ref_to_Const'>ACL_EXECUTE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2093"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2093"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN184"><span class='Ref_to_EnumConst'>ACL_KIND_PROC</span></a><span class='Delimiter'>, 
</span>                               <a href="../../include/utils/lsyscache.h.html#LN110"><span class='Ref_to_Proto'>get_func_name</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2095"><span class='Ref_To_Local'>invtransfn_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../include/catalog/objectaccess.h.html#LN178"><span class='Ref_to_Macro'>InvokeFunctionExecuteHook</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2095"><span class='Ref_To_Local'>invtransfn_oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2096"><span class='Ref_To_Local'>finalfn_oid</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="nodeWindowAgg.c.html#LN2093"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN285"><span class='Ref_to_Proto'>pg_proc_aclcheck</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2096"><span class='Ref_To_Local'>finalfn_oid</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2158"><span class='Ref_To_Local'>aggOwner</span></a><span class='Delimiter'>, 
</span>                                         <a href="../../include/nodes/parsenodes.h.html#LN78"><span class='Ref_to_Const'>ACL_EXECUTE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2093"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2093"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN184"><span class='Ref_to_EnumConst'>ACL_KIND_PROC</span></a><span class='Delimiter'>, 
</span>                               <a href="../../include/utils/lsyscache.h.html#LN110"><span class='Ref_to_Proto'>get_func_name</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2096"><span class='Ref_To_Local'>finalfn_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../include/catalog/objectaccess.h.html#LN178"><span class='Ref_to_Macro'>InvokeFunctionExecuteHook</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2096"><span class='Ref_To_Local'>finalfn_oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Detect how many arguments to pass to the finalfn */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2097"><span class='Ref_To_Local'>finalextra</span></a><span class='Parentheses'>) 
</span>        <a href="nodeWindowAgg.c.html#LN2085"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN118"><span class='Ref_to_Member'>numFinalArgs</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2088"><span class='Ref_To_Local'>numArguments</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="nodeWindowAgg.c.html#LN2085"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN118"><span class='Ref_to_Member'>numFinalArgs</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* resolve actual type of transition state, if polymorphic */ 
</span>    <a href="nodeWindowAgg.c.html#LN2091"><span class='Ref_To_Local'>aggtranstype</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_agg.h.html#LN32"><span class='Ref_to_Proto'>resolve_aggregate_transtype</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2084"><span class='Ref_to_Parameter'>wfunc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN354"><span class='Ref_to_Member'>winfnoid</span></a><span class='Delimiter'>, 
</span>                                               <a href="nodeWindowAgg.c.html#LN2091"><span class='Ref_To_Local'>aggtranstype</span></a><span class='Delimiter'>, 
</span>                                               <a href="nodeWindowAgg.c.html#LN2087"><span class='Ref_To_Local'>inputTypes</span></a><span class='Delimiter'>, 
</span>                                               <a href="nodeWindowAgg.c.html#LN2088"><span class='Ref_To_Local'>numArguments</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* build expression trees using actual argument & result types */ 
</span>    <a href="../../include/parser/parse_agg.h.html#LN37"><span class='Ref_to_Proto'>build_aggregate_transfn_expr</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2087"><span class='Ref_To_Local'>inputTypes</span></a><span class='Delimiter'>, 
</span>                                 <a href="nodeWindowAgg.c.html#LN2088"><span class='Ref_To_Local'>numArguments</span></a><span class='Delimiter'>, 
</span>                                 <span class='Number'>0</span><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* no ordered-set window functions yet */ 
</span>                                 <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* no variadic window functions yet */ 
</span>                                 <a href="nodeWindowAgg.c.html#LN2091"><span class='Ref_To_Local'>aggtranstype</span></a><span class='Delimiter'>, 
</span>                                 <a href="nodeWindowAgg.c.html#LN2084"><span class='Ref_to_Parameter'>wfunc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN357"><span class='Ref_to_Member'>inputcollid</span></a><span class='Delimiter'>, 
</span>                                 <a href="nodeWindowAgg.c.html#LN2094"><span class='Ref_To_Local'>transfn_oid</span></a><span class='Delimiter'>, 
</span>                                 <a href="nodeWindowAgg.c.html#LN2095"><span class='Ref_To_Local'>invtransfn_oid</span></a><span class='Delimiter'>, 
</span>                                 <span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN2098"><span class='Ref_To_Local'>transfnexpr</span></a><span class='Delimiter'>, 
</span>                                 <span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN2099"><span class='Ref_To_Local'>invtransfnexpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* set up infrastructure for calling the transfn(s) and finalfn */ 
</span>    <a href="../../include/fmgr.h.html#LN92"><span class='Ref_to_Proto'>fmgr_info</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2094"><span class='Ref_To_Local'>transfn_oid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN2085"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN114"><span class='Ref_to_Member'>transfn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/fmgr.h.html#LN103"><span class='Ref_to_Macro'>fmgr_info_set_expr</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeWindowAgg.c.html#LN2098"><span class='Ref_To_Local'>transfnexpr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN2085"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN114"><span class='Ref_to_Member'>transfn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2095"><span class='Ref_To_Local'>invtransfn_oid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/fmgr.h.html#LN92"><span class='Ref_to_Proto'>fmgr_info</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2095"><span class='Ref_To_Local'>invtransfn_oid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN2085"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN115"><span class='Ref_to_Member'>invtransfn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/fmgr.h.html#LN103"><span class='Ref_to_Macro'>fmgr_info_set_expr</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeWindowAgg.c.html#LN2099"><span class='Ref_To_Local'>invtransfnexpr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN2085"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN115"><span class='Ref_to_Member'>invtransfn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2096"><span class='Ref_To_Local'>finalfn_oid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/parser/parse_agg.h.html#LN59"><span class='Ref_to_Proto'>build_aggregate_finalfn_expr</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2087"><span class='Ref_To_Local'>inputTypes</span></a><span class='Delimiter'>, 
</span>                                     <a href="nodeWindowAgg.c.html#LN2085"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN118"><span class='Ref_to_Member'>numFinalArgs</span></a><span class='Delimiter'>, 
</span>                                     <a href="nodeWindowAgg.c.html#LN2091"><span class='Ref_To_Local'>aggtranstype</span></a><span class='Delimiter'>, 
</span>                                     <a href="nodeWindowAgg.c.html#LN2084"><span class='Ref_to_Parameter'>wfunc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN355"><span class='Ref_to_Member'>wintype</span></a><span class='Delimiter'>, 
</span>                                     <a href="nodeWindowAgg.c.html#LN2084"><span class='Ref_to_Parameter'>wfunc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN357"><span class='Ref_to_Member'>inputcollid</span></a><span class='Delimiter'>, 
</span>                                     <a href="nodeWindowAgg.c.html#LN2096"><span class='Ref_To_Local'>finalfn_oid</span></a><span class='Delimiter'>, 
</span>                                     <span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN2100"><span class='Ref_To_Local'>finalfnexpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/fmgr.h.html#LN92"><span class='Ref_to_Proto'>fmgr_info</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2096"><span class='Ref_To_Local'>finalfn_oid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN2085"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN116"><span class='Ref_to_Member'>finalfn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/fmgr.h.html#LN103"><span class='Ref_to_Macro'>fmgr_info_set_expr</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeWindowAgg.c.html#LN2100"><span class='Ref_To_Local'>finalfnexpr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN2085"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN116"><span class='Ref_to_Member'>finalfn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* get info about relevant datatypes */ 
</span>    <a href="../../include/utils/lsyscache.h.html#LN135"><span class='Ref_to_Proto'>get_typlenbyval</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2084"><span class='Ref_to_Parameter'>wfunc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN355"><span class='Ref_to_Member'>wintype</span></a><span class='Delimiter'>, 
</span>                    <span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN2085"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN137"><span class='Ref_to_Member'>resulttypeLen</span></a><span class='Delimiter'>, 
</span>                    <span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN2085"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN140"><span class='Ref_to_Member'>resulttypeByVal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/lsyscache.h.html#LN135"><span class='Ref_to_Proto'>get_typlenbyval</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2091"><span class='Ref_To_Local'>aggtranstype</span></a><span class='Delimiter'>, 
</span>                    <span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN2085"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN138"><span class='Ref_to_Member'>transtypeLen</span></a><span class='Delimiter'>, 
</span>                    <span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN2085"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN141"><span class='Ref_to_Member'>transtypeByVal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initval is potentially null, so don't try to access it as a struct 
     * field. Must do it the hard way with SysCacheGetAttr. 
     */ 
</span>    <a href="nodeWindowAgg.c.html#LN2101"><span class='Ref_To_Local'>textInitVal</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN33"><span class='Ref_to_EnumConst'>AGGFNOID</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2089"><span class='Ref_To_Local'>aggTuple</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2092"><span class='Ref_To_Local'>initvalAttNo</span></a><span class='Delimiter'>, 
</span>                                  <span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN2085"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN124"><span class='Ref_to_Member'>initValueIsNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2085"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN124"><span class='Ref_to_Member'>initValueIsNull</span></a><span class='Parentheses'>) 
</span>        <a href="nodeWindowAgg.c.html#LN2085"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN123"><span class='Ref_to_Member'>initValue</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="nodeWindowAgg.c.html#LN2085"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN123"><span class='Ref_to_Member'>initValue</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN189"><span class='Ref_to_Proto'>GetAggInitVal</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2101"><span class='Ref_To_Local'>textInitVal</span></a><span class='Delimiter'>, 
</span>                                               <a href="nodeWindowAgg.c.html#LN2091"><span class='Ref_To_Local'>aggtranstype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the transfn is strict and the initval is NULL, make sure input type 
     * and transtype are the same (or at least binary-compatible), so that 
     * it's OK to use the first input value as the initial transValue.  This 
     * should have been checked at agg definition time, but we must check 
     * again in case the transfn's strictness property has been changed. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2085"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN114"><span class='Ref_to_Member'>transfn</span></a><span class='Operator'>.</span><a href="../../include/fmgr.h.html#LN60"><span class='Ref_to_Member'>fn_strict</span></a> <span class='Operator'>&& </span><a href="nodeWindowAgg.c.html#LN2085"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN124"><span class='Ref_to_Member'>initValueIsNull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2088"><span class='Ref_To_Local'>numArguments</span></a> <span class='Operator'>&LT; </span><span class='Number'>1</span> <span class='Operator'>|| 
</span>            <span class='Operator'>!</span><a href="../../include/parser/parse_coerce.h.html#LN33"><span class='Ref_to_Proto'>IsBinaryCoercible</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2087"><span class='Ref_To_Local'>inputTypes</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><a href="nodeWindowAgg.c.html#LN2091"><span class='Ref_To_Local'>aggtranstype</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_FUNCTION_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"aggregate %u needs to have compatible input type and transition type"</span><span class='Delimiter'>, 
</span>                            <a href="nodeWindowAgg.c.html#LN2084"><span class='Ref_to_Parameter'>wfunc</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN354"><span class='Ref_to_Member'>winfnoid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Insist that forward and inverse transition functions have the same 
     * strictness setting.  Allowing them to differ would require handling 
     * more special cases in advance_windowaggregate and 
     * advance_windowaggregate_base, for no discernible benefit.  This should 
     * have been checked at agg definition time, but we must check again in 
     * case either function's strictness property has been changed. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2095"><span class='Ref_To_Local'>invtransfn_oid</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <a href="nodeWindowAgg.c.html#LN2085"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN114"><span class='Ref_to_Member'>transfn</span></a><span class='Operator'>.</span><a href="../../include/fmgr.h.html#LN60"><span class='Ref_to_Member'>fn_strict</span></a> <span class='Operator'>!= </span><a href="nodeWindowAgg.c.html#LN2085"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN115"><span class='Ref_to_Member'>invtransfn</span></a><span class='Operator'>.</span><a href="../../include/fmgr.h.html#LN60"><span class='Ref_to_Member'>fn_strict</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_FUNCTION_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"strictness of aggregate's forward and inverse transition functions must match"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Moving aggregates use their own aggcontext. 
     * 
     * This is necessary because they might restart at different times, so we 
     * might never be able to reset the shared context otherwise.  We can't 
     * make it the aggregates' responsibility to clean up after themselves, 
     * because strict aggregates must be restarted whenever we remove their 
     * last non-NULL input, which the aggregate won't be aware is happening. 
     * Also, just pfree()ing the transValue upon restarting wouldn't help, 
     * since we'd miss any indirectly referenced data.  We could, in theory, 
     * make the memory allocation rules for moving aggregates different than 
     * they have historically been for plain aggregates, but that seems grotty 
     * and likely to lead to memory leaks. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2095"><span class='Ref_To_Local'>invtransfn_oid</span></a><span class='Parentheses'>))</span> 
        <a href="nodeWindowAgg.c.html#LN2085"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN146"><span class='Ref_to_Member'>aggcontext</span></a> <span class='Operator'>= 
</span>            <a href="../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, 
</span>                                  <span class='String'>"WindowAgg Per Aggregate"</span><span class='Delimiter'>, 
</span>                                  <a href="../../include/utils/memutils.h.html#LN164"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="nodeWindowAgg.c.html#LN2085"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN146"><span class='Ref_to_Member'>aggcontext</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2084"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1824"><span class='Ref_to_Member'>aggcontext</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2089"><span class='Ref_To_Local'>aggTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="nodeWindowAgg.c.html#LN2085"><span class='Ref_to_Parameter'>peraggstate</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end initialize_peragg &raquo; </span> 
 
<span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2323"></a><span class='Declare_Function'>GetAggInitVal</span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>textInitVal</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>transtype</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2325"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typinput</span><span class='Delimiter'>, 
</span><a name="LN2326"></a>                <span class='Declare_Local'>typioparam</span><span class='Delimiter'>; 
</span><a name="LN2327"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>strInitVal</span><span class='Delimiter'>; 
</span><a name="LN2328"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>initVal</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/lsyscache.h.html#LN161"><span class='Ref_to_Proto'>getTypeInputInfo</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2323"><span class='Ref_to_Parameter'>transtype</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN2325"><span class='Ref_To_Local'>typinput</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nodeWindowAgg.c.html#LN2326"><span class='Ref_To_Local'>typioparam</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN2327"><span class='Ref_To_Local'>strInitVal</span></a> <span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2323"><span class='Ref_to_Parameter'>textInitVal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN2328"><span class='Ref_To_Local'>initVal</span></a> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN644"><span class='Ref_to_Proto'>OidInputFunctionCall</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2325"><span class='Ref_To_Local'>typinput</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2327"><span class='Ref_To_Local'>strInitVal</span></a><span class='Delimiter'>, 
</span>                                   <a href="nodeWindowAgg.c.html#LN2326"><span class='Ref_To_Local'>typioparam</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2327"><span class='Ref_To_Local'>strInitVal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="nodeWindowAgg.c.html#LN2328"><span class='Ref_To_Local'>initVal</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * are_peers 
 * compare two rows to see if they are equal according to the ORDER BY clause 
 * 
 * NB: this does not consider the window frame mode. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN2345"></a><span class='Declare_Function'>are_peers</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>winstate</span><span class='Delimiter'>, </span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot1</span><span class='Delimiter'>, 
</span><a name="LN2346"></a>          <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2348"></a>    <a href="../../include/nodes/plannodes.h.html#LN800"><span class='Ref_to_Struct'>WindowAgg</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>node</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN800"><span class='Ref_to_Struct'>WindowAgg</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeWindowAgg.c.html#LN2345"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN812"><span class='Ref_to_Member'>plan</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If no ORDER BY, all rows are peers with each other */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2348"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN807"><span class='Ref_to_Member'>ordNumCols</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="execGrouping.c.html#LN67"><span class='Ref_to_Func'>execTuplesMatch</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2345"><span class='Ref_to_Parameter'>slot1</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2346"><span class='Ref_to_Parameter'>slot2</span></a><span class='Delimiter'>, 
</span>                           <a href="nodeWindowAgg.c.html#LN2348"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN807"><span class='Ref_to_Member'>ordNumCols</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2348"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN808"><span class='Ref_to_Member'>ordColIdx</span></a><span class='Delimiter'>, 
</span>                           <a href="nodeWindowAgg.c.html#LN2345"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1804"><span class='Ref_to_Member'>ordEqfunctions</span></a><span class='Delimiter'>, 
</span>                           <a href="nodeWindowAgg.c.html#LN2345"><span class='Ref_to_Parameter'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1826"><span class='Ref_to_Member'>tmpcontext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN202"><span class='Ref_to_Member'>ecxt_per_tuple_memory</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * window_gettupleslot 
 *  Fetch the pos'th tuple of the current partition into the slot, 
 *  using the winobj's read pointer 
 * 
 * Returns true if successful, false if no such row 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN2368"></a><span class='Declare_Function'>window_gettupleslot</span><span class='Parentheses'>(</span><a href="../../include/windowapi.h.html#LN36"><span class='Ref_to_Typedef'>WindowObject</span></a> <span class='Declare_Parameter'>winobj</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Declare_Parameter'>pos</span><span class='Delimiter'>, </span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2370"></a>    <a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>winstate</span> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2368"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN61"><span class='Ref_to_Member'>winstate</span></a><span class='Delimiter'>; 
</span><a name="LN2371"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Don't allow passing -1 to spool_tuples here */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2368"><span class='Ref_to_Parameter'>pos</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If necessary, fetch the tuple into the spool */ 
</span>    <a href="nodeWindowAgg.c.html#LN178"><span class='Ref_to_Proto'>spool_tuples</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2370"><span class='Ref_To_Local'>winstate</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2368"><span class='Ref_to_Parameter'>pos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2368"><span class='Ref_to_Parameter'>pos</span></a> <span class='Operator'>&GT;= </span><a href="nodeWindowAgg.c.html#LN2370"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1807"><span class='Ref_to_Member'>spooled_rows</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2368"><span class='Ref_to_Parameter'>pos</span></a> <span class='Operator'>&LT; </span><a href="nodeWindowAgg.c.html#LN2368"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN66"><span class='Ref_to_Member'>markpos</span></a><span class='Parentheses'>) 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cannot fetch row before WindowObject's mark position"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="nodeWindowAgg.c.html#LN2371"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2370"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN842"><span class='Ref_to_Member'>ps_ExprContext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN201"><span class='Ref_to_Member'>ecxt_per_query_memory</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/tuplestore.h.html#LN63"><span class='Ref_to_Proto'>tuplestore_select_read_pointer</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2370"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1805"><span class='Ref_to_Member'>buffer</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2368"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN65"><span class='Ref_to_Member'>readptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Advance or rewind until we are within one tuple of the one we want. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2368"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN67"><span class='Ref_to_Member'>seekpos</span></a> <span class='Operator'>&LT; </span><a href="nodeWindowAgg.c.html#LN2368"><span class='Ref_to_Parameter'>pos</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/tuplestore.h.html#LN77"><span class='Ref_to_Proto'>tuplestore_skiptuples</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2370"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1805"><span class='Ref_to_Member'>buffer</span></a><span class='Delimiter'>, 
</span>                                   <a href="nodeWindowAgg.c.html#LN2368"><span class='Ref_to_Parameter'>pos</span></a> <span class='Operator'>- </span><span class='Number'>1</span> <span class='Operator'>- </span><a href="nodeWindowAgg.c.html#LN2368"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN67"><span class='Ref_to_Member'>seekpos</span></a><span class='Delimiter'>, 
</span>                                   <span class='Boolean'>true</span><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected end of tuplestore"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN2368"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN67"><span class='Ref_to_Member'>seekpos</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2368"><span class='Ref_to_Parameter'>pos</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2368"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN67"><span class='Ref_to_Member'>seekpos</span></a> <span class='Operator'>&GT; </span><a href="nodeWindowAgg.c.html#LN2368"><span class='Ref_to_Parameter'>pos</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/tuplestore.h.html#LN77"><span class='Ref_to_Proto'>tuplestore_skiptuples</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2370"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1805"><span class='Ref_to_Member'>buffer</span></a><span class='Delimiter'>, 
</span>                                   <a href="nodeWindowAgg.c.html#LN2368"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN67"><span class='Ref_to_Member'>seekpos</span></a> <span class='Operator'>- </span><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2368"><span class='Ref_to_Parameter'>pos</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <span class='Boolean'>false</span><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected end of tuplestore"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN2368"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN67"><span class='Ref_to_Member'>seekpos</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2368"><span class='Ref_to_Parameter'>pos</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2368"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN67"><span class='Ref_to_Member'>seekpos</span></a> <span class='Operator'>== </span><a href="nodeWindowAgg.c.html#LN2368"><span class='Ref_to_Parameter'>pos</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * There's no API to refetch the tuple at the current position.  We 
         * have to move one tuple forward, and then one backward.  (We don't 
         * do it the other way because we might try to fetch the row before 
         * our mark, which isn't allowed.)  XXX this case could stand to be 
         * optimized. 
         */ 
</span>        <a href="../../include/utils/tuplestore.h.html#LN75"><span class='Ref_to_Proto'>tuplestore_advance</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2370"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1805"><span class='Ref_to_Member'>buffer</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN2368"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN67"><span class='Ref_to_Member'>seekpos</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now we should be on the tuple immediately before or after the one we 
     * want, so just fetch forwards or backwards as appropriate. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2368"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN67"><span class='Ref_to_Member'>seekpos</span></a> <span class='Operator'>&GT; </span><a href="nodeWindowAgg.c.html#LN2368"><span class='Ref_to_Parameter'>pos</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/tuplestore.h.html#LN72"><span class='Ref_to_Proto'>tuplestore_gettupleslot</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2370"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1805"><span class='Ref_to_Member'>buffer</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2368"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected end of tuplestore"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN2368"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN67"><span class='Ref_to_Member'>seekpos</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/tuplestore.h.html#LN72"><span class='Ref_to_Proto'>tuplestore_gettupleslot</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2370"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1805"><span class='Ref_to_Member'>buffer</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2368"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected end of tuplestore"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN2368"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN67"><span class='Ref_to_Member'>seekpos</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2368"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN67"><span class='Ref_to_Member'>seekpos</span></a> <span class='Operator'>== </span><a href="nodeWindowAgg.c.html#LN2368"><span class='Ref_to_Parameter'>pos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2371"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end window_gettupleslot &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/*********************************************************************** 
 * API exposed to window functions 
 ***********************************************************************/ 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * WinGetPartitionLocalMemory 
 *      Get working memory that lives till end of partition processing 
 * 
 * On first call within a given partition, this allocates and zeroes the 
 * requested amount of space.  Subsequent calls just return the same chunk. 
 * 
 * Memory obtained this way is normally used to hold state that should be 
 * automatically reset for each new partition.  If a window function wants 
 * to hold state across the whole query, fcinfo-&GT;fn_extra can be used in the 
 * usual way for that. 
 */ 
</span><span class='Keyword'>void </span><span class='Operator'>* 
</span><a name="LN2465"></a><span class='Declare_Function'>WinGetPartitionLocalMemory</span><span class='Parentheses'>(</span><a href="../../include/windowapi.h.html#LN36"><span class='Ref_to_Typedef'>WindowObject</span></a> <span class='Declare_Parameter'>winobj</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>sz</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/windowapi.h.html#LN40"><span class='Ref_to_Macro'>WindowObjectIsValid</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2465"><span class='Ref_to_Parameter'>winobj</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2465"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN63"><span class='Ref_to_Member'>localmem</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="nodeWindowAgg.c.html#LN2465"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN63"><span class='Ref_to_Member'>localmem</span></a> <span class='Operator'>= 
</span>            <a href="../../include/utils/palloc.h.html#LN71"><span class='Ref_to_Proto'>MemoryContextAllocZero</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2465"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN61"><span class='Ref_to_Member'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1823"><span class='Ref_to_Member'>partcontext</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2465"><span class='Ref_to_Parameter'>sz</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="nodeWindowAgg.c.html#LN2465"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN63"><span class='Ref_to_Member'>localmem</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * WinGetCurrentPosition 
 *      Return the current row's position (counting from 0) within the current 
 *      partition. 
 */ 
</span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> 
<a name="LN2480"></a><span class='Declare_Function'>WinGetCurrentPosition</span><span class='Parentheses'>(</span><a href="../../include/windowapi.h.html#LN36"><span class='Ref_to_Typedef'>WindowObject</span></a> <span class='Declare_Parameter'>winobj</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/windowapi.h.html#LN40"><span class='Ref_to_Macro'>WindowObjectIsValid</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2480"><span class='Ref_to_Parameter'>winobj</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="nodeWindowAgg.c.html#LN2480"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN61"><span class='Ref_to_Member'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1808"><span class='Ref_to_Member'>currentpos</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * WinGetPartitionRowCount 
 *      Return total number of rows contained in the current partition. 
 * 
 * Note: this is a relatively expensive operation because it forces the 
 * whole partition to be "spooled" into the tuplestore at once.  Once 
 * executed, however, additional calls within the same partition are cheap. 
 */ 
</span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> 
<a name="LN2495"></a><span class='Declare_Function'>WinGetPartitionRowCount</span><span class='Parentheses'>(</span><a href="../../include/windowapi.h.html#LN36"><span class='Ref_to_Typedef'>WindowObject</span></a> <span class='Declare_Parameter'>winobj</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/windowapi.h.html#LN40"><span class='Ref_to_Macro'>WindowObjectIsValid</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2495"><span class='Ref_to_Parameter'>winobj</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN178"><span class='Ref_to_Proto'>spool_tuples</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2495"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN61"><span class='Ref_to_Member'>winstate</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="nodeWindowAgg.c.html#LN2495"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN61"><span class='Ref_to_Member'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1807"><span class='Ref_to_Member'>spooled_rows</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * WinSetMarkPosition 
 *      Set the "mark" position for the window object, which is the oldest row 
 *      number (counting from 0) it is allowed to fetch during all subsequent 
 *      operations within the current partition. 
 * 
 * Window functions do not have to call this, but are encouraged to move the 
 * mark forward when possible to keep the tuplestore size down and prevent 
 * having to spill rows to disk. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2513"></a><span class='Declare_Function'>WinSetMarkPosition</span><span class='Parentheses'>(</span><a href="../../include/windowapi.h.html#LN36"><span class='Ref_to_Typedef'>WindowObject</span></a> <span class='Declare_Parameter'>winobj</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Declare_Parameter'>markpos</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2515"></a>    <a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>winstate</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/windowapi.h.html#LN40"><span class='Ref_to_Macro'>WindowObjectIsValid</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2513"><span class='Ref_to_Parameter'>winobj</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN2515"><span class='Ref_To_Local'>winstate</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2513"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN61"><span class='Ref_to_Member'>winstate</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2513"><span class='Ref_to_Parameter'>markpos</span></a> <span class='Operator'>&LT; </span><a href="nodeWindowAgg.c.html#LN2513"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN66"><span class='Ref_to_Member'>markpos</span></a><span class='Parentheses'>) 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cannot move WindowObject's mark position backward"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/tuplestore.h.html#LN63"><span class='Ref_to_Proto'>tuplestore_select_read_pointer</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2515"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1805"><span class='Ref_to_Member'>buffer</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2513"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN64"><span class='Ref_to_Member'>markptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2513"><span class='Ref_to_Parameter'>markpos</span></a> <span class='Operator'>&GT; </span><a href="nodeWindowAgg.c.html#LN2513"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN66"><span class='Ref_to_Member'>markpos</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/tuplestore.h.html#LN77"><span class='Ref_to_Proto'>tuplestore_skiptuples</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2515"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1805"><span class='Ref_to_Member'>buffer</span></a><span class='Delimiter'>, 
</span>                              <a href="nodeWindowAgg.c.html#LN2513"><span class='Ref_to_Parameter'>markpos</span></a> <span class='Operator'>- </span><a href="nodeWindowAgg.c.html#LN2513"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN66"><span class='Ref_to_Member'>markpos</span></a><span class='Delimiter'>, 
</span>                              <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN2513"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN66"><span class='Ref_to_Member'>markpos</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2513"><span class='Ref_to_Parameter'>markpos</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/utils/tuplestore.h.html#LN63"><span class='Ref_to_Proto'>tuplestore_select_read_pointer</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2515"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1805"><span class='Ref_to_Member'>buffer</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2513"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN65"><span class='Ref_to_Member'>readptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2513"><span class='Ref_to_Parameter'>markpos</span></a> <span class='Operator'>&GT; </span><a href="nodeWindowAgg.c.html#LN2513"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN67"><span class='Ref_to_Member'>seekpos</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/tuplestore.h.html#LN77"><span class='Ref_to_Proto'>tuplestore_skiptuples</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2515"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1805"><span class='Ref_to_Member'>buffer</span></a><span class='Delimiter'>, 
</span>                              <a href="nodeWindowAgg.c.html#LN2513"><span class='Ref_to_Parameter'>markpos</span></a> <span class='Operator'>- </span><a href="nodeWindowAgg.c.html#LN2513"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN67"><span class='Ref_to_Member'>seekpos</span></a><span class='Delimiter'>, 
</span>                              <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nodeWindowAgg.c.html#LN2513"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN67"><span class='Ref_to_Member'>seekpos</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2513"><span class='Ref_to_Parameter'>markpos</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end WinSetMarkPosition &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * WinRowsArePeers 
 *      Compare two rows (specified by absolute position in window) to see 
 *      if they are equal according to the ORDER BY clause. 
 * 
 * NB: this does not consider the window frame mode. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN2548"></a><span class='Declare_Function'>WinRowsArePeers</span><span class='Parentheses'>(</span><a href="../../include/windowapi.h.html#LN36"><span class='Ref_to_Typedef'>WindowObject</span></a> <span class='Declare_Parameter'>winobj</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Declare_Parameter'>pos1</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Declare_Parameter'>pos2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2550"></a>    <a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>winstate</span><span class='Delimiter'>; 
</span><a name="LN2551"></a>    <a href="../../include/nodes/plannodes.h.html#LN800"><span class='Ref_to_Struct'>WindowAgg</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>node</span><span class='Delimiter'>; 
</span><a name="LN2552"></a>    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>slot1</span><span class='Delimiter'>; 
</span><a name="LN2553"></a>    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>slot2</span><span class='Delimiter'>; 
</span><a name="LN2554"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/windowapi.h.html#LN40"><span class='Ref_to_Macro'>WindowObjectIsValid</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2548"><span class='Ref_to_Parameter'>winobj</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN2550"><span class='Ref_To_Local'>winstate</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2548"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN61"><span class='Ref_to_Member'>winstate</span></a><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN2551"><span class='Ref_To_Local'>node</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN800"><span class='Ref_to_Struct'>WindowAgg</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="nodeWindowAgg.c.html#LN2550"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN812"><span class='Ref_to_Member'>plan</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If no ORDER BY, all rows are peers; don't bother to fetch them */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2551"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN807"><span class='Ref_to_Member'>ordNumCols</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="nodeWindowAgg.c.html#LN2552"><span class='Ref_To_Local'>slot1</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2550"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1845"><span class='Ref_to_Member'>temp_slot_1</span></a><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN2553"><span class='Ref_To_Local'>slot2</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2550"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1846"><span class='Ref_to_Member'>temp_slot_2</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeWindowAgg.c.html#LN193"><span class='Ref_to_Proto'>window_gettupleslot</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2548"><span class='Ref_to_Parameter'>winobj</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2548"><span class='Ref_to_Parameter'>pos1</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2552"><span class='Ref_To_Local'>slot1</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"specified position is out of window: "</span> <a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a><span class='Delimiter'>, 
</span>             <a href="nodeWindowAgg.c.html#LN2548"><span class='Ref_to_Parameter'>pos1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeWindowAgg.c.html#LN193"><span class='Ref_to_Proto'>window_gettupleslot</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2548"><span class='Ref_to_Parameter'>winobj</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2548"><span class='Ref_to_Parameter'>pos2</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2553"><span class='Ref_To_Local'>slot2</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"specified position is out of window: "</span> <a href="../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a><span class='Delimiter'>, 
</span>             <a href="nodeWindowAgg.c.html#LN2548"><span class='Ref_to_Parameter'>pos2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="nodeWindowAgg.c.html#LN2554"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN191"><span class='Ref_to_Proto'>are_peers</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2550"><span class='Ref_To_Local'>winstate</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2552"><span class='Ref_To_Local'>slot1</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2553"><span class='Ref_To_Local'>slot2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/executor/tuptable.h.html#LN154"><span class='Ref_to_Proto'>ExecClearTuple</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2552"><span class='Ref_To_Local'>slot1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/executor/tuptable.h.html#LN154"><span class='Ref_to_Proto'>ExecClearTuple</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2553"><span class='Ref_To_Local'>slot2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="nodeWindowAgg.c.html#LN2554"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end WinRowsArePeers &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * WinGetFuncArgInPartition 
 *      Evaluate a window function's argument expression on a specified 
 *      row of the partition.  The row is identified in lseek(2) style, 
 *      i.e. relative to the current, first, or last row. 
 * 
 * argno: argument number to evaluate (counted from 0) 
 * relpos: signed rowcount offset from the seek position 
 * seektype: WINDOW_SEEK_CURRENT, WINDOW_SEEK_HEAD, or WINDOW_SEEK_TAIL 
 * set_mark: If the row is found and set_mark is true, the mark is moved to 
 *      the row as a side-effect. 
 * isnull: output argument, receives isnull status of result 
 * isout: output argument, set to indicate whether target row position 
 *      is out of partition (can pass NULL if caller doesn't care about this) 
 * 
 * Specifying a nonexistent row is not an error, it just causes a null result 
 * (plus setting *isout true, if isout isn't NULL). 
 */ 
</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2601"></a><span class='Declare_Function'>WinGetFuncArgInPartition</span><span class='Parentheses'>(</span><a href="../../include/windowapi.h.html#LN36"><span class='Ref_to_Typedef'>WindowObject</span></a> <span class='Declare_Parameter'>winobj</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>argno</span><span class='Delimiter'>, 
</span><a name="LN2602"></a>                         <span class='Keyword'>int </span><span class='Declare_Parameter'>relpos</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>seektype</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>set_mark</span><span class='Delimiter'>, 
</span><a name="LN2603"></a>                         <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isnull</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isout</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2605"></a>    <a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>winstate</span><span class='Delimiter'>; 
</span><a name="LN2606"></a>    <a href="../../include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>econtext</span><span class='Delimiter'>; 
</span><a name="LN2607"></a>    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>slot</span><span class='Delimiter'>; 
</span><a name="LN2608"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>gottuple</span><span class='Delimiter'>; 
</span><a name="LN2609"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>abs_pos</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/windowapi.h.html#LN40"><span class='Ref_to_Macro'>WindowObjectIsValid</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2601"><span class='Ref_to_Parameter'>winobj</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN2605"><span class='Ref_To_Local'>winstate</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2601"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN61"><span class='Ref_to_Member'>winstate</span></a><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN2606"><span class='Ref_To_Local'>econtext</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2605"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN842"><span class='Ref_to_Member'>ps_ExprContext</span></a><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN2607"><span class='Ref_To_Local'>slot</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2605"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1845"><span class='Ref_to_Member'>temp_slot_1</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2602"><span class='Ref_to_Parameter'>seektype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/windowapi.h.html#LN31"><span class='Ref_to_Const'>WINDOW_SEEK_CURRENT</span></a><span class='Operator'>: 
</span>            <a href="nodeWindowAgg.c.html#LN2609"><span class='Ref_To_Local'>abs_pos</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2605"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1808"><span class='Ref_to_Member'>currentpos</span></a> <span class='Operator'>+ </span><a href="nodeWindowAgg.c.html#LN2602"><span class='Ref_to_Parameter'>relpos</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/windowapi.h.html#LN32"><span class='Ref_to_Const'>WINDOW_SEEK_HEAD</span></a><span class='Operator'>: 
</span>            <a href="nodeWindowAgg.c.html#LN2609"><span class='Ref_To_Local'>abs_pos</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2602"><span class='Ref_to_Parameter'>relpos</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/windowapi.h.html#LN33"><span class='Ref_to_Const'>WINDOW_SEEK_TAIL</span></a><span class='Operator'>: 
</span>            <a href="nodeWindowAgg.c.html#LN178"><span class='Ref_to_Proto'>spool_tuples</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2605"><span class='Ref_To_Local'>winstate</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="nodeWindowAgg.c.html#LN2609"><span class='Ref_To_Local'>abs_pos</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2605"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1807"><span class='Ref_to_Member'>spooled_rows</span></a> <span class='Operator'>- </span><span class='Number'>1</span> <span class='Operator'>+ </span><a href="nodeWindowAgg.c.html#LN2602"><span class='Ref_to_Parameter'>relpos</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized window seek type: %d"</span><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2602"><span class='Ref_to_Parameter'>seektype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="nodeWindowAgg.c.html#LN2609"><span class='Ref_To_Local'>abs_pos</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="nodeWindowAgg.c.html#LN2608"><span class='Ref_To_Local'>gottuple</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN193"><span class='Ref_to_Proto'>window_gettupleslot</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2601"><span class='Ref_to_Parameter'>winobj</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2609"><span class='Ref_To_Local'>abs_pos</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2607"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeWindowAgg.c.html#LN2608"><span class='Ref_To_Local'>gottuple</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2603"><span class='Ref_to_Parameter'>isout</span></a><span class='Parentheses'>) 
</span>            <span class='Operator'>*</span><a href="nodeWindowAgg.c.html#LN2603"><span class='Ref_to_Parameter'>isout</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="nodeWindowAgg.c.html#LN2603"><span class='Ref_to_Parameter'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2603"><span class='Ref_to_Parameter'>isout</span></a><span class='Parentheses'>) 
</span>            <span class='Operator'>*</span><a href="nodeWindowAgg.c.html#LN2603"><span class='Ref_to_Parameter'>isout</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2602"><span class='Ref_to_Parameter'>set_mark</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2649"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>frameOptions</span> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2605"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1817"><span class='Ref_to_Member'>frameOptions</span></a><span class='Delimiter'>; 
</span><a name="LN2650"></a>            <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>mark_pos</span> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2609"><span class='Ref_To_Local'>abs_pos</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * In RANGE mode with a moving frame head, we must not let the 
             * mark advance past frameheadpos, since that row has to be 
             * fetchable during future update_frameheadpos calls. 
             * 
             * XXX it is very ugly to pollute window functions' marks with 
             * this consideration; it could for instance mask a logic bug that 
             * lets a window function fetch rows before what it had claimed 
             * was its mark.  Perhaps use a separate mark for frame head 
             * probes? 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="nodeWindowAgg.c.html#LN2649"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN505"><span class='Ref_to_Const'>FRAMEOPTION_RANGE</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                <span class='Operator'>!</span><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2649"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN508"><span class='Ref_to_Const'>FRAMEOPTION_START_UNBOUNDED_PRECEDING</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="nodeWindowAgg.c.html#LN183"><span class='Ref_to_Proto'>update_frameheadpos</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2601"><span class='Ref_to_Parameter'>winobj</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2605"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1846"><span class='Ref_to_Member'>temp_slot_2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2650"><span class='Ref_To_Local'>mark_pos</span></a> <span class='Operator'>&GT; </span><a href="nodeWindowAgg.c.html#LN2605"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1809"><span class='Ref_to_Member'>frameheadpos</span></a><span class='Parentheses'>) 
</span>                    <a href="nodeWindowAgg.c.html#LN2650"><span class='Ref_To_Local'>mark_pos</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2605"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1809"><span class='Ref_to_Member'>frameheadpos</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="../../include/windowapi.h.html#LN48"><span class='Ref_to_Proto'>WinSetMarkPosition</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2601"><span class='Ref_to_Parameter'>winobj</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2650"><span class='Ref_To_Local'>mark_pos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if set_mark &raquo; </span> 
        <a href="nodeWindowAgg.c.html#LN2606"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN198"><span class='Ref_to_Member'>ecxt_outertuple</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2607"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../../include/executor/executor.h.html#LN264"><span class='Ref_to_Func'>ExecEvalExpr</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN223"><span class='Ref_to_Proto'>list_nth</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2601"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN62"><span class='Ref_to_Member'>argstates</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2601"><span class='Ref_to_Parameter'>argno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="nodeWindowAgg.c.html#LN2606"><span class='Ref_To_Local'>econtext</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2603"><span class='Ref_to_Parameter'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end WinGetFuncArgInPartition &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * WinGetFuncArgInFrame 
 *      Evaluate a window function's argument expression on a specified 
 *      row of the window frame.  The row is identified in lseek(2) style, 
 *      i.e. relative to the current, first, or last row. 
 * 
 * argno: argument number to evaluate (counted from 0) 
 * relpos: signed rowcount offset from the seek position 
 * seektype: WINDOW_SEEK_CURRENT, WINDOW_SEEK_HEAD, or WINDOW_SEEK_TAIL 
 * set_mark: If the row is found and set_mark is true, the mark is moved to 
 *      the row as a side-effect. 
 * isnull: output argument, receives isnull status of result 
 * isout: output argument, set to indicate whether target row position 
 *      is out of frame (can pass NULL if caller doesn't care about this) 
 * 
 * Specifying a nonexistent row is not an error, it just causes a null result 
 * (plus setting *isout true, if isout isn't NULL). 
 */ 
</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2697"></a><span class='Declare_Function'>WinGetFuncArgInFrame</span><span class='Parentheses'>(</span><a href="../../include/windowapi.h.html#LN36"><span class='Ref_to_Typedef'>WindowObject</span></a> <span class='Declare_Parameter'>winobj</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>argno</span><span class='Delimiter'>, 
</span><a name="LN2698"></a>                     <span class='Keyword'>int </span><span class='Declare_Parameter'>relpos</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>seektype</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>set_mark</span><span class='Delimiter'>, 
</span><a name="LN2699"></a>                     <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isnull</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isout</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2701"></a>    <a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>winstate</span><span class='Delimiter'>; 
</span><a name="LN2702"></a>    <a href="../../include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>econtext</span><span class='Delimiter'>; 
</span><a name="LN2703"></a>    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>slot</span><span class='Delimiter'>; 
</span><a name="LN2704"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>gottuple</span><span class='Delimiter'>; 
</span><a name="LN2705"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>abs_pos</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/windowapi.h.html#LN40"><span class='Ref_to_Macro'>WindowObjectIsValid</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2697"><span class='Ref_to_Parameter'>winobj</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN2701"><span class='Ref_To_Local'>winstate</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2697"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN61"><span class='Ref_to_Member'>winstate</span></a><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN2702"><span class='Ref_To_Local'>econtext</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2701"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN842"><span class='Ref_to_Member'>ps_ExprContext</span></a><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN2703"><span class='Ref_To_Local'>slot</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2701"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1845"><span class='Ref_to_Member'>temp_slot_1</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2698"><span class='Ref_to_Parameter'>seektype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/windowapi.h.html#LN31"><span class='Ref_to_Const'>WINDOW_SEEK_CURRENT</span></a><span class='Operator'>: 
</span>            <a href="nodeWindowAgg.c.html#LN2705"><span class='Ref_To_Local'>abs_pos</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2701"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1808"><span class='Ref_to_Member'>currentpos</span></a> <span class='Operator'>+ </span><a href="nodeWindowAgg.c.html#LN2698"><span class='Ref_to_Parameter'>relpos</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/windowapi.h.html#LN32"><span class='Ref_to_Const'>WINDOW_SEEK_HEAD</span></a><span class='Operator'>: 
</span>            <a href="nodeWindowAgg.c.html#LN183"><span class='Ref_to_Proto'>update_frameheadpos</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2697"><span class='Ref_to_Parameter'>winobj</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2703"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="nodeWindowAgg.c.html#LN2705"><span class='Ref_To_Local'>abs_pos</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2701"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1809"><span class='Ref_to_Member'>frameheadpos</span></a> <span class='Operator'>+ </span><a href="nodeWindowAgg.c.html#LN2698"><span class='Ref_to_Parameter'>relpos</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/windowapi.h.html#LN33"><span class='Ref_to_Const'>WINDOW_SEEK_TAIL</span></a><span class='Operator'>: 
</span>            <a href="nodeWindowAgg.c.html#LN184"><span class='Ref_to_Proto'>update_frametailpos</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2697"><span class='Ref_to_Parameter'>winobj</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2703"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="nodeWindowAgg.c.html#LN2705"><span class='Ref_To_Local'>abs_pos</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2701"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1810"><span class='Ref_to_Member'>frametailpos</span></a> <span class='Operator'>+ </span><a href="nodeWindowAgg.c.html#LN2698"><span class='Ref_to_Parameter'>relpos</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized window seek type: %d"</span><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2698"><span class='Ref_to_Parameter'>seektype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="nodeWindowAgg.c.html#LN2705"><span class='Ref_To_Local'>abs_pos</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="nodeWindowAgg.c.html#LN2704"><span class='Ref_To_Local'>gottuple</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN193"><span class='Ref_to_Proto'>window_gettupleslot</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2697"><span class='Ref_to_Parameter'>winobj</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2705"><span class='Ref_To_Local'>abs_pos</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2703"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2704"><span class='Ref_To_Local'>gottuple</span></a><span class='Parentheses'>) 
</span>        <a href="nodeWindowAgg.c.html#LN2704"><span class='Ref_To_Local'>gottuple</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN181"><span class='Ref_to_Proto'>row_is_in_frame</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2701"><span class='Ref_To_Local'>winstate</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2705"><span class='Ref_To_Local'>abs_pos</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2703"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nodeWindowAgg.c.html#LN2704"><span class='Ref_To_Local'>gottuple</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2699"><span class='Ref_to_Parameter'>isout</span></a><span class='Parentheses'>) 
</span>            <span class='Operator'>*</span><a href="nodeWindowAgg.c.html#LN2699"><span class='Ref_to_Parameter'>isout</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="nodeWindowAgg.c.html#LN2699"><span class='Ref_to_Parameter'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2699"><span class='Ref_to_Parameter'>isout</span></a><span class='Parentheses'>) 
</span>            <span class='Operator'>*</span><a href="nodeWindowAgg.c.html#LN2699"><span class='Ref_to_Parameter'>isout</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2698"><span class='Ref_to_Parameter'>set_mark</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2748"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>frameOptions</span> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2701"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1817"><span class='Ref_to_Member'>frameOptions</span></a><span class='Delimiter'>; 
</span><a name="LN2749"></a>            <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>mark_pos</span> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2705"><span class='Ref_To_Local'>abs_pos</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * In RANGE mode with a moving frame head, we must not let the 
             * mark advance past frameheadpos, since that row has to be 
             * fetchable during future update_frameheadpos calls. 
             * 
             * XXX it is very ugly to pollute window functions' marks with 
             * this consideration; it could for instance mask a logic bug that 
             * lets a window function fetch rows before what it had claimed 
             * was its mark.  Perhaps use a separate mark for frame head 
             * probes? 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="nodeWindowAgg.c.html#LN2748"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN505"><span class='Ref_to_Const'>FRAMEOPTION_RANGE</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                <span class='Operator'>!</span><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2748"><span class='Ref_To_Local'>frameOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN508"><span class='Ref_to_Const'>FRAMEOPTION_START_UNBOUNDED_PRECEDING</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="nodeWindowAgg.c.html#LN183"><span class='Ref_to_Proto'>update_frameheadpos</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2697"><span class='Ref_to_Parameter'>winobj</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2701"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1846"><span class='Ref_to_Member'>temp_slot_2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2749"><span class='Ref_To_Local'>mark_pos</span></a> <span class='Operator'>&GT; </span><a href="nodeWindowAgg.c.html#LN2701"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1809"><span class='Ref_to_Member'>frameheadpos</span></a><span class='Parentheses'>) 
</span>                    <a href="nodeWindowAgg.c.html#LN2749"><span class='Ref_To_Local'>mark_pos</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2701"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1809"><span class='Ref_to_Member'>frameheadpos</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="../../include/windowapi.h.html#LN48"><span class='Ref_to_Proto'>WinSetMarkPosition</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2697"><span class='Ref_to_Parameter'>winobj</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2749"><span class='Ref_To_Local'>mark_pos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if set_mark &raquo; </span> 
        <a href="nodeWindowAgg.c.html#LN2702"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN198"><span class='Ref_to_Member'>ecxt_outertuple</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2703"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../../include/executor/executor.h.html#LN264"><span class='Ref_to_Func'>ExecEvalExpr</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN223"><span class='Ref_to_Proto'>list_nth</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2697"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN62"><span class='Ref_to_Member'>argstates</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2697"><span class='Ref_to_Parameter'>argno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="nodeWindowAgg.c.html#LN2702"><span class='Ref_To_Local'>econtext</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2699"><span class='Ref_to_Parameter'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end WinGetFuncArgInFrame &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * WinGetFuncArgCurrent 
 *      Evaluate a window function's argument expression on the current row. 
 * 
 * argno: argument number to evaluate (counted from 0) 
 * isnull: output argument, receives isnull status of result 
 * 
 * Note: this isn't quite equivalent to WinGetFuncArgInPartition or 
 * WinGetFuncArgInFrame targeting the current row, because it will succeed 
 * even if the WindowObject's mark has been set beyond the current row. 
 * This should generally be used for "ordinary" arguments of a window 
 * function, such as the offset argument of lead() or lag(). 
 */ 
</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2791"></a><span class='Declare_Function'>WinGetFuncArgCurrent</span><span class='Parentheses'>(</span><a href="../../include/windowapi.h.html#LN36"><span class='Ref_to_Typedef'>WindowObject</span></a> <span class='Declare_Parameter'>winobj</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>argno</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2793"></a>    <a href="../../include/nodes/execnodes.h.html#LN1792"><span class='Ref_to_Struct'>WindowAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>winstate</span><span class='Delimiter'>; 
</span><a name="LN2794"></a>    <a href="../../include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>econtext</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/windowapi.h.html#LN40"><span class='Ref_to_Macro'>WindowObjectIsValid</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2791"><span class='Ref_to_Parameter'>winobj</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="nodeWindowAgg.c.html#LN2793"><span class='Ref_To_Local'>winstate</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2791"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN61"><span class='Ref_to_Member'>winstate</span></a><span class='Delimiter'>; 
</span> 
    <a href="nodeWindowAgg.c.html#LN2794"><span class='Ref_To_Local'>econtext</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2793"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN842"><span class='Ref_to_Member'>ps_ExprContext</span></a><span class='Delimiter'>; 
</span> 
    <a href="nodeWindowAgg.c.html#LN2794"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN198"><span class='Ref_to_Member'>ecxt_outertuple</span></a> <span class='Operator'>= </span><a href="nodeWindowAgg.c.html#LN2793"><span class='Ref_To_Local'>winstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN1794"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../include/nodes/execnodes.h.html#LN1060"><span class='Ref_to_Member'>ss_ScanTupleSlot</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="../../include/executor/executor.h.html#LN264"><span class='Ref_to_Func'>ExecEvalExpr</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN223"><span class='Ref_to_Proto'>list_nth</span></a><span class='Parentheses'>(</span><a href="nodeWindowAgg.c.html#LN2791"><span class='Ref_to_Parameter'>winobj</span></a><span class='Operator'>-&GT;</span><a href="nodeWindowAgg.c.html#LN62"><span class='Ref_to_Member'>argstates</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2791"><span class='Ref_to_Parameter'>argno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="nodeWindowAgg.c.html#LN2794"><span class='Ref_To_Local'>econtext</span></a><span class='Delimiter'>, </span><a href="nodeWindowAgg.c.html#LN2791"><span class='Ref_to_Parameter'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>