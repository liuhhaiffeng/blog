<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\executor\spi.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\executor\spi.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:40 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * spi.c 
 *              Server Programming Interface 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/executor/spi.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/printtup.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/sysattr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xact.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/heap.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/trigger.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"executor/executor.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"executor/spi_priv.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"tcop/pquery.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"tcop/utility.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/datum.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/snapmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/typcache.h"</span> 
 
 
<a name="LN38"></a><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Var'>SPI_processed</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN39"></a><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Var'>SPI_lastoid</span> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span><a name="LN40"></a><a href="../../include/executor/spi.h.html#LN21"><span class='Ref_to_Struct'>SPITupleTable</span></a> <span class='Operator'>*</span><span class='Declare_Var'>SPI_tuptable</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN41"></a><span class='Keyword'>int</span>         <span class='Declare_Var'>SPI_result</span><span class='Delimiter'>; 
</span> 
<a name="LN43"></a><span class='Keyword'>static </span><a href="../../include/executor/spi_priv.h.html#LN21"><span class='Ref_to_Typedef'>_SPI_connection</span></a> <span class='Operator'>*</span><span class='Declare_Var'>_SPI_stack</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN44"></a><span class='Keyword'>static </span><a href="../../include/executor/spi_priv.h.html#LN21"><span class='Ref_to_Typedef'>_SPI_connection</span></a> <span class='Operator'>*</span><span class='Declare_Var'>_SPI_current</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN45"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>_SPI_stack_depth</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* allocated size of _SPI_stack */ 
</span><a name="LN46"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>_SPI_connected</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* current stack index */ 
</span> 
<a name="LN48"></a><span class='Keyword'>static </span><a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> <span class='Declare_Prototype'>SPI_cursor_open_internal</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Delimiter'>, </span><a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a> <span class='Declare_Parameter'>plan</span><span class='Delimiter'>, 
</span><a name="LN49"></a>                         <a href="../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Parameter'>paramLI</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>read_only</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN51"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_SPI_prepare_plan</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Delimiter'>, </span><a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a> <span class='Declare_Parameter'>plan</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN53"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_SPI_prepare_oneshot_plan</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Delimiter'>, </span><a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a> <span class='Declare_Parameter'>plan</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN55"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>_SPI_execute_plan</span><span class='Parentheses'>(</span><a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a> <span class='Declare_Parameter'>plan</span><span class='Delimiter'>, </span><a href="../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Parameter'>paramLI</span><span class='Delimiter'>, 
</span><a name="LN56"></a>                  <a href="../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a> <span class='Declare_Parameter'>snapshot</span><span class='Delimiter'>, </span><a href="../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a> <span class='Declare_Parameter'>crosscheck_snapshot</span><span class='Delimiter'>, 
</span><a name="LN57"></a>                  <span class='Keyword'>bool </span><span class='Declare_Parameter'>read_only</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>fire_triggers</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Parameter'>tcount</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN59"></a><span class='Keyword'>static </span><a href="../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Prototype'>_SPI_convert_params</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>nargs</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>argtypes</span><span class='Delimiter'>, 
</span><a name="LN60"></a>                    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>Values</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>Nulls</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN62"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>_SPI_pquery</span><span class='Parentheses'>(</span><a href="../../include/executor/execdesc.h.html#LN32"><span class='Ref_to_Struct'>QueryDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>queryDesc</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>fire_triggers</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Parameter'>tcount</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN64"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_SPI_error_callback</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN66"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_SPI_cursor_operation</span><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> <span class='Declare_Parameter'>portal</span><span class='Delimiter'>, 
</span><a name="LN67"></a>                      <a href="../../include/nodes/parsenodes.h.html#LN2635"><span class='Ref_to_Enum'>FetchDirection</span></a> <span class='Declare_Parameter'>direction</span><span class='Delimiter'>, </span><span class='Keyword'>long </span><span class='Declare_Parameter'>count</span><span class='Delimiter'>, 
</span><a name="LN68"></a>                      <a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dest</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN70"></a><span class='Keyword'>static </span><a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a> <span class='Declare_Prototype'>_SPI_make_plan_non_temp</span><span class='Parentheses'>(</span><a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a> <span class='Declare_Parameter'>plan</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN71"></a><span class='Keyword'>static </span><a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a> <span class='Declare_Prototype'>_SPI_save_plan</span><span class='Parentheses'>(</span><a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a> <span class='Declare_Parameter'>plan</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN73"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>_SPI_begin_call</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>execmem</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN74"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>_SPI_end_call</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>procmem</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN75"></a><span class='Keyword'>static </span><a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Prototype'>_SPI_execmem</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN76"></a><span class='Keyword'>static </span><a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Prototype'>_SPI_procmem</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN77"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>_SPI_checktuples</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* =================== interface functions =================== */ 
</span> 
<span class='Keyword'>int 
</span><a name="LN83"></a><span class='Declare_Function'>SPI_connect</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN85"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>newdepth</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Enlarge stack if necessary */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN43"><span class='Ref_to_Global_Var'>_SPI_stack</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN46"><span class='Ref_to_Global_Var'>_SPI_connected</span></a> <span class='Operator'>!= -</span><span class='Number'>1</span> <span class='Operator'>|| </span><a href="spi.c.html#LN45"><span class='Ref_to_Global_Var'>_SPI_stack_depth</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"SPI stack corrupted"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN85"><span class='Ref_To_Local'>newdepth</span></a> <span class='Operator'>= </span><span class='Number'>16</span><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN43"><span class='Ref_to_Global_Var'>_SPI_stack</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/executor/spi_priv.h.html#LN21"><span class='Ref_to_Typedef'>_SPI_connection</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN47"><span class='Ref_to_Global_Var'>TopTransactionContext</span></a><span class='Delimiter'>, 
</span>                               <a href="spi.c.html#LN85"><span class='Ref_To_Local'>newdepth</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/executor/spi_priv.h.html#LN21"><span class='Ref_to_Typedef'>_SPI_connection</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN45"><span class='Ref_to_Global_Var'>_SPI_stack_depth</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN85"><span class='Ref_To_Local'>newdepth</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN45"><span class='Ref_to_Global_Var'>_SPI_stack_depth</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="spi.c.html#LN45"><span class='Ref_to_Global_Var'>_SPI_stack_depth</span></a> <span class='Operator'>&LT;= </span><a href="spi.c.html#LN46"><span class='Ref_to_Global_Var'>_SPI_connected</span></a><span class='Parentheses'>) 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"SPI stack corrupted"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN45"><span class='Ref_to_Global_Var'>_SPI_stack_depth</span></a> <span class='Operator'>== </span><a href="spi.c.html#LN46"><span class='Ref_to_Global_Var'>_SPI_connected</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="spi.c.html#LN85"><span class='Ref_To_Local'>newdepth</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN45"><span class='Ref_to_Global_Var'>_SPI_stack_depth</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>            <a href="spi.c.html#LN43"><span class='Ref_to_Global_Var'>_SPI_stack</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/executor/spi_priv.h.html#LN21"><span class='Ref_to_Typedef'>_SPI_connection</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                <a href="../../include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN43"><span class='Ref_to_Global_Var'>_SPI_stack</span></a><span class='Delimiter'>, 
</span>                         <a href="spi.c.html#LN85"><span class='Ref_To_Local'>newdepth</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/executor/spi_priv.h.html#LN21"><span class='Ref_to_Typedef'>_SPI_connection</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="spi.c.html#LN45"><span class='Ref_to_Global_Var'>_SPI_stack_depth</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN85"><span class='Ref_To_Local'>newdepth</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Enter new stack level */ 
</span>    <a href="spi.c.html#LN46"><span class='Ref_to_Global_Var'>_SPI_connected</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="spi.c.html#LN46"><span class='Ref_to_Global_Var'>_SPI_connected</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="spi.c.html#LN46"><span class='Ref_to_Global_Var'>_SPI_connected</span></a> <span class='Operator'>&LT; </span><a href="spi.c.html#LN45"><span class='Ref_to_Global_Var'>_SPI_stack_depth</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a> <span class='Operator'>= &</span><span class='Parentheses'>(</span><a href="spi.c.html#LN43"><span class='Ref_to_Global_Var'>_SPI_stack</span></a><span class='Delimiter'>[</span><a href="spi.c.html#LN46"><span class='Ref_to_Global_Var'>_SPI_connected</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN24"><span class='Ref_to_Member'>processed</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN25"><span class='Ref_to_Member'>lastoid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN26"><span class='Ref_to_Member'>tuptable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="../../include/lib/ilist.h.html#LN552"><span class='Ref_to_Func'>slist_init</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN29"><span class='Ref_to_Member'>tuptables</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN30"><span class='Ref_to_Member'>procCxt</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* in case we fail to create 'em */ 
</span>    <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN31"><span class='Ref_to_Member'>execCxt</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN33"><span class='Ref_to_Member'>connectSubid</span></a> <span class='Operator'>= </span><a href="../../include/access/xact.h.html#LN336"><span class='Ref_to_Proto'>GetCurrentSubTransactionId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN34"><span class='Ref_to_Member'>queryEnv</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create memory contexts for this procedure 
     * 
     * XXX it would be better to use PortalContext as the parent context, but 
     * we may not be inside a portal (consider deferred-trigger execution). 
     * Perhaps CurTransactionContext would do?  For now it doesn't matter 
     * because we clean up explicitly in AtEOSubXact_SPI(). 
     */ 
</span>    <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN30"><span class='Ref_to_Member'>procCxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN47"><span class='Ref_to_Global_Var'>TopTransactionContext</span></a><span class='Delimiter'>, 
</span>                                                  <span class='String'>"SPI Proc"</span><span class='Delimiter'>, 
</span>                                                  <a href="../../include/utils/memutils.h.html#LN164"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN31"><span class='Ref_to_Member'>execCxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN47"><span class='Ref_to_Global_Var'>TopTransactionContext</span></a><span class='Delimiter'>, 
</span>                                                  <span class='String'>"SPI Exec"</span><span class='Delimiter'>, 
</span>                                                  <a href="../../include/utils/memutils.h.html#LN164"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* ... and switch to procedure's context */ 
</span>    <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN32"><span class='Ref_to_Member'>savedcxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN30"><span class='Ref_to_Member'>procCxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/executor/spi.h.html#LN49"><span class='Ref_to_Const'>SPI_OK_CONNECT</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SPI_connect &raquo; </span> 
 
<span class='Keyword'>int 
</span><a name="LN147"></a><span class='Declare_Function'>SPI_finish</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN149"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN149"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN73"><span class='Ref_to_Proto'>_SPI_begin_call</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* live in procedure memory */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN149"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="spi.c.html#LN149"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Restore memory context as it was before procedure call */ 
</span>    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN32"><span class='Ref_to_Member'>savedcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Release memory used in procedure call (including tuptables) */ 
</span>    <a href="../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN31"><span class='Ref_to_Member'>execCxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN31"><span class='Ref_to_Member'>execCxt</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN30"><span class='Ref_to_Member'>procCxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN30"><span class='Ref_to_Member'>procCxt</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Reset result variables, especially SPI_tuptable which is probably 
     * pointing at a just-deleted tuptable 
     */ 
</span>    <a href="spi.c.html#LN38"><span class='Ref_to_Global_Var'>SPI_processed</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN39"><span class='Ref_to_Global_Var'>SPI_lastoid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Exit stack level */ 
</span>    <a href="spi.c.html#LN46"><span class='Ref_to_Global_Var'>_SPI_connected</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN46"><span class='Ref_to_Global_Var'>_SPI_connected</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a> <span class='Operator'>= &</span><span class='Parentheses'>(</span><a href="spi.c.html#LN43"><span class='Ref_to_Global_Var'>_SPI_stack</span></a><span class='Delimiter'>[</span><a href="spi.c.html#LN46"><span class='Ref_to_Global_Var'>_SPI_connected</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/executor/spi.h.html#LN50"><span class='Ref_to_Const'>SPI_OK_FINISH</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SPI_finish &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Clean up SPI state at transaction commit or abort. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN186"></a><span class='Declare_Function'>AtEOXact_SPI</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isCommit</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * Note that memory contexts belonging to SPI stack entries will be freed 
     * automatically, so we can ignore them here.  We just need to restore our 
     * static variables to initial state. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN186"><span class='Ref_to_Parameter'>isCommit</span></a> <span class='Operator'>&& </span><a href="spi.c.html#LN46"><span class='Ref_to_Global_Var'>_SPI_connected</span></a> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WARNING<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"transaction left non-empty SPI stack"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Check for missing \"SPI_finish\" calls."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN43"><span class='Ref_to_Global_Var'>_SPI_stack</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN45"><span class='Ref_to_Global_Var'>_SPI_stack_depth</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN46"><span class='Ref_to_Global_Var'>_SPI_connected</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN38"><span class='Ref_to_Global_Var'>SPI_processed</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN39"><span class='Ref_to_Global_Var'>SPI_lastoid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AtEOXact_SPI &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Clean up SPI state at subtransaction commit or abort. 
 * 
 * During commit, there shouldn't be any unclosed entries remaining from 
 * the current subtransaction; we emit a warning if any are found. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN214"></a><span class='Declare_Function'>AtEOSubXact_SPI</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isCommit</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN400"><span class='Ref_to_Typedef'>SubTransactionId</span></a> <span class='Declare_Parameter'>mySubid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN216"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN46"><span class='Ref_to_Global_Var'>_SPI_connected</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN220"></a>        <a href="../../include/executor/spi_priv.h.html#LN21"><span class='Ref_to_Typedef'>_SPI_connection</span></a> <span class='Operator'>*</span><span class='Declare_Local'>connection</span> <span class='Operator'>= &</span><span class='Parentheses'>(</span><a href="spi.c.html#LN43"><span class='Ref_to_Global_Var'>_SPI_stack</span></a><span class='Delimiter'>[</span><a href="spi.c.html#LN46"><span class='Ref_to_Global_Var'>_SPI_connected</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN220"><span class='Ref_To_Local'>connection</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN33"><span class='Ref_to_Member'>connectSubid</span></a> <span class='Operator'>!= </span><a href="spi.c.html#LN214"><span class='Ref_to_Parameter'>mySubid</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* couldn't be any underneath it either */ 
</span> 
        <a href="spi.c.html#LN216"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Release procedure memory explicitly (see note in SPI_connect) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN220"><span class='Ref_To_Local'>connection</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN31"><span class='Ref_to_Member'>execCxt</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN220"><span class='Ref_To_Local'>connection</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN31"><span class='Ref_to_Member'>execCxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="spi.c.html#LN220"><span class='Ref_To_Local'>connection</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN31"><span class='Ref_to_Member'>execCxt</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN220"><span class='Ref_To_Local'>connection</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN30"><span class='Ref_to_Member'>procCxt</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN220"><span class='Ref_To_Local'>connection</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN30"><span class='Ref_to_Member'>procCxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="spi.c.html#LN220"><span class='Ref_To_Local'>connection</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN30"><span class='Ref_to_Member'>procCxt</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Pop the stack entry and reset global variables.  Unlike 
         * SPI_finish(), we don't risk switching to memory contexts that might 
         * be already gone. 
         */ 
</span>        <a href="spi.c.html#LN46"><span class='Ref_to_Global_Var'>_SPI_connected</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN46"><span class='Ref_to_Global_Var'>_SPI_connected</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a> <span class='Operator'>= &</span><span class='Parentheses'>(</span><a href="spi.c.html#LN43"><span class='Ref_to_Global_Var'>_SPI_stack</span></a><span class='Delimiter'>[</span><a href="spi.c.html#LN46"><span class='Ref_to_Global_Var'>_SPI_connected</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN38"><span class='Ref_to_Global_Var'>SPI_processed</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN39"><span class='Ref_to_Global_Var'>SPI_lastoid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while _SPI_connected&GT;=0 &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN216"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>&& </span><a href="spi.c.html#LN214"><span class='Ref_to_Parameter'>isCommit</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WARNING<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"subtransaction left non-empty SPI stack"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Check for missing \"SPI_finish\" calls."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we are aborting a subtransaction and there is an open SPI context 
     * surrounding the subxact, clean up to prevent memory leakage. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a> <span class='Operator'>&& !</span><a href="spi.c.html#LN214"><span class='Ref_to_Parameter'>isCommit</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN268"></a>        <a href="../../include/lib/ilist.h.html#LN238"><span class='Ref_to_Struct'>slist_mutable_iter</span></a> <span class='Declare_Local'>siter</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* free Executor memory the same as _SPI_end_call would do */ 
</span>        <a href="../../include/utils/memutils.h.html#LN66"><span class='Ref_to_Macro'>MemoryContextResetAndDeleteChildren</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN31"><span class='Ref_to_Member'>execCxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* throw away any tuple tables created within current subxact */ 
</span>        <a href="../../include/lib/ilist.h.html#LN715"><span class='Ref_to_Macro'>slist_foreach_modify</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN268"><span class='Ref_To_Local'>siter</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN29"><span class='Ref_to_Member'>tuptables</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN276"></a>            <a href="../../include/executor/spi.h.html#LN21"><span class='Ref_to_Struct'>SPITupleTable</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tuptable</span><span class='Delimiter'>; 
</span> 
            <a href="spi.c.html#LN276"><span class='Ref_To_Local'>tuptable</span></a> <span class='Operator'>= </span><a href="../../include/lib/ilist.h.html#LN673"><span class='Ref_to_Macro'>slist_container</span></a><span class='Parentheses'>(</span><a href="../../include/executor/spi.h.html#LN21"><span class='Ref_to_Struct'>SPITupleTable</span></a><span class='Delimiter'>, </span><a href="../regex/regcomp.c.html#LN84"><span class='Ref_to_Proto'>next</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN268"><span class='Ref_To_Local'>siter</span></a><span class='Operator'>.</span><a href="../../include/lib/ilist.h.html#LN240"><span class='Ref_to_Member'>cur</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN276"><span class='Ref_To_Local'>tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi.h.html#LN29"><span class='Ref_to_Member'>subid</span></a> <span class='Operator'>&GT;= </span><a href="spi.c.html#LN214"><span class='Ref_to_Parameter'>mySubid</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * If we used SPI_freetuptable() here, its internal search of 
                 * the tuptables list would make this operation O(N^2). 
                 * Instead, just free the tuptable manually.  This should 
                 * match what SPI_freetuptable() does. 
                 */ 
</span>                <a href="../../include/lib/ilist.h.html#LN650"><span class='Ref_to_Func'>slist_delete_current</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="spi.c.html#LN268"><span class='Ref_To_Local'>siter</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN276"><span class='Ref_To_Local'>tuptable</span></a> <span class='Operator'>== </span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN26"><span class='Ref_to_Member'>tuptable</span></a><span class='Parentheses'>) 
</span>                    <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN26"><span class='Ref_to_Member'>tuptable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN276"><span class='Ref_To_Local'>tuptable</span></a> <span class='Operator'>== </span><a href="spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Parentheses'>) 
</span>                    <a href="spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <a href="../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN276"><span class='Ref_To_Local'>tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi.h.html#LN23"><span class='Ref_to_Member'>tuptabcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* in particular we should have gotten rid of any in-progress table */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN26"><span class='Ref_to_Member'>tuptable</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if _SPI_current&&!isComm... &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end AtEOSubXact_SPI &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* Parse, plan, and execute a query string */ 
</span><span class='Keyword'>int 
</span><a name="LN303"></a><span class='Declare_Function'>SPI_execute</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>read_only</span><span class='Delimiter'>, </span><span class='Keyword'>long </span><span class='Declare_Parameter'>tcount</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN305"></a>    <a href="../../include/executor/spi_priv.h.html#LN76"><span class='Ref_to_Struct'>_SPI_plan</span></a>   <span class='Declare_Local'>plan</span><span class='Delimiter'>; 
</span><a name="LN306"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN303"><span class='Ref_to_Parameter'>src</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="spi.c.html#LN303"><span class='Ref_to_Parameter'>tcount</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../include/executor/spi.h.html#LN40"><span class='Ref_to_Const'>SPI_ERROR_ARGUMENT</span></a><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN306"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN73"><span class='Ref_to_Proto'>_SPI_begin_call</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN306"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="spi.c.html#LN306"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span> 
    memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="spi.c.html#LN305"><span class='Ref_To_Local'>plan</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/executor/spi_priv.h.html#LN76"><span class='Ref_to_Struct'>_SPI_plan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN305"><span class='Ref_To_Local'>plan</span></a><span class='Operator'>.</span><a href="../../include/executor/spi_priv.h.html#LN78"><span class='Ref_to_Member'>magic</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi_priv.h.html#LN19"><span class='Ref_to_Const'>_SPI_PLAN_MAGIC</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN305"><span class='Ref_To_Local'>plan</span></a><span class='Operator'>.</span><a href="../../include/executor/spi_priv.h.html#LN83"><span class='Ref_to_Member'>cursor_options</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN2610"><span class='Ref_to_Const'>CURSOR_OPT_PARALLEL_OK</span></a><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN53"><span class='Ref_to_Proto'>_SPI_prepare_oneshot_plan</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN303"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spi.c.html#LN305"><span class='Ref_To_Local'>plan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN306"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN55"><span class='Ref_to_Proto'>_SPI_execute_plan</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="spi.c.html#LN305"><span class='Ref_To_Local'>plan</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/snapshot.h.html#LN24"><span class='Ref_to_Const'>InvalidSnapshot</span></a><span class='Delimiter'>, </span><a href="../../include/utils/snapshot.h.html#LN24"><span class='Ref_to_Const'>InvalidSnapshot</span></a><span class='Delimiter'>, 
</span>                            <a href="spi.c.html#LN303"><span class='Ref_to_Parameter'>read_only</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="spi.c.html#LN303"><span class='Ref_to_Parameter'>tcount</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN74"><span class='Ref_to_Proto'>_SPI_end_call</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="spi.c.html#LN306"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SPI_execute &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* Obsolete version of SPI_execute */ 
</span><span class='Keyword'>int 
</span><a name="LN331"></a><span class='Declare_Function'>SPI_exec</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Delimiter'>, </span><span class='Keyword'>long </span><span class='Declare_Parameter'>tcount</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="../../include/executor/spi.h.html#LN81"><span class='Ref_to_Proto'>SPI_execute</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN331"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="spi.c.html#LN331"><span class='Ref_to_Parameter'>tcount</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* Execute a previously prepared plan */ 
</span><span class='Keyword'>int 
</span><a name="LN338"></a><span class='Declare_Function'>SPI_execute_plan</span><span class='Parentheses'>(</span><a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a> <span class='Declare_Parameter'>plan</span><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>Values</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>Nulls</span><span class='Delimiter'>, 
</span><a name="LN339"></a>                 <span class='Keyword'>bool </span><span class='Declare_Parameter'>read_only</span><span class='Delimiter'>, </span><span class='Keyword'>long </span><span class='Declare_Parameter'>tcount</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN341"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN338"><span class='Ref_to_Parameter'>plan</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="spi.c.html#LN338"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN78"><span class='Ref_to_Member'>magic</span></a> <span class='Operator'>!= </span><a href="../../include/executor/spi_priv.h.html#LN19"><span class='Ref_to_Const'>_SPI_PLAN_MAGIC</span></a> <span class='Operator'>|| </span><a href="spi.c.html#LN339"><span class='Ref_to_Parameter'>tcount</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../include/executor/spi.h.html#LN40"><span class='Ref_to_Const'>SPI_ERROR_ARGUMENT</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN338"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN84"><span class='Ref_to_Member'>nargs</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="spi.c.html#LN338"><span class='Ref_to_Parameter'>Values</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../include/executor/spi.h.html#LN41"><span class='Ref_to_Const'>SPI_ERROR_PARAM</span></a><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN341"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN73"><span class='Ref_to_Proto'>_SPI_begin_call</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN341"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="spi.c.html#LN341"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN341"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN55"><span class='Ref_to_Proto'>_SPI_execute_plan</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN338"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>, 
</span>                            <a href="spi.c.html#LN59"><span class='Ref_to_Proto'>_SPI_convert_params</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN338"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN84"><span class='Ref_to_Member'>nargs</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN338"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN85"><span class='Ref_to_Member'>argtypes</span></a><span class='Delimiter'>, 
</span>                                                <a href="spi.c.html#LN338"><span class='Ref_to_Parameter'>Values</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN338"><span class='Ref_to_Parameter'>Nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/snapshot.h.html#LN24"><span class='Ref_to_Const'>InvalidSnapshot</span></a><span class='Delimiter'>, </span><a href="../../include/utils/snapshot.h.html#LN24"><span class='Ref_to_Const'>InvalidSnapshot</span></a><span class='Delimiter'>, 
</span>                            <a href="spi.c.html#LN339"><span class='Ref_to_Parameter'>read_only</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="spi.c.html#LN339"><span class='Ref_to_Parameter'>tcount</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN74"><span class='Ref_to_Proto'>_SPI_end_call</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="spi.c.html#LN341"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SPI_execute_plan &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* Obsolete version of SPI_execute_plan */ 
</span><span class='Keyword'>int 
</span><a name="LN365"></a><span class='Declare_Function'>SPI_execp</span><span class='Parentheses'>(</span><a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a> <span class='Declare_Parameter'>plan</span><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>Values</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>Nulls</span><span class='Delimiter'>, </span><span class='Keyword'>long </span><span class='Declare_Parameter'>tcount</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="../../include/executor/spi.h.html#LN82"><span class='Ref_to_Proto'>SPI_execute_plan</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN365"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN365"><span class='Ref_to_Parameter'>Values</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN365"><span class='Ref_to_Parameter'>Nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="spi.c.html#LN365"><span class='Ref_to_Parameter'>tcount</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* Execute a previously prepared plan */ 
</span><span class='Keyword'>int 
</span><a name="LN372"></a><span class='Declare_Function'>SPI_execute_plan_with_paramlist</span><span class='Parentheses'>(</span><a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a> <span class='Declare_Parameter'>plan</span><span class='Delimiter'>, </span><a href="../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Parameter'>params</span><span class='Delimiter'>, 
</span><a name="LN373"></a>                                <span class='Keyword'>bool </span><span class='Declare_Parameter'>read_only</span><span class='Delimiter'>, </span><span class='Keyword'>long </span><span class='Declare_Parameter'>tcount</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN375"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN372"><span class='Ref_to_Parameter'>plan</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="spi.c.html#LN372"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN78"><span class='Ref_to_Member'>magic</span></a> <span class='Operator'>!= </span><a href="../../include/executor/spi_priv.h.html#LN19"><span class='Ref_to_Const'>_SPI_PLAN_MAGIC</span></a> <span class='Operator'>|| </span><a href="spi.c.html#LN373"><span class='Ref_to_Parameter'>tcount</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../include/executor/spi.h.html#LN40"><span class='Ref_to_Const'>SPI_ERROR_ARGUMENT</span></a><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN375"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN73"><span class='Ref_to_Proto'>_SPI_begin_call</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN375"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="spi.c.html#LN375"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN375"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN55"><span class='Ref_to_Proto'>_SPI_execute_plan</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN372"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN372"><span class='Ref_to_Parameter'>params</span></a><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/snapshot.h.html#LN24"><span class='Ref_to_Const'>InvalidSnapshot</span></a><span class='Delimiter'>, </span><a href="../../include/utils/snapshot.h.html#LN24"><span class='Ref_to_Const'>InvalidSnapshot</span></a><span class='Delimiter'>, 
</span>                            <a href="spi.c.html#LN373"><span class='Ref_to_Parameter'>read_only</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="spi.c.html#LN373"><span class='Ref_to_Parameter'>tcount</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN74"><span class='Ref_to_Proto'>_SPI_end_call</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="spi.c.html#LN375"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SPI_execute_plan_with_paramlist &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * SPI_execute_snapshot -- identical to SPI_execute_plan, except that we allow 
 * the caller to specify exactly which snapshots to use, which will be 
 * registered here.  Also, the caller may specify that AFTER triggers should be 
 * queued as part of the outer query rather than being fired immediately at the 
 * end of the command. 
 * 
 * This is currently not documented in spi.sgml because it is only intended 
 * for use by RI triggers. 
 * 
 * Passing snapshot == InvalidSnapshot will select the normal behavior of 
 * fetching a new snapshot for each query. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN406"></a><span class='Declare_Function'>SPI_execute_snapshot</span><span class='Parentheses'>(</span><a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a> <span class='Declare_Parameter'>plan</span><span class='Delimiter'>, 
</span><a name="LN407"></a>                     <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>Values</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>Nulls</span><span class='Delimiter'>, 
</span><a name="LN408"></a>                     <a href="../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a> <span class='Declare_Parameter'>snapshot</span><span class='Delimiter'>, </span><a href="../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a> <span class='Declare_Parameter'>crosscheck_snapshot</span><span class='Delimiter'>, 
</span><a name="LN409"></a>                     <span class='Keyword'>bool </span><span class='Declare_Parameter'>read_only</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>fire_triggers</span><span class='Delimiter'>, </span><span class='Keyword'>long </span><span class='Declare_Parameter'>tcount</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN411"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN406"><span class='Ref_to_Parameter'>plan</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="spi.c.html#LN406"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN78"><span class='Ref_to_Member'>magic</span></a> <span class='Operator'>!= </span><a href="../../include/executor/spi_priv.h.html#LN19"><span class='Ref_to_Const'>_SPI_PLAN_MAGIC</span></a> <span class='Operator'>|| </span><a href="spi.c.html#LN409"><span class='Ref_to_Parameter'>tcount</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../include/executor/spi.h.html#LN40"><span class='Ref_to_Const'>SPI_ERROR_ARGUMENT</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN406"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN84"><span class='Ref_to_Member'>nargs</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="spi.c.html#LN407"><span class='Ref_to_Parameter'>Values</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../include/executor/spi.h.html#LN41"><span class='Ref_to_Const'>SPI_ERROR_PARAM</span></a><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN411"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN73"><span class='Ref_to_Proto'>_SPI_begin_call</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN411"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="spi.c.html#LN411"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN411"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN55"><span class='Ref_to_Proto'>_SPI_execute_plan</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN406"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>, 
</span>                            <a href="spi.c.html#LN59"><span class='Ref_to_Proto'>_SPI_convert_params</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN406"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN84"><span class='Ref_to_Member'>nargs</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN406"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN85"><span class='Ref_to_Member'>argtypes</span></a><span class='Delimiter'>, 
</span>                                                <a href="spi.c.html#LN407"><span class='Ref_to_Parameter'>Values</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN407"><span class='Ref_to_Parameter'>Nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="spi.c.html#LN408"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN408"><span class='Ref_to_Parameter'>crosscheck_snapshot</span></a><span class='Delimiter'>, 
</span>                            <a href="spi.c.html#LN409"><span class='Ref_to_Parameter'>read_only</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN409"><span class='Ref_to_Parameter'>fire_triggers</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN409"><span class='Ref_to_Parameter'>tcount</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN74"><span class='Ref_to_Proto'>_SPI_end_call</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="spi.c.html#LN411"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SPI_execute_snapshot &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * SPI_execute_with_args -- plan and execute a query with supplied arguments 
 * 
 * This is functionally equivalent to SPI_prepare followed by 
 * SPI_execute_plan. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN440"></a><span class='Declare_Function'>SPI_execute_with_args</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Delimiter'>, 
</span><a name="LN441"></a>                      <span class='Keyword'>int </span><span class='Declare_Parameter'>nargs</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>argtypes</span><span class='Delimiter'>, 
</span><a name="LN442"></a>                      <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>Values</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>Nulls</span><span class='Delimiter'>, 
</span><a name="LN443"></a>                      <span class='Keyword'>bool </span><span class='Declare_Parameter'>read_only</span><span class='Delimiter'>, </span><span class='Keyword'>long </span><span class='Declare_Parameter'>tcount</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN445"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN446"></a>    <a href="../../include/executor/spi_priv.h.html#LN76"><span class='Ref_to_Struct'>_SPI_plan</span></a>   <span class='Declare_Local'>plan</span><span class='Delimiter'>; 
</span><a name="LN447"></a>    <a href="../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Local'>paramLI</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN440"><span class='Ref_to_Parameter'>src</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="spi.c.html#LN441"><span class='Ref_to_Parameter'>nargs</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="spi.c.html#LN443"><span class='Ref_to_Parameter'>tcount</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../include/executor/spi.h.html#LN40"><span class='Ref_to_Const'>SPI_ERROR_ARGUMENT</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN441"><span class='Ref_to_Parameter'>nargs</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="spi.c.html#LN441"><span class='Ref_to_Parameter'>argtypes</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="spi.c.html#LN442"><span class='Ref_to_Parameter'>Values</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="../../include/executor/spi.h.html#LN41"><span class='Ref_to_Const'>SPI_ERROR_PARAM</span></a><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN445"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN73"><span class='Ref_to_Proto'>_SPI_begin_call</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN445"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="spi.c.html#LN445"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span> 
    memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="spi.c.html#LN446"><span class='Ref_To_Local'>plan</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/executor/spi_priv.h.html#LN76"><span class='Ref_to_Struct'>_SPI_plan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN446"><span class='Ref_To_Local'>plan</span></a><span class='Operator'>.</span><a href="../../include/executor/spi_priv.h.html#LN78"><span class='Ref_to_Member'>magic</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi_priv.h.html#LN19"><span class='Ref_to_Const'>_SPI_PLAN_MAGIC</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN446"><span class='Ref_To_Local'>plan</span></a><span class='Operator'>.</span><a href="../../include/executor/spi_priv.h.html#LN83"><span class='Ref_to_Member'>cursor_options</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN2610"><span class='Ref_to_Const'>CURSOR_OPT_PARALLEL_OK</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN446"><span class='Ref_To_Local'>plan</span></a><span class='Operator'>.</span><a href="../../include/executor/spi_priv.h.html#LN84"><span class='Ref_to_Member'>nargs</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN441"><span class='Ref_to_Parameter'>nargs</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN446"><span class='Ref_To_Local'>plan</span></a><span class='Operator'>.</span><a href="../../include/executor/spi_priv.h.html#LN85"><span class='Ref_to_Member'>argtypes</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN441"><span class='Ref_to_Parameter'>argtypes</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN446"><span class='Ref_To_Local'>plan</span></a><span class='Operator'>.</span><a href="../../include/executor/spi_priv.h.html#LN86"><span class='Ref_to_Member'>parserSetup</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN446"><span class='Ref_To_Local'>plan</span></a><span class='Operator'>.</span><a href="../../include/executor/spi_priv.h.html#LN87"><span class='Ref_to_Member'>parserSetupArg</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN447"><span class='Ref_To_Local'>paramLI</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN59"><span class='Ref_to_Proto'>_SPI_convert_params</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN441"><span class='Ref_to_Parameter'>nargs</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN441"><span class='Ref_to_Parameter'>argtypes</span></a><span class='Delimiter'>, 
</span>                                  <a href="spi.c.html#LN442"><span class='Ref_to_Parameter'>Values</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN442"><span class='Ref_to_Parameter'>Nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN53"><span class='Ref_to_Proto'>_SPI_prepare_oneshot_plan</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN440"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spi.c.html#LN446"><span class='Ref_To_Local'>plan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN445"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN55"><span class='Ref_to_Proto'>_SPI_execute_plan</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="spi.c.html#LN446"><span class='Ref_To_Local'>plan</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN447"><span class='Ref_To_Local'>paramLI</span></a><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/snapshot.h.html#LN24"><span class='Ref_to_Const'>InvalidSnapshot</span></a><span class='Delimiter'>, </span><a href="../../include/utils/snapshot.h.html#LN24"><span class='Ref_to_Const'>InvalidSnapshot</span></a><span class='Delimiter'>, 
</span>                            <a href="spi.c.html#LN443"><span class='Ref_to_Parameter'>read_only</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="spi.c.html#LN443"><span class='Ref_to_Parameter'>tcount</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN74"><span class='Ref_to_Proto'>_SPI_end_call</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="spi.c.html#LN445"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SPI_execute_with_args &raquo; </span> 
 
<a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a> 
<a name="LN481"></a><span class='Declare_Function'>SPI_prepare</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>nargs</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>argtypes</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="../../include/executor/spi.h.html#LN100"><span class='Ref_to_Proto'>SPI_prepare_cursor</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN481"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN481"><span class='Ref_to_Parameter'>nargs</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN481"><span class='Ref_to_Parameter'>argtypes</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a> 
<a name="LN487"></a><span class='Declare_Function'>SPI_prepare_cursor</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>nargs</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>argtypes</span><span class='Delimiter'>, 
</span><a name="LN488"></a>                   <span class='Keyword'>int </span><span class='Declare_Parameter'>cursorOptions</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN490"></a>    <a href="../../include/executor/spi_priv.h.html#LN76"><span class='Ref_to_Struct'>_SPI_plan</span></a>   <span class='Declare_Local'>plan</span><span class='Delimiter'>; 
</span><a name="LN491"></a>    <a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a>  <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN487"><span class='Ref_to_Parameter'>src</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="spi.c.html#LN487"><span class='Ref_to_Parameter'>nargs</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="spi.c.html#LN487"><span class='Ref_to_Parameter'>nargs</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="spi.c.html#LN487"><span class='Ref_to_Parameter'>argtypes</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN40"><span class='Ref_to_Const'>SPI_ERROR_ARGUMENT</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN73"><span class='Ref_to_Proto'>_SPI_begin_call</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="spi.c.html#LN490"><span class='Ref_To_Local'>plan</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/executor/spi_priv.h.html#LN76"><span class='Ref_to_Struct'>_SPI_plan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN490"><span class='Ref_To_Local'>plan</span></a><span class='Operator'>.</span><a href="../../include/executor/spi_priv.h.html#LN78"><span class='Ref_to_Member'>magic</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi_priv.h.html#LN19"><span class='Ref_to_Const'>_SPI_PLAN_MAGIC</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN490"><span class='Ref_To_Local'>plan</span></a><span class='Operator'>.</span><a href="../../include/executor/spi_priv.h.html#LN83"><span class='Ref_to_Member'>cursor_options</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN488"><span class='Ref_to_Parameter'>cursorOptions</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN490"><span class='Ref_To_Local'>plan</span></a><span class='Operator'>.</span><a href="../../include/executor/spi_priv.h.html#LN84"><span class='Ref_to_Member'>nargs</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN487"><span class='Ref_to_Parameter'>nargs</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN490"><span class='Ref_To_Local'>plan</span></a><span class='Operator'>.</span><a href="../../include/executor/spi_priv.h.html#LN85"><span class='Ref_to_Member'>argtypes</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN487"><span class='Ref_to_Parameter'>argtypes</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN490"><span class='Ref_To_Local'>plan</span></a><span class='Operator'>.</span><a href="../../include/executor/spi_priv.h.html#LN86"><span class='Ref_to_Member'>parserSetup</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN490"><span class='Ref_To_Local'>plan</span></a><span class='Operator'>.</span><a href="../../include/executor/spi_priv.h.html#LN87"><span class='Ref_to_Member'>parserSetupArg</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN51"><span class='Ref_to_Proto'>_SPI_prepare_plan</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN487"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spi.c.html#LN490"><span class='Ref_To_Local'>plan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* copy plan to procedure context */ 
</span>    <a href="spi.c.html#LN491"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN70"><span class='Ref_to_Proto'>_SPI_make_plan_non_temp</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="spi.c.html#LN490"><span class='Ref_To_Local'>plan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN74"><span class='Ref_to_Proto'>_SPI_end_call</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="spi.c.html#LN491"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SPI_prepare_cursor &raquo; </span> 
 
<a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a> 
<a name="LN522"></a><span class='Declare_Function'>SPI_prepare_params</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Delimiter'>, 
</span><a name="LN523"></a>                   <a href="../../include/nodes/params.h.html#LN65"><span class='Ref_to_Typedef'>ParserSetupHook</span></a> <span class='Declare_Parameter'>parserSetup</span><span class='Delimiter'>, 
</span><a name="LN524"></a>                   <span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>parserSetupArg</span><span class='Delimiter'>, 
</span><a name="LN525"></a>                   <span class='Keyword'>int </span><span class='Declare_Parameter'>cursorOptions</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN527"></a>    <a href="../../include/executor/spi_priv.h.html#LN76"><span class='Ref_to_Struct'>_SPI_plan</span></a>   <span class='Declare_Local'>plan</span><span class='Delimiter'>; 
</span><a name="LN528"></a>    <a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a>  <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN522"><span class='Ref_to_Parameter'>src</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN40"><span class='Ref_to_Const'>SPI_ERROR_ARGUMENT</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN73"><span class='Ref_to_Proto'>_SPI_begin_call</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="spi.c.html#LN527"><span class='Ref_To_Local'>plan</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/executor/spi_priv.h.html#LN76"><span class='Ref_to_Struct'>_SPI_plan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN527"><span class='Ref_To_Local'>plan</span></a><span class='Operator'>.</span><a href="../../include/executor/spi_priv.h.html#LN78"><span class='Ref_to_Member'>magic</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi_priv.h.html#LN19"><span class='Ref_to_Const'>_SPI_PLAN_MAGIC</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN527"><span class='Ref_To_Local'>plan</span></a><span class='Operator'>.</span><a href="../../include/executor/spi_priv.h.html#LN83"><span class='Ref_to_Member'>cursor_options</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN525"><span class='Ref_to_Parameter'>cursorOptions</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN527"><span class='Ref_To_Local'>plan</span></a><span class='Operator'>.</span><a href="../../include/executor/spi_priv.h.html#LN84"><span class='Ref_to_Member'>nargs</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN527"><span class='Ref_To_Local'>plan</span></a><span class='Operator'>.</span><a href="../../include/executor/spi_priv.h.html#LN85"><span class='Ref_to_Member'>argtypes</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN527"><span class='Ref_To_Local'>plan</span></a><span class='Operator'>.</span><a href="../../include/executor/spi_priv.h.html#LN86"><span class='Ref_to_Member'>parserSetup</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN523"><span class='Ref_to_Parameter'>parserSetup</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN527"><span class='Ref_To_Local'>plan</span></a><span class='Operator'>.</span><a href="../../include/executor/spi_priv.h.html#LN87"><span class='Ref_to_Member'>parserSetupArg</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN524"><span class='Ref_to_Parameter'>parserSetupArg</span></a><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN51"><span class='Ref_to_Proto'>_SPI_prepare_plan</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN522"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spi.c.html#LN527"><span class='Ref_To_Local'>plan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* copy plan to procedure context */ 
</span>    <a href="spi.c.html#LN528"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN70"><span class='Ref_to_Proto'>_SPI_make_plan_non_temp</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="spi.c.html#LN527"><span class='Ref_To_Local'>plan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN74"><span class='Ref_to_Proto'>_SPI_end_call</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="spi.c.html#LN528"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SPI_prepare_params &raquo; </span> 
 
<span class='Keyword'>int 
</span><a name="LN559"></a><span class='Declare_Function'>SPI_keepplan</span><span class='Parentheses'>(</span><a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a> <span class='Declare_Parameter'>plan</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN561"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN559"><span class='Ref_to_Parameter'>plan</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="spi.c.html#LN559"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN78"><span class='Ref_to_Member'>magic</span></a> <span class='Operator'>!= </span><a href="../../include/executor/spi_priv.h.html#LN19"><span class='Ref_to_Const'>_SPI_PLAN_MAGIC</span></a> <span class='Operator'>|| 
</span>        <a href="spi.c.html#LN559"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN79"><span class='Ref_to_Member'>saved</span></a> <span class='Operator'>|| </span><a href="spi.c.html#LN559"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN80"><span class='Ref_to_Member'>oneshot</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../include/executor/spi.h.html#LN40"><span class='Ref_to_Const'>SPI_ERROR_ARGUMENT</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Mark it saved, reparent it under CacheMemoryContext, and mark all the 
     * component CachedPlanSources as saved.  This sequence cannot fail 
     * partway through, so there's no risk of long-term memory leakage. 
     */ 
</span>    <a href="spi.c.html#LN559"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN79"><span class='Ref_to_Member'>saved</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/memutils.h.html#LN78"><span class='Ref_to_Proto'>MemoryContextSetParent</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN559"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN82"><span class='Ref_to_Member'>plancxt</span></a><span class='Delimiter'>, </span><a href="../utils/mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN561"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN559"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN81"><span class='Ref_to_Member'>plancache_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN577"></a>        <a href="../../include/utils/plancache.h.html#LN79"><span class='Ref_to_Struct'>CachedPlanSource</span></a> <span class='Operator'>*</span><span class='Declare_Local'>plansource</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/utils/plancache.h.html#LN79"><span class='Ref_to_Struct'>CachedPlanSource</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN561"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/plancache.h.html#LN165"><span class='Ref_to_Proto'>SaveCachedPlan</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN577"><span class='Ref_To_Local'>plansource</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SPI_keepplan &raquo; </span> 
 
<a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a> 
<a name="LN586"></a><span class='Declare_Function'>SPI_saveplan</span><span class='Parentheses'>(</span><a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a> <span class='Declare_Parameter'>plan</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN588"></a>    <a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a>  <span class='Declare_Local'>newplan</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN586"><span class='Ref_to_Parameter'>plan</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="spi.c.html#LN586"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN78"><span class='Ref_to_Member'>magic</span></a> <span class='Operator'>!= </span><a href="../../include/executor/spi_priv.h.html#LN19"><span class='Ref_to_Const'>_SPI_PLAN_MAGIC</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN40"><span class='Ref_to_Const'>SPI_ERROR_ARGUMENT</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN73"><span class='Ref_to_Proto'>_SPI_begin_call</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* don't change context */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN588"><span class='Ref_To_Local'>newplan</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN71"><span class='Ref_to_Proto'>_SPI_save_plan</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN586"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN74"><span class='Ref_to_Proto'>_SPI_end_call</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="spi.c.html#LN588"><span class='Ref_To_Local'>newplan</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SPI_saveplan &raquo; </span> 
 
<span class='Keyword'>int 
</span><a name="LN608"></a><span class='Declare_Function'>SPI_freeplan</span><span class='Parentheses'>(</span><a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a> <span class='Declare_Parameter'>plan</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN610"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN608"><span class='Ref_to_Parameter'>plan</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="spi.c.html#LN608"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN78"><span class='Ref_to_Member'>magic</span></a> <span class='Operator'>!= </span><a href="../../include/executor/spi_priv.h.html#LN19"><span class='Ref_to_Const'>_SPI_PLAN_MAGIC</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../include/executor/spi.h.html#LN40"><span class='Ref_to_Const'>SPI_ERROR_ARGUMENT</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Release the plancache entries */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN610"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN608"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN81"><span class='Ref_to_Member'>plancache_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN618"></a>        <a href="../../include/utils/plancache.h.html#LN79"><span class='Ref_to_Struct'>CachedPlanSource</span></a> <span class='Operator'>*</span><span class='Declare_Local'>plansource</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/utils/plancache.h.html#LN79"><span class='Ref_to_Struct'>CachedPlanSource</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN610"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/plancache.h.html#LN166"><span class='Ref_to_Proto'>DropCachedPlan</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN618"><span class='Ref_To_Local'>plansource</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Now get rid of the _SPI_plan and subsidiary data in its plancxt */ 
</span>    <a href="../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN608"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN82"><span class='Ref_to_Member'>plancxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SPI_freeplan &raquo; </span> 
 
<a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> 
<a name="LN630"></a><span class='Declare_Function'>SPI_copytuple</span><span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tuple</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN632"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span><a name="LN633"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>ctuple</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN630"><span class='Ref_to_Parameter'>tuple</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN40"><span class='Ref_to_Const'>SPI_ERROR_ARGUMENT</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN38"><span class='Ref_to_Const'>SPI_ERROR_UNCONNECTED</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="spi.c.html#LN632"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN32"><span class='Ref_to_Member'>savedcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN633"><span class='Ref_To_Local'>ctuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN606"><span class='Ref_to_Func'>heap_copytuple</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN630"><span class='Ref_to_Parameter'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN632"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="spi.c.html#LN633"><span class='Ref_To_Local'>ctuple</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SPI_copytuple &raquo; </span> 
 
<a href="../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> 
<a name="LN657"></a><span class='Declare_Function'>SPI_returntuple</span><span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tuple</span><span class='Delimiter'>, </span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupdesc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN659"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span><a name="LN660"></a>    <a href="../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Local'>dtup</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN657"><span class='Ref_to_Parameter'>tuple</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="spi.c.html#LN657"><span class='Ref_to_Parameter'>tupdesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN40"><span class='Ref_to_Const'>SPI_ERROR_ARGUMENT</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN38"><span class='Ref_to_Const'>SPI_ERROR_UNCONNECTED</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* For RECORD results, make sure a typmod has been assigned */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN657"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN76"><span class='Ref_to_Member'>tdtypeid</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN679"><span class='Ref_to_Const'>RECORDOID</span></a> <span class='Operator'>&& 
</span>        <a href="spi.c.html#LN657"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN77"><span class='Ref_to_Member'>tdtypmod</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/typcache.h.html#LN158"><span class='Ref_to_Proto'>assign_record_type_typmod</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN657"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN659"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN32"><span class='Ref_to_Member'>savedcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN660"><span class='Ref_To_Local'>dtup</span></a> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN258"><span class='Ref_to_Macro'>DatumGetHeapTupleHeader</span></a><span class='Parentheses'>(</span><a href="../access/common/heaptuple.c.html#LN654"><span class='Ref_to_Func'>heap_copy_tuple_as_datum</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN657"><span class='Ref_to_Parameter'>tuple</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN657"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN659"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="spi.c.html#LN660"><span class='Ref_To_Local'>dtup</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SPI_returntuple &raquo; </span> 
 
<a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> 
<a name="LN689"></a><span class='Declare_Function'>SPI_modifytuple</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tuple</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>natts</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>attnum</span><span class='Delimiter'>, 
</span><a name="LN690"></a>                <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>Values</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>Nulls</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN692"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span><a name="LN693"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>mtuple</span><span class='Delimiter'>; 
</span><a name="LN694"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numberOfAttributes</span><span class='Delimiter'>; 
</span><a name="LN695"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>v</span><span class='Delimiter'>; 
</span><a name="LN696"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>n</span><span class='Delimiter'>; 
</span><a name="LN697"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN689"><span class='Ref_to_Parameter'>rel</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="spi.c.html#LN689"><span class='Ref_to_Parameter'>tuple</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="spi.c.html#LN689"><span class='Ref_to_Parameter'>natts</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="spi.c.html#LN689"><span class='Ref_to_Parameter'>attnum</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="spi.c.html#LN690"><span class='Ref_to_Parameter'>Values</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN40"><span class='Ref_to_Const'>SPI_ERROR_ARGUMENT</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN38"><span class='Ref_to_Const'>SPI_ERROR_UNCONNECTED</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="spi.c.html#LN692"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN32"><span class='Ref_to_Member'>savedcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN694"><span class='Ref_To_Local'>numberOfAttributes</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN689"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN695"><span class='Ref_To_Local'>v</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN694"><span class='Ref_To_Local'>numberOfAttributes</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN696"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN694"><span class='Ref_To_Local'>numberOfAttributes</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* fetch old values and nulls */ 
</span>    <a href="../../include/access/htup_details.h.html#LN813"><span class='Ref_to_Proto'>heap_deform_tuple</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN689"><span class='Ref_to_Parameter'>tuple</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN689"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN695"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN696"><span class='Ref_To_Local'>n</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* replace values and nulls */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN697"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="spi.c.html#LN697"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="spi.c.html#LN689"><span class='Ref_to_Parameter'>natts</span></a><span class='Delimiter'>; </span><a href="spi.c.html#LN697"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN689"><span class='Ref_to_Parameter'>attnum</span></a><span class='Delimiter'>[</span><a href="spi.c.html#LN697"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="spi.c.html#LN689"><span class='Ref_to_Parameter'>attnum</span></a><span class='Delimiter'>[</span><a href="spi.c.html#LN697"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>&GT; </span><a href="spi.c.html#LN694"><span class='Ref_To_Local'>numberOfAttributes</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN695"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>[</span><a href="spi.c.html#LN689"><span class='Ref_to_Parameter'>attnum</span></a><span class='Delimiter'>[</span><a href="spi.c.html#LN697"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="spi.c.html#LN690"><span class='Ref_to_Parameter'>Values</span></a><span class='Delimiter'>[</span><a href="spi.c.html#LN697"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>        <a href="spi.c.html#LN696"><span class='Ref_To_Local'>n</span></a><span class='Delimiter'>[</span><a href="spi.c.html#LN689"><span class='Ref_to_Parameter'>attnum</span></a><span class='Delimiter'>[</span><a href="spi.c.html#LN697"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="spi.c.html#LN690"><span class='Ref_to_Parameter'>Nulls</span></a> <span class='Operator'>&& </span><a href="spi.c.html#LN690"><span class='Ref_to_Parameter'>Nulls</span></a><span class='Delimiter'>[</span><a href="spi.c.html#LN697"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'n'</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Boolean'>true </span><span class='Operator'>: </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN697"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>== </span><a href="spi.c.html#LN689"><span class='Ref_to_Parameter'>natts</span></a><span class='Parentheses'>)</span>             <span class='Comment_Single_Line'>/* no errors in *attnum */ 
</span>    <span class='Delimiter'>{ 
</span>        <a href="spi.c.html#LN693"><span class='Ref_To_Local'>mtuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN689"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN695"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN696"><span class='Ref_To_Local'>n</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * copy the identification info of the old tuple: t_ctid, t_self, and 
         * OID (if any) 
         */ 
</span>        <a href="spi.c.html#LN693"><span class='Ref_To_Local'>mtuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup_details.h.html#LN149"><span class='Ref_to_Member'>t_ctid</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN689"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup_details.h.html#LN149"><span class='Ref_to_Member'>t_ctid</span></a><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN693"><span class='Ref_To_Local'>mtuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN689"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN693"><span class='Ref_To_Local'>mtuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN689"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN689"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN78"><span class='Ref_to_Member'>tdhasoid</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/access/htup_details.h.html#LN697"><span class='Ref_to_Macro'>HeapTupleSetOid</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN693"><span class='Ref_To_Local'>mtuple</span></a><span class='Delimiter'>, </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN689"><span class='Ref_to_Parameter'>tuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="spi.c.html#LN693"><span class='Ref_To_Local'>mtuple</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN43"><span class='Ref_to_Const'>SPI_ERROR_NOATTRIBUTE</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN695"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN696"><span class='Ref_To_Local'>n</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN692"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="spi.c.html#LN693"><span class='Ref_To_Local'>mtuple</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SPI_modifytuple &raquo; </span> 
 
<span class='Keyword'>int 
</span><a name="LN760"></a><span class='Declare_Function'>SPI_fnumber</span><span class='Parentheses'>(</span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupdesc</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN762"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN763"></a>    <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>sysatt</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN762"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="spi.c.html#LN762"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><a href="spi.c.html#LN760"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; </span><a href="spi.c.html#LN762"><span class='Ref_To_Local'>res</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/builtins.h.html#LN41"><span class='Ref_to_Proto'>namestrcmp</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="spi.c.html#LN760"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="spi.c.html#LN762"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attname<span class='Delimiter'>, </span><a href="spi.c.html#LN760"><span class='Ref_to_Parameter'>fname</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="spi.c.html#LN760"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="spi.c.html#LN762"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <a href="spi.c.html#LN762"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="spi.c.html#LN763"><span class='Ref_To_Local'>sysatt</span></a> <span class='Operator'>= </span><a href="../../include/catalog/heap.h.html#LN125"><span class='Ref_to_Proto'>SystemAttributeByName</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN760"><span class='Ref_to_Parameter'>fname</span></a><span class='Delimiter'>, </span><span class='Boolean'>true </span><span class='Comment_Multi_Line'>/* "oid" will be accepted */ </span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN763"><span class='Ref_To_Local'>sysatt</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="spi.c.html#LN763"><span class='Ref_To_Local'>sysatt</span></a><span class='Operator'>-&GT;</span>attnum<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* SPI_ERROR_NOATTRIBUTE is different from all sys column numbers */ 
</span>    <span class='Control'>return</span> <a href="../../include/executor/spi.h.html#LN43"><span class='Ref_to_Const'>SPI_ERROR_NOATTRIBUTE</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SPI_fnumber &raquo; </span> 
 
<span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN781"></a><span class='Declare_Function'>SPI_fname</span><span class='Parentheses'>(</span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupdesc</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>fnumber</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN783"></a>    <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>att</span><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN781"><span class='Ref_to_Parameter'>fnumber</span></a> <span class='Operator'>&GT; </span><a href="spi.c.html#LN781"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>|| </span><a href="spi.c.html#LN781"><span class='Ref_to_Parameter'>fnumber</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        <a href="spi.c.html#LN781"><span class='Ref_to_Parameter'>fnumber</span></a> <span class='Operator'>&LT;= </span><a href="../../include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN43"><span class='Ref_to_Const'>SPI_ERROR_NOATTRIBUTE</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN781"><span class='Ref_to_Parameter'>fnumber</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="spi.c.html#LN783"><span class='Ref_To_Local'>att</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN781"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="spi.c.html#LN781"><span class='Ref_to_Parameter'>fnumber</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>    <span class='Control'>else</span> 
        <a href="spi.c.html#LN783"><span class='Ref_To_Local'>att</span></a> <span class='Operator'>= </span><a href="../../include/catalog/heap.h.html#LN122"><span class='Ref_to_Proto'>SystemAttributeDefinition</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN781"><span class='Ref_to_Parameter'>fnumber</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN783"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SPI_fname &raquo; </span> 
 
<span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN803"></a><span class='Declare_Function'>SPI_getvalue</span><span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tuple</span><span class='Delimiter'>, </span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupdesc</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>fnumber</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN805"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN806"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN807"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typoid</span><span class='Delimiter'>, 
</span><a name="LN808"></a>                <span class='Declare_Local'>foutoid</span><span class='Delimiter'>; 
</span><a name="LN809"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>typisvarlena</span><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN803"><span class='Ref_to_Parameter'>fnumber</span></a> <span class='Operator'>&GT; </span><a href="spi.c.html#LN803"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>|| </span><a href="spi.c.html#LN803"><span class='Ref_to_Parameter'>fnumber</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        <a href="spi.c.html#LN803"><span class='Ref_to_Parameter'>fnumber</span></a> <span class='Operator'>&LT;= </span><a href="../../include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN43"><span class='Ref_to_Const'>SPI_ERROR_NOATTRIBUTE</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="spi.c.html#LN805"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN768"><span class='Ref_to_Macro'>heap_getattr</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN803"><span class='Ref_to_Parameter'>tuple</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN803"><span class='Ref_to_Parameter'>fnumber</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN803"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spi.c.html#LN806"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN806"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN803"><span class='Ref_to_Parameter'>fnumber</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="spi.c.html#LN807"><span class='Ref_To_Local'>typoid</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN803"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="spi.c.html#LN803"><span class='Ref_to_Parameter'>fnumber</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="spi.c.html#LN807"><span class='Ref_To_Local'>typoid</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/heap.h.html#LN122"><span class='Ref_to_Proto'>SystemAttributeDefinition</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN803"><span class='Ref_to_Parameter'>fnumber</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/lsyscache.h.html#LN162"><span class='Ref_to_Proto'>getTypeOutputInfo</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN807"><span class='Ref_To_Local'>typoid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spi.c.html#LN808"><span class='Ref_To_Local'>foutoid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spi.c.html#LN809"><span class='Ref_To_Local'>typisvarlena</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/fmgr.h.html#LN647"><span class='Ref_to_Proto'>OidOutputFunctionCall</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN808"><span class='Ref_To_Local'>foutoid</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN805"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SPI_getvalue &raquo; </span> 
 
<a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN835"></a><span class='Declare_Function'>SPI_getbinval</span><span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tuple</span><span class='Delimiter'>, </span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupdesc</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>fnumber</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN835"><span class='Ref_to_Parameter'>fnumber</span></a> <span class='Operator'>&GT; </span><a href="spi.c.html#LN835"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>|| </span><a href="spi.c.html#LN835"><span class='Ref_to_Parameter'>fnumber</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        <a href="spi.c.html#LN835"><span class='Ref_to_Parameter'>fnumber</span></a> <span class='Operator'>&LT;= </span><a href="../../include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN43"><span class='Ref_to_Const'>SPI_ERROR_NOATTRIBUTE</span></a><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="spi.c.html#LN835"><span class='Ref_to_Parameter'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="../../include/access/htup_details.h.html#LN768"><span class='Ref_to_Macro'>heap_getattr</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN835"><span class='Ref_to_Parameter'>tuple</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN835"><span class='Ref_to_Parameter'>fnumber</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN835"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN835"><span class='Ref_to_Parameter'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN851"></a><span class='Declare_Function'>SPI_gettype</span><span class='Parentheses'>(</span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupdesc</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>fnumber</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN853"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typoid</span><span class='Delimiter'>; 
</span><a name="LN854"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>typeTuple</span><span class='Delimiter'>; 
</span><a name="LN855"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN851"><span class='Ref_to_Parameter'>fnumber</span></a> <span class='Operator'>&GT; </span><a href="spi.c.html#LN851"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>|| </span><a href="spi.c.html#LN851"><span class='Ref_to_Parameter'>fnumber</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        <a href="spi.c.html#LN851"><span class='Ref_to_Parameter'>fnumber</span></a> <span class='Operator'>&LT;= </span><a href="../../include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN43"><span class='Ref_to_Const'>SPI_ERROR_NOATTRIBUTE</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN851"><span class='Ref_to_Parameter'>fnumber</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="spi.c.html#LN853"><span class='Ref_To_Local'>typoid</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN851"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="spi.c.html#LN851"><span class='Ref_to_Parameter'>fnumber</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="spi.c.html#LN853"><span class='Ref_To_Local'>typoid</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/heap.h.html#LN122"><span class='Ref_to_Proto'>SystemAttributeDefinition</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN851"><span class='Ref_to_Parameter'>fnumber</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN854"><span class='Ref_To_Local'>typeTuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN853"><span class='Ref_To_Local'>typoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN854"><span class='Ref_To_Local'>typeTuple</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN45"><span class='Ref_to_Const'>SPI_ERROR_TYPUNKNOWN</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="spi.c.html#LN855"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(((</span><a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN854"><span class='Ref_To_Local'>typeTuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>typname<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN854"><span class='Ref_To_Local'>typeTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="spi.c.html#LN855"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SPI_gettype &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Get the data type OID for a column. 
 * 
 * There's nothing similar for typmod and typcollation.  The rare consumers 
 * thereof should inspect the TupleDesc directly. 
 */ 
</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN891"></a><span class='Declare_Function'>SPI_gettypeid</span><span class='Parentheses'>(</span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupdesc</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>fnumber</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN891"><span class='Ref_to_Parameter'>fnumber</span></a> <span class='Operator'>&GT; </span><a href="spi.c.html#LN891"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>|| </span><a href="spi.c.html#LN891"><span class='Ref_to_Parameter'>fnumber</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        <a href="spi.c.html#LN891"><span class='Ref_to_Parameter'>fnumber</span></a> <span class='Operator'>&LT;= </span><a href="../../include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN43"><span class='Ref_to_Const'>SPI_ERROR_NOATTRIBUTE</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN891"><span class='Ref_to_Parameter'>fnumber</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="spi.c.html#LN891"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="spi.c.html#LN891"><span class='Ref_to_Parameter'>fnumber</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../include/catalog/heap.h.html#LN122"><span class='Ref_to_Proto'>SystemAttributeDefinition</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN891"><span class='Ref_to_Parameter'>fnumber</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN909"></a><span class='Declare_Function'>SPI_getrelname</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN909"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN915"></a><span class='Declare_Function'>SPI_getnspname</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN443"><span class='Ref_to_Macro'>RelationGetNamespace</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN915"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>void </span><span class='Operator'>* 
</span><a name="LN921"></a><span class='Declare_Function'>SPI_palloc</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>size</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"SPI_palloc called while not connected to SPI"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN32"><span class='Ref_to_Member'>savedcxt</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN921"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>void </span><span class='Operator'>* 
</span><a name="LN930"></a><span class='Declare_Function'>SPI_repalloc</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>pointer</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>size</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* No longer need to worry which context chunk was in... */ 
</span>    <span class='Control'>return</span> <a href="../../include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN930"><span class='Ref_to_Parameter'>pointer</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN930"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>void 
</span><a name="LN937"></a><span class='Declare_Function'>SPI_pfree</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>pointer</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* No longer need to worry which context chunk was in... */ 
</span>    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN937"><span class='Ref_to_Parameter'>pointer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN944"></a><span class='Declare_Function'>SPI_datumTransfer</span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>typByVal</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>typLen</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN946"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span><a name="LN947"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"SPI_datumTransfer called while not connected to SPI"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN946"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN32"><span class='Ref_to_Member'>savedcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN947"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/utils/datum.h.html#LN37"><span class='Ref_to_Proto'>datumTransfer</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><a href="spi.c.html#LN944"><span class='Ref_to_Parameter'>typByVal</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN944"><span class='Ref_to_Parameter'>typLen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN946"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="spi.c.html#LN947"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>void 
</span><a name="LN962"></a><span class='Declare_Function'>SPI_freetuple</span><span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tuple</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* No longer need to worry which context tuple was in... */ 
</span>    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN962"><span class='Ref_to_Parameter'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>void 
</span><a name="LN969"></a><span class='Declare_Function'>SPI_freetuptable</span><span class='Parentheses'>(</span><a href="../../include/executor/spi.h.html#LN21"><span class='Ref_to_Struct'>SPITupleTable</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tuptable</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN971"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* ignore call if NULL pointer */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN969"><span class='Ref_to_Parameter'>tuptable</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Search only the topmost SPI context for a matching tuple table. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN982"></a>        <a href="../../include/lib/ilist.h.html#LN238"><span class='Ref_to_Struct'>slist_mutable_iter</span></a> <span class='Declare_Local'>siter</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* find tuptable in active list, then remove it */ 
</span>        <a href="../../include/lib/ilist.h.html#LN715"><span class='Ref_to_Macro'>slist_foreach_modify</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN982"><span class='Ref_To_Local'>siter</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN29"><span class='Ref_to_Member'>tuptables</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN987"></a>            <a href="../../include/executor/spi.h.html#LN21"><span class='Ref_to_Struct'>SPITupleTable</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tt</span><span class='Delimiter'>; 
</span> 
            <a href="spi.c.html#LN987"><span class='Ref_To_Local'>tt</span></a> <span class='Operator'>= </span><a href="../../include/lib/ilist.h.html#LN673"><span class='Ref_to_Macro'>slist_container</span></a><span class='Parentheses'>(</span><a href="../../include/executor/spi.h.html#LN21"><span class='Ref_to_Struct'>SPITupleTable</span></a><span class='Delimiter'>, </span><a href="../regex/regcomp.c.html#LN84"><span class='Ref_to_Proto'>next</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN982"><span class='Ref_To_Local'>siter</span></a><span class='Operator'>.</span><a href="../../include/lib/ilist.h.html#LN240"><span class='Ref_to_Member'>cur</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN987"><span class='Ref_To_Local'>tt</span></a> <span class='Operator'>== </span><a href="spi.c.html#LN969"><span class='Ref_to_Parameter'>tuptable</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../include/lib/ilist.h.html#LN650"><span class='Ref_to_Func'>slist_delete_current</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="spi.c.html#LN982"><span class='Ref_To_Local'>siter</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="spi.c.html#LN971"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Refuse the deletion if we didn't find it in the topmost SPI context. 
     * This is primarily a guard against double deletion, but might prevent 
     * other errors as well.  Since the worst consequence of not deleting a 
     * tuptable would be a transient memory leak, this is just a WARNING. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="spi.c.html#LN971"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, </span><span class='String'>"attempt to delete invalid SPITupleTable %p"</span><span class='Delimiter'>, </span><a href="spi.c.html#LN969"><span class='Ref_to_Parameter'>tuptable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* for safety, reset global variables that might point at tuptable */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN969"><span class='Ref_to_Parameter'>tuptable</span></a> <span class='Operator'>== </span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN26"><span class='Ref_to_Member'>tuptable</span></a><span class='Parentheses'>) 
</span>        <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN26"><span class='Ref_to_Member'>tuptable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN969"><span class='Ref_to_Parameter'>tuptable</span></a> <span class='Operator'>== </span><a href="spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Parentheses'>) 
</span>        <a href="spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* release all memory belonging to tuptable */ 
</span>    <a href="../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN969"><span class='Ref_to_Parameter'>tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi.h.html#LN23"><span class='Ref_to_Member'>tuptabcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SPI_freetuptable &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * SPI_cursor_open() 
 * 
 *  Open a prepared SPI plan as a portal 
 */ 
</span><a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> 
<a name="LN1028"></a><span class='Declare_Function'>SPI_cursor_open</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Delimiter'>, </span><a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a> <span class='Declare_Parameter'>plan</span><span class='Delimiter'>, 
</span><a name="LN1029"></a>                <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>Values</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>Nulls</span><span class='Delimiter'>, 
</span><a name="LN1030"></a>                <span class='Keyword'>bool </span><span class='Declare_Parameter'>read_only</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1032"></a>    <a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a>      <span class='Declare_Local'>portal</span><span class='Delimiter'>; 
</span><a name="LN1033"></a>    <a href="../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Local'>paramLI</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* build transient ParamListInfo in caller's context */ 
</span>    <a href="spi.c.html#LN1033"><span class='Ref_To_Local'>paramLI</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN59"><span class='Ref_to_Proto'>_SPI_convert_params</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1028"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN84"><span class='Ref_to_Member'>nargs</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1028"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN85"><span class='Ref_to_Member'>argtypes</span></a><span class='Delimiter'>, 
</span>                                  <a href="spi.c.html#LN1029"><span class='Ref_to_Parameter'>Values</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1029"><span class='Ref_to_Parameter'>Nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN1032"><span class='Ref_To_Local'>portal</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN48"><span class='Ref_to_Proto'>SPI_cursor_open_internal</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1028"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1028"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1033"><span class='Ref_To_Local'>paramLI</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1030"><span class='Ref_to_Parameter'>read_only</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* done with the transient ParamListInfo */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN1033"><span class='Ref_To_Local'>paramLI</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1033"><span class='Ref_To_Local'>paramLI</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="spi.c.html#LN1032"><span class='Ref_To_Local'>portal</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SPI_cursor_open &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * SPI_cursor_open_with_args() 
 * 
 * Parse and plan a query and open it as a portal. 
 */ 
</span><a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> 
<a name="LN1055"></a><span class='Declare_Function'>SPI_cursor_open_with_args</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Delimiter'>, 
</span><a name="LN1056"></a>                          <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Delimiter'>, 
</span><a name="LN1057"></a>                          <span class='Keyword'>int </span><span class='Declare_Parameter'>nargs</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>argtypes</span><span class='Delimiter'>, 
</span><a name="LN1058"></a>                          <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>Values</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>Nulls</span><span class='Delimiter'>, 
</span><a name="LN1059"></a>                          <span class='Keyword'>bool </span><span class='Declare_Parameter'>read_only</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>cursorOptions</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1061"></a>    <a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a>      <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN1062"></a>    <a href="../../include/executor/spi_priv.h.html#LN76"><span class='Ref_to_Struct'>_SPI_plan</span></a>   <span class='Declare_Local'>plan</span><span class='Delimiter'>; 
</span><a name="LN1063"></a>    <a href="../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Local'>paramLI</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN1056"><span class='Ref_to_Parameter'>src</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="spi.c.html#LN1057"><span class='Ref_to_Parameter'>nargs</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"SPI_cursor_open_with_args called with invalid arguments"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN1057"><span class='Ref_to_Parameter'>nargs</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="spi.c.html#LN1057"><span class='Ref_to_Parameter'>argtypes</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="spi.c.html#LN1058"><span class='Ref_to_Parameter'>Values</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"SPI_cursor_open_with_args called with missing parameters"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN73"><span class='Ref_to_Proto'>_SPI_begin_call</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"SPI_cursor_open_with_args called while not connected"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="spi.c.html#LN1062"><span class='Ref_To_Local'>plan</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/executor/spi_priv.h.html#LN76"><span class='Ref_to_Struct'>_SPI_plan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN1062"><span class='Ref_To_Local'>plan</span></a><span class='Operator'>.</span><a href="../../include/executor/spi_priv.h.html#LN78"><span class='Ref_to_Member'>magic</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi_priv.h.html#LN19"><span class='Ref_to_Const'>_SPI_PLAN_MAGIC</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN1062"><span class='Ref_To_Local'>plan</span></a><span class='Operator'>.</span><a href="../../include/executor/spi_priv.h.html#LN83"><span class='Ref_to_Member'>cursor_options</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN1059"><span class='Ref_to_Parameter'>cursorOptions</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN1062"><span class='Ref_To_Local'>plan</span></a><span class='Operator'>.</span><a href="../../include/executor/spi_priv.h.html#LN84"><span class='Ref_to_Member'>nargs</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN1057"><span class='Ref_to_Parameter'>nargs</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN1062"><span class='Ref_To_Local'>plan</span></a><span class='Operator'>.</span><a href="../../include/executor/spi_priv.h.html#LN85"><span class='Ref_to_Member'>argtypes</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN1057"><span class='Ref_to_Parameter'>argtypes</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN1062"><span class='Ref_To_Local'>plan</span></a><span class='Operator'>.</span><a href="../../include/executor/spi_priv.h.html#LN86"><span class='Ref_to_Member'>parserSetup</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN1062"><span class='Ref_To_Local'>plan</span></a><span class='Operator'>.</span><a href="../../include/executor/spi_priv.h.html#LN87"><span class='Ref_to_Member'>parserSetupArg</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* build transient ParamListInfo in executor context */ 
</span>    <a href="spi.c.html#LN1063"><span class='Ref_To_Local'>paramLI</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN59"><span class='Ref_to_Proto'>_SPI_convert_params</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1057"><span class='Ref_to_Parameter'>nargs</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1057"><span class='Ref_to_Parameter'>argtypes</span></a><span class='Delimiter'>, 
</span>                                  <a href="spi.c.html#LN1058"><span class='Ref_to_Parameter'>Values</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1058"><span class='Ref_to_Parameter'>Nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN51"><span class='Ref_to_Proto'>_SPI_prepare_plan</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1056"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spi.c.html#LN1062"><span class='Ref_To_Local'>plan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We needn't copy the plan; SPI_cursor_open_internal will do so */ 
</span> 
    <a href="spi.c.html#LN1061"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN48"><span class='Ref_to_Proto'>SPI_cursor_open_internal</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1055"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spi.c.html#LN1062"><span class='Ref_To_Local'>plan</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1063"><span class='Ref_To_Local'>paramLI</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1059"><span class='Ref_to_Parameter'>read_only</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* And clean up */ 
</span>    <a href="spi.c.html#LN74"><span class='Ref_to_Proto'>_SPI_end_call</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="spi.c.html#LN1061"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SPI_cursor_open_with_args &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * SPI_cursor_open_with_paramlist() 
 * 
 *  Same as SPI_cursor_open except that parameters (if any) are passed 
 *  as a ParamListInfo, which supports dynamic parameter set determination 
 */ 
</span><a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> 
<a name="LN1107"></a><span class='Declare_Function'>SPI_cursor_open_with_paramlist</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Delimiter'>, </span><a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a> <span class='Declare_Parameter'>plan</span><span class='Delimiter'>, 
</span><a name="LN1108"></a>                               <a href="../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Parameter'>params</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>read_only</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="spi.c.html#LN48"><span class='Ref_to_Proto'>SPI_cursor_open_internal</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1107"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1107"><span class='Ref_to_Parameter'>plan</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1108"><span class='Ref_to_Parameter'>params</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1108"><span class='Ref_to_Parameter'>read_only</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * SPI_cursor_open_internal() 
 * 
 *  Common code for SPI_cursor_open variants 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> 
<a name="LN1120"></a><span class='Declare_Function'>SPI_cursor_open_internal</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Delimiter'>, </span><a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a> <span class='Declare_Parameter'>plan</span><span class='Delimiter'>, 
</span><a name="LN1121"></a>                         <a href="../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Parameter'>paramLI</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>read_only</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1123"></a>    <a href="../../include/utils/plancache.h.html#LN79"><span class='Ref_to_Struct'>CachedPlanSource</span></a> <span class='Operator'>*</span><span class='Declare_Local'>plansource</span><span class='Delimiter'>; 
</span><a name="LN1124"></a>    <a href="../../include/utils/plancache.h.html#LN129"><span class='Ref_to_Struct'>CachedPlan</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cplan</span><span class='Delimiter'>; 
</span><a name="LN1125"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>stmt_list</span><span class='Delimiter'>; 
</span><a name="LN1126"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>query_string</span><span class='Delimiter'>; 
</span><a name="LN1127"></a>    <a href="../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a>    <span class='Declare_Local'>snapshot</span><span class='Delimiter'>; 
</span><a name="LN1128"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN1129"></a>    <a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a>      <span class='Declare_Local'>portal</span><span class='Delimiter'>; 
</span><a name="LN1130"></a>    ErrorContextCallback <span class='Declare_Local'>spierrcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check that the plan is something the Portal code will special-case as 
     * returning one tupleset. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/executor/spi.h.html#LN112"><span class='Ref_to_Proto'>SPI_is_cursor_plan</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1120"><span class='Ref_to_Parameter'>plan</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* try to give a good error message */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1120"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN81"><span class='Ref_to_Member'>plancache_list</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_CURSOR_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot open multi-query plan as cursor"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN1123"><span class='Ref_To_Local'>plansource</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/utils/plancache.h.html#LN79"><span class='Ref_to_Struct'>CachedPlanSource</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1120"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN81"><span class='Ref_to_Member'>plancache_list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_CURSOR_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Comment_Multi_Line'>/* translator: %s is name of a SQL command, eg INSERT */ 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot open %s query as cursor"</span><span class='Delimiter'>, 
</span>                        <a href="spi.c.html#LN1123"><span class='Ref_To_Local'>plansource</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/plancache.h.html#LN84"><span class='Ref_to_Member'>commandTag</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1120"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN81"><span class='Ref_to_Member'>plancache_list</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN1123"><span class='Ref_To_Local'>plansource</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/utils/plancache.h.html#LN79"><span class='Ref_to_Struct'>CachedPlanSource</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1120"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN81"><span class='Ref_to_Member'>plancache_list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Push the SPI stack */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN73"><span class='Ref_to_Proto'>_SPI_begin_call</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"SPI_cursor_open called while not connected"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Reset SPI result (note we deliberately don't touch lastoid) */ 
</span>    <a href="spi.c.html#LN38"><span class='Ref_to_Global_Var'>SPI_processed</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN24"><span class='Ref_to_Member'>processed</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN26"><span class='Ref_to_Member'>tuptable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create the portal */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN1120"><span class='Ref_to_Parameter'>name</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="spi.c.html#LN1120"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Use a random nonconflicting name */ 
</span>        <a href="spi.c.html#LN1129"><span class='Ref_To_Local'>portal</span></a> <span class='Operator'>= </span><a href="../../include/utils/portal.h.html#LN221"><span class='Ref_to_Proto'>CreateNewPortal</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* In this path, error if portal of same name already exists */ 
</span>        <a href="spi.c.html#LN1129"><span class='Ref_To_Local'>portal</span></a> <span class='Operator'>= </span><a href="../utils/mmgr/portalmem.c.html#LN172"><span class='Ref_to_Func'>CreatePortal</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1120"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Copy the plan's query string into the portal */ 
</span>    <a href="spi.c.html#LN1126"><span class='Ref_To_Local'>query_string</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN125"><span class='Ref_to_Proto'>MemoryContextStrdup</span></a><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN204"><span class='Ref_to_Macro'>PortalGetHeapMemory</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1129"><span class='Ref_To_Local'>portal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                       <a href="spi.c.html#LN1123"><span class='Ref_To_Local'>plansource</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/plancache.h.html#LN83"><span class='Ref_to_Member'>query_string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Setup error traceback support for ereport(), in case GetCachedPlan 
     * throws an error. 
     */ 
</span>    <a href="spi.c.html#LN1130"><span class='Ref_To_Local'>spierrcontext</span></a><span class='Operator'>.</span>callback <span class='Operator'>= </span><a href="spi.c.html#LN64"><span class='Ref_to_Proto'>_SPI_error_callback</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN1130"><span class='Ref_To_Local'>spierrcontext</span></a><span class='Operator'>.</span>arg <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="spi.c.html#LN1123"><span class='Ref_To_Local'>plansource</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/plancache.h.html#LN83"><span class='Ref_to_Member'>query_string</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN1130"><span class='Ref_To_Local'>spierrcontext</span></a><span class='Operator'>.</span>previous <span class='Operator'>= </span><a href="../utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a><span class='Delimiter'>; 
</span>    <a href="../utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a> <span class='Operator'>= &</span><a href="spi.c.html#LN1130"><span class='Ref_To_Local'>spierrcontext</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Note: for a saved plan, we mustn't have any failure occur between 
     * GetCachedPlan and PortalDefineQuery; that would result in leaking our 
     * plancache refcount. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* Replan if needed, and increment plan refcount for portal */ 
</span>    <a href="spi.c.html#LN1124"><span class='Ref_To_Local'>cplan</span></a> <span class='Operator'>= </span><a href="../../include/utils/plancache.h.html#LN178"><span class='Ref_to_Proto'>GetCachedPlan</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1123"><span class='Ref_To_Local'>plansource</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1121"><span class='Ref_to_Parameter'>paramLI</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN34"><span class='Ref_to_Member'>queryEnv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN1125"><span class='Ref_To_Local'>stmt_list</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN1124"><span class='Ref_To_Local'>cplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/plancache.h.html#LN132"><span class='Ref_to_Member'>stmt_list</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="spi.c.html#LN1120"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN79"><span class='Ref_to_Member'>saved</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * We don't want the portal to depend on an unsaved CachedPlanSource, 
         * so must copy the plan into the portal's context.  An error here 
         * will result in leaking our refcount on the plan, but it doesn't 
         * matter because the plan is unsaved and hence transient anyway. 
         */ 
</span>        <a href="spi.c.html#LN1128"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN204"><span class='Ref_to_Macro'>PortalGetHeapMemory</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1129"><span class='Ref_To_Local'>portal</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN1125"><span class='Ref_To_Local'>stmt_list</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1125"><span class='Ref_To_Local'>stmt_list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1128"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/plancache.h.html#LN182"><span class='Ref_to_Proto'>ReleaseCachedPlan</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1124"><span class='Ref_To_Local'>cplan</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN1124"><span class='Ref_To_Local'>cplan</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* portal shouldn't depend on cplan */ 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set up the portal. 
     */ 
</span>    <a href="../../include/utils/portal.h.html#LN229"><span class='Ref_to_Proto'>PortalDefineQuery</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1129"><span class='Ref_To_Local'>portal</span></a><span class='Delimiter'>, 
</span>                      <span class='Null_Value'>NULL</span><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* no statement name */ 
</span>                      <a href="spi.c.html#LN1126"><span class='Ref_To_Local'>query_string</span></a><span class='Delimiter'>, 
</span>                      <a href="spi.c.html#LN1123"><span class='Ref_To_Local'>plansource</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/plancache.h.html#LN84"><span class='Ref_to_Member'>commandTag</span></a><span class='Delimiter'>, 
</span>                      <a href="spi.c.html#LN1125"><span class='Ref_To_Local'>stmt_list</span></a><span class='Delimiter'>, 
</span>                      <a href="spi.c.html#LN1124"><span class='Ref_To_Local'>cplan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set up options for portal.  Default SCROLL type is chosen the same way 
     * as PerformCursorOpen does it. 
     */ 
</span>    <a href="spi.c.html#LN1129"><span class='Ref_To_Local'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN143"><span class='Ref_to_Member'>cursorOptions</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN1120"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN83"><span class='Ref_to_Member'>cursor_options</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="spi.c.html#LN1129"><span class='Ref_To_Local'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN143"><span class='Ref_to_Member'>cursorOptions</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2602"><span class='Ref_to_Const'>CURSOR_OPT_SCROLL</span></a> <span class='Operator'>| </span><a href="../../include/nodes/parsenodes.h.html#LN2603"><span class='Ref_to_Const'>CURSOR_OPT_NO_SCROLL</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1125"><span class='Ref_To_Local'>stmt_list</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>1</span> <span class='Operator'>&& 
</span>         <a href="../../include/nodes/pg_list.h.html#LN113"><span class='Ref_to_Macro'>linitial_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1125"><span class='Ref_To_Local'>stmt_list</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>commandType <span class='Operator'>!= </span><a href="../../include/nodes/nodes.h.html#LN654"><span class='Ref_to_EnumConst'>CMD_UTILITY</span></a> <span class='Operator'>&& 
</span>            <a href="../../include/nodes/pg_list.h.html#LN113"><span class='Ref_to_Macro'>linitial_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1125"><span class='Ref_To_Local'>stmt_list</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>rowMarks <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>&& 
</span>            <a href="../../include/executor/executor.h.html#LN100"><span class='Ref_to_Proto'>ExecSupportsBackwardScan</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN113"><span class='Ref_to_Macro'>linitial_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1125"><span class='Ref_To_Local'>stmt_list</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>planTree<span class='Parentheses'>))</span> 
            <a href="spi.c.html#LN1129"><span class='Ref_To_Local'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN143"><span class='Ref_to_Member'>cursorOptions</span></a> <span class='Operator'>|= </span><a href="../../include/nodes/parsenodes.h.html#LN2602"><span class='Ref_to_Const'>CURSOR_OPT_SCROLL</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="spi.c.html#LN1129"><span class='Ref_To_Local'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN143"><span class='Ref_to_Member'>cursorOptions</span></a> <span class='Operator'>|= </span><a href="../../include/nodes/parsenodes.h.html#LN2603"><span class='Ref_to_Const'>CURSOR_OPT_NO_SCROLL</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Disallow SCROLL with SELECT FOR UPDATE.  This is not redundant with the 
     * check in transformDeclareCursorStmt because the cursor options might 
     * not have come through there. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN1129"><span class='Ref_To_Local'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN143"><span class='Ref_to_Member'>cursorOptions</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN2602"><span class='Ref_to_Const'>CURSOR_OPT_SCROLL</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1125"><span class='Ref_To_Local'>stmt_list</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>1</span> <span class='Operator'>&& 
</span>         <a href="../../include/nodes/pg_list.h.html#LN113"><span class='Ref_to_Macro'>linitial_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1125"><span class='Ref_To_Local'>stmt_list</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>commandType <span class='Operator'>!= </span><a href="../../include/nodes/nodes.h.html#LN654"><span class='Ref_to_EnumConst'>CMD_UTILITY</span></a> <span class='Operator'>&& 
</span>            <a href="../../include/nodes/pg_list.h.html#LN113"><span class='Ref_to_Macro'>linitial_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1125"><span class='Ref_To_Local'>stmt_list</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>rowMarks <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"DECLARE SCROLL CURSOR ... FOR UPDATE/SHARE is not supported"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Scrollable cursors must be READ ONLY."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Make current query environment available to portal at execution time. */ 
</span>    <a href="spi.c.html#LN1129"><span class='Ref_To_Local'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN139"><span class='Ref_to_Member'>queryEnv</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN34"><span class='Ref_to_Member'>queryEnv</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If told to be read-only, or in parallel mode, verify that this query is 
     * in fact read-only.  This can't be done earlier because we need to look 
     * at the finished, planned queries.  (In particular, we don't want to do 
     * it between GetCachedPlan and PortalDefineQuery, because throwing an 
     * error between those steps would result in leaking our plancache 
     * refcount.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN1121"><span class='Ref_to_Parameter'>read_only</span></a> <span class='Operator'>|| </span><a href="../../include/access/xact.h.html#LN405"><span class='Ref_to_Proto'>IsInParallelMode</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1269"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1269"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1125"><span class='Ref_To_Local'>stmt_list</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1273"></a>            <a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pstmt</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1269"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/tcop/utility.h.html#LN52"><span class='Ref_to_Proto'>CommandIsReadOnly</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1273"><span class='Ref_To_Local'>pstmt</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN1121"><span class='Ref_to_Parameter'>read_only</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <span class='Comment_Multi_Line'>/* translator: %s is a SQL statement name */ 
</span>                       <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"%s is not allowed in a non-volatile function"</span><span class='Delimiter'>, 
</span>                              <a href="../../include/tcop/utility.h.html#LN48"><span class='Ref_to_Proto'>CreateCommandTag</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="spi.c.html#LN1273"><span class='Ref_To_Local'>pstmt</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="../tcop/utility.c.html#LN252"><span class='Ref_to_Func'>PreventCommandIfParallelMode</span></a><span class='Parentheses'>(</span><a href="../../include/tcop/utility.h.html#LN48"><span class='Ref_to_Proto'>CreateCommandTag</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="spi.c.html#LN1273"><span class='Ref_To_Local'>pstmt</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if read_only||IsInParall... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Set up the snapshot to use. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN1121"><span class='Ref_to_Parameter'>read_only</span></a><span class='Parentheses'>) 
</span>        <a href="spi.c.html#LN1127"><span class='Ref_To_Local'>snapshot</span></a> <span class='Operator'>= </span><a href="../../include/utils/snapmgr.h.html#LN77"><span class='Ref_to_Proto'>GetActiveSnapshot</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN1127"><span class='Ref_To_Local'>snapshot</span></a> <span class='Operator'>= </span><a href="../../include/utils/snapmgr.h.html#LN63"><span class='Ref_to_Proto'>GetTransactionSnapshot</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the plan has parameters, copy them into the portal.  Note that this 
     * must be done after revalidating the plan, because in dynamic parameter 
     * cases the set of parameters could have changed during re-parsing. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN1121"><span class='Ref_to_Parameter'>paramLI</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="spi.c.html#LN1128"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN204"><span class='Ref_to_Macro'>PortalGetHeapMemory</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1129"><span class='Ref_To_Local'>portal</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN1121"><span class='Ref_to_Parameter'>paramLI</span></a> <span class='Operator'>= </span><a href="../nodes/params.c.html#LN34"><span class='Ref_to_Func'>copyParamList</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1121"><span class='Ref_to_Parameter'>paramLI</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1128"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Start portal execution. 
     */ 
</span>    <a href="../../include/tcop/pquery.h.html#LN29"><span class='Ref_to_Proto'>PortalStart</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1129"><span class='Ref_To_Local'>portal</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1121"><span class='Ref_to_Parameter'>paramLI</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="spi.c.html#LN1127"><span class='Ref_To_Local'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="spi.c.html#LN1129"><span class='Ref_To_Local'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/portal.h.html#LN142"><span class='Ref_to_Member'>strategy</span></a> <span class='Operator'>!= </span><a href="../../include/utils/portal.h.html#LN93"><span class='Ref_to_EnumConst'>PORTAL_MULTI_QUERY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Pop the error context stack */ 
</span>    <a href="../utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN1130"><span class='Ref_To_Local'>spierrcontext</span></a><span class='Operator'>.</span>previous<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Pop the SPI stack */ 
</span>    <a href="spi.c.html#LN74"><span class='Ref_to_Proto'>_SPI_end_call</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Return the created portal */ 
</span>    <span class='Control'>return</span> <a href="spi.c.html#LN1129"><span class='Ref_To_Local'>portal</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SPI_cursor_open_internal &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * SPI_cursor_find() 
 * 
 *  Find the portal of an existing open cursor 
 */ 
</span><a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> 
<a name="LN1334"></a><span class='Declare_Function'>SPI_cursor_find</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="../utils/mmgr/portalmem.c.html#LN127"><span class='Ref_to_Func'>GetPortalByName</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1334"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * SPI_cursor_fetch() 
 * 
 *  Fetch rows in a cursor 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1346"></a><span class='Declare_Function'>SPI_cursor_fetch</span><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> <span class='Declare_Parameter'>portal</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>forward</span><span class='Delimiter'>, </span><span class='Keyword'>long </span><span class='Declare_Parameter'>count</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="spi.c.html#LN66"><span class='Ref_to_Proto'>_SPI_cursor_operation</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1346"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>, 
</span>                          <a href="spi.c.html#LN1346"><span class='Ref_to_Parameter'>forward</span></a> <span class='Operator'>? </span><a href="../../include/nodes/parsenodes.h.html#LN2638"><span class='Ref_to_EnumConst'>FETCH_FORWARD</span></a> <span class='Operator'>: </span><a href="../../include/nodes/parsenodes.h.html#LN2639"><span class='Ref_to_EnumConst'>FETCH_BACKWARD</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1346"><span class='Ref_to_Parameter'>count</span></a><span class='Delimiter'>, 
</span>                          <a href="../tcop/dest.c.html#LN107"><span class='Ref_to_Func'>CreateDestReceiver</span></a><span class='Parentheses'>(</span><a href="../../include/tcop/dest.h.html#LN92"><span class='Ref_to_EnumConst'>DestSPI</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* we know that the DestSPI receiver doesn't need a destroy call */ 
</span><span class='Delimiter'>} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * SPI_cursor_move() 
 * 
 *  Move in a cursor 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1361"></a><span class='Declare_Function'>SPI_cursor_move</span><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> <span class='Declare_Parameter'>portal</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>forward</span><span class='Delimiter'>, </span><span class='Keyword'>long </span><span class='Declare_Parameter'>count</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="spi.c.html#LN66"><span class='Ref_to_Proto'>_SPI_cursor_operation</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1361"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>, 
</span>                          <a href="spi.c.html#LN1361"><span class='Ref_to_Parameter'>forward</span></a> <span class='Operator'>? </span><a href="../../include/nodes/parsenodes.h.html#LN2638"><span class='Ref_to_EnumConst'>FETCH_FORWARD</span></a> <span class='Operator'>: </span><a href="../../include/nodes/parsenodes.h.html#LN2639"><span class='Ref_to_EnumConst'>FETCH_BACKWARD</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1361"><span class='Ref_to_Parameter'>count</span></a><span class='Delimiter'>, 
</span>                          <a href="../tcop/dest.c.html#LN90"><span class='Ref_to_Global_Var'>None_Receiver</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * SPI_scroll_cursor_fetch() 
 * 
 *  Fetch rows in a scrollable cursor 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1375"></a><span class='Declare_Function'>SPI_scroll_cursor_fetch</span><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> <span class='Declare_Parameter'>portal</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2635"><span class='Ref_to_Enum'>FetchDirection</span></a> <span class='Declare_Parameter'>direction</span><span class='Delimiter'>, </span><span class='Keyword'>long </span><span class='Declare_Parameter'>count</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="spi.c.html#LN66"><span class='Ref_to_Proto'>_SPI_cursor_operation</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1375"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>, 
</span>                          <a href="spi.c.html#LN1375"><span class='Ref_to_Parameter'>direction</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1375"><span class='Ref_to_Parameter'>count</span></a><span class='Delimiter'>, 
</span>                          <a href="../tcop/dest.c.html#LN107"><span class='Ref_to_Func'>CreateDestReceiver</span></a><span class='Parentheses'>(</span><a href="../../include/tcop/dest.h.html#LN92"><span class='Ref_to_EnumConst'>DestSPI</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* we know that the DestSPI receiver doesn't need a destroy call */ 
</span><span class='Delimiter'>} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * SPI_scroll_cursor_move() 
 * 
 *  Move in a scrollable cursor 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1390"></a><span class='Declare_Function'>SPI_scroll_cursor_move</span><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> <span class='Declare_Parameter'>portal</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2635"><span class='Ref_to_Enum'>FetchDirection</span></a> <span class='Declare_Parameter'>direction</span><span class='Delimiter'>, </span><span class='Keyword'>long </span><span class='Declare_Parameter'>count</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="spi.c.html#LN66"><span class='Ref_to_Proto'>_SPI_cursor_operation</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1390"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1390"><span class='Ref_to_Parameter'>direction</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1390"><span class='Ref_to_Parameter'>count</span></a><span class='Delimiter'>, </span><a href="../tcop/dest.c.html#LN90"><span class='Ref_to_Global_Var'>None_Receiver</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * SPI_cursor_close() 
 * 
 *  Close a cursor 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1402"></a><span class='Declare_Function'>SPI_cursor_close</span><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> <span class='Declare_Parameter'>portal</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/portal.h.html#LN198"><span class='Ref_to_Macro'>PortalIsValid</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1402"><span class='Ref_to_Parameter'>portal</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid portal in SPI cursor operation"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/portal.h.html#LN227"><span class='Ref_to_Proto'>PortalDrop</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1402"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Returns the Oid representing the type id for argument at argIndex. First 
 * parameter is at index zero. 
 */ 
</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN1415"></a><span class='Declare_Function'>SPI_getargtypeid</span><span class='Parentheses'>(</span><a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a> <span class='Declare_Parameter'>plan</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>argIndex</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN1415"><span class='Ref_to_Parameter'>plan</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="spi.c.html#LN1415"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN78"><span class='Ref_to_Member'>magic</span></a> <span class='Operator'>!= </span><a href="../../include/executor/spi_priv.h.html#LN19"><span class='Ref_to_Const'>_SPI_PLAN_MAGIC</span></a> <span class='Operator'>|| 
</span>        <a href="spi.c.html#LN1415"><span class='Ref_to_Parameter'>argIndex</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="spi.c.html#LN1415"><span class='Ref_to_Parameter'>argIndex</span></a> <span class='Operator'>&GT;= </span><a href="spi.c.html#LN1415"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN84"><span class='Ref_to_Member'>nargs</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN40"><span class='Ref_to_Const'>SPI_ERROR_ARGUMENT</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="spi.c.html#LN1415"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN85"><span class='Ref_to_Member'>argtypes</span></a><span class='Delimiter'>[</span><a href="spi.c.html#LN1415"><span class='Ref_to_Parameter'>argIndex</span></a><span class='Delimiter'>]; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Returns the number of arguments for the prepared plan. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN1430"></a><span class='Declare_Function'>SPI_getargcount</span><span class='Parentheses'>(</span><a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a> <span class='Declare_Parameter'>plan</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN1430"><span class='Ref_to_Parameter'>plan</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="spi.c.html#LN1430"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN78"><span class='Ref_to_Member'>magic</span></a> <span class='Operator'>!= </span><a href="../../include/executor/spi_priv.h.html#LN19"><span class='Ref_to_Const'>_SPI_PLAN_MAGIC</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN40"><span class='Ref_to_Const'>SPI_ERROR_ARGUMENT</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="spi.c.html#LN1430"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN84"><span class='Ref_to_Member'>nargs</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Returns true if the plan contains exactly one command 
 * and that command returns tuples to the caller (eg, SELECT or 
 * INSERT ... RETURNING, but not SELECT ... INTO). In essence, 
 * the result indicates if the command can be used with SPI_cursor_open 
 * 
 * Parameters 
 *    plan: A plan previously prepared using SPI_prepare 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN1450"></a><span class='Declare_Function'>SPI_is_cursor_plan</span><span class='Parentheses'>(</span><a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a> <span class='Declare_Parameter'>plan</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1452"></a>    <a href="../../include/utils/plancache.h.html#LN79"><span class='Ref_to_Struct'>CachedPlanSource</span></a> <span class='Operator'>*</span><span class='Declare_Local'>plansource</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN1450"><span class='Ref_to_Parameter'>plan</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="spi.c.html#LN1450"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN78"><span class='Ref_to_Member'>magic</span></a> <span class='Operator'>!= </span><a href="../../include/executor/spi_priv.h.html#LN19"><span class='Ref_to_Const'>_SPI_PLAN_MAGIC</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN40"><span class='Ref_to_Const'>SPI_ERROR_ARGUMENT</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1450"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN81"><span class='Ref_to_Member'>plancache_list</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* not exactly 1 pre-rewrite command */ 
</span>    <span class='Delimiter'>} 
</span>    <a href="spi.c.html#LN1452"><span class='Ref_To_Local'>plansource</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/utils/plancache.h.html#LN79"><span class='Ref_to_Struct'>CachedPlanSource</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1450"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN81"><span class='Ref_to_Member'>plancache_list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We used to force revalidation of the cached plan here, but that seems 
     * unnecessary: invalidation could mean a change in the rowtype of the 
     * tuples returned by a plan, but not whether it returns tuples at all. 
     */ 
</span>    <a href="spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Does it return tuples? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN1452"><span class='Ref_To_Local'>plansource</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/plancache.h.html#LN91"><span class='Ref_to_Member'>resultDesc</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SPI_is_cursor_plan &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * SPI_plan_is_valid --- test whether a SPI plan is currently valid 
 * (that is, not marked as being in need of revalidation). 
 * 
 * See notes for CachedPlanIsValid before using this. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN1488"></a><span class='Declare_Function'>SPI_plan_is_valid</span><span class='Parentheses'>(</span><a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a> <span class='Declare_Parameter'>plan</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1490"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="spi.c.html#LN1488"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN78"><span class='Ref_to_Member'>magic</span></a> <span class='Operator'>== </span><a href="../../include/executor/spi_priv.h.html#LN19"><span class='Ref_to_Const'>_SPI_PLAN_MAGIC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1490"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1488"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN81"><span class='Ref_to_Member'>plancache_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1496"></a>        <a href="../../include/utils/plancache.h.html#LN79"><span class='Ref_to_Struct'>CachedPlanSource</span></a> <span class='Operator'>*</span><span class='Declare_Local'>plansource</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/utils/plancache.h.html#LN79"><span class='Ref_to_Struct'>CachedPlanSource</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1490"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/plancache.h.html#LN173"><span class='Ref_to_Proto'>CachedPlanIsValid</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1496"><span class='Ref_To_Local'>plansource</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * SPI_result_code_string --- convert any SPI return code to a string 
 * 
 * This is often useful in error messages.  Most callers will probably 
 * only pass negative (error-case) codes, but for generality we recognize 
 * the success codes too. 
 */ 
</span><span class='Keyword'>const char </span><span class='Operator'>* 
</span><a name="LN1512"></a><span class='Declare_Function'>SPI_result_code_string</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>code</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1514"></a>    <span class='Keyword'>static char </span><span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><span class='Number'>64</span><span class='Delimiter'>]; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN1512"><span class='Ref_to_Parameter'>code</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/executor/spi.h.html#LN35"><span class='Ref_to_Const'>SPI_ERROR_CONNECT</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"SPI_ERROR_CONNECT"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/executor/spi.h.html#LN36"><span class='Ref_to_Const'>SPI_ERROR_COPY</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"SPI_ERROR_COPY"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/executor/spi.h.html#LN37"><span class='Ref_to_Const'>SPI_ERROR_OPUNKNOWN</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"SPI_ERROR_OPUNKNOWN"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/executor/spi.h.html#LN38"><span class='Ref_to_Const'>SPI_ERROR_UNCONNECTED</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"SPI_ERROR_UNCONNECTED"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/executor/spi.h.html#LN40"><span class='Ref_to_Const'>SPI_ERROR_ARGUMENT</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"SPI_ERROR_ARGUMENT"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/executor/spi.h.html#LN41"><span class='Ref_to_Const'>SPI_ERROR_PARAM</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"SPI_ERROR_PARAM"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/executor/spi.h.html#LN42"><span class='Ref_to_Const'>SPI_ERROR_TRANSACTION</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"SPI_ERROR_TRANSACTION"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/executor/spi.h.html#LN43"><span class='Ref_to_Const'>SPI_ERROR_NOATTRIBUTE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"SPI_ERROR_NOATTRIBUTE"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/executor/spi.h.html#LN44"><span class='Ref_to_Const'>SPI_ERROR_NOOUTFUNC</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"SPI_ERROR_NOOUTFUNC"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/executor/spi.h.html#LN45"><span class='Ref_to_Const'>SPI_ERROR_TYPUNKNOWN</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"SPI_ERROR_TYPUNKNOWN"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/executor/spi.h.html#LN46"><span class='Ref_to_Const'>SPI_ERROR_REL_DUPLICATE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"SPI_ERROR_REL_DUPLICATE"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/executor/spi.h.html#LN47"><span class='Ref_to_Const'>SPI_ERROR_REL_NOT_FOUND</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"SPI_ERROR_REL_NOT_FOUND"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/executor/spi.h.html#LN49"><span class='Ref_to_Const'>SPI_OK_CONNECT</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"SPI_OK_CONNECT"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/executor/spi.h.html#LN50"><span class='Ref_to_Const'>SPI_OK_FINISH</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"SPI_OK_FINISH"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/executor/spi.h.html#LN51"><span class='Ref_to_Const'>SPI_OK_FETCH</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"SPI_OK_FETCH"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/executor/spi.h.html#LN52"><span class='Ref_to_Const'>SPI_OK_UTILITY</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"SPI_OK_UTILITY"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/executor/spi.h.html#LN53"><span class='Ref_to_Const'>SPI_OK_SELECT</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"SPI_OK_SELECT"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/executor/spi.h.html#LN54"><span class='Ref_to_Const'>SPI_OK_SELINTO</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"SPI_OK_SELINTO"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/executor/spi.h.html#LN55"><span class='Ref_to_Const'>SPI_OK_INSERT</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"SPI_OK_INSERT"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/executor/spi.h.html#LN56"><span class='Ref_to_Const'>SPI_OK_DELETE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"SPI_OK_DELETE"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/executor/spi.h.html#LN57"><span class='Ref_to_Const'>SPI_OK_UPDATE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"SPI_OK_UPDATE"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/executor/spi.h.html#LN58"><span class='Ref_to_Const'>SPI_OK_CURSOR</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"SPI_OK_CURSOR"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/executor/spi.h.html#LN59"><span class='Ref_to_Const'>SPI_OK_INSERT_RETURNING</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"SPI_OK_INSERT_RETURNING"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/executor/spi.h.html#LN60"><span class='Ref_to_Const'>SPI_OK_DELETE_RETURNING</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"SPI_OK_DELETE_RETURNING"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/executor/spi.h.html#LN61"><span class='Ref_to_Const'>SPI_OK_UPDATE_RETURNING</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"SPI_OK_UPDATE_RETURNING"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/executor/spi.h.html#LN62"><span class='Ref_to_Const'>SPI_OK_REWRITTEN</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"SPI_OK_REWRITTEN"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/executor/spi.h.html#LN63"><span class='Ref_to_Const'>SPI_OK_REL_REGISTER</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"SPI_OK_REL_REGISTER"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/executor/spi.h.html#LN64"><span class='Ref_to_Const'>SPI_OK_REL_UNREGISTER</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"SPI_OK_REL_UNREGISTER"</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch code &raquo; </span> 
    <span class='Comment_Multi_Line'>/* Unrecognized code ... return something useful ... */ 
</span>    <a href="../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1514"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"Unrecognized SPI code %d"</span><span class='Delimiter'>, </span><a href="spi.c.html#LN1512"><span class='Ref_to_Parameter'>code</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="spi.c.html#LN1514"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SPI_result_code_string &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * SPI_plan_get_plan_sources --- get a SPI plan's underlying list of 
 * CachedPlanSources. 
 * 
 * This is exported so that PL/pgSQL can use it (this beats letting PL/pgSQL 
 * look directly into the SPIPlan for itself).  It's not documented in 
 * spi.sgml because we'd just as soon not have too many places using this. 
 */ 
</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN1589"></a><span class='Declare_Function'>SPI_plan_get_plan_sources</span><span class='Parentheses'>(</span><a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a> <span class='Declare_Parameter'>plan</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="spi.c.html#LN1589"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN78"><span class='Ref_to_Member'>magic</span></a> <span class='Operator'>== </span><a href="../../include/executor/spi_priv.h.html#LN19"><span class='Ref_to_Const'>_SPI_PLAN_MAGIC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="spi.c.html#LN1589"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN81"><span class='Ref_to_Member'>plancache_list</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * SPI_plan_get_cached_plan --- get a SPI plan's generic CachedPlan, 
 * if the SPI plan contains exactly one CachedPlanSource.  If not, 
 * return NULL.  Caller is responsible for doing ReleaseCachedPlan(). 
 * 
 * This is exported so that PL/pgSQL can use it (this beats letting PL/pgSQL 
 * look directly into the SPIPlan for itself).  It's not documented in 
 * spi.sgml because we'd just as soon not have too many places using this. 
 */ 
</span><a href="../../include/utils/plancache.h.html#LN129"><span class='Ref_to_Struct'>CachedPlan</span></a> <span class='Operator'>* 
</span><a name="LN1605"></a><span class='Declare_Function'>SPI_plan_get_cached_plan</span><span class='Parentheses'>(</span><a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a> <span class='Declare_Parameter'>plan</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1607"></a>    <a href="../../include/utils/plancache.h.html#LN79"><span class='Ref_to_Struct'>CachedPlanSource</span></a> <span class='Operator'>*</span><span class='Declare_Local'>plansource</span><span class='Delimiter'>; 
</span><a name="LN1608"></a>    <a href="../../include/utils/plancache.h.html#LN129"><span class='Ref_to_Struct'>CachedPlan</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cplan</span><span class='Delimiter'>; 
</span><a name="LN1609"></a>    ErrorContextCallback <span class='Declare_Local'>spierrcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="spi.c.html#LN1605"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN78"><span class='Ref_to_Member'>magic</span></a> <span class='Operator'>== </span><a href="../../include/executor/spi_priv.h.html#LN19"><span class='Ref_to_Const'>_SPI_PLAN_MAGIC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Can't support one-shot plans here */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN1605"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN80"><span class='Ref_to_Member'>oneshot</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Must have exactly one CachedPlanSource */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1605"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN81"><span class='Ref_to_Member'>plancache_list</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN1607"><span class='Ref_To_Local'>plansource</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/utils/plancache.h.html#LN79"><span class='Ref_to_Struct'>CachedPlanSource</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1605"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN81"><span class='Ref_to_Member'>plancache_list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Setup error traceback support for ereport() */ 
</span>    <a href="spi.c.html#LN1609"><span class='Ref_To_Local'>spierrcontext</span></a><span class='Operator'>.</span>callback <span class='Operator'>= </span><a href="spi.c.html#LN64"><span class='Ref_to_Proto'>_SPI_error_callback</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN1609"><span class='Ref_To_Local'>spierrcontext</span></a><span class='Operator'>.</span>arg <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="spi.c.html#LN1607"><span class='Ref_To_Local'>plansource</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/plancache.h.html#LN83"><span class='Ref_to_Member'>query_string</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN1609"><span class='Ref_To_Local'>spierrcontext</span></a><span class='Operator'>.</span>previous <span class='Operator'>= </span><a href="../utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a><span class='Delimiter'>; 
</span>    <a href="../utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a> <span class='Operator'>= &</span><a href="spi.c.html#LN1609"><span class='Ref_To_Local'>spierrcontext</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get the generic plan for the query */ 
</span>    <a href="spi.c.html#LN1608"><span class='Ref_To_Local'>cplan</span></a> <span class='Operator'>= </span><a href="../../include/utils/plancache.h.html#LN178"><span class='Ref_to_Proto'>GetCachedPlan</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1607"><span class='Ref_To_Local'>plansource</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="spi.c.html#LN1605"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN79"><span class='Ref_to_Member'>saved</span></a><span class='Delimiter'>, 
</span>                          <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN34"><span class='Ref_to_Member'>queryEnv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="spi.c.html#LN1608"><span class='Ref_To_Local'>cplan</span></a> <span class='Operator'>== </span><a href="spi.c.html#LN1607"><span class='Ref_To_Local'>plansource</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/plancache.h.html#LN104"><span class='Ref_to_Member'>gplan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Pop the error context stack */ 
</span>    <a href="../utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN1609"><span class='Ref_To_Local'>spierrcontext</span></a><span class='Operator'>.</span>previous<span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="spi.c.html#LN1608"><span class='Ref_To_Local'>cplan</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SPI_plan_get_cached_plan &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* =================== private functions =================== */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * spi_dest_startup 
 *      Initialize to receive tuples from Executor into SPITupleTable 
 *      of current SPI procedure 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1648"></a><span class='Declare_Function'>spi_dest_startup</span><span class='Parentheses'>(</span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>self</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>operation</span><span class='Delimiter'>, </span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>typeinfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1650"></a>    <a href="../../include/executor/spi.h.html#LN21"><span class='Ref_to_Struct'>SPITupleTable</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tuptable</span><span class='Delimiter'>; 
</span><a name="LN1651"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span><a name="LN1652"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>tuptabcxt</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"spi_dest_startup called while not connected to SPI"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN26"><span class='Ref_to_Member'>tuptable</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"improper call to spi_dest_startup"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We create the tuple table context as a child of procCxt */ 
</span> 
    <a href="spi.c.html#LN1651"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN76"><span class='Ref_to_Proto'>_SPI_procmem</span></a><span class='Parentheses'>()</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* switch to procedure memory context */ 
</span> 
    <a href="spi.c.html#LN1652"><span class='Ref_To_Local'>tuptabcxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, 
</span>                                      <span class='String'>"SPI TupTable"</span><span class='Delimiter'>, 
</span>                                      <a href="../../include/utils/memutils.h.html#LN164"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1652"><span class='Ref_To_Local'>tuptabcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN26"><span class='Ref_to_Member'>tuptable</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN1650"><span class='Ref_To_Local'>tuptable</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/executor/spi.h.html#LN21"><span class='Ref_to_Struct'>SPITupleTable</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/executor/spi.h.html#LN21"><span class='Ref_to_Struct'>SPITupleTable</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN1650"><span class='Ref_To_Local'>tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi.h.html#LN23"><span class='Ref_to_Member'>tuptabcxt</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN1652"><span class='Ref_To_Local'>tuptabcxt</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN1650"><span class='Ref_To_Local'>tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi.h.html#LN29"><span class='Ref_to_Member'>subid</span></a> <span class='Operator'>= </span><a href="../../include/access/xact.h.html#LN336"><span class='Ref_to_Proto'>GetCurrentSubTransactionId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The tuptable is now valid enough to be freed by AtEOSubXact_SPI, so put 
     * it onto the SPI context's tuptables list.  This will ensure it's not 
     * leaked even in the unlikely event the following few lines fail. 
     */ 
</span>    <a href="../../include/lib/ilist.h.html#LN572"><span class='Ref_to_Func'>slist_push_head</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN29"><span class='Ref_to_Member'>tuptables</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spi.c.html#LN1650"><span class='Ref_To_Local'>tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi.h.html#LN28"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* set up initial allocations */ 
</span>    <a href="spi.c.html#LN1650"><span class='Ref_To_Local'>tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi.h.html#LN24"><span class='Ref_to_Member'>alloced</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN1650"><span class='Ref_To_Local'>tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi.h.html#LN25"><span class='Ref_to_Member'>free</span></a> <span class='Operator'>= </span><span class='Number'>128</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN1650"><span class='Ref_To_Local'>tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi.h.html#LN27"><span class='Ref_to_Member'>vals</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1650"><span class='Ref_To_Local'>tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi.h.html#LN24"><span class='Ref_to_Member'>alloced</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN1650"><span class='Ref_To_Local'>tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi.h.html#LN26"><span class='Ref_to_Member'>tupdesc</span></a> <span class='Operator'>= </span><a href="../../include/access/tupdesc.h.html#LN88"><span class='Ref_to_Proto'>CreateTupleDescCopy</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1648"><span class='Ref_to_Parameter'>typeinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1651"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end spi_dest_startup &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * spi_printtup 
 *      store tuple retrieved by Executor into SPITupleTable 
 *      of current SPI procedure 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN1695"></a><span class='Declare_Function'>spi_printtup</span><span class='Parentheses'>(</span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Delimiter'>, </span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>self</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1697"></a>    <a href="../../include/executor/spi.h.html#LN21"><span class='Ref_to_Struct'>SPITupleTable</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tuptable</span><span class='Delimiter'>; 
</span><a name="LN1698"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"spi_printtup called while not connected to SPI"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN1697"><span class='Ref_To_Local'>tuptable</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN26"><span class='Ref_to_Member'>tuptable</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN1697"><span class='Ref_To_Local'>tuptable</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"improper call to spi_printtup"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN1698"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1697"><span class='Ref_To_Local'>tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi.h.html#LN23"><span class='Ref_to_Member'>tuptabcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN1697"><span class='Ref_To_Local'>tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi.h.html#LN25"><span class='Ref_to_Member'>free</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Double the size of the pointer array */ 
</span>        <a href="spi.c.html#LN1697"><span class='Ref_To_Local'>tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi.h.html#LN25"><span class='Ref_to_Member'>free</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN1697"><span class='Ref_To_Local'>tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi.h.html#LN24"><span class='Ref_to_Member'>alloced</span></a><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN1697"><span class='Ref_To_Local'>tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi.h.html#LN24"><span class='Ref_to_Member'>alloced</span></a> <span class='Operator'>+= </span><a href="spi.c.html#LN1697"><span class='Ref_To_Local'>tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi.h.html#LN25"><span class='Ref_to_Member'>free</span></a><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN1697"><span class='Ref_To_Local'>tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi.h.html#LN27"><span class='Ref_to_Member'>vals</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/utils/palloc.h.html#LN97"><span class='Ref_to_Proto'>repalloc_huge</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1697"><span class='Ref_To_Local'>tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi.h.html#LN27"><span class='Ref_to_Member'>vals</span></a><span class='Delimiter'>, 
</span>                                      <a href="spi.c.html#LN1697"><span class='Ref_To_Local'>tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi.h.html#LN24"><span class='Ref_to_Member'>alloced</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="spi.c.html#LN1697"><span class='Ref_To_Local'>tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi.h.html#LN27"><span class='Ref_to_Member'>vals</span></a><span class='Delimiter'>[</span><a href="spi.c.html#LN1697"><span class='Ref_To_Local'>tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi.h.html#LN24"><span class='Ref_to_Member'>alloced</span></a> <span class='Operator'>- </span><a href="spi.c.html#LN1697"><span class='Ref_To_Local'>tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi.h.html#LN25"><span class='Ref_to_Member'>free</span></a><span class='Delimiter'>] </span><span class='Operator'>= 
</span>        <a href="../../include/executor/tuptable.h.html#LN157"><span class='Ref_to_Proto'>ExecCopySlotTuple</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1695"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Parentheses'>(</span><a href="spi.c.html#LN1697"><span class='Ref_To_Local'>tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi.h.html#LN25"><span class='Ref_to_Member'>free</span></a><span class='Parentheses'>)</span><span class='Operator'>--</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1698"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end spi_printtup &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Static functions 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Parse and analyze a querystring. 
 * 
 * At entry, plan-&GT;argtypes and plan-&GT;nargs (or alternatively plan-&GT;parserSetup 
 * and plan-&GT;parserSetupArg) must be valid, as must plan-&GT;cursor_options. 
 * 
 * Results are stored into *plan (specifically, plan-&GT;plancache_list). 
 * Note that the result data is all in CurrentMemoryContext or child contexts 
 * thereof; in practice this means it is in the SPI executor context, and 
 * what we are creating is a "temporary" SPIPlan.  Cruft generated during 
 * parsing is also left in CurrentMemoryContext. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1744"></a><span class='Declare_Function'>_SPI_prepare_plan</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Delimiter'>, </span><a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a> <span class='Declare_Parameter'>plan</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1746"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>raw_parsetree_list</span><span class='Delimiter'>; 
</span><a name="LN1747"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>plancache_list</span><span class='Delimiter'>; 
</span><a name="LN1748"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>list_item</span><span class='Delimiter'>; 
</span><a name="LN1749"></a>    ErrorContextCallback <span class='Declare_Local'>spierrcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Setup error traceback support for ereport() 
     */ 
</span>    <a href="spi.c.html#LN1749"><span class='Ref_To_Local'>spierrcontext</span></a><span class='Operator'>.</span>callback <span class='Operator'>= </span><a href="spi.c.html#LN64"><span class='Ref_to_Proto'>_SPI_error_callback</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN1749"><span class='Ref_To_Local'>spierrcontext</span></a><span class='Operator'>.</span>arg <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="spi.c.html#LN1744"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN1749"><span class='Ref_To_Local'>spierrcontext</span></a><span class='Operator'>.</span>previous <span class='Operator'>= </span><a href="../utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a><span class='Delimiter'>; 
</span>    <a href="../utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a> <span class='Operator'>= &</span><a href="spi.c.html#LN1749"><span class='Ref_To_Local'>spierrcontext</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Parse the request string into a list of raw parse trees. 
     */ 
</span>    <a href="spi.c.html#LN1746"><span class='Ref_To_Local'>raw_parsetree_list</span></a> <span class='Operator'>= </span><a href="../../include/tcop/tcopprot.h.html#LN49"><span class='Ref_to_Proto'>pg_parse_query</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1744"><span class='Ref_to_Parameter'>src</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Do parse analysis and rule rewrite for each raw parsetree, storing the 
     * results into unsaved plancache entries. 
     */ 
</span>    <a href="spi.c.html#LN1747"><span class='Ref_To_Local'>plancache_list</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1748"><span class='Ref_To_Local'>list_item</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1746"><span class='Ref_To_Local'>raw_parsetree_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1772"></a>        <a href="../../include/nodes/parsenodes.h.html#LN1396"><span class='Ref_to_Struct'>RawStmt</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>parsetree</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1396"><span class='Ref_to_Struct'>RawStmt</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1748"><span class='Ref_To_Local'>list_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1773"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>stmt_list</span><span class='Delimiter'>; 
</span><a name="LN1774"></a>        <a href="../../include/utils/plancache.h.html#LN79"><span class='Ref_to_Struct'>CachedPlanSource</span></a> <span class='Operator'>*</span><span class='Declare_Local'>plansource</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Create the CachedPlanSource before we do parse analysis, since it 
         * needs to see the unmodified raw parse tree. 
         */ 
</span>        <a href="spi.c.html#LN1774"><span class='Ref_To_Local'>plansource</span></a> <span class='Operator'>= </span><a href="../../include/utils/plancache.h.html#LN149"><span class='Ref_to_Proto'>CreateCachedPlan</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1772"><span class='Ref_To_Local'>parsetree</span></a><span class='Delimiter'>, 
</span>                                      <a href="spi.c.html#LN1744"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../include/tcop/utility.h.html#LN48"><span class='Ref_to_Proto'>CreateCommandTag</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1772"><span class='Ref_To_Local'>parsetree</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1399"><span class='Ref_to_Member'>stmt</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Parameter datatypes are driven by parserSetup hook if provided, 
         * otherwise we use the fixed parameter list. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN1744"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN86"><span class='Ref_to_Member'>parserSetup</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="spi.c.html#LN1744"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN84"><span class='Ref_to_Member'>nargs</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="spi.c.html#LN1773"><span class='Ref_To_Local'>stmt_list</span></a> <span class='Operator'>= </span><a href="../../include/tcop/tcopprot.h.html#LN54"><span class='Ref_to_Proto'>pg_analyze_and_rewrite_params</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1772"><span class='Ref_To_Local'>parsetree</span></a><span class='Delimiter'>, 
</span>                                                      <a href="spi.c.html#LN1744"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, 
</span>                                                      <a href="spi.c.html#LN1744"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN86"><span class='Ref_to_Member'>parserSetup</span></a><span class='Delimiter'>, 
</span>                                                      <a href="spi.c.html#LN1744"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN87"><span class='Ref_to_Member'>parserSetupArg</span></a><span class='Delimiter'>, 
</span>                                                      <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN34"><span class='Ref_to_Member'>queryEnv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="spi.c.html#LN1773"><span class='Ref_To_Local'>stmt_list</span></a> <span class='Operator'>= </span><a href="../../include/tcop/tcopprot.h.html#LN50"><span class='Ref_to_Proto'>pg_analyze_and_rewrite</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1772"><span class='Ref_To_Local'>parsetree</span></a><span class='Delimiter'>, 
</span>                                               <a href="spi.c.html#LN1744"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, 
</span>                                               <a href="spi.c.html#LN1744"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN85"><span class='Ref_to_Member'>argtypes</span></a><span class='Delimiter'>, 
</span>                                               <a href="spi.c.html#LN1744"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN84"><span class='Ref_to_Member'>nargs</span></a><span class='Delimiter'>, 
</span>                                               <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN34"><span class='Ref_to_Member'>queryEnv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Finish filling in the CachedPlanSource */ 
</span>        <a href="../../include/utils/plancache.h.html#LN155"><span class='Ref_to_Proto'>CompleteCachedPlan</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1774"><span class='Ref_To_Local'>plansource</span></a><span class='Delimiter'>, 
</span>                           <a href="spi.c.html#LN1773"><span class='Ref_To_Local'>stmt_list</span></a><span class='Delimiter'>, 
</span>                           <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                           <a href="spi.c.html#LN1744"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN85"><span class='Ref_to_Member'>argtypes</span></a><span class='Delimiter'>, 
</span>                           <a href="spi.c.html#LN1744"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN84"><span class='Ref_to_Member'>nargs</span></a><span class='Delimiter'>, 
</span>                           <a href="spi.c.html#LN1744"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN86"><span class='Ref_to_Member'>parserSetup</span></a><span class='Delimiter'>, 
</span>                           <a href="spi.c.html#LN1744"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN87"><span class='Ref_to_Member'>parserSetupArg</span></a><span class='Delimiter'>, 
</span>                           <a href="spi.c.html#LN1744"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN83"><span class='Ref_to_Member'>cursor_options</span></a><span class='Delimiter'>, 
</span>                           <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* not fixed result */ 
</span> 
        <a href="spi.c.html#LN1747"><span class='Ref_To_Local'>plancache_list</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1747"><span class='Ref_To_Local'>plancache_list</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1774"><span class='Ref_To_Local'>plansource</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="spi.c.html#LN1744"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN81"><span class='Ref_to_Member'>plancache_list</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN1747"><span class='Ref_To_Local'>plancache_list</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN1744"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN80"><span class='Ref_to_Member'>oneshot</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Pop the error context stack 
     */ 
</span>    <a href="../utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN1749"><span class='Ref_To_Local'>spierrcontext</span></a><span class='Operator'>.</span>previous<span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _SPI_prepare_plan &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Parse, but don't analyze, a querystring. 
 * 
 * This is a stripped-down version of _SPI_prepare_plan that only does the 
 * initial raw parsing.  It creates "one shot" CachedPlanSources 
 * that still require parse analysis before execution is possible. 
 * 
 * The advantage of using the "one shot" form of CachedPlanSource is that 
 * we eliminate data copying and invalidation overhead.  Postponing parse 
 * analysis also prevents issues if some of the raw parsetrees are DDL 
 * commands that affect validity of later parsetrees.  Both of these 
 * attributes are good things for SPI_execute() and similar cases. 
 * 
 * Results are stored into *plan (specifically, plan-&GT;plancache_list). 
 * Note that the result data is all in CurrentMemoryContext or child contexts 
 * thereof; in practice this means it is in the SPI executor context, and 
 * what we are creating is a "temporary" SPIPlan.  Cruft generated during 
 * parsing is also left in CurrentMemoryContext. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1849"></a><span class='Declare_Function'>_SPI_prepare_oneshot_plan</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Delimiter'>, </span><a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a> <span class='Declare_Parameter'>plan</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1851"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>raw_parsetree_list</span><span class='Delimiter'>; 
</span><a name="LN1852"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>plancache_list</span><span class='Delimiter'>; 
</span><a name="LN1853"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>list_item</span><span class='Delimiter'>; 
</span><a name="LN1854"></a>    ErrorContextCallback <span class='Declare_Local'>spierrcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Setup error traceback support for ereport() 
     */ 
</span>    <a href="spi.c.html#LN1854"><span class='Ref_To_Local'>spierrcontext</span></a><span class='Operator'>.</span>callback <span class='Operator'>= </span><a href="spi.c.html#LN64"><span class='Ref_to_Proto'>_SPI_error_callback</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN1854"><span class='Ref_To_Local'>spierrcontext</span></a><span class='Operator'>.</span>arg <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="spi.c.html#LN1849"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN1854"><span class='Ref_To_Local'>spierrcontext</span></a><span class='Operator'>.</span>previous <span class='Operator'>= </span><a href="../utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a><span class='Delimiter'>; 
</span>    <a href="../utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a> <span class='Operator'>= &</span><a href="spi.c.html#LN1854"><span class='Ref_To_Local'>spierrcontext</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Parse the request string into a list of raw parse trees. 
     */ 
</span>    <a href="spi.c.html#LN1851"><span class='Ref_To_Local'>raw_parsetree_list</span></a> <span class='Operator'>= </span><a href="../../include/tcop/tcopprot.h.html#LN49"><span class='Ref_to_Proto'>pg_parse_query</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1849"><span class='Ref_to_Parameter'>src</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Construct plancache entries, but don't do parse analysis yet. 
     */ 
</span>    <a href="spi.c.html#LN1852"><span class='Ref_To_Local'>plancache_list</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1853"><span class='Ref_To_Local'>list_item</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1851"><span class='Ref_To_Local'>raw_parsetree_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1876"></a>        <a href="../../include/nodes/parsenodes.h.html#LN1396"><span class='Ref_to_Struct'>RawStmt</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>parsetree</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1396"><span class='Ref_to_Struct'>RawStmt</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1853"><span class='Ref_To_Local'>list_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1877"></a>        <a href="../../include/utils/plancache.h.html#LN79"><span class='Ref_to_Struct'>CachedPlanSource</span></a> <span class='Operator'>*</span><span class='Declare_Local'>plansource</span><span class='Delimiter'>; 
</span> 
        <a href="spi.c.html#LN1877"><span class='Ref_To_Local'>plansource</span></a> <span class='Operator'>= </span><a href="../../include/utils/plancache.h.html#LN152"><span class='Ref_to_Proto'>CreateOneShotCachedPlan</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1876"><span class='Ref_To_Local'>parsetree</span></a><span class='Delimiter'>, 
</span>                                             <a href="spi.c.html#LN1849"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../include/tcop/utility.h.html#LN48"><span class='Ref_to_Proto'>CreateCommandTag</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1876"><span class='Ref_To_Local'>parsetree</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1399"><span class='Ref_to_Member'>stmt</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="spi.c.html#LN1852"><span class='Ref_To_Local'>plancache_list</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1852"><span class='Ref_To_Local'>plancache_list</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1877"><span class='Ref_To_Local'>plansource</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="spi.c.html#LN1849"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN81"><span class='Ref_to_Member'>plancache_list</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN1852"><span class='Ref_To_Local'>plancache_list</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN1849"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN80"><span class='Ref_to_Member'>oneshot</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Pop the error context stack 
     */ 
</span>    <a href="../utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN1854"><span class='Ref_To_Local'>spierrcontext</span></a><span class='Operator'>.</span>previous<span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _SPI_prepare_oneshot_plan &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Execute the given plan with the given parameter values 
 * 
 * snapshot: query snapshot to use, or InvalidSnapshot for the normal 
 *      behavior of taking a new snapshot for each query. 
 * crosscheck_snapshot: for RI use, all others pass InvalidSnapshot 
 * read_only: TRUE for read-only execution (no CommandCounterIncrement) 
 * fire_triggers: TRUE to fire AFTER triggers at end of query (normal case); 
 *      FALSE means any AFTER triggers are postponed to end of outer query 
 * tcount: execution tuple-count limit, or 0 for none 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1907"></a><span class='Declare_Function'>_SPI_execute_plan</span><span class='Parentheses'>(</span><a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a> <span class='Declare_Parameter'>plan</span><span class='Delimiter'>, </span><a href="../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Parameter'>paramLI</span><span class='Delimiter'>, 
</span><a name="LN1908"></a>                  <a href="../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a> <span class='Declare_Parameter'>snapshot</span><span class='Delimiter'>, </span><a href="../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a> <span class='Declare_Parameter'>crosscheck_snapshot</span><span class='Delimiter'>, 
</span><a name="LN1909"></a>                  <span class='Keyword'>bool </span><span class='Declare_Parameter'>read_only</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>fire_triggers</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Parameter'>tcount</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1911"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>my_res</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN1912"></a>    <a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Local'>my_processed</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN1913"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>my_lastoid</span> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span><a name="LN1914"></a>    <a href="../../include/executor/spi.h.html#LN21"><span class='Ref_to_Struct'>SPITupleTable</span></a> <span class='Operator'>*</span><span class='Declare_Local'>my_tuptable</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1915"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN1916"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>pushed_active_snap</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN1917"></a>    ErrorContextCallback <span class='Declare_Local'>spierrcontext</span><span class='Delimiter'>; 
</span><a name="LN1918"></a>    <a href="../../include/utils/plancache.h.html#LN129"><span class='Ref_to_Struct'>CachedPlan</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cplan</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1919"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Setup error traceback support for ereport() 
     */ 
</span>    <a href="spi.c.html#LN1917"><span class='Ref_To_Local'>spierrcontext</span></a><span class='Operator'>.</span>callback <span class='Operator'>= </span><a href="spi.c.html#LN64"><span class='Ref_to_Proto'>_SPI_error_callback</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN1917"><span class='Ref_To_Local'>spierrcontext</span></a><span class='Operator'>.</span>arg <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* we'll fill this below */ 
</span>    <a href="spi.c.html#LN1917"><span class='Ref_To_Local'>spierrcontext</span></a><span class='Operator'>.</span>previous <span class='Operator'>= </span><a href="../utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a><span class='Delimiter'>; 
</span>    <a href="../utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a> <span class='Operator'>= &</span><a href="spi.c.html#LN1917"><span class='Ref_To_Local'>spierrcontext</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We support four distinct snapshot management behaviors: 
     * 
     * snapshot != InvalidSnapshot, read_only = true: use exactly the given 
     * snapshot. 
     * 
     * snapshot != InvalidSnapshot, read_only = false: use the given snapshot, 
     * modified by advancing its command ID before each querytree. 
     * 
     * snapshot == InvalidSnapshot, read_only = true: use the entry-time 
     * ActiveSnapshot, if any (if there isn't one, we run with no snapshot). 
     * 
     * snapshot == InvalidSnapshot, read_only = false: take a full new 
     * snapshot for each user command, and advance its command ID before each 
     * querytree within the command. 
     * 
     * In the first two cases, we can just push the snap onto the stack once 
     * for the whole plan list. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN1908"><span class='Ref_to_Parameter'>snapshot</span></a> <span class='Operator'>!= </span><a href="../../include/utils/snapshot.h.html#LN24"><span class='Ref_to_Const'>InvalidSnapshot</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN1909"><span class='Ref_to_Parameter'>read_only</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/snapmgr.h.html#LN73"><span class='Ref_to_Proto'>PushActiveSnapshot</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1908"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="spi.c.html#LN1916"><span class='Ref_To_Local'>pushed_active_snap</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Make sure we have a private copy of the snapshot to modify */ 
</span>            <a href="../../include/utils/snapmgr.h.html#LN74"><span class='Ref_to_Proto'>PushCopiedSnapshot</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1908"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="spi.c.html#LN1916"><span class='Ref_To_Local'>pushed_active_snap</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1919"><span class='Ref_To_Local'>lc1</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1907"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN81"><span class='Ref_to_Member'>plancache_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1965"></a>        <a href="../../include/utils/plancache.h.html#LN79"><span class='Ref_to_Struct'>CachedPlanSource</span></a> <span class='Operator'>*</span><span class='Declare_Local'>plansource</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/utils/plancache.h.html#LN79"><span class='Ref_to_Struct'>CachedPlanSource</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1919"><span class='Ref_To_Local'>lc1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1966"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>stmt_list</span><span class='Delimiter'>; 
</span><a name="LN1967"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc2</span><span class='Delimiter'>; 
</span> 
        <a href="spi.c.html#LN1917"><span class='Ref_To_Local'>spierrcontext</span></a><span class='Operator'>.</span>arg <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="spi.c.html#LN1965"><span class='Ref_To_Local'>plansource</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/plancache.h.html#LN83"><span class='Ref_to_Member'>query_string</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If this is a one-shot plan, we still need to do parse analysis. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN1907"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN80"><span class='Ref_to_Member'>oneshot</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1976"></a>            <a href="../../include/nodes/parsenodes.h.html#LN1396"><span class='Ref_to_Struct'>RawStmt</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>parsetree</span> <span class='Operator'>= </span><a href="spi.c.html#LN1965"><span class='Ref_To_Local'>plansource</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/plancache.h.html#LN82"><span class='Ref_to_Member'>raw_parse_tree</span></a><span class='Delimiter'>; 
</span><a name="LN1977"></a>            <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>src</span> <span class='Operator'>= </span><a href="spi.c.html#LN1965"><span class='Ref_To_Local'>plansource</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/plancache.h.html#LN83"><span class='Ref_to_Member'>query_string</span></a><span class='Delimiter'>; 
</span><a name="LN1978"></a>            <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>stmt_list</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Parameter datatypes are driven by parserSetup hook if provided, 
             * otherwise we use the fixed parameter list. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN1976"><span class='Ref_To_Local'>parsetree</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="spi.c.html#LN1978"><span class='Ref_To_Local'>stmt_list</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN1907"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN86"><span class='Ref_to_Member'>parserSetup</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="spi.c.html#LN1907"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN84"><span class='Ref_to_Member'>nargs</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="spi.c.html#LN1978"><span class='Ref_To_Local'>stmt_list</span></a> <span class='Operator'>= </span><a href="../../include/tcop/tcopprot.h.html#LN54"><span class='Ref_to_Proto'>pg_analyze_and_rewrite_params</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1976"><span class='Ref_To_Local'>parsetree</span></a><span class='Delimiter'>, 
</span>                                                          <a href="spi.c.html#LN1977"><span class='Ref_To_Local'>src</span></a><span class='Delimiter'>, 
</span>                                                          <a href="spi.c.html#LN1907"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN86"><span class='Ref_to_Member'>parserSetup</span></a><span class='Delimiter'>, 
</span>                                                        <a href="spi.c.html#LN1907"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN87"><span class='Ref_to_Member'>parserSetupArg</span></a><span class='Delimiter'>, 
</span>                                                     <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN34"><span class='Ref_to_Member'>queryEnv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="spi.c.html#LN1978"><span class='Ref_To_Local'>stmt_list</span></a> <span class='Operator'>= </span><a href="../../include/tcop/tcopprot.h.html#LN50"><span class='Ref_to_Proto'>pg_analyze_and_rewrite</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1976"><span class='Ref_To_Local'>parsetree</span></a><span class='Delimiter'>, 
</span>                                                   <a href="spi.c.html#LN1977"><span class='Ref_To_Local'>src</span></a><span class='Delimiter'>, 
</span>                                                   <a href="spi.c.html#LN1907"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN85"><span class='Ref_to_Member'>argtypes</span></a><span class='Delimiter'>, 
</span>                                                   <a href="spi.c.html#LN1907"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN84"><span class='Ref_to_Member'>nargs</span></a><span class='Delimiter'>, 
</span>                                                   <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN34"><span class='Ref_to_Member'>queryEnv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* Finish filling in the CachedPlanSource */ 
</span>            <a href="../../include/utils/plancache.h.html#LN155"><span class='Ref_to_Proto'>CompleteCachedPlan</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1965"><span class='Ref_To_Local'>plansource</span></a><span class='Delimiter'>, 
</span>                               <a href="spi.c.html#LN1978"><span class='Ref_To_Local'>stmt_list</span></a><span class='Delimiter'>, 
</span>                               <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                               <a href="spi.c.html#LN1907"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN85"><span class='Ref_to_Member'>argtypes</span></a><span class='Delimiter'>, 
</span>                               <a href="spi.c.html#LN1907"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN84"><span class='Ref_to_Member'>nargs</span></a><span class='Delimiter'>, 
</span>                               <a href="spi.c.html#LN1907"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN86"><span class='Ref_to_Member'>parserSetup</span></a><span class='Delimiter'>, 
</span>                               <a href="spi.c.html#LN1907"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN87"><span class='Ref_to_Member'>parserSetupArg</span></a><span class='Delimiter'>, 
</span>                               <a href="spi.c.html#LN1907"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN83"><span class='Ref_to_Member'>cursor_options</span></a><span class='Delimiter'>, 
</span>                               <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* not fixed result */ 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if plan-&GT;oneshot &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * Replan if needed, and increment plan refcount.  If it's a saved 
         * plan, the refcount must be backed by the CurrentResourceOwner. 
         */ 
</span>        <a href="spi.c.html#LN1918"><span class='Ref_To_Local'>cplan</span></a> <span class='Operator'>= </span><a href="../../include/utils/plancache.h.html#LN178"><span class='Ref_to_Proto'>GetCachedPlan</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1965"><span class='Ref_To_Local'>plansource</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1907"><span class='Ref_to_Parameter'>paramLI</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1907"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN79"><span class='Ref_to_Member'>saved</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN34"><span class='Ref_to_Member'>queryEnv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN1966"><span class='Ref_To_Local'>stmt_list</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN1918"><span class='Ref_To_Local'>cplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/plancache.h.html#LN132"><span class='Ref_to_Member'>stmt_list</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * In the default non-read-only case, get a new snapshot, replacing 
         * any that we pushed in a previous cycle. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN1908"><span class='Ref_to_Parameter'>snapshot</span></a> <span class='Operator'>== </span><a href="../../include/utils/snapshot.h.html#LN24"><span class='Ref_to_Const'>InvalidSnapshot</span></a> <span class='Operator'>&& !</span><a href="spi.c.html#LN1909"><span class='Ref_to_Parameter'>read_only</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN1916"><span class='Ref_To_Local'>pushed_active_snap</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/snapmgr.h.html#LN76"><span class='Ref_to_Proto'>PopActiveSnapshot</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/snapmgr.h.html#LN73"><span class='Ref_to_Proto'>PushActiveSnapshot</span></a><span class='Parentheses'>(</span><a href="../../include/utils/snapmgr.h.html#LN63"><span class='Ref_to_Proto'>GetTransactionSnapshot</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>            <a href="spi.c.html#LN1916"><span class='Ref_To_Local'>pushed_active_snap</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1967"><span class='Ref_To_Local'>lc2</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1966"><span class='Ref_To_Local'>stmt_list</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2037"></a>            <a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>stmt</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1967"><span class='Ref_To_Local'>lc2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2038"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>canSetTag</span> <span class='Operator'>= </span><a href="spi.c.html#LN2037"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN52"><span class='Ref_to_Member'>canSetTag</span></a><span class='Delimiter'>; 
</span><a name="LN2039"></a>            <a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Local'>dest</span><span class='Delimiter'>; 
</span> 
            <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN24"><span class='Ref_to_Member'>processed</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN25"><span class='Ref_to_Member'>lastoid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>            <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN26"><span class='Ref_to_Member'>tuptable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN2037"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN93"><span class='Ref_to_Member'>utilityStmt</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2037"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN93"><span class='Ref_to_Member'>utilityStmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1911"><span class='Ref_to_Struct'>CopyStmt</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span><a name="LN2049"></a>                    <a href="../../include/nodes/parsenodes.h.html#LN1911"><span class='Ref_to_Struct'>CopyStmt</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cstmt</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1911"><span class='Ref_to_Struct'>CopyStmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="spi.c.html#LN2037"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN93"><span class='Ref_to_Member'>utilityStmt</span></a><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN2049"><span class='Ref_To_Local'>cstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1921"><span class='Ref_to_Member'>filename</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="spi.c.html#LN1911"><span class='Ref_To_Local'>my_res</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN36"><span class='Ref_to_Const'>SPI_ERROR_COPY</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="spi.c.html#LN2201"><span class='Ref_to_Label'>fail</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2037"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN93"><span class='Ref_to_Member'>utilityStmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2902"><span class='Ref_to_Struct'>TransactionStmt</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="spi.c.html#LN1911"><span class='Ref_To_Local'>my_res</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN42"><span class='Ref_to_Const'>SPI_ERROR_TRANSACTION</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="spi.c.html#LN2201"><span class='Ref_to_Label'>fail</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN1909"><span class='Ref_to_Parameter'>read_only</span></a> <span class='Operator'>&& !</span><a href="../../include/tcop/utility.h.html#LN52"><span class='Ref_to_Proto'>CommandIsReadOnly</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2037"><span class='Ref_To_Local'>stmt</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <span class='Comment_Multi_Line'>/* translator: %s is a SQL statement name */ 
</span>                       <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"%s is not allowed in a non-volatile function"</span><span class='Delimiter'>, 
</span>                              <a href="../../include/tcop/utility.h.html#LN48"><span class='Ref_to_Proto'>CreateCommandTag</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="spi.c.html#LN2037"><span class='Ref_To_Local'>stmt</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/xact.h.html#LN405"><span class='Ref_to_Proto'>IsInParallelMode</span></a><span class='Parentheses'>() </span><span class='Operator'>&& !</span><a href="../../include/tcop/utility.h.html#LN52"><span class='Ref_to_Proto'>CommandIsReadOnly</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2037"><span class='Ref_To_Local'>stmt</span></a><span class='Parentheses'>))</span> 
                <a href="../tcop/utility.c.html#LN252"><span class='Ref_to_Func'>PreventCommandIfParallelMode</span></a><span class='Parentheses'>(</span><a href="../../include/tcop/utility.h.html#LN48"><span class='Ref_to_Proto'>CreateCommandTag</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="spi.c.html#LN2037"><span class='Ref_To_Local'>stmt</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If not read-only mode, advance the command counter before each 
             * command and update the snapshot. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="spi.c.html#LN1909"><span class='Ref_to_Parameter'>read_only</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                <a href="../../include/utils/snapmgr.h.html#LN75"><span class='Ref_to_Proto'>UpdateActiveSnapshotCommandId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="spi.c.html#LN2039"><span class='Ref_To_Local'>dest</span></a> <span class='Operator'>= </span><a href="../tcop/dest.c.html#LN107"><span class='Ref_to_Func'>CreateDestReceiver</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2038"><span class='Ref_To_Local'>canSetTag</span></a> <span class='Operator'>? </span><a href="../../include/tcop/dest.h.html#LN92"><span class='Ref_to_EnumConst'>DestSPI</span></a> <span class='Operator'>: </span><a href="../../include/tcop/dest.h.html#LN87"><span class='Ref_to_EnumConst'>DestNone</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN2037"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN93"><span class='Ref_to_Member'>utilityStmt</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2088"></a>                <a href="../../include/executor/execdesc.h.html#LN32"><span class='Ref_to_Struct'>QueryDesc</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>qdesc</span><span class='Delimiter'>; 
</span><a name="LN2089"></a>                <a href="../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a>    <span class='Declare_Local'>snap</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/snapmgr.h.html#LN78"><span class='Ref_to_Proto'>ActiveSnapshotSet</span></a><span class='Parentheses'>())</span> 
                    <a href="spi.c.html#LN2089"><span class='Ref_To_Local'>snap</span></a> <span class='Operator'>= </span><a href="../../include/utils/snapmgr.h.html#LN77"><span class='Ref_to_Proto'>GetActiveSnapshot</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="spi.c.html#LN2089"><span class='Ref_To_Local'>snap</span></a> <span class='Operator'>= </span><a href="../../include/utils/snapshot.h.html#LN24"><span class='Ref_to_Const'>InvalidSnapshot</span></a><span class='Delimiter'>; 
</span> 
                <a href="spi.c.html#LN2088"><span class='Ref_To_Local'>qdesc</span></a> <span class='Operator'>= </span><a href="../../include/executor/execdesc.h.html#LN58"><span class='Ref_to_Proto'>CreateQueryDesc</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2037"><span class='Ref_To_Local'>stmt</span></a><span class='Delimiter'>, 
</span>                                        <a href="spi.c.html#LN1965"><span class='Ref_To_Local'>plansource</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/plancache.h.html#LN83"><span class='Ref_to_Member'>query_string</span></a><span class='Delimiter'>, 
</span>                                        <a href="spi.c.html#LN2089"><span class='Ref_To_Local'>snap</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1908"><span class='Ref_to_Parameter'>crosscheck_snapshot</span></a><span class='Delimiter'>, 
</span>                                        <a href="spi.c.html#LN2039"><span class='Ref_To_Local'>dest</span></a><span class='Delimiter'>, 
</span>                                        <a href="spi.c.html#LN1907"><span class='Ref_to_Parameter'>paramLI</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN34"><span class='Ref_to_Member'>queryEnv</span></a><span class='Delimiter'>, 
</span>                                        <span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="spi.c.html#LN1915"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN62"><span class='Ref_to_Proto'>_SPI_pquery</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2088"><span class='Ref_To_Local'>qdesc</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1909"><span class='Ref_to_Parameter'>fire_triggers</span></a><span class='Delimiter'>, 
</span>                                  <a href="spi.c.html#LN2038"><span class='Ref_To_Local'>canSetTag</span></a> <span class='Operator'>? </span><a href="spi.c.html#LN1909"><span class='Ref_to_Parameter'>tcount</span></a> <span class='Operator'>: </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/executor/execdesc.h.html#LN67"><span class='Ref_to_Proto'>FreeQueryDesc</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2088"><span class='Ref_To_Local'>qdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if stmt-&GT;utilityStmt==NU... &raquo; </span> 
            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span><a name="LN2108"></a>                <span class='Keyword'>char</span>        <span class='Declare_Local'>completionTag</span><span class='Delimiter'>[</span><a href="../../include/tcop/dest.h.html#LN73"><span class='Ref_to_Const'>COMPLETION_TAG_BUFSIZE</span></a><span class='Delimiter'>]; 
</span> 
                <a href="../../include/tcop/utility.h.html#LN33"><span class='Ref_to_Proto'>ProcessUtility</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2037"><span class='Ref_To_Local'>stmt</span></a><span class='Delimiter'>, 
</span>                               <a href="spi.c.html#LN1965"><span class='Ref_To_Local'>plansource</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/plancache.h.html#LN83"><span class='Ref_to_Member'>query_string</span></a><span class='Delimiter'>, 
</span>                               <a href="../../include/tcop/utility.h.html#LN21"><span class='Ref_to_EnumConst'>PROCESS_UTILITY_QUERY</span></a><span class='Delimiter'>, 
</span>                               <a href="spi.c.html#LN1907"><span class='Ref_to_Parameter'>paramLI</span></a><span class='Delimiter'>, 
</span>                               <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN34"><span class='Ref_to_Member'>queryEnv</span></a><span class='Delimiter'>, 
</span>                               <a href="spi.c.html#LN2039"><span class='Ref_To_Local'>dest</span></a><span class='Delimiter'>, 
</span>                               <a href="spi.c.html#LN2108"><span class='Ref_To_Local'>completionTag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Update "processed" if stmt returned tuples */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN26"><span class='Ref_to_Member'>tuptable</span></a><span class='Parentheses'>) 
</span>                    <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN24"><span class='Ref_to_Member'>processed</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN26"><span class='Ref_to_Member'>tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi.h.html#LN24"><span class='Ref_to_Member'>alloced</span></a> <span class='Operator'>- 
</span>                        <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN26"><span class='Ref_to_Member'>tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi.h.html#LN25"><span class='Ref_to_Member'>free</span></a><span class='Delimiter'>; 
</span> 
                <a href="spi.c.html#LN1915"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN52"><span class='Ref_to_Const'>SPI_OK_UTILITY</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Some utility statements return a row count, even though the 
                 * tuples are not returned to the caller. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2037"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN93"><span class='Ref_to_Member'>utilityStmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN3108"><span class='Ref_to_Struct'>CreateTableAsStmt</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span><a name="LN2131"></a>                    <a href="../../include/nodes/parsenodes.h.html#LN3108"><span class='Ref_to_Struct'>CreateTableAsStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctastmt</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN3108"><span class='Ref_to_Struct'>CreateTableAsStmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="spi.c.html#LN2037"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN93"><span class='Ref_to_Member'>utilityStmt</span></a><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><a href="spi.c.html#LN2108"><span class='Ref_To_Local'>completionTag</span></a><span class='Delimiter'>, </span><span class='String'>"SELECT "</span><span class='Delimiter'>, </span><span class='Number'>7</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                        <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN24"><span class='Ref_to_Member'>processed</span></a> <span class='Operator'>= 
</span>                            <a href="../../include/utils/builtins.h.html#LN50"><span class='Ref_to_Proto'>pg_strtouint64</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2108"><span class='Ref_To_Local'>completionTag</span></a> <span class='Operator'>+ </span><span class='Number'>7</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * Must be an IF NOT EXISTS that did nothing, or a 
                         * CREATE ... WITH NO DATA. 
                         */ 
</span>                        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="spi.c.html#LN2131"><span class='Ref_To_Local'>ctastmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3115"><span class='Ref_to_Member'>if_not_exists</span></a> <span class='Operator'>|| 
</span>                               <a href="spi.c.html#LN2131"><span class='Ref_To_Local'>ctastmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3112"><span class='Ref_to_Member'>into</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN114"><span class='Ref_to_Member'>skipData</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN24"><span class='Ref_to_Member'>processed</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * For historical reasons, if CREATE TABLE AS was spelled 
                     * as SELECT INTO, return a special return code. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN2131"><span class='Ref_To_Local'>ctastmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3114"><span class='Ref_to_Member'>is_select_into</span></a><span class='Parentheses'>) 
</span>                        <a href="spi.c.html#LN1915"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN54"><span class='Ref_to_Const'>SPI_OK_SELINTO</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(stmt-&GT;utilityStmt... &raquo; </span> 
                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2037"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN93"><span class='Ref_to_Member'>utilityStmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1911"><span class='Ref_to_Struct'>CopyStmt</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Debug'>Assert</span><span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><a href="spi.c.html#LN2108"><span class='Ref_To_Local'>completionTag</span></a><span class='Delimiter'>, </span><span class='String'>"COPY "</span><span class='Delimiter'>, </span><span class='Number'>5</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN24"><span class='Ref_to_Member'>processed</span></a> <span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN50"><span class='Ref_to_Proto'>pg_strtouint64</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2108"><span class='Ref_To_Local'>completionTag</span></a> <span class='Operator'>+ </span><span class='Number'>5</span><span class='Delimiter'>, 
</span>                                                             <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
            <span class='Comment_Multi_Line'>/* 
             * The last canSetTag query sets the status values returned to the 
             * caller.  Be careful to free any tuptables not returned, to 
             * avoid intratransaction memory leak. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN2038"><span class='Ref_To_Local'>canSetTag</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="spi.c.html#LN1912"><span class='Ref_To_Local'>my_processed</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN24"><span class='Ref_to_Member'>processed</span></a><span class='Delimiter'>; 
</span>                <a href="spi.c.html#LN1913"><span class='Ref_To_Local'>my_lastoid</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN25"><span class='Ref_to_Member'>lastoid</span></a><span class='Delimiter'>; 
</span>                <a href="../../include/executor/spi.h.html#LN136"><span class='Ref_to_Proto'>SPI_freetuptable</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1914"><span class='Ref_To_Local'>my_tuptable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="spi.c.html#LN1914"><span class='Ref_To_Local'>my_tuptable</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN26"><span class='Ref_to_Member'>tuptable</span></a><span class='Delimiter'>; 
</span>                <a href="spi.c.html#LN1911"><span class='Ref_To_Local'>my_res</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN1915"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../include/executor/spi.h.html#LN136"><span class='Ref_to_Proto'>SPI_freetuptable</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN26"><span class='Ref_to_Member'>tuptable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN26"><span class='Ref_to_Member'>tuptable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Comment_Multi_Line'>/* we know that the receiver doesn't need a destroy call */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN1915"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="spi.c.html#LN1911"><span class='Ref_To_Local'>my_res</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN1915"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="spi.c.html#LN2201"><span class='Ref_to_Label'>fail</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Done with this plan, so release refcount */ 
</span>        <a href="../../include/utils/plancache.h.html#LN182"><span class='Ref_to_Proto'>ReleaseCachedPlan</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1918"><span class='Ref_To_Local'>cplan</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1907"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN79"><span class='Ref_to_Member'>saved</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN1918"><span class='Ref_To_Local'>cplan</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If not read-only mode, advance the command counter after the last 
         * command.  This ensures that its effects are visible, in case it was 
         * DDL that would affect the next CachedPlanSource. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="spi.c.html#LN1909"><span class='Ref_to_Parameter'>read_only</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
<a name="LN2201"></a><span class='Label'>fail</span><span class='Operator'>: 
</span> 
    <span class='Comment_Multi_Line'>/* Pop the snapshot off the stack if we pushed one */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN1916"><span class='Ref_To_Local'>pushed_active_snap</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/snapmgr.h.html#LN76"><span class='Ref_to_Proto'>PopActiveSnapshot</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We no longer need the cached plan refcount, if any */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN1918"><span class='Ref_To_Local'>cplan</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/plancache.h.html#LN182"><span class='Ref_to_Proto'>ReleaseCachedPlan</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN1918"><span class='Ref_To_Local'>cplan</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN1907"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN79"><span class='Ref_to_Member'>saved</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Pop the error context stack 
     */ 
</span>    <a href="../utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN1917"><span class='Ref_To_Local'>spierrcontext</span></a><span class='Operator'>.</span>previous<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Save results for caller */ 
</span>    <a href="spi.c.html#LN38"><span class='Ref_to_Global_Var'>SPI_processed</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN1912"><span class='Ref_To_Local'>my_processed</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN39"><span class='Ref_to_Global_Var'>SPI_lastoid</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN1913"><span class='Ref_To_Local'>my_lastoid</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN1914"><span class='Ref_To_Local'>my_tuptable</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* tuptable now is caller's responsibility, not SPI's */ 
</span>    <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN26"><span class='Ref_to_Member'>tuptable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If none of the queries had canSetTag, return SPI_OK_REWRITTEN. Prior to 
     * 8.4, we used return the last query's result code, but not its auxiliary 
     * results, but that's confusing. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN1911"><span class='Ref_To_Local'>my_res</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="spi.c.html#LN1911"><span class='Ref_To_Local'>my_res</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN62"><span class='Ref_to_Const'>SPI_OK_REWRITTEN</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="spi.c.html#LN1911"><span class='Ref_To_Local'>my_res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _SPI_execute_plan &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Convert arrays of query parameters to form wanted by planner and executor 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> 
<a name="LN2239"></a><span class='Declare_Function'>_SPI_convert_params</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>nargs</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>argtypes</span><span class='Delimiter'>, 
</span><a name="LN2240"></a>                    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>Values</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>Nulls</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2242"></a>    <a href="../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Local'>paramLI</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN2239"><span class='Ref_to_Parameter'>nargs</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2246"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <a href="spi.c.html#LN2242"><span class='Ref_To_Local'>paramLI</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/params.h.html#LN67"><span class='Ref_to_Struct'>ParamListInfoData</span></a><span class='Delimiter'>, </span>params<span class='Parentheses'>) </span><span class='Operator'>+ 
</span>                                         <a href="spi.c.html#LN2239"><span class='Ref_to_Parameter'>nargs</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/nodes/params.h.html#LN53"><span class='Ref_to_Struct'>ParamExternData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* we have static list of params, so no hooks needed */ 
</span>        <a href="spi.c.html#LN2242"><span class='Ref_To_Local'>paramLI</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN69"><span class='Ref_to_Member'>paramFetch</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN2242"><span class='Ref_To_Local'>paramLI</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN70"><span class='Ref_to_Member'>paramFetchArg</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN2242"><span class='Ref_To_Local'>paramLI</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN71"><span class='Ref_to_Member'>parserSetup</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN2242"><span class='Ref_To_Local'>paramLI</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN72"><span class='Ref_to_Member'>parserSetupArg</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN2242"><span class='Ref_To_Local'>paramLI</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN73"><span class='Ref_to_Member'>numParams</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN2239"><span class='Ref_to_Parameter'>nargs</span></a><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN2242"><span class='Ref_To_Local'>paramLI</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN74"><span class='Ref_to_Member'>paramMask</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN2246"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="spi.c.html#LN2246"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="spi.c.html#LN2239"><span class='Ref_to_Parameter'>nargs</span></a><span class='Delimiter'>; </span><a href="spi.c.html#LN2246"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2260"></a>            <a href="../../include/nodes/params.h.html#LN53"><span class='Ref_to_Struct'>ParamExternData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>prm</span> <span class='Operator'>= &</span><a href="spi.c.html#LN2242"><span class='Ref_To_Local'>paramLI</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN75"><span class='Ref_to_Member'>params</span></a><span class='Delimiter'>[</span><a href="spi.c.html#LN2246"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
            <a href="spi.c.html#LN2260"><span class='Ref_To_Local'>prm</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value </span><span class='Operator'>= </span><a href="spi.c.html#LN2240"><span class='Ref_to_Parameter'>Values</span></a><span class='Delimiter'>[</span><a href="spi.c.html#LN2246"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>            <a href="spi.c.html#LN2260"><span class='Ref_To_Local'>prm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN56"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="spi.c.html#LN2240"><span class='Ref_to_Parameter'>Nulls</span></a> <span class='Operator'>&& </span><a href="spi.c.html#LN2240"><span class='Ref_to_Parameter'>Nulls</span></a><span class='Delimiter'>[</span><a href="spi.c.html#LN2246"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="spi.c.html#LN2260"><span class='Ref_To_Local'>prm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN57"><span class='Ref_to_Member'>pflags</span></a> <span class='Operator'>= </span><a href="../../include/nodes/params.h.html#LN51"><span class='Ref_to_Const'>PARAM_FLAG_CONST</span></a><span class='Delimiter'>; 
</span>            <a href="spi.c.html#LN2260"><span class='Ref_To_Local'>prm</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/params.h.html#LN58"><span class='Ref_to_Member'>ptype</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN2239"><span class='Ref_to_Parameter'>argtypes</span></a><span class='Delimiter'>[</span><a href="spi.c.html#LN2246"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if nargs&GT;0 &raquo; </span> 
    <span class='Control'>else</span> 
        <a href="spi.c.html#LN2242"><span class='Ref_To_Local'>paramLI</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="spi.c.html#LN2242"><span class='Ref_To_Local'>paramLI</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _SPI_convert_params &raquo; </span> 
 
<span class='Keyword'>static int 
</span><a name="LN2274"></a><span class='Declare_Function'>_SPI_pquery</span><span class='Parentheses'>(</span><a href="../../include/executor/execdesc.h.html#LN32"><span class='Ref_to_Struct'>QueryDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>queryDesc</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>fire_triggers</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Parameter'>tcount</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2276"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>operation</span> <span class='Operator'>= </span><a href="spi.c.html#LN2274"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN35"><span class='Ref_to_Member'>operation</span></a><span class='Delimiter'>; 
</span><a name="LN2277"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>eflags</span><span class='Delimiter'>; 
</span><a name="LN2278"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN2276"><span class='Ref_To_Local'>operation</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN650"><span class='Ref_to_EnumConst'>CMD_SELECT</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN2274"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN40"><span class='Ref_to_Member'>dest</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/dest.h.html#LN127"><span class='Ref_to_Member'>mydest</span></a> <span class='Operator'>!= </span><a href="../../include/tcop/dest.h.html#LN92"><span class='Ref_to_EnumConst'>DestSPI</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Don't return SPI_OK_SELECT if we're discarding result */ 
</span>                <a href="spi.c.html#LN2278"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN52"><span class='Ref_to_Const'>SPI_OK_UTILITY</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
                <a href="spi.c.html#LN2278"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN53"><span class='Ref_to_Const'>SPI_OK_SELECT</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN652"><span class='Ref_to_EnumConst'>CMD_INSERT</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN2274"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN36"><span class='Ref_to_Member'>plannedstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN48"><span class='Ref_to_Member'>hasReturning</span></a><span class='Parentheses'>) 
</span>                <a href="spi.c.html#LN2278"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN59"><span class='Ref_to_Const'>SPI_OK_INSERT_RETURNING</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="spi.c.html#LN2278"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN55"><span class='Ref_to_Const'>SPI_OK_INSERT</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN653"><span class='Ref_to_EnumConst'>CMD_DELETE</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN2274"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN36"><span class='Ref_to_Member'>plannedstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN48"><span class='Ref_to_Member'>hasReturning</span></a><span class='Parentheses'>) 
</span>                <a href="spi.c.html#LN2278"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN60"><span class='Ref_to_Const'>SPI_OK_DELETE_RETURNING</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="spi.c.html#LN2278"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN56"><span class='Ref_to_Const'>SPI_OK_DELETE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/nodes.h.html#LN651"><span class='Ref_to_EnumConst'>CMD_UPDATE</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN2274"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN36"><span class='Ref_to_Member'>plannedstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN48"><span class='Ref_to_Member'>hasReturning</span></a><span class='Parentheses'>) 
</span>                <a href="spi.c.html#LN2278"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN61"><span class='Ref_to_Const'>SPI_OK_UPDATE_RETURNING</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="spi.c.html#LN2278"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN57"><span class='Ref_to_Const'>SPI_OK_UPDATE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="../../include/executor/spi.h.html#LN37"><span class='Ref_to_Const'>SPI_ERROR_OPUNKNOWN</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch operation &raquo; </span> 
 
<span class='Directive'>#ifdef</span> SPI_EXECUTOR_STATS 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>ShowExecutorStats<span class='Parentheses'>) 
</span>        <a href="../../include/tcop/tcopprot.h.html#LN82"><span class='Ref_to_Proto'>ResetUsage</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Comment_Multi_Line'>/* Select execution options */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN2274"><span class='Ref_to_Parameter'>fire_triggers</span></a><span class='Parentheses'>) 
</span>        <a href="spi.c.html#LN2277"><span class='Ref_To_Local'>eflags</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>             <span class='Comment_Single_Line'>/* default run-to-completion flags */ 
</span>    <span class='Control'>else</span> 
        <a href="spi.c.html#LN2277"><span class='Ref_To_Local'>eflags</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN61"><span class='Ref_to_Const'>EXEC_FLAG_SKIP_TRIGGERS</span></a><span class='Delimiter'>; 
</span> 
    <a href="execMain.c.html#LN144"><span class='Ref_to_Func'>ExecutorStart</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2274"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN2277"><span class='Ref_To_Local'>eflags</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/executor/executor.h.html#LN169"><span class='Ref_to_Proto'>ExecutorRun</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2274"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Delimiter'>, </span><a href="../../include/access/sdir.h.html#LN25"><span class='Ref_to_EnumConst'>ForwardScanDirection</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN2274"><span class='Ref_to_Parameter'>tcount</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN24"><span class='Ref_to_Member'>processed</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN2274"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN47"><span class='Ref_to_Member'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN453"><span class='Ref_to_Member'>es_processed</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN25"><span class='Ref_to_Member'>lastoid</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN2274"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN47"><span class='Ref_to_Member'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN454"><span class='Ref_to_Member'>es_lastoid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="spi.c.html#LN2278"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>== </span><a href="../../include/executor/spi.h.html#LN53"><span class='Ref_to_Const'>SPI_OK_SELECT</span></a> <span class='Operator'>|| </span><a href="spi.c.html#LN2274"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN36"><span class='Ref_to_Member'>plannedstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN48"><span class='Ref_to_Member'>hasReturning</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <a href="spi.c.html#LN2274"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN40"><span class='Ref_to_Member'>dest</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/dest.h.html#LN127"><span class='Ref_to_Member'>mydest</span></a> <span class='Operator'>== </span><a href="../../include/tcop/dest.h.html#LN92"><span class='Ref_to_EnumConst'>DestSPI</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN77"><span class='Ref_to_Proto'>_SPI_checktuples</span></a><span class='Parentheses'>())</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"consistency check on SPI tuple count failed"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/executor/executor.h.html#LN173"><span class='Ref_to_Proto'>ExecutorFinish</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2274"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/executor/executor.h.html#LN175"><span class='Ref_to_Proto'>ExecutorEnd</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2274"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* FreeQueryDesc is done by the caller */ 
</span> 
<span class='Directive'>#ifdef</span> SPI_EXECUTOR_STATS 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>ShowExecutorStats<span class='Parentheses'>) 
</span>        <a href="../../include/tcop/tcopprot.h.html#LN83"><span class='Ref_to_Proto'>ShowUsage</span></a><span class='Parentheses'>(</span><span class='String'>"SPI EXECUTOR STATS"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Control'>return</span> <a href="spi.c.html#LN2278"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _SPI_pquery &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * _SPI_error_callback 
 * 
 * Add context information when a query invoked via SPI fails 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2356"></a><span class='Declare_Function'>_SPI_error_callback</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2358"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>query</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="spi.c.html#LN2356"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>; 
</span><a name="LN2359"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>syntaxerrposition</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If there is a syntax error position, convert to internal syntax error; 
     * otherwise treat the query as an item of context stack 
     */ 
</span>    <a href="spi.c.html#LN2359"><span class='Ref_To_Local'>syntaxerrposition</span></a> <span class='Operator'>= </span><a href="../utils/error/elog.c.html#LN1255"><span class='Ref_to_Func'>geterrposition</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN2359"><span class='Ref_To_Local'>syntaxerrposition</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../utils/error/elog.c.html#LN1123"><span class='Ref_to_Func'>errposition</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../utils/error/elog.c.html#LN1139"><span class='Ref_to_Func'>internalerrposition</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2359"><span class='Ref_To_Local'>syntaxerrposition</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../utils/error/elog.c.html#LN1159"><span class='Ref_to_Func'>internalerrquery</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2358"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        errcontext<span class='Parentheses'>(</span><span class='String'>"SQL statement \"%s\""</span><span class='Delimiter'>, </span><a href="spi.c.html#LN2358"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _SPI_error_callback &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * _SPI_cursor_operation() 
 * 
 *  Do a FETCH or MOVE in a cursor 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2382"></a><span class='Declare_Function'>_SPI_cursor_operation</span><span class='Parentheses'>(</span><a href="../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> <span class='Declare_Parameter'>portal</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2635"><span class='Ref_to_Enum'>FetchDirection</span></a> <span class='Declare_Parameter'>direction</span><span class='Delimiter'>, </span><span class='Keyword'>long </span><span class='Declare_Parameter'>count</span><span class='Delimiter'>, 
</span><a name="LN2383"></a>                      <a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dest</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2385"></a>    <a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Local'>nfetched</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check that the portal is valid */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/portal.h.html#LN198"><span class='Ref_to_Macro'>PortalIsValid</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2382"><span class='Ref_to_Parameter'>portal</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid portal in SPI cursor operation"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Push the SPI stack */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN73"><span class='Ref_to_Proto'>_SPI_begin_call</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"SPI cursor operation called while not connected"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Reset the SPI result (note we deliberately don't touch lastoid) */ 
</span>    <a href="spi.c.html#LN38"><span class='Ref_to_Global_Var'>SPI_processed</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN24"><span class='Ref_to_Member'>processed</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN26"><span class='Ref_to_Member'>tuptable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Run the cursor */ 
</span>    <a href="spi.c.html#LN2385"><span class='Ref_To_Local'>nfetched</span></a> <span class='Operator'>= </span><a href="../../include/tcop/pquery.h.html#LN39"><span class='Ref_to_Proto'>PortalRunFetch</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2382"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>, 
</span>                              <a href="spi.c.html#LN2382"><span class='Ref_to_Parameter'>direction</span></a><span class='Delimiter'>, 
</span>                              <a href="spi.c.html#LN2382"><span class='Ref_to_Parameter'>count</span></a><span class='Delimiter'>, 
</span>                              <a href="spi.c.html#LN2383"><span class='Ref_to_Parameter'>dest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Think not to combine this store with the preceding function call. If 
     * the portal contains calls to functions that use SPI, then SPI_stack is 
     * likely to move around while the portal runs.  When control returns, 
     * _SPI_current will point to the correct stack entry... but the pointer 
     * may be different than it was beforehand. So we must be sure to re-fetch 
     * the pointer after the function call completes. 
     */ 
</span>    <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN24"><span class='Ref_to_Member'>processed</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN2385"><span class='Ref_To_Local'>nfetched</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN2383"><span class='Ref_to_Parameter'>dest</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/dest.h.html#LN127"><span class='Ref_to_Member'>mydest</span></a> <span class='Operator'>== </span><a href="../../include/tcop/dest.h.html#LN92"><span class='Ref_to_EnumConst'>DestSPI</span></a> <span class='Operator'>&& </span><a href="spi.c.html#LN77"><span class='Ref_to_Proto'>_SPI_checktuples</span></a><span class='Parentheses'>())</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"consistency check on SPI tuple count failed"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Put the result into place for access by caller */ 
</span>    <a href="spi.c.html#LN38"><span class='Ref_to_Global_Var'>SPI_processed</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN24"><span class='Ref_to_Member'>processed</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN26"><span class='Ref_to_Member'>tuptable</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* tuptable now is caller's responsibility, not SPI's */ 
</span>    <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN26"><span class='Ref_to_Member'>tuptable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Pop the SPI stack */ 
</span>    <a href="spi.c.html#LN74"><span class='Ref_to_Proto'>_SPI_end_call</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _SPI_cursor_operation &raquo; </span> 
 
 
<span class='Keyword'>static </span><a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> 
<a name="LN2433"></a><span class='Declare_Function'>_SPI_execmem</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN31"><span class='Ref_to_Member'>execCxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span><a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> 
<a name="LN2439"></a><span class='Declare_Function'>_SPI_procmem</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN30"><span class='Ref_to_Member'>procCxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * _SPI_begin_call: begin a SPI operation within a connected procedure 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN2448"></a><span class='Declare_Function'>_SPI_begin_call</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>execmem</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../include/executor/spi.h.html#LN38"><span class='Ref_to_Const'>SPI_ERROR_UNCONNECTED</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN2448"><span class='Ref_to_Parameter'>execmem</span></a><span class='Parentheses'>)</span>                <span class='Comment_Single_Line'>/* switch to the Executor memory context */ 
</span>        <a href="spi.c.html#LN75"><span class='Ref_to_Proto'>_SPI_execmem</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * _SPI_end_call: end a SPI operation within a connected procedure 
 * 
 * Note: this currently has no failure return cases, so callers don't check 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN2465"></a><span class='Declare_Function'>_SPI_end_call</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>procmem</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN2465"><span class='Ref_to_Parameter'>procmem</span></a><span class='Parentheses'>)</span>                <span class='Comment_Single_Line'>/* switch to the procedure memory context */ 
</span>    <span class='Delimiter'>{ 
</span>        <a href="spi.c.html#LN76"><span class='Ref_to_Proto'>_SPI_procmem</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* and free Executor memory */ 
</span>        <a href="../../include/utils/memutils.h.html#LN66"><span class='Ref_to_Macro'>MemoryContextResetAndDeleteChildren</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN31"><span class='Ref_to_Member'>execCxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static bool 
</span><a name="LN2478"></a><span class='Declare_Function'>_SPI_checktuples</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2480"></a>    <a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Local'>processed</span> <span class='Operator'>= </span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN24"><span class='Ref_to_Member'>processed</span></a><span class='Delimiter'>; 
</span><a name="LN2481"></a>    <a href="../../include/executor/spi.h.html#LN21"><span class='Ref_to_Struct'>SPITupleTable</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tuptable</span> <span class='Operator'>= </span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN26"><span class='Ref_to_Member'>tuptable</span></a><span class='Delimiter'>; 
</span><a name="LN2482"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>failed</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN2481"><span class='Ref_To_Local'>tuptable</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span>       <span class='Comment_Single_Line'>/* spi_dest_startup was not called */ 
</span>        <a href="spi.c.html#LN2482"><span class='Ref_To_Local'>failed</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN2480"><span class='Ref_To_Local'>processed</span></a> <span class='Operator'>!= </span><span class='Parentheses'>(</span><a href="spi.c.html#LN2481"><span class='Ref_To_Local'>tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi.h.html#LN24"><span class='Ref_to_Member'>alloced</span></a> <span class='Operator'>- </span><a href="spi.c.html#LN2481"><span class='Ref_To_Local'>tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi.h.html#LN25"><span class='Ref_to_Member'>free</span></a><span class='Parentheses'>))</span> 
        <a href="spi.c.html#LN2482"><span class='Ref_To_Local'>failed</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="spi.c.html#LN2482"><span class='Ref_To_Local'>failed</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Convert a "temporary" SPIPlan into an "unsaved" plan. 
 * 
 * The passed _SPI_plan struct is on the stack, and all its subsidiary data 
 * is in or under the current SPI executor context.  Copy the plan into the 
 * SPI procedure context so it will survive _SPI_end_call().  To minimize 
 * data copying, this destructively modifies the input plan, by taking the 
 * plancache entries away from it and reparenting them to the new SPIPlan. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a> 
<a name="LN2502"></a><span class='Declare_Function'>_SPI_make_plan_non_temp</span><span class='Parentheses'>(</span><a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a> <span class='Declare_Parameter'>plan</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2504"></a>    <a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a>  <span class='Declare_Local'>newplan</span><span class='Delimiter'>; 
</span><a name="LN2505"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>parentcxt</span> <span class='Operator'>= </span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN30"><span class='Ref_to_Member'>procCxt</span></a><span class='Delimiter'>; 
</span><a name="LN2506"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>plancxt</span><span class='Delimiter'>; 
</span><a name="LN2507"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span><a name="LN2508"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Assert the input is a temporary SPIPlan */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="spi.c.html#LN2502"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN78"><span class='Ref_to_Member'>magic</span></a> <span class='Operator'>== </span><a href="../../include/executor/spi_priv.h.html#LN19"><span class='Ref_to_Const'>_SPI_PLAN_MAGIC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="spi.c.html#LN2502"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN82"><span class='Ref_to_Member'>plancxt</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* One-shot plans can't be saved */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="spi.c.html#LN2502"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN80"><span class='Ref_to_Member'>oneshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create a memory context for the plan, underneath the procedure context. 
     * We don't expect the plan to be very large. 
     */ 
</span>    <a href="spi.c.html#LN2506"><span class='Ref_To_Local'>plancxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2505"><span class='Ref_To_Local'>parentcxt</span></a><span class='Delimiter'>, 
</span>                                    <span class='String'>"SPI Plan"</span><span class='Delimiter'>, 
</span>                                    <a href="../../include/utils/memutils.h.html#LN174"><span class='Ref_to_Const'>ALLOCSET_SMALL_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN2507"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2506"><span class='Ref_To_Local'>plancxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Copy the SPI_plan struct and subsidiary data into the new context */ 
</span>    <a href="spi.c.html#LN2504"><span class='Ref_To_Local'>newplan</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/executor/spi_priv.h.html#LN76"><span class='Ref_to_Struct'>_SPI_plan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN2504"><span class='Ref_To_Local'>newplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN78"><span class='Ref_to_Member'>magic</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi_priv.h.html#LN19"><span class='Ref_to_Const'>_SPI_PLAN_MAGIC</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN2504"><span class='Ref_To_Local'>newplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN79"><span class='Ref_to_Member'>saved</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN2504"><span class='Ref_To_Local'>newplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN80"><span class='Ref_to_Member'>oneshot</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN2504"><span class='Ref_To_Local'>newplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN81"><span class='Ref_to_Member'>plancache_list</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN2504"><span class='Ref_To_Local'>newplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN82"><span class='Ref_to_Member'>plancxt</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN2506"><span class='Ref_To_Local'>plancxt</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN2504"><span class='Ref_To_Local'>newplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN83"><span class='Ref_to_Member'>cursor_options</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN2502"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN83"><span class='Ref_to_Member'>cursor_options</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN2504"><span class='Ref_To_Local'>newplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN84"><span class='Ref_to_Member'>nargs</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN2502"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN84"><span class='Ref_to_Member'>nargs</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN2502"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN84"><span class='Ref_to_Member'>nargs</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="spi.c.html#LN2504"><span class='Ref_To_Local'>newplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN85"><span class='Ref_to_Member'>argtypes</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2502"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN84"><span class='Ref_to_Member'>nargs</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="spi.c.html#LN2504"><span class='Ref_To_Local'>newplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN85"><span class='Ref_to_Member'>argtypes</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN2502"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN85"><span class='Ref_to_Member'>argtypes</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN2502"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN84"><span class='Ref_to_Member'>nargs</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="spi.c.html#LN2504"><span class='Ref_To_Local'>newplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN85"><span class='Ref_to_Member'>argtypes</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN2504"><span class='Ref_To_Local'>newplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN86"><span class='Ref_to_Member'>parserSetup</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN2502"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN86"><span class='Ref_to_Member'>parserSetup</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN2504"><span class='Ref_To_Local'>newplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN87"><span class='Ref_to_Member'>parserSetupArg</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN2502"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN87"><span class='Ref_to_Member'>parserSetupArg</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Reparent all the CachedPlanSources into the procedure context.  In 
     * theory this could fail partway through due to the pallocs, but we don't 
     * care too much since both the procedure context and the executor context 
     * would go away on error. 
     */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2508"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN2502"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN81"><span class='Ref_to_Member'>plancache_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2552"></a>        <a href="../../include/utils/plancache.h.html#LN79"><span class='Ref_to_Struct'>CachedPlanSource</span></a> <span class='Operator'>*</span><span class='Declare_Local'>plansource</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/utils/plancache.h.html#LN79"><span class='Ref_to_Struct'>CachedPlanSource</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2508"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/plancache.h.html#LN168"><span class='Ref_to_Proto'>CachedPlanSetParentContext</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2552"><span class='Ref_To_Local'>plansource</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN2505"><span class='Ref_To_Local'>parentcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Build new list, with list cells in plancxt */ 
</span>        <a href="spi.c.html#LN2504"><span class='Ref_To_Local'>newplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN81"><span class='Ref_to_Member'>plancache_list</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2504"><span class='Ref_To_Local'>newplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN81"><span class='Ref_to_Member'>plancache_list</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN2552"><span class='Ref_To_Local'>plansource</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2507"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* For safety, unlink the CachedPlanSources from the temporary plan */ 
</span>    <a href="spi.c.html#LN2502"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN81"><span class='Ref_to_Member'>plancache_list</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="spi.c.html#LN2504"><span class='Ref_To_Local'>newplan</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _SPI_make_plan_non_temp &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Make a "saved" copy of the given plan. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a> 
<a name="LN2572"></a><span class='Declare_Function'>_SPI_save_plan</span><span class='Parentheses'>(</span><a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a> <span class='Declare_Parameter'>plan</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2574"></a>    <a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a>  <span class='Declare_Local'>newplan</span><span class='Delimiter'>; 
</span><a name="LN2575"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>plancxt</span><span class='Delimiter'>; 
</span><a name="LN2576"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span><a name="LN2577"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* One-shot plans can't be saved */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="spi.c.html#LN2572"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN80"><span class='Ref_to_Member'>oneshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create a memory context for the plan.  We don't expect the plan to be 
     * very large, so use smaller-than-default alloc parameters.  It's a 
     * transient context until we finish copying everything. 
     */ 
</span>    <a href="spi.c.html#LN2575"><span class='Ref_To_Local'>plancxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, 
</span>                                    <span class='String'>"SPI Plan"</span><span class='Delimiter'>, 
</span>                                    <a href="../../include/utils/memutils.h.html#LN174"><span class='Ref_to_Const'>ALLOCSET_SMALL_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN2576"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2575"><span class='Ref_To_Local'>plancxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Copy the SPI plan into its own context */ 
</span>    <a href="spi.c.html#LN2574"><span class='Ref_To_Local'>newplan</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/executor/spi_priv.h.html#LN76"><span class='Ref_to_Struct'>_SPI_plan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN2574"><span class='Ref_To_Local'>newplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN78"><span class='Ref_to_Member'>magic</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi_priv.h.html#LN19"><span class='Ref_to_Const'>_SPI_PLAN_MAGIC</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN2574"><span class='Ref_To_Local'>newplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN79"><span class='Ref_to_Member'>saved</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN2574"><span class='Ref_To_Local'>newplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN80"><span class='Ref_to_Member'>oneshot</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN2574"><span class='Ref_To_Local'>newplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN81"><span class='Ref_to_Member'>plancache_list</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN2574"><span class='Ref_To_Local'>newplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN82"><span class='Ref_to_Member'>plancxt</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN2575"><span class='Ref_To_Local'>plancxt</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN2574"><span class='Ref_To_Local'>newplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN83"><span class='Ref_to_Member'>cursor_options</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN2572"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN83"><span class='Ref_to_Member'>cursor_options</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN2574"><span class='Ref_To_Local'>newplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN84"><span class='Ref_to_Member'>nargs</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN2572"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN84"><span class='Ref_to_Member'>nargs</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN2572"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN84"><span class='Ref_to_Member'>nargs</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="spi.c.html#LN2574"><span class='Ref_To_Local'>newplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN85"><span class='Ref_to_Member'>argtypes</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2572"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN84"><span class='Ref_to_Member'>nargs</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="spi.c.html#LN2574"><span class='Ref_To_Local'>newplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN85"><span class='Ref_to_Member'>argtypes</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN2572"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN85"><span class='Ref_to_Member'>argtypes</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN2572"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN84"><span class='Ref_to_Member'>nargs</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="spi.c.html#LN2574"><span class='Ref_To_Local'>newplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN85"><span class='Ref_to_Member'>argtypes</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN2574"><span class='Ref_To_Local'>newplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN86"><span class='Ref_to_Member'>parserSetup</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN2572"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN86"><span class='Ref_to_Member'>parserSetup</span></a><span class='Delimiter'>; 
</span>    <a href="spi.c.html#LN2574"><span class='Ref_To_Local'>newplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN87"><span class='Ref_to_Member'>parserSetupArg</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN2572"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN87"><span class='Ref_to_Member'>parserSetupArg</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Copy all the plancache entries */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2577"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN2572"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN81"><span class='Ref_to_Member'>plancache_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2614"></a>        <a href="../../include/utils/plancache.h.html#LN79"><span class='Ref_to_Struct'>CachedPlanSource</span></a> <span class='Operator'>*</span><span class='Declare_Local'>plansource</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/utils/plancache.h.html#LN79"><span class='Ref_to_Struct'>CachedPlanSource</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2577"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2615"></a>        <a href="../../include/utils/plancache.h.html#LN79"><span class='Ref_to_Struct'>CachedPlanSource</span></a> <span class='Operator'>*</span><span class='Declare_Local'>newsource</span><span class='Delimiter'>; 
</span> 
        <a href="spi.c.html#LN2615"><span class='Ref_To_Local'>newsource</span></a> <span class='Operator'>= </span><a href="../../include/utils/plancache.h.html#LN171"><span class='Ref_to_Proto'>CopyCachedPlan</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2614"><span class='Ref_To_Local'>plansource</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN2574"><span class='Ref_To_Local'>newplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN81"><span class='Ref_to_Member'>plancache_list</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2574"><span class='Ref_To_Local'>newplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN81"><span class='Ref_to_Member'>plancache_list</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN2615"><span class='Ref_To_Local'>newsource</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2576"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Mark it saved, reparent it under CacheMemoryContext, and mark all the 
     * component CachedPlanSources as saved.  This sequence cannot fail 
     * partway through, so there's no risk of long-term memory leakage. 
     */ 
</span>    <a href="spi.c.html#LN2574"><span class='Ref_To_Local'>newplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN79"><span class='Ref_to_Member'>saved</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/memutils.h.html#LN78"><span class='Ref_to_Proto'>MemoryContextSetParent</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2574"><span class='Ref_To_Local'>newplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN82"><span class='Ref_to_Member'>plancxt</span></a><span class='Delimiter'>, </span><a href="../utils/mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2577"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN2574"><span class='Ref_To_Local'>newplan</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN81"><span class='Ref_to_Member'>plancache_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2633"></a>        <a href="../../include/utils/plancache.h.html#LN79"><span class='Ref_to_Struct'>CachedPlanSource</span></a> <span class='Operator'>*</span><span class='Declare_Local'>plansource</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/utils/plancache.h.html#LN79"><span class='Ref_to_Struct'>CachedPlanSource</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2577"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/plancache.h.html#LN165"><span class='Ref_to_Proto'>SaveCachedPlan</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2633"><span class='Ref_To_Local'>plansource</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="spi.c.html#LN2574"><span class='Ref_To_Local'>newplan</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _SPI_save_plan &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Internal lookup of ephemeral named relation by name. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/utils/queryenvironment.h.html#LN55"><span class='Ref_to_Typedef'>EphemeralNamedRelation</span></a> 
<a name="LN2645"></a><span class='Declare_Function'>_SPI_find_ENR_by_name</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* internal static function; any error is bug in SPI itself */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="spi.c.html#LN2645"><span class='Ref_to_Parameter'>name</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* fast exit if no tuplestores have been added */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN34"><span class='Ref_to_Member'>queryEnv</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/utils/queryenvironment.h.html#LN70"><span class='Ref_to_Proto'>get_ENR</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN34"><span class='Ref_to_Member'>queryEnv</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN2645"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Register an ephemeral named relation for use by the planner and executor on 
 * subsequent calls using this SPI connection. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN2662"></a><span class='Declare_Function'>SPI_register_relation</span><span class='Parentheses'>(</span><a href="../../include/utils/queryenvironment.h.html#LN55"><span class='Ref_to_Typedef'>EphemeralNamedRelation</span></a> <span class='Declare_Parameter'>enr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2664"></a>    <a href="../../include/utils/queryenvironment.h.html#LN55"><span class='Ref_to_Typedef'>EphemeralNamedRelation</span></a> <span class='Declare_Local'>match</span><span class='Delimiter'>; 
</span><a name="LN2665"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN2662"><span class='Ref_to_Parameter'>enr</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="spi.c.html#LN2662"><span class='Ref_to_Parameter'>enr</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/queryenvironment.h.html#LN51"><span class='Ref_to_Member'>md</span></a><span class='Operator'>.</span><a href="../../include/utils/queryenvironment.h.html#LN33"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../include/executor/spi.h.html#LN40"><span class='Ref_to_Const'>SPI_ERROR_ARGUMENT</span></a><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN2665"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN73"><span class='Ref_to_Proto'>_SPI_begin_call</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* keep current memory context */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN2665"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="spi.c.html#LN2665"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN2664"><span class='Ref_To_Local'>match</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN2644"><span class='Ref_to_Func'>_SPI_find_ENR_by_name</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2662"><span class='Ref_to_Parameter'>enr</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/queryenvironment.h.html#LN51"><span class='Ref_to_Member'>md</span></a><span class='Operator'>.</span><a href="../../include/utils/queryenvironment.h.html#LN33"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN2664"><span class='Ref_To_Local'>match</span></a><span class='Parentheses'>) 
</span>        <a href="spi.c.html#LN2665"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN46"><span class='Ref_to_Const'>SPI_ERROR_REL_DUPLICATE</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN34"><span class='Ref_to_Member'>queryEnv</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN34"><span class='Ref_to_Member'>queryEnv</span></a> <span class='Operator'>= </span><a href="../utils/misc/queryenvironment.c.html#LN37"><span class='Ref_to_Func'>create_queryEnv</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <a href="../utils/misc/queryenvironment.c.html#LN67"><span class='Ref_to_Func'>register_ENR</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN34"><span class='Ref_to_Member'>queryEnv</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN2662"><span class='Ref_to_Parameter'>enr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN2665"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN63"><span class='Ref_to_Const'>SPI_OK_REL_REGISTER</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="spi.c.html#LN74"><span class='Ref_to_Proto'>_SPI_end_call</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="spi.c.html#LN2665"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SPI_register_relation &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Unregister an ephemeral named relation by name.  This will probably be a 
 * rarely used function, since SPI_finish will clear it automatically. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN2696"></a><span class='Declare_Function'>SPI_unregister_relation</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2698"></a>    <a href="../../include/utils/queryenvironment.h.html#LN55"><span class='Ref_to_Typedef'>EphemeralNamedRelation</span></a> <span class='Declare_Local'>match</span><span class='Delimiter'>; 
</span><a name="LN2699"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN2696"><span class='Ref_to_Parameter'>name</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../include/executor/spi.h.html#LN40"><span class='Ref_to_Const'>SPI_ERROR_ARGUMENT</span></a><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN2699"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN73"><span class='Ref_to_Proto'>_SPI_begin_call</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* keep current memory context */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN2699"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="spi.c.html#LN2699"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN2698"><span class='Ref_To_Local'>match</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN2644"><span class='Ref_to_Func'>_SPI_find_ENR_by_name</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2696"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN2698"><span class='Ref_To_Local'>match</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/queryenvironment.h.html#LN69"><span class='Ref_to_Proto'>unregister_ENR</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN44"><span class='Ref_to_Global_Var'>_SPI_current</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi_priv.h.html#LN34"><span class='Ref_to_Member'>queryEnv</span></a><span class='Delimiter'>, </span><a href="spi.c.html#LN2698"><span class='Ref_To_Local'>match</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/queryenvironment.h.html#LN51"><span class='Ref_to_Member'>md</span></a><span class='Operator'>.</span><a href="../../include/utils/queryenvironment.h.html#LN33"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN2699"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN64"><span class='Ref_to_Const'>SPI_OK_REL_UNREGISTER</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="spi.c.html#LN2699"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN47"><span class='Ref_to_Const'>SPI_ERROR_REL_NOT_FOUND</span></a><span class='Delimiter'>; 
</span> 
    <a href="spi.c.html#LN74"><span class='Ref_to_Proto'>_SPI_end_call</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="spi.c.html#LN2699"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SPI_unregister_relation &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Register the transient relations from 'tdata' using this SPI connection. 
 * This should be called by PL implementations' trigger handlers after 
 * connecting, in order to make transition tables visible to any queries run 
 * in this connection. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN2729"></a><span class='Declare_Function'>SPI_register_trigger_data</span><span class='Parentheses'>(</span><a href="../../include/commands/trigger.h.html#LN29"><span class='Ref_to_Struct'>TriggerData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tdata</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN2729"><span class='Ref_to_Parameter'>tdata</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../include/executor/spi.h.html#LN40"><span class='Ref_to_Const'>SPI_ERROR_ARGUMENT</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN2729"><span class='Ref_to_Parameter'>tdata</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/trigger.h.html#LN40"><span class='Ref_to_Member'>tg_newtable</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2736"></a>        <a href="../../include/utils/queryenvironment.h.html#LN55"><span class='Ref_to_Typedef'>EphemeralNamedRelation</span></a> <span class='Declare_Local'>enr</span> <span class='Operator'>= 
</span>        <a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/utils/queryenvironment.h.html#LN49"><span class='Ref_to_Struct'>EphemeralNamedRelationData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN2738"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>rc</span><span class='Delimiter'>; 
</span> 
        <a href="spi.c.html#LN2736"><span class='Ref_To_Local'>enr</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/queryenvironment.h.html#LN51"><span class='Ref_to_Member'>md</span></a><span class='Operator'>.</span><a href="../../include/utils/queryenvironment.h.html#LN33"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN2729"><span class='Ref_to_Parameter'>tdata</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/trigger.h.html#LN36"><span class='Ref_to_Member'>tg_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN42"><span class='Ref_to_Member'>tgnewtable</span></a><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN2736"><span class='Ref_To_Local'>enr</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/queryenvironment.h.html#LN51"><span class='Ref_to_Member'>md</span></a><span class='Operator'>.</span><a href="../../include/utils/queryenvironment.h.html#LN36"><span class='Ref_to_Member'>reliddesc</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN2729"><span class='Ref_to_Parameter'>tdata</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/trigger.h.html#LN33"><span class='Ref_to_Member'>tg_relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN115"><span class='Ref_to_Member'>rd_id</span></a><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN2736"><span class='Ref_To_Local'>enr</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/queryenvironment.h.html#LN51"><span class='Ref_to_Member'>md</span></a><span class='Operator'>.</span><a href="../../include/utils/queryenvironment.h.html#LN37"><span class='Ref_to_Member'>tupdesc</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN2736"><span class='Ref_To_Local'>enr</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/queryenvironment.h.html#LN51"><span class='Ref_to_Member'>md</span></a><span class='Operator'>.</span><a href="../../include/utils/queryenvironment.h.html#LN39"><span class='Ref_to_Member'>enrtype</span></a> <span class='Operator'>= </span><a href="../../include/utils/queryenvironment.h.html#LN21"><span class='Ref_to_EnumConst'>ENR_NAMED_TUPLESTORE</span></a><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN2736"><span class='Ref_To_Local'>enr</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/queryenvironment.h.html#LN51"><span class='Ref_to_Member'>md</span></a><span class='Operator'>.</span><a href="../../include/utils/queryenvironment.h.html#LN40"><span class='Ref_to_Member'>enrtuples</span></a> <span class='Operator'>= </span><a href="../../include/utils/tuplestore.h.html#LN80"><span class='Ref_to_Proto'>tuplestore_tuple_count</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2729"><span class='Ref_to_Parameter'>tdata</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/trigger.h.html#LN40"><span class='Ref_to_Member'>tg_newtable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN2736"><span class='Ref_To_Local'>enr</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/queryenvironment.h.html#LN52"><span class='Ref_to_Member'>reldata</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN2729"><span class='Ref_to_Parameter'>tdata</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/trigger.h.html#LN40"><span class='Ref_to_Member'>tg_newtable</span></a><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN2738"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN154"><span class='Ref_to_Proto'>SPI_register_relation</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2736"><span class='Ref_To_Local'>enr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN2738"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>!= </span><a href="../../include/executor/spi.h.html#LN63"><span class='Ref_to_Const'>SPI_OK_REL_REGISTER</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="spi.c.html#LN2738"><span class='Ref_To_Local'>rc</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN2729"><span class='Ref_to_Parameter'>tdata</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/trigger.h.html#LN39"><span class='Ref_to_Member'>tg_oldtable</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2753"></a>        <a href="../../include/utils/queryenvironment.h.html#LN55"><span class='Ref_to_Typedef'>EphemeralNamedRelation</span></a> <span class='Declare_Local'>enr</span> <span class='Operator'>= 
</span>        <a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/utils/queryenvironment.h.html#LN49"><span class='Ref_to_Struct'>EphemeralNamedRelationData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN2755"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>rc</span><span class='Delimiter'>; 
</span> 
        <a href="spi.c.html#LN2753"><span class='Ref_To_Local'>enr</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/queryenvironment.h.html#LN51"><span class='Ref_to_Member'>md</span></a><span class='Operator'>.</span><a href="../../include/utils/queryenvironment.h.html#LN33"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN2729"><span class='Ref_to_Parameter'>tdata</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/trigger.h.html#LN36"><span class='Ref_to_Member'>tg_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN41"><span class='Ref_to_Member'>tgoldtable</span></a><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN2753"><span class='Ref_To_Local'>enr</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/queryenvironment.h.html#LN51"><span class='Ref_to_Member'>md</span></a><span class='Operator'>.</span><a href="../../include/utils/queryenvironment.h.html#LN36"><span class='Ref_to_Member'>reliddesc</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN2729"><span class='Ref_to_Parameter'>tdata</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/trigger.h.html#LN33"><span class='Ref_to_Member'>tg_relation</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN115"><span class='Ref_to_Member'>rd_id</span></a><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN2753"><span class='Ref_To_Local'>enr</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/queryenvironment.h.html#LN51"><span class='Ref_to_Member'>md</span></a><span class='Operator'>.</span><a href="../../include/utils/queryenvironment.h.html#LN37"><span class='Ref_to_Member'>tupdesc</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN2753"><span class='Ref_To_Local'>enr</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/queryenvironment.h.html#LN51"><span class='Ref_to_Member'>md</span></a><span class='Operator'>.</span><a href="../../include/utils/queryenvironment.h.html#LN39"><span class='Ref_to_Member'>enrtype</span></a> <span class='Operator'>= </span><a href="../../include/utils/queryenvironment.h.html#LN21"><span class='Ref_to_EnumConst'>ENR_NAMED_TUPLESTORE</span></a><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN2753"><span class='Ref_To_Local'>enr</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/queryenvironment.h.html#LN51"><span class='Ref_to_Member'>md</span></a><span class='Operator'>.</span><a href="../../include/utils/queryenvironment.h.html#LN40"><span class='Ref_to_Member'>enrtuples</span></a> <span class='Operator'>= </span><a href="../../include/utils/tuplestore.h.html#LN80"><span class='Ref_to_Proto'>tuplestore_tuple_count</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2729"><span class='Ref_to_Parameter'>tdata</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/trigger.h.html#LN39"><span class='Ref_to_Member'>tg_oldtable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN2753"><span class='Ref_To_Local'>enr</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/queryenvironment.h.html#LN52"><span class='Ref_to_Member'>reldata</span></a> <span class='Operator'>= </span><a href="spi.c.html#LN2729"><span class='Ref_to_Parameter'>tdata</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/trigger.h.html#LN39"><span class='Ref_to_Member'>tg_oldtable</span></a><span class='Delimiter'>; 
</span>        <a href="spi.c.html#LN2755"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN154"><span class='Ref_to_Proto'>SPI_register_relation</span></a><span class='Parentheses'>(</span><a href="spi.c.html#LN2753"><span class='Ref_To_Local'>enr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spi.c.html#LN2755"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>!= </span><a href="../../include/executor/spi.h.html#LN63"><span class='Ref_to_Const'>SPI_OK_REL_REGISTER</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="spi.c.html#LN2755"><span class='Ref_To_Local'>rc</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="../../include/executor/spi.h.html#LN65"><span class='Ref_to_Const'>SPI_OK_TD_REGISTER</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SPI_register_trigger_data &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>