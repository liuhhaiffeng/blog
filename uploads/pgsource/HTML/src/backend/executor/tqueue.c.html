<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\executor\tqueue.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\executor\tqueue.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:40 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * tqueue.c 
 *    Use shm_mq to send & receive tuples between parallel backends 
 * 
 * Most of the complexity in this module arises from transient RECORD types, 
 * which all have type RECORDOID and are distinguished by typmod numbers 
 * that are managed per-backend (see src/backend/utils/cache/typcache.c). 
 * The sender's set of RECORD typmod assignments probably doesn't match the 
 * receiver's.  To deal with this, we make the sender send a description 
 * of each transient RECORD type appearing in the data it sends.  The 
 * receiver finds or creates a matching type in its own typcache, and then 
 * maps the sender's typmod for that type to its own typmod. 
 * 
 * A DestReceiver of type DestTupleQueue, which is a TQueueDestReceiver 
 * under the hood, writes tuples from the executor to a shm_mq.  If 
 * necessary, it also writes control messages describing transient 
 * record types used within the tuple. 
 * 
 * A TupleQueueReader reads tuples, and control messages if any are sent, 
 * from a shm_mq and returns the tuples.  If transient record types are 
 * in use, it registers those types locally based on the control messages 
 * and rewrites the typmods sent by the remote side to the corresponding 
 * local record typmods. 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * IDENTIFICATION 
 *    src/backend/executor/tqueue.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"executor/tqueue.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"funcapi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"lib/stringinfo.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/array.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rangetypes.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/typcache.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * The data transferred through the shm_mq is divided into messages. 
 * One-byte messages are mode-switch messages, telling the receiver to switch 
 * between "control" and "data" modes.  (We always start up in "data" mode.) 
 * Otherwise, when in "data" mode, each message is a tuple.  When in "control" 
 * mode, each message defines one transient-typmod-to-tupledesc mapping to 
 * let us interpret future tuples.  Both of those cases certainly require 
 * more than one byte, so no confusion is possible. 
 */ 
</span><a name="LN59"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>TUPLE_QUEUE_MODE_CONTROL</span>    <span class='String'>'c'</span> <span class='Comment_Single_Line'>/* mode-switch message contents */ 
</span><a name="LN60"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>TUPLE_QUEUE_MODE_DATA</span>       <span class='String'>'d'</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Both the sender and receiver build trees of TupleRemapInfo nodes to help 
 * them identify which (sub) fields of transmitted tuples are composite and 
 * may thus need remap processing.  We might need to look within arrays and 
 * ranges, not only composites, to find composite sub-fields.  A NULL 
 * TupleRemapInfo pointer indicates that it is known that the described field 
 * is not composite and has no composite substructure. 
 * 
 * Note that we currently have to look at each composite field at runtime, 
 * even if we believe it's of a named composite type (i.e., not RECORD). 
 * This is because we allow the actual value to be a compatible transient 
 * RECORD type.  That's grossly inefficient, and it would be good to get 
 * rid of the requirement, but it's not clear what would need to change. 
 * 
 * Also, we allow the top-level tuple structure, as well as the actual 
 * structure of composite subfields, to change from one tuple to the next 
 * at runtime.  This may well be entirely historical, but it's mostly free 
 * to support given the previous requirement; and other places in the system 
 * also permit this, so it's not entirely clear if we could drop it. 
 */ 
</span> 
<span class='Control'>typedef</span> <span class='Control'>enum</span> 
<span class='Delimiter'>{ 
</span><a name="LN85"></a>    <span class='Declare_Enum_Const'>TQUEUE_REMAP_ARRAY</span><span class='Delimiter'>,</span>         <span class='Comment_Single_Line'>/* array */ 
</span><a name="LN86"></a>    <span class='Declare_Enum_Const'>TQUEUE_REMAP_RANGE</span><span class='Delimiter'>,</span>         <span class='Comment_Single_Line'>/* range */ 
</span><a name="LN87"></a>    <span class='Declare_Enum_Const'>TQUEUE_REMAP_RECORD</span>         <span class='Comment_Single_Line'>/* composite type, named or transient */ 
</span><a name="LN88"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>TupleRemapClass</span><span class='Delimiter'>; 
</span> 
<a name="LN90"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <a href="tqueue.c.html#LN118"><span class='Ref_to_Struct'>TupleRemapInfo</span></a> <span class='Declare_Typedef'>TupleRemapInfo</span><span class='Delimiter'>; 
</span> 
<a name="LN92"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>ArrayRemapInfo</span> 
<span class='Delimiter'>{ 
</span><a name="LN94"></a>    <a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Member'>typlen</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* array element type's storage properties */ 
</span><a name="LN95"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>typbyval</span><span class='Delimiter'>; 
</span><a name="LN96"></a>    <span class='Keyword'>char</span>        <span class='Declare_Member'>typalign</span><span class='Delimiter'>; 
</span><a name="LN97"></a>    <a href="tqueue.c.html#LN118"><span class='Ref_to_Struct'>TupleRemapInfo</span></a> <span class='Operator'>*</span><span class='Declare_Member'>element_remap</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* array element type's remap info */ 
</span><a name="LN98"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>ArrayRemapInfo</span><span class='Delimiter'>; 
</span> 
<a name="LN100"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>RangeRemapInfo</span> 
<span class='Delimiter'>{ 
</span><a name="LN102"></a>    <a href="../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Member'>typcache</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* range type's typcache entry */ 
</span><a name="LN103"></a>    <a href="tqueue.c.html#LN118"><span class='Ref_to_Struct'>TupleRemapInfo</span></a> <span class='Operator'>*</span><span class='Declare_Member'>bound_remap</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* range bound type's remap info */ 
</span><a name="LN104"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>RangeRemapInfo</span><span class='Delimiter'>; 
</span> 
<a name="LN106"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>RecordRemapInfo</span> 
<span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Original (remote) type ID info last seen for this composite field */ 
</span><a name="LN109"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>rectypid</span><span class='Delimiter'>; 
</span><a name="LN110"></a>    <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Member'>rectypmod</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Local RECORD typmod, or -1 if unset; not used on sender side */ 
</span><a name="LN112"></a>    <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Member'>localtypmod</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* If no fields of the record require remapping, these are NULL: */ 
</span><a name="LN114"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Member'>tupledesc</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* copy of record's tupdesc */ 
</span><a name="LN115"></a>    <a href="tqueue.c.html#LN118"><span class='Ref_to_Struct'>TupleRemapInfo</span></a> <span class='Operator'>**</span><span class='Declare_Member'>field_remap</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* each field's remap info */ 
</span><a name="LN116"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>RecordRemapInfo</span><span class='Delimiter'>; 
</span> 
<a name="LN118"></a><span class='Control'>struct</span> <span class='Declare_Struct'>TupleRemapInfo</span> 
<span class='Delimiter'>{ 
</span><a name="LN120"></a>    <a href="tqueue.c.html#LN83"><span class='Ref_to_Typedef'>TupleRemapClass</span></a> <span class='Declare_Member'>remapclass</span><span class='Delimiter'>; 
</span>    <span class='Control'>union</span> 
    <span class='Delimiter'>{ 
</span><a name="LN123"></a>        <a href="tqueue.c.html#LN92"><span class='Ref_to_Struct'>ArrayRemapInfo</span></a> <span class='Declare_Member'>arr</span><span class='Delimiter'>; 
</span><a name="LN124"></a>        <a href="tqueue.c.html#LN100"><span class='Ref_to_Struct'>RangeRemapInfo</span></a> <span class='Declare_Member'>rng</span><span class='Delimiter'>; 
</span><a name="LN125"></a>        <a href="tqueue.c.html#LN106"><span class='Ref_to_Struct'>RecordRemapInfo</span></a> <span class='Declare_Member'>rec</span><span class='Delimiter'>; 
</span><a name="LN126"></a>    <span class='Delimiter'>}</span>           <span class='Declare_Member'>u</span><span class='Delimiter'>; 
}; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * DestReceiver object's private contents 
 * 
 * queue and tupledesc are pointers to data supplied by DestReceiver's caller. 
 * The recordhtab and remap info are owned by the DestReceiver and are kept 
 * in mycontext.  tmpcontext is a tuple-lifespan context to hold cruft 
 * created while traversing each tuple to find record subfields. 
 */ 
</span><a name="LN137"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>TQueueDestReceiver</span> 
<span class='Delimiter'>{ 
</span><a name="LN139"></a>    <a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Declare_Member'>pub</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* public fields */ 
</span><a name="LN140"></a>    <a href="../storage/ipc/shm_mq.c.html#LN126"><span class='Ref_to_Struct'>shm_mq_handle</span></a> <span class='Operator'>*</span><span class='Declare_Member'>queue</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* shm_mq to send to */ 
</span><a name="LN141"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Member'>mycontext</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* context containing TQueueDestReceiver */ 
</span><a name="LN142"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Member'>tmpcontext</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* per-tuple context, if needed */ 
</span><a name="LN143"></a>    <a href="../utils/hash/dynahash.c.html#LN192"><span class='Ref_to_Struct'>HTAB</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>recordhtab</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* table of transmitted typmods, if needed */ 
</span><a name="LN144"></a>    <span class='Keyword'>char</span>        <span class='Declare_Member'>mode</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* current message mode */ 
</span><a name="LN145"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Member'>tupledesc</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* current top-level tuple descriptor */ 
</span><a name="LN146"></a>    <a href="tqueue.c.html#LN118"><span class='Ref_to_Struct'>TupleRemapInfo</span></a> <span class='Operator'>**</span><span class='Declare_Member'>field_remapinfo</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* current top-level remap info */ 
</span><a name="LN147"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>TQueueDestReceiver</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Hash table entries for mapping remote to local typmods. 
 */ 
</span><a name="LN152"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>RecordTypmodMap</span> 
<span class='Delimiter'>{ 
</span><a name="LN154"></a>    <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Member'>remotetypmod</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* hash key (must be first!) */ 
</span><a name="LN155"></a>    <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Member'>localtypmod</span><span class='Delimiter'>; 
</span><a name="LN156"></a>} <span class='Declare_Typedef'>RecordTypmodMap</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * TupleQueueReader object's private contents 
 * 
 * queue and tupledesc are pointers to data supplied by reader's caller. 
 * The typmodmap and remap info are owned by the TupleQueueReader and 
 * are kept in mycontext. 
 * 
 * "typedef struct TupleQueueReader TupleQueueReader" is in tqueue.h 
 */ 
</span><a name="LN167"></a><span class='Control'>struct</span> <span class='Declare_Struct'>TupleQueueReader</span> 
<span class='Delimiter'>{ 
</span><a name="LN169"></a>    <a href="../storage/ipc/shm_mq.c.html#LN126"><span class='Ref_to_Struct'>shm_mq_handle</span></a> <span class='Operator'>*</span><span class='Declare_Member'>queue</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* shm_mq to receive from */ 
</span><a name="LN170"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Member'>mycontext</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* context containing TupleQueueReader */ 
</span><a name="LN171"></a>    <a href="../utils/hash/dynahash.c.html#LN192"><span class='Ref_to_Struct'>HTAB</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>typmodmap</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* RecordTypmodMap hashtable, if needed */ 
</span><a name="LN172"></a>    <span class='Keyword'>char</span>        <span class='Declare_Member'>mode</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* current message mode */ 
</span><a name="LN173"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Member'>tupledesc</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* current top-level tuple descriptor */ 
</span><a name="LN174"></a>    <a href="tqueue.c.html#LN118"><span class='Ref_to_Struct'>TupleRemapInfo</span></a> <span class='Operator'>**</span><span class='Declare_Member'>field_remapinfo</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* current top-level remap info */ 
</span><span class='Delimiter'>}; 
</span> 
<span class='Comment_Multi_Line'>/* Local function prototypes */ 
</span><a name="LN178"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>TQExamine</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN137"><span class='Ref_to_Struct'>TQueueDestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tqueue</span><span class='Delimiter'>, 
</span><a name="LN179"></a>          <a href="tqueue.c.html#LN118"><span class='Ref_to_Struct'>TupleRemapInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>remapinfo</span><span class='Delimiter'>, 
</span><a name="LN180"></a>          <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN181"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>TQExamineArray</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN137"><span class='Ref_to_Struct'>TQueueDestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tqueue</span><span class='Delimiter'>, 
</span><a name="LN182"></a>               <a href="tqueue.c.html#LN92"><span class='Ref_to_Struct'>ArrayRemapInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>remapinfo</span><span class='Delimiter'>, 
</span><a name="LN183"></a>               <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN184"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>TQExamineRange</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN137"><span class='Ref_to_Struct'>TQueueDestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tqueue</span><span class='Delimiter'>, 
</span><a name="LN185"></a>               <a href="tqueue.c.html#LN100"><span class='Ref_to_Struct'>RangeRemapInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>remapinfo</span><span class='Delimiter'>, 
</span><a name="LN186"></a>               <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN187"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>TQExamineRecord</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN137"><span class='Ref_to_Struct'>TQueueDestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tqueue</span><span class='Delimiter'>, 
</span><a name="LN188"></a>                <a href="tqueue.c.html#LN106"><span class='Ref_to_Struct'>RecordRemapInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>remapinfo</span><span class='Delimiter'>, 
</span><a name="LN189"></a>                <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN190"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>TQSendRecordInfo</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN137"><span class='Ref_to_Struct'>TQueueDestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tqueue</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, 
</span><a name="LN191"></a>                 <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupledesc</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN192"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>TupleQueueHandleControlMessage</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN167"><span class='Ref_to_Struct'>TupleQueueReader</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>reader</span><span class='Delimiter'>, 
</span><a name="LN193"></a>                               <a href="../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>nbytes</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN194"></a><span class='Keyword'>static </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Prototype'>TupleQueueHandleDataMessage</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN167"><span class='Ref_to_Struct'>TupleQueueReader</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>reader</span><span class='Delimiter'>, 
</span><a name="LN195"></a>                            <a href="../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>nbytes</span><span class='Delimiter'>, </span><a href="../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Parameter'>data</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN196"></a><span class='Keyword'>static </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Prototype'>TQRemapTuple</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN167"><span class='Ref_to_Struct'>TupleQueueReader</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>reader</span><span class='Delimiter'>, 
</span><a name="LN197"></a>             <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupledesc</span><span class='Delimiter'>, 
</span><a name="LN198"></a>             <a href="tqueue.c.html#LN118"><span class='Ref_to_Struct'>TupleRemapInfo</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>field_remapinfo</span><span class='Delimiter'>, 
</span><a name="LN199"></a>             <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tuple</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN200"></a><span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>TQRemap</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN167"><span class='Ref_to_Struct'>TupleQueueReader</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>reader</span><span class='Delimiter'>, </span><a href="tqueue.c.html#LN118"><span class='Ref_to_Struct'>TupleRemapInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>remapinfo</span><span class='Delimiter'>, 
</span><a name="LN201"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>changed</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN202"></a><span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>TQRemapArray</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN167"><span class='Ref_to_Struct'>TupleQueueReader</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>reader</span><span class='Delimiter'>, </span><a href="tqueue.c.html#LN92"><span class='Ref_to_Struct'>ArrayRemapInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>remapinfo</span><span class='Delimiter'>, 
</span><a name="LN203"></a>             <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>changed</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN204"></a><span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>TQRemapRange</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN167"><span class='Ref_to_Struct'>TupleQueueReader</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>reader</span><span class='Delimiter'>, </span><a href="tqueue.c.html#LN100"><span class='Ref_to_Struct'>RangeRemapInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>remapinfo</span><span class='Delimiter'>, 
</span><a name="LN205"></a>             <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>changed</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN206"></a><span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>TQRemapRecord</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN167"><span class='Ref_to_Struct'>TupleQueueReader</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>reader</span><span class='Delimiter'>, </span><a href="tqueue.c.html#LN106"><span class='Ref_to_Struct'>RecordRemapInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>remapinfo</span><span class='Delimiter'>, 
</span><a name="LN207"></a>              <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>changed</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN208"></a><span class='Keyword'>static </span><a href="tqueue.c.html#LN118"><span class='Ref_to_Struct'>TupleRemapInfo</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>BuildTupleRemapInfo</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typid</span><span class='Delimiter'>, </span><a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>mycontext</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN209"></a><span class='Keyword'>static </span><a href="tqueue.c.html#LN118"><span class='Ref_to_Struct'>TupleRemapInfo</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>BuildArrayRemapInfo</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>elemtypid</span><span class='Delimiter'>, 
</span><a name="LN210"></a>                    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>mycontext</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN211"></a><span class='Keyword'>static </span><a href="tqueue.c.html#LN118"><span class='Ref_to_Struct'>TupleRemapInfo</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>BuildRangeRemapInfo</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>rngtypid</span><span class='Delimiter'>, 
</span><a name="LN212"></a>                    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>mycontext</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN213"></a><span class='Keyword'>static </span><a href="tqueue.c.html#LN118"><span class='Ref_to_Struct'>TupleRemapInfo</span></a> <span class='Operator'>**</span><span class='Declare_Prototype'>BuildFieldRemapInfo</span><span class='Parentheses'>(</span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupledesc</span><span class='Delimiter'>, 
</span><a name="LN214"></a>                    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>mycontext</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Receive a tuple from a query, and send it to the designated shm_mq. 
 * 
 * Returns TRUE if successful, FALSE if shm_mq has been detached. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN223"></a><span class='Declare_Function'>tqueueReceiveSlot</span><span class='Parentheses'>(</span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Delimiter'>, </span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>self</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN225"></a>    <a href="tqueue.c.html#LN137"><span class='Ref_to_Struct'>TQueueDestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tqueue</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN137"><span class='Ref_to_Struct'>TQueueDestReceiver</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tqueue.c.html#LN223"><span class='Ref_to_Parameter'>self</span></a><span class='Delimiter'>; 
</span><a name="LN226"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupledesc</span> <span class='Operator'>= </span><a href="tqueue.c.html#LN223"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/tuptable.h.html#LN120"><span class='Ref_to_Member'>tts_tupleDescriptor</span></a><span class='Delimiter'>; 
</span><a name="LN227"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN228"></a>    <a href="../../include/storage/shm_mq.h.html#LN35"><span class='Ref_to_Typedef'>shm_mq_result</span></a> <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If first time through, compute remapping info for the top-level fields. 
     * On later calls, if the tupledesc has changed, set up for the new 
     * tupledesc.  (This is a strange test both because the executor really 
     * shouldn't change the tupledesc, and also because it would be unsafe if 
     * the old tupledesc could be freed and a new one allocated at the same 
     * address.  But since some very old code in printtup.c uses a similar 
     * approach, we adopt it here as well.) 
     * 
     * Here and elsewhere in this module, when replacing remapping info we 
     * pfree the top-level object because that's easy, but we don't bother to 
     * recursively free any substructure.  This would lead to query-lifespan 
     * memory leaks if the mapping info actually changed frequently, but since 
     * we don't expect that to happen, it doesn't seem worth expending code to 
     * prevent it. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN225"><span class='Ref_To_Local'>tqueue</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN145"><span class='Ref_to_Member'>tupledesc</span></a> <span class='Operator'>!= </span><a href="tqueue.c.html#LN226"><span class='Ref_To_Local'>tupledesc</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Is it worth trying to free substructure of the remap tree? */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN225"><span class='Ref_To_Local'>tqueue</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN146"><span class='Ref_to_Member'>field_remapinfo</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN225"><span class='Ref_To_Local'>tqueue</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN146"><span class='Ref_to_Member'>field_remapinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tqueue.c.html#LN225"><span class='Ref_To_Local'>tqueue</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN146"><span class='Ref_to_Member'>field_remapinfo</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN213"><span class='Ref_to_Proto'>BuildFieldRemapInfo</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN226"><span class='Ref_To_Local'>tupledesc</span></a><span class='Delimiter'>, 
</span>                                                      <a href="tqueue.c.html#LN225"><span class='Ref_To_Local'>tqueue</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN141"><span class='Ref_to_Member'>mycontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tqueue.c.html#LN225"><span class='Ref_To_Local'>tqueue</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN145"><span class='Ref_to_Member'>tupledesc</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN226"><span class='Ref_To_Local'>tupledesc</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * When, because of the types being transmitted, no record typmod mapping 
     * can be needed, we can skip a good deal of work. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN225"><span class='Ref_To_Local'>tqueue</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN146"><span class='Ref_to_Member'>field_remapinfo</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN262"></a>        <a href="tqueue.c.html#LN118"><span class='Ref_to_Struct'>TupleRemapInfo</span></a> <span class='Operator'>**</span><span class='Declare_Local'>remapinfo</span> <span class='Operator'>= </span><a href="tqueue.c.html#LN225"><span class='Ref_To_Local'>tqueue</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN146"><span class='Ref_to_Member'>field_remapinfo</span></a><span class='Delimiter'>; 
</span><a name="LN263"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN264"></a>        <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Deform the tuple so we can examine fields, if not done already. */ 
</span>        <a href="../../include/executor/tuptable.h.html#LN168"><span class='Ref_to_Proto'>slot_getallattrs</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN223"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Iterate over each attribute and search it for transient typmods. */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN263"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tqueue.c.html#LN263"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tqueue.c.html#LN226"><span class='Ref_To_Local'>tupledesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; </span><a href="tqueue.c.html#LN263"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Ignore nulls and types that don't need special handling. */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN223"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/tuptable.h.html#LN125"><span class='Ref_to_Member'>tts_isnull</span></a><span class='Delimiter'>[</span><a href="tqueue.c.html#LN263"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>|| </span><a href="tqueue.c.html#LN262"><span class='Ref_To_Local'>remapinfo</span></a><span class='Delimiter'>[</span><a href="tqueue.c.html#LN263"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Switch to temporary memory context to avoid leaking. */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN264"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN225"><span class='Ref_To_Local'>tqueue</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN142"><span class='Ref_to_Member'>tmpcontext</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <a href="tqueue.c.html#LN225"><span class='Ref_To_Local'>tqueue</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN142"><span class='Ref_to_Member'>tmpcontext</span></a> <span class='Operator'>= 
</span>                        <a href="../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN225"><span class='Ref_To_Local'>tqueue</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN141"><span class='Ref_to_Member'>mycontext</span></a><span class='Delimiter'>, 
</span>                                              <span class='String'>"tqueue sender temp context"</span><span class='Delimiter'>, 
</span>                                              <a href="../../include/utils/memutils.h.html#LN164"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="tqueue.c.html#LN264"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN225"><span class='Ref_To_Local'>tqueue</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN142"><span class='Ref_to_Member'>tmpcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* Examine the value. */ 
</span>            <a href="tqueue.c.html#LN178"><span class='Ref_to_Proto'>TQExamine</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN225"><span class='Ref_To_Local'>tqueue</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN262"><span class='Ref_To_Local'>remapinfo</span></a><span class='Delimiter'>[</span><a href="tqueue.c.html#LN263"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="tqueue.c.html#LN223"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/tuptable.h.html#LN124"><span class='Ref_to_Member'>tts_values</span></a><span class='Delimiter'>[</span><a href="tqueue.c.html#LN263"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;tupledesc-&GT;natt... &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* If we used the temp context, reset it and restore prior context. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN264"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN264"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/memutils.h.html#LN73"><span class='Ref_to_Proto'>MemoryContextReset</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN225"><span class='Ref_To_Local'>tqueue</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN142"><span class='Ref_to_Member'>tmpcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* If we entered control mode, switch back to data mode. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN225"><span class='Ref_To_Local'>tqueue</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN144"><span class='Ref_to_Member'>mode</span></a> <span class='Operator'>!= </span><a href="tqueue.c.html#LN60"><span class='Ref_to_Const'>TUPLE_QUEUE_MODE_DATA</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="tqueue.c.html#LN225"><span class='Ref_To_Local'>tqueue</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN144"><span class='Ref_to_Member'>mode</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN60"><span class='Ref_to_Const'>TUPLE_QUEUE_MODE_DATA</span></a><span class='Delimiter'>; 
</span>            <a href="../../include/storage/shm_mq.h.html#LN71"><span class='Ref_to_Proto'>shm_mq_send</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN225"><span class='Ref_To_Local'>tqueue</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN140"><span class='Ref_to_Member'>queue</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tqueue.c.html#LN225"><span class='Ref_To_Local'>tqueue</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN144"><span class='Ref_to_Member'>mode</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if tqueue-&GT;field_remapin... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Send the tuple itself. */ 
</span>    <a href="tqueue.c.html#LN227"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/executor/tuptable.h.html#LN162"><span class='Ref_to_Proto'>ExecMaterializeSlot</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN223"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tqueue.c.html#LN228"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/storage/shm_mq.h.html#LN71"><span class='Ref_to_Proto'>shm_mq_send</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN225"><span class='Ref_To_Local'>tqueue</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN140"><span class='Ref_to_Member'>queue</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN227"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN227"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check for failure. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN228"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><a href="../../include/storage/shm_mq.h.html#LN39"><span class='Ref_to_EnumConst'>SHM_MQ_DETACHED</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN228"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>!= </span><a href="../../include/storage/shm_mq.h.html#LN37"><span class='Ref_to_EnumConst'>SHM_MQ_SUCCESS</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not send tuple to shared-memory queue"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end tqueueReceiveSlot &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Examine the given datum and send any necessary control messages for 
 * transient record types contained in it. 
 * 
 * remapinfo is previously-computed remapping info about the datum's type. 
 * 
 * This function just dispatches based on the remap class. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN330"></a><span class='Declare_Function'>TQExamine</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN137"><span class='Ref_to_Struct'>TQueueDestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tqueue</span><span class='Delimiter'>, </span><a href="tqueue.c.html#LN118"><span class='Ref_to_Struct'>TupleRemapInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>remapinfo</span><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* This is recursive, so it could be driven to stack overflow. */ 
</span>    <a href="../../include/miscadmin.h.html#LN275"><span class='Ref_to_Proto'>check_stack_depth</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN330"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN120"><span class='Ref_to_Member'>remapclass</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="tqueue.c.html#LN85"><span class='Ref_to_EnumConst'>TQUEUE_REMAP_ARRAY</span></a><span class='Operator'>: 
</span>            <a href="tqueue.c.html#LN181"><span class='Ref_to_Proto'>TQExamineArray</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN330"><span class='Ref_to_Parameter'>tqueue</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tqueue.c.html#LN330"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN126"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span><a href="tqueue.c.html#LN123"><span class='Ref_to_Member'>arr</span></a><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="tqueue.c.html#LN86"><span class='Ref_to_EnumConst'>TQUEUE_REMAP_RANGE</span></a><span class='Operator'>: 
</span>            <a href="tqueue.c.html#LN184"><span class='Ref_to_Proto'>TQExamineRange</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN330"><span class='Ref_to_Parameter'>tqueue</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tqueue.c.html#LN330"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN126"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span><a href="tqueue.c.html#LN124"><span class='Ref_to_Member'>rng</span></a><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="tqueue.c.html#LN87"><span class='Ref_to_EnumConst'>TQUEUE_REMAP_RECORD</span></a><span class='Operator'>: 
</span>            <a href="tqueue.c.html#LN187"><span class='Ref_to_Proto'>TQExamineRecord</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN330"><span class='Ref_to_Parameter'>tqueue</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tqueue.c.html#LN330"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN126"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span><a href="tqueue.c.html#LN125"><span class='Ref_to_Member'>rec</span></a><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Examine a record datum and send any necessary control messages for 
 * transient record types contained in it. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN354"></a><span class='Declare_Function'>TQExamineRecord</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN137"><span class='Ref_to_Struct'>TQueueDestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tqueue</span><span class='Delimiter'>, </span><a href="tqueue.c.html#LN106"><span class='Ref_to_Struct'>RecordRemapInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>remapinfo</span><span class='Delimiter'>, 
</span><a name="LN355"></a>                <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN357"></a>    <a href="../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN358"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typid</span><span class='Delimiter'>; 
</span><a name="LN359"></a>    <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>typmod</span><span class='Delimiter'>; 
</span><a name="LN360"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupledesc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Extract type OID and typmod from tuple. */ 
</span>    <a href="tqueue.c.html#LN357"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN258"><span class='Ref_to_Macro'>DatumGetHeapTupleHeader</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tqueue.c.html#LN358"><span class='Ref_To_Local'>typid</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN444"><span class='Ref_to_Macro'>HeapTupleHeaderGetTypeId</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN357"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tqueue.c.html#LN359"><span class='Ref_To_Local'>typmod</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN454"><span class='Ref_to_Macro'>HeapTupleHeaderGetTypMod</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN357"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If first time through, or if this isn't the same composite type as last 
     * time, consider sending a control message, and then look up the 
     * necessary information for examining the fields. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN358"><span class='Ref_To_Local'>typid</span></a> <span class='Operator'>!= </span><a href="tqueue.c.html#LN354"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN109"><span class='Ref_to_Member'>rectypid</span></a> <span class='Operator'>|| </span><a href="tqueue.c.html#LN359"><span class='Ref_To_Local'>typmod</span></a> <span class='Operator'>!= </span><a href="tqueue.c.html#LN354"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN110"><span class='Ref_to_Member'>rectypmod</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Free any old data. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN354"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN114"><span class='Ref_to_Member'>tupledesc</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="../../include/access/tupdesc.h.html#LN95"><span class='Ref_to_Proto'>FreeTupleDesc</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN354"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN114"><span class='Ref_to_Member'>tupledesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Is it worth trying to free substructure of the remap tree? */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN354"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN115"><span class='Ref_to_Member'>field_remap</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN354"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN115"><span class='Ref_to_Member'>field_remap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Look up tuple descriptor in typcache. */ 
</span>        <a href="tqueue.c.html#LN360"><span class='Ref_To_Local'>tupledesc</span></a> <span class='Operator'>= </span><a href="../../include/utils/typcache.h.html#LN151"><span class='Ref_to_Proto'>lookup_rowtype_tupdesc</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN358"><span class='Ref_To_Local'>typid</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN359"><span class='Ref_To_Local'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If this is a transient record type, send the tupledesc in a control 
         * message.  (TQSendRecordInfo is smart enough to do this only once 
         * per typmod.) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN358"><span class='Ref_To_Local'>typid</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN679"><span class='Ref_to_Const'>RECORDOID</span></a><span class='Parentheses'>) 
</span>            <a href="tqueue.c.html#LN190"><span class='Ref_to_Proto'>TQSendRecordInfo</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN354"><span class='Ref_to_Parameter'>tqueue</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN359"><span class='Ref_To_Local'>typmod</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN360"><span class='Ref_To_Local'>tupledesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Figure out whether fields need recursive processing. */ 
</span>        <a href="tqueue.c.html#LN354"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN115"><span class='Ref_to_Member'>field_remap</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN213"><span class='Ref_to_Proto'>BuildFieldRemapInfo</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN360"><span class='Ref_To_Local'>tupledesc</span></a><span class='Delimiter'>, 
</span>                                                     <a href="tqueue.c.html#LN354"><span class='Ref_to_Parameter'>tqueue</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN141"><span class='Ref_to_Member'>mycontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN354"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN115"><span class='Ref_to_Member'>field_remap</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * We need to inspect the record contents, so save a copy of the 
             * tupdesc.  (We could possibly just reference the typcache's 
             * copy, but then it's problematic when to release the refcount.) 
             */ 
</span><a name="LN402"></a>            <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN354"><span class='Ref_to_Parameter'>tqueue</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN141"><span class='Ref_to_Member'>mycontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="tqueue.c.html#LN354"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN114"><span class='Ref_to_Member'>tupledesc</span></a> <span class='Operator'>= </span><a href="../../include/access/tupdesc.h.html#LN88"><span class='Ref_to_Proto'>CreateTupleDescCopy</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN360"><span class='Ref_To_Local'>tupledesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN402"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* No fields of the record require remapping. */ 
</span>            <a href="tqueue.c.html#LN354"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN114"><span class='Ref_to_Member'>tupledesc</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="tqueue.c.html#LN354"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN109"><span class='Ref_to_Member'>rectypid</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN358"><span class='Ref_To_Local'>typid</span></a><span class='Delimiter'>; 
</span>        <a href="tqueue.c.html#LN354"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN110"><span class='Ref_to_Member'>rectypmod</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN359"><span class='Ref_To_Local'>typmod</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Release reference count acquired by lookup_rowtype_tupdesc. */ 
</span>        <a href="../../include/access/tupdesc.h.html#LN98"><span class='Ref_to_Proto'>DecrTupleDescRefCount</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN360"><span class='Ref_To_Local'>tupledesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if typid!=remapinfo-&GT;rec... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If field remapping is required, deform the tuple and examine each 
     * field. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN354"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN115"><span class='Ref_to_Member'>field_remap</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN425"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>values</span><span class='Delimiter'>; 
</span><a name="LN426"></a>        <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN427"></a>        <a href="../../include/access/htup.h.html#LN61"><span class='Ref_to_Struct'>HeapTupleData</span></a> <span class='Declare_Local'>tdata</span><span class='Delimiter'>; 
</span><a name="LN428"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Deform the tuple so we can check each column within. */ 
</span>        <a href="tqueue.c.html#LN360"><span class='Ref_To_Local'>tupledesc</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN354"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN114"><span class='Ref_to_Member'>tupledesc</span></a><span class='Delimiter'>; 
</span>        <a href="tqueue.c.html#LN425"><span class='Ref_To_Local'>values</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN360"><span class='Ref_To_Local'>tupledesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="tqueue.c.html#LN426"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN360"><span class='Ref_To_Local'>tupledesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="tqueue.c.html#LN427"><span class='Ref_To_Local'>tdata</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN438"><span class='Ref_to_Macro'>HeapTupleHeaderGetDatumLength</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN357"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/storage/itemptr.h.html#LN148"><span class='Ref_to_Macro'>ItemPointerSetInvalid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN427"><span class='Ref_To_Local'>tdata</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="tqueue.c.html#LN427"><span class='Ref_To_Local'>tdata</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="tqueue.c.html#LN427"><span class='Ref_To_Local'>tdata</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN357"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>; 
</span>        <a href="../../include/access/htup_details.h.html#LN813"><span class='Ref_to_Proto'>heap_deform_tuple</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tqueue.c.html#LN427"><span class='Ref_To_Local'>tdata</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN360"><span class='Ref_To_Local'>tupledesc</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN425"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN426"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Recursively check each interesting non-NULL attribute. */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN428"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tqueue.c.html#LN428"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tqueue.c.html#LN360"><span class='Ref_To_Local'>tupledesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; </span><a href="tqueue.c.html#LN428"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tqueue.c.html#LN426"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>[</span><a href="tqueue.c.html#LN428"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>&& </span><a href="tqueue.c.html#LN354"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN115"><span class='Ref_to_Member'>field_remap</span></a><span class='Delimiter'>[</span><a href="tqueue.c.html#LN428"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                <a href="tqueue.c.html#LN178"><span class='Ref_to_Proto'>TQExamine</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN354"><span class='Ref_to_Parameter'>tqueue</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN354"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN115"><span class='Ref_to_Member'>field_remap</span></a><span class='Delimiter'>[</span><a href="tqueue.c.html#LN428"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="tqueue.c.html#LN425"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="tqueue.c.html#LN428"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Need not clean up, since we're in a short-lived context. */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if remapinfo-&GT;field_rema... &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end TQExamineRecord &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Examine an array datum and send any necessary control messages for 
 * transient record types contained in it. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN456"></a><span class='Declare_Function'>TQExamineArray</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN137"><span class='Ref_to_Struct'>TQueueDestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tqueue</span><span class='Delimiter'>, </span><a href="tqueue.c.html#LN92"><span class='Ref_to_Struct'>ArrayRemapInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>remapinfo</span><span class='Delimiter'>, 
</span><a name="LN457"></a>               <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN459"></a>    <a href="../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>arr</span> <span class='Operator'>= </span><a href="../../include/utils/array.h.html#LN241"><span class='Ref_to_Macro'>DatumGetArrayTypeP</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN460"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typid</span> <span class='Operator'>= </span><a href="../../include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN459"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN461"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>elem_values</span><span class='Delimiter'>; 
</span><a name="LN462"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>elem_nulls</span><span class='Delimiter'>; 
</span><a name="LN463"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>num_elems</span><span class='Delimiter'>; 
</span><a name="LN464"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Deconstruct the array. */ 
</span>    <a href="../../include/utils/array.h.html#LN382"><span class='Ref_to_Proto'>deconstruct_array</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN459"><span class='Ref_To_Local'>arr</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN460"><span class='Ref_To_Local'>typid</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN456"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN94"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>, 
</span>                      <a href="tqueue.c.html#LN456"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN95"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN456"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN96"><span class='Ref_to_Member'>typalign</span></a><span class='Delimiter'>, 
</span>                      <span class='Operator'>&</span><a href="tqueue.c.html#LN461"><span class='Ref_To_Local'>elem_values</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tqueue.c.html#LN462"><span class='Ref_To_Local'>elem_nulls</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tqueue.c.html#LN463"><span class='Ref_To_Local'>num_elems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Examine each element. */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN464"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tqueue.c.html#LN464"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tqueue.c.html#LN463"><span class='Ref_To_Local'>num_elems</span></a><span class='Delimiter'>; </span><a href="tqueue.c.html#LN464"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tqueue.c.html#LN462"><span class='Ref_To_Local'>elem_nulls</span></a><span class='Delimiter'>[</span><a href="tqueue.c.html#LN464"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <a href="tqueue.c.html#LN178"><span class='Ref_to_Proto'>TQExamine</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN456"><span class='Ref_to_Parameter'>tqueue</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN456"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN97"><span class='Ref_to_Member'>element_remap</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN461"><span class='Ref_To_Local'>elem_values</span></a><span class='Delimiter'>[</span><a href="tqueue.c.html#LN464"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end TQExamineArray &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Examine a range datum and send any necessary control messages for 
 * transient record types contained in it. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN484"></a><span class='Declare_Function'>TQExamineRange</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN137"><span class='Ref_to_Struct'>TQueueDestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tqueue</span><span class='Delimiter'>, </span><a href="tqueue.c.html#LN100"><span class='Ref_to_Struct'>RangeRemapInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>remapinfo</span><span class='Delimiter'>, 
</span><a name="LN485"></a>               <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN487"></a>    <a href="../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>range</span> <span class='Operator'>= </span><a href="../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN488"></a>    <a href="../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a>  <span class='Declare_Local'>lower</span><span class='Delimiter'>; 
</span><a name="LN489"></a>    <a href="../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a>  <span class='Declare_Local'>upper</span><span class='Delimiter'>; 
</span><a name="LN490"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>empty</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Extract the lower and upper bounds. */ 
</span>    <a href="../../include/utils/rangetypes.h.html#LN123"><span class='Ref_to_Proto'>range_deserialize</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN484"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN102"><span class='Ref_to_Member'>typcache</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN487"><span class='Ref_To_Local'>range</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tqueue.c.html#LN488"><span class='Ref_To_Local'>lower</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tqueue.c.html#LN489"><span class='Ref_To_Local'>upper</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tqueue.c.html#LN490"><span class='Ref_To_Local'>empty</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Nothing to do for an empty range. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN490"><span class='Ref_To_Local'>empty</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Examine each bound, if present. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tqueue.c.html#LN489"><span class='Ref_To_Local'>upper</span></a><span class='Operator'>.</span><a href="../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a><span class='Parentheses'>) 
</span>        <a href="tqueue.c.html#LN178"><span class='Ref_to_Proto'>TQExamine</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN484"><span class='Ref_to_Parameter'>tqueue</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN484"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN103"><span class='Ref_to_Member'>bound_remap</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN489"><span class='Ref_To_Local'>upper</span></a><span class='Operator'>.</span><a href="../../include/utils/rangetypes.h.html#LN61"><span class='Ref_to_Member'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tqueue.c.html#LN488"><span class='Ref_To_Local'>lower</span></a><span class='Operator'>.</span><a href="../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a><span class='Parentheses'>) 
</span>        <a href="tqueue.c.html#LN178"><span class='Ref_to_Proto'>TQExamine</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN484"><span class='Ref_to_Parameter'>tqueue</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN484"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN103"><span class='Ref_to_Member'>bound_remap</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN488"><span class='Ref_To_Local'>lower</span></a><span class='Operator'>.</span><a href="../../include/utils/rangetypes.h.html#LN61"><span class='Ref_to_Member'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end TQExamineRange &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Send tuple descriptor information for a transient typmod, unless we've 
 * already done so previously. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN511"></a><span class='Declare_Function'>TQSendRecordInfo</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN137"><span class='Ref_to_Struct'>TQueueDestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tqueue</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, </span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupledesc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN513"></a>    <a href="../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN514"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span><span class='Delimiter'>; 
</span><a name="LN515"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Initialize hash table if not done yet. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN511"><span class='Ref_to_Parameter'>tqueue</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN143"><span class='Ref_to_Member'>recordhtab</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN520"></a>        <a href="../../include/utils/hsearch.h.html#LN64"><span class='Ref_to_Struct'>HASHCTL</span></a>     <span class='Declare_Local'>ctl</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tqueue.c.html#LN520"><span class='Ref_To_Local'>ctl</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN520"><span class='Ref_To_Local'>ctl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Hash table entries are just typmods */ 
</span>        <a href="tqueue.c.html#LN520"><span class='Ref_To_Local'>ctl</span></a><span class='Operator'>.</span><a href="../../include/utils/hsearch.h.html#LN71"><span class='Ref_to_Member'>keysize</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tqueue.c.html#LN520"><span class='Ref_To_Local'>ctl</span></a><span class='Operator'>.</span><a href="../../include/utils/hsearch.h.html#LN72"><span class='Ref_to_Member'>entrysize</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tqueue.c.html#LN520"><span class='Ref_To_Local'>ctl</span></a><span class='Operator'>.</span><a href="../../include/utils/hsearch.h.html#LN77"><span class='Ref_to_Member'>hcxt</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN511"><span class='Ref_to_Parameter'>tqueue</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN141"><span class='Ref_to_Member'>mycontext</span></a><span class='Delimiter'>; 
</span>        <a href="tqueue.c.html#LN511"><span class='Ref_to_Parameter'>tqueue</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN143"><span class='Ref_to_Member'>recordhtab</span></a> <span class='Operator'>= </span><a href="../../include/utils/hsearch.h.html#LN121"><span class='Ref_to_Proto'>hash_create</span></a><span class='Parentheses'>(</span><span class='String'>"tqueue sender record type hashtable"</span><span class='Delimiter'>, 
</span>                                         <span class='Number'>100</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tqueue.c.html#LN520"><span class='Ref_To_Local'>ctl</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../include/utils/hsearch.h.html#LN86"><span class='Ref_to_Const'>HASH_ELEM</span></a> <span class='Operator'>| </span><a href="../../include/utils/hsearch.h.html#LN87"><span class='Ref_to_Const'>HASH_BLOBS</span></a> <span class='Operator'>| </span><a href="../../include/utils/hsearch.h.html#LN92"><span class='Ref_to_Const'>HASH_CONTEXT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Have we already seen this record type?  If not, must report it. */ 
</span>    <a href="../../include/utils/hsearch.h.html#LN125"><span class='Ref_to_Proto'>hash_search</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN511"><span class='Ref_to_Parameter'>tqueue</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN143"><span class='Ref_to_Member'>recordhtab</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tqueue.c.html#LN511"><span class='Ref_to_Parameter'>typmod</span></a><span class='Delimiter'>, </span><a href="../../include/utils/hsearch.h.html#LN105"><span class='Ref_to_EnumConst'>HASH_ENTER</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tqueue.c.html#LN514"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN514"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN22"><span class='Ref_to_Const'>DEBUG3</span></a><span class='Delimiter'>, </span><span class='String'>"sending tqueue control message for record typmod %d"</span><span class='Delimiter'>, </span><a href="tqueue.c.html#LN511"><span class='Ref_to_Parameter'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If message queue is in data mode, switch to control mode. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN511"><span class='Ref_to_Parameter'>tqueue</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN144"><span class='Ref_to_Member'>mode</span></a> <span class='Operator'>!= </span><a href="tqueue.c.html#LN59"><span class='Ref_to_Const'>TUPLE_QUEUE_MODE_CONTROL</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tqueue.c.html#LN511"><span class='Ref_to_Parameter'>tqueue</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN144"><span class='Ref_to_Member'>mode</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN59"><span class='Ref_to_Const'>TUPLE_QUEUE_MODE_CONTROL</span></a><span class='Delimiter'>; 
</span>        <a href="../../include/storage/shm_mq.h.html#LN71"><span class='Ref_to_Proto'>shm_mq_send</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN511"><span class='Ref_to_Parameter'>tqueue</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN140"><span class='Ref_to_Member'>queue</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tqueue.c.html#LN511"><span class='Ref_to_Parameter'>tqueue</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN144"><span class='Ref_to_Member'>mode</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Assemble a control message. */ 
</span>    <a href="../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tqueue.c.html#LN513"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tqueue.c.html#LN513"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="tqueue.c.html#LN511"><span class='Ref_to_Parameter'>typmod</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tqueue.c.html#LN513"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="tqueue.c.html#LN511"><span class='Ref_to_Parameter'>tupledesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tqueue.c.html#LN513"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="tqueue.c.html#LN511"><span class='Ref_to_Parameter'>tupledesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN78"><span class='Ref_to_Member'>tdhasoid</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN515"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tqueue.c.html#LN515"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tqueue.c.html#LN511"><span class='Ref_to_Parameter'>tupledesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; </span><a href="tqueue.c.html#LN515"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tqueue.c.html#LN513"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tqueue.c.html#LN511"><span class='Ref_to_Parameter'>tupledesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="tqueue.c.html#LN515"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                               <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span>FormData_pg_attribute<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Send control message. */ 
</span>    <a href="../../include/storage/shm_mq.h.html#LN71"><span class='Ref_to_Proto'>shm_mq_send</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN511"><span class='Ref_to_Parameter'>tqueue</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN140"><span class='Ref_to_Member'>queue</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN513"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN513"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We assume it's OK to leak buf because we're in a short-lived context. */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end TQSendRecordInfo &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Prepare to receive tuples from executor. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN567"></a><span class='Declare_Function'>tqueueStartupReceiver</span><span class='Parentheses'>(</span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>self</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>operation</span><span class='Delimiter'>, </span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>typeinfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* do nothing */ 
</span><span class='Delimiter'>} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Clean up at end of an executor run 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN576"></a><span class='Declare_Function'>tqueueShutdownReceiver</span><span class='Parentheses'>(</span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>self</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN578"></a>    <a href="tqueue.c.html#LN137"><span class='Ref_to_Struct'>TQueueDestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tqueue</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN137"><span class='Ref_to_Struct'>TQueueDestReceiver</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tqueue.c.html#LN576"><span class='Ref_to_Parameter'>self</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/storage/shm_mq.h.html#LN65"><span class='Ref_to_Proto'>shm_mq_detach</span></a><span class='Parentheses'>(</span><a href="../../include/storage/shm_mq.h.html#LN68"><span class='Ref_to_Proto'>shm_mq_get_queue</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN578"><span class='Ref_To_Local'>tqueue</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN140"><span class='Ref_to_Member'>queue</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Destroy receiver when done with it 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN587"></a><span class='Declare_Function'>tqueueDestroyReceiver</span><span class='Parentheses'>(</span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>self</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN589"></a>    <a href="tqueue.c.html#LN137"><span class='Ref_to_Struct'>TQueueDestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tqueue</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN137"><span class='Ref_to_Struct'>TQueueDestReceiver</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tqueue.c.html#LN587"><span class='Ref_to_Parameter'>self</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN589"><span class='Ref_To_Local'>tqueue</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN142"><span class='Ref_to_Member'>tmpcontext</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN589"><span class='Ref_To_Local'>tqueue</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN142"><span class='Ref_to_Member'>tmpcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN589"><span class='Ref_To_Local'>tqueue</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN143"><span class='Ref_to_Member'>recordhtab</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/hsearch.h.html#LN123"><span class='Ref_to_Proto'>hash_destroy</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN589"><span class='Ref_To_Local'>tqueue</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN143"><span class='Ref_to_Member'>recordhtab</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Is it worth trying to free substructure of the remap tree? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN589"><span class='Ref_To_Local'>tqueue</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN146"><span class='Ref_to_Member'>field_remapinfo</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN589"><span class='Ref_To_Local'>tqueue</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN146"><span class='Ref_to_Member'>field_remapinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN587"><span class='Ref_to_Parameter'>self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Create a DestReceiver that writes tuples to a tuple queue. 
 */ 
</span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>* 
</span><a name="LN605"></a><span class='Declare_Function'>CreateTupleQueueDestReceiver</span><span class='Parentheses'>(</span><a href="../storage/ipc/shm_mq.c.html#LN126"><span class='Ref_to_Struct'>shm_mq_handle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>handle</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN607"></a>    <a href="tqueue.c.html#LN137"><span class='Ref_to_Struct'>TQueueDestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Local'>self</span><span class='Delimiter'>; 
</span> 
    <a href="tqueue.c.html#LN607"><span class='Ref_To_Local'>self</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN137"><span class='Ref_to_Struct'>TQueueDestReceiver</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN137"><span class='Ref_to_Struct'>TQueueDestReceiver</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="tqueue.c.html#LN607"><span class='Ref_To_Local'>self</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN139"><span class='Ref_to_Member'>pub</span></a><span class='Operator'>.</span><a href="../../include/tcop/dest.h.html#LN117"><span class='Ref_to_Member'>receiveSlot</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN222"><span class='Ref_to_Func'>tqueueReceiveSlot</span></a><span class='Delimiter'>; 
</span>    <a href="tqueue.c.html#LN607"><span class='Ref_To_Local'>self</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN139"><span class='Ref_to_Member'>pub</span></a><span class='Operator'>.</span><a href="../../include/tcop/dest.h.html#LN120"><span class='Ref_to_Member'>rStartup</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN566"><span class='Ref_to_Func'>tqueueStartupReceiver</span></a><span class='Delimiter'>; 
</span>    <a href="tqueue.c.html#LN607"><span class='Ref_To_Local'>self</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN139"><span class='Ref_to_Member'>pub</span></a><span class='Operator'>.</span><a href="../../include/tcop/dest.h.html#LN123"><span class='Ref_to_Member'>rShutdown</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN575"><span class='Ref_to_Func'>tqueueShutdownReceiver</span></a><span class='Delimiter'>; 
</span>    <a href="tqueue.c.html#LN607"><span class='Ref_To_Local'>self</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN139"><span class='Ref_to_Member'>pub</span></a><span class='Operator'>.</span><a href="../../include/tcop/dest.h.html#LN125"><span class='Ref_to_Member'>rDestroy</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN586"><span class='Ref_to_Func'>tqueueDestroyReceiver</span></a><span class='Delimiter'>; 
</span>    <a href="tqueue.c.html#LN607"><span class='Ref_To_Local'>self</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN139"><span class='Ref_to_Member'>pub</span></a><span class='Operator'>.</span><a href="../../include/tcop/dest.h.html#LN127"><span class='Ref_to_Member'>mydest</span></a> <span class='Operator'>= </span><a href="../../include/tcop/dest.h.html#LN98"><span class='Ref_to_EnumConst'>DestTupleQueue</span></a><span class='Delimiter'>; 
</span>    <a href="tqueue.c.html#LN607"><span class='Ref_To_Local'>self</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN140"><span class='Ref_to_Member'>queue</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN605"><span class='Ref_to_Parameter'>handle</span></a><span class='Delimiter'>; 
</span>    <a href="tqueue.c.html#LN607"><span class='Ref_To_Local'>self</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN141"><span class='Ref_to_Member'>mycontext</span></a> <span class='Operator'>= </span><a href="../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>; 
</span>    <a href="tqueue.c.html#LN607"><span class='Ref_To_Local'>self</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN142"><span class='Ref_to_Member'>tmpcontext</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="tqueue.c.html#LN607"><span class='Ref_To_Local'>self</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN143"><span class='Ref_to_Member'>recordhtab</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="tqueue.c.html#LN607"><span class='Ref_To_Local'>self</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN144"><span class='Ref_to_Member'>mode</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN60"><span class='Ref_to_Const'>TUPLE_QUEUE_MODE_DATA</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Top-level tupledesc is not known yet */ 
</span>    <a href="tqueue.c.html#LN607"><span class='Ref_To_Local'>self</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN145"><span class='Ref_to_Member'>tupledesc</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="tqueue.c.html#LN607"><span class='Ref_To_Local'>self</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN146"><span class='Ref_to_Member'>field_remapinfo</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tqueue.c.html#LN607"><span class='Ref_To_Local'>self</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CreateTupleQueueDestReceiver &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Create a tuple queue reader. 
 */ 
</span><a href="tqueue.c.html#LN167"><span class='Ref_to_Struct'>TupleQueueReader</span></a> <span class='Operator'>* 
</span><a name="LN632"></a><span class='Declare_Function'>CreateTupleQueueReader</span><span class='Parentheses'>(</span><a href="../storage/ipc/shm_mq.c.html#LN126"><span class='Ref_to_Struct'>shm_mq_handle</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>handle</span><span class='Delimiter'>, </span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupledesc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN634"></a>    <a href="tqueue.c.html#LN167"><span class='Ref_to_Struct'>TupleQueueReader</span></a> <span class='Operator'>*</span><span class='Declare_Local'>reader</span> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN167"><span class='Ref_to_Struct'>TupleQueueReader</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="tqueue.c.html#LN634"><span class='Ref_To_Local'>reader</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN169"><span class='Ref_to_Member'>queue</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN632"><span class='Ref_to_Parameter'>handle</span></a><span class='Delimiter'>; 
</span>    <a href="tqueue.c.html#LN634"><span class='Ref_To_Local'>reader</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN170"><span class='Ref_to_Member'>mycontext</span></a> <span class='Operator'>= </span><a href="../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>; 
</span>    <a href="tqueue.c.html#LN634"><span class='Ref_To_Local'>reader</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN171"><span class='Ref_to_Member'>typmodmap</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="tqueue.c.html#LN634"><span class='Ref_To_Local'>reader</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN172"><span class='Ref_to_Member'>mode</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN60"><span class='Ref_to_Const'>TUPLE_QUEUE_MODE_DATA</span></a><span class='Delimiter'>; 
</span>    <a href="tqueue.c.html#LN634"><span class='Ref_To_Local'>reader</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN173"><span class='Ref_to_Member'>tupledesc</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN632"><span class='Ref_to_Parameter'>tupledesc</span></a><span class='Delimiter'>; 
</span>    <a href="tqueue.c.html#LN634"><span class='Ref_To_Local'>reader</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN174"><span class='Ref_to_Member'>field_remapinfo</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN213"><span class='Ref_to_Proto'>BuildFieldRemapInfo</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN632"><span class='Ref_to_Parameter'>tupledesc</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN634"><span class='Ref_To_Local'>reader</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN170"><span class='Ref_to_Member'>mycontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="tqueue.c.html#LN634"><span class='Ref_To_Local'>reader</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Destroy a tuple queue reader. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN650"></a><span class='Declare_Function'>DestroyTupleQueueReader</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN167"><span class='Ref_to_Struct'>TupleQueueReader</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>reader</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../include/storage/shm_mq.h.html#LN65"><span class='Ref_to_Proto'>shm_mq_detach</span></a><span class='Parentheses'>(</span><a href="../../include/storage/shm_mq.h.html#LN68"><span class='Ref_to_Proto'>shm_mq_get_queue</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN650"><span class='Ref_to_Parameter'>reader</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN169"><span class='Ref_to_Member'>queue</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN650"><span class='Ref_to_Parameter'>reader</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN171"><span class='Ref_to_Member'>typmodmap</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/hsearch.h.html#LN123"><span class='Ref_to_Proto'>hash_destroy</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN650"><span class='Ref_to_Parameter'>reader</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN171"><span class='Ref_to_Member'>typmodmap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Is it worth trying to free substructure of the remap tree? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN650"><span class='Ref_to_Parameter'>reader</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN174"><span class='Ref_to_Member'>field_remapinfo</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN650"><span class='Ref_to_Parameter'>reader</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN174"><span class='Ref_to_Member'>field_remapinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN650"><span class='Ref_to_Parameter'>reader</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Fetch a tuple from a tuple queue reader. 
 * 
 * The return value is NULL if there are no remaining tuples or if 
 * nowait = true and no tuple is ready to return.  *done, if not NULL, 
 * is set to true when there are no remaining tuples and otherwise to false. 
 * 
 * The returned tuple, if any, is allocated in CurrentMemoryContext. 
 * That should be a short-lived (tuple-lifespan) context, because we are 
 * pretty cavalier about leaking memory in that context if we have to do 
 * tuple remapping. 
 * 
 * Even when shm_mq_receive() returns SHM_MQ_WOULD_BLOCK, this can still 
 * accumulate bytes from a partially-read message, so it's useful to call 
 * this with nowait = true even if nothing is returned. 
 */ 
</span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> 
<a name="LN678"></a><span class='Declare_Function'>TupleQueueReaderNext</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN167"><span class='Ref_to_Struct'>TupleQueueReader</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>reader</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>nowait</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>done</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN680"></a>    <a href="../../include/storage/shm_mq.h.html#LN35"><span class='Ref_to_Typedef'>shm_mq_result</span></a> <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN678"><span class='Ref_to_Parameter'>done</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="tqueue.c.html#LN678"><span class='Ref_to_Parameter'>done</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN687"></a>        <a href="../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>nbytes</span><span class='Delimiter'>; 
</span><a name="LN688"></a>        <span class='Keyword'>void</span>       <span class='Operator'>*</span><span class='Declare_Local'>data</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Attempt to read a message. */ 
</span>        <a href="tqueue.c.html#LN680"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/storage/shm_mq.h.html#LN75"><span class='Ref_to_Proto'>shm_mq_receive</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN678"><span class='Ref_to_Parameter'>reader</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN169"><span class='Ref_to_Member'>queue</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tqueue.c.html#LN687"><span class='Ref_To_Local'>nbytes</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tqueue.c.html#LN688"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN678"><span class='Ref_to_Parameter'>nowait</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* If queue is detached, set *done and return NULL. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN680"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><a href="../../include/storage/shm_mq.h.html#LN39"><span class='Ref_to_EnumConst'>SHM_MQ_DETACHED</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN678"><span class='Ref_to_Parameter'>done</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Operator'>*</span><a href="tqueue.c.html#LN678"><span class='Ref_to_Parameter'>done</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* In non-blocking mode, bail out if no message ready yet. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN680"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><a href="../../include/storage/shm_mq.h.html#LN38"><span class='Ref_to_EnumConst'>SHM_MQ_WOULD_BLOCK</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN680"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><a href="../../include/storage/shm_mq.h.html#LN37"><span class='Ref_to_EnumConst'>SHM_MQ_SUCCESS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We got a message (see message spec at top of file).  Process it. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN687"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Mode switch message. */ 
</span>            <a href="tqueue.c.html#LN678"><span class='Ref_to_Parameter'>reader</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN172"><span class='Ref_to_Member'>mode</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tqueue.c.html#LN688"><span class='Ref_To_Local'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN678"><span class='Ref_to_Parameter'>reader</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN172"><span class='Ref_to_Member'>mode</span></a> <span class='Operator'>== </span><a href="tqueue.c.html#LN60"><span class='Ref_to_Const'>TUPLE_QUEUE_MODE_DATA</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Tuple data. */ 
</span>            <span class='Control'>return</span> <a href="tqueue.c.html#LN194"><span class='Ref_to_Proto'>TupleQueueHandleDataMessage</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN678"><span class='Ref_to_Parameter'>reader</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN687"><span class='Ref_To_Local'>nbytes</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN688"><span class='Ref_To_Local'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN678"><span class='Ref_to_Parameter'>reader</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN172"><span class='Ref_to_Member'>mode</span></a> <span class='Operator'>== </span><a href="tqueue.c.html#LN59"><span class='Ref_to_Const'>TUPLE_QUEUE_MODE_CONTROL</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Control message, describing a transient record type. */ 
</span>            <a href="tqueue.c.html#LN192"><span class='Ref_to_Proto'>TupleQueueHandleControlMessage</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN678"><span class='Ref_to_Parameter'>reader</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN687"><span class='Ref_To_Local'>nbytes</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN688"><span class='Ref_To_Local'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized tqueue mode: %d"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="tqueue.c.html#LN678"><span class='Ref_to_Parameter'>reader</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN172"><span class='Ref_to_Member'>mode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end TupleQueueReaderNext &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Handle a data message - that is, a tuple - from the remote side. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> 
<a name="LN733"></a><span class='Declare_Function'>TupleQueueHandleDataMessage</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN167"><span class='Ref_to_Struct'>TupleQueueReader</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>reader</span><span class='Delimiter'>, 
</span><a name="LN734"></a>                            <a href="../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>nbytes</span><span class='Delimiter'>, 
</span><a name="LN735"></a>                            <a href="../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Parameter'>data</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN737"></a>    <a href="../../include/access/htup.h.html#LN61"><span class='Ref_to_Struct'>HeapTupleData</span></a> <span class='Declare_Local'>htup</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set up a dummy HeapTupleData pointing to the data from the shm_mq 
     * (which had better be sufficiently aligned). 
     */ 
</span>    <a href="../../include/storage/itemptr.h.html#LN148"><span class='Ref_to_Macro'>ItemPointerSetInvalid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tqueue.c.html#LN737"><span class='Ref_To_Local'>htup</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tqueue.c.html#LN737"><span class='Ref_To_Local'>htup</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <a href="tqueue.c.html#LN737"><span class='Ref_To_Local'>htup</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN734"><span class='Ref_to_Parameter'>nbytes</span></a><span class='Delimiter'>; 
</span>    <a href="tqueue.c.html#LN737"><span class='Ref_To_Local'>htup</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN735"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Either just copy the data into a regular palloc'd tuple, or remap it, 
     * as required. 
     */ 
</span>    <span class='Control'>return</span> <a href="tqueue.c.html#LN196"><span class='Ref_to_Proto'>TQRemapTuple</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN733"><span class='Ref_to_Parameter'>reader</span></a><span class='Delimiter'>, 
</span>                        <a href="tqueue.c.html#LN733"><span class='Ref_to_Parameter'>reader</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN173"><span class='Ref_to_Member'>tupledesc</span></a><span class='Delimiter'>, 
</span>                        <a href="tqueue.c.html#LN733"><span class='Ref_to_Parameter'>reader</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN174"><span class='Ref_to_Member'>field_remapinfo</span></a><span class='Delimiter'>, 
</span>                        <span class='Operator'>&</span><a href="tqueue.c.html#LN737"><span class='Ref_To_Local'>htup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end TupleQueueHandleDataMessage &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Copy the given tuple, remapping any transient typmods contained in it. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> 
<a name="LN762"></a><span class='Declare_Function'>TQRemapTuple</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN167"><span class='Ref_to_Struct'>TupleQueueReader</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>reader</span><span class='Delimiter'>, 
</span><a name="LN763"></a>             <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupledesc</span><span class='Delimiter'>, 
</span><a name="LN764"></a>             <a href="tqueue.c.html#LN118"><span class='Ref_to_Struct'>TupleRemapInfo</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>field_remapinfo</span><span class='Delimiter'>, 
</span><a name="LN765"></a>             <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tuple</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN767"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>values</span><span class='Delimiter'>; 
</span><a name="LN768"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN769"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>changed</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN770"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If no remapping is necessary, just copy the tuple into a single 
     * palloc'd chunk, as caller will expect. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN764"><span class='Ref_to_Parameter'>field_remapinfo</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../access/common/heaptuple.c.html#LN606"><span class='Ref_to_Func'>heap_copytuple</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN765"><span class='Ref_to_Parameter'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Deform tuple so we can remap record typmods for individual attrs. */ 
</span>    <a href="tqueue.c.html#LN767"><span class='Ref_To_Local'>values</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN763"><span class='Ref_to_Parameter'>tupledesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="tqueue.c.html#LN768"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN763"><span class='Ref_to_Parameter'>tupledesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/htup_details.h.html#LN813"><span class='Ref_to_Proto'>heap_deform_tuple</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN765"><span class='Ref_to_Parameter'>tuple</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN763"><span class='Ref_to_Parameter'>tupledesc</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN767"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN768"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Recursively process each interesting non-NULL attribute. */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN770"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tqueue.c.html#LN770"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tqueue.c.html#LN763"><span class='Ref_to_Parameter'>tupledesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; </span><a href="tqueue.c.html#LN770"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN768"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>[</span><a href="tqueue.c.html#LN770"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>|| </span><a href="tqueue.c.html#LN764"><span class='Ref_to_Parameter'>field_remapinfo</span></a><span class='Delimiter'>[</span><a href="tqueue.c.html#LN770"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <a href="tqueue.c.html#LN767"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="tqueue.c.html#LN770"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="tqueue.c.html#LN200"><span class='Ref_to_Proto'>TQRemap</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN762"><span class='Ref_to_Parameter'>reader</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN764"><span class='Ref_to_Parameter'>field_remapinfo</span></a><span class='Delimiter'>[</span><a href="tqueue.c.html#LN770"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="tqueue.c.html#LN767"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="tqueue.c.html#LN770"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="tqueue.c.html#LN769"><span class='Ref_To_Local'>changed</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Reconstruct the modified tuple, if anything was modified. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN769"><span class='Ref_To_Local'>changed</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN763"><span class='Ref_to_Parameter'>tupledesc</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN767"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN768"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <a href="../access/common/heaptuple.c.html#LN606"><span class='Ref_to_Func'>heap_copytuple</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN765"><span class='Ref_to_Parameter'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end TQRemapTuple &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Process the given datum and replace any transient record typmods 
 * contained in it.  Set *changed to TRUE if we actually changed the datum. 
 * 
 * remapinfo is previously-computed remapping info about the datum's type. 
 * 
 * This function just dispatches based on the remap class. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN808"></a><span class='Declare_Function'>TQRemap</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN167"><span class='Ref_to_Struct'>TupleQueueReader</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>reader</span><span class='Delimiter'>, </span><a href="tqueue.c.html#LN118"><span class='Ref_to_Struct'>TupleRemapInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>remapinfo</span><span class='Delimiter'>, 
</span><a name="LN809"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>changed</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* This is recursive, so it could be driven to stack overflow. */ 
</span>    <a href="../../include/miscadmin.h.html#LN275"><span class='Ref_to_Proto'>check_stack_depth</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN808"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN120"><span class='Ref_to_Member'>remapclass</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="tqueue.c.html#LN85"><span class='Ref_to_EnumConst'>TQUEUE_REMAP_ARRAY</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="tqueue.c.html#LN202"><span class='Ref_to_Proto'>TQRemapArray</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN808"><span class='Ref_to_Parameter'>reader</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tqueue.c.html#LN808"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN126"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span><a href="tqueue.c.html#LN123"><span class='Ref_to_Member'>arr</span></a><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Delimiter'>, </span><a href="tqueue.c.html#LN809"><span class='Ref_to_Parameter'>changed</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="tqueue.c.html#LN86"><span class='Ref_to_EnumConst'>TQUEUE_REMAP_RANGE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="tqueue.c.html#LN204"><span class='Ref_to_Proto'>TQRemapRange</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN808"><span class='Ref_to_Parameter'>reader</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tqueue.c.html#LN808"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN126"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span><a href="tqueue.c.html#LN124"><span class='Ref_to_Member'>rng</span></a><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Delimiter'>, </span><a href="tqueue.c.html#LN809"><span class='Ref_to_Parameter'>changed</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="tqueue.c.html#LN87"><span class='Ref_to_EnumConst'>TQUEUE_REMAP_RECORD</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="tqueue.c.html#LN206"><span class='Ref_to_Proto'>TQRemapRecord</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN808"><span class='Ref_to_Parameter'>reader</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tqueue.c.html#LN808"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN126"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span><a href="tqueue.c.html#LN125"><span class='Ref_to_Member'>rec</span></a><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Delimiter'>, </span><a href="tqueue.c.html#LN809"><span class='Ref_to_Parameter'>changed</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized tqueue remap class: %d"</span><span class='Delimiter'>, 
</span>         <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="tqueue.c.html#LN808"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN120"><span class='Ref_to_Member'>remapclass</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end TQRemap &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Process the given array datum and replace any transient record typmods 
 * contained in it.  Set *changed to TRUE if we actually changed the datum. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN836"></a><span class='Declare_Function'>TQRemapArray</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN167"><span class='Ref_to_Struct'>TupleQueueReader</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>reader</span><span class='Delimiter'>, </span><a href="tqueue.c.html#LN92"><span class='Ref_to_Struct'>ArrayRemapInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>remapinfo</span><span class='Delimiter'>, 
</span><a name="LN837"></a>             <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>changed</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN839"></a>    <a href="../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>arr</span> <span class='Operator'>= </span><a href="../../include/utils/array.h.html#LN241"><span class='Ref_to_Macro'>DatumGetArrayTypeP</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN840"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typid</span> <span class='Operator'>= </span><a href="../../include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN839"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN841"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>element_changed</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN842"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>elem_values</span><span class='Delimiter'>; 
</span><a name="LN843"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>elem_nulls</span><span class='Delimiter'>; 
</span><a name="LN844"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>num_elems</span><span class='Delimiter'>; 
</span><a name="LN845"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Deconstruct the array. */ 
</span>    <a href="../../include/utils/array.h.html#LN382"><span class='Ref_to_Proto'>deconstruct_array</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN839"><span class='Ref_To_Local'>arr</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN840"><span class='Ref_To_Local'>typid</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN836"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN94"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>, 
</span>                      <a href="tqueue.c.html#LN836"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN95"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN836"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN96"><span class='Ref_to_Member'>typalign</span></a><span class='Delimiter'>, 
</span>                      <span class='Operator'>&</span><a href="tqueue.c.html#LN842"><span class='Ref_To_Local'>elem_values</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tqueue.c.html#LN843"><span class='Ref_To_Local'>elem_nulls</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tqueue.c.html#LN844"><span class='Ref_To_Local'>num_elems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Remap each element. */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN845"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tqueue.c.html#LN845"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tqueue.c.html#LN844"><span class='Ref_To_Local'>num_elems</span></a><span class='Delimiter'>; </span><a href="tqueue.c.html#LN845"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tqueue.c.html#LN843"><span class='Ref_To_Local'>elem_nulls</span></a><span class='Delimiter'>[</span><a href="tqueue.c.html#LN845"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <a href="tqueue.c.html#LN842"><span class='Ref_To_Local'>elem_values</span></a><span class='Delimiter'>[</span><a href="tqueue.c.html#LN845"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="tqueue.c.html#LN200"><span class='Ref_to_Proto'>TQRemap</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN836"><span class='Ref_to_Parameter'>reader</span></a><span class='Delimiter'>, 
</span>                                     <a href="tqueue.c.html#LN836"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN97"><span class='Ref_to_Member'>element_remap</span></a><span class='Delimiter'>, 
</span>                                     <a href="tqueue.c.html#LN842"><span class='Ref_To_Local'>elem_values</span></a><span class='Delimiter'>[</span><a href="tqueue.c.html#LN845"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                     <span class='Operator'>&</span><a href="tqueue.c.html#LN841"><span class='Ref_To_Local'>element_changed</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN841"><span class='Ref_To_Local'>element_changed</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Reconstruct and return the array.  */ 
</span>        <span class='Operator'>*</span><a href="tqueue.c.html#LN837"><span class='Ref_to_Parameter'>changed</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="tqueue.c.html#LN839"><span class='Ref_To_Local'>arr</span></a> <span class='Operator'>= </span><a href="../../include/utils/array.h.html#LN372"><span class='Ref_to_Proto'>construct_md_array</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN842"><span class='Ref_To_Local'>elem_values</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN843"><span class='Ref_To_Local'>elem_nulls</span></a><span class='Delimiter'>, 
</span>                               <a href="../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN839"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN839"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/utils/array.h.html#LN276"><span class='Ref_to_Macro'>ARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN839"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="tqueue.c.html#LN840"><span class='Ref_To_Local'>typid</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN836"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN94"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>, 
</span>                                 <a href="tqueue.c.html#LN836"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN95"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN836"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN96"><span class='Ref_to_Member'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN839"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Else just return the value as-is. */ 
</span>    <span class='Control'>return</span> <span class='Keyword'>value</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end TQRemapArray &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Process the given range datum and replace any transient record typmods 
 * contained in it.  Set *changed to TRUE if we actually changed the datum. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN882"></a><span class='Declare_Function'>TQRemapRange</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN167"><span class='Ref_to_Struct'>TupleQueueReader</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>reader</span><span class='Delimiter'>, </span><a href="tqueue.c.html#LN100"><span class='Ref_to_Struct'>RangeRemapInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>remapinfo</span><span class='Delimiter'>, 
</span><a name="LN883"></a>             <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>changed</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN885"></a>    <a href="../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>range</span> <span class='Operator'>= </span><a href="../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN886"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>bound_changed</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN887"></a>    <a href="../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a>  <span class='Declare_Local'>lower</span><span class='Delimiter'>; 
</span><a name="LN888"></a>    <a href="../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a>  <span class='Declare_Local'>upper</span><span class='Delimiter'>; 
</span><a name="LN889"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>empty</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Extract the lower and upper bounds. */ 
</span>    <a href="../../include/utils/rangetypes.h.html#LN123"><span class='Ref_to_Proto'>range_deserialize</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN882"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN102"><span class='Ref_to_Member'>typcache</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN885"><span class='Ref_To_Local'>range</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tqueue.c.html#LN887"><span class='Ref_To_Local'>lower</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tqueue.c.html#LN888"><span class='Ref_To_Local'>upper</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tqueue.c.html#LN889"><span class='Ref_To_Local'>empty</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Nothing to do for an empty range. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN889"><span class='Ref_To_Local'>empty</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Keyword'>value</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Remap each bound, if present. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tqueue.c.html#LN888"><span class='Ref_To_Local'>upper</span></a><span class='Operator'>.</span><a href="../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a><span class='Parentheses'>) 
</span>        <a href="tqueue.c.html#LN888"><span class='Ref_To_Local'>upper</span></a><span class='Operator'>.</span><a href="../../include/utils/rangetypes.h.html#LN61"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN200"><span class='Ref_to_Proto'>TQRemap</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN882"><span class='Ref_to_Parameter'>reader</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN882"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN103"><span class='Ref_to_Member'>bound_remap</span></a><span class='Delimiter'>, 
</span>                            <a href="tqueue.c.html#LN888"><span class='Ref_To_Local'>upper</span></a><span class='Operator'>.</span><a href="../../include/utils/rangetypes.h.html#LN61"><span class='Ref_to_Member'>val</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tqueue.c.html#LN886"><span class='Ref_To_Local'>bound_changed</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tqueue.c.html#LN887"><span class='Ref_To_Local'>lower</span></a><span class='Operator'>.</span><a href="../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a><span class='Parentheses'>) 
</span>        <a href="tqueue.c.html#LN887"><span class='Ref_To_Local'>lower</span></a><span class='Operator'>.</span><a href="../../include/utils/rangetypes.h.html#LN61"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN200"><span class='Ref_to_Proto'>TQRemap</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN882"><span class='Ref_to_Parameter'>reader</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN882"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN103"><span class='Ref_to_Member'>bound_remap</span></a><span class='Delimiter'>, 
</span>                            <a href="tqueue.c.html#LN887"><span class='Ref_To_Local'>lower</span></a><span class='Operator'>.</span><a href="../../include/utils/rangetypes.h.html#LN61"><span class='Ref_to_Member'>val</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tqueue.c.html#LN886"><span class='Ref_To_Local'>bound_changed</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN886"><span class='Ref_To_Local'>bound_changed</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Reserialize.  */ 
</span>        <span class='Operator'>*</span><a href="tqueue.c.html#LN883"><span class='Ref_to_Parameter'>changed</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="tqueue.c.html#LN885"><span class='Ref_To_Local'>range</span></a> <span class='Operator'>= </span><a href="../../include/utils/rangetypes.h.html#LN121"><span class='Ref_to_Proto'>range_serialize</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN882"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN102"><span class='Ref_to_Member'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tqueue.c.html#LN887"><span class='Ref_To_Local'>lower</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tqueue.c.html#LN888"><span class='Ref_To_Local'>upper</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN889"><span class='Ref_To_Local'>empty</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../../include/utils/rangetypes.h.html#LN72"><span class='Ref_to_Macro'>RangeTypeGetDatum</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN885"><span class='Ref_To_Local'>range</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Else just return the value as-is. */ 
</span>    <span class='Control'>return</span> <span class='Keyword'>value</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end TQRemapRange &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Process the given record datum and replace any transient record typmods 
 * contained in it.  Set *changed to TRUE if we actually changed the datum. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN923"></a><span class='Declare_Function'>TQRemapRecord</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN167"><span class='Ref_to_Struct'>TupleQueueReader</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>reader</span><span class='Delimiter'>, </span><a href="tqueue.c.html#LN106"><span class='Ref_to_Struct'>RecordRemapInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>remapinfo</span><span class='Delimiter'>, 
</span><a name="LN924"></a>              <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>changed</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN926"></a>    <a href="../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN927"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typid</span><span class='Delimiter'>; 
</span><a name="LN928"></a>    <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>typmod</span><span class='Delimiter'>; 
</span><a name="LN929"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>changed_typmod</span><span class='Delimiter'>; 
</span><a name="LN930"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupledesc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Extract type OID and typmod from tuple. */ 
</span>    <a href="tqueue.c.html#LN926"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN258"><span class='Ref_to_Macro'>DatumGetHeapTupleHeader</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tqueue.c.html#LN927"><span class='Ref_To_Local'>typid</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN444"><span class='Ref_to_Macro'>HeapTupleHeaderGetTypeId</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN926"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tqueue.c.html#LN928"><span class='Ref_To_Local'>typmod</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN454"><span class='Ref_to_Macro'>HeapTupleHeaderGetTypMod</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN926"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If first time through, or if this isn't the same composite type as last 
     * time, identify the required typmod mapping, and then look up the 
     * necessary information for processing the fields. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN927"><span class='Ref_To_Local'>typid</span></a> <span class='Operator'>!= </span><a href="tqueue.c.html#LN923"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN109"><span class='Ref_to_Member'>rectypid</span></a> <span class='Operator'>|| </span><a href="tqueue.c.html#LN928"><span class='Ref_To_Local'>typmod</span></a> <span class='Operator'>!= </span><a href="tqueue.c.html#LN923"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN110"><span class='Ref_to_Member'>rectypmod</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Free any old data. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN923"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN114"><span class='Ref_to_Member'>tupledesc</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="../../include/access/tupdesc.h.html#LN95"><span class='Ref_to_Proto'>FreeTupleDesc</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN923"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN114"><span class='Ref_to_Member'>tupledesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Is it worth trying to free substructure of the remap tree? */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN923"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN115"><span class='Ref_to_Member'>field_remap</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN923"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN115"><span class='Ref_to_Member'>field_remap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* If transient record type, look up matching local typmod. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN927"><span class='Ref_To_Local'>typid</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN679"><span class='Ref_to_Const'>RECORDOID</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN954"></a>            <a href="tqueue.c.html#LN152"><span class='Ref_to_Struct'>RecordTypmodMap</span></a> <span class='Operator'>*</span><span class='Declare_Local'>mapent</span><span class='Delimiter'>; 
</span> 
            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN923"><span class='Ref_to_Parameter'>reader</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN171"><span class='Ref_to_Member'>typmodmap</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tqueue.c.html#LN954"><span class='Ref_To_Local'>mapent</span></a> <span class='Operator'>= </span><a href="../../include/utils/hsearch.h.html#LN125"><span class='Ref_to_Proto'>hash_search</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN923"><span class='Ref_to_Parameter'>reader</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN171"><span class='Ref_to_Member'>typmodmap</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tqueue.c.html#LN928"><span class='Ref_To_Local'>typmod</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../include/utils/hsearch.h.html#LN104"><span class='Ref_to_EnumConst'>HASH_FIND</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN954"><span class='Ref_To_Local'>mapent</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"tqueue received unrecognized remote typmod %d"</span><span class='Delimiter'>, 
</span>                     <a href="tqueue.c.html#LN928"><span class='Ref_To_Local'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tqueue.c.html#LN923"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN112"><span class='Ref_to_Member'>localtypmod</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN954"><span class='Ref_To_Local'>mapent</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN155"><span class='Ref_to_Member'>localtypmod</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="tqueue.c.html#LN923"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN112"><span class='Ref_to_Member'>localtypmod</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Look up tuple descriptor in typcache. */ 
</span>        <a href="tqueue.c.html#LN930"><span class='Ref_To_Local'>tupledesc</span></a> <span class='Operator'>= </span><a href="../../include/utils/typcache.h.html#LN151"><span class='Ref_to_Proto'>lookup_rowtype_tupdesc</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN927"><span class='Ref_To_Local'>typid</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN923"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN112"><span class='Ref_to_Member'>localtypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Figure out whether fields need recursive processing. */ 
</span>        <a href="tqueue.c.html#LN923"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN115"><span class='Ref_to_Member'>field_remap</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN213"><span class='Ref_to_Proto'>BuildFieldRemapInfo</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN930"><span class='Ref_To_Local'>tupledesc</span></a><span class='Delimiter'>, 
</span>                                                     <a href="tqueue.c.html#LN923"><span class='Ref_to_Parameter'>reader</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN170"><span class='Ref_to_Member'>mycontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN923"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN115"><span class='Ref_to_Member'>field_remap</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * We need to inspect the record contents, so save a copy of the 
             * tupdesc.  (We could possibly just reference the typcache's 
             * copy, but then it's problematic when to release the refcount.) 
             */ 
</span><a name="LN980"></a>            <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN923"><span class='Ref_to_Parameter'>reader</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN170"><span class='Ref_to_Member'>mycontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="tqueue.c.html#LN923"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN114"><span class='Ref_to_Member'>tupledesc</span></a> <span class='Operator'>= </span><a href="../../include/access/tupdesc.h.html#LN88"><span class='Ref_to_Proto'>CreateTupleDescCopy</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN930"><span class='Ref_To_Local'>tupledesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN980"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* No fields of the record require remapping. */ 
</span>            <a href="tqueue.c.html#LN923"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN114"><span class='Ref_to_Member'>tupledesc</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="tqueue.c.html#LN923"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN109"><span class='Ref_to_Member'>rectypid</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN927"><span class='Ref_To_Local'>typid</span></a><span class='Delimiter'>; 
</span>        <a href="tqueue.c.html#LN923"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN110"><span class='Ref_to_Member'>rectypmod</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN928"><span class='Ref_To_Local'>typmod</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Release reference count acquired by lookup_rowtype_tupdesc. */ 
</span>        <a href="../../include/access/tupdesc.h.html#LN98"><span class='Ref_to_Proto'>DecrTupleDescRefCount</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN930"><span class='Ref_To_Local'>tupledesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if typid!=remapinfo-&GT;rec... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* If transient record, replace remote typmod with local typmod. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN927"><span class='Ref_To_Local'>typid</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN679"><span class='Ref_to_Const'>RECORDOID</span></a> <span class='Operator'>&& </span><a href="tqueue.c.html#LN928"><span class='Ref_To_Local'>typmod</span></a> <span class='Operator'>!= </span><a href="tqueue.c.html#LN923"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN112"><span class='Ref_to_Member'>localtypmod</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tqueue.c.html#LN928"><span class='Ref_To_Local'>typmod</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN923"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN112"><span class='Ref_to_Member'>localtypmod</span></a><span class='Delimiter'>; 
</span>        <a href="tqueue.c.html#LN929"><span class='Ref_To_Local'>changed_typmod</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="tqueue.c.html#LN929"><span class='Ref_To_Local'>changed_typmod</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we need to change the typmod, or if there are any potentially 
     * remappable fields, replace the tuple. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN929"><span class='Ref_To_Local'>changed_typmod</span></a> <span class='Operator'>|| </span><a href="tqueue.c.html#LN923"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN115"><span class='Ref_to_Member'>field_remap</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1012"></a>        <a href="../../include/access/htup.h.html#LN61"><span class='Ref_to_Struct'>HeapTupleData</span></a> <span class='Declare_Local'>htup</span><span class='Delimiter'>; 
</span><a name="LN1013"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>atup</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* For now, assume we always need to change the tuple in this case. */ 
</span>        <span class='Operator'>*</span><a href="tqueue.c.html#LN924"><span class='Ref_to_Parameter'>changed</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Copy tuple, possibly remapping contained fields. */ 
</span>        <a href="../../include/storage/itemptr.h.html#LN148"><span class='Ref_to_Macro'>ItemPointerSetInvalid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tqueue.c.html#LN1012"><span class='Ref_To_Local'>htup</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tqueue.c.html#LN1012"><span class='Ref_To_Local'>htup</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="tqueue.c.html#LN1012"><span class='Ref_To_Local'>htup</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN438"><span class='Ref_to_Macro'>HeapTupleHeaderGetDatumLength</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN926"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tqueue.c.html#LN1012"><span class='Ref_To_Local'>htup</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN926"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>; 
</span>        <a href="tqueue.c.html#LN1013"><span class='Ref_To_Local'>atup</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN196"><span class='Ref_to_Proto'>TQRemapTuple</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN923"><span class='Ref_to_Parameter'>reader</span></a><span class='Delimiter'>, 
</span>                            <a href="tqueue.c.html#LN923"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN114"><span class='Ref_to_Member'>tupledesc</span></a><span class='Delimiter'>, 
</span>                            <a href="tqueue.c.html#LN923"><span class='Ref_to_Parameter'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN115"><span class='Ref_to_Member'>field_remap</span></a><span class='Delimiter'>, 
</span>                            <span class='Operator'>&</span><a href="tqueue.c.html#LN1012"><span class='Ref_To_Local'>htup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Apply the correct labeling for a local Datum. */ 
</span>        <a href="../../include/access/htup_details.h.html#LN449"><span class='Ref_to_Macro'>HeapTupleHeaderSetTypeId</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN1013"><span class='Ref_To_Local'>atup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN927"><span class='Ref_To_Local'>typid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/access/htup_details.h.html#LN459"><span class='Ref_to_Macro'>HeapTupleHeaderSetTypMod</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN1013"><span class='Ref_To_Local'>atup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN928"><span class='Ref_To_Local'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/access/htup_details.h.html#LN441"><span class='Ref_to_Macro'>HeapTupleHeaderSetDatumLength</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN1013"><span class='Ref_To_Local'>atup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN1012"><span class='Ref_To_Local'>htup</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* And return the results. */ 
</span>        <span class='Control'>return</span> <a href="../../include/funcapi.h.html#LN232"><span class='Ref_to_Proto'>HeapTupleHeaderGetDatum</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN1013"><span class='Ref_To_Local'>atup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if changed_typmod||remap... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Else just return the value as-is. */ 
</span>    <span class='Control'>return</span> <span class='Keyword'>value</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end TQRemapRecord &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Handle a control message from the tuple queue reader. 
 * 
 * Control messages are sent when the remote side is sending tuples that 
 * contain transient record types.  We need to arrange to bless those 
 * record types locally and translate between remote and local typmods. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1049"></a><span class='Declare_Function'>TupleQueueHandleControlMessage</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN167"><span class='Ref_to_Struct'>TupleQueueReader</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>reader</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>nbytes</span><span class='Delimiter'>, 
</span><a name="LN1050"></a>                               <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1052"></a>    <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>remotetypmod</span><span class='Delimiter'>; 
</span><a name="LN1053"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>natts</span><span class='Delimiter'>; 
</span><a name="LN1054"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>hasoid</span><span class='Delimiter'>; 
</span><a name="LN1055"></a>    <a href="../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>offset</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN1056"></a>    <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Operator'>*</span><span class='Declare_Local'>attrs</span><span class='Delimiter'>; 
</span><a name="LN1057"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupledesc</span><span class='Delimiter'>; 
</span><a name="LN1058"></a>    <a href="tqueue.c.html#LN152"><span class='Ref_to_Struct'>RecordTypmodMap</span></a> <span class='Operator'>*</span><span class='Declare_Local'>mapent</span><span class='Delimiter'>; 
</span><a name="LN1059"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span><span class='Delimiter'>; 
</span><a name="LN1060"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Extract remote typmod. */ 
</span>    memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tqueue.c.html#LN1052"><span class='Ref_To_Local'>remotetypmod</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tqueue.c.html#LN1050"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>[</span><a href="tqueue.c.html#LN1055"><span class='Ref_To_Local'>offset</span></a><span class='Delimiter'>], </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="tqueue.c.html#LN1055"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>+= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Extract attribute count. */ 
</span>    memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tqueue.c.html#LN1053"><span class='Ref_To_Local'>natts</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tqueue.c.html#LN1050"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>[</span><a href="tqueue.c.html#LN1055"><span class='Ref_To_Local'>offset</span></a><span class='Delimiter'>], </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="tqueue.c.html#LN1055"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>+= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Extract hasoid flag. */ 
</span>    memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tqueue.c.html#LN1054"><span class='Ref_To_Local'>hasoid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tqueue.c.html#LN1050"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>[</span><a href="tqueue.c.html#LN1055"><span class='Ref_To_Local'>offset</span></a><span class='Delimiter'>], </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="tqueue.c.html#LN1055"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>+= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Extract attribute details. The tupledesc made here is just transient. */ 
</span>    <a href="tqueue.c.html#LN1056"><span class='Ref_To_Local'>attrs</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN1053"><span class='Ref_To_Local'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN1060"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tqueue.c.html#LN1060"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tqueue.c.html#LN1053"><span class='Ref_To_Local'>natts</span></a><span class='Delimiter'>; </span><a href="tqueue.c.html#LN1060"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tqueue.c.html#LN1056"><span class='Ref_To_Local'>attrs</span></a><span class='Delimiter'>[</span><a href="tqueue.c.html#LN1060"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span>FormData_pg_attribute<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="tqueue.c.html#LN1056"><span class='Ref_To_Local'>attrs</span></a><span class='Delimiter'>[</span><a href="tqueue.c.html#LN1060"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="tqueue.c.html#LN1050"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>[</span><a href="tqueue.c.html#LN1055"><span class='Ref_To_Local'>offset</span></a><span class='Delimiter'>], </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span>FormData_pg_attribute<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="tqueue.c.html#LN1055"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>+= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span>FormData_pg_attribute<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* We should have read the whole message. */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN1055"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>== </span><a href="tqueue.c.html#LN1049"><span class='Ref_to_Parameter'>nbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Construct TupleDesc, and assign a local typmod. */ 
</span>    <a href="tqueue.c.html#LN1057"><span class='Ref_To_Local'>tupledesc</span></a> <span class='Operator'>= </span><a href="../../include/access/tupdesc.h.html#LN85"><span class='Ref_to_Proto'>CreateTupleDesc</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN1053"><span class='Ref_To_Local'>natts</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN1054"><span class='Ref_To_Local'>hasoid</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN1056"><span class='Ref_To_Local'>attrs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tqueue.c.html#LN1057"><span class='Ref_To_Local'>tupledesc</span></a> <span class='Operator'>= </span><a href="../../include/funcapi.h.html#LN229"><span class='Ref_to_Proto'>BlessTupleDesc</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN1057"><span class='Ref_To_Local'>tupledesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create mapping hashtable if it doesn't exist already. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN1049"><span class='Ref_to_Parameter'>reader</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN171"><span class='Ref_to_Member'>typmodmap</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1093"></a>        <a href="../../include/utils/hsearch.h.html#LN64"><span class='Ref_to_Struct'>HASHCTL</span></a>     <span class='Declare_Local'>ctl</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tqueue.c.html#LN1093"><span class='Ref_To_Local'>ctl</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN1093"><span class='Ref_To_Local'>ctl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="tqueue.c.html#LN1093"><span class='Ref_To_Local'>ctl</span></a><span class='Operator'>.</span><a href="../../include/utils/hsearch.h.html#LN71"><span class='Ref_to_Member'>keysize</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tqueue.c.html#LN1093"><span class='Ref_To_Local'>ctl</span></a><span class='Operator'>.</span><a href="../../include/utils/hsearch.h.html#LN72"><span class='Ref_to_Member'>entrysize</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN152"><span class='Ref_to_Struct'>RecordTypmodMap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tqueue.c.html#LN1093"><span class='Ref_To_Local'>ctl</span></a><span class='Operator'>.</span><a href="../../include/utils/hsearch.h.html#LN77"><span class='Ref_to_Member'>hcxt</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN1049"><span class='Ref_to_Parameter'>reader</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN170"><span class='Ref_to_Member'>mycontext</span></a><span class='Delimiter'>; 
</span>        <a href="tqueue.c.html#LN1049"><span class='Ref_to_Parameter'>reader</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN171"><span class='Ref_to_Member'>typmodmap</span></a> <span class='Operator'>= </span><a href="../../include/utils/hsearch.h.html#LN121"><span class='Ref_to_Proto'>hash_create</span></a><span class='Parentheses'>(</span><span class='String'>"tqueue receiver record type hashtable"</span><span class='Delimiter'>, 
</span>                                        <span class='Number'>100</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tqueue.c.html#LN1093"><span class='Ref_To_Local'>ctl</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../include/utils/hsearch.h.html#LN86"><span class='Ref_to_Const'>HASH_ELEM</span></a> <span class='Operator'>| </span><a href="../../include/utils/hsearch.h.html#LN87"><span class='Ref_to_Const'>HASH_BLOBS</span></a> <span class='Operator'>| </span><a href="../../include/utils/hsearch.h.html#LN92"><span class='Ref_to_Const'>HASH_CONTEXT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Create map entry. */ 
</span>    <a href="tqueue.c.html#LN1058"><span class='Ref_To_Local'>mapent</span></a> <span class='Operator'>= </span><a href="../../include/utils/hsearch.h.html#LN125"><span class='Ref_to_Proto'>hash_search</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN1049"><span class='Ref_to_Parameter'>reader</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN171"><span class='Ref_to_Member'>typmodmap</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tqueue.c.html#LN1052"><span class='Ref_To_Local'>remotetypmod</span></a><span class='Delimiter'>, </span><a href="../../include/utils/hsearch.h.html#LN105"><span class='Ref_to_EnumConst'>HASH_ENTER</span></a><span class='Delimiter'>, 
</span>                         <span class='Operator'>&</span><a href="tqueue.c.html#LN1059"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN1059"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"duplicate tqueue control message for typmod %d"</span><span class='Delimiter'>, 
</span>             <a href="tqueue.c.html#LN1052"><span class='Ref_To_Local'>remotetypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tqueue.c.html#LN1058"><span class='Ref_To_Local'>mapent</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN155"><span class='Ref_to_Member'>localtypmod</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN1057"><span class='Ref_To_Local'>tupledesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN77"><span class='Ref_to_Member'>tdtypmod</span></a><span class='Delimiter'>; 
</span> 
    <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN22"><span class='Ref_to_Const'>DEBUG3</span></a><span class='Delimiter'>, </span><span class='String'>"tqueue mapping remote typmod %d to local typmod %d"</span><span class='Delimiter'>, 
</span>         <a href="tqueue.c.html#LN1052"><span class='Ref_To_Local'>remotetypmod</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN1058"><span class='Ref_To_Local'>mapent</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN155"><span class='Ref_to_Member'>localtypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end TupleQueueHandleControlMessage &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Build remap info for the specified data type, storing it in mycontext. 
 * Returns NULL if neither the type nor any subtype could require remapping. 
 */ 
</span><span class='Keyword'>static </span><a href="tqueue.c.html#LN118"><span class='Ref_to_Struct'>TupleRemapInfo</span></a> <span class='Operator'>* 
</span><a name="LN1121"></a><span class='Declare_Function'>BuildTupleRemapInfo</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typid</span><span class='Delimiter'>, </span><a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>mycontext</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1123"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN1124"></a>    <a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a> <span class='Declare_Local'>typ</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* This is recursive, so it could be driven to stack overflow. */ 
</span>    <a href="../../include/miscadmin.h.html#LN275"><span class='Ref_to_Proto'>check_stack_depth</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
<a name="LN1129"></a><span class='Label'>restart</span><span class='Operator'>: 
</span>    <a href="tqueue.c.html#LN1123"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN1121"><span class='Ref_to_Parameter'>typid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN1123"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for type %u"</span><span class='Delimiter'>, </span><a href="tqueue.c.html#LN1121"><span class='Ref_to_Parameter'>typid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tqueue.c.html#LN1124"><span class='Ref_To_Local'>typ</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN1123"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Look through domains to underlying base type. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN1124"><span class='Ref_To_Local'>typ</span></a><span class='Operator'>-&GT;</span>typtype <span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN721"><span class='Ref_to_Const'>TYPTYPE_DOMAIN</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tqueue.c.html#LN1121"><span class='Ref_to_Parameter'>typid</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN1124"><span class='Ref_To_Local'>typ</span></a><span class='Operator'>-&GT;</span>typbasetype<span class='Delimiter'>; 
</span>        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN1123"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&uarr;</span><a href="tqueue.c.html#LN1129"><span class='Ref_to_Label'>restart</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* If it's a true array type, deal with it that way. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN1124"><span class='Ref_To_Local'>typ</span></a><span class='Operator'>-&GT;</span>typelem<span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="tqueue.c.html#LN1124"><span class='Ref_To_Local'>typ</span></a><span class='Operator'>-&GT;</span>typlen <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="tqueue.c.html#LN1121"><span class='Ref_to_Parameter'>typid</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN1124"><span class='Ref_To_Local'>typ</span></a><span class='Operator'>-&GT;</span>typelem<span class='Delimiter'>; 
</span>        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN1123"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="tqueue.c.html#LN209"><span class='Ref_to_Proto'>BuildArrayRemapInfo</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN1121"><span class='Ref_to_Parameter'>typid</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN1121"><span class='Ref_to_Parameter'>mycontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Similarly, deal with ranges appropriately. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN1124"><span class='Ref_To_Local'>typ</span></a><span class='Operator'>-&GT;</span>typtype <span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN724"><span class='Ref_to_Const'>TYPTYPE_RANGE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN1123"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="tqueue.c.html#LN211"><span class='Ref_to_Proto'>BuildRangeRemapInfo</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN1121"><span class='Ref_to_Parameter'>typid</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN1121"><span class='Ref_to_Parameter'>mycontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If it's a composite type (including RECORD), set up for remapping.  We 
     * don't attempt to determine the status of subfields here, since we do 
     * not have enough information yet; just mark everything invalid. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN1124"><span class='Ref_To_Local'>typ</span></a><span class='Operator'>-&GT;</span>typtype <span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN720"><span class='Ref_to_Const'>TYPTYPE_COMPOSITE</span></a> <span class='Operator'>|| </span><a href="tqueue.c.html#LN1121"><span class='Ref_to_Parameter'>typid</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN679"><span class='Ref_to_Const'>RECORDOID</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1165"></a>        <a href="tqueue.c.html#LN118"><span class='Ref_to_Struct'>TupleRemapInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>remapinfo</span><span class='Delimiter'>; 
</span> 
        <a href="tqueue.c.html#LN1165"><span class='Ref_To_Local'>remapinfo</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN118"><span class='Ref_to_Struct'>TupleRemapInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN1121"><span class='Ref_to_Parameter'>mycontext</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN118"><span class='Ref_to_Struct'>TupleRemapInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="tqueue.c.html#LN1165"><span class='Ref_To_Local'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN120"><span class='Ref_to_Member'>remapclass</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN87"><span class='Ref_to_EnumConst'>TQUEUE_REMAP_RECORD</span></a><span class='Delimiter'>; 
</span>        <a href="tqueue.c.html#LN1165"><span class='Ref_To_Local'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN126"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span><a href="tqueue.c.html#LN125"><span class='Ref_to_Member'>rec</span></a><span class='Operator'>.</span><a href="tqueue.c.html#LN109"><span class='Ref_to_Member'>rectypid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="tqueue.c.html#LN1165"><span class='Ref_To_Local'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN126"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span><a href="tqueue.c.html#LN125"><span class='Ref_to_Member'>rec</span></a><span class='Operator'>.</span><a href="tqueue.c.html#LN110"><span class='Ref_to_Member'>rectypmod</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="tqueue.c.html#LN1165"><span class='Ref_To_Local'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN126"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span><a href="tqueue.c.html#LN125"><span class='Ref_to_Member'>rec</span></a><span class='Operator'>.</span><a href="tqueue.c.html#LN112"><span class='Ref_to_Member'>localtypmod</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="tqueue.c.html#LN1165"><span class='Ref_To_Local'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN126"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span><a href="tqueue.c.html#LN125"><span class='Ref_to_Member'>rec</span></a><span class='Operator'>.</span><a href="tqueue.c.html#LN114"><span class='Ref_to_Member'>tupledesc</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="tqueue.c.html#LN1165"><span class='Ref_To_Local'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN126"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span><a href="tqueue.c.html#LN125"><span class='Ref_to_Member'>rec</span></a><span class='Operator'>.</span><a href="tqueue.c.html#LN115"><span class='Ref_to_Member'>field_remap</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN1123"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="tqueue.c.html#LN1165"><span class='Ref_To_Local'>remapinfo</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Nothing else can possibly need remapping attention. */ 
</span>    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN1123"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end BuildTupleRemapInfo &raquo; </span> 
 
<span class='Keyword'>static </span><a href="tqueue.c.html#LN118"><span class='Ref_to_Struct'>TupleRemapInfo</span></a> <span class='Operator'>* 
</span><a name="LN1185"></a><span class='Declare_Function'>BuildArrayRemapInfo</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>elemtypid</span><span class='Delimiter'>, </span><a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>mycontext</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1187"></a>    <a href="tqueue.c.html#LN118"><span class='Ref_to_Struct'>TupleRemapInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>remapinfo</span><span class='Delimiter'>; 
</span><a name="LN1188"></a>    <a href="tqueue.c.html#LN118"><span class='Ref_to_Struct'>TupleRemapInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>element_remapinfo</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* See if element type requires remapping. */ 
</span>    <a href="tqueue.c.html#LN1188"><span class='Ref_To_Local'>element_remapinfo</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN208"><span class='Ref_to_Proto'>BuildTupleRemapInfo</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN1185"><span class='Ref_to_Parameter'>elemtypid</span></a><span class='Delimiter'>, </span><a href="tqueue.c.html#LN1185"><span class='Ref_to_Parameter'>mycontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* If not, the array doesn't either. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN1188"><span class='Ref_To_Local'>element_remapinfo</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* OK, set up to remap the array. */ 
</span>    <a href="tqueue.c.html#LN1187"><span class='Ref_To_Local'>remapinfo</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN118"><span class='Ref_to_Struct'>TupleRemapInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN1185"><span class='Ref_to_Parameter'>mycontext</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN118"><span class='Ref_to_Struct'>TupleRemapInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="tqueue.c.html#LN1187"><span class='Ref_To_Local'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN120"><span class='Ref_to_Member'>remapclass</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN85"><span class='Ref_to_EnumConst'>TQUEUE_REMAP_ARRAY</span></a><span class='Delimiter'>; 
</span>    <a href="../../include/utils/lsyscache.h.html#LN136"><span class='Ref_to_Proto'>get_typlenbyvalalign</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN1185"><span class='Ref_to_Parameter'>elemtypid</span></a><span class='Delimiter'>, 
</span>                         <span class='Operator'>&</span><a href="tqueue.c.html#LN1187"><span class='Ref_To_Local'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN126"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span><a href="tqueue.c.html#LN123"><span class='Ref_to_Member'>arr</span></a><span class='Operator'>.</span><a href="tqueue.c.html#LN94"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>, 
</span>                         <span class='Operator'>&</span><a href="tqueue.c.html#LN1187"><span class='Ref_To_Local'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN126"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span><a href="tqueue.c.html#LN123"><span class='Ref_to_Member'>arr</span></a><span class='Operator'>.</span><a href="tqueue.c.html#LN95"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>, 
</span>                         <span class='Operator'>&</span><a href="tqueue.c.html#LN1187"><span class='Ref_To_Local'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN126"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span><a href="tqueue.c.html#LN123"><span class='Ref_to_Member'>arr</span></a><span class='Operator'>.</span><a href="tqueue.c.html#LN96"><span class='Ref_to_Member'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tqueue.c.html#LN1187"><span class='Ref_To_Local'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN126"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span><a href="tqueue.c.html#LN123"><span class='Ref_to_Member'>arr</span></a><span class='Operator'>.</span><a href="tqueue.c.html#LN97"><span class='Ref_to_Member'>element_remap</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN1188"><span class='Ref_To_Local'>element_remapinfo</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="tqueue.c.html#LN1187"><span class='Ref_To_Local'>remapinfo</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end BuildArrayRemapInfo &raquo; </span> 
 
<span class='Keyword'>static </span><a href="tqueue.c.html#LN118"><span class='Ref_to_Struct'>TupleRemapInfo</span></a> <span class='Operator'>* 
</span><a name="LN1208"></a><span class='Declare_Function'>BuildRangeRemapInfo</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>rngtypid</span><span class='Delimiter'>, </span><a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>mycontext</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1210"></a>    <a href="tqueue.c.html#LN118"><span class='Ref_to_Struct'>TupleRemapInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>remapinfo</span><span class='Delimiter'>; 
</span><a name="LN1211"></a>    <a href="tqueue.c.html#LN118"><span class='Ref_to_Struct'>TupleRemapInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>bound_remapinfo</span><span class='Delimiter'>; 
</span><a name="LN1212"></a>    <a href="../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>typcache</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get range info from the typcache.  We assume this pointer will stay 
     * valid for the duration of the query. 
     */ 
</span>    <a href="tqueue.c.html#LN1212"><span class='Ref_To_Local'>typcache</span></a> <span class='Operator'>= </span><a href="../../include/utils/typcache.h.html#LN142"><span class='Ref_to_Proto'>lookup_type_cache</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN1208"><span class='Ref_to_Parameter'>rngtypid</span></a><span class='Delimiter'>, </span><a href="../../include/utils/typcache.h.html#LN120"><span class='Ref_to_Const'>TYPECACHE_RANGE_INFO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN1212"><span class='Ref_To_Local'>typcache</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/typcache.h.html#LN83"><span class='Ref_to_Member'>rngelemtype</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"type %u is not a range type"</span><span class='Delimiter'>, </span><a href="tqueue.c.html#LN1208"><span class='Ref_to_Parameter'>rngtypid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* See if range bound type requires remapping. */ 
</span>    <a href="tqueue.c.html#LN1211"><span class='Ref_To_Local'>bound_remapinfo</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN208"><span class='Ref_to_Proto'>BuildTupleRemapInfo</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN1212"><span class='Ref_To_Local'>typcache</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/typcache.h.html#LN83"><span class='Ref_to_Member'>rngelemtype</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/typcache.h.html#LN31"><span class='Ref_to_Member'>type_id</span></a><span class='Delimiter'>, 
</span>                                          <a href="tqueue.c.html#LN1208"><span class='Ref_to_Parameter'>mycontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* If not, the range doesn't either. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN1211"><span class='Ref_To_Local'>bound_remapinfo</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* OK, set up to remap the range. */ 
</span>    <a href="tqueue.c.html#LN1210"><span class='Ref_To_Local'>remapinfo</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN118"><span class='Ref_to_Struct'>TupleRemapInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN1208"><span class='Ref_to_Parameter'>mycontext</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN118"><span class='Ref_to_Struct'>TupleRemapInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="tqueue.c.html#LN1210"><span class='Ref_To_Local'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN120"><span class='Ref_to_Member'>remapclass</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN86"><span class='Ref_to_EnumConst'>TQUEUE_REMAP_RANGE</span></a><span class='Delimiter'>; 
</span>    <a href="tqueue.c.html#LN1210"><span class='Ref_To_Local'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN126"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span><a href="tqueue.c.html#LN124"><span class='Ref_to_Member'>rng</span></a><span class='Operator'>.</span><a href="tqueue.c.html#LN102"><span class='Ref_to_Member'>typcache</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN1212"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>; 
</span>    <a href="tqueue.c.html#LN1210"><span class='Ref_To_Local'>remapinfo</span></a><span class='Operator'>-&GT;</span><a href="tqueue.c.html#LN126"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span><a href="tqueue.c.html#LN124"><span class='Ref_to_Member'>rng</span></a><span class='Operator'>.</span><a href="tqueue.c.html#LN103"><span class='Ref_to_Member'>bound_remap</span></a> <span class='Operator'>= </span><a href="tqueue.c.html#LN1211"><span class='Ref_To_Local'>bound_remapinfo</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="tqueue.c.html#LN1210"><span class='Ref_To_Local'>remapinfo</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end BuildRangeRemapInfo &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Build remap info for fields of the type described by the given tupdesc. 
 * Returns an array of TupleRemapInfo pointers, or NULL if no field 
 * requires remapping.  Data is allocated in mycontext. 
 */ 
</span><span class='Keyword'>static </span><a href="tqueue.c.html#LN118"><span class='Ref_to_Struct'>TupleRemapInfo</span></a> <span class='Operator'>** 
</span><a name="LN1243"></a><span class='Declare_Function'>BuildFieldRemapInfo</span><span class='Parentheses'>(</span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupledesc</span><span class='Delimiter'>, </span><a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>mycontext</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1245"></a>    <a href="tqueue.c.html#LN118"><span class='Ref_to_Struct'>TupleRemapInfo</span></a> <span class='Operator'>**</span><span class='Declare_Local'>remapinfo</span><span class='Delimiter'>; 
</span><a name="LN1246"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>noop</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span><a name="LN1247"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Recursively determine the remapping status of each field. */ 
</span>    <a href="tqueue.c.html#LN1245"><span class='Ref_To_Local'>remapinfo</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN118"><span class='Ref_to_Struct'>TupleRemapInfo</span></a> <span class='Operator'>**</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN1243"><span class='Ref_to_Parameter'>mycontext</span></a><span class='Delimiter'>, 
</span>                           <a href="tqueue.c.html#LN1243"><span class='Ref_to_Parameter'>tupledesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tqueue.c.html#LN118"><span class='Ref_to_Struct'>TupleRemapInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN1247"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tqueue.c.html#LN1247"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tqueue.c.html#LN1243"><span class='Ref_to_Parameter'>tupledesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; </span><a href="tqueue.c.html#LN1247"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1255"></a>        <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>attr</span> <span class='Operator'>= </span><a href="tqueue.c.html#LN1243"><span class='Ref_to_Parameter'>tupledesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="tqueue.c.html#LN1247"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN1255"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="tqueue.c.html#LN1245"><span class='Ref_To_Local'>remapinfo</span></a><span class='Delimiter'>[</span><a href="tqueue.c.html#LN1247"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="tqueue.c.html#LN1245"><span class='Ref_To_Local'>remapinfo</span></a><span class='Delimiter'>[</span><a href="tqueue.c.html#LN1247"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="tqueue.c.html#LN208"><span class='Ref_to_Proto'>BuildTupleRemapInfo</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN1255"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>, </span><a href="tqueue.c.html#LN1243"><span class='Ref_to_Parameter'>mycontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN1245"><span class='Ref_To_Local'>remapinfo</span></a><span class='Delimiter'>[</span><a href="tqueue.c.html#LN1247"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="tqueue.c.html#LN1246"><span class='Ref_To_Local'>noop</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* If no fields require remapping, report that by returning NULL. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tqueue.c.html#LN1246"><span class='Ref_To_Local'>noop</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tqueue.c.html#LN1245"><span class='Ref_To_Local'>remapinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tqueue.c.html#LN1245"><span class='Ref_To_Local'>remapinfo</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="tqueue.c.html#LN1245"><span class='Ref_To_Local'>remapinfo</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end BuildFieldRemapInfo &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>